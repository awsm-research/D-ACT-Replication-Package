private static java.util.Map<java.lang.String, java.lang.Object> search(java.lang.String token, java.util.Map<java.lang.String, java.lang.Object> params, java.lang.String queryType, java.lang.String scope) { try { org.apache.http.client.methods.HttpPost request = org.ovirt.engine.core.aaa.SsoOAuthServiceUtils.createPost("/oauth/token-info"); org.ovirt.engine.core.aaa.SsoOAuthServiceUtils.setClientIdSecretBasicAuthHeader(request); java.util.List<org.apache.http.message.BasicNameValuePair> form = new java.util.ArrayList<>(4); form.add(new org.apache.http.message.BasicNameValuePair("query_type", queryType)); form.add(new org.apache.http.message.BasicNameValuePair("scope", scope)); if (org.apache.commons.lang.StringUtils.isNotEmpty(token)) { form.add(new org.apache.http.message.BasicNameValuePair("token", token)); } if (params != null) { form.add(new org.apache.http.message.BasicNameValuePair("params", org.ovirt.engine.core.aaa.SsoOAuthServiceUtils.serialize(params))); } request.setEntity(new org.apache.http.client.entity.UrlEncodedFormEntity(form, java.nio.charset.StandardCharsets.UTF_8)); return org.ovirt.engine.core.aaa.SsoOAuthServiceUtils.getResponse(request); } catch (java.lang.Exception ex) { return org.ovirt.engine.core.aaa.SsoOAuthServiceUtils.buildMapWithError("server_error", ex.getMessage()); } }
private void analyzeServiceMember(com.thoughtworks.qdox.model.JavaClass javaClass, org.ovirt.api.metamodel.concepts.Service service) { analyzeMethod(javaClass, service); }
protected org.ovirt.engine.core.common.businessentities.storage.ImageTransfer updateEntityPhase(org.ovirt.engine.core.common.businessentities.storage.ImageTransferPhase phase) { org.ovirt.engine.core.common.businessentities.storage.ImageTransfer updates = new org.ovirt.engine.core.common.businessentities.storage.ImageTransfer(org.ovirt.engine.core.bll.storage.disk.image.UploadImageCommand.getCommandId()); updates.setPhase(phase); return updateEntity(updates); }
private boolean matchesHostColonPort(java.lang.String s) { return s == null ? false : s.matches("\\S+:\\d+"); }
private boolean checkCanPerformPlugUnPlugDisk() { if (org.ovirt.engine.core.bll.HotPlugDiskToVmCommand.getVm().getStatus().isUpOrPaused()) { setVdsId(org.ovirt.engine.core.bll.HotPlugDiskToVmCommand.getVm().getRunOnVds()); if (!(canPerformDiskHotPlug(disk))) { return false; } } if (((getPlugAction()) == (org.ovirt.engine.core.common.vdscommands.VDSCommandType.HotPlugDisk)) && (oldVmDevice.getIsPlugged())) { return failCanDoAction(EngineMessage.HOT_PLUG_DISK_IS_NOT_UNPLUGGED); } if (((getPlugAction()) == (org.ovirt.engine.core.common.vdscommands.VDSCommandType.HotUnPlugDisk)) && (!(oldVmDevice.getIsPlugged()))) { return failCanDoAction(EngineMessage.HOT_UNPLUG_DISK_IS_NOT_PLUGGED); } return true; }
public static org.ovirt.engine.core.compat.Version getEffective(org.ovirt.engine.core.common.businessentities.VmBase vmBase, org.ovirt.engine.core.common.businessentities.VDSGroup cluster) { org.ovirt.engine.core.compat.Version vmCustomCompatibilityVersion = (vmBase != null) ? vmBase.getCustomCompatibilityVersion() : null; org.ovirt.engine.core.compat.Version clusterCompatibilityVersion = (cluster != null) ? cluster.getCompatibilityVersion() : null; return org.ovirt.engine.core.common.utils.CompatibilityVersionUtils.getEffective(vmCustomCompatibilityVersion, clusterCompatibilityVersion, org.ovirt.engine.core.compat.Version.getLast()); }
@org.ovirt.engine.ui.common.DefaultStringValue("Namespace:") java.lang.String namespacePermissionsPopup();
@java.lang.Override protected boolean validate() { final org.ovirt.engine.core.common.businessentities.VM vm = org.ovirt.engine.core.bll.SetVmTicketCommand.getVm(); if (vm == null) { addValidationMessage(EngineMessage.ACTION_TYPE_FAILED_VM_NOT_FOUND); return false; } if (!(org.ovirt.engine.core.bll.SetVmTicketCommand.canRunActionOnNonManagedVm())) { return false; } final org.ovirt.engine.core.common.businessentities.VMStatus status = vm.getStatus(); if (((((status != (org.ovirt.engine.core.common.businessentities.VMStatus.Up)) && (status != (org.ovirt.engine.core.common.businessentities.VMStatus.Paused))) && (status != (org.ovirt.engine.core.common.businessentities.VMStatus.PoweringUp))) && (status != (org.ovirt.engine.core.common.businessentities.VMStatus.PoweringDown))) && (status != (org.ovirt.engine.core.common.businessentities.VMStatus.RebootInProgress))) { return org.ovirt.engine.core.bll.SetVmTicketCommand.failVmStatusIllegal(); } return true; }
public void flush() { network.setDataCenterId(getSelectedDc().getId()); network.setName(((java.lang.String) (getName().getEntity()))); network.setStp(((java.lang.Boolean) (getIsStpEnabled().getEntity()))); network.setDescription(((java.lang.String) (getDescription().getEntity()))); network.setLabel(((java.lang.String) (getNetworkLabel().getEntity()))); network.setComment(((java.lang.String) (getComment().getEntity()))); network.setVmNetwork(((java.lang.Boolean) (getIsVmNetwork().getEntity()))); network.setMtu(0); if (((java.lang.Boolean) (getHasMtu().getEntity()))) { network.setMtu(java.lang.Integer.parseInt(getMtu().getEntity().toString())); } network.setVlanId(null); if (((java.lang.Boolean) (getHasVLanTag().getEntity()))) { network.setVlanId(java.lang.Integer.parseInt(getVLanTag().getEntity().toString())); } }
private org.ovirt.engine.core.common.action.ImagesContainterParametersBase buildCloneCinderDiskCommandParameters(org.ovirt.engine.core.common.businessentities.storage.CinderDisk cinderDisk) { org.ovirt.engine.core.common.action.ImagesContainterParametersBase createParams = new org.ovirt.engine.core.common.action.ImagesContainterParametersBase(cinderDisk.getImageId()); org.ovirt.engine.core.common.businessentities.storage.DiskImage templateDisk = diskInfoDestinationMap.get(cinderDisk.getId()); createParams.setDiskAlias(templateDisk.getDiskAlias()); createParams.setStorageDomainId(templateDisk.getStorageIds().get(0)); createParams.setParentCommand(org.ovirt.engine.core.bll.AddVmTemplateCommand.getActionType()); createParams.setParentParameters(org.ovirt.engine.core.bll.AddVmTemplateCommand.getParameters()); createParams.setVmSnapshotId(getVmSnapshotId()); return createParams; }
public java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.asynctasks.gluster.GlusterAsyncTask> getTaskListForCluster(org.ovirt.engine.core.compat.Guid id) { org.ovirt.engine.core.common.businessentities.VDS upServer = org.ovirt.engine.core.bll.utils.ClusterUtils.getInstance().getRandomUpServer(id); if (upServer == null) { org.ovirt.engine.core.bll.gluster.tasks.GlusterTasksService.log.info("No up server in cluster"); return null; } org.ovirt.engine.core.common.vdscommands.VDSReturnValue returnValue = runVdsCommand(VDSCommandType.GlusterTasksList, new org.ovirt.engine.core.common.vdscommands.VdsIdVDSCommandParametersBase(upServer.getId())); if (returnValue.getSucceeded()) { java.util.List<org.ovirt.engine.core.common.asynctasks.gluster.GlusterAsyncTask> tasks = ((java.util.List<org.ovirt.engine.core.common.asynctasks.gluster.GlusterAsyncTask>) (returnValue.getReturnValue())); java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.asynctasks.gluster.GlusterAsyncTask> tasksMap = new java.util.HashMap<>(); for (org.ovirt.engine.core.common.asynctasks.gluster.GlusterAsyncTask task : tasks) { tasksMap.put(task.getTaskId(), task); } return tasksMap; } else { org.ovirt.engine.core.bll.gluster.tasks.GlusterTasksService.log.error("Error: {}", returnValue.getVdsError()); throw new org.ovirt.engine.core.common.errors.EngineException(org.ovirt.engine.core.common.errors.EngineError.GlusterVolumeStatusAllFailedException, returnValue.getVdsError().getMessage()); } }
public java.util.ArrayList<java.lang.String> getValidationMessages() { return validationMessages; }
@java.lang.Override public void init(T qos) { org.ovirt.engine.ui.uicommonweb.models.datacenters.qos.EditQosModel.setQos(qos); org.ovirt.engine.ui.uicommonweb.models.datacenters.qos.EditQosModel.getName().setEntity(qos.getName()); org.ovirt.engine.ui.uicommonweb.models.datacenters.qos.EditQosModel.getDescription().setEntity(qos.getDescription()); }
java.lang.String CANNOT_FORCE_SELECT_SPM_HOST_DOES_NOT_SUPPORT_VIRT_SERVICES();
private static java.lang.String extractAddress(java.util.Map<java.lang.String, java.lang.Object> properties) { return ((java.lang.String) (properties.get("addr"))); }
private java.lang.String getTokenFromHeader(javax.servlet.http.HttpServletRequest request) { java.lang.String token = null; java.lang.String headerValue = request.getHeader(SsoConstants.HEADER_AUTHORIZATION); if ((headerValue != null) && (headerValue.startsWith(org.ovirt.engine.core.sso.servlets.OpenIdUserInfoServlet.BEARER))) { token = headerValue.substring(org.ovirt.engine.core.sso.servlets.OpenIdUserInfoServlet.BEARER.length()).trim(); } return token; }
@org.ovirt.engine.ui.webadmin.DefaultMessage("Virtual Machine {0} already exists") java.lang.String sameVmNameExists(java.lang.String vmName);
@org.ovirt.engine.ui.common.Template("<table style='min-width: 200px; width: 100%; border-bottom: 1px solid #acacac;'><tr>" + ((("<td style='width: 49%;'>{0}</td>" + "<td style='width: 2%; border-left: 1px solid #acacac;'></td>") + "<td style='white-space: normal; width: 49%; color: #acacac;'>{1}</td>") + "</tr></table>")) com.google.gwt.safehtml.shared.SafeHtml typeAheadNameDescription(java.lang.String name, java.lang.String description);
@java.lang.Override protected void executeCommand() { java.lang.String connectionId = org.ovirt.engine.core.bll.storage.RemoveStorageServerConnectionCommand.getConnection().getid(); getStorageServerConnectionDao().remove(connectionId); log.infoFormat("Removing connection {0} from database ", connectionId); if (org.ovirt.engine.core.compat.Guid.isNullOrEmpty(org.ovirt.engine.core.bll.storage.RemoveStorageServerConnectionCommand.getParameters().getVdsId())) { log.info("No vdsId passed - hosts will not be disconnected."); } else { org.ovirt.engine.core.bll.storage.RemoveStorageServerConnectionCommand.disconnectStorage(); } org.ovirt.engine.core.bll.storage.RemoveStorageServerConnectionCommand.setSucceeded(true); }
private org.ovirt.engine.core.common.action.ImagesContainterParametersBase buildChildCommandParameters(org.ovirt.engine.core.common.businessentities.storage.CinderDisk cinderDisk) { org.ovirt.engine.core.common.action.ImagesContainterParametersBase createParams = new org.ovirt.engine.core.common.action.ImagesContainterParametersBase(cinderDisk.getImageId()); org.ovirt.engine.core.common.businessentities.storage.DiskImage templateDisk = org.ovirt.engine.core.bll.storage.CloneCinderDisksCommand.getParameters().getDisksMap().get(cinderDisk.getId()); createParams.setDiskAlias(templateDisk.getDiskAlias()); createParams.setStorageDomainId(templateDisk.getStorageIds().get(0)); createParams.setEntityInfo(org.ovirt.engine.core.bll.storage.CloneCinderDisksCommand.getParameters().getEntityInfo()); createParams.setParentCommand(org.ovirt.engine.core.bll.storage.CloneCinderDisksCommand.getActionType()); createParams.setParentParameters(org.ovirt.engine.core.bll.storage.CloneCinderDisksCommand.getParameters()); createParams.setVmSnapshotId(org.ovirt.engine.core.bll.storage.CloneCinderDisksCommand.getParameters().getVmSnapshotId()); return createParams; }
@java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { setItems(((java.util.Collection) (((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (returnValue)).getReturnValue()))); }
@org.junit.Test public void testAllDomainsExistAndActive() { setUpGeneralValidations(); setUpDiskValidations(); doReturn(org.ovirt.engine.core.bll.CreateAllSnapshotsFromVmCommandTest.getNonEmptyDiskList()).when(cmd).getDisksList(); doReturn(new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.dal.VdcBllMessages.ACTION_TYPE_FAILED_STORAGE_DOMAIN_NOT_EXIST)).when(multipleStorageDomainsValidator).allDomainsExistAndActive(); assertFalse(cmd.canDoAction()); assertTrue(cmd.getReturnValue().getCanDoActionMessages().contains(VdcBllMessages.ACTION_TYPE_FAILED_STORAGE_DOMAIN_NOT_EXIST.name())); }
protected void onExportChanged() { boolean externalNetwork = getExternal().getEntity(); getNetworkLabel().setIsChangeable((!externalNetwork)); getCustomPhysicalNetwork().setIsChangeable((externalNetwork && (!(getUsePhysicalNetworkFromDatacenter().getEntity())))); getDatacenterPhysicalNetwork().setIsChangeable((externalNetwork && (getUsePhysicalNetworkFromDatacenter().getEntity()))); getQos().setIsChangeable((!externalNetwork)); getAddQosCommand().setIsExecutionAllowed((!externalNetwork)); getConnectedToPhysicalNetwork().setIsChangeable(externalNetwork); getUsePhysicalNetworkFromCustom().setIsChangeable(externalNetwork); getUsePhysicalNetworkFromDatacenter().setIsChangeable(externalNetwork); updateMtuSelectorsChangeability(); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Passwords do not match") java.lang.String cloudInitRootPasswordMatchMessage();
private void onVnicProfileMap() { if ((getWindow()) != null) { return; } createVnicProfileMappingsModel(); setWindow(vnicProfileMappingModel); }
private void attachFloppy_EntityChanged() { getFloppyImage().setIsChangable(((java.lang.Boolean) (getAttachFloppy().getEntity()))); updateInitialRunFields(); }
private org.ovirt.engine.core.bll.ValidationResult validateNotRemovingUsedNetworkByVms() { java.util.Collection<java.lang.String> removedNetworks = new java.util.HashSet<>(); for (org.ovirt.engine.core.common.businessentities.network.NetworkAttachment removedAttachment : removedNetworkAttachments) { removedNetworks.add(existingNetworkRelatedToAttachment(removedAttachment).getName()); } java.util.List<java.lang.String> vmNames = getVmInterfaceManager().findActiveVmsUsingNetworks(host.getId(), removedNetworks); if (vmNames.isEmpty()) { return org.ovirt.engine.core.bll.ValidationResult.VALID; } else { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.VdcBllMessages.NETWORK_CANNOT_DETACH_NETWORK_USED_BY_VMS, commaSeparated(vmNames)); } }
@java.lang.Override protected boolean canDoAction() { if ((org.ovirt.engine.core.bll.ClearNonResponsiveVdsVmsCommand.getVds()) == null) { return failCanDoAction(EngineMessage.VDS_INVALID_SERVER_ID); } if ((((hasVMs()) && ((org.ovirt.engine.core.bll.ClearNonResponsiveVdsVmsCommand.getVds().getStatus()) != (org.ovirt.engine.core.common.businessentities.VDSStatus.NonResponsive))) && ((org.ovirt.engine.core.bll.ClearNonResponsiveVdsVmsCommand.getVds().getStatus()) != (org.ovirt.engine.core.common.businessentities.VDSStatus.Reboot))) && ((org.ovirt.engine.core.bll.ClearNonResponsiveVdsVmsCommand.getVds().getStatus()) != (org.ovirt.engine.core.common.businessentities.VDSStatus.Kdumping))) { return failCanDoAction(EngineMessage.VDS_CANNOT_CLEAR_VMS_WRONG_STATUS); } return true; }
@org.junit.Test public void disableGlusterWhenVolumesExist() { createCommandWithVirtEnabled(); when(vdsGroupDao.get(any(org.ovirt.engine.core.compat.Guid.class))).thenReturn(org.ovirt.engine.core.bll.UpdateVdsGroupCommandTest.createVdsGroupWithNoCpuName()); when(vdsGroupDao.getByName(anyString())).thenReturn(org.ovirt.engine.core.bll.UpdateVdsGroupCommandTest.createVdsGroupWithNoCpuName()); cpuExists(); cpuFlagsNotMissing(); allQueriesForVms(); clusterHasGlusterVolumes(); canDoActionFailedWithReason(EngineMessage.VDS_GROUP_CANNOT_DISABLE_GLUSTER_WHEN_CLUSTER_CONTAINS_VOLUMES); }
protected boolean isImageExist() { if ((getImage()) == null) { return failValidation(EngineMessage.ACTION_TYPE_FAILED_DISK_NOT_EXIST); } return true; }
@java.lang.Override protected java.lang.Class<? extends org.ovirt.engine.core.bll.storage.repoimage.GetImagesListByStoragePoolIdQuery<? extends org.ovirt.engine.core.common.queries.GetImagesListByStoragePoolIdParameters>> getQueryType() { return queryClass; }
protected java.util.List<org.ovirt.engine.core.common.businessentities.VM> getVmsFromExportDomain() { org.ovirt.engine.core.common.queries.GetAllFromExportDomainQueryParameters p = new org.ovirt.engine.core.common.queries.GetAllFromExportDomainQueryParameters(getParameters().getStoragePoolId(), getParameters().getSourceDomainId()); org.ovirt.engine.core.common.queries.VdcQueryReturnValue qRetVal = getBackend().runInternalQuery(VdcQueryType.GetVmsFromExportDomain, p); if (!(qRetVal.getSucceeded())) { return null; } return ((java.util.List<org.ovirt.engine.core.common.businessentities.VM>) (qRetVal.getReturnValue())); }
@java.lang.Override public void run() { try { if (isPerformConnectOps && (connectVdsToNewMaster(vds))) { try { runVdsCommand(VDSCommandType.RefreshStoragePool, new org.ovirt.engine.core.common.vdscommands.RefreshStoragePoolVDSCommandParameters(vds.getId(), getStoragePool().getId(), _newMasterStorageDomainId, getStoragePool().getmaster_domain_version())); } catch (org.ovirt.engine.core.common.errors.VdcBLLException ex) { if ((org.ovirt.engine.core.common.errors.VdcBllErrors.StoragePoolUnknown) == (ex.getVdsError().getCode())) { org.ovirt.engine.core.common.vdscommands.VDSReturnValue returnVal = runVdsCommand(VDSCommandType.ConnectStoragePool, new org.ovirt.engine.core.common.vdscommands.ConnectStoragePoolVDSCommandParameters(vds.getId(), getStoragePool().getId(), vds.getvds_spm_id(), _newMasterStorageDomainId, getStoragePool().getmaster_domain_version())); if (!(returnVal.getSucceeded())) { log.errorFormat("Post reconstruct actions (connectPool) did not complete on host {0} in the pool. error {1}", vds.getId(), returnVal.getVdsError().getMessage()); } } else { log.errorFormat(("Post reconstruct actions (refreshPool)" + " did not complete on host {0} in the pool. error {1}"), vds.getId(), ex.getMessage()); } } } if (isPerformDisconnect) { org.ovirt.engine.core.bll.storage.StorageHelperDirector.getInstance().getItem(getStorageDomain().getstorage_type()).disconnectStorageFromDomainByVdsId(getStorageDomain(), vds.getId()); } } catch (java.lang.Exception e) { log.errorFormat(("Post reconstruct actions (connectPool,refreshPool,disconnect storage)" + " did not complete on host {0} in the pool. error {1}"), vds.getId(), e.getMessage()); } }
protected boolean shouldCheckSpaceInStorageDomains() { return !(getImagesToCheckDestinationStorageDomains().stream().map(DiskImage::getImageId).findFirst().orElse(VmTemplateHandler.BLANK_VM_TEMPLATE_ID).equals(VmTemplateHandler.BLANK_VM_TEMPLATE_ID)); }
@java.lang.Override public void setDefaultInterface() { getDiskInterface().setSelectedItem(DiskInterface.VirtIO); }
public java.lang.Boolean call() throws java.lang.Exception { if (((java.lang.Boolean) (_deploy.getParser().cliEnvironmentGet(VdsmEnv.OVIRT_VINTAGE_NODE)))) { _deploy.userVisibleLog(java.util.logging.Level.INFO, "Host is hypervisor"); setNode(); } return true; }
private boolean updateParameters() { for (org.ovirt.engine.core.common.action.MoveDiskParameters moveDiskParameters : org.ovirt.engine.core.bll.MoveDisksCommand.getParameters().getParametersList()) { org.ovirt.engine.core.common.businessentities.DiskImage diskImage = getDiskImageDao().get(moveDiskParameters.getImageId()); if (diskImage == null) { return failCanDoAction(VdcBllMessages.ACTION_TYPE_FAILED_DISK_NOT_EXIST); } java.util.List<org.ovirt.engine.core.common.businessentities.VM> allVms = org.ovirt.engine.core.bll.MoveDisksCommand.getVmDAO().getVmsListForDisk(diskImage.getId()); org.ovirt.engine.core.common.businessentities.VM vm = (!(allVms.isEmpty())) ? allVms.get(0) : null; org.ovirt.engine.core.bll.snapshots.SnapshotsValidator snapshotsValidator = new org.ovirt.engine.core.bll.snapshots.SnapshotsValidator(); if ((vm != null) && (!(validate(snapshotsValidator.vmNotInPreview(vm.getId()))))) { return false; } if ((vm == null) || (isVmDown(vm))) { moveParametersList.add(moveDiskParameters); } else if (isVmRunning(vm)) { org.ovirt.engine.core.utils.MultiValueMapUtils.addToMap(vm.getId(), createLiveMigrateDiskParameters(moveDiskParameters, vm.getId()), vmsLiveMigrateParametersMap); } else { addCanDoActionMessage(java.lang.String.format("$%1$s %2$s", "VmName", vm.getVmName())); return failCanDoAction(VdcBllMessages.ACTION_TYPE_FAILED_VM_IS_NOT_DOWN_OR_UP); } } return true; }
protected boolean validateVdsCluster() { org.ovirt.engine.core.common.businessentities.VDSGroup vdsGroup = org.ovirt.engine.core.bll.ImportVmCommandBase.getVdsGroupDao().get(org.ovirt.engine.core.bll.ImportVmCommandBase.getVdsGroupId()); return vdsGroup == null ? failValidation(EngineMessage.VDS_CLUSTER_IS_NOT_VALID) : (vdsGroup.getArchitecture()) != (org.ovirt.engine.core.bll.ImportVmCommandBase.getVm().getClusterArch()) ? failValidation(EngineMessage.ACTION_TYPE_FAILED_VM_CANNOT_IMPORT_VM_ARCHITECTURE_NOT_SUPPORTED_BY_CLUSTER) : true; }
public java.lang.String getUser() { return user; }
private void addRoleColumn(org.ovirt.engine.ui.common.CommonApplicationConstants constants) { org.ovirt.engine.ui.common.widget.table.column.AbstractTextColumn<org.ovirt.engine.core.common.businessentities.Permission> roleColumn = new org.ovirt.engine.ui.common.widget.table.column.AbstractTextColumn<org.ovirt.engine.core.common.businessentities.Permission>() { @java.lang.Override public java.lang.String getValue(org.ovirt.engine.core.common.businessentities.Permission object) { return object.getRoleName(); } }; roleColumn.makeSortable(); org.ovirt.engine.ui.common.widget.uicommon.permissions.PermissionListModelTable.getTable().addColumn(roleColumn, constants.rolePermission(), "300px"); }
@java.lang.Override public void onMouseOver(com.google.gwt.event.dom.client.MouseOverEvent event) { if (org.ovirt.engine.ui.uicompat.external.StringUtils.isEmpty(title)) { tooltip.setHTML(title); tooltipPanel.showRelativeTo(this); } }
protected org.ovirt.engine.ui.uicommonweb.models.userportal.UserPortalItemModel asUserPortalItem(org.ovirt.engine.ui.uicommonweb.models.userportal.IUserPortalListModel model) { return ((org.ovirt.engine.ui.uicommonweb.models.userportal.UserPortalItemModel) (model.getSelectedItem())); }
public void setGroups(java.util.HashMap<java.lang.String, org.ovirt.engine.core.common.businessentities.LdapGroup> value) { mGroups = value; }
java.lang.String ACTION_TYPE_FAILED_DESTINATION_STORAGE_DOMAIN_ALREADY_CONTAINS_THE_DISK();
public static java.util.List<org.ovirt.engine.core.common.businessentities.storage.DiskImage> filterImageDisks(java.util.Collection<? extends org.ovirt.engine.core.common.businessentities.storage.Disk> listOfDisks, boolean allowOnlyNotShareableDisks, boolean allowOnlySnapableDisks, boolean allowOnlyActiveDisks) { java.util.List<org.ovirt.engine.core.common.businessentities.storage.DiskImage> diskImages = new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.storage.DiskImage>(); for (org.ovirt.engine.core.common.businessentities.storage.Disk disk : listOfDisks) { if (((((disk.getDiskStorageType()) == (org.ovirt.engine.core.common.businessentities.storage.DiskStorageType.IMAGE)) && ((!allowOnlyNotShareableDisks) || (!(disk.isShareable())))) && ((!allowOnlySnapableDisks) || (disk.isAllowSnapshot()))) && ((!allowOnlyActiveDisks) || (java.lang.Boolean.TRUE.equals(((org.ovirt.engine.core.common.businessentities.storage.DiskImage) (disk)).getActive())))) { diskImages.add(((org.ovirt.engine.core.common.businessentities.storage.DiskImage) (disk))); } } return diskImages; }
@java.lang.Override protected boolean canDoAction() { if (!(super.canDoAction())) { return false; } org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity volume = getGlusterVolume(); if ((((volume.getAsyncTask()) != null) && (((volume.getAsyncTask().getType()) == (org.ovirt.engine.core.common.asynctasks.gluster.GlusterTaskType.REBALANCE)) || ((volume.getAsyncTask().getType()) == (org.ovirt.engine.core.common.asynctasks.gluster.GlusterTaskType.REMOVE_BRICK)))) && ((volume.getAsyncTask().getStatus()) == (org.ovirt.engine.core.common.job.JobExecutionStatus.STARTED))) { addCanDoActionMessageVariable("asyncTask", volume.getAsyncTask().getType().name().toLowerCase()); return failCanDoAction(VdcBllMessages.ACTION_TYPE_FAILED_VOLUME_ASYNC_OPERATION_IN_PROGRESS); } for (org.ovirt.engine.core.common.businessentities.gluster.GlusterGeoRepSession session : georepSessions) { if (((session.getSlaveVolumeId()) == null) || ((session.getSlaveNodeUuid()) == null)) { return failCanDoAction(VdcBllMessages.ACTION_TYPE_FAILED_REMOTE_CLUSTER_NOT_MAINTAINED_BY_ENGINE); } } return true; }
@org.junit.Test public void validateVmShareableDisk() { org.ovirt.engine.core.common.businessentities.StorageDomain srcStorageDomain = initStorageDomain(srcStorageId); srcStorageDomain.setStatus(StorageDomainStatus.Active); org.ovirt.engine.core.common.businessentities.storage.DiskImage diskImage = initDiskImage(diskImageGroupId, diskImageId); diskImage.setShareable(true); initVm(VMStatus.Up, org.ovirt.engine.core.compat.Guid.newGuid(), diskImageGroupId); org.ovirt.engine.core.bll.ValidateTestUtils.runAndAssertValidateFailure(command, EngineMessage.ACTION_TYPE_FAILED_SHAREABLE_DISK_NOT_SUPPORTED); }
private boolean initGlusterHost() { glusterHostUuidFound = true; if (org.ovirt.engine.core.common.gluster.GlusterFeatureSupported.glusterHostUuidSupported(getVdsGroup().getCompatibilityVersion())) { org.ovirt.engine.core.common.vdscommands.VDSReturnValue returnValue = runVdsCommand(VDSCommandType.GetGlusterHostUUID, new org.ovirt.engine.core.common.vdscommands.VdsIdVDSCommandParametersBase(getVds().getId())); if ((returnValue.getSucceeded()) && ((returnValue.getReturnValue()) != null)) { org.ovirt.engine.core.compat.Guid addedServerUuid = org.ovirt.engine.core.compat.Guid.createGuidFromString(((java.lang.String) (returnValue.getReturnValue()))); if (hostUuidExists(addedServerUuid)) { setNonOperational(NonOperationalReason.GLUSTER_HOST_UUID_ALREADY_EXISTS, null); return false; } saveGlusterHostUuid(addedServerUuid); } else { glusterHostUuidFound = false; setNonOperational(NonOperationalReason.GLUSTER_HOST_UUID_NOT_FOUND, null); } } return (glusterHostUuidFound) && (initGlusterPeerProcess()); }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("Space Used") java.lang.String volumeCapacity();
public void removeSpmFromMap(java.lang.String spId) { this.spmMap.remove(spId); }
protected org.ovirt.engine.core.bll.validator.storage.MultipleDiskVmElementValidator createMultipleDiskVmElementValidator() { return new org.ovirt.engine.core.bll.validator.storage.MultipleDiskVmElementValidator(getImage(), diskVmElementDao.getAllDiskVmElementsByDiskId(org.ovirt.engine.core.bll.storage.disk.MoveOrCopyDiskCommand.getParameters().getImageGroupID())); }
public static <T> org.ovirt.engine.core.common.utils.Pair<T, org.apache.commons.httpclient.HttpClient> getConnection(java.lang.String hostName, int port, int clientTimeOut, int connectionTimeOut, int clientRetries, int maxConnectionsPerHost, int maxTotalConnections, java.lang.Class<T> type, boolean isSecure) { org.ovirt.engine.core.common.utils.Pair<java.lang.String, java.net.URL> urlInfo = org.ovirt.engine.core.vdsbroker.xmlrpc.XmlRpcUtils.getConnectionUrl(hostName, port, null, isSecure); if (urlInfo == null) { return null; } return org.ovirt.engine.core.vdsbroker.xmlrpc.XmlRpcUtils.getHttpConnection(urlInfo.getSecond(), clientTimeOut, connectionTimeOut, clientRetries, maxConnectionsPerHost, maxTotalConnections, type); }
protected boolean pciAndIdeWithinLimit(org.ovirt.engine.core.common.businessentities.VmStatic vm, java.util.List<org.ovirt.engine.core.common.businessentities.network.VmNic> allInterfaces) { java.util.List<org.ovirt.engine.core.common.businessentities.Disk> allDisks = org.ovirt.engine.core.bll.network.vm.AbstractVmInterfaceCommand.getDiskDao().getAllForVm(org.ovirt.engine.core.bll.network.vm.AbstractVmInterfaceCommand.getVmId()); return checkPciAndIdeLimit(vm.getNumOfMonitors(), allInterfaces, allDisks, org.ovirt.engine.core.bll.utils.VmDeviceUtils.isVirtioScsiControllerAttached(org.ovirt.engine.core.bll.network.vm.AbstractVmInterfaceCommand.getVmId()), org.ovirt.engine.core.bll.network.vm.AbstractVmInterfaceCommand.getReturnValue().getCanDoActionMessages()); }
@java.lang.Override public boolean Validate() { boolean isNew = getModel().getIsNew(); int maxAllowedVms = getMaxVmsInPool(); int assignedVms = getModel().getAssignedVms().AsConvertible().Integer(); getModel().getNumOfDesktops().ValidateEntity(new org.ovirt.engine.ui.uicommonweb.validation.IValidation[]{ new org.ovirt.engine.ui.uicommonweb.validation.NotEmptyValidation(), new org.ovirt.engine.ui.uicommonweb.validation.LengthValidation(4), new org.ovirt.engine.ui.uicommonweb.validation.IntegerValidation((isNew ? 1 : 0), (isNew ? maxAllowedVms : maxAllowedVms - assignedVms)) }); getModel().getPrestartedVms().ValidateEntity(new org.ovirt.engine.ui.uicommonweb.validation.IValidation[]{ new org.ovirt.engine.ui.uicommonweb.validation.NotEmptyValidation(), new org.ovirt.engine.ui.uicommonweb.validation.IntegerValidation(0, assignedVms) }); getModel().setIsGeneralTabValid(((((getModel().getIsGeneralTabValid()) && (getModel().getName().getIsValid())) && (getModel().getNumOfDesktops().getIsValid())) && (getModel().getPrestartedVms().getIsValid()))); getModel().setIsPoolTabValid(true); return (((super.Validate()) && (getModel().getName().getIsValid())) && (getModel().getNumOfDesktops().getIsValid())) && (getModel().getPrestartedVms().getIsValid()); }
public java.util.List<java.lang.String> validate() { for (org.ovirt.engine.core.common.businessentities.VdsNetworkInterface iface : params.getInterfaces()) { java.lang.String name = iface.getName(); if (addInterfaceToProcessedList(iface)) { if (isBond(iface)) { extractBondIfModified(iface, name); } else { if (org.apache.commons.lang.StringUtils.isNotBlank(iface.getBondName())) { extractBondSlave(iface); } java.lang.String nameWithoutVlanId = org.ovirt.engine.core.utils.NetworkUtils.StripVlan(name); if (!(getExistingIfaces().containsKey(nameWithoutVlanId))) { addViolation(VdcBllMessages.NETWORK_INTERFACES_DONT_EXIST, nameWithoutVlanId); } } if ((violations.isEmpty()) && (org.apache.commons.lang.StringUtils.isNotBlank(iface.getNetworkName()))) { extractNetwork(iface); } } } validateBondSlavesCount(); extractRemovedNetworks(); extractRemovedBonds(); detectSlaveChanges(); return translateViolations(); }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.VM> getAllVMsWithDisksOnOtherStorageDomain(org.ovirt.engine.core.compat.Guid storageDomainGuid) { return getCallsHandler().executeReadList("GetAllVMsWithDisksOnOtherStorageDomain", org.ovirt.engine.core.dao.VmDaoImpl.VMRowMapper.instance, getCustomMapSqlParameterSource().addValue("storage_domain_id", storageDomainGuid)); }
private void setJobStatusExpectations(org.ovirt.engine.core.compat.Guid jobId, org.ovirt.engine.core.common.job.JobExecutionStatus jobStatus, org.ovirt.engine.core.common.queries.VdcQueryReturnValue monitorResult, org.ovirt.engine.core.common.action.VdcReturnValueBase result) { when(result.getJobId()).thenReturn(jobId); if (jobId != null) { org.ovirt.engine.core.common.job.Job jobMock = mock(org.ovirt.engine.core.common.job.Job.class); when(jobMock.getStatus()).thenReturn(jobStatus); when(monitorResult.getReturnValue()).thenReturn(jobMock); when(backend.runQuery(eq(VdcQueryType.GetJobByJobId), eqQueryParams(org.ovirt.engine.core.common.queries.IdQueryParameters.class, addSession("Id"), addSession(jobId)))).thenReturn(monitorResult); enqueueInteraction(() -> verify(backend, atLeastOnce()).runQuery(eq(VdcQueryType.GetJobByJobId), eqQueryParams(org.ovirt.engine.core.common.queries.IdQueryParameters.class, addSession("Id"), addSession(jobId)))); } }
private void enableSelectionElements(boolean enableElements) { selectHostAutomaticallyEditor.setEnabled(enableElements); selectDestinationHostEditor.setEnabled(enableElements); hostsListEditor.setEnabled(enableElements); }
@java.lang.Override public void init(final org.ovirt.engine.ui.uicommonweb.models.providers.ProviderModel model) { super.init(model); registerHandler(getView().getTestButton().addClickHandler(new com.google.gwt.event.dom.client.ClickHandler() { @java.lang.Override public void onClick(com.google.gwt.event.dom.client.ClickEvent event) { model.getTestCommand().execute(); } })); model.getTestResult().getEntityChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { getView().setTestResultImage(((java.lang.String) (model.getTestResult().getEntity()))); } }); model.getNeutronAgentModel().getPropertyChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { if ("IsAvailable".equals(((org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs) (args)).PropertyName)) { getView().setAgentTabVisibility(model.getNeutronAgentModel().getIsAvailable()); } } }); }
private boolean shouldProcessVdsDomainReport(org.ovirt.engine.core.common.businessentities.VDS vds) { return (vds.getVdsGroupSupportsVirtService()) && (StoragePoolDomainHelper.reportingVdsStatus.contains(vds.getStatus())); }
@java.lang.Override protected boolean canDoAction() { org.ovirt.engine.core.bll.validator.VmValidator vmValidator = new org.ovirt.engine.core.bll.validator.VmValidator(org.ovirt.engine.core.bll.CreateAllSnapshotsFromVmCommand.getVm()); boolean result = validateVM(vmValidator); java.util.List<org.ovirt.engine.core.common.businessentities.DiskImage> disksList = getDisksList(); if (result && ((disksList.size()) > 0)) { org.ovirt.engine.core.bll.snapshots.SnapshotsValidator snapshotValidator = new org.ovirt.engine.core.bll.snapshots.SnapshotsValidator(); result = ((((((validate(snapshotValidator.vmNotDuringSnapshot(org.ovirt.engine.core.bll.CreateAllSnapshotsFromVmCommand.getVmId()))) && (validate(snapshotValidator.vmNotInPreview(org.ovirt.engine.core.bll.CreateAllSnapshotsFromVmCommand.getVmId())))) && (validate(vmValidator.vmNotDuringMigration()))) && (validate(vmValidator.vmNotRunningStateless()))) && (validate(vmValidator.vmNotIlegal()))) && (org.ovirt.engine.core.bll.ImagesHandler.PerformImagesChecks(org.ovirt.engine.core.bll.CreateAllSnapshotsFromVmCommand.getReturnValue().getCanDoActionMessages(), org.ovirt.engine.core.bll.CreateAllSnapshotsFromVmCommand.getVm().getStoragePoolId(), Guid.Empty, true, true, true, true, true, true, disksList))) && (validate(vmValidator.vmNotLocked())); } return result; }
protected void unlockVm() { if ((org.ovirt.engine.core.bll.VmCommand.getVm()) != null) { if ((org.ovirt.engine.core.bll.VmCommand.getVm().getStatus()) == (org.ovirt.engine.core.common.businessentities.VMStatus.ImageLocked)) { org.ovirt.engine.core.bll.VmHandler.unlockVm(org.ovirt.engine.core.bll.VmCommand.getVm(), org.ovirt.engine.core.bll.VmCommand.getCompensationContext()); } } else { org.ovirt.engine.core.bll.VmCommand.setCommandShouldBeLogged(false); log.warn("VmCommand::EndVmCommand: Vm is null - not performing EndAction on Vm"); } }
@org.junit.Test public void testTemplateOvfCreationBackwardCompatiliblity() throws java.lang.Exception { org.ovirt.engine.core.common.businessentities.VmTemplate template = org.ovirt.engine.core.utils.ovf.OvfManagerTest.createVmTemplate(); java.lang.String xml = manager.ExportTemplate(template, new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.DiskImage>(), Version.v3_0); assertNotNull(xml); final org.ovirt.engine.core.common.businessentities.VmTemplate newtemplate = new org.ovirt.engine.core.common.businessentities.VmTemplate(); manager.ImportTemplate(xml, newtemplate, new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.DiskImage>(), new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface>()); assertEquals("imported template is different than expected", template, newtemplate); assertEquals("imported db generation is different than expected", template.getDbGeneration(), newtemplate.getDbGeneration()); }
@java.lang.Override public java.lang.Long getRawValue(org.ovirt.engine.core.common.businessentities.StorageDomain object) { long availableDiskSize = ((object.getAvailableDiskSize()) != null) ? object.getAvailableDiskSize() : 0; return ((long) (availableDiskSize)); }
private void addVideoCardByDisplayType(org.ovirt.engine.core.common.businessentities.DisplayType displayType) { java.util.Map<java.lang.String, java.lang.Object> struct = new java.util.HashMap<java.lang.String, java.lang.Object>(); struct.put(VdsProperties.Type, VmDeviceType.VIDEO.getName()); struct.put(VdsProperties.Device, displayType.getVmDeviceType().getName()); struct.put(VdsProperties.SpecParams, org.ovirt.engine.core.vdsbroker.vdsbroker.VmInfoBuilder.getNewMonitorSpecParams()); struct.put(VdsProperties.DeviceId, java.lang.String.valueOf(org.ovirt.engine.core.compat.Guid.NewGuid())); devices.add(struct); }
protected org.ovirt.engine.ui.uicommonweb.models.vms.ImportVmModel getImportModel() { org.ovirt.engine.ui.uicommonweb.models.vms.ImportVmModel model = new org.ovirt.engine.ui.uicommonweb.models.vms.ImportVmModel(); model.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().importVirtualMachinesTitle()); model.setHelpTag(HelpTag.import_virtual_machine); model.setHashName("import_virtual_machine"); model.setEntity(getEntity()); return model; }
@java.lang.Override protected void configure() { bind(org.ovirt.engine.ui.uicommonweb.ConsoleOptionsFrontendPersister.class).to(org.ovirt.engine.ui.common.utils.ConsoleOptionsFrontendPersisterImpl.class).in(com.google.inject.Singleton.class); bind(org.ovirt.engine.ui.uicommonweb.ConsoleUtils.class).to(org.ovirt.engine.ui.common.utils.ConsoleUtilsImpl.class).in(com.google.inject.Singleton.class); bind(org.ovirt.engine.ui.uicommonweb.ConsoleManager.class).to(org.ovirt.engine.ui.common.utils.ConsoleManagerImpl.class).in(com.google.inject.Singleton.class); }
@org.junit.Test public void testGetAllForStorageEmpty() { java.util.List<org.ovirt.engine.core.common.businessentities.profiles.DiskProfile> result = dao.getAllForStorageDomain(org.ovirt.engine.core.compat.Guid.newGuid()); assertNotNull(result); assertTrue(result.isEmpty()); }
private void addBondToUpdateList(org.ovirt.engine.core.common.businessentities.network.Bond bond) { for (java.util.Iterator<org.ovirt.engine.core.common.businessentities.network.Bond> iter = hostSetupNetworksParametersData.newOrModifiedBonds.iterator(); iter.hasNext();) { org.ovirt.engine.core.common.businessentities.network.Bond oldModifiedBond = iter.next(); if (oldModifiedBond.getName().equals(bond.getName())) { iter.remove(); break; } } hostSetupNetworksParametersData.newOrModifiedBonds.add(bond); }
@java.lang.Override protected void executeVdsBrokerCommand() { mVmListReturn = org.ovirt.engine.core.vdsbroker.vdsbroker.GetVmStatsVDSCommand.getBroker().getVmStats(org.ovirt.engine.core.vdsbroker.vdsbroker.GetVmStatsVDSCommand.getParameters().getVmId().toString()); org.ovirt.engine.core.vdsbroker.vdsbroker.GetVmStatsVDSCommand.proceedProxyReturnValue(); setReturnValue(createVmInternalData(mVmListReturn.mInfoList[0])); }
public org.ovirt.engine.ui.uicommonweb.models.EntityModel<java.lang.String> getUiLanguage() { return privateUiLanguage; }
@org.junit.Test public void updateVmDevicesNotNull() { org.ovirt.engine.core.compat.Guid vmGuid = org.ovirt.engine.core.compat.Guid.newGuid(); when(vmDeviceDAO.getVmDeviceByVmId(vmGuid)).thenReturn(java.util.Collections.<org.ovirt.engine.core.common.businessentities.VmDevice>emptyList()); java.util.HashMap vm = new java.util.HashMap(); java.lang.String testLogicalName = "TestName"; vm.put(VdsProperties.vm_guid, vmGuid.toString()); java.util.Map<java.lang.String, java.lang.Object> deviceProperties = new java.util.HashMap<java.lang.String, java.lang.Object>(); org.ovirt.engine.core.compat.Guid deviceID = org.ovirt.engine.core.compat.Guid.newGuid(); deviceProperties.put(VdsProperties.DeviceId, deviceID.toString()); deviceProperties.put(VdsProperties.Address, java.util.Collections.emptyMap()); deviceProperties.put(VdsProperties.Device, VmDeviceType.DISK.getName()); deviceProperties.put(VdsProperties.Type, VmDeviceGeneralType.DISK.getValue()); vm.put(VdsProperties.GuestDiskMapping, java.util.Collections.singletonMap(deviceID.toString().substring(0, 20), java.util.Collections.singletonMap(VdsProperties.Name, testLogicalName))); vm.put(VdsProperties.Devices, new java.util.HashMap[]{ new java.util.HashMap(deviceProperties) }); vmInfo = new java.util.HashMap[]{ vm }; vmsMonitoring.updateVmDevices(java.util.Collections.singletonList(vmGuid.toString())); junit.framework.Assert.assertEquals("wrong number of new devices", 1, vmsMonitoring.getNewVmDevices().size()); org.ovirt.engine.core.common.businessentities.VmDevice device = vmsMonitoring.getNewVmDevices().get(0); junit.framework.Assert.assertEquals(testLogicalName, device.getLogicalName()); junit.framework.Assert.assertEquals("wrong number of removed devices", 0, vmsMonitoring.getRemovedVmDevices().size()); }
private java.lang.String renderGigabyteSize(long sizeInBytes) { long sizeInGB = org.ovirt.engine.ui.uicommonweb.models.SizeConverter.convert(sizeInBytes, SizeConverter.SizeUnit.BYTES, SizeUnit.GB).longValue(); return sizeInGB >= 1 ? sizeInGB + " GB" : "< 1 GB"; }
@java.lang.Override public void save(org.ovirt.engine.core.common.businessentities.AsyncTask task) { org.ovirt.engine.core.dao.AsyncTaskDaoImpl.AsyncTaskParameterSource parameterSource = getTaskParameterSource(task); parameterSource.addValue("started_at", task.getStartTime()); parameterSource.addValue("storage_pool_id", task.getStoragePoolId()); parameterSource.addValue("async_task_type", task.getTaskType()); getCallsHandler().executeModification("Insertasync_tasks", parameterSource); }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.ActionGroup> getAllForRole(org.ovirt.engine.core.compat.Guid id) { org.springframework.jdbc.core.namedparam.MapSqlParameterSource parameterSource = getCustomMapSqlParameterSource().addValue("id", id); return getCallsHandler().executeReadList("GetRoleActionGroupsByRoleId", org.ovirt.engine.core.dao.ActionGroupDaoImpl.ActionGroupMapper.instance, parameterSource); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("NFS mount path is illegal, please use [IP:/path or FQDN:/path] convention.") java.lang.String nfsMountPashIsIllegalMsg();
@java.lang.Override public void onFailed(org.ovirt.engine.core.compat.Guid cmdId, java.util.List<org.ovirt.engine.core.compat.Guid> childCmdIds) { org.ovirt.engine.core.bll.RemoveVmPoolCommand<? extends org.ovirt.engine.core.common.action.VmPoolParametersBase> cmd = getCommand(cmdId); org.ovirt.engine.core.bll.tasks.CommandCoordinatorUtil.removeAllCommandsInHierarchy(cmdId); cmd.getParameters().setTaskGroupSuccess(false); cmd.endAction(); }
@java.lang.Override public org.ovirt.engine.core.common.utils.Pair<java.util.List<org.ovirt.engine.core.compat.Guid>, org.ovirt.engine.core.compat.Guid> runBalance(java.lang.String balanceName, java.util.List<org.ovirt.engine.core.compat.Guid> hostIDs, java.util.Map<java.lang.String, java.lang.String> propertiesMap) { try { org.apache.xmlrpc.client.XmlRpcClient client = new org.apache.xmlrpc.client.XmlRpcClient(); client.setConfig(config); java.lang.Object result = client.execute(org.ovirt.engine.core.bll.scheduling.external.ExternalSchedulerBrokerImpl.BALANCE, createBalanceArgs(balanceName, hostIDs, propertiesMap)); return parseBalanceResults(result); } catch (org.apache.xmlrpc.XmlRpcException e) { org.ovirt.engine.core.bll.scheduling.external.ExternalSchedulerBrokerImpl.log.error("Could not communicate with the external scheduler while balancing", e); auditLogFailedToConnect(); return null; } }
@java.lang.Override public java.util.List<org.ovirt.engine.core.aaa.DirectoryUser> findUsers(java.util.List<java.lang.String> ids) { java.util.List<org.ovirt.engine.core.compat.Guid> guids = new java.util.ArrayList<>(); for (java.lang.String id : ids) { guids.add(org.ovirt.engine.core.compat.Guid.createGuidFromString(id)); } org.ovirt.engine.extensions.aaa.builtin.kerberosldap.LdapReturnValueBase ldapResult = broker.runAdAction(AdActionType.GetAdUserByUserIdList, new org.ovirt.engine.extensions.aaa.builtin.kerberosldap.LdapSearchByUserIdListParameters(getName(), guids, true)); @java.lang.SuppressWarnings("unchecked") java.util.List<org.ovirt.engine.core.common.businessentities.LdapUser> ldapUsers = ((java.util.List<org.ovirt.engine.core.common.businessentities.LdapUser>) (ldapResult.getReturnValue())); return mapUsers(ldapUsers); }
private static java.util.Map getData(java.net.HttpURLConnection connection) throws java.lang.Exception { try (java.io.ByteArrayOutputStream os = new java.io.ByteArrayOutputStream()) { try (java.io.InputStream input = connection.getInputStream()) { org.ovirt.engine.core.aaa.filters.FiltersHelper.copy(input, os); } java.lang.ClassLoader loader = java.lang.Thread.currentThread().getContextClassLoader(); java.lang.Thread.currentThread().setContextClassLoader(org.ovirt.engine.core.aaa.SSOOAuthServiceUtils.class.getClassLoader()); try { return new org.ovirt.engine.core.utils.serialization.json.JsonObjectDeserializer().deserialize(new java.lang.String(os.toByteArray(), java.nio.charset.StandardCharsets.UTF_8.name()), java.util.HashMap.class); } finally { java.lang.Thread.currentThread().setContextClassLoader(loader); } } }
private void saveHookContent(java.util.List<java.util.concurrent.Callable<org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.common.businessentities.gluster.GlusterHookEntity, org.ovirt.engine.core.common.vdscommands.VDSReturnValue>>> contentTasksList) { if (contentTasksList.isEmpty()) { return; } java.util.List<org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.common.businessentities.gluster.GlusterHookEntity, org.ovirt.engine.core.common.vdscommands.VDSReturnValue>> pairResults = org.ovirt.engine.core.utils.threadpool.ThreadPoolUtil.invokeAll(contentTasksList); for (org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.common.businessentities.gluster.GlusterHookEntity, org.ovirt.engine.core.common.vdscommands.VDSReturnValue> pairResult : pairResults) { final org.ovirt.engine.core.common.businessentities.gluster.GlusterHookEntity hook = pairResult.getFirst(); if (!(pairResult.getSecond().getSucceeded())) { org.ovirt.engine.core.bll.gluster.GlusterHookSyncJob.log.infoFormat("Failed to get content of hook {0} with error {1} ", hook.getHookKey(), pairResult.getSecond().getVdsError().getMessage()); logMessage(hook.getClusterId(), hook.getHookKey(), AuditLogType.GLUSTER_HOOK_GETCONTENT_FAILED); continue; } final java.lang.String content = ((java.lang.String) (pairResult.getSecond().getReturnValue())); getHooksDao().updateGlusterHookContent(hook.getId(), hook.getChecksum(), content); } }
protected org.ovirt.engine.core.dao.gluster.GlusterBrickDao getGlusterBrickDao() { return GlusterCommandBase.getDbFacade().getGlusterBrickDao(); }
@java.lang.Override public java.lang.String toString() { return (((super.toString()) + ", storage domain id=") + (getStorageDomainId())) + "}"; }
private boolean noChangesDetected() { return ((((getNetworksToConfigure().isEmpty()) && (getRemovedNetworks().isEmpty())) && (org.ovirt.engine.core.bll.network.host.HostSetupNetworksCommand.getParameters().getBonds().isEmpty())) && (getRemovedBondNames().isEmpty())) && (getRemovedUnmanagedNetworks().isEmpty()); }
@java.lang.Override public int hashCode() { return java.util.Objects.hash(scope, doneAt); }
@org.junit.Test public void testVmsWithNoIsoAttached() { mockDomain(); doReturn(domain).when(cmd).getStorageDomain(); doReturn(vmStaticDao).when(cmd).getVmStaticDao(); when(vmStaticDao.getAllByStoragePoolId(any(org.ovirt.engine.core.compat.Guid.class))).thenReturn(java.util.Collections.<org.ovirt.engine.core.common.businessentities.VmStatic>emptyList()); assertTrue(cmd.isRunningVmsWithIsoAttached()); assertTrue(cmd.getReturnValue().getValidationMessages().isEmpty()); }
@java.lang.Override protected void executeVmCommand() { org.ovirt.engine.core.bll.VmHandler.warnMemorySizeLegal(org.ovirt.engine.core.bll.AddVmCommand.getParameters().getVm().getStaticData(), org.ovirt.engine.core.bll.AddVmCommand.getEffectiveCompatibilityVersion()); java.util.List<java.lang.String> errorMessages = new java.util.ArrayList<>(); if (!(canAddVm(errorMessages, destStorages.values()))) { log.error("Failed to add VM. The reasons are: {}", java.lang.String.join(",", errorMessages)); return; } org.ovirt.engine.core.utils.transaction.TransactionSupport.executeInNewTransaction(() -> { addVmStatic(); addVmDynamic(); addVmNetwork(); addVmNumaNodes(); addVmStatistics(); addActiveSnapshot(); addVmPermission(); addVmInit(); addVmRngDevice(); getCompensationContext().stateChanged(); return null; }); if (addVmImages()) { org.ovirt.engine.core.utils.transaction.TransactionSupport.executeInNewTransaction(() -> { copyDiskVmElements(); copyVmDevices(); addDiskPermissions(); addVmPayload(); updateSmartCardDevices(); addVmWatchdog(); addGraphicsDevice(); setActionReturnValue(getVm().getId()); setSucceeded(true); return null; }); } if ((org.ovirt.engine.core.bll.AddVmCommand.getParameters().getPoolId()) != null) { addVmToPool(); } }
@java.lang.Override protected void executeQueryCommand() { org.ovirt.engine.core.bll.snapshots.SnapshotVmConfigurationHelper snapshotVmConfigurationHelper = getSnapshotVmConfigurationHelper(); org.ovirt.engine.core.common.businessentities.Snapshot snapshot = getSnapshotDao().get(org.ovirt.engine.core.bll.GetVmNextRunConfigurationQuery.getParameters().getId(), Snapshot.SnapshotType.NEXT_RUN, org.ovirt.engine.core.bll.GetVmNextRunConfigurationQuery.getUserID(), org.ovirt.engine.core.bll.GetVmNextRunConfigurationQuery.getParameters().isFiltered()); if (snapshot != null) { org.ovirt.engine.core.common.businessentities.VM vm = snapshotVmConfigurationHelper.getVmFromConfiguration(snapshot.getVmConfiguration(), snapshot.getVmId(), snapshot.getId()); org.ovirt.engine.core.bll.VmHandler.updateDisksFromDb(vm); org.ovirt.engine.core.bll.VmHandler.updateVmGuestAgentVersion(vm); org.ovirt.engine.core.bll.VmHandler.updateNetworkInterfacesFromDb(vm); org.ovirt.engine.core.bll.GetVmNextRunConfigurationQuery.getQueryReturnValue().setReturnValue(vm); } else { super.executeQueryCommand(); } }
private void updateAddAndSelectHostAvailability(java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VDS> hosts, java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VDS> availableHosts) { org.ovirt.engine.ui.uicommonweb.UICommand addHostAction = new org.ovirt.engine.ui.uicommonweb.UICommand("AddHost", this); addHostAction.setIsExecutionAllowed(((clusters.size()) > 0)); if (hosts.isEmpty()) { addHostAction.setTitle(DataCenterConfigureHostsAction); getCompulsoryActions().add(addHostAction); } else { addHostAction.setTitle(DataCenterAddAnotherHostAction); getOptionalActions().add(addHostAction); } org.ovirt.engine.ui.uicommonweb.UICommand selectHostAction = new org.ovirt.engine.ui.uicommonweb.UICommand("SelectHost", this); selectHostAction.setIsChangeable(((availableHosts.size()) > 0)); selectHostAction.setIsExecutionAllowed(((availableHosts.size()) > 0)); if ((clusters.size()) > 0) { if (hosts.isEmpty()) { selectHostAction.setTitle(DataCenterSelectHostsAction); getCompulsoryActions().add(selectHostAction); } else { selectHostAction.setTitle(DataCenterSelectHostsAction); getOptionalActions().add(selectHostAction); } } }
@org.junit.Test public void canDoActionUpdateWipeAfterDeleteVmUp() { canDoActionUpdateWipeAfterDelete(VMStatus.Up); }
private java.lang.String getToolTip(org.ovirt.engine.ui.frontend.utils.GlusterVolumeUtils.VolumeStatus status) { switch (status) { case DOWN : return constants.down(); case UP : return constants.up(); case SOME_BRICKS_DOWN : return constants.volumeBricksDown(); case ALL_BRICKS_DOWN : return constants.volumeAllBricksDown(); default : return constants.down(); } }
protected boolean isImageExclusiveLockNeeded() { return ((getDiskType()) == (org.ovirt.engine.core.common.businessentities.storage.DiskStorageType.IMAGE)) && ((((org.ovirt.engine.core.common.businessentities.storage.DiskImage) (getDisk())).getVolumeFormat()) != (org.ovirt.engine.core.common.businessentities.storage.VolumeFormat.RAW)); }
public org.ovirt.engine.core.compat.Guid getCpuProfileId() { return cpuProfileId; }
private java.util.List<org.ovirt.engine.core.common.businessentities.storage.DiskImage> getImagesToPreview() { if ((imagesToPreview) == null) { imagesToPreview = ((org.ovirt.engine.core.bll.snapshots.TryBackToAllSnapshotsOfVmCommand.getParameters().getDisks()) != null) ? org.ovirt.engine.core.bll.snapshots.TryBackToAllSnapshotsOfVmCommand.getParameters().getDisks() : diskImageDao.getAllSnapshotsForVmSnapshot(getDstSnapshot().getId()); java.util.List<org.ovirt.engine.core.common.businessentities.storage.CinderDisk> CinderImagesToPreview = org.ovirt.engine.core.bll.storage.disk.image.DisksFilter.filterCinderDisks(imagesToPreview); imagesToPreview = org.ovirt.engine.core.bll.storage.disk.image.DisksFilter.filterImageDisks(imagesToPreview, org.ovirt.engine.core.bll.snapshots.ONLY_NOT_SHAREABLE, org.ovirt.engine.core.bll.snapshots.ONLY_SNAPABLE); imagesToPreview.addAll(CinderImagesToPreview); } return imagesToPreview; }
@org.junit.Test public void testGetFileFromString_Happy() { java.io.File file = new java.io.File("/etc"); java.io.File testFile = org.ovirt.engine.core.utils.ServletUtils.makeFileFromSanePath("hosts", file); assertEquals("new file should be same as old file", new java.io.File("/etc/hosts"), testFile); }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.VmTemplate> getAll(org.ovirt.engine.core.compat.Guid userID, boolean isFiltered, org.ovirt.engine.core.common.businessentities.VmEntityType entityType) { return getCallsHandler().executeReadList("GetAllFromVmTemplates", org.ovirt.engine.core.dao.VmTemplateDaoImpl.VMTemplateRowMapper.instance, getCustomMapSqlParameterSource().addValue("entity_type", entityType.name()).addValue("user_id", userID).addValue("is_filtered", isFiltered)); }
private void handleNotLoggedInEvent(final java.lang.String errorMessage) { if ((errorMessage != null) && (errorMessage.equals("USER_IS_NOT_LOGGED_IN"))) { frontendNotLoggedInEvent.raise(org.ovirt.engine.ui.frontend.Frontend.class, EventArgs.EMPTY); } }
@java.lang.Override protected org.ovirt.engine.core.common.utils.ToStringBuilder appendAttributes(org.ovirt.engine.core.common.utils.ToStringBuilder tsb) { return super.appendAttributes(tsb).append("path", ovaPath); }
@org.junit.Test public void testFindMappingEntryEmptyInput() { org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface vnic = new org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface(); org.ovirt.engine.core.bll.exportimport.vnics.MapVnicsContext ctx = new org.ovirt.engine.core.bll.exportimport.vnics.MapVnicsContext(); ctx.setUserMappings(java.util.Collections.emptyList()); ctx.setOvfVnics(java.util.Collections.singletonList(vnic)); underTest.handle(ctx); assertEquals(1, ctx.getMatched().size()); assertEquals(null, ctx.getMatched().get(vnic)); }
private void isModelCompatibleWithOsTest(org.hamcrest.Matcher<org.ovirt.engine.core.bll.ValidationResult> matcher, org.ovirt.engine.core.common.businessentities.VmWatchdogType watchDogModel) { org.ovirt.engine.core.compat.Version version = new org.ovirt.engine.core.compat.Version(); org.ovirt.engine.core.common.businessentities.VmWatchdog vmWatchdog = new org.ovirt.engine.core.common.businessentities.VmWatchdog(); vmWatchdog.setModel(watchDogModel); org.ovirt.engine.core.bll.validator.VmWatchdogValidator validator = spy(new org.ovirt.engine.core.bll.validator.VmWatchdogValidator(0, vmWatchdog, version)); org.ovirt.engine.core.common.osinfo.OsRepository osRepository = mock(org.ovirt.engine.core.common.osinfo.OsRepository.class); when(validator.getOsRepository()).thenReturn(osRepository); when(osRepository.getVmWatchdogTypes(any(java.lang.Integer.class), any(org.ovirt.engine.core.compat.Version.class))).thenReturn(org.ovirt.engine.core.bll.validator.VmWatchdogValidatorTest.WATCHDOG_MODELS); assertThat(validator.isModelCompatibleWithOs(), matcher); }
protected java.util.List<org.ovirt.engine.core.common.businessentities.VmNetworkInterface> getVmInterfaces() { if ((_vmInterfaces) == null) { java.util.List<org.ovirt.engine.core.common.businessentities.VmNetworkInterface> vmNetworkInterfaces = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVmNetworkInterfaceDAO().getAllForTemplate(org.ovirt.engine.core.bll.AddVmCommand.getVmTemplate().getId()); _vmInterfaces = (vmNetworkInterfaces != null) ? vmNetworkInterfaces : new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VmNetworkInterface>(); } return _vmInterfaces; }
@java.lang.SuppressWarnings("rawtypes") @java.lang.Override public org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc diskReplicateStart(java.lang.String vmUUID, java.util.Map srcDisk, java.util.Map dstDisk) { org.ovirt.vdsm.jsonrpc.client.JsonRpcRequest request = new org.ovirt.vdsm.jsonrpc.client.RequestBuilder("VM.diskReplicateStart").withParameter("vmID", vmUUID).withParameter("srcDisk", srcDisk).withParameter("dstDisk", dstDisk).build(); java.util.Map<java.lang.String, java.lang.Object> response = new org.ovirt.engine.core.vdsbroker.jsonrpc.FutureMap(this.client, request); return new org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc(response); }
private boolean validateBondSlavesCount() { boolean returnValue = true; for (java.util.Map.Entry<java.lang.String, java.util.List<org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface>> bondEntry : bonds.entrySet()) { if ((bondEntry.getValue().size()) < 2) { returnValue = false; addViolation(EngineMessage.NETWORK_BONDS_INVALID_SLAVE_COUNT, bondEntry.getKey()); } } return returnValue; }
private static org.ovirt.engine.core.common.businessentities.VDSGroup cloneVDSGroup(org.ovirt.engine.core.common.businessentities.VDSGroup instance) { org.ovirt.engine.core.common.businessentities.VDSGroup obj = new org.ovirt.engine.core.common.businessentities.VDSGroup(); obj.setId(instance.getId()); obj.setName(instance.getName()); obj.setdescription(instance.getdescription()); obj.setComment(instance.getComment()); obj.setcpu_name(instance.getcpu_name()); obj.setcompatibility_version(instance.getcompatibility_version()); obj.setMigrateOnError(instance.getMigrateOnError()); obj.setTransparentHugepages(instance.getTransparentHugepages()); obj.setStoragePoolId(instance.getStoragePoolId()); obj.setmax_vds_memory_over_commit(instance.getmax_vds_memory_over_commit()); obj.setCountThreadsAsCores(instance.getCountThreadsAsCores()); obj.setEmulatedMachine(instance.getEmulatedMachine()); obj.setDetectEmulatedMachine(instance.isDetectEmulatedMachine()); obj.setArchitecture(instance.getArchitecture()); return obj; }
@java.lang.Override protected void executeIrsBrokerCommand() { org.ovirt.engine.core.vdsbroker.irsbroker.SPMGetVolumeInfoVDSCommand.log.info("Executing GetVolumeInfo using the current SPM"); org.ovirt.engine.core.common.vdscommands.GetVolumeInfoVDSCommandParameters params = new org.ovirt.engine.core.common.vdscommands.GetVolumeInfoVDSCommandParameters(org.ovirt.engine.core.vdsbroker.irsbroker.SPMGetVolumeInfoVDSCommand.getCurrentIrsProxyData().getCurrentVdsId(), org.ovirt.engine.core.vdsbroker.irsbroker.SPMGetVolumeInfoVDSCommand.getParameters().getStoragePoolId(), org.ovirt.engine.core.vdsbroker.irsbroker.SPMGetVolumeInfoVDSCommand.getParameters().getStorageDomainId(), org.ovirt.engine.core.vdsbroker.irsbroker.SPMGetVolumeInfoVDSCommand.getParameters().getImageGroupId(), org.ovirt.engine.core.vdsbroker.irsbroker.SPMGetVolumeInfoVDSCommand.getParameters().getImageId()); params.setExpectedEngineErrors(org.ovirt.engine.core.vdsbroker.irsbroker.SPMGetVolumeInfoVDSCommand.getParameters().getExpectedEngineErrors()); setVDSReturnValue(resourceManager.runVdsCommand(VDSCommandType.GetVolumeInfo, params)); }
@org.junit.Test public void testGetPluggedForMac() throws java.lang.Exception { java.util.List<org.ovirt.engine.core.common.businessentities.network.VmNic> result = dao.getPluggedForMac(FixturesTool.MAC_ADDRESS); for (org.ovirt.engine.core.common.businessentities.network.VmNic vmNetworkInterface : result) { assertEquals(FixturesTool.MAC_ADDRESS, vmNetworkInterface.getMacAddress()); } }
private static byte[] getContent(byte[] array, java.lang.String[] message, int lineNumber) { java.lang.StringBuilder builder = new java.lang.StringBuilder(); for (int i = 0; i < lineNumber; i++) { builder.append(message[i]); builder.append("\n"); } return java.util.Arrays.copyOfRange(array, builder.toString().getBytes(org.ovirt.vdsm.jsonrpc.client.reactors.stomp.impl.UTF8).length, array.length); }
public void init(org.ovirt.engine.core.common.businessentities.network.NetworkQoS qos) { if (qos == null) { networkQoS = new org.ovirt.engine.core.common.businessentities.network.NetworkQoS(); } else { networkQoS = qos; } if ((((networkQoS.getInboundAverage()) == null) || ((networkQoS.getInboundPeak()) == null)) || ((networkQoS.getInboundBurst()) == null)) { getInbound().getEnabled().setEntity(false); } else { getInbound().getAverage().setEntity(networkQoS.getInboundAverage()); getInbound().getPeak().setEntity(networkQoS.getInboundPeak()); getInbound().getBurst().setEntity(networkQoS.getInboundBurst()); } if ((((networkQoS.getOutboundAverage()) == null) || ((networkQoS.getOutboundPeak()) == null)) || ((networkQoS.getOutboundBurst()) == null)) { getOutbound().getEnabled().setEntity(false); } else { getOutbound().getAverage().setEntity(networkQoS.getOutboundAverage()); getOutbound().getPeak().setEntity(networkQoS.getOutboundPeak()); getOutbound().getBurst().setEntity(networkQoS.getOutboundBurst()); } }
@org.ovirt.engine.ui.common.Template("<i>Any valid libvirt URI format is allowed for KVM URI. <br />" + (((("Examples: <br />" + "qemu+tcp://&lthostname&gt/system <br />") + "qemu+ssh://root@&lthostname&gt/path <br />") + "Where '&lthostname&gt' is the host of the hypervisor. <br /> <br />") + "Please see libvirt documentation for more information on libvirt URI formats and authentication.</i>")) com.google.gwt.safehtml.shared.SafeHtml kvmUriInfo();
private void updateAlerts(final org.ovirt.engine.ui.webadmin.section.main.presenter.tab.host.SubTabHostGeneralPresenter.ViewDef view, final org.ovirt.engine.ui.uicommonweb.models.hosts.HostGeneralModel model) { view.clearAlerts(); if (model.getHasUpgradeAlert()) { addTextAlert(view, messages.hostHasUpgradeAlert()); } if (model.getHasReinstallAlertNonResponsive()) { addTextAlert(view, messages.hostHasReinstallAlertNonResponsive()); } if (model.getHasNICsAlert()) { addTextAndLinkAlert(view, messages.hostHasNICsAlert(), model.getSaveNICsConfigCommand()); } if (model.getHasManualFenceAlert()) { addTextAlert(view, messages.hostHasManualFenceAlert()); } if (((org.ovirt.engine.ui.uicommonweb.models.ApplicationModeHelper.getUiMode()) != (org.ovirt.engine.core.common.mode.ApplicationMode.GlusterOnly)) && (model.getHasNoPowerManagementAlert())) { addTextAndLinkAlert(view, messages.hostHasNoPowerManagementAlert(), model.getEditHostCommand()); } if ((model.getNonOperationalReasonEntity()) != null) { addTextAlert(view, org.ovirt.engine.ui.uicompat.EnumTranslator.getInstance().get(model.getNonOperationalReasonEntity())); } }
private void addSpecParamsColumn() { final org.ovirt.engine.ui.common.widget.table.column.AbstractTextColumn<org.ovirt.engine.ui.uicommonweb.models.vms.VmDeviceFeEntity> specParamsColumn = new org.ovirt.engine.ui.common.widget.table.column.AbstractTextColumn<org.ovirt.engine.ui.uicommonweb.models.vms.VmDeviceFeEntity>() { @java.lang.Override public java.lang.String getValue(org.ovirt.engine.ui.uicommonweb.models.vms.VmDeviceFeEntity deviceEntity) { return deviceEntity.getVmDevice().getSpecParams().toString(); } }; specParamsColumn.makeSortable(); getTable().addColumn(specParamsColumn, org.ovirt.engine.ui.common.widget.uicommon.vm.VmDevicesListModelTable.constants.deviceSpecParamsAlias(), "300px"); }
public abstract java.util.Map<java.lang.String, java.lang.Integer> getVideoDeviceSettings(org.ovirt.engine.core.common.businessentities.VmBase vmBase);
@java.lang.Override public void setEnabled(boolean enabled) { this.enabled = enabled; createEditButton.setEnabled(enabled); attachButton.setEnabled(enabled); }
public org.ovirt.engine.core.bll.ValidationResult vmNotHavingDeviceSnapshotsAttachedToOtherVms(boolean onlyPlugged) { java.util.List<org.ovirt.engine.core.common.businessentities.storage.Disk> vmDisks = getDbFacade().getDiskDao().getAllForVm(vm.getId()); org.ovirt.engine.core.bll.ValidationResult result = new org.ovirt.engine.core.bll.validator.storage.DiskImagesValidator(org.ovirt.engine.core.bll.storage.disk.image.DisksFilter.filterImageDisks(vmDisks, org.ovirt.engine.core.bll.validator.ONLY_NOT_SHAREABLE, org.ovirt.engine.core.bll.validator.ONLY_ACTIVE)).diskImagesSnapshotsNotAttachedToOtherVms(onlyPlugged); if (result != (org.ovirt.engine.core.bll.ValidationResult.VALID)) { return result; } return org.ovirt.engine.core.bll.ValidationResult.VALID; }
@java.lang.Override protected boolean canDoAction() { boolean retValue = true; step = getStepDao().get(org.ovirt.engine.core.bll.EndExternalStepCommand.getParameters().getId()); if ((step) == null) { retValue = false; addCanDoActionMessage(EngineMessage.ACTION_TYPE_NO_STEP); } else if (!(step.isExternal())) { retValue = false; addCanDoActionMessage(EngineMessage.ACTION_TYPE_NOT_EXTERNAL); } else { job = getJobDao().get(step.getJobId()); if ((job) == null) { retValue = false; addCanDoActionMessage(EngineMessage.ACTION_TYPE_NO_JOB); } if (!retValue) { addCanDoActionMessage(EngineMessage.VAR__ACTION__END); addCanDoActionMessage(EngineMessage.VAR__TYPE__EXTERNAL_STEP); } } return retValue; }
private void doDrag(com.google.gwt.event.dom.client.DragDropEventBase<?> event, boolean isDrop) { java.lang.String dragDropEventData = org.ovirt.engine.ui.webadmin.section.main.view.popup.host.panels.NetworkItemPanel.getDragDropEventData(event, isDrop); java.lang.String type = org.ovirt.engine.ui.webadmin.section.main.view.popup.host.panels.NetworkItemPanel.getType(dragDropEventData); java.lang.String data = org.ovirt.engine.ui.webadmin.section.main.view.popup.host.panels.NetworkItemPanel.getData(dragDropEventData); if (data != null) { if (setupModel.candidateOperation(data, type, null, null, isDrop)) { animatedPanel.getElement().addClassName(style.networkGroupDragOver()); event.preventDefault(); } } }
protected boolean canAddVm(java.util.ArrayList<java.lang.String> reasons, java.util.Collection<org.ovirt.engine.core.common.businessentities.StorageDomain> destStorages) { org.ovirt.engine.core.common.businessentities.VmStatic vmStaticFromParams = org.ovirt.engine.core.bll.AddVmCommand.getParameters().getVmStaticData(); if (!(canAddVm(reasons, vmStaticFromParams.getName(), org.ovirt.engine.core.bll.AddVmCommand.getStoragePoolId(), vmStaticFromParams.getPriority()))) { return false; } if (!(validateCustomProperties(vmStaticFromParams, reasons))) { return false; } if (shouldCheckSpaceInStorageDomains()) { if (!(org.ovirt.engine.core.bll.AddVmCommand.getStoragePoolId().equals(getStoragePoolIdFromSourceImageContainer()))) { reasons.add(VdcBllMessages.ACTION_TYPE_FAILED_STORAGE_POOL_NOT_MATCH.toString()); return false; } for (org.ovirt.engine.core.common.businessentities.StorageDomain domain : destStorages) { org.ovirt.engine.core.bll.validator.storage.StorageDomainValidator storageDomainValidator = new org.ovirt.engine.core.bll.validator.storage.StorageDomainValidator(domain); if (!(validate(storageDomainValidator.isDomainExistAndActive()))) { return false; } } if (!(validateSpaceRequirements())) { return false; } } return org.ovirt.engine.core.bll.VmHandler.validateDedicatedVdsExistOnSameCluster(vmStaticFromParams, org.ovirt.engine.core.bll.AddVmCommand.getReturnValue().getCanDoActionMessages()); }
@org.junit.experimental.theories.Theory public void updateRepository_MIGRATION_FROM(org.ovirt.engine.core.vdsbroker.monitoring.VmTestPairs data) { initMocks(data, true); assumeNotNull(data.dbVm(), data.vdsmVm()); assumeTrue(((data.vdsmVm().getVmDynamic().getStatus()) == (org.ovirt.engine.core.common.businessentities.VMStatus.MigratingFrom))); verify(resourceManager, never()).internalSetVmStatus(data.dbVm().getDynamicData(), VMStatus.MigratingTo); }
@java.lang.Override public int hashCode() { final int prime = 31; int result = 1; result = (prime * result) + ((addr) == null ? 0 : addr.hashCode()); result = (prime * result) + ((description) == null ? 0 : description.hashCode()); result = (prime * result) + ((gateway) == null ? 0 : gateway.hashCode()); result = (prime * result) + ((id) == null ? 0 : id.hashCode()); result = (prime * result) + ((name) == null ? 0 : name.hashCode()); result = (prime * result) + ((dataCenterId) == null ? 0 : dataCenterId.hashCode()); result = (prime * result) + (stp ? 1231 : 1237); result = (prime * result) + ((subnet) == null ? 0 : subnet.hashCode()); result = (prime * result) + ((type) == null ? 0 : type.hashCode()); result = (prime * result) + ((vlanId) == null ? 0 : vlanId.hashCode()); result = (prime * result) + (mtu); result = (prime * result) + (vmNetwork ? 11 : 13); result = (prime * result) + ((providedBy) == null ? 0 : providedBy.hashCode()); result = (prime * result) + ((label) == null ? 0 : label.hashCode()); result = (prime * result) + ((qosId) == null ? 0 : qosId.hashCode()); return result; }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("There is no active Storage Domain to create the Disk in. Please activate a Storage Domain.") java.lang.String thereIsNoActiveStorageDomainCreateDiskInMsg();
public org.ovirt.engine.api.model.Network lookupNetwork(org.ovirt.engine.core.compat.Guid id) { return lookupNetwork(id, null); }
public org.ovirt.engine.ui.uicommonweb.models.vms.VmInitModel getVmInitModel() { return vmInitModel; }
private boolean isUpdateRequired(org.ovirt.vdsmfake.domain.VM.VMStatus status) { switch (status) { case Up : case PoweringDown : case Paused : return true; default : return false; } }
@org.junit.Test public void allValuesPresent() { qos.setInboundAverage(org.ovirt.engine.core.bll.validator.NetworkQosValidatorTest.BANDWIDTH_MEDIUM); qos.setInboundPeak(org.ovirt.engine.core.bll.validator.NetworkQosValidatorTest.BANDWIDTH_MEDIUM); qos.setInboundBurst(org.ovirt.engine.core.bll.validator.NetworkQosValidatorTest.BANDWIDTH_MEDIUM); qos.setOutboundAverage(org.ovirt.engine.core.bll.validator.NetworkQosValidatorTest.BANDWIDTH_MEDIUM); qos.setOutboundPeak(org.ovirt.engine.core.bll.validator.NetworkQosValidatorTest.BANDWIDTH_MEDIUM); qos.setOutboundBurst(org.ovirt.engine.core.bll.validator.NetworkQosValidatorTest.BANDWIDTH_MEDIUM); valuesPresentTest(org.ovirt.engine.core.bll.validator.ValidationResultMatchers.isValid()); }
protected void removeFromExternalNetworks(java.util.List<org.ovirt.engine.core.common.businessentities.network.VmNic> interfaces) { javax.transaction.Transaction transaction = org.ovirt.engine.core.utils.transaction.TransactionSupport.suspend(); for (org.ovirt.engine.core.common.businessentities.network.VmNic iface : interfaces) { getExternalNetworkManagerFactory().create(iface).deallocateIfExternal(); } org.ovirt.engine.core.utils.transaction.TransactionSupport.resume(transaction); }
public static org.ovirt.engine.core.common.businessentities.VmDeviceGeneralType forValue(org.ovirt.engine.core.common.utils.VmDeviceType value) { org.ovirt.engine.core.common.businessentities.VmDeviceGeneralType type; switch (value) { case DISK : case CDROM : case FLOPPY : type = org.ovirt.engine.core.common.businessentities.VmDeviceGeneralType.DISK; break; case INTERFACE : case BRIDGE : type = org.ovirt.engine.core.common.businessentities.VmDeviceGeneralType.INTERFACE; break; case VIDEO : case CIRRUS : case QXL : type = org.ovirt.engine.core.common.businessentities.VmDeviceGeneralType.VIDEO; break; case SOUND : case AC97 : case ICH6 : type = org.ovirt.engine.core.common.businessentities.VmDeviceGeneralType.SOUND; break; case CONTROLLER : case USB : type = org.ovirt.engine.core.common.businessentities.VmDeviceGeneralType.CONTROLLER; break; case BALLOON : case MEMBALLOON : type = org.ovirt.engine.core.common.businessentities.VmDeviceGeneralType.BALLOON; break; case REDIR : case SPICEVMC : type = org.ovirt.engine.core.common.businessentities.VmDeviceGeneralType.REDIR; break; case CHANNEL : type = org.ovirt.engine.core.common.businessentities.VmDeviceGeneralType.CHANNEL; break; case SMARTCARD : type = org.ovirt.engine.core.common.businessentities.VmDeviceGeneralType.SMARTCARD; break; case WATCHDOG : type = org.ovirt.engine.core.common.businessentities.VmDeviceGeneralType.WATCHDOG; break; default : type = org.ovirt.engine.core.common.businessentities.VmDeviceGeneralType.forValue(value.getName()); break; } return type; }
java.lang.String AFFINITY_LABEL_BAD_NAME();
@java.lang.Override public com.google.gwt.resources.client.ImageResource getValue(org.ovirt.engine.ui.uicommonweb.models.userportal.UserPortalItemModel item) { switch (item.getStatus()) { case Up : org.ovirt.engine.core.common.businessentities.VM vm = item.getVM(); if (vm == null) { return getApplicationResources().vmStatusRunning(); } if (vm.isRunOnce()) { return getApplicationResources().runOnceUpImage(); } else { return getApplicationResources().vmStatusRunning(); } case MigratingFrom : case MigratingTo : return getApplicationResources().migrationImage(); case WaitForLaunch : case ImageLocked : case PreparingForHibernate : case SavingState : return getApplicationResources().vmStatusWaiting(); case PoweringUp : case RebootInProgress : case RestoringState : return getApplicationResources().vmStatusStarting(); case Paused : return getApplicationResources().frozenImage(); case Suspended : return getApplicationResources().vmStatusPaused(); case NotResponding : case Unknown : return getApplicationResources().vmStatusUnknown(); case Unassigned : case ImageIllegal : case Down : case PoweredDown : return getApplicationResources().vmStatusStopped(); case PoweringDown : return getApplicationResources().vmStatusStopping(); default : return getApplicationResources().vmStatusUnknown(); } }
@java.lang.Override public org.ovirt.engine.api.model.Tag update(org.ovirt.engine.api.model.Tag incoming) { if (parent.isSetParentName(incoming)) { incoming.getParent().getTag().setId(parent.getParentId(incoming)); } org.ovirt.engine.api.model.Tag existingTag = get(); java.lang.String existingTagParentId = (((existingTag.isSetParent()) && (existingTag.getParent().isSetTag())) && (existingTag.getParent().getTag().isSetId())) ? existingTag.getParent().getTag().getId() : null; if ((isSetParent(incoming)) && (!(incoming.getParent().getTag().getId().equals(existingTagParentId)))) { moveTag(asGuid(incoming.getParent().getTag().getId())); } return performUpdate(incoming, new org.ovirt.engine.api.restapi.resource.QueryIdResolver(org.ovirt.engine.core.common.queries.VdcQueryType.GetTagByTagId, org.ovirt.engine.core.common.queries.GetTagByTagIdParameters.class), VdcActionType.UpdateTag, new org.ovirt.engine.api.restapi.resource.BackendTagResource.UpdateParametersProvider()); }
@org.junit.Test public void testMapNullFromModelToBe() { assertThat(org.ovirt.engine.api.restapi.types.Ipv6BootProtocolMapper.map(((org.ovirt.engine.api.model.BootProtocol) (null))), is(((org.ovirt.engine.core.common.businessentities.network.Ipv6BootProtocol) (null)))); }
@java.lang.Override protected boolean validate() { if ((((org.ovirt.engine.core.bll.RemoveFenceAgentCommand.getParameters()) == null) || ((org.ovirt.engine.core.bll.RemoveFenceAgentCommand.getParameters().getAgent()) == null)) || ((org.ovirt.engine.core.bll.RemoveFenceAgentCommand.getParameters().getAgent().getId()) == null)) { return failValidation(EngineMessage.VDS_REMOVE_FENCE_AGENT_ID_REQUIRED); } org.ovirt.engine.core.common.businessentities.VDS host = org.ovirt.engine.core.bll.RemoveFenceAgentCommand.getVds(); if ((host != null) && (host.isPmEnabled())) { java.util.List<org.ovirt.engine.core.common.businessentities.pm.FenceAgent> fenceAgents = fenceAgentDao.getFenceAgentsForHost(org.ovirt.engine.core.bll.RemoveFenceAgentCommand.getVdsId()); if ((fenceAgents.size()) == 1) { return failValidation(EngineMessage.VDS_REMOVE_LAST_FENCE_AGENT_PM_ENABLED); } } return super.validate(); }
private void storeIpv4(org.ovirt.engine.core.common.businessentities.VmInitNetwork iface, java.lang.StringBuilder output) { storeIp("inet", new org.ovirt.engine.core.utils.network.vm.VmInitNetworkIpv4InfoFetcher(iface), output); }
@java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { java.lang.String propName = ((org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs) (args)).propertyName; if ("raidTypeChanged".equals(propName)) { if (((model.getRaidTypeList().getSelectedItem()) != (org.ovirt.engine.core.common.businessentities.RaidType.None)) && ((model.getRaidTypeList().getSelectedItem()) != (org.ovirt.engine.core.common.businessentities.RaidType.Raid0))) { getView().setDeviceInfoText(model.getRaidTypeList().getSelectedItem().name()); getView().setDeviceInfoVisibility(true); } else { getView().setDeviceInfoVisibility(false); } } }
@java.lang.Override public org.ovirt.engine.core.dal.dbbroker.MapSqlParameterMapper<org.ovirt.engine.core.common.businessentities.VmStatistics> getBatchMapper() { return new org.ovirt.engine.core.dal.dbbroker.MapSqlParameterMapper<org.ovirt.engine.core.common.businessentities.VmStatistics>() { @java.lang.Override public org.springframework.jdbc.core.namedparam.MapSqlParameterSource map(org.ovirt.engine.core.common.businessentities.VmStatistics entity) { org.springframework.jdbc.core.namedparam.MapSqlParameterSource paramValue = new org.springframework.jdbc.core.namedparam.MapSqlParameterSource().addValue("cpu_sys", entity.getcpu_sys()).addValue("cpu_user", entity.getcpu_user()).addValue("elapsed_time", entity.getelapsed_time()).addValue("usage_cpu_percent", entity.getusage_cpu_percent()).addValue("usage_mem_percent", entity.getusage_mem_percent()).addValue("usage_network_percent", entity.getusage_network_percent()).addValue("disks_usage", entity.getDisksUsage()).addValue("vm_guid", entity.getId()); return paramValue; } }; }
private void writeEnumValues(org.ovirt.api.metamodel.concepts.EnumType type) { java.util.Iterator<org.ovirt.api.metamodel.concepts.EnumValue> iterator = type.getValues().iterator(); while (iterator.hasNext()) { org.ovirt.api.metamodel.concepts.EnumValue value = iterator.next(); javaBuffer.addLine(getEnumValueLine(value, (!(iterator.hasNext())))); } javaBuffer.addLine(); }
@java.lang.Override public java.lang.Object put(java.lang.Object key, java.lang.Object value) { java.lang.String stringKey = ((java.lang.String) (key)); boolean found = false; for (java.lang.Class<? extends java.lang.Enum> clazz : classes) { try { java.lang.Enum.valueOf(clazz, stringKey); found = true; break; } catch (java.lang.IllegalArgumentException ignore) { org.ovirt.engine.core.utils.EnumTranslationProperties.log.debug(((stringKey + " is not a key in ") + (clazz.getName()))); } } if (!found) { java.lang.StringBuilder sb = new java.lang.StringBuilder("No translation for key [").append(stringKey).append("] in enums: [").append(classes[0].getName()); for (int i = 1; i < (classes.length); ++i) { sb.append(", ").append(classes[i]); } sb.append(']'); throw new org.ovirt.engine.core.utils.MissingEnumTranslationException(sb.toString()); } return super.put(key, value); }
@java.lang.Override public org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc hostdevChangeNumvfs(java.lang.String deviceName, int numOfVfs) { try { java.util.Map<java.lang.String, java.lang.Object> xmlRpcReturnValue = vdsServer.hostdevChangeNumvfs(deviceName, numOfVfs); return new org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc(xmlRpcReturnValue); } catch (java.lang.reflect.UndeclaredThrowableException ute) { throw new org.ovirt.engine.core.vdsbroker.xmlrpc.XmlRpcRunTimeException(ute); } }
@org.jboss.arquillian.container.test.api.Deployment public static org.jboss.shrinkwrap.api.spec.JavaArchive createDeployment() { return org.jboss.shrinkwrap.api.ShrinkWrap.create(org.jboss.shrinkwrap.api.spec.JavaArchive.class).addClasses(org.ovirt.engine.core.di.Injector.class, org.ovirt.engine.core.bll.scheduling.CommonTestMocks.class, org.ovirt.engine.core.bll.scheduling.SchedulingManager.class, org.ovirt.engine.core.bll.scheduling.external.ExternalSchedulerDiscovery.class, org.ovirt.engine.core.bll.scheduling.BasicMigrationHandler.class).addClasses(org.ovirt.engine.core.bll.scheduling.CommonTestMocks.commonClasses()).addAsManifestResource(EmptyAsset.INSTANCE, org.jboss.shrinkwrap.api.ArchivePaths.create("beans.xml")); }
@org.junit.Test public void validateSpaceNotEnough() throws java.lang.Exception { org.ovirt.engine.core.bll.AddVmCommand<org.ovirt.engine.core.common.action.VmManagementParametersBase> command = setupCanAddVmTests(0, 0); doReturn(ValidationResult.VALID).when(storageDomainValidator).isDomainWithinThresholds(); doReturn(new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.VdcBllMessages.ACTION_TYPE_FAILED_DISK_SPACE_LOW_ON_TARGET_STORAGE_DOMAIN)).when(storageDomainValidator).hasSpaceForNewDisks(anyList()); doReturn(storageDomainValidator).when(command).createStorageDomainValidator(any(org.ovirt.engine.core.common.businessentities.StorageDomain.class)); junit.framework.Assert.assertFalse(command.validateSpaceRequirements()); verify(storageDomainValidator).hasSpaceForNewDisks(anyList()); verify(storageDomainValidator, never()).hasSpaceForClonedDisks(anyList()); }
private void createSnapshotsForDisks(org.ovirt.engine.core.compat.Guid vmSnapshotId) { for (org.ovirt.engine.core.common.businessentities.DiskImage image : getDisksList()) { org.ovirt.engine.core.common.action.VdcReturnValueBase vdcReturnValue = executeChildCommand(image.getImageId()); if (vdcReturnValue.getSucceeded()) { getTaskIdList().addAll(vdcReturnValue.getInternalVdsmTaskIdList()); } else { throw new org.ovirt.engine.core.common.errors.VdcBLLException(vdcReturnValue.getFault().getError(), "Failed to create snapshot!"); } } }
@org.junit.Test public void validatePass() { when(hostedEngineHelper.getStorageDomain()).thenReturn(null); org.ovirt.engine.core.common.businessentities.StorageDomain sd = new org.ovirt.engine.core.common.businessentities.StorageDomain(); int i = new java.util.Random().nextInt(SUPPORTED_DOMAIN_TYPES.length); sd.setStorageType(org.ovirt.engine.core.bll.storage.domain.ImportHostedEngineStorageDomainCommand.SUPPORTED_DOMAIN_TYPES[i]); sd.setStorageName(org.ovirt.engine.core.bll.storage.domain.ImportHostedEngineStorageDomainCommandTest.HOSTED_STORAGE_NAME); doReturn(createQueryReturnValueWith(java.util.Arrays.asList(sd))).when(backend).runInternalQuery(eq(VdcQueryType.GetExistingStorageDomainList), any(org.ovirt.engine.core.common.queries.VdcQueryParametersBase.class)); assertTrue(cmd.validate()); }
@java.lang.Override public boolean isMemBalloonEnabled(org.ovirt.engine.core.compat.Guid vmId) { org.springframework.jdbc.core.namedparam.MapSqlParameterSource parameterSource = getCustomMapSqlParameterSource().addValue("vm_id", vmId); java.util.Map<java.lang.String, java.lang.Object> dbResults = new org.springframework.jdbc.core.simple.SimpleJdbcCall(jdbcTemplate).withFunctionName("isMemBalloonEnabled").execute(parameterSource); java.lang.String resultKey = dialect.getFunctionReturnKey(); return (dbResults.get(resultKey)) != null ? ((java.lang.Boolean) (dbResults.get(resultKey))).booleanValue() : false; }
@java.lang.Override protected void executeVdsBrokerCommand() { org.ovirt.engine.core.vdsbroker.UpdateVmPolicyVDSCommand.getBroker().updateVmPolicy(build()); org.ovirt.engine.core.vdsbroker.UpdateVmPolicyVDSCommand.proceedProxyReturnValue(); }
private static synchronized javax.naming.InitialContext getInitialContext() throws javax.naming.NamingException { if ((org.ovirt.engine.core.utils.ejb.EJBUtilsStrategy.context) == null) { org.ovirt.engine.core.utils.ejb.EJBUtilsStrategy.context = new javax.naming.InitialContext(); } return org.ovirt.engine.core.utils.ejb.EJBUtilsStrategy.context; }
private org.ovirt.engine.core.bll.network.host.HostSetupNetworksValidator createHostSetupNetworksValidator(java.util.List<org.ovirt.engine.core.common.businessentities.network.Network> networks) { return createHostSetupNetworksValidator(networks, new org.ovirt.engine.core.common.action.HostSetupNetworksParameters(host.getId())); }
private void preview() { org.ovirt.engine.core.common.businessentities.VM vm = ((org.ovirt.engine.core.common.businessentities.VM) (getEntity())); if (vm == null) { return; } org.ovirt.engine.core.common.businessentities.Snapshot snapshot = ((org.ovirt.engine.core.common.businessentities.Snapshot) (getSelectedItem())); if ((!(isMemorySnapshotSupported())) || (snapshot.getMemoryVolume().isEmpty())) { org.ovirt.engine.ui.frontend.Frontend.getInstance().runAction(VdcActionType.TryBackToAllSnapshotsOfVm, new org.ovirt.engine.core.common.action.TryBackToAllSnapshotsOfVmParameters(vm.getId(), snapshot.getId()), null); } else { org.ovirt.engine.ui.uicommonweb.models.vms.SnapshotModel model = new org.ovirt.engine.ui.uicommonweb.models.vms.SnapshotModel(); setWindow(model); model.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().previewSnapshotTitle()); model.setHelpTag(HelpTag.preview_snapshot); model.setHashName("preview_snapshot"); addCommands(model, "OnPreview"); } }
@java.lang.Override protected void setActionMessageParameters() { addCanDoActionMessage(VdcBllMessages.VAR__ACTION__UPDATE); addCanDoActionMessage(VdcBllMessages.VAR__TYPE__CLUSTER_POLICY); }
@org.junit.Test public void testHasUniqueNamePersistingNewRecordWithNullIdAndSameName() throws java.lang.Exception { final java.lang.String macPoolName = "macPool1"; assertThat(callHasUniqueName(org.ovirt.engine.core.compat.Guid.newGuid(), null, macPoolName, macPoolName), failsWith(EngineMessage.ACTION_TYPE_FAILED_NAME_ALREADY_USED)); }
public org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc setMaxHosts(int maxHosts) { java.util.Map<java.lang.String, java.lang.Object> xmlRpcReturnValue = irsServer.setMaxHosts(maxHosts); org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc wrapper = new org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc(xmlRpcReturnValue); return wrapper; }
@org.junit.Test public void testGetEntityNameByIdAndTypeForRole() { org.ovirt.engine.core.common.businessentities.Role role = dbFacade.getRoleDAO().get(org.ovirt.engine.core.dao.DbFacadeDAOTest.ROLE_ID); assertNotNull(role); java.lang.String name = role.getname(); assertTrue(name.equals(dbFacade.getEntityNameByIdAndType(org.ovirt.engine.core.dao.DbFacadeDAOTest.ROLE_ID, VdcObjectType.Role))); }
protected org.ovirt.engine.core.compat.Guid removeMemoryImage(java.util.List<org.ovirt.engine.core.compat.Guid> guids) { return removeImage(VmCommand.DELETE_PRIMARY_IMAGE_TASK_KEY, buildDeleteMemoryImageParams(guids)); }
@java.lang.Override protected boolean canDoAction() { org.ovirt.engine.core.common.businessentities.storage.Disk disk = org.ovirt.engine.core.bll.CopyImageGroupCommand.getDiskDao().get(org.ovirt.engine.core.bll.CopyImageGroupCommand.getParameters().getImageGroupID()); if (disk != null) { org.ovirt.engine.core.bll.validator.storage.DiskValidator diskValidator = new org.ovirt.engine.core.bll.validator.storage.DiskValidator(disk); return validate(diskValidator.validateUnsupportedDiskStorageType(DiskStorageType.LUN, DiskStorageType.CINDER)); } return false; }
@org.junit.Before public void setUp() throws java.lang.Exception { setUpMockQueryParameters(); setUpSpyQuery(); for (org.ovirt.engine.core.bll.MockConfigDescriptor<?> mcd : getExtraConfigDescriptors()) { org.ovirt.engine.core.bll.AbstractQueryTest.mcr.mockConfigValue(mcd); } }
protected byte[] runHttpMethod(org.ovirt.engine.core.bll.provider.BaseProviderProxy.HttpMethodType httpMethod, java.lang.String contentType, java.lang.String relativeUrl, java.lang.String body, java.net.HttpURLConnection connection) { byte[] result = null; try { connection.setRequestProperty("Content-Type", contentType); connection.setDoInput(true); connection.setDoOutput((httpMethod != (org.ovirt.engine.core.bll.provider.BaseProviderProxy.HttpMethodType.GET))); connection.setRequestMethod(httpMethod.toString()); if (body != null) { byte[] bytes = body.getBytes(java.nio.charset.Charset.forName("UTF-8")); connection.setRequestProperty("Content-Length", new java.lang.StringBuilder().append(bytes.length).toString()); try (java.io.OutputStream outputStream = connection.getOutputStream()) { outputStream.write(bytes); } } result = getResponse(connection); } catch (javax.net.ssl.SSLException e) { throw new org.ovirt.engine.core.common.errors.EngineException(org.ovirt.engine.core.common.errors.EngineError.PROVIDER_SSL_FAILURE, e.getMessage()); } catch (java.io.IOException e) { org.ovirt.engine.core.bll.provider.BaseProviderProxy.handleException(e); } finally { if (connection != null) { connection.disconnect(); } } return result; }
@java.lang.Override protected void EndSuccessfully() { org.ovirt.engine.core.bll.TryBackToAllSnapshotsOfVmCommand.EndActionOnDisks(); if ((org.ovirt.engine.core.bll.TryBackToAllSnapshotsOfVmCommand.getVm()) != null) { org.ovirt.engine.core.bll.VmHandler.unlockVm(org.ovirt.engine.core.bll.TryBackToAllSnapshotsOfVmCommand.getVm().getDynamicData(), org.ovirt.engine.core.bll.TryBackToAllSnapshotsOfVmCommand.getCompensationContext()); restoreVmConfigFromSnapshot(); } else { org.ovirt.engine.core.bll.TryBackToAllSnapshotsOfVmCommand.setCommandShouldBeLogged(false); log.warn("VmCommand::EndVmCommand: Vm is null - not performing EndAction on Vm"); } org.ovirt.engine.core.bll.TryBackToAllSnapshotsOfVmCommand.setSucceeded(true); }
@java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.EventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { super.eventRaised(ev, sender, args); entityModel.eventRaised(ev, sender, args); if (ev.matchesDefinition(RegistrationResult.RetrievedEventDefinition)) { asyncResult_Retrieved(); } if (ev.matchesDefinition(ProvideTickEvent.definition)) { syncSearch(); } }
@org.junit.Test public void testValidateNetworkExclusiveOnNicAtMostOneNonVmNetwork() throws java.lang.Exception { checkVmNetworkIsSoleAssignedInterface(org.ovirt.engine.core.bll.validator.ValidationResultMatchers.isValid(), vlanNetwork, nonVmNetwork1); }
@org.junit.Test public void removeAll() { java.util.List<org.ovirt.engine.core.common.businessentities.VmNetworkInterface> interfaces = java.util.Arrays.asList(createNewInterface(), createNewInterface()); when(vmNetworkInterfaceDAO.getAllForVm(any(org.ovirt.engine.core.compat.Guid.class))).thenReturn(interfaces); vmInterfaceManager.removeAll(org.ovirt.engine.core.compat.Guid.NewGuid()); for (org.ovirt.engine.core.common.businessentities.VmNetworkInterface iface : interfaces) { verifyRemoveAllDelegatedCorrectly(iface); } }
@java.lang.Override protected void setActionMessageParameters() { super.setActionMessageParameters(); addValidationMessage(EngineMessage.VAR__ACTION__START); }
protected boolean isAdminUser() { return org.ovirt.engine.core.bll.MultiLevelAdministrationHandler.isAdminUser(org.ovirt.engine.core.bll.GetAllRolesQuery.getUser()); }
@java.lang.Override public void onValueChange(com.google.gwt.event.logical.shared.ValueChangeEvent<java.lang.Boolean> event) { selectSpiceImplementation(SpiceConsoleModel.ClientConsoleMode.Auto); }
@java.lang.Override protected boolean isGhost(org.ovirt.engine.ui.uicommonweb.models.EntityModel<java.lang.String> value) { return org.ovirt.engine.ui.uicompat.external.StringUtils.isEmpty(value.getEntity()); }
@java.lang.Override protected void verify(org.ovirt.engine.api.model.VmPool model, org.ovirt.engine.api.model.VmPool transform) { assertNotNull(transform); assertEquals(model.getId(), transform.getId()); assertEquals(model.getName(), transform.getName()); assertEquals(model.getDescription(), transform.getDescription()); assertEquals(model.getSize(), transform.getSize()); assertNotNull(transform.getCluster()); assertEquals(model.getCluster().getId(), transform.getCluster().getId()); assertEquals(model.getMaxUserVms(), transform.getMaxUserVms()); }
@java.lang.Override protected boolean validate() { org.ovirt.engine.core.bll.validator.VnicProfileValidator validator = org.ovirt.engine.core.bll.network.vm.AddVnicProfileCommand.createVnicProfileValidator(); boolean useDefaultNetworkFilterId = org.ovirt.engine.core.bll.network.vm.AddVnicProfileCommand.getParameters().isUseDefaultNetworkFiterId(); return (((((((((validate(validator.vnicProfileIsSet())) && (validate(validator.networkExists()))) && (validate(validator.networkQosExistsOrNull()))) && (validate(validator.vnicProfileForVmNetworkOnly()))) && (validate(validator.vnicProfileNameNotUsed()))) && (validate(validator.portMirroringNotSetIfExternalNetwork()))) && (validator.validateCustomProperties(org.ovirt.engine.core.bll.network.vm.AddVnicProfileCommand.getReturnValue().getValidationMessages()))) && (validate(validator.passthroughProfileContainsSupportedProperties()))) && (validate(validator.validUseDefaultNetworkFilterFlag(useDefaultNetworkFilterId)))) && (validate(validator.validNetworkFilterId())); }
private void setCustomProperties(java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.businessentities.network.NetworkAttachment> attachmentsByNetworkId, java.util.Map<java.lang.String, org.ovirt.engine.core.compat.Guid> networkNameToNetworkIdMap, org.ovirt.engine.api.model.HostNIC hostNic) { org.ovirt.engine.api.model.Network network = hostNic.getNetwork(); if (network == null) { return; } java.lang.String networkName = network.getName(); org.ovirt.engine.core.common.businessentities.network.NetworkAttachment networkAttachment = attachmentsByNetworkId.get(networkNameToNetworkIdMap.get(networkName)); if (networkAttachment == null) { return; } java.util.Map<java.lang.String, java.lang.String> properties = networkAttachment.getProperties(); if (properties != null) { hostNic.setProperties(org.ovirt.engine.api.restapi.utils.CustomPropertiesParser.fromMap(properties)); } }
@java.lang.Override public void init(javax.servlet.ServletConfig config) throws javax.servlet.ServletException { super.init(config); type = config.getInitParameter(org.ovirt.engine.core.FileServlet.TYPE); final java.lang.String name = config.getInitParameter(org.ovirt.engine.core.FileServlet.FILE); if (name == null) { final java.lang.String message = ("Can\'t get base name from parameter \"" + (org.ovirt.engine.core.FileServlet.FILE)) + "\"."; org.ovirt.engine.core.FileServlet.log.error(message); throw new javax.servlet.ServletException(message); } base = new java.io.File(org.ovirt.engine.core.utils.EngineLocalConfig.getInstance().expandString(name)); }
@java.lang.Override public void init(final org.ovirt.engine.ui.uicommonweb.models.gluster.CreateBrickModel model) { super.init(model); model.getPropertyChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { java.lang.String propName = ((org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs) (args)).propertyName; if ("raidTypeChanged".equals(propName)) { if (((model.getRaidTypeList().getSelectedItem()) != (org.ovirt.engine.core.common.businessentities.RaidType.None)) && ((model.getRaidTypeList().getSelectedItem()) != (org.ovirt.engine.core.common.businessentities.RaidType.Raid0))) { getView().setDeviceInfoText(model.getRaidTypeList().getSelectedItem().name()); getView().setDeviceInfoVisibility(true); } else { getView().setDeviceInfoVisibility(false); } } } }); }
@org.junit.Before public void setup() { mockVmPropertiesUtils(); mockIsoDomainListSyncronizer(); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Change CD") java.lang.String changeCDTitle();
protected void setIconAndFireChangeEvent(java.lang.String icon) { final org.ovirt.engine.ui.uicommonweb.models.vms.IconWithOsDefault oldPair = getValue(); setIcon(icon); smallIconId = null; final org.ovirt.engine.ui.uicommonweb.models.vms.IconWithOsDefault newPair = getValue(); com.google.gwt.event.logical.shared.ValueChangeEvent.fireIfNotEqual(this, oldPair, newPair); }
@org.junit.Test public void searchUsingTags() { assertEquals(expected, new org.ovirt.engine.core.searchbackend.SyntaxChecker().analyzeSyntaxState(input, false).isSearchUsingTags()); }
com.google.gwt.user.client.ui.Grid createRow(final org.ovirt.engine.ui.uicommonweb.models.hosts.HostVLan hostVLan) { com.google.gwt.user.client.ui.HorizontalPanel checkboxPanel = new com.google.gwt.user.client.ui.HorizontalPanel(); checkboxPanel.setWidth("100%"); if (isSelectionAvailable) { checkboxPanel.add(getCheckBox()); } checkboxPanel.add(new com.google.gwt.user.client.ui.Image(org.ovirt.engine.ui.webadmin.widget.host.VLanElementPanel.resources.splitRotateImage())); checkboxPanel.add(new com.google.gwt.user.client.ui.Label(new org.ovirt.engine.ui.webadmin.widget.renderer.HostVLanNameRenderer().render(hostVLan))); com.google.gwt.user.client.ui.Grid row = createBaseVlanRow(checkboxPanel, hostVLan.getInterface().getIsManagement(), hostVLan.getNetworkName(), hostVLan.getAddress()); com.google.gwt.dom.client.Style gridStyle = row.getElement().getStyle(); gridStyle.setBorderColor("white"); gridStyle.setBorderWidth(1, Unit.PX); gridStyle.setBorderStyle(BorderStyle.SOLID); return row; }
private static java.util.Properties loadPropertiesFromFile(java.lang.String filename) { try (java.io.FileReader reader = new java.io.FileReader(new java.io.File(filename))) { java.util.Properties p = new java.util.Properties(); p.load(reader); org.ovirt.engine.extension.aaa.jdbc.binding.cli.Cli.LOG.trace("read properties from {}:", filename); for (java.util.Map.Entry<java.lang.Object, java.lang.Object> e : p.entrySet()) { org.ovirt.engine.extension.aaa.jdbc.binding.cli.Cli.LOG.trace("{}=>{}", e.getKey(), (org.ovirt.engine.extension.aaa.jdbc.binding.cli.Cli.SENSISTIVE_DATA.contains(e.getKey()) ? "****" : e.getValue())); } return p; } catch (java.lang.Exception e) { throw new java.lang.RuntimeException(("Could not read properties from: " + filename), e); } }
private void addPluginActionButtons(java.util.List<org.ovirt.engine.ui.common.widget.action.ActionButtonDefinition<?>> pluginActionButtonList) { if ((getActionPanelPresenterWidget()) != null) { for (org.ovirt.engine.ui.common.widget.action.ActionButtonDefinition<?> buttonDef : pluginActionButtonList) { getActionPanelPresenterWidget().addActionButton(((org.ovirt.engine.ui.common.widget.action.ActionButtonDefinition) (buttonDef))); } } }
@java.lang.Override public void onValueChange(com.google.gwt.event.logical.shared.ValueChangeEvent<java.lang.Boolean> event) { selectSpiceImplementation(SpiceConsoleModel.ClientConsoleMode.Native); }
@java.lang.Override public org.ovirt.engine.api.model.GraphicsConsoles list() { org.ovirt.engine.api.model.GraphicsConsoles consoles = new org.ovirt.engine.api.model.GraphicsConsoles(); org.ovirt.engine.core.common.businessentities.InstanceType entity = loadEntity(); org.ovirt.engine.api.restapi.resource.BackendGraphicsConsoleHelper.list(this, guid).entrySet().forEach(( graphicsInfo) -> consoles.getGraphicsConsoles().add(addLinks(populate(org.ovirt.engine.api.restapi.types.VmMapper.map(graphicsInfo, null), entity)))); return consoles; }
@java.lang.Override public int hashCode() { return java.util.Objects.hash(balance, defaultPolicy, description, filterPositionMap, filters, functions, id, locked, name, parameterMap, selector); }
private org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface createVlan(java.lang.String baseIfaceName) { org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface iface = new org.ovirt.engine.core.common.businessentities.network.Vlan(org.ovirt.engine.core.utils.RandomUtils.instance().nextInt(100), baseIfaceName); return iface; }
@java.lang.SuppressWarnings("unchecked") public static <P extends org.ovirt.engine.core.common.action.VdcActionParametersBase> org.ovirt.engine.core.bll.CommandBase<P> createCommand(org.ovirt.engine.core.common.action.VdcActionType action, P parameters) { try { java.lang.reflect.Constructor<org.ovirt.engine.core.bll.CommandBase<? extends org.ovirt.engine.core.common.action.VdcActionParametersBase>> constructor = org.ovirt.engine.core.bll.CommandsFactory.findCommandConstructor(org.ovirt.engine.core.bll.CommandsFactory.getCommandClass(action.name(), org.ovirt.engine.core.bll.CommandsFactory.CommandSuffix), parameters.getClass()); org.ovirt.engine.core.bll.CommandBase<P> cmd = ((org.ovirt.engine.core.bll.CommandBase<P>) (constructor.newInstance(new java.lang.Object[]{ parameters }))); org.ovirt.engine.core.common.utils.Injector.injectMembers(cmd); return cmd; } catch (java.lang.reflect.InvocationTargetException ex) { org.ovirt.engine.core.bll.CommandsFactory.log.error((("Error in invocating CTOR of command " + (action.name())) + ". Exception is "), ex); return null; } catch (java.lang.Exception ex) { org.ovirt.engine.core.bll.CommandsFactory.log.error(("An exception has occured while trying to create a command object for command " + (action.name())), ex); return null; } }
public void setActiveDetailModel(org.ovirt.engine.ui.uicommonweb.models.HasEntity<D> value) { if ((activeDetailModel) != value) { activeDetailModelChanging(value, getActiveDetailModel()); activeDetailModel = value; activeDetailModelChanged(); onPropertyChanged(new org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs("ActiveDetailModel")); } }
protected boolean setAndValidateCpuProfile() { org.ovirt.engine.core.bll.ImportVmCommandBase.getVm().getStaticData().setVdsGroupId(org.ovirt.engine.core.bll.ImportVmCommandBase.getVdsGroupId()); org.ovirt.engine.core.bll.ImportVmCommandBase.getVm().getStaticData().setCpuProfileId(org.ovirt.engine.core.bll.ImportVmCommandBase.getParameters().getCpuProfileId()); return validate(org.ovirt.engine.core.bll.profiles.CpuProfileHelper.setAndValidateCpuProfile(org.ovirt.engine.core.bll.ImportVmCommandBase.getVm().getStaticData(), getEffectiveCompatibilityVersion())); }
@java.lang.Override protected void executeCommand() { org.ovirt.engine.core.common.businessentities.VmDevice graphicsDev = getParameters().getDev(); getVmDeviceDao().update(graphicsDev); setSucceeded(true); setActionReturnValue(graphicsDev.getId().getDeviceId()); }
@java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { externalHostGroups_SelectedItemChanged(); }
@java.lang.Override public int compare(org.ovirt.engine.ui.uicommonweb.models.macpool.MacRangeModel range1, org.ovirt.engine.ui.uicommonweb.models.macpool.MacRangeModel range2) { int res = range1.getLeftBound().getEntity().compareTo(range2.getLeftBound().getEntity()); if (res == 0) { res = range1.getRightBound().getEntity().compareTo(range2.getRightBound().getEntity()); } return res; }
@java.lang.Override public void onSuccess(org.ovirt.engine.core.common.queries.VdcQueryReturnValue returnValue) { deactivate(); java.util.List<org.ovirt.engine.core.common.businessentities.VmDevice> rngDevices = returnValue.getReturnValue(); getModel().getIsRngEnabled().setEntity((!(rngDevices.isEmpty()))); if (!(rngDevices.isEmpty())) { org.ovirt.engine.core.common.businessentities.VmRngDevice rngDevice = new org.ovirt.engine.core.common.businessentities.VmRngDevice(rngDevices.get(0)); getModel().setRngDevice(rngDevice); } activate(); updateVirtioScsi(vmBase); }
@java.lang.SuppressWarnings("unchecked") @org.junit.Test public void testRetryWithException() throws java.lang.Exception { java.util.concurrent.Callable<java.lang.Object> callable = mock(java.util.concurrent.Callable.class); org.ovirt.vdsm.jsonrpc.client.utils.retry.RetryPolicy policy = new org.ovirt.vdsm.jsonrpc.client.utils.retry.RetryPolicy(5, 3, 10, java.io.IOException.class); org.ovirt.vdsm.jsonrpc.client.utils.retry.Retryable<java.lang.Object> retryable = new org.ovirt.vdsm.jsonrpc.client.utils.retry.Retryable(callable, policy); stub(callable.call()).toThrow(new java.io.IOException()).toThrow(new java.io.IOException()).toReturn(new java.lang.Object()); retryable.call(); verify(callable, times(3)).call(); }
@java.lang.Override public boolean isBalloonEnabled(int osId, org.ovirt.engine.core.compat.Version version) { return getBoolean(getValueByVersion(idToUnameLookup.get(osId), "devices.balloon.enabled", version), false); }
public void setUsePhysicalNetworkFromCustom(org.ovirt.engine.ui.uicommonweb.models.EntityModel<java.lang.Boolean> usePhysicalNetworkFromCustom) { this.usePhysicalNetworkFromCustom = usePhysicalNetworkFromCustom; }
@java.lang.Override protected void SyncSearch() { org.ovirt.engine.core.common.businessentities.DiskImage diskImage = ((org.ovirt.engine.core.common.businessentities.DiskImage) (getEntity())); if (diskImage == null) { return; } org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery = new org.ovirt.engine.ui.frontend.AsyncQuery(); _asyncQuery.setModel(this); _asyncQuery.asyncCallback = new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void OnSuccess(java.lang.Object model, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.models.SearchableListModel searchableListModel = ((org.ovirt.engine.ui.uicommonweb.models.SearchableListModel) (model)); searchableListModel.setItems(((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StorageDomain>) (((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (returnValue)).getReturnValue()))); } }; org.ovirt.engine.core.common.queries.GetStorageDomainsByImageIdParameters getStorageDomainsByImageIdParameters = new org.ovirt.engine.core.common.queries.GetStorageDomainsByImageIdParameters(diskImage.getImageId()); getStorageDomainsByImageIdParameters.setRefresh(getIsQueryFirstTime()); org.ovirt.engine.ui.frontend.Frontend.RunQuery(VdcQueryType.GetStorageDomainsByImageId, getStorageDomainsByImageIdParameters, _asyncQuery); setIsQueryFirstTime(false); }
private boolean storageDomainStatusIsValid() { boolean returnValue; if (org.ovirt.engine.core.bll.storage.domain.ActivateStorageDomainCommand.isInternalExecution()) { returnValue = checkStorageDomainStatus(StorageDomainStatus.Inactive, StorageDomainStatus.Unknown, StorageDomainStatus.Locked, StorageDomainStatus.Maintenance, StorageDomainStatus.PreparingForMaintenance); } else { returnValue = checkStorageDomainStatus(StorageDomainStatus.Inactive, StorageDomainStatus.Unknown, StorageDomainStatus.Maintenance, StorageDomainStatus.PreparingForMaintenance); } return returnValue; }
private java.lang.String commaSeparated(java.util.List<?> invalidBondIds) { return org.apache.commons.lang.StringUtils.join(invalidBondIds, ", "); }
@org.junit.Test public void validateFailsOnServerNotUp() { cmd = spy(new org.ovirt.engine.core.bll.gluster.RemoveGlusterHookCommand(new org.ovirt.engine.core.common.action.gluster.GlusterHookManageParameters(HOOK_ID))); setUpMocksForRemove(true, getHookEntity(), VDSStatus.Down); assertFalse(cmd.validate()); assertTrue(cmd.getReturnValue().getValidationMessages().contains(EngineMessage.ACTION_TYPE_FAILED_SERVER_STATUS_NOT_UP.toString())); }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("Description") java.lang.String descriptionAffinityGroup();
private com.thoughtworks.qdox.model.JavaMethod getInputDetailMethod(com.thoughtworks.qdox.model.JavaClass javaClass) { java.util.Optional<com.thoughtworks.qdox.model.JavaMethod> method = javaClass.getMethods().stream().filter(( x) -> isAnnotatedWith(x, .class.getCanonicalName())).findFirst(); return method.isPresent() ? method.get() : null; }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Play") java.lang.String playSpiceConsole();
private java.lang.String formatDataRead(org.ovirt.engine.ui.uicompat.UIMessages messages, long totalBytesRead, long bytesReadInCurrentInterval) { org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.common.utils.SizeConverter.SizeUnit, java.lang.Double> dataReadInCurrentInterval = org.ovirt.engine.core.common.utils.SizeConverter.autoConvert(bytesReadInCurrentInterval, SizeUnit.BYTES); org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.common.utils.SizeConverter.SizeUnit, java.lang.Double> dataRead = org.ovirt.engine.core.common.utils.SizeConverter.autoConvert(totalBytesRead, SizeUnit.BYTES); return messages.bytesReadInCurrentProfileInterval(formatSize(dataReadInCurrentInterval.getSecond()), dataReadInCurrentInterval.getFirst().name(), formatSize(dataRead.getSecond()), dataRead.getFirst().toString()); }
public java.lang.String getMac() { return mac; }
@java.lang.Override public java.lang.String toString() { java.lang.StringBuilder builder = new java.lang.StringBuilder(); builder.append("NetworkCluster {id=").append(getId()).append(", status=").append(getStatus()).append(", display=").append(isDisplay()).append(", required=").append(isRequired()).append(", migration=").append(isMigration()).append(", management=").append(isManagement()).append(", gluster=").append(isGluster()).append("}"); return builder.toString(); }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.VmStatic> getAllWithoutIcon() { return getCallsHandler().executeReadList("GetVmStaticWithoutIcon", org.ovirt.engine.core.dao.VmStaticDaoImpl.getRowMapper(), getCustomMapSqlParameterSource()); }
public void warnOnActiveVm() { if (activeVmAttachedToClusterPredicate.eval(networkCluster.getClusterId())) { org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase loggable = createLoggable(); auditLogger.log(loggable, AuditLogType.NETWORK_UPDATE_DISPLAY_FOR_CLUSTER_WITH_ACTIVE_VM); } }
private org.ovirt.engine.core.compat.Guid getQuotaId() { return AddVmCommand.getQuotaManager().getDefaultQuotaIfNull(AddVmCommand.getParameters().getVmStaticData().getQuotaId(), AddVmCommand.getStoragePoolId()); }
@java.lang.Override protected void executeCommand() { initPoolUser(); org.ovirt.engine.core.common.action.VdcReturnValueBase vdcReturnValue = attachUserToVm(); if (!(vdcReturnValue.getSucceeded())) { log.info("Failed to give user '{}' permission to Vm '{}'", getAdUserId(), getVmId()); setActionReturnValue(vdcReturnValue); return; } else { log.info("Succeeded giving user '{}' permission to Vm '{}'", getAdUserId(), getVmId()); } if (!(isVmPrestarted())) { vdcReturnValue = runVm(); setSucceeded(vdcReturnValue.getSucceeded()); org.ovirt.engine.core.bll.AttachUserToVmFromPoolAndRunCommand.getReturnValue().getVdsmTaskIdList().addAll(org.ovirt.engine.core.bll.AttachUserToVmFromPoolAndRunCommand.getReturnValue().getInternalVdsmTaskIdList()); } else { org.ovirt.engine.core.bll.AttachUserToVmFromPoolAndRunCommand.setSucceeded(true); } setActionReturnValue(getVmId()); }
@java.lang.Override public java.lang.String toString() { java.lang.StringBuilder builder = new java.lang.StringBuilder(); builder.append("LUNs [id=").append(getLUN_id()).append(", physicalVolumeId=").append(getphysical_volume_id()).append(", volumeGroupId=").append(getvolume_group_id()).append(", serial=").append(getSerial()).append(", lunMapping=").append(getLunMapping()).append(", vendorId=").append(getVendorId()).append(", productId=").append(getProductId()).append(", _lunConnections=").append(getLunConnections()).append(", deviceSize=").append(getDeviceSize()).append(", vendorName=").append(getVendorName()).append(", pathsDictionary=").append(getPathsDictionary()).append(", lunType=").append(getLunType()).append(", status=").append(getStatus()).append(", diskId=").append(getDiskId()).append(", diskAlias=").append(getDiskAlias()).append(", storageDomainId=").append(getStorageDomainId()).append(", storageDomainName=").append(getStorageDomainName()).append("]"); return builder.toString(); }
@java.lang.Override public void setEntity(java.lang.Object value) { super.setEntity((value == null ? null : ((org.ovirt.engine.ui.uicommonweb.models.vms.ImportTemplateData) (value)).getTemplate())); }
private java.lang.String getMountPointsFilterPattern() { java.lang.String[] mountPointsToIgnore = org.ovirt.engine.core.common.config.Config.<java.lang.String>getValue(ConfigValues.GlusterStorageDeviceListMountPointsToIgnore).split(","); java.lang.StringBuilder pattern = new java.lang.StringBuilder(); for (java.lang.String mointPoint : mountPointsToIgnore) { pattern.append("^"); pattern.append(mointPoint); pattern.append("$"); pattern.append("|"); } return pattern.toString(); }
@org.junit.Test public void testGetByNameWithInvalidName() { org.ovirt.engine.core.common.businessentities.Bookmark result = dao.getByName("thisnameisinvalid"); assertNull(result); }
byte[] digestFile(java.io.File file) throws java.io.FileNotFoundException, java.io.IOException { java.security.MessageDigest digest; try { digest = java.security.MessageDigest.getInstance("MD5"); } catch (java.security.NoSuchAlgorithmException e) { throw new java.lang.RuntimeException(e); } java.io.InputStream is = null; try { is = new java.io.FileInputStream(file); byte[] buffer = new byte[1024]; int n; while ((n = is.read(buffer)) != (-1)) { digest.update(buffer, 0, n); } } finally { if (is != null) { try { is.close(); } catch (java.io.IOException e) { } } } return digest.digest(); }
private void saveIllegalDisk(final org.ovirt.engine.core.common.businessentities.DiskImage diskImage) { org.ovirt.engine.core.utils.transaction.TransactionSupport.executeInNewTransaction(new org.ovirt.engine.core.utils.transaction.TransactionMethod<java.lang.Void>() { @java.lang.Override public java.lang.Void runInTransaction() { diskImage.setImageId(org.ovirt.engine.core.compat.Guid.NewGuid()); diskImage.setId(org.ovirt.engine.core.compat.Guid.NewGuid()); diskImage.setParentId(Guid.Empty); diskImage.setImageTemplateId(Guid.Empty); org.ovirt.engine.core.bll.ImagesHandler.setDiskAlias(diskImage, getVm()); org.ovirt.engine.core.bll.ImagesHandler.addDiskImage(diskImage, getVmId()); return null; } }); }
@java.lang.Override protected void executeQueryCommand() { java.util.List<org.ovirt.engine.core.common.businessentities.VmHostDevice> result = new java.util.ArrayList<>(); java.util.List<org.ovirt.engine.core.common.businessentities.VmDevice> vmHostDevices = vmDeviceDao.getVmDeviceByVmIdAndType(org.ovirt.engine.core.bll.GetVmHostDevicesQuery.getParameters().getId(), VmDeviceGeneralType.HOSTDEV); for (org.ovirt.engine.core.common.businessentities.VmDevice device : vmHostDevices) { result.add(new org.ovirt.engine.core.common.businessentities.VmHostDevice(device)); } setReturnValue(result); }
public static boolean isRebootCommandExecutionAllowed(java.util.List<org.ovirt.engine.core.common.businessentities.VM> vms) { if ((vms.isEmpty()) || (!(org.ovirt.engine.core.common.VdcActionUtils.canExecute(vms, org.ovirt.engine.core.common.businessentities.VM.class, VdcActionType.RebootVm)))) { return false; } for (org.ovirt.engine.core.common.businessentities.VM vm : vms) { org.ovirt.engine.core.compat.Version version = vm.getVdsGroupCompatibilityVersion(); org.ovirt.engine.core.compat.Version anyDcVersion = new org.ovirt.engine.core.compat.Version(); if ((!(org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.isCommandCompatible(VdcActionType.RebootVm, version, anyDcVersion))) || (org.ovirt.engine.core.compat.StringHelper.isNullOrEmpty(vm.getVmIp()))) { return false; } } return true; }
public static java.lang.String GenerateOTP() { java.security.SecureRandom secr = new java.security.SecureRandom(); byte[] arrRandom = new byte[9]; secr.nextBytes(arrRandom); return new org.apache.commons.codec.binary.Base64(0).encodeToString(arrRandom); }
@java.lang.Override public void reportCompleted() { try { super.reportCompleted(); } finally { org.ovirt.engine.core.bll.MigrateVmCommand.freeLock(); } }
public static void updateParametersSequencing(java.util.List<org.ovirt.engine.core.common.action.VdcActionParametersBase> parameters) { for (int i = 0; i < (parameters.size()); i++) { org.ovirt.engine.core.common.action.PersistentSetupNetworksParameters setupNetworkParameters = ((org.ovirt.engine.core.common.action.PersistentSetupNetworksParameters) (parameters.get(i))); setupNetworkParameters.setSequence((i + 1)); setupNetworkParameters.setTotal(parameters.size()); setupNetworkParameters.setShouldBeLogged(true); } }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Disks already exist on all available Storage Domains.") java.lang.String disksAlreadyExistMsg();
@org.junit.Test public void testInterfaceIsValidSlaveWhenInterfaceIsBond() throws java.lang.Exception { org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface vdsNetworkInterface = createVdsNetworkInterfaceWithName(); vdsNetworkInterface.setBonded(true); assertThat(new org.ovirt.engine.core.bll.validator.HostInterfaceValidator(vdsNetworkInterface).interfaceIsValidSlave(), org.ovirt.engine.core.bll.validator.ValidationResultMatchers.failsWith(EngineMessage.NETWORK_INTERFACE_BOND_OR_VLAN_CANNOT_BE_SLAVE)); }
@org.junit.Test public void testDiskImageWithSgioCantBeAdded() { org.ovirt.engine.core.common.businessentities.storage.DiskImage disk = org.ovirt.engine.core.bll.AddDiskCommandTest.createVirtIoScsiDiskImage(); disk.setSgio(ScsiGenericIO.UNFILTERED); org.ovirt.engine.core.common.action.AddDiskParameters parameters = org.ovirt.engine.core.bll.AddDiskCommandTest.createParameters(); parameters.setDiskInfo(disk); org.ovirt.engine.core.compat.Guid storageId = org.ovirt.engine.core.compat.Guid.newGuid(); initializeCommand(storageId, parameters); mockStorageDomain(storageId); mockStoragePoolIsoMap(); org.ovirt.engine.core.common.businessentities.VM vm = mockVm(); vm.setVdsGroupCompatibilityVersion(Version.v3_3); mockMaxPciSlots(); org.ovirt.engine.core.bll.validator.storage.DiskValidator diskValidator = spyDiskValidator(disk); doReturn(true).when(diskValidator).isVirtioScsiControllerAttached(any(org.ovirt.engine.core.compat.Guid.class)); org.ovirt.engine.core.bll.CanDoActionTestUtils.runAndAssertCanDoActionFailure(command, EngineMessage.SCSI_GENERIC_IO_IS_NOT_SUPPORTED_FOR_IMAGE_DISK); }
private void confirmUnplug() { org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel model = new org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel(); model.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().deactivateVmDisksTitle()); model.setMessage(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().areYouSureYouWantDeactivateVMDisksMsg()); model.setHashName("deactivate_vm_disk"); setWindow(model); java.util.ArrayList<java.lang.String> items = new java.util.ArrayList<java.lang.String>(); for (org.ovirt.engine.core.common.businessentities.Disk selected : getSelectedItems()) { items.add(selected.getDiskAlias()); } model.setItems(items); org.ovirt.engine.ui.uicommonweb.UICommand unPlug = org.ovirt.engine.ui.uicommonweb.UICommand.createDefaultOkUiCommand("OnUnplug", this); model.getCommands().add(unPlug); org.ovirt.engine.ui.uicommonweb.UICommand cancel = org.ovirt.engine.ui.uicommonweb.UICommand.createCancelUiCommand("Cancel", this); model.getCommands().add(cancel); }
@java.lang.Override public void onKeyPress(com.google.gwt.event.dom.client.KeyPressEvent event) { if ((com.google.gwt.event.dom.client.KeyCodes.KEY_ENTER) == (event.getNativeEvent().getKeyCode())) { setInModel(ctx, editor, editor.getValue()); } }
@java.lang.Override public boolean validate(org.ovirt.engine.core.config.entity.ConfigKey key, java.lang.String value) { if ((org.apache.commons.lang.StringUtils.isNotBlank(value)) && (value.equals(org.ovirt.engine.core.config.entity.helper.PasswordValueHelper.INTERACTIVE_MODE))) { return true; } if ((parser.getAdminPassFile()) != null) { return true; } return false; }
@org.junit.Test public void validateVmMemoryCantStartOnVdsHighPendingSwapSmall() { vds.setSwapFree(60L); boolean vmPassedMemoryRequirement = slaValidator.hasPhysMemoryToRunVM(vds, vm, 65); assertTrue(vmPassedMemoryRequirement); }
@org.ovirt.engine.ui.frontend.DefaultStringValue("Cannot ${action} ${type}. The storage selected contains the self hosted engine.") java.lang.String ACTION_TYPE_FAILED_HOSTED_ENGINE_STORAGE();
private void copy() { java.util.ArrayList<org.ovirt.engine.core.common.businessentities.DiskImage> disks = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.DiskImage>) (getSelectedItems())); if (disks == null) { return; } if ((getWindow()) != null) { return; } org.ovirt.engine.ui.uicommonweb.models.templates.CopyDiskModel model = new org.ovirt.engine.ui.uicommonweb.models.templates.CopyDiskModel(); setWindow(model); model.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().copyDisksTitle()); model.setHelpTag(HelpTag.copy_disk); model.setHashName("copy_disk"); model.setEntity(this); model.init(disks); model.startProgress(null); }
private java.lang.String decodeDiskProperty(java.lang.String diskProperty) throws org.apache.commons.codec.DecoderException { return new java.lang.String(org.apache.commons.codec.binary.Hex.decodeHex(diskProperty.toCharArray()), org.ovirt.engine.core.bll.storage.disk.image.MetadataDiskDescriptionHandler.CHARSET); }
private void writeAnnotationParameter(org.ovirt.api.metamodel.concepts.AnnotationParameter parameter) { writer.writeStartElement("parameter"); writeName(parameter); java.util.List<java.lang.String> values = parameter.getValues(); if (!(values.isEmpty())) { writer.writeStartElement("values"); values.forEach(( x) -> writer.writeElement("value", x)); writer.writeEndElement(); } writer.writeEndElement(); }
@java.lang.Override protected void childCommandsExecutionEnded(org.ovirt.engine.core.bll.CommandBase<?> command, boolean anyFailed, java.util.List<org.ovirt.engine.core.compat.Guid> childCmdIds, org.ovirt.engine.core.compat.backendcompat.CommandExecutionStatus status, int completedChildren) { org.ovirt.engine.core.bll.storage.disk.cinder.RemoveCinderDiskVolumeCommand<org.ovirt.engine.core.common.action.RemoveCinderDiskVolumeParameters> removeCinderDiskVolumeCommand = ((org.ovirt.engine.core.bll.storage.disk.cinder.RemoveCinderDiskVolumeCommand<org.ovirt.engine.core.common.action.RemoveCinderDiskVolumeParameters>) (command)); org.ovirt.engine.core.common.businessentities.storage.CinderDisk removedVolume = removeCinderDiskVolumeCommand.getParameters().getRemovedVolume(); if (!(removeCinderDiskVolumeCommand.getCinderBroker().isVolumeExistsByClassificationType(removedVolume))) { setCommandEndStatus(command, false, status, childCmdIds); } org.ovirt.engine.core.common.businessentities.storage.ImageStatus imageStatus = checkImageStatus(removedVolume, removeCinderDiskVolumeCommand); if ((imageStatus != null) && (imageStatus != (removedVolume.getImageStatus()))) { switch (imageStatus) { case ILLEGAL : setCommandEndStatus(command, true, status, childCmdIds); break; } } }
public org.ovirt.engine.core.bll.ValidationResult updateNicForBackwardCompatibility(org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface nic, org.ovirt.engine.core.common.businessentities.VmBase vm, org.ovirt.engine.core.compat.Guid userId) { if ((nic.getVnicProfileId()) != null) { return org.ovirt.engine.core.bll.ValidationResult.VALID; } if ((nic.getNetworkName()) == null) { if (nic.isPortMirroring()) { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.VdcBllMessages.PORT_MIRRORING_REQUIRES_NETWORK); } else { return org.ovirt.engine.core.bll.ValidationResult.VALID; } } org.ovirt.engine.core.common.businessentities.network.Network network = getNetworkDao().getByNameAndCluster(nic.getNetworkName(), vm.getVdsGroupId()); if (network == null) { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.VdcBllMessages.NETWORK_NOT_EXISTS_IN_CLUSTER); } java.util.List<org.ovirt.engine.core.common.businessentities.network.VnicProfile> vnicProfiles = getVnicProfileDao().getAllForNetwork(network.getId()); for (org.ovirt.engine.core.common.businessentities.network.VnicProfile profile : vnicProfiles) { if (isVnicProfilePermitted(userId, profile, nic.isPortMirroring())) { nic.setVnicProfileId(profile.getId()); return org.ovirt.engine.core.bll.ValidationResult.VALID; } } return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.VdcBllMessages.ACTION_TYPE_FAILED_CANNOT_FIND_VNIC_PROFILE_FOR_NETWORK); }
@java.lang.Override public void onBootstrap() { user.setLogoutHandler(this); initUiCommon(); initFrontend(); initLoginModel(); org.ovirt.engine.ui.common.auth.AutoLoginData autoLoginData = org.ovirt.engine.ui.common.auth.AutoLoginData.instance(); if (autoLoginData != null) { handleAutoLogin(autoLoginData); } org.ovirt.engine.ui.common.restapi.EngineSessionTimeoutData engineSessionTimeoutData = org.ovirt.engine.ui.common.restapi.EngineSessionTimeoutData.instance(); if (engineSessionTimeoutData != null) { restApiSessionManager.setSessionTimeout(engineSessionTimeoutData.getSessionTimeout()); restApiSessionManager.setHardLimit(engineSessionTimeoutData.getSessionHardLimit()); } }
private static void updateV2VJobs(org.ovirt.engine.core.common.businessentities.VDS vds, java.util.Map<java.lang.String, java.lang.Object> xmlRpcStruct) { if (!(xmlRpcStruct.containsKey(VdsProperties.v2vJobs))) { return; } java.util.List<org.ovirt.engine.core.common.businessentities.V2VJobInfo> v2vJobs = new java.util.ArrayList<>(); for (java.util.Map.Entry<java.lang.String, java.lang.Object> job : ((java.util.Map<java.lang.String, java.lang.Object>) (xmlRpcStruct.get(VdsProperties.v2vJobs))).entrySet()) { v2vJobs.add(org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.buildV2VJobData(job.getKey(), ((java.util.Map<java.lang.String, java.lang.Object>) (job.getValue())))); } vds.getStatisticsData().setV2VJobs(v2vJobs); }
private void displayProtocol_SelectedItemChanged(java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { org.ovirt.engine.ui.uicommonweb.models.EntityModel entityModel = ((org.ovirt.engine.ui.uicommonweb.models.EntityModel) (getDisplayProtocol().getSelectedItem())); if (entityModel == null) { return; } org.ovirt.engine.core.common.businessentities.DisplayType type = ((org.ovirt.engine.core.common.businessentities.DisplayType) (entityModel.getEntity())); if (type == (org.ovirt.engine.core.common.businessentities.DisplayType.vnc)) { getUsbPolicy().setSelectedItem(org.ovirt.engine.core.common.businessentities.UsbPolicy.DISABLED); getIsSmartcardEnabled().setEntity(false); } getBehavior().updateSingleQxl((type == (org.ovirt.engine.core.common.businessentities.DisplayType.qxl))); getUsbPolicy().setIsChangable((type == (org.ovirt.engine.core.common.businessentities.DisplayType.qxl))); getIsSmartcardEnabled().setIsChangable((type == (org.ovirt.engine.core.common.businessentities.DisplayType.qxl))); getVncKeyboardLayout().setIsAvailable((type == (org.ovirt.engine.core.common.businessentities.DisplayType.vnc))); updateNumOfMonitors(); }
private void updateCurrentMemory(org.ovirt.engine.core.common.businessentities.VM newVm) { int currentMemory = org.ovirt.engine.core.bll.UpdateVmCommand.getVm().getMemSizeMb(); int newAmountOfMemory = newVm.getMemSizeMb(); if (org.ovirt.engine.core.bll.UpdateVmCommand.getVm().getStatus().isNotRunning()) { newVmStatic.setMemSizeMb(newAmountOfMemory); return; } if ((org.ovirt.engine.core.bll.UpdateVmCommand.getVm().getStatus()) != (org.ovirt.engine.core.common.businessentities.VMStatus.Up)) { newVmStatic.setMemSizeMb(currentMemory); log.warn("Memory update {}MB -> {}MB of VM {} ({}) left out. Memory can't be updated in current VM state ({}).", currentMemory, newAmountOfMemory, org.ovirt.engine.core.bll.UpdateVmCommand.getVm().getName(), org.ovirt.engine.core.bll.UpdateVmCommand.getVm().getId(), org.ovirt.engine.core.bll.UpdateVmCommand.getVm().getStatus()); return; } boolean isMemoryHotUnplugSupported = org.ovirt.engine.core.common.FeatureSupported.hotUnplugMemory(org.ovirt.engine.core.bll.UpdateVmCommand.getVm().getCompatibilityVersion(), org.ovirt.engine.core.bll.UpdateVmCommand.getVm().getClusterArch()); if (org.ovirt.engine.core.common.utils.VmCommonUtils.isMemoryToBeHotplugged(org.ovirt.engine.core.bll.UpdateVmCommand.getVm(), newVm, isMemoryHotUnplugSupported)) { hotSetMemory(currentMemory, newAmountOfMemory); } }
@org.ovirt.engine.ui.frontend.DefaultStringValue("Cannot ${action} ${type}. Balloon is not supported on '${clusterArch}' architecture.") java.lang.String BALLOON_REQUESTED_ON_NOT_SUPPORTED_ARCH();
@java.lang.Override public java.lang.String toString() { return java.lang.String.format("%s, deviceList = %s", super.toString(), getDeviceList()); }
@java.lang.SuppressWarnings("rawtypes") @java.lang.Override public org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc updateVmPolicy(java.util.Map params) { org.ovirt.vdsm.jsonrpc.client.JsonRpcRequest request = new org.ovirt.vdsm.jsonrpc.client.RequestBuilder("VM.updateVmPolicy").withParameter("vmID", ((java.lang.String) (params.get("vmId")))).withParameter("params", params).build(); java.util.Map<java.lang.String, java.lang.Object> response = new org.ovirt.engine.core.vdsbroker.jsonrpc.FutureMap(this.client, request); return new org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc(response); }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("Reports Webapp deployment is in progress, please try again in a few minutes.") java.lang.String reportsWebAppNotDeployedMsg();
@org.ovirt.engine.core.utils.timer.OnTimerMethodAnnotation("OnTimer") public void OnTimer(org.ovirt.engine.core.compat.Guid domainId) { synchronized(_lockObject) { if (_domainsInProblem.containsKey(domainId)) { org.ovirt.engine.core.vdsbroker.irsbroker.IrsBrokerCommand.log.info(("starting ProcessDomainRecovery for domain " + (org.ovirt.engine.core.vdsbroker.irsbroker.IrsBrokerCommand.IrsProxyData.getDomainIdTuple(domainId)))); ProcessDomainRecovery(domainId); } _timers.remove(domainId); } }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Edit") java.lang.String editVolume();
private void setUpEntityQueryExpectations(java.lang.Object failure) throws java.lang.Exception { setUpEntityQueryExpectations(QueryType.GetAllDisksWithSnapshots, org.ovirt.engine.core.common.queries.QueryParametersBase.class, new java.lang.String[]{ }, new java.lang.Object[]{ }, getEntityList(), failure); }
@java.lang.Override public java.lang.Object Convert(java.lang.Object source, org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery) { return source != null ? ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Snapshot>) (source)) : new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Snapshot>(); }
@org.ovirt.engine.api.restapi.types.Mapping(from = org.ovirt.engine.api.model.Permission.class, to = org.ovirt.engine.api.model.Permission.class) public static org.ovirt.engine.api.model.Permission map(org.ovirt.engine.core.common.businessentities.Permission entity, org.ovirt.engine.api.model.Permission template) { org.ovirt.engine.api.model.Permission model = (template != null) ? template : new org.ovirt.engine.api.model.Permission(); model.setId(entity.getId().toString()); if ((entity.getRoleId()) != null) { model.setRole(new org.ovirt.engine.api.model.Role()); model.getRole().setId(entity.getRoleId().toString()); } if (((entity.getAdElementId()) != null) && ((template == null) || (!(template.isSetGroup())))) { model.setUser(new org.ovirt.engine.api.model.User()); model.getUser().setId(entity.getAdElementId().toString()); } if ((entity.getObjectId()) != null) { org.ovirt.engine.api.restapi.types.PermissionMapper.setObjectId(model, entity); } return model; }
@org.junit.Test public void testCredentialsWithConnectionExtension() { org.ovirt.engine.core.common.businessentities.StorageServerConnections conn = org.ovirt.engine.core.vdsbroker.storage.StorageConnectionHelperTest.createConnectionWithCredentials("target1", "userConn", "pwdConn"); org.ovirt.engine.core.common.businessentities.storage.StorageServerConnectionExtension connExt = org.ovirt.engine.core.vdsbroker.storage.StorageConnectionHelperTest.createConnectionExtension(org.ovirt.engine.core.compat.Guid.newGuid(), "target1", "userConnExt", "pwdConnExt"); when(connExtDaoMock.getByHostIdAndTarget(connExt.getHostId(), connExt.getIqn())).thenReturn(connExt); org.ovirt.engine.core.common.utils.Pair<java.lang.String, java.lang.String> credentials = helper.getStorageConnectionCredentialsForhost(connExt.getHostId(), conn); org.ovirt.engine.core.vdsbroker.storage.StorageConnectionHelperTest.assertCredentials(credentials, connExt.getUserName(), connExt.getPassword()); }
@org.junit.Test public void testStartWithVnc() throws java.lang.Exception { setUpWindowsGetEntityExpectations(2, false); setUriInfo(setUpActionExpectations(VdcActionType.RunVmOnce, org.ovirt.engine.core.common.action.RunVmOnceParams.class, new java.lang.String[]{ "VmId", "UseVnc" }, new java.lang.Object[]{ GUIDS[0], java.lang.Boolean.TRUE })); org.ovirt.engine.api.model.Action action = new org.ovirt.engine.api.model.Action(); action.setVm(new org.ovirt.engine.api.model.VM()); action.getVm().setDisplay(new org.ovirt.engine.api.model.Display()); action.getVm().getDisplay().setType(DisplayType.VNC.value()); verifyActionResponse(resource.start(action)); }
private void showConfirmation() { if (providedNetworks.isEmpty()) { actualSave(); return; } java.lang.StringBuilder networkList = new java.lang.StringBuilder("Networks:\n"); for (org.ovirt.engine.core.common.businessentities.network.Network network : providedNetworks) { networkList.append("- ").append(network.getName()).append('\n'); } org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel confirmationModel = new org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel(); confirmationModel.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().providerUrlWarningTitle()); confirmationModel.setMessage(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getMessages().providerUrlWarningText(networkList.toString())); org.ovirt.engine.ui.uicommonweb.UICommand cmdOk = new org.ovirt.engine.ui.uicommonweb.UICommand(org.ovirt.engine.ui.uicommonweb.models.providers.EditProviderModel.CMD_APPROVE, this); cmdOk.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().ok()); cmdOk.setIsDefault(true); confirmationModel.getCommands().add(cmdOk); org.ovirt.engine.ui.uicommonweb.UICommand cmdCancel = new org.ovirt.engine.ui.uicommonweb.UICommand(org.ovirt.engine.ui.uicommonweb.models.providers.EditProviderModel.CMD_CANCEL, this); cmdCancel.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().cancel()); cmdCancel.setIsCancel(true); confirmationModel.getCommands().add(cmdCancel); sourceListModel.setConfirmWindow(confirmationModel); }
public org.ovirt.engine.core.bll.ValidationResult validate() { java.util.Collection<org.ovirt.engine.core.common.businessentities.network.NetworkAttachment> attachmentsToConfigure = getAttachmentsToConfigure(); org.ovirt.engine.core.bll.ValidationResult vr = org.ovirt.engine.core.bll.ValidationResult.VALID; vr = (skipValidation(vr)) ? vr : new org.ovirt.engine.core.bll.network.host.NicLabelValidator(params, existingInterfacesMap, bondsMap, hostSetupNetworksValidatorHelper).validate(); vr = (skipValidation(vr)) ? vr : validNewOrModifiedNetworkAttachments(); vr = (skipValidation(vr)) ? vr : validRemovedNetworkAttachments(); vr = (skipValidation(vr)) ? vr : validNewOrModifiedBonds(); vr = (skipValidation(vr)) ? vr : validRemovedBonds(attachmentsToConfigure); vr = (skipValidation(vr)) ? vr : attachmentsDontReferenceSameNetworkDuplicately(attachmentsToConfigure); vr = (skipValidation(vr)) ? vr : networksUniquelyConfiguredOnHost(attachmentsToConfigure); vr = (skipValidation(vr)) ? vr : validateNetworkExclusiveOnNics(attachmentsToConfigure); vr = (skipValidation(vr)) ? vr : new org.ovirt.engine.core.bll.network.host.NetworkMtuValidator(networkBusinessEntityMap).validateMtu(attachmentsToConfigure); vr = (skipValidation(vr)) ? vr : validateCustomProperties(); return vr; }
private void hotUnplugMemory(org.ovirt.engine.core.common.businessentities.VM newVm) { final java.util.List<org.ovirt.engine.core.common.businessentities.VmDevice> vmMemoryDevices = vmDeviceDao.getVmDeviceByVmIdTypeAndDevice(getVmId(), VmDeviceGeneralType.MEMORY, VmDeviceType.MEMORY); final int oldMemoryMb = oldVm.getMemSizeMb(); final int oldMinMemoryMb = oldVm.getMinAllocatedMem(); final java.util.List<org.ovirt.engine.core.common.businessentities.VmDevice> memoryDevicesToUnplug = org.ovirt.engine.core.bll.memory.MemoryUtils.computeMemoryDevicesToHotUnplug(vmMemoryDevices, oldMemoryMb, org.ovirt.engine.core.bll.UpdateVmCommand.getParameters().getVm().getMemSizeMb()); if (memoryDevicesToUnplug.isEmpty()) { logNoDeviceToHotUnplug(vmMemoryDevices); if (!(oldVm.isHostedEngine())) { newVmStatic.setMemSizeMb(oldMemoryMb); newVmStatic.setMinAllocatedMem(oldMinMemoryMb); } return; } final int totalHotUnpluggedMemoryMb = memoryDevicesToUnplug.stream().mapToInt(( deviceToHotUnplug) -> { final org.ovirt.engine.core.common.action.ActionReturnValue hotUnplugReturnValue = runInternalAction(ActionType.HotUnplugMemoryWithoutVmUpdate, new org.ovirt.engine.core.common.action.HotUnplugMemoryWithoutVmUpdateParameters(deviceToHotUnplug.getId(), newVm.getMinAllocatedMem()), cloneContextAndDetachFromParent()); return hotUnplugReturnValue.getSucceeded() ? org.ovirt.engine.core.common.utils.VmDeviceCommonUtils.getSizeOfMemoryDeviceMb(deviceToHotUnplug).get() : 0; }).sum(); if (!(oldVm.isHostedEngine())) { newVmStatic.setMemSizeMb((oldMemoryMb - totalHotUnpluggedMemoryMb)); newVmStatic.setMinAllocatedMem((totalHotUnpluggedMemoryMb > 0 ? newVm.getMinAllocatedMem() : oldMinMemoryMb)); } }
@java.lang.Override public final void run() { org.ovirt.engine.ui.uicommonweb.models.GridTimer.logger.fine((("GridTimer[" + (name)) + "].run() called")); if ((repetitions) > 0) { (repetitions)--; } else if ((repetitions) == 0) { cycleRate(); } org.ovirt.engine.ui.uicommonweb.models.GridTimer.logger.fine(((((((("GridTimer[" + (name)) + "] Executing! Current Rate: ") + (rateCycle[currentRate])) + ":") + (getRefreshRate())) + " Reps: ") + (repetitions))); execute(); }
private static org.ovirt.engine.core.bll.validator.storage.StorageDomainValidator mockStorageDomainValidatorWithoutSpace() { org.ovirt.engine.core.bll.validator.storage.StorageDomainValidator storageDomainValidator = org.ovirt.engine.core.bll.MoveOrCopyDiskCommandTest.mockStorageDomainValidator(); when(storageDomainValidator.hasSpaceForClonedDisk(any(org.ovirt.engine.core.common.businessentities.storage.DiskImage.class))).thenReturn(new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_DISK_SPACE_LOW_ON_STORAGE_DOMAIN)); return storageDomainValidator; }
@java.lang.Override public void setEntityId(org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase logable) { logable.setStoragePoolId(getOldStoragePool().getId()); }
public java.util.List<org.ovirt.engine.core.bll.validator.InClusterUpgradeValidator.UpgradeError> getVm() { return vm; }
@org.junit.Test public void testStorageDomainMappings() { assertEquals(LunStatus.Free, org.ovirt.engine.api.restapi.types.StorageLogicalUnitMapper.map(org.ovirt.engine.core.common.businessentities.LunStatus.Free, null)); assertEquals(LunStatus.Used, org.ovirt.engine.api.restapi.types.StorageLogicalUnitMapper.map(org.ovirt.engine.core.common.businessentities.LunStatus.Used, null)); assertEquals(LunStatus.Unusable, org.ovirt.engine.api.restapi.types.StorageLogicalUnitMapper.map(org.ovirt.engine.core.common.businessentities.LunStatus.Unusable, null)); }
public static void refreshVmsToolsVersion(org.ovirt.engine.core.compat.Guid poolId, java.util.Set<java.lang.String> isoList) { java.lang.String latestVersion = org.ovirt.engine.core.bll.VmHandler.getLatestGuestToolsVersion(isoList); if (latestVersion == null) { return; } java.util.List<org.ovirt.engine.core.common.businessentities.VM> vms = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVmDao().getAllForStoragePool(poolId); for (org.ovirt.engine.core.common.businessentities.VM vm : vms) { if (((vm.getAppList()) != null) && (vm.getAppList().toLowerCase().contains("rhev-tools"))) { java.util.regex.Matcher m = org.ovirt.engine.core.bll.VmHandler.TOOLS_PATTERN.matcher(vm.getAppList().toLowerCase()); if ((m.matches()) && ((m.groupCount()) > 0)) { java.lang.String toolsVersion = m.group(1); if (((toolsVersion.compareTo(latestVersion)) < 0) && ((vm.getGuestAgentStatus()) != (org.ovirt.engine.core.common.businessentities.GuestAgentStatus.UpdateNeeded))) { vm.setGuestAgentStatus(GuestAgentStatus.UpdateNeeded); org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVmDynamicDao().updateGuestAgentStatus(vm.getId(), vm.getGuestAgentStatus()); } } } } }
@java.lang.Override public void executeCommand(org.ovirt.engine.ui.uicommonweb.UICommand command) { super.executeCommand(command); if (command == (getNewCommand())) { newEntity(); } else if (command == (getEditCommand())) { edit(); } else if (command == (getRemoveCommand())) { remove(); } else if (command == (getMoveCommand())) { move(); } else if (command == (getCopyCommand())) { copy(); } else if (command == (getScanAlignmentCommand())) { scanAlignment(); } else if (org.ovirt.engine.core.compat.StringHelper.stringsEqual(command.getName(), "Cancel")) { cancel(); } else if (org.ovirt.engine.core.compat.StringHelper.stringsEqual(command.getName(), "CancelConfirm")) { cancelConfirm(); } else if (org.ovirt.engine.core.compat.StringHelper.stringsEqual(command.getName(), "OnRemove")) { onRemove(); } else if (command == (getChangeQuotaCommand())) { changeQuota(); } else if (command.getName().equals("onChangeQuota")) { onChangeQuota(); } }
@java.lang.Override public org.ovirt.engine.core.common.action.VdcReturnValueBase endAction() { try { return super.endAction(); } finally { org.ovirt.engine.core.bll.lsm.LiveMigrateVmDisksCommand.freeLock(); } }
private static void getDefaultConfigurationVersion(java.lang.Object target) { org.ovirt.engine.ui.frontend.AsyncQuery callback = new org.ovirt.engine.ui.frontend.AsyncQuery(target, new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { if (returnValue != null) { org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider._defaultConfigurationVersion = ((java.lang.String) (((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (returnValue)).getReturnValue())); } else { org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider._defaultConfigurationVersion = org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.GENERAL; } org.ovirt.engine.ui.uicommonweb.models.LoginModel loginModel = ((org.ovirt.engine.ui.uicommonweb.models.LoginModel) (model)); loginModel.getLoggedInEvent().raise(loginModel, EventArgs.Empty); } }); callback.setHandleFailure(true); org.ovirt.engine.ui.frontend.Frontend.RunQuery(VdcQueryType.GetDefaultConfigurationVersion, new org.ovirt.engine.core.common.queries.VdcQueryParametersBase(), callback); }
@java.lang.Override protected boolean canDoAction() { org.ovirt.engine.core.common.businessentities.AuditLog event = org.ovirt.engine.core.bll.RemoveAuditLogByIdCommand.getAuditLogDao().get(org.ovirt.engine.core.bll.RemoveAuditLogByIdCommand.getParameters().getAuditLogId()); if (event == null) { return failCanDoAction(VdcBllMessages.AUDIT_LOG_CANNOT_REMOVE_AUDIT_LOG_NOT_EXIST); } if ((!(AuditLogSeverity.ALERT.equals(event.getseverity()))) && (org.ovirt.engine.core.bll.RemoveAuditLogByIdCommand.OVIRT.equalsIgnoreCase(event.getOrigin()))) { return failCanDoAction(VdcBllMessages.ACTION_TYPE_FAILED_EXTERNAL_EVENT_ILLEGAL_ORIGIN); } return true; }
@java.lang.Override public org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc sparsifyVolume(java.lang.String jobId, java.util.Map<java.lang.String, java.lang.Object> volumeAddress) { org.ovirt.vdsm.jsonrpc.client.JsonRpcRequest request = new org.ovirt.vdsm.jsonrpc.client.RequestBuilder("SDM.sparsify_volume").withParameter("job_id", jobId).withParameter("vol_info", volumeAddress).build(); java.util.Map<java.lang.String, java.lang.Object> response = new org.ovirt.engine.core.vdsbroker.jsonrpc.FutureMap(this.client, request); return new org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc(response); }
@java.lang.Override public void run() { org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVdsDynamicDao().updatePartialVdsDynamicCalc(dstVdsId, 1, vm.getNumOfCpus(), vm.getMinAllocatedMem(), 0, 0); org.ovirt.engine.core.vdsbroker.MigrateVDSCommand.log.debugFormat("IncreasePendingVms::MigrateVm Increasing vds {0} pending vcpu count, in {1}, and pending vmem size, in {2}. Vm: {3}", dstVdsId, vm.getNumOfCpus(), vm.getMinAllocatedMem(), vm.getName()); }
@org.junit.Test public void testActionWithCorrelationId() throws java.lang.Exception { setUpGetEntityExpectations(false, false); expect(httpHeaders.getRequestHeader("Correlation-Id")).andReturn(asList("Some-Correlation-id")).anyTimes(); resource.setUriInfo(setUpActionExpectations(VdcActionType.UpdateVds, org.ovirt.engine.core.common.action.UpdateVdsActionParameters.class, new java.lang.String[]{ "RootPassword", "CorrelationId" }, new java.lang.Object[]{ NAMES[2], "Some-Correlation-id" }, true, true)); org.ovirt.engine.api.model.Action action = new org.ovirt.engine.api.model.Action(); action.setRootPassword(NAMES[2]); resource.install(action); }
@org.ovirt.api.metamodel.annotations.InputDetail default void inputDetail() { or(mandatory(cluster().id()), mandatory(cluster().name())); optional(clone()); optional(exclusive()); optional(template().name()); optional(registrationConfiguration()); }
private void setXmlOvfData() throws java.io.IOException { xmlOvfData = new java.lang.String(java.nio.file.Files.readAllBytes(java.nio.file.Paths.get(org.ovirt.engine.core.bll.ImportVMFromConfigurationCommandTest.VM_OVF_XML_DATA))); }
@java.lang.Override protected boolean canDoAction() { org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity glusterVolume = org.ovirt.engine.core.bll.gluster.GlusterAsyncCommandBase.getGlusterVolume(); if (!(super.canDoAction())) { return false; } if (!(org.ovirt.engine.core.common.gluster.GlusterFeatureSupported.glusterAsyncTasks(org.ovirt.engine.core.bll.gluster.GlusterAsyncCommandBase.getVdsGroup().getCompatibilityVersion()))) { addCanDoActionMessageVariable("compatibilityVersion", org.ovirt.engine.core.bll.gluster.GlusterAsyncCommandBase.getVdsGroup().getCompatibilityVersion().getValue()); return failCanDoAction(EngineMessage.GLUSTER_TASKS_NOT_SUPPORTED_FOR_CLUSTER_LEVEL); } if (!(glusterVolume.isOnline())) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_GLUSTER_VOLUME_SHOULD_BE_STARTED); } return true; }
public org.ovirt.engine.core.bll.ValidationResult isVirtIoScsiValid(org.ovirt.engine.core.common.businessentities.VM vm) { if ((org.ovirt.engine.core.common.businessentities.storage.DiskInterface.VirtIO_SCSI) != (disk.getDiskInterface())) { return org.ovirt.engine.core.bll.ValidationResult.VALID; } if ((disk.getSgio()) != null) { if ((org.ovirt.engine.core.common.businessentities.storage.DiskStorageType.IMAGE) == (disk.getDiskStorageType())) { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.SCSI_GENERIC_IO_IS_NOT_SUPPORTED_FOR_IMAGE_DISK); } } if (vm != null) { if (!(org.ovirt.engine.core.common.FeatureSupported.virtIoScsi(vm.getCompatibilityVersion()))) { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.VIRTIO_SCSI_INTERFACE_IS_NOT_AVAILABLE_FOR_CLUSTER_LEVEL); } if (!(isVirtioScsiControllerAttached(vm.getId()))) { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.CANNOT_PERFORM_ACTION_VIRTIO_SCSI_IS_DISABLED); } return isOsSupportedForVirtIoScsi(vm); } return org.ovirt.engine.core.bll.ValidationResult.VALID; }
@java.lang.Override protected void init(org.ovirt.engine.ui.uicommonweb.models.hosts.FenceAgentListModel listModel) { this.listModel = listModel; super.init(listModel); header.setText(org.ovirt.engine.ui.webadmin.widget.host.FenceAgentsEditor.constants.agentsBySequentialOrder()); newAgentLabel.setText(org.ovirt.engine.ui.webadmin.widget.host.FenceAgentsEditor.constants.addNewFenceAgent()); setEnabled(listModel.getIsChangable()); }
@org.ovirt.engine.ui.frontend.DefaultStringValue("Cannot ${action} ${type}. iSCSI Bond is only supported on Data Center compatibility versions 3.4 and higher.") java.lang.String ISCSI_BOND_NOT_SUPPORTED();
protected boolean setAndValidateDiskProfiles() { org.ovirt.engine.core.bll.MoveOrCopyDiskCommand.getImage().setDiskProfileId(org.ovirt.engine.core.bll.MoveOrCopyDiskCommand.getParameters().getDiskProfileId()); return validate(org.ovirt.engine.core.bll.profiles.DiskProfileHelper.setAndValidateDiskProfiles(java.util.Collections.singletonMap(org.ovirt.engine.core.bll.MoveOrCopyDiskCommand.getImage(), org.ovirt.engine.core.bll.MoveOrCopyDiskCommand.getParameters().getStorageDomainId()), org.ovirt.engine.core.bll.MoveOrCopyDiskCommand.getStoragePool().getCompatibilityVersion(), org.ovirt.engine.core.bll.MoveOrCopyDiskCommand.getCurrentUser())); }
@java.lang.Override public org.ovirt.engine.core.common.businessentities.VdcOption getByNameAndVersion(java.lang.String name, java.lang.String version) { org.springframework.jdbc.core.namedparam.MapSqlParameterSource parameterSource = getCustomMapSqlParameterSource().addValue("option_name", name).addValue("version", version); return getCallsHandler().executeRead("GetVdcOptionByName", org.ovirt.engine.core.dao.VdcOptionDaoImpl.VdcOptionRowMapper.instance, parameterSource); }
protected void postDataCentersLoaded(final java.util.List<org.ovirt.engine.core.common.businessentities.StoragePool> dataCenters) { org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getClusterListByService(new org.ovirt.engine.ui.frontend.AsyncQuery(getModel(), new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object target, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel model = ((org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel) (target)); model.setDataCentersAndClusters(model, dataCenters, ((java.util.List<org.ovirt.engine.core.common.businessentities.VDSGroup>) (returnValue)), null); initCdImage(); getPoolModelBehaviorInitializedEvent().raise(this, EventArgs.EMPTY); } }, getModel().getHash()), true, false); }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.Permission> getAllForRoleAndAdElement(org.ovirt.engine.core.compat.Guid roleid, org.ovirt.engine.core.compat.Guid elementid) { org.springframework.jdbc.core.namedparam.MapSqlParameterSource parameterSource = getCustomMapSqlParameterSource().addValue("role_id", roleid).addValue("ad_element_id", elementid); return getCallsHandler().executeReadList("GetPermissionsByRoleIdAndAdElementId", org.ovirt.engine.core.dao.PermissionDaoImpl.PermissionRowMapper.instance, parameterSource); }
@org.junit.Test public void testDelete() { dao.remove(FixturesTool.EXISTING_VM_JOB); java.util.List<org.ovirt.engine.core.compat.Guid> ids = dao.getAllIds(); assertTrue(ids.remove(FixturesTool.EXISTING_VM_BLOCK_JOB)); assertTrue(ids.isEmpty()); }
@java.lang.Override public javax.ws.rs.core.Response remove() { org.ovirt.engine.api.model.StorageDomain storageDomain = get(); if (storageDomain.getStorage().getType().equals(StorageType.LOCALFS.value())) { org.ovirt.engine.core.common.action.RemoveStorageDomainParameters params = new org.ovirt.engine.core.common.action.RemoveStorageDomainParameters(guid); params.setDoFormat(true); return performAction(VdcActionType.RemoveStorageDomain, params); } else { org.ovirt.engine.core.common.action.DetachStorageDomainFromPoolParameters params = new org.ovirt.engine.core.common.action.DetachStorageDomainFromPoolParameters(guid, dataCenterId); return performAction(VdcActionType.DetachStorageDomainFromPool, params); } }
public org.ovirt.engine.core.common.businessentities.DiskImage getImageAsDiskImage(java.lang.String id) { org.ovirt.engine.core.common.businessentities.DiskImage diskImage = new org.ovirt.engine.core.common.businessentities.DiskImage(); com.woorea.openstack.glance.model.Image glanceImage = getClient().images().show(id).execute(); validateContainerFormat(glanceImage); java.lang.String shortHash = glanceImage.getId().substring(0, 7); diskImage.setDiskAlias(("GlanceDisk-" + shortHash)); if ((glanceImage.getName()) != null) { diskImage.setDiskDescription(((((glanceImage.getName()) + " (") + shortHash) + ")")); } else { diskImage.setDiskDescription(("Glance disk: " + shortHash)); } diskImage.setSize(getImageVirtualSize(glanceImage)); diskImage.setActualSizeInBytes(glanceImage.getSize()); if (glanceImage.getDiskFormat().equals(org.ovirt.engine.core.bll.provider.OpenstackImageProviderProxy.GlanceImageFormat.RAW.getValue())) { diskImage.setvolumeFormat(VolumeFormat.RAW); } else if (glanceImage.getDiskFormat().equals(org.ovirt.engine.core.bll.provider.OpenstackImageProviderProxy.GlanceImageFormat.COW.getValue())) { diskImage.setvolumeFormat(VolumeFormat.COW); } else { throw new java.lang.RuntimeException(("Unknown disk format: " + (glanceImage.getDiskFormat()))); } return diskImage; }
@java.lang.Override public org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturn addVmLease(java.lang.String leaseUUID, java.lang.String sdUUID) { java.util.HashMap<java.lang.String, java.lang.Object> leaseDict = new java.util.HashMap<>(); leaseDict.put("lease_id", leaseUUID); leaseDict.put("sd_id", sdUUID); org.ovirt.vdsm.jsonrpc.client.JsonRpcRequest request = new org.ovirt.vdsm.jsonrpc.client.RequestBuilder("Lease.create").withParameter("lease", leaseDict).build(); java.util.Map<java.lang.String, java.lang.Object> response = new org.ovirt.engine.core.vdsbroker.jsonrpc.FutureMap(this.client, request); return new org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturn(response); }
@java.lang.Override protected void executeQueryCommand() { java.util.List<org.ovirt.engine.core.common.businessentities.VM> vms = org.ovirt.engine.core.bll.GetVmsRelatedToQuotaIdQuery.getDbFacade().getVmDao().getAllVmsRelatedToQuotaId(org.ovirt.engine.core.bll.GetVmsRelatedToQuotaIdQuery.getParameters().getQuotaId()); for (org.ovirt.engine.core.common.businessentities.VM vm : vms) { org.ovirt.engine.core.bll.VmHandler.updateDisksFromDb(vm); java.util.Collections.sort(vm.getDiskList(), new org.ovirt.engine.core.common.businessentities.comparators.ImagesComparerByName()); org.ovirt.engine.core.bll.ImagesHandler.fillImagesBySnapshots(vm); } org.ovirt.engine.core.bll.GetVmsRelatedToQuotaIdQuery.getQueryReturnValue().setReturnValue(vms); }
@java.lang.Override protected void executeQueryCommand() { org.ovirt.engine.core.bll.storage.DiscoverSendTargetsQuery.getQueryReturnValue().setReturnValue(runVdsCommand(VDSCommandType.DiscoverSendTargets, new org.ovirt.engine.core.common.vdscommands.DiscoverSendTargetsVDSCommandParameters(org.ovirt.engine.core.bll.storage.DiscoverSendTargetsQuery.getParameters().getVdsId(), org.ovirt.engine.core.bll.storage.DiscoverSendTargetsQuery.getParameters().getConnection())).getReturnValue()); }
private void setRngSourcesCheckboxes(org.ovirt.engine.core.compat.Version ver) { boolean rngSupported = isRngSupportedForClusterVersion(ver); getRngRandomSourceRequired().setIsChangable(rngSupported); getRngHwrngSourceRequired().setIsChangable(rngSupported); java.lang.String defaultRequiredRngSourcesCsv = defaultClusterRngSourcesCsv(ver); if (rngSupported) { getRngRandomSourceRequired().setEntity((getIsNew() ? defaultRequiredRngSourcesCsv.contains(VmRngDevice.Source.RANDOM.toString()) : getEntity().getRequiredRngSources().contains(VmRngDevice.Source.RANDOM))); getRngHwrngSourceRequired().setEntity((getIsNew() ? defaultRequiredRngSourcesCsv.contains(VmRngDevice.Source.HWRNG.toString()) : getEntity().getRequiredRngSources().contains(VmRngDevice.Source.HWRNG))); } else { getRngRandomSourceRequired().setEntity(false); getRngHwrngSourceRequired().setEntity(false); getRngRandomSourceRequired().setChangeProhibitionReason(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().rngNotSupportedByClusterCV()); getRngHwrngSourceRequired().setChangeProhibitionReason(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().rngNotSupportedByClusterCV()); } }
@org.junit.Test public void externalNetworkPortMirroring() throws java.lang.Exception { externalNetworkPortMirroringTest(true, true, org.ovirt.engine.core.bll.validator.ValidationResultMatchers.failsWith(EngineMessage.ACTION_TYPE_FAILED_EXTERNAL_NETWORK_CANNOT_BE_PORT_MIRRORED)); }
protected <T> T getEntity(java.lang.Class<T> clz, org.ovirt.engine.core.common.interfaces.SearchType searchType, java.lang.String constraint) { try { org.ovirt.engine.core.common.queries.VdcQueryReturnValue result = runQuery(VdcQueryType.Search, new org.ovirt.engine.core.common.queries.SearchParameters(constraint, searchType)); if (!(result.getSucceeded())) { backendFailure(result.getExceptionString()); } T entity; if ((java.util.List.class.isAssignableFrom(clz)) && ((result.getReturnValue()) instanceof java.util.List)) { entity = clz.cast(result.getReturnValue()); } else { java.util.List<T> list = asCollection(clz, result.getReturnValue()); if ((list == null) || (list.isEmpty())) { throw new org.ovirt.engine.api.restapi.resource.EntityNotFoundException(constraint); } entity = clz.cast(list.get(0)); } return entity; } catch (java.lang.Exception e) { return handleError(clz, e, false); } }
@java.lang.Override public void initialize() { super.initialize(); disableNonChangeableEntities(); getAlias().setEntity(getDisk().getDiskAlias()); getDescription().setEntity(getDisk().getDiskDescription()); getIsShareable().setEntity(getDisk().isShareable()); getIsWipeAfterDelete().setEntity(getDisk().isWipeAfterDelete()); getIsScsiPassthrough().setEntity(getDisk().isScsiPassthrough()); getIsSgIoUnfiltered().setEntity(((getDisk().getSgio()) == (org.ovirt.engine.core.common.businessentities.storage.ScsiGenericIO.UNFILTERED))); getIsReadOnly().setEntity(getDisk().getReadOnly()); if ((getDisk().getDiskStorageType()) == (org.ovirt.engine.core.common.businessentities.storage.DiskStorageType.IMAGE)) { org.ovirt.engine.core.common.businessentities.storage.DiskImage diskImage = ((org.ovirt.engine.core.common.businessentities.storage.DiskImage) (getDisk())); getDiskStorageType().setEntity(DiskStorageType.IMAGE); getSize().setEntity(((int) (diskImage.getSizeInGigabytes()))); getVolumeType().setSelectedItem(diskImage.getVolumeType()); setVolumeFormat(diskImage.getVolumeFormat()); boolean isExtendImageSizeEnabled = (((getVm()) != null) && (!(diskImage.isDiskSnapshot()))) && (org.ovirt.engine.core.common.VdcActionUtils.canExecute(java.util.Arrays.asList(getVm()), org.ovirt.engine.core.common.businessentities.VM.class, VdcActionType.ExtendImageSize)); getSizeExtend().setIsChangable(isExtendImageSizeEnabled); } else { org.ovirt.engine.core.common.businessentities.storage.LunDisk lunDisk = ((org.ovirt.engine.core.common.businessentities.storage.LunDisk) (getDisk())); getDiskStorageType().setEntity(DiskStorageType.LUN); getSize().setEntity(lunDisk.getLun().getDeviceSize()); getSizeExtend().setIsAvailable(false); } updateReadOnlyChangeability(); updateWipeAfterDeleteChangeability(); }
public org.ovirt.engine.core.compat.Guid getVdsGroupId() { return vdsStatic.getVdsGroupId(); }
public void setSwapTotal(java.lang.Long value) { vdsStatistics.setSwapTotal(value); }
@java.lang.Override public org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc reconstructMaster(java.lang.String spUUID, java.lang.String poolName, java.lang.String masterDom, java.util.Map<java.lang.String, java.lang.String> domDict, int masterVersion, java.lang.String lockPolicy, int lockRenewalIntervalSec, int leaseTimeSec, int ioOpTimeoutSec, int leaseRetries, int hostSpmId) { try { java.util.Map<java.lang.String, java.lang.Object> xmlRpcReturnValue = vdsServer.reconstructMaster(spUUID, poolName, masterDom, domDict, masterVersion, lockPolicy, lockRenewalIntervalSec, leaseTimeSec, ioOpTimeoutSec, leaseRetries, hostSpmId); org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc wrapper = new org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc(xmlRpcReturnValue); return wrapper; } catch (java.lang.reflect.UndeclaredThrowableException ute) { throw new org.ovirt.engine.core.vdsbroker.xmlrpc.XmlRpcRunTimeException(ute); } }
@org.junit.Test public void imageNotProvidedForOvirtNode() { mockOvirtNode(); assertThat(validator.imageProvidedForOvirtNode(null), org.ovirt.engine.core.bll.validator.ValidationResultMatchers.failsWith(EngineMessage.VDS_CANNOT_INSTALL_MISSING_IMAGE_FILE)); }
@java.lang.Override public java.lang.Boolean getValue() { for (java.lang.Object model : clustersTable.flush().getItems()) { org.ovirt.engine.ui.uicommonweb.models.datacenters.NetworkClusterModel networkClusterModel = ((org.ovirt.engine.ui.uicommonweb.models.datacenters.NetworkClusterModel) (model)); if (networkClusterModel.getIsChangable()) { if (!(networkClusterModel.isAttached())) { return false; } } } return true; }
@java.lang.Override protected boolean canDoAction() { boolean retValue = true; if ((org.ovirt.engine.core.bll.ChangeDiskCommand.getVm()) == null) { addCanDoActionMessage(VdcBllMessages.ACTION_TYPE_FAILED_VM_NOT_EXIST); retValue = false; } if (retValue && (!(org.ovirt.engine.core.bll.ChangeDiskCommand.canRunActionOnNonManagedVm()))) { retValue = false; } if (retValue && (!(org.ovirt.engine.core.bll.ChangeDiskCommand.getVm().isRunningOrPaused()))) { org.ovirt.engine.core.bll.ChangeDiskCommand.setSucceeded(false); retValue = false; addCanDoActionMessage(VdcBllMessages.VAR__TYPE__VM); if (!(org.apache.commons.lang.StringUtils.isEmpty(mCdImagePath))) { addCanDoActionMessage(VdcBllMessages.VAR__ACTION__CHANGE_CD); } else { addCanDoActionMessage(VdcBllMessages.VAR__ACTION__EJECT_CD); } failCanDoAction(VdcBllMessages.ACTION_TYPE_FAILED_VM_STATUS_ILLEGAL, org.ovirt.engine.core.bll.validator.LocalizedVmStatus.from(org.ovirt.engine.core.bll.ChangeDiskCommand.getVm().getStatus())); } else if (((org.ovirt.engine.core.bll.IsoDomainListSyncronizer.getInstance().findActiveISODomain(org.ovirt.engine.core.bll.ChangeDiskCommand.getVm().getStoragePoolId())) == null) && (!(org.apache.commons.lang.StringUtils.isEmpty(mCdImagePath)))) { addCanDoActionMessage(VdcBllMessages.VAR__ACTION__CHANGE_CD); addCanDoActionMessage(VdcBllMessages.VM_CANNOT_WITHOUT_ACTIVE_STORAGE_DOMAIN_ISO); org.ovirt.engine.core.bll.ChangeDiskCommand.setSucceeded(false); retValue = false; } return retValue; }
public java.lang.String getFirstMetadataDevice() { return getStorageStaticData().getFirstMetadataDevice(); }
@java.lang.Override public void dataCenterWithClusterSelectedItemChanged() { super.dataCenterWithClusterSelectedItemChanged(); org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getVmDiskList(new org.ovirt.engine.ui.frontend.AsyncQuery(this, new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object target, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.models.vms.NewTemplateVmModelBehavior behavior = ((org.ovirt.engine.ui.uicommonweb.models.vms.NewTemplateVmModelBehavior) (target)); java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Disk> imageDisks = new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Disk>(); java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Disk> vmDisks = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Disk>) (returnValue)); for (org.ovirt.engine.core.common.businessentities.Disk disk : vmDisks) { if (((disk.getDiskStorageType()) == (org.ovirt.engine.core.common.businessentities.Disk.DiskStorageType.IMAGE)) && (!(disk.isShareable()))) { imageDisks.add(disk); } } behavior.initStorageDomains(); initDisks(imageDisks); org.ovirt.engine.ui.uicommonweb.models.vms.VmModelHelper.sendWarningForNonExportableDisks(getModel(), vmDisks, VmModelHelper.WarningType.VM_TEMPLATE); } }, getModel().getHash()), vm.getId(), true); }
@java.lang.Override public void setMainTabSelectedItem(org.ovirt.engine.core.common.businessentities.VDSGroup selectedItem) { driver.edit(getDetailModel()); form.update(); }
private void InitializeHelpers() { try { for (org.ovirt.engine.core.common.businessentities.StorageType storageType : org.ovirt.engine.core.common.businessentities.StorageType.values()) { java.lang.Class<?> actionType = null; java.lang.String formattedClassName = java.lang.String.format("%1$s.%2$s%3$s", org.ovirt.engine.core.bll.storage.StorageHelperDirector.ACTION_TYPE_PACKAGE, storageType.name(), org.ovirt.engine.core.bll.storage.StorageHelperDirector.ACTION_TYPE_CLASS); try { actionType = java.lang.Class.forName(formattedClassName); } catch (java.lang.ClassNotFoundException cnfe) { org.ovirt.engine.core.bll.storage.StorageHelperDirector.log.error(("StorageHelperDirector Error:: the lookup for following class has failed: " + formattedClassName), cnfe); } if (actionType != null) { java.lang.reflect.Constructor<?> info = actionType.getConstructors()[0]; org.ovirt.engine.core.bll.storage.IStorageHelper currentHelper = ((org.ovirt.engine.core.bll.storage.IStorageHelper) (info.newInstance(null))); _helpers.put(storageType, currentHelper); } } } catch (java.lang.Exception ex) { org.ovirt.engine.core.bll.storage.StorageHelperDirector.log.error("StorageHelperDirector Error:: exception was encountered during InitializeHelpers() execution", ex); throw new org.ovirt.engine.core.compat.ApplicationException("JTODO missing exception", ex); } }
@org.ovirt.engine.ui.common.DefaultStringValue("Watchdog Model") java.lang.String watchdogModel();
protected void setXmlResponse(java.lang.String path, final int code, final java.lang.String body, final int delay) { io.undertow.server.HttpHandler xmlResponseHandler = new io.undertow.server.HttpHandler() { @java.lang.Override public void handleRequest(io.undertow.server.HttpServerExchange exchange) throws java.lang.Exception { lastRequestQuery = exchange.getQueryString(); if (!(exchange.getRequestHeaders().getFirst("Authorization").equals(("Bearer " + (org.ovirt.engine.sdk4.ServerTest.TOKEN))))) { exchange.setStatusCode(401); exchange.getResponseSender().send(""); } else { java.lang.Thread.sleep(delay); exchange.setStatusCode(code); exchange.getResponseHeaders().put(Headers.CONTENT_TYPE, "application/xml"); exchange.getResponseSender().send(body); } } }; testHandler().addPrefixPath((((testPrefix()) + "/api/") + path), xmlResponseHandler); }
@com.google.gwt.uibinder.client.UiHandler("container") void onDragLeave(com.google.gwt.event.dom.client.DragLeaveEvent event) { container.setStyleName(style.validDropTarget(), false); }
protected org.ovirt.engine.core.bll.validator.RunVmValidator getRunVmValidator() { return org.ovirt.engine.core.bll.RunVmCommand.runVmValidator; }
@java.lang.Override protected void executeCommand() { org.ovirt.engine.core.bll.storage.domain.UpdateStorageDomainCommand.getStorageDomainStaticDao().update(org.ovirt.engine.core.bll.storage.domain.UpdateStorageDomainCommand.getStorageDomain().getStorageStaticData()); if ((storageDomainNameChanged) && ((org.ovirt.engine.core.bll.storage.domain.UpdateStorageDomainCommand.getStoragePool()) != null)) { runVdsCommand(VDSCommandType.SetStorageDomainDescription, new org.ovirt.engine.core.common.vdscommands.SetStorageDomainDescriptionVDSCommandParameters(org.ovirt.engine.core.bll.storage.domain.UpdateStorageDomainCommand.getStoragePool().getId(), org.ovirt.engine.core.bll.storage.domain.UpdateStorageDomainCommand.getStorageDomain().getId(), org.ovirt.engine.core.bll.storage.domain.UpdateStorageDomainCommand.getStorageDomain().getStorageName())); } org.ovirt.engine.core.bll.storage.domain.UpdateStorageDomainCommand.setSucceeded(true); }
private void setHostname(org.ovirt.engine.ui.uicommonweb.models.EntityModel<java.lang.String> value) { privateHostname = value; }
private java.util.List<org.ovirt.engine.core.common.businessentities.VDS> runInternalFilters(java.util.ArrayList<org.ovirt.engine.core.bll.scheduling.PolicyUnitImpl> filters, java.util.List<org.ovirt.engine.core.common.businessentities.VDS> hostList, org.ovirt.engine.core.common.businessentities.VM vm, java.util.Map<java.lang.String, java.lang.String> parameters, java.util.Map<org.ovirt.engine.core.compat.Guid, java.lang.Integer> filterPositionMap, java.util.List<java.lang.String> messages, org.ovirt.engine.core.bll.scheduling.VdsFreeMemoryChecker memoryChecker, java.lang.String correlationId, org.ovirt.engine.core.bll.scheduling.SchedulingManager.SchedulingResult result) { if (filters != null) { for (org.ovirt.engine.core.bll.scheduling.PolicyUnitImpl filterPolicyUnit : filters) { if ((hostList == null) || (hostList.isEmpty())) { break; } filterPolicyUnit.setMemoryChecker(memoryChecker); java.util.List<org.ovirt.engine.core.common.businessentities.VDS> currentHostList = new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VDS>(hostList); hostList = filterPolicyUnit.filter(hostList, vm, parameters, messages); logFilterActions(currentHostList, toIdSet(hostList), VdcBllMessages.VAR__FILTERTYPE__INTERNAL, filterPolicyUnit.getName(), result, correlationId); } } return hostList; }
@java.lang.Override protected void onClose() { handleEscapeKey(); }
@org.ovirt.engine.ui.webadmin.DefaultMessage("{0} out of unlimited vCPUs") java.lang.String unlimitedVcpuConsumption(int vcpu);
public org.ovirt.engine.core.bll.ValidationResult networkNotChanged(org.ovirt.engine.core.common.businessentities.network.NetworkAttachment oldAttachment) { org.ovirt.engine.core.compat.Guid oldAttachmentId = (oldAttachment == null) ? null : oldAttachment.getId(); boolean when = (oldAttachment != null) && (!(java.util.Objects.equals(oldAttachment.getNetworkId(), attachment.getNetworkId()))); return org.ovirt.engine.core.bll.ValidationResult.failWith(EngineMessage.CANNOT_CHANGE_ATTACHED_NETWORK, org.ovirt.engine.core.utils.ReplacementUtils.createSetVariableString(org.ovirt.engine.core.bll.validator.NetworkAttachmentValidator.VAR_NETWORK_ATTACHMENT_ID, oldAttachmentId)).when(when); }
@java.lang.Override protected void executeNetworkCommand(org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkItemModel<?> op1, org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkItemModel<?> op2, java.util.List<org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface> allNics, java.lang.Object... params) { org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkOperation.DETACH_NETWORK.getCommand(op1, op2, allNics).execute(); }
public org.ovirt.engine.core.bll.ValidationResult isUp() { if (((storagePool) == null) || ((storagePool.getStatus()) != (org.ovirt.engine.core.common.businessentities.StoragePoolStatus.Up))) { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_IMAGE_REPOSITORY_NOT_FOUND); } return org.ovirt.engine.core.bll.ValidationResult.VALID; }
private void newInternal() { org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel model = new org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel(new org.ovirt.engine.ui.uicommonweb.models.vms.UserPortalNewVmModelBehavior()); model.getVmType().setSelectedItem(VmType.Server); model.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().newVmTitle()); model.setHelpTag(HelpTag.new_vm); model.setHashName("new_vm"); model.setIsNew(true); model.setCustomPropertiesKeysList(CustomPropertiesKeysList); setWindow(model); model.initialize(null); org.ovirt.engine.ui.uicommonweb.models.vms.VmBasedWidgetSwitchModeCommand switchModeCommand = new org.ovirt.engine.ui.uicommonweb.models.vms.VmBasedWidgetSwitchModeCommand(); switchModeCommand.init(model); model.getCommands().add(switchModeCommand); model.getProvisioning().setEntity(true); org.ovirt.engine.ui.uicommonweb.UICommand tempVar = new org.ovirt.engine.ui.uicommonweb.UICommand("OnSave", this); tempVar.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().ok()); tempVar.setIsDefault(true); model.getCommands().add(tempVar); org.ovirt.engine.ui.uicommonweb.UICommand tempVar2 = new org.ovirt.engine.ui.uicommonweb.UICommand("Cancel", this); tempVar2.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().cancel()); tempVar2.setIsCancel(true); model.getCommands().add(tempVar2); }
java.util.List<org.ovirt.engine.core.common.businessentities.network.VnicProfileView> getAllForNetworkQos(org.ovirt.engine.core.compat.Guid qosId);
protected void beforeReadResponse(java.net.HttpURLConnection connection) throws java.lang.Exception { if (((connection.getResponseCode()) != (java.net.HttpURLConnection.HTTP_OK)) && ((connection.getResponseCode()) != (java.net.HttpURLConnection.HTTP_MOVED_TEMP))) { throw new org.ovirt.engine.core.common.errors.EngineException(org.ovirt.engine.core.common.errors.EngineError.PROVIDER_FAILURE); } }
@org.junit.Test public void testNicExistsWhenNicNameIsNull() { org.ovirt.engine.core.common.businessentities.network.NetworkAttachment attachment = new org.ovirt.engine.core.common.businessentities.network.NetworkAttachment(); attachment.setNicName(null); assertThat(createNetworkAttachmentValidator(attachment).nicNameIsSet(), org.ovirt.engine.core.bll.validator.ValidationResultMatchers.failsWith(EngineMessage.HOST_NETWORK_INTERFACE_DOES_NOT_HAVE_NAME_SET)); }
@java.lang.Override protected boolean canDoAction() { if (!(super.canDoAction())) { return false; } if (!(isRngSupportedByCluster())) { return failCanDoAction(VdcBllMessages.ACTION_NOT_SUPPORTED_FOR_CLUSTER_POOL_LEVEL); } if (getRngDevices().isEmpty()) { return failCanDoAction(VdcBllMessages.ACTION_TYPE_FAILED_RNG_NOT_FOUND); } return true; }
@java.lang.Override public java.util.List<java.lang.String> getNetworkDevices(int osId, org.ovirt.engine.core.compat.Version version) { java.lang.String devices = getValueByVersion(idToUnameLookup.get(osId), "devices.network", version); return org.ovirt.engine.core.utils.OsRepositoryImpl.trimElements(devices.split(",")); }
@java.lang.Override public void edit(org.ovirt.engine.ui.uicommonweb.models.hosts.NicLabelModel model) { suggestions = model.getSuggestedLabels(); super.edit(model); }
@java.lang.Override protected void executeCommand() { org.ovirt.engine.core.common.businessentities.TagsVdsMap map; if ((org.ovirt.engine.core.bll.AttachVdsToTagCommand.getTagId()) != null) { for (org.ovirt.engine.core.compat.Guid vdsId : org.ovirt.engine.core.bll.AttachVdsToTagCommand.getVdsList()) { org.ovirt.engine.core.common.businessentities.VDS vds = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVdsDao().get(vdsId); if ((org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getTagDao().getTagVdsByTagIdAndByVdsId(org.ovirt.engine.core.bll.AttachVdsToTagCommand.getTagId(), vdsId)) == null) { if (vds != null) { appendCustomValue("VdsNames", vds.getVdsName(), ", "); } map = new org.ovirt.engine.core.common.businessentities.TagsVdsMap(org.ovirt.engine.core.bll.AttachVdsToTagCommand.getTagId(), vdsId); org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getTagDao().attachVdsToTag(map); noActionDone = false; } else { if (vds != null) { appendCustomValue("VdsNamesExists", vds.getVdsName(), ", "); } } } } org.ovirt.engine.core.bll.AttachVdsToTagCommand.setSucceeded(true); }
@org.junit.Test public void canDoActionFailsOnNullHookId() { cmd = spy(new org.ovirt.engine.core.bll.gluster.DisableGlusterHookCommand(new org.ovirt.engine.core.common.action.gluster.GlusterHookParameters(CLUSTER_ID, null))); setupMocks(cmd); assertFalse(cmd.canDoAction()); assertTrue(cmd.getReturnValue().getCanDoActionMessages().contains(VdcBllMessages.ACTION_TYPE_FAILED_GLUSTER_HOOK_ID_IS_REQUIRED.toString())); }
protected java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase> getParameters() { java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase> parameters = new java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase>(); for (org.ovirt.engine.ui.uicommonweb.models.vms.DiskModel diskModel : getDisks()) { org.ovirt.engine.core.common.businessentities.StorageDomain destStorageDomain = ((org.ovirt.engine.core.common.businessentities.StorageDomain) (diskModel.getStorageDomain().getSelectedItem())); org.ovirt.engine.core.common.businessentities.StorageDomain sourceStorageDomain = ((org.ovirt.engine.core.common.businessentities.StorageDomain) (diskModel.getSourceStorageDomain().getSelectedItem())); org.ovirt.engine.core.compat.Guid sourceStorageDomainGuid = (sourceStorageDomain != null) ? sourceStorageDomain.getId() : org.ovirt.engine.core.compat.Guid.Empty; org.ovirt.engine.core.common.businessentities.DiskImage disk = ((org.ovirt.engine.core.common.businessentities.DiskImage) (diskModel.getDisk())); if ((diskModel.getQuota().getSelectedItem()) != null) { disk.setQuotaId(((org.ovirt.engine.core.common.businessentities.Quota) (diskModel.getQuota().getSelectedItem())).getId()); } if ((destStorageDomain == null) || (sourceStorageDomain == null)) { continue; } org.ovirt.engine.core.compat.Guid destStorageDomainGuid = destStorageDomain.getId(); addMoveOrCopyParameters(parameters, sourceStorageDomainGuid, destStorageDomainGuid, disk); } return parameters; }
@java.lang.Override public java.lang.String getValue(org.ovirt.engine.core.common.businessentities.gluster.StorageDevice entity) { return entity.getName(); }
private boolean supportsGlusterDiskProvisioning(org.ovirt.engine.core.common.businessentities.VDSGroup cluster) { return (cluster.supportsGlusterService()) && (getGlusterUtil().isGlusterBrickProvisioningSupported(cluster.getCompatibilityVersion(), cluster.getId())); }
private org.snmp4j.Snmp createSnmp3(org.ovirt.engine.core.notifier.transport.snmp.Snmp.Profile profile) { try { org.snmp4j.TransportMapping<?> transport = new org.snmp4j.transport.DefaultUdpTransportMapping(); org.snmp4j.Snmp snmp = new org.snmp4j.Snmp(transport); org.snmp4j.security.SecurityProtocols securityProtocols = org.snmp4j.security.SecurityProtocols.getInstance(); securityProtocols.addDefaultProtocols(); securityProtocols.addAuthenticationProtocol(new org.snmp4j.security.AuthMD5()); securityProtocols.addAuthenticationProtocol(new org.snmp4j.security.AuthSHA()); securityProtocols.addPrivacyProtocol(new org.snmp4j.security.PrivAES128()); securityProtocols.addPrivacyProtocol(new org.snmp4j.security.PrivAES192()); securityProtocols.addPrivacyProtocol(new org.snmp4j.security.PrivAES256()); org.snmp4j.security.USM usm = new org.snmp4j.security.USM(securityProtocols, profile.engineId, 0); ((org.snmp4j.mp.MPv3) (snmp.getMessageProcessingModel(org.ovirt.engine.core.notifier.transport.snmp.org.snmp4j.mp.MPv3))).setLocalEngineID(profile.engineId.getValue()); ((org.snmp4j.mp.MPv3) (snmp.getMessageProcessingModel(org.ovirt.engine.core.notifier.transport.snmp.org.snmp4j.mp.MPv3))).getSecurityModels().addSecurityModel(usm); org.snmp4j.security.SecurityModels.getInstance().addSecurityModel(usm); transport.listen(); snmp.getUSM().addUser(profile.username, getUsmUser(profile)); return snmp; } catch (java.io.IOException e) { throw new org.ovirt.engine.core.notifier.NotificationServiceException(("error creating version 3 snmp " + (getClass().getName()))); } }
public final boolean IsDynamicVariable(java.lang.String strMessage) { return strMessage.startsWith("$"); }
private org.ovirt.engine.core.common.businessentities.Snapshot getActiveSnapshot() { for (org.ovirt.engine.core.common.businessentities.Snapshot snapshot : getVm().getSnapshots()) { if ((snapshot.getType()) == (org.ovirt.engine.core.common.businessentities.Snapshot.SnapshotType.ACTIVE)) return snapshot; } org.ovirt.engine.core.bll.ImportVmCommand.log.warn("VM '{}' doesn't have active snapshot in export domain", getVmId()); return null; }
@java.lang.Override protected void executeVmCommand() { vmHandler.warnMemorySizeLegal(org.ovirt.engine.core.bll.AddVmCommand.getParameters().getVm().getStaticData(), org.ovirt.engine.core.bll.AddVmCommand.getEffectiveCompatibilityVersion()); java.util.List<java.lang.String> errorMessages = new java.util.ArrayList<>(); if (!(canAddVm(errorMessages, destStorages.values()))) { log.error("Failed to add VM. The reasons are: {}", java.lang.String.join(",", errorMessages)); return; } if (!(addVmLease(org.ovirt.engine.core.bll.AddVmCommand.getParameters().getVm().getLeaseStorageDomainId(), org.ovirt.engine.core.bll.AddVmCommand.getVmId()))) { return; } org.ovirt.engine.core.utils.transaction.TransactionSupport.executeInNewTransaction(() -> { addVmStatic(); addVmDynamic(); addVmNetwork(); addVmNumaNodes(); addVmStatistics(); addActiveSnapshot(); addVmPermission(); addVmInit(); addVmRngDevice(); getCompensationContext().stateChanged(); return null; }); if (addVmImages()) { org.ovirt.engine.core.utils.transaction.TransactionSupport.executeInNewTransaction(() -> { copyDiskVmElements(); copyVmDevices(); addDiskPermissions(); addVmPayload(); updateSmartCardDevices(); addVmWatchdog(); addGraphicsDevice(); getVmDeviceUtils().updateVirtioScsiController(getVm().getStaticData(), getParameters().isVirtioScsiEnabled()); setActionReturnValue(getVm().getId()); setSucceeded(true); return null; }); } if ((org.ovirt.engine.core.bll.AddVmCommand.getParameters().getPoolId()) != null) { addVmToPool(); } discardHelper.logIfDisksWithIllegalPassDiscardExist(org.ovirt.engine.core.bll.AddVmCommand.getVmId()); }
@org.ovirt.engine.ui.frontend.DefaultStringValue("Cannot ${action} ${type}. IP address has to be set for the NIC that bears a role network. Network: ${NetworkName}, Nic: ${nicName} on host ${hostName} violates that rule.") java.lang.String NETWORK_ADDR_MANDATORY_FOR_ROLE_NETWORK();
@java.lang.Override protected void buildModel(org.ovirt.engine.core.common.businessentities.VmBase vm, BuilderExecutor.BuilderExecutionFinished<org.ovirt.engine.core.common.businessentities.VmBase, org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel> callback) { new org.ovirt.engine.ui.uicommonweb.builders.BuilderExecutor(callback, new org.ovirt.engine.ui.uicommonweb.builders.vm.NameAndDescriptionVmBaseToUnitBuilder(), new org.ovirt.engine.ui.uicommonweb.builders.vm.CommentVmBaseToUnitBuilder(), new org.ovirt.engine.ui.uicommonweb.builders.vm.CommonVmBaseToUnitBuilder()).build(vm, getModel()); }
@java.lang.Override protected org.ovirt.engine.api.model.Applications getEntity(int index) { return null; }
java.util.List<org.ovirt.engine.core.common.businessentities.Network> getAllForCluster(org.ovirt.engine.core.compat.Guid id);
@java.lang.Override public java.util.List<java.lang.String> getWatchDogModels(int osId, org.ovirt.engine.core.compat.Version version) { java.lang.String models = getValueByVersion(idToUnameLookup.get(osId), "devices.watchdog.models", version); return org.ovirt.engine.core.utils.OsRepositoryImpl.trimElements(models.split(",")); }
private boolean stopSlaveVolumes(java.util.List<org.ovirt.engine.core.common.businessentities.gluster.GlusterGeoRepSession> geoRepSessions) { for (org.ovirt.engine.core.common.businessentities.gluster.GlusterGeoRepSession session : geoRepSessions) { org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity slaveVolume = getDbFacade().getGlusterVolumeDao().getById(session.getSlaveVolumeId()); if (slaveVolume == null) { continue; } try (org.ovirt.engine.core.utils.lock.EngineLock lock = acquireEngineLock(session.getSlaveVolumeId(), LockingGroup.GLUSTER)) { if (!(stopVolume(slaveVolume))) { return false; } } } return true; }
@java.lang.Override public void onSuccess(java.lang.String content) { contentModel.getContent().setEntity(content); if (content == null) { contentModel.getContent().setIsAvailable(false); contentModel.setMessage(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().viewContentErrorGlusterHook()); } else if ((content.length()) == 0) { contentModel.getContent().setIsAvailable(false); contentModel.setMessage(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().viewContentEmptyGlusterHook()); } contentModel.stopProgress(); }
private boolean canRemoveTemplateDisk() { if ((org.ovirt.engine.core.bll.RemoveDiskCommand.getVmTemplate().getStatus()) == (org.ovirt.engine.core.common.businessentities.VmTemplateStatus.Locked)) { return failCanDoAction(EngineMessage.VM_TEMPLATE_IMAGE_IS_LOCKED); } org.ovirt.engine.core.common.businessentities.storage.DiskImage diskImage = getDiskImage(); if ((diskImage.getStorageIds().size()) == 1) { return failCanDoAction(EngineMessage.VM_TEMPLATE_IMAGE_LAST_DOMAIN); } if ((!(checkDerivedVmFromTemplateExists(diskImage))) || (!(checkDerivedDisksFromDiskNotExist(diskImage)))) { return false; } return true; }
@java.lang.Override public void edit(final org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel model) { driver.edit(model); model.getStorageDomain().getItemsChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { addDiskAllocation(model); } }); model.getPropertyChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { java.lang.String propName = ((org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs) (args)).propertyName; if ("Message".equals(propName)) { appendMessage(model.getMessage()); } } }); subTemplateExpanderContent.setVisible(false); model.getIsSubTemplate().getEntityChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { subTemplateExpanderContent.setVisible(model.getIsSubTemplate().getEntity()); } }); }
@java.lang.SuppressWarnings("unchecked") public <P extends org.ovirt.engine.core.bll.provider.ProviderProxy> P create(org.ovirt.engine.core.common.businessentities.Provider<?> provider) { switch (provider.getType()) { case FOREMAN : return ((P) (new org.ovirt.engine.core.bll.host.provider.foreman.ForemanHostProviderProxy(provider))); case OPENSTACK_NETWORK : return ((P) (new org.ovirt.engine.core.bll.provider.network.openstack.OpenstackNetworkProviderProxy(((org.ovirt.engine.core.common.businessentities.Provider<org.ovirt.engine.core.common.businessentities.OpenstackNetworkProviderProperties>) (provider))))); default : return null; } }
public org.ovirt.engine.core.common.businessentities.StoragePool getStoragePool() { if ((cachedStoragePool) == null) { cachedStoragePool = getStoragePoolDAO().get(params.getStoragePoolId()); } return cachedStoragePool; }
public static void main(java.lang.String... args) { org.ovirt.engine.core.config.EngineConfigCLIParser parser = null; try { parser = new org.ovirt.engine.core.config.EngineConfigCLIParser(); parser.parse(args); org.ovirt.engine.core.config.EngineConfigMap argsMap = parser.getEngineConfigMap(); if ((argsMap.getLogFile()) != null) { org.ovirt.engine.core.logutils.JavaLoggingUtils.addFileHandler(argsMap.getLogFile()); } if ((argsMap.getLogLevel()) != null) { org.ovirt.engine.core.logutils.JavaLoggingUtils.setLogLevel(argsMap.getLogLevel()); } } catch (java.lang.Throwable t) { java.lang.System.out.println(t.getMessage()); java.lang.System.exit(1); } try { org.ovirt.engine.core.config.EngineConfig.getInstance().setUpAndExecute(parser); } catch (java.lang.Throwable t) { org.slf4j.LoggerFactory.getLogger(org.ovirt.engine.core.config.EngineConfigExecutor.class).debug("Exiting with error: ", t); java.lang.System.out.println(t.getMessage()); java.lang.System.exit(1); } }
@java.lang.Override protected int getSuccessCode() { return org.apache.commons.httpclient.HttpStatus.SC_OK; }
@java.lang.Override protected void ExecuteVdsBrokerCommand() { status = org.ovirt.engine.core.vdsbroker.vdsbroker.VmLogoffVDSCommand.getBroker().desktopLogoff(mVmId.toString(), java.lang.String.valueOf(mForce)); org.ovirt.engine.core.vdsbroker.vdsbroker.VmLogoffVDSCommand.ProceedProxyReturnValue(); }
private void settingSpecificNetworksAllowedTest(boolean isAllNetworksAllowed) { simulateNicExists(); when(oldVfsConfig.isAllNetworksAllowed()).thenReturn(isAllNetworksAllowed); }
@org.junit.Test public void testCDAVdsIsSPM() { vds.setSpmStatus(VdsSpmStatus.SPM); org.ovirt.engine.core.bll.CanDoActionTestUtils.runAndAssertCanDoActionFailure("canDoAction did not fail on a VDS that is already set as SPM", command, VdcBllMessages.CANNOT_FORCE_SELECT_SPM_VDS_ALREADY_SPM); }
@org.junit.Test public void dataCenterDoesntExist() throws java.lang.Exception { when(dataCenterDao.get(any(org.ovirt.engine.core.compat.Guid.class))).thenReturn(null); assertEquals(new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.dal.VdcBllMessages.ACTION_TYPE_FAILED_STORAGE_POOL_NOT_EXIST), validator.dataCenterExists()); }
@org.junit.Test public void managementNetworkChangedIncorrectly() { java.lang.String hostName = "1.1.1.1"; org.ovirt.engine.core.common.businessentities.network.Network net = createNetwork(org.ovirt.engine.core.bll.network.host.SetupNetworksHelperTest.MANAGEMENT_NETWORK_NAME); mockExistingNetworks(net); org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface nic = createNicSyncedWithNetwork("nic0", net); nic.setBootProtocol(NetworkBootProtocol.STATIC_IP); nic.setAddress(hostName); mockExistingIfaces(nic); nic.setAddress(org.ovirt.engine.core.utils.RandomUtils.instance().nextString(10)); org.ovirt.engine.core.common.businessentities.VDS vds = mock(org.ovirt.engine.core.common.businessentities.VDS.class); when(vds.getId()).thenReturn(Guid.Empty); when(vds.getHostName()).thenReturn(hostName); org.ovirt.engine.core.bll.network.host.SetupNetworksHelper helper = createHelper(createParametersForNics(nic), vds); validateAndExpectViolation(helper, VdcBllMessages.ACTION_TYPE_FAILED_NETWORK_ADDRESS_CANNOT_BE_CHANGED); }
@org.ovirt.engine.api.restapi.types.Mapping(from = org.ovirt.engine.api.model.NicConfiguration.class, to = org.ovirt.engine.core.common.businessentities.VmInitNetwork.class) public static org.ovirt.engine.core.common.businessentities.VmInitNetwork map(org.ovirt.engine.api.model.NicConfiguration model, org.ovirt.engine.core.common.businessentities.VmInitNetwork template) { org.ovirt.engine.core.common.businessentities.VmInitNetwork entity = (template != null) ? template : new org.ovirt.engine.core.common.businessentities.VmInitNetwork(); if (model.isSetName()) { entity.setName(model.getName()); } if (model.isOnBoot()) { entity.setStartOnBoot(model.isOnBoot()); } if (model.isSetBootProtocol()) { entity.setBootProtocol(org.ovirt.engine.api.restapi.types.BootProtocolMapper.map(model.getBootProtocol(), Ipv4BootProtocol.NONE)); } if (model.isSetIp()) { if (model.getIp().isSetAddress()) { entity.setIp(model.getIp().getAddress()); } if (model.getIp().isSetNetmask()) { entity.setNetmask(model.getIp().getNetmask()); } if (model.getIp().isSetGateway()) { entity.setGateway(model.getIp().getGateway()); } } return entity; }
@org.junit.Test public void testGetAllInsertAsyncTaskEntitities() { org.ovirt.engine.core.common.businessentities.CommandEntity cmdEntity = generateNewEntity(); dao.save(cmdEntity); java.util.Set<org.ovirt.engine.core.common.businessentities.CommandAssociatedEntity> cocoCmdEntities = new java.util.HashSet<>(); cocoCmdEntities.add(new org.ovirt.engine.core.common.businessentities.CommandAssociatedEntity(cmdEntity.getId(), org.ovirt.engine.core.common.VdcObjectType.Storage, org.ovirt.engine.core.compat.Guid.newGuid())); cocoCmdEntities.add(new org.ovirt.engine.core.common.businessentities.CommandAssociatedEntity(cmdEntity.getId(), org.ovirt.engine.core.common.VdcObjectType.Disk, org.ovirt.engine.core.compat.Guid.newGuid())); dao.insertCommandAssociatedEntities(cocoCmdEntities); java.util.List<org.ovirt.engine.core.common.businessentities.CommandAssociatedEntity> entities = dao.getAllCommandAssociatedEntities(cmdEntity.getId()); assertNotNull(entities); assertEquals(2, entities.size()); assertThat(entities, hasItems(cocoCmdEntities.toArray(new org.ovirt.engine.core.common.businessentities.CommandAssociatedEntity[cocoCmdEntities.size()]))); }
public void setInitialHosts(java.util.ArrayList<org.ovirt.engine.core.compat.Guid> initialHosts) { this.initialHosts = initialHosts; }
protected void cluster_SelectedItemChanged() { org.ovirt.engine.core.common.businessentities.Cluster cluster = getCluster().getSelectedItem(); if (cluster == null) { return; } getFencingEnabled().setEntity(cluster.getFencingPolicy().isFencingEnabled()); org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().getPmTypeList(new org.ovirt.engine.ui.uicommonweb.models.hosts.AsyncQuery(( pmTypes) -> updatePmTypeList(pmTypes)), cluster.getCompatibilityVersion()); if (((getDataCenter()) != null) && ((getDataCenter().getItems()) != null)) { for (org.ovirt.engine.core.common.businessentities.StoragePool datacenter : getDataCenter().getItems()) { if (datacenter.getId().equals(cluster.getStoragePoolId())) { getDataCenter().setSelectedItem(datacenter, false); break; } } } final org.ovirt.engine.core.common.utils.CpuVendor newCpuVendor = getCurrentCpuVendor(); if ((newCpuVendor != null) && (!(newCpuVendor.equals(lastNonNullCpuVendor)))) { lastNonNullCpuVendor = newCpuVendor; cpuVendorChanged(); } getHostedEngineWarning().setIsAvailable(cluster.getCompatibilityVersion().less(Version.v4_0)); getNetworkProviderModel().setDefaultProviderId(cluster.getDefaultNetworkProviderId()); }
@org.ovirt.engine.ui.uicompat.DefaultMessage("{0} greater than {1}.") java.lang.String integerValidationNumberGreaterInvalidReason(java.lang.String prefixMsg, int min);
private java.util.Collection<java.lang.String> getFreeLabels() { java.util.SortedSet<java.lang.String> freeLabels = new java.util.TreeSet<java.lang.String>(dcLabels); freeLabels.removeAll(labelToIface.keySet()); return freeLabels; }
@java.lang.Override public long save(org.ovirt.engine.core.common.businessentities.EngineSession session) { org.ovirt.engine.core.dao.EngineSessionDaoImpl.EngineSessionParameterSource parameterSource = getEngineSessionParameterSource(session); return ((java.lang.Integer) (getCallsHandler().executeModification("InsertEngineSession", parameterSource).get("id"))).longValue(); }
void init(java.lang.String title, java.lang.String width, java.lang.String height, boolean resizeEnabled, boolean closeIconVisible);
private void endCommand() { java.util.List<org.ovirt.engine.core.common.businessentities.VM> listVms = getVmsForDiskId(); for (org.ovirt.engine.core.common.businessentities.VM vm : listVms) { org.ovirt.engine.core.bll.RemoveDiskCommand.getVmStaticDAO().incrementDbGeneration(vm.getId()); } org.ovirt.engine.core.bll.Backend.getInstance().EndAction(VdcActionType.RemoveImage, org.ovirt.engine.core.bll.RemoveDiskCommand.getParameters().getImagesParameters().get(0)); org.ovirt.engine.core.bll.RemoveDiskCommand.setSucceeded(true); }
@java.lang.Override public org.ovirt.engine.core.compat.Guid getQuotaId() { return getParameters().getQuotaId(); }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("Number of VFs setting") java.lang.String numOfVfsSetting();
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.job.Step> getStepsByJobId(org.ovirt.engine.core.compat.Guid jobId) { return jobDao.get(jobId).getSteps(); }
@org.junit.Test public void testList_LimitResults() throws java.lang.Exception { javax.ws.rs.core.UriInfo uriInfo = setUpUriExpectationsWithMax(false); setUpQueryExpectations(""); collection.setUriInfo(uriInfo); java.util.List<org.ovirt.engine.api.model.Tag> results = getCollection(); assertNotNull(collection); assertEquals(2, results.size()); }
@java.lang.Override protected void handleEscapeKey() { beforeCommandExecuted(model.getCancelCommand()); modelCommandInvoker.invokeCancelCommand(); }
private static java.util.List<org.ovirt.engine.core.aaa.DirectoryUser> queryPrincipals(final org.ovirt.engine.core.extensions.mgr.ExtensionProxy extension, final java.lang.String namespace, final org.ovirt.engine.api.extensions.ExtMap filter, boolean groupsResolving, boolean groupsResolvingRecursive) { org.ovirt.engine.api.extensions.ExtMap inputMap = new org.ovirt.engine.api.extensions.ExtMap().mput(Authz.InvokeKeys.QUERY_ENTITY, Authz.QueryEntity.PRINCIPAL).mput(Authz.InvokeKeys.QUERY_FLAGS, org.ovirt.engine.core.aaa.AuthzUtils.queryFlagValue(groupsResolving, groupsResolvingRecursive)).mput(Authz.InvokeKeys.QUERY_FILTER, filter).mput(Authz.InvokeKeys.NAMESPACE, namespace); return org.ovirt.engine.core.aaa.AuthzUtils.populatePrincipals(extension, namespace, inputMap); }
@java.lang.Override protected void ExecuteIrsBrokerCommand() { uuidReturn = org.ovirt.engine.core.vdsbroker.irsbroker.MergeSnapshotsVDSCommand.getIrsProxy().mergeSnapshots(org.ovirt.engine.core.vdsbroker.irsbroker.MergeSnapshotsVDSCommand.getParameters().getStorageDomainId().toString(), org.ovirt.engine.core.vdsbroker.irsbroker.MergeSnapshotsVDSCommand.getParameters().getStoragePoolId().toString(), org.ovirt.engine.core.vdsbroker.irsbroker.MergeSnapshotsVDSCommand.getParameters().getVmId().toString(), org.ovirt.engine.core.vdsbroker.irsbroker.MergeSnapshotsVDSCommand.getParameters().getImageGroupId().toString(), org.ovirt.engine.core.vdsbroker.irsbroker.MergeSnapshotsVDSCommand.getParameters().getImageId().toString(), org.ovirt.engine.core.vdsbroker.irsbroker.MergeSnapshotsVDSCommand.getParameters().getImageId2().toString(), java.lang.String.valueOf(org.ovirt.engine.core.vdsbroker.irsbroker.MergeSnapshotsVDSCommand.getParameters().getPostZero()).toLowerCase()); org.ovirt.engine.core.vdsbroker.irsbroker.MergeSnapshotsVDSCommand.ProceedProxyReturnValue(); org.ovirt.engine.core.compat.Guid taskID = new org.ovirt.engine.core.compat.Guid(uuidReturn.mUuid); org.ovirt.engine.core.vdsbroker.irsbroker.MergeSnapshotsVDSCommand.getVDSReturnValue().setCreationInfo(new org.ovirt.engine.core.common.asynctasks.AsyncTaskCreationInfo(taskID, org.ovirt.engine.core.common.asynctasks.AsyncTaskType.mergeSnapshots, org.ovirt.engine.core.vdsbroker.irsbroker.MergeSnapshotsVDSCommand.getParameters().getStoragePoolId())); }
@java.lang.Override public javax.ws.rs.core.Response add(org.ovirt.engine.api.model.Cluster cluster) { validateParameters(cluster, "name", "dataCenter.name|id"); validateEnums(org.ovirt.engine.api.model.Cluster.class, cluster); org.ovirt.engine.core.common.businessentities.StoragePool pool = org.ovirt.engine.api.restapi.resource.BackendDataCenterResource.getStoragePool(cluster.getDataCenter(), this); org.ovirt.engine.core.common.businessentities.VDSGroup entity = map(cluster, map(pool)); if ((!(cluster.isSetErrorHandling())) || (!(cluster.getErrorHandling().isSetOnError()))) { entity.setMigrateOnError(null); } return performCreate(VdcActionType.AddVdsGroup, new org.ovirt.engine.core.common.action.VdsGroupOperationParameters(entity), new org.ovirt.engine.api.restapi.resource.QueryIdResolver<org.ovirt.engine.core.compat.Guid>(org.ovirt.engine.core.common.queries.VdcQueryType.GetVdsGroupById, org.ovirt.engine.core.common.queries.IdQueryParameters.class)); }
@org.junit.Test public void testIsNetworkInSyncWhenIpConfigurationIsEmpty() throws java.lang.Exception { when(mockedIpConfiguration.hasIpv4PrimaryAddressSet()).thenReturn(false); assertThat(createTestedInstance().isNetworkInSync(), is(true)); }
private java.lang.Integer getAutoMaxBandwidth() { final org.ovirt.engine.core.compat.Guid sourceClusterId = org.ovirt.engine.core.bll.MigrateVmCommand.getVm().getClusterId(); final org.ovirt.engine.core.compat.Guid destinationClusterId = org.ovirt.engine.core.bll.MigrateVmCommand.getClusterId(); final org.ovirt.engine.core.compat.Guid sourceHostId = org.ovirt.engine.core.bll.MigrateVmCommand.getVm().getRunOnVds(); final org.ovirt.engine.core.compat.Guid destinationHostId = getDestinationVdsId(); return org.ovirt.engine.core.common.utils.ObjectUtils.minIfExists(getAutoMaxBandwidth(sourceClusterId, sourceHostId), getAutoMaxBandwidth(destinationClusterId, destinationHostId)); }
@java.lang.Override protected void setActionMessageParameters() { addCanDoActionMessage(EngineMessage.VAR__ACTION__UPDATE); addCanDoActionMessage(EngineMessage.VAR__TYPE__ISCSI_BOND); }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.VDS> getAll(org.ovirt.engine.core.compat.Guid userID, boolean isFiltered) { java.util.List<org.ovirt.engine.core.common.businessentities.VDS> vdsList = getCallsHandler().executeReadList("GetAllFromVds", org.ovirt.engine.core.dao.VdsDaoImpl.VdsRowMapper.instance, getCustomMapSqlParameterSource().addValue("user_id", userID).addValue("is_filtered", isFiltered)); return uniteAgents(vdsList); }
@java.lang.Override protected void executeVdsBrokerCommand() { java.lang.String storageDomainId = CreateVGVDSCommand.getParameters().getStorageDomainId().toString(); java.util.List<java.lang.String> deviceList = CreateVGVDSCommand.getParameters().getDeviceList(); java.lang.String[] deviceArray = deviceList.toArray(new java.lang.String[deviceList.size()]); boolean isForce = CreateVGVDSCommand.getParameters().isForce(); boolean supportForceCreateVG = org.ovirt.engine.core.common.config.Config.<java.lang.Boolean>getValue(ConfigValues.SupportForceCreateVG, CreateVGVDSCommand.getVds().getVdsGroupCompatibilityVersion().toString()); result = (supportForceCreateVG) ? CreateVGVDSCommand.getBroker().createVG(storageDomainId, deviceArray, isForce) : CreateVGVDSCommand.getBroker().createVG(storageDomainId, deviceArray); CreateVGVDSCommand.proceedProxyReturnValue(); setReturnValue(result.uuid); }
org.ovirt.engine.core.bll.ValidationResult networksUniquelyConfiguredOnHost(java.util.Collection<org.ovirt.engine.core.common.businessentities.network.NetworkAttachment> attachmentsToConfigure) { java.util.Set<org.ovirt.engine.core.compat.Guid> usedNetworkIds = new java.util.HashSet(attachmentsToConfigure.size()); for (org.ovirt.engine.core.common.businessentities.network.NetworkAttachment attachment : attachmentsToConfigure) { boolean alreadyUsedNetworkId = usedNetworkIds.contains(attachment.getNetworkId()); if (alreadyUsedNetworkId) { org.ovirt.engine.core.common.businessentities.network.Network network = existingNetworkRelatedToAttachment(attachment); return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.NETWORKS_ALREADY_ATTACHED_TO_IFACES, org.ovirt.engine.core.utils.ReplacementUtils.createSetVariableString(org.ovirt.engine.core.bll.network.host.HostSetupNetworksValidator.VAR_NETWORKS_ALREADY_ATTACHED_TO_IFACES_LIST, network.getName())); } else { usedNetworkIds.add(attachment.getNetworkId()); } } return org.ovirt.engine.core.bll.ValidationResult.VALID; }
private void init() { setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().editLogicalNetworkTitle()); setHelpTag(HelpTag.edit_logical_network); setHashName("edit_logical_network"); getName().setEntity(getNetwork().getName()); if (isManagemet()) { getName().setIsChangable(false); } getDescription().setEntity(getNetwork().getDescription()); getComment().setEntity(getNetwork().getComment()); getIsStpEnabled().setEntity(getNetwork().getStp()); getHasVLanTag().setEntity(((getNetwork().getVlanId()) != null)); getVLanTag().setEntity(((getNetwork().getVlanId()) == null ? java.lang.Integer.valueOf(0) : getNetwork().getVlanId())); initMtu(); initIsVm(); getExport().setEntity(getNetwork().isExternal()); getExport().setIsChangable(false); getExternalProviders().setIsChangable(false); getNetworkLabel().setSelectedItem(getNetwork().getLabel()); toggleProfilesAvailability(); }
private void commonSave(boolean allNetworksAllowed) { org.ovirt.engine.core.common.businessentities.network.HostNicVfsConfig newConfig = new org.ovirt.engine.core.common.businessentities.network.HostNicVfsConfig(); newConfig.setId(org.ovirt.engine.core.compat.Guid.newGuid()); newConfig.setNicId(FixturesTool.VDS_NETWORK_INTERFACE_WITHOUT_QOS); newConfig.setAllNetworksAllowed(allNetworksAllowed); if (!allNetworksAllowed) { addNetworks(newConfig); addLabels(newConfig); } dao.save(newConfig); org.ovirt.engine.core.common.businessentities.network.HostNicVfsConfig result = dao.get(newConfig.getId()); assertNotNull(result); assertHostNicVfsConfigEquals(newConfig, result); }
protected java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase> buildParameters(org.ovirt.engine.core.common.businessentities.network.Network network) { java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase> parameters = new java.util.ArrayList<>(); java.util.List<org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface> nics = org.ovirt.engine.core.bll.network.dc.UpdateNetworkCommand.SyncNetworkParametersBuilder.getDbFacade().getInterfaceDao().getVdsInterfacesByNetworkId(org.ovirt.engine.core.bll.network.dc.UpdateNetworkCommand.SyncNetworkParametersBuilder.getNetwork().getId()); java.util.Set<org.ovirt.engine.core.compat.Guid> hostIdsToSync = new java.util.HashSet<>(); for (org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface nic : nics) { if (!(org.ovirt.engine.core.utils.NetworkUtils.isNetworkInSync(nic, org.ovirt.engine.core.bll.network.dc.UpdateNetworkCommand.SyncNetworkParametersBuilder.getNetwork()))) { hostIdsToSync.add(nic.getVdsId()); } } for (org.ovirt.engine.core.compat.Guid hostId : hostIdsToSync) { org.ovirt.engine.core.common.action.SetupNetworksParameters setupNetworkParams = createSetupNetworksParameters(hostId); setupNetworkParams.setNetworksToSync(java.util.Collections.singletonList(org.ovirt.engine.core.bll.network.dc.UpdateNetworkCommand.SyncNetworkParametersBuilder.getNetworkName())); parameters.add(setupNetworkParams); } return parameters; }
private org.ovirt.engine.core.bll.ValidationResult diskImagesNotInStatus(org.ovirt.engine.core.common.businessentities.storage.ImageStatus status, org.ovirt.engine.core.common.errors.EngineMessage failMessage) { java.util.List<java.lang.String> disksInStatus = new java.util.ArrayList<>(); for (org.ovirt.engine.core.common.businessentities.storage.DiskImage diskImage : diskImages) { if ((diskImage.getImageStatus()) == status) { disksInStatus.add(diskImage.getDiskAlias()); } } if (!(disksInStatus.isEmpty())) { return new org.ovirt.engine.core.bll.ValidationResult(failMessage, java.lang.String.format("$diskAliases %s", org.apache.commons.lang.StringUtils.join(disksInStatus, ", "))); } return org.ovirt.engine.core.bll.ValidationResult.VALID; }
public void setVdsGroupSupportsVirtService(java.lang.Boolean value) { this.vdsGroupVirtService = value; }
private java.lang.String updateFreeVf() { java.lang.String vfToUse = vfScheduler.findFreeVfForVnic(org.ovirt.engine.core.bll.network.vm.ActivateDeactivateVmNicCommand.getVdsId(), getNetwork()); if (vfToUse == null) { failValidation(EngineMessage.CANNOT_PLUG_PASSTHROUGH_VNIC_NO_SUITABLE_VF, java.lang.String.format("$vnicName %1$s", getInterfaceName())); } return vfToUse; }
private boolean auditLogIfFieldWasNotAddedSuccessfully(java.util.Map<java.lang.String, java.lang.Object> descriptionFields, java.util.Map<java.lang.String, java.lang.Object> descriptionMap, java.lang.String fieldName, java.lang.String fieldValue, java.lang.String[] descriptionFieldsPriority, int fieldPriorityIndex) { java.lang.String diskAlias = descriptionFields.get(org.ovirt.engine.core.bll.storage.disk.image.MetadataDiskDescriptionHandler.DISK_ALIAS).toString(); java.lang.String storedFieldValue = ((java.lang.String) (descriptionMap.get(fieldName))); if (storedFieldValue == null) { auditLogFailedToStoreDiskFields(diskAlias, getDiskFieldsNamesLeft(descriptionFieldsPriority, fieldPriorityIndex)); return false; } else { java.lang.String fullFieldValue = (stringMatchesAsciiPattern(fieldValue)) ? fieldValue : encodeDiskProperty(fieldValue); if ((storedFieldValue.length()) < (fullFieldValue.length())) { if (((descriptionFieldsPriority.length) - fieldPriorityIndex) > 1) { auditLogDiskFieldTruncatedAndOthersWereLost(diskAlias, fieldName, getDiskFieldsNamesLeft(descriptionFieldsPriority, (fieldPriorityIndex + 1))); } else { auditLogDiskFieldTruncated(diskAlias, fieldName); } return false; } } return true; }
private org.ovirt.engine.core.common.action.CustomPropertiesForVdsNetworkInterface nicsToCustomProperties(java.util.List<org.ovirt.engine.api.model.HostNIC> hostNics, org.ovirt.engine.core.common.businessentities.BusinessEntityMap<org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface> existingNicsMapping) { org.ovirt.engine.core.common.action.CustomPropertiesForVdsNetworkInterface result = new org.ovirt.engine.core.common.action.CustomPropertiesForVdsNetworkInterface(); for (org.ovirt.engine.api.model.HostNIC hostNic : hostNics) { if (hostNic.isSetProperties()) { java.lang.String hostNicName = hostNic.getName(); java.lang.String nicName = (org.apache.commons.lang.StringUtils.isEmpty(hostNicName)) ? existingNicsMapping.get(hostNic.getId()).getName() : hostNicName; result.add(nicName, org.ovirt.engine.api.restapi.utils.CustomPropertiesParser.toMap(hostNic.getProperties())); } } return result; }
public org.ovirt.engine.ui.common.widget.uicommon.popup.vm.PopupWidgetConfig copy() { org.ovirt.engine.ui.common.widget.uicommon.popup.vm.PopupWidgetConfig copy = new org.ovirt.engine.ui.common.widget.uicommon.popup.vm.PopupWidgetConfig(advancedOnly, alwaysHidden, markedAsSpecial, adminOnly); copy.setApplicationLevelVisible(isApplicationLevelVisible()); return copy; }
@org.ovirt.engine.ui.frontend.DefaultStringValue("$type Host capabilities") java.lang.String VAR__TYPE__HOST_CAPABILITIES();
@org.junit.Test public void testValidateClusterSupportForVirtioScsi() { org.ovirt.engine.core.bll.ImportVmCommand<org.ovirt.engine.core.common.action.ImportVmParameters> cmd = setupDiskSpaceTest(createParameters()); doReturn(true).when(cmd).validateImages(any(java.util.Map.class)); cmd.getParameters().getVm().getDiskMap().values().iterator().next().setDiskInterface(DiskInterface.VirtIO_SCSI); cmd.getVdsGroup().setCompatibilityVersion(Version.v3_2); org.ovirt.engine.core.bll.CanDoActionTestUtils.runAndAssertCanDoActionFailure(cmd, EngineMessage.VIRTIO_SCSI_INTERFACE_IS_NOT_AVAILABLE_FOR_CLUSTER_LEVEL); }
@org.junit.Test public void testDetachingPreviouslyAddedNetworkAttachment() throws java.lang.Exception { org.ovirt.engine.core.common.businessentities.network.NetworkAttachment networkAttachment = org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkOperation.newNetworkAttachment(networkA, nicA); dataFromHostSetupNetworksModel.newOrModifiedNetworkAttachments.add(networkAttachment); when(logicalNetworkModelOfNetworkA.hasVlan()).thenReturn(false); when(logicalNetworkModelOfNetworkA.isAttached()).thenReturn(true); when(logicalNetworkModelOfNetworkA.getAttachedToNic()).thenReturn(networkInterfaceModelOfNicA); NetworkOperation.DETACH_NETWORK.getTarget().executeNetworkCommand(logicalNetworkModelOfNetworkA, null, dataFromHostSetupNetworksModel); assertThat(dataFromHostSetupNetworksModel.newOrModifiedNetworkAttachments.size(), is(0)); assertThat(dataFromHostSetupNetworksModel.removedNetworkAttachments.size(), is(0)); }
@java.lang.Override public org.ovirt.engine.core.common.businessentities.permissions getForRoleAndAdElementAndObjectWithGroupCheck(org.ovirt.engine.core.compat.Guid roleid, org.ovirt.engine.core.compat.Guid elementid, org.ovirt.engine.core.compat.Guid objectid) { org.hibernate.Query query = getSession().createQuery("from DbUser where id = :id"); query.setParameter("id", objectid); org.ovirt.engine.core.common.businessentities.DbUser user = ((org.ovirt.engine.core.common.businessentities.DbUser) (query.uniqueResult())); query = getSession().createQuery("from ad_groups where name in :names"); query.setParameterList("names", user.getGroupsAsArray()); @java.lang.SuppressWarnings("unchecked") java.util.List<org.ovirt.engine.core.common.businessentities.LdapGroup> groups = query.list(); java.util.List<org.ovirt.engine.core.compat.Guid> ids = new java.util.ArrayList<org.ovirt.engine.core.compat.Guid>(); ids.add(user.getuser_id()); for (org.ovirt.engine.core.common.businessentities.LdapGroup group : groups) { ids.add(group.getid()); } return fillInPermissionDetails(findOneByCriteria(org.hibernate.criterion.Restrictions.eq("roleId", roleid), org.hibernate.criterion.Restrictions.eq("adElementId", elementid), org.hibernate.criterion.Restrictions.eq("objectId", objectid), org.hibernate.criterion.Restrictions.in("adElementId", ids))); }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.VDS> getHostsForStorageOperation(org.ovirt.engine.core.compat.Guid storagePoolId, boolean localFsOnly) { if ((storagePoolId == null) || (storagePoolId.equals(Guid.Empty))) { storagePoolId = null; } java.util.List<org.ovirt.engine.core.common.businessentities.VDS> vdsList = getCallsHandler().executeReadList("getHostsForStorageOperation", org.ovirt.engine.core.dao.VdsDaoImpl.VdsRowMapper.instance, getCustomMapSqlParameterSource().addValue("storage_pool_id", storagePoolId).addValue("local_fs_only", localFsOnly)); return uniteAgents(vdsList); }
public void setIoThreadsEnabled(org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel.NotChangableForVmInPoolEntityModel<java.lang.Boolean> ioThreadsEnabled) { this.ioThreadsEnabled = ioThreadsEnabled; }
@java.lang.Override java.lang.String getSubCollectionsVariables() { java.util.Map<java.lang.String, org.ovirt.engine.sdk.codegen.holders.CollectionHolder> subCollections = getSubcollections(); java.util.List<java.lang.String> keys = new java.util.ArrayList(subCollections.keySet()); java.util.Collections.sort(keys); java.lang.StringBuilder buffer = new java.lang.StringBuilder(); for (java.lang.String key : keys) { org.ovirt.engine.sdk.codegen.holders.CollectionHolder ch = subCollections.get(key); java.lang.String name = ch.getName(); buffer.append(variableTemplate.getTemplate(name, org.ovirt.engine.sdk.codegen.utils.StringUtils.toLowerCase(name))); } return buffer.toString(); }
@javax.annotation.PostConstruct private void init() { org.ovirt.engine.core.utils.threadpool.ThreadPoolUtil.setExecutorService(new org.ovirt.engine.core.common.utils.EngineThreadPools.InternalThreadExecutor("EngineThreadPool", org.ovirt.engine.core.utils.EngineLocalConfig.getInstance().getInteger("ENGINE_THREAD_POOL_MIN_SIZE"), org.ovirt.engine.core.utils.EngineLocalConfig.getInstance().getInteger("ENGINE_THREAD_POOL_MAX_SIZE"), org.ovirt.engine.core.utils.EngineLocalConfig.getInstance().getInteger("ENGINE_THREAD_POOL_QUEUE_SIZE"))); }
protected void addVmInterfaces() { org.ovirt.engine.core.bll.network.VmInterfaceManager vmInterfaceManager = new org.ovirt.engine.core.bll.network.VmInterfaceManager(macPool); org.ovirt.engine.core.bll.network.vm.VnicProfileHelper vnicProfileHelper = new org.ovirt.engine.core.bll.network.vm.VnicProfileHelper(org.ovirt.engine.core.bll.exportimport.ImportVmCommandBase.getClusterId(), org.ovirt.engine.core.bll.exportimport.ImportVmCommandBase.getStoragePoolId(), org.ovirt.engine.core.common.AuditLogType.IMPORTEXPORT_IMPORT_VM_INVALID_INTERFACES); java.util.List<org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface> nics = getVm().getInterfaces(); vmInterfaceManager.sortVmNics(nics, getVm().getStaticData().getManagedDeviceMap()); if ((!(org.ovirt.engine.core.bll.exportimport.ImportVmCommandBase.getParameters().isImportAsNewEntity())) && (isExternalMacsToBeReported())) { reportExternalMacs(); } for (org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface iface : getVm().getInterfaces()) { initInterface(iface); vnicProfileHelper.updateNicWithVnicProfileForUser(iface, org.ovirt.engine.core.bll.exportimport.ImportVmCommandBase.getCurrentUser()); vmInterfaceManager.add(iface, org.ovirt.engine.core.bll.exportimport.ImportVmCommandBase.getCompensationContext(), shouldReassignMac(iface)); macsAdded.add(iface.getMacAddress()); } vnicProfileHelper.auditInvalidInterfaces(org.ovirt.engine.core.bll.exportimport.ImportVmCommandBase.getVmName()); }
@org.ovirt.engine.ui.frontend.DefaultStringValue("Cannot ${action} ${type}. Link state is set to 'Down' on the virtual machine's interface, this is not supported for clusters of version ${clusterVersion}.") java.lang.String UNLINKING_IS_NOT_SUPPORTED();
private static void assertCredentials(org.ovirt.engine.core.common.utils.Pair<java.lang.String, java.lang.String> credentials, java.lang.String userName, java.lang.String password) { assertEquals(userName, credentials.getFirst()); assertEquals(password, credentials.getSecond()); }
@java.lang.Override public void updateMinAllocatedMemory() { if ((getModel().getMemSize().getEntity()) == null) { return; } org.ovirt.engine.core.common.businessentities.Cluster cluster = getModel().getSelectedCluster(); if (cluster == null) { return; } double overCommitFactor = 100.0 / (cluster.getMaxVdsMemoryOverCommit()); getModel().getMinAllocatedMemory().setEntity(((int) ((getModel().getMemSize().getEntity()) * overCommitFactor))); }
@org.junit.Test public void canDoActionInvalidVmStatus() { command.getParameters().setParametersList(createMoveDisksParameters()); initDiskImage(diskImageId); initVm(VMStatus.Unknown, org.ovirt.engine.core.compat.Guid.newGuid(), diskImageId); command.updateParameters(); assertTrue(command.getReturnValue().getCanDoActionMessages().contains(EngineMessage.ACTION_TYPE_FAILED_VM_IS_NOT_DOWN_OR_UP.toString())); }
@java.lang.Override public void onMouseOver(com.google.gwt.event.dom.client.MouseOverEvent event) { com.google.gwt.safehtml.shared.SafeHtml tooltipHtml = getTooltip(); if (!("".equals(tooltipHtml.asString()))) { tooltip.setHTML(tooltipHtml); org.ovirt.engine.ui.common.utils.PopupUtils.adjustPopupLocationToFitScreenAndShow(tooltipPanel, event.getClientX(), ((event.getClientY()) + 20)); } }
private void remove() { if ((org.ovirt.engine.ui.uicommonweb.models.configure.labels.list.AffinityLabelListModel.getWindow()) != null) { return; } org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel model = new org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel(); setConfirmWindow(model); model.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().removeAffinityLabelsTitle()); model.setHelpTag(HelpTag.remove_affinity_groups); model.setHashName("remove_affinity_labels"); java.util.ArrayList<java.lang.String> list = new java.util.ArrayList<>(); for (org.ovirt.engine.core.common.businessentities.Label affinityLabel : org.ovirt.engine.ui.uicommonweb.models.configure.labels.list.AffinityLabelListModel.getSelectedItems()) { list.add(affinityLabel.getName()); } model.setItems(list); model.getCommands().add(org.ovirt.engine.ui.uicommonweb.UICommand.createDefaultOkUiCommand("OnRemove", this)); model.getCommands().add(org.ovirt.engine.ui.uicommonweb.UICommand.createCancelUiCommand("Cancel", this)); }
protected org.ovirt.engine.core.vdsbroker.xmlrpc.XmlRpcStruct initDeviceStructure() { org.ovirt.engine.core.vdsbroker.xmlrpc.XmlRpcStruct deviceStruct = new org.ovirt.engine.core.vdsbroker.xmlrpc.XmlRpcStruct(); deviceStruct.add(VdsProperties.DeviceType, getParameters().getVmDevice().getType()); deviceStruct.add(VdsProperties.Alias, getParameters().getVmDevice().getAlias()); org.ovirt.engine.core.common.businessentities.VmNetworkInterface nic = getParameters().getNic(); deviceStruct.add(VdsProperties.network, org.apache.commons.lang.StringUtils.defaultString(nic.getNetworkName())); deviceStruct.add(VdsProperties.linkActive, java.lang.String.valueOf(nic.isLinked())); deviceStruct.add(VdsProperties.portMirroring, ((nic.isPortMirroring()) && ((nic.getNetworkName()) != null) ? java.util.Collections.singletonList(nic.getNetworkName()) : java.util.Collections.<java.lang.String>emptyList())); return deviceStruct; }
private static java.util.List<java.lang.String> innerInitRange(int stopAfter, long startNum, long endNum) { if (startNum > endNum) { return java.util.Collections.emptyList(); } java.util.List<java.lang.String> macAddresses = new java.util.ArrayList<>(java.lang.Math.min(stopAfter, ((int) (endNum - startNum)))); for (long i = startNum; i <= endNum; i++) { if (((org.ovirt.engine.core.utils.MacAddressRangeUtils.MAC_ADDRESS_MULTICAST_BIT) & i) != 0) { continue; } macAddresses.add(org.ovirt.engine.core.utils.MacAddressRangeUtils.macToString(i)); if ((stopAfter--) <= 0) { return macAddresses; } } return macAddresses; }
private void execute(org.ovirt.engine.core.ldap.LdapProviderType ldapProviderType, java.lang.String domain) { java.util.Hashtable<java.lang.String, java.lang.String> env = new java.util.Hashtable<java.lang.String, java.lang.String>(); org.ovirt.engine.core.bll.adbroker.LdapBrokerUtils.addLdapConfigValues(env); initContextVariables(env); javax.naming.directory.Attributes results = null; javax.naming.directory.DirContext ctx = null; try { ctx = createContext(env); org.ovirt.engine.core.bll.adbroker.LdapQueryData ldapQueryData = new org.ovirt.engine.core.bll.adbroker.LdapQueryDataImpl(); ldapQueryData.setLdapQueryType(LdapQueryType.rootDSE); ldapQueryData.setDomain(domain); org.ovirt.engine.core.bll.adbroker.LdapQueryExecution queryExecution = org.ovirt.engine.core.bll.adbroker.LdapQueryExecutionBuilderImpl.getInstance().build(ldapProviderType, ldapQueryData); javax.naming.directory.SearchControls searchControls = new javax.naming.directory.SearchControls(); searchControls.setReturningAttributes(queryExecution.getReturningAttributes()); searchControls.setSearchScope(queryExecution.getSearchScope()); searchControls.setReturningObjFlag(true); searchControls.setTimeLimit(((org.ovirt.engine.core.common.config.Config.<java.lang.Integer>GetValue(ConfigValues.LDAPOperationTimeout)) * 1000)); javax.naming.NamingEnumeration<javax.naming.directory.SearchResult> search = ctx.search(queryExecution.getBaseDN(), queryExecution.getFilter(), searchControls); try { results = search.next().getAttributes(); } finally { search.close(); } } catch (javax.naming.NamingException e) { org.ovirt.engine.core.bll.adbroker.GetRootDSE.log.errorFormat("Failed to query rootDSE for LDAP server {0} due to {1}", ldapURI, e.getMessage()); throw new org.ovirt.engine.core.bll.adbroker.DirectoryServiceException(e); } finally { closeContext(ctx); } attributes = results; }
@org.junit.Test public void testValidateModifiedBondSlavesWhenSlaveAlreadySlavesForDifferentBondButItsDetachedFromItAsAPartOfRequest() throws java.lang.Exception { org.ovirt.engine.core.common.businessentities.network.Bond bond = createBond("bond1"); org.ovirt.engine.core.common.businessentities.network.Bond differentBond = createBond("bond2"); org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface slaveA = createBondSlave(bond, "slaveA"); org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface slaveB = createBondSlave(differentBond, "slaveB"); org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface slaveC = createBondSlave(differentBond, "slaveC"); org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface slaveD = createBondSlave(differentBond, "slaveD"); setBondSlaves(bond, slaveA, slaveB); setBondSlaves(differentBond, slaveC, slaveD); org.ovirt.engine.core.bll.network.host.HostSetupNetworksValidator build = new org.ovirt.engine.core.bll.network.host.HostSetupNetworksValidatorTest.HostSetupNetworksValidatorBuilder().setParams(new org.ovirt.engine.core.bll.network.host.HostSetupNetworksValidatorTest.ParametersBuilder().addBonds(org.ovirt.engine.core.common.action.CreateOrUpdateBond.fromBond(bond), org.ovirt.engine.core.common.action.CreateOrUpdateBond.fromBond(differentBond))).addExistingInterfaces(bond, differentBond, slaveA, slaveB, slaveC, slaveD).build(); doTestValidateModifiedBondSlaves(spy(build), ValidationResult.VALID, ValidationResult.VALID, isValid()); }
public void setMenuItemSelectedEvent(org.ovirt.engine.ui.uicompat.Event menuItemSelectedEvent) { this.menuItemSelectedEvent = menuItemSelectedEvent; }
@java.lang.Override public void render(org.ovirt.engine.ui.webadmin.widget.tree.Context context, org.ovirt.engine.ui.uicommonweb.models.SystemTreeItemModel value, com.google.gwt.safehtml.shared.SafeHtmlBuilder sb) { com.google.gwt.resources.client.ImageResource imageResource; switch (value.getType()) { case Cluster : imageResource = applicationResources.clusterImage(); break; case Clusters : imageResource = applicationResources.clustersImage(); break; case DataCenter : imageResource = applicationResources.dataCenterImage(); break; case DataCenters : imageResource = applicationResources.dataCentersImage(); break; case Cluster_Gluster : imageResource = applicationResources.glusterClusterImage(); break; case Host : imageResource = applicationResources.hostImage(); break; case Hosts : imageResource = applicationResources.hostsImage(); break; case Storage : imageResource = applicationResources.storageImage(); break; case Storages : imageResource = applicationResources.storagesImage(); break; case System : imageResource = applicationResources.systemImage(); break; case Templates : imageResource = applicationResources.templatesImage(); break; case VMs : imageResource = applicationResources.vmsImage(); break; case Volume : imageResource = applicationResources.volumeImage(); break; case Volumes : imageResource = applicationResources.volumesImage(); break; case Network : imageResource = applicationResources.networkTreeImage(); break; case Networks : imageResource = applicationResources.networksTreeImage(); break; case Provider : imageResource = applicationResources.providerImage(); break; case Providers : imageResource = applicationResources.providersImage(); break; default : imageResource = applicationResources.questionMarkImage(); } com.google.gwt.safehtml.shared.SafeHtml imageHtml = com.google.gwt.safehtml.shared.SafeHtmlUtils.fromTrustedString(com.google.gwt.user.client.ui.AbstractImagePrototype.create(imageResource).getHTML()); sb.append(templates.treeItem(imageHtml, value.getTitle(), org.ovirt.engine.ui.common.utils.ElementIdUtils.createTreeCellElementId(elementIdPrefix, value, null))); }
@java.lang.Override public void Executed(org.ovirt.engine.ui.uicompat.FrontendActionAsyncResult result) { org.ovirt.engine.core.common.action.VdcReturnValueBase returnValue = result.getReturnValue(); boolean success = (returnValue != null) && (returnValue.getSucceeded()); if (success) { fileConnection = null; } java.lang.Object[] array = ((java.lang.Object[]) (result.getState())); OnFinish(((org.ovirt.engine.ui.uicompat.TaskContext) (array[0])), ((java.lang.Boolean) (array[1])), ((org.ovirt.engine.ui.uicommonweb.models.storage.IStorageModel) (array[2])), ((java.lang.String) (array[3]))); }
private java.util.List<org.ovirt.engine.core.common.businessentities.Snapshot> prepareSnapshotConfigWithoutImage(org.ovirt.engine.core.compat.Guid imageGroupToRemove) { java.util.List<org.ovirt.engine.core.common.businessentities.Snapshot> result = new java.util.LinkedList<org.ovirt.engine.core.common.businessentities.Snapshot>(); java.util.List<org.ovirt.engine.core.common.businessentities.DiskImage> snapshotDisks = org.ovirt.engine.core.bll.RemoveImageCommand.getDiskImageDao().getAllSnapshotsForImageGroup(imageGroupToRemove); for (org.ovirt.engine.core.common.businessentities.DiskImage snapshotDisk : snapshotDisks) { org.ovirt.engine.core.compat.NGuid vmSnapshotId = snapshotDisk.getvm_snapshot_id(); if ((vmSnapshotId != null) && (!(Guid.Empty.equals(vmSnapshotId.getValue())))) { org.ovirt.engine.core.common.businessentities.Snapshot updated = prepareSnapshotConfigWithoutImageSingleImage(vmSnapshotId.getValue(), snapshotDisk.getImageId()); if (updated != null) { result.add(updated); } } } return result; }
public boolean isType(java.lang.String value) { for (org.ovirt.engine.core.common.businessentities.gluster.GlusterStatus status : values) { if (status.name().equals(value)) { return true; } } return false; }
private boolean saveGlusterHostUuid() { org.ovirt.engine.core.dao.gluster.GlusterServerDao glusterServerDao = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getGlusterServerDao(); org.ovirt.engine.core.common.businessentities.gluster.GlusterServer glusterServer = glusterServerDao.getByServerId(getVds().getId()); if (glusterServer == null) { org.ovirt.engine.core.common.vdscommands.VDSReturnValue returnValue = runVdsCommand(VDSCommandType.GetGlusterHostUUID, new org.ovirt.engine.core.common.vdscommands.VdsIdVDSCommandParametersBase(getVds().getId())); if ((returnValue.getSucceeded()) && ((returnValue.getReturnValue()) != null)) { glusterServer = new org.ovirt.engine.core.common.businessentities.gluster.GlusterServer(); glusterServer.setId(getVds().getId()); glusterServer.setGlusterServerUuid(org.ovirt.engine.core.compat.Guid.createGuidFromString(((java.lang.String) (returnValue.getReturnValue())))); glusterServerDao.save(glusterServer); } else { return false; } } return true; }
public void setVmAttachedToPool(boolean value) { if (value) { getDataCenter().setIsChangable(false); getCluster().setIsChangable((!value)); getQuota().setIsChangable(false); getDescription().setIsChangable(false); getNumOfDesktops().setIsChangable(false); getPrestartedVms().setIsChangable(false); getTemplate().setIsChangable(false); getMemSize().setIsChangable(false); getTotalCPUCores().setIsChangable(false); getCoresPerSocket().setIsChangable(false); getNumOfSockets().setIsChangable(false); getOSType().setIsChangable(false); getIsStateless().setIsChangable(false); getIsDeleteProtected().setIsChangable(false); getTimeZone().setIsChangable(false); getDomain().setIsChangable(false); getDisplayProtocol().setIsChangable(false); getUsbPolicy().setIsChangable(false); getNumOfMonitors().setIsChangable(false); getIsSmartcardEnabled().setIsChangable(false); getAllowConsoleReconnect().setIsChangable(false); getVncKeyboardLayout().setIsChangable(false); getIsAutoAssign().setIsChangable(false); getDefaultHost().setIsChangable(false); getHostCpu().setIsChangable(false); getMigrationMode().setIsChangable(false); getCpuPinning().setIsChangable(false); getMinAllocatedMemory().setIsChangable(false); getProvisioning().setIsChangable(false); getProvisioningThin_IsSelected().setIsChangable(false); getProvisioningClone_IsSelected().setIsChangable(false); getDisksAllocationModel().setIsChangable(false); getFirstBootDevice().setIsChangable(false); getSecondBootDevice().setIsChangable(false); getCdAttached().setIsChangable(false); getCdImage().setIsChangable(false); getKernel_path().setIsChangable(false); getInitrd_path().setIsChangable(false); getKernel_parameters().setIsChangable(false); getCustomProperties().setIsChangable(false); vmAttachedToPool = true; } }
private boolean pauseTransferIfNecessary(org.ovirt.engine.core.common.businessentities.storage.ImageTransfer entity, long ts) { if ((((org.ovirt.engine.core.bll.storage.disk.image.TransferImageCommand.getParameters().getKeepaliveInterval()) > 0) && (((entity.getPhase()) == (org.ovirt.engine.core.common.businessentities.storage.ImageTransferPhase.INITIALIZING)) || ((entity.getPhase()) == (org.ovirt.engine.core.common.businessentities.storage.ImageTransferPhase.TRANSFERRING)))) && ((((entity.getLastUpdated().getTime()) / 1000) + (org.ovirt.engine.core.bll.storage.disk.image.TransferImageCommand.getParameters().getKeepaliveInterval())) < ts)) { log.warn("Transfer paused due to no updates in {} seconds. {}", (ts - ((entity.getLastUpdated().getTime()) / 1000)), getTransferDescription()); updateEntityPhaseToPausedBySystem(AuditLogType.TRANSFER_IMAGE_PAUSED_BY_SYSTEM_TIMEOUT); return true; } return false; }
private org.ovirt.engine.core.common.businessentities.VmTemplate mockVmTemplate() { org.ovirt.engine.core.common.businessentities.VmTemplate template = new org.ovirt.engine.core.common.businessentities.VmTemplate(); template.setId(vmTemplateId); template.setStoragePoolId(storagePoolId); template.setClusterArch(ArchitectureType.x86_64); org.ovirt.engine.core.bll.CommonVmPoolWithVmsCommandTestAbstract.setDiskList(template); return template; }
@java.lang.Override public void setEnabled(boolean enabled) { nameEditor.setEnabled(enabled); valueEditor.setEnabled(enabled); }
protected org.springframework.jdbc.core.RowMapper<org.ovirt.engine.core.dao.scheduling.ClusterPolicyDaoImpl.ClusterPolicyUnit> createClusterPolicyUnitRowMapper() { return new org.springframework.jdbc.core.RowMapper<org.ovirt.engine.core.dao.scheduling.ClusterPolicyDaoImpl.ClusterPolicyUnit>() { @java.lang.Override public org.ovirt.engine.core.dao.scheduling.ClusterPolicyDaoImpl.ClusterPolicyUnit mapRow(java.sql.ResultSet rs, int arg1) throws java.sql.SQLException { org.ovirt.engine.core.dao.scheduling.ClusterPolicyDaoImpl.ClusterPolicyUnit unit = new org.ovirt.engine.core.dao.scheduling.ClusterPolicyDaoImpl.ClusterPolicyUnit(); unit.setClusterPolicyId(org.ovirt.engine.core.compat.Guid.createGuidFromString(rs.getString("cluster_policy_id"))); unit.setPolicyUnitId(org.ovirt.engine.core.compat.Guid.createGuidFromString(rs.getString("policy_unit_id"))); unit.setFilterSelected(rs.getBoolean("is_filter_selected")); unit.setFilterSequence(rs.getInt("filter_sequence")); unit.setFunctionSelected(rs.getBoolean("is_function_selected")); unit.setFactor(rs.getInt("factor")); unit.setBalanceSelected(rs.getBoolean("is_balance_selected")); return unit; } }; }
void localize(org.ovirt.engine.ui.webadmin.ApplicationConstants constants) { titleLabel.setText(constants.configurePopupTitle()); closeButton.setText(constants.closeButtonLabel()); rolesTab.setLabel(constants.configureRoleTabLabel()); clusterPoliciesTab.setLabel(constants.configureClusterPolicyTabLabel()); systemPermissionsTab.setLabel(constants.configureSystemPermissionTabLabel()); instanceTypesTab.setLabel(constants.instanceTypes()); macPoolsTab.setLabel(constants.configureMacPoolsTabLabel()); }
@org.ovirt.engine.api.restapi.types.Mapping(from = org.ovirt.engine.api.model.Quota.class, to = org.ovirt.engine.api.model.QuotaStorageLimit.class) public static org.ovirt.engine.api.model.QuotaStorageLimit map(org.ovirt.engine.core.common.businessentities.Quota entity, org.ovirt.engine.api.model.QuotaStorageLimit template) { org.ovirt.engine.api.model.QuotaStorageLimit model = (template != null) ? template : new org.ovirt.engine.api.model.QuotaStorageLimit(); org.ovirt.engine.core.compat.Guid guid = org.ovirt.engine.api.restapi.utils.GuidUtils.asGuid(model.getId()); if (guid.equals(entity.getId())) { org.ovirt.engine.api.restapi.types.QuotaMapper.map(model, entity.getGlobalQuotaStorage(), null, entity.getStoragePoolId().toString(), entity.getId().toString()); } else { if ((entity.getQuotaStorages()) != null) { for (org.ovirt.engine.core.common.businessentities.QuotaStorage quotaStorage : entity.getQuotaStorages()) { if (((quotaStorage.getStorageId()) != null) && (quotaStorage.getStorageId().equals(guid))) { org.ovirt.engine.api.restapi.types.QuotaMapper.map(model, quotaStorage, quotaStorage.getStorageId().toString(), entity.getStoragePoolId().toString(), entity.getId().toString()); } } } } return model; }
@org.junit.Test public void testReportConfigurationsOnHostWhenIpv4BootProtocolNotStatic() { initIpv4ConfigurationBootProtocolAddress(Ipv4BootProtocol.NONE, false); initIpv4ConfigurationBootProtocolNetmask(Ipv4BootProtocol.NONE, false); initIpv4ConfigurationBootProtocolGateway(Ipv4BootProtocol.NONE, false); org.ovirt.engine.core.utils.NetworkInSyncWithVdsNetworkInterface testedInstanceWithSameNonQosValues = createTestedInstanceWithSameNonQosValues(); java.util.List<org.ovirt.engine.core.common.businessentities.network.ReportedConfiguration> reportedConfigurationList = testedInstanceWithSameNonQosValues.reportConfigurationsOnHost().getReportedConfigurationList(); org.ovirt.engine.core.common.businessentities.network.IPv4Address primaryAddress = this.testedNetworkAttachment.getIpConfiguration().getIpv4PrimaryAddress(); java.util.List<org.ovirt.engine.core.common.businessentities.network.ReportedConfiguration> expectedReportedConfigurations = combineReportedConfigurations(createBasicAndQosReportedConfigurations(), new org.ovirt.engine.core.common.businessentities.network.ReportedConfiguration(org.ovirt.engine.core.common.businessentities.network.ReportedConfigurationType.IPV4_BOOT_PROTOCOL, iface.getIpv4BootProtocol().name(), primaryAddress.getBootProtocol().name(), true)); assertThat(reportedConfigurationList.containsAll(expectedReportedConfigurations), is(true)); assertThat(reportedConfigurationList.size(), is(expectedReportedConfigurations.size())); }
public boolean isMonitoringNeeded() { return ((((((((monitoringStrategy.isMonitoringNeeded(_vds)) && ((_vds.getStatus()) != (org.ovirt.engine.core.common.businessentities.VDSStatus.Installing))) && ((_vds.getStatus()) != (org.ovirt.engine.core.common.businessentities.VDSStatus.InstallFailed))) && ((_vds.getStatus()) != (org.ovirt.engine.core.common.businessentities.VDSStatus.Reboot))) && ((_vds.getStatus()) != (org.ovirt.engine.core.common.businessentities.VDSStatus.Maintenance))) && ((_vds.getStatus()) != (org.ovirt.engine.core.common.businessentities.VDSStatus.PendingApproval))) && ((_vds.getStatus()) != (org.ovirt.engine.core.common.businessentities.VDSStatus.InstallingOS))) && ((_vds.getStatus()) != (org.ovirt.engine.core.common.businessentities.VDSStatus.Down))) && ((_vds.getStatus()) != (org.ovirt.engine.core.common.businessentities.VDSStatus.Kdumping)); }
@org.junit.Test public void nicNotExist() { nicExists(false); assertCanDoActionFailure(EngineMessage.HOST_NETWORK_INTERFACE_NOT_EXIST.toString()); }
public static final org.ovirt.engine.ui.common.widget.table.column.AbstractDiskSizeColumn<org.ovirt.engine.core.common.businessentities.storage.Disk> getSizeColumn(java.lang.String sortBy) { org.ovirt.engine.ui.common.widget.table.column.AbstractDiskSizeColumn<org.ovirt.engine.core.common.businessentities.storage.Disk> column = new org.ovirt.engine.ui.common.widget.table.column.AbstractDiskSizeColumn<org.ovirt.engine.core.common.businessentities.storage.Disk>() { @java.lang.Override protected java.lang.Long getRawValue(org.ovirt.engine.core.common.businessentities.storage.Disk object) { return (object.getDiskStorageType()) == (org.ovirt.engine.core.common.businessentities.storage.DiskStorageType.IMAGE) ? ((org.ovirt.engine.core.common.businessentities.storage.DiskImage) (object)).getSize() : ((long) ((((org.ovirt.engine.core.common.businessentities.storage.LunDisk) (object)).getLun().getDeviceSize()) * (java.lang.Math.pow(1024, 3)))); } }; return org.ovirt.engine.ui.common.widget.uicommon.disks.DisksViewColumns.makeSortable(column, sortBy); }
private org.ovirt.engine.core.common.vdscommands.VDSReturnValue executeVerb(org.ovirt.engine.core.common.businessentities.StorageDomainStatic storage) { try { return org.ovirt.engine.core.bll.Backend.getInstance().getResourceManager().RunVdsCommand(VDSCommandType.GetVmsInfo, buildGetVmsInfoParameters(storage)); } catch (java.lang.RuntimeException e) { org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase logable = new org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase(); logable.addCustomValue("StorageDomainName", storage.getStorageName()); org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogDirector.log(logable, AuditLogType.IMPORTEXPORT_GET_VMS_INFO_FAILED); throw e; } }
private java.util.Set<org.ovirt.engine.core.compat.Guid> getCriticalSnapshotsChain(java.util.List<org.ovirt.engine.core.common.businessentities.storage.DiskImage> imagesFromActiveSnapshot, java.util.List<org.ovirt.engine.core.common.businessentities.storage.CinderDisk> cinderImagesForPreviewedSnapshot) { java.util.Set<org.ovirt.engine.core.compat.Guid> criticalSnapshotsChain = new java.util.HashSet<>(); for (org.ovirt.engine.core.common.businessentities.storage.DiskImage diskImageFromActive : imagesFromActiveSnapshot) { for (org.ovirt.engine.core.common.businessentities.storage.DiskImage previewedDiskImage : cinderImagesForPreviewedSnapshot) { if (diskImageFromActive.getId().equals(previewedDiskImage.getId())) { for (org.ovirt.engine.core.common.businessentities.storage.DiskImage diskImage : org.ovirt.engine.core.bll.RestoreAllSnapshotsCommand.getDiskImageDao().getAllSnapshotsForLeaf(diskImageFromActive.getImageId())) { criticalSnapshotsChain.add(diskImage.getVmSnapshotId()); } } } } return criticalSnapshotsChain; }
@java.lang.Override public void executeCommand(org.ovirt.engine.ui.uicommonweb.UICommand command) { com.google.gwt.user.cellview.client.TreeNode expandNode = findNode(getDataDisplayWidget().getRootTreeNode(), modelProvider.getSelectionModel().getSelectedObject()); if (expandNode != null) { expandTree(expandNode); } }
@java.lang.Override public java.util.List<T> getValue() { java.util.List<T> selectedItems = new java.util.ArrayList<>(); for (java.util.Map.Entry<T, com.google.gwt.user.client.ui.CheckBox> currentEntry : checkBoxes.entrySet()) { if (currentEntry.getValue().getValue()) { selectedItems.add(currentEntry.getKey()); } } return selectedItems; }
@org.junit.Test public void testStoredProcedureCall() { dao.deleteRunningJobsOfTasklessCommands(); }
private void removeCinderDisks(java.util.List<org.ovirt.engine.core.common.businessentities.storage.CinderDisk> cinderDisks) { org.ovirt.engine.core.common.action.RemoveAllVmCinderDisksParameters removeParam = new org.ovirt.engine.core.common.action.RemoveAllVmCinderDisksParameters(org.ovirt.engine.core.bll.RemoveVmTemplateCommand.getVmTemplateId(), cinderDisks); removeParam.setParentHasTasks((!(org.ovirt.engine.core.bll.RemoveVmTemplateCommand.getReturnValue().getVdsmTaskIdList().isEmpty()))); java.util.concurrent.Future<org.ovirt.engine.core.common.action.VdcReturnValueBase> future = org.ovirt.engine.core.bll.tasks.CommandCoordinatorUtil.executeAsyncCommand(VdcActionType.RemoveAllVmCinderDisks, withRootCommandInfo(removeParam, org.ovirt.engine.core.bll.RemoveVmTemplateCommand.getActionType()), org.ovirt.engine.core.bll.RemoveVmTemplateCommand.cloneContextAndDetachFromParent(), org.ovirt.engine.core.bll.storage.CINDERStorageHelper.getStorageEntities(cinderDisks)); try { future.get().getActionReturnValue(); } catch (java.lang.InterruptedException | java.util.concurrent.ExecutionException e) { log.error("Exception", e); } }
protected static org.ovirt.engine.api.restapi.resource.BackendVmApplicationResource getResource(org.ovirt.engine.core.compat.Guid id) { return new org.ovirt.engine.api.restapi.resource.BackendVmApplicationResource(id.toString(), org.ovirt.engine.api.restapi.resource.BackendVmApplicationResourceTest.collection); }
@java.lang.Override public void preventRollback() { org.ovirt.engine.core.bll.RemoveDiskSnapshotsCommand.getParameters().setExecutionIndex(0); }
@java.lang.Override public void onSuccess(java.lang.Object target, java.lang.Object returnValue) { java.lang.Object[] array = ((java.lang.Object[]) (target)); org.ovirt.engine.ui.uicommonweb.models.storage.RemoveStorageModel removeStorageModel = ((org.ovirt.engine.ui.uicommonweb.models.storage.RemoveStorageModel) (array[1])); java.util.List<org.ovirt.engine.core.common.businessentities.VDS> hosts = ((java.util.List<org.ovirt.engine.core.common.businessentities.VDS>) (returnValue)); removeStorageModel.getHostList().setItems(hosts); removeStorageModel.getHostList().setSelectedItem(org.ovirt.engine.ui.uicommonweb.Linq.firstOrDefault(hosts)); if (hosts.isEmpty()) { org.ovirt.engine.ui.uicommonweb.UICommand tempVar = createCancelCommand("Cancel"); tempVar.setIsDefault(true); removeStorageModel.getCommands().add(tempVar); } else { org.ovirt.engine.ui.uicommonweb.UICommand command; command = org.ovirt.engine.ui.uicommonweb.UICommand.createDefaultOkUiCommand("OnRemove", this); removeStorageModel.getCommands().add(command); command = createCancelCommand("Cancel"); removeStorageModel.getCommands().add(command); } }
public org.ovirt.engine.ui.uicommonweb.models.reports.ReportsListModel getReportsList() { return reportsListModel; }
protected boolean setAndValidateDiskProfiles() { if (isDiskImage()) { org.ovirt.engine.core.common.businessentities.DiskImage diskImage = ((org.ovirt.engine.core.common.businessentities.DiskImage) (getNewDisk())); java.util.Map<org.ovirt.engine.core.common.businessentities.DiskImage, org.ovirt.engine.core.compat.Guid> map = new java.util.HashMap<>(); map.put(diskImage, diskImage.getStorageIds().get(0)); return validate(org.ovirt.engine.core.bll.profiles.DiskProfileHelper.setAndValidateDiskProfiles(map, org.ovirt.engine.core.bll.UpdateVmDiskCommand.getStoragePool().getcompatibility_version())); } return true; }
private synchronized void updateQuotaCache() { try { updateQuotaCacheImpl(); } catch (java.lang.Throwable t) { log.error("Exception in updating quota cache: {}", org.apache.commons.lang.exception.ExceptionUtils.getRootCauseMessage(t)); log.debug("Exception", t); } }
@java.lang.Override public void save(org.ovirt.engine.core.common.businessentities.VmPool pool) { org.ovirt.engine.core.compat.Guid id = pool.getVmPoolId(); if (org.ovirt.engine.core.compat.Guid.isNullOrEmpty(id)) { id = org.ovirt.engine.core.compat.Guid.newGuid(); pool.setVmPoolId(id); } org.springframework.jdbc.core.namedparam.MapSqlParameterSource parameterSource = getCustomMapSqlParameterSource().addValue("vm_pool_description", pool.getVmPoolDescription()).addValue("vm_pool_comment", pool.getComment()).addValue("vm_pool_id", pool.getVmPoolId()).addValue("vm_pool_name", pool.getName()).addValue("vm_pool_type", pool.getVmPoolType()).addValue("parameters", pool.getParameters()).addValue("prestarted_vms", pool.getPrestartedVms()).addValue("vds_group_id", pool.getVdsGroupId()).addValue("max_assigned_vms_per_user", pool.getMaxAssignedVmsPerUser()).addValue("spice_proxy", pool.getSpiceProxy()); getCallsHandler().executeModification("InsertVm_pools", parameterSource); }
@java.lang.Override protected void readOsSection(XmlNode section) { _vm.getStaticData().setId(new org.ovirt.engine.core.compat.Guid(section.attributes.get("ovf:id").getValue())); XmlNode node = section.SelectSingleNode("Description"); if (node != null) { _vm.getStaticData().setOsId(osRepository.getOsIdByUniqueName(node.innerText)); } _vm.setClusterArch(ArchitectureType.x86_64); }
private boolean isPartiallySubmittedCommand(java.util.List<org.ovirt.engine.core.common.businessentities.AsyncTasks> tasks) { for (org.ovirt.engine.core.common.businessentities.AsyncTasks task : tasks) { if (!(org.ovirt.engine.core.bll.AsyncTaskManager.hasEmptyVdsmId(task))) { return true; } } return false; }
@java.lang.Override public org.ovirt.engine.core.common.eventqueue.EventResult call() { java.util.Set<org.ovirt.engine.core.compat.Guid> vdsConnectedToPool = org.ovirt.engine.core.vdsbroker.irsbroker.IrsProxyData.getVdsConnectedToPool(_storagePoolId); java.util.Set<org.ovirt.engine.core.compat.Guid> vdsDomInMaintenance = _domainsInMaintenance.get(domain.getId()); if ((vdsConnectedToPool.isEmpty()) || ((vdsDomInMaintenance != null) && (vdsDomInMaintenance.containsAll(vdsConnectedToPool)))) { org.ovirt.engine.core.vdsbroker.irsbroker.IrsProxyData.log.info("Moving domain '{}' to maintenance", domain.getId()); org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getStoragePoolIsoMapDao().updateStatus(domain.getStoragePoolIsoMapData().getId(), StorageDomainStatus.Maintenance); org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase auditLogableBase = new org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase(); auditLogableBase.addCustomValue("StorageDomainName", domain.getName()); auditLogableBase.addCustomValue("StoragePoolName", pool.getName()); new org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogDirector().log(auditLogableBase, AuditLogType.STORAGE_DOMAIN_MOVED_TO_MAINTENANCE); } return null; }
void update(org.ovirt.engine.core.common.businessentities.Bookmark bookmark);
@java.lang.Override protected void setActionMessageParameters() { addValidationMessage(EngineMessage.VAR__TYPE__NETWORK); addValidationMessage(EngineMessage.VAR__ACTION__ATTACH); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Migrate Virtual Machine(s)") java.lang.String migrateVirtualMachinesTitle();
@java.lang.Override protected boolean validate() { org.ovirt.engine.core.compat.Guid id = org.ovirt.engine.core.bll.aaa.RemoveUserCommand.getParameters().getId(); if (org.ovirt.engine.core.bll.aaa.RemoveUserCommand.getCurrentUser().getId().equals(id)) { addValidationMessage(EngineMessage.USER_CANNOT_REMOVE_HIMSELF); return false; } org.ovirt.engine.core.common.businessentities.aaa.DbUser dbUser = org.ovirt.engine.core.bll.aaa.RemoveUserCommand.getDbUserDao().get(id); if (dbUser == null) { addValidationMessage(EngineMessage.USER_MUST_EXIST_IN_DB); return false; } return true; }
private void prepareMocks(org.ovirt.engine.core.bll.gluster.CommitRemoveGlusterVolumeBricksCommand command) { doReturn(volumeDao).when(command).getGlusterVolumeDao(); org.ovirt.engine.core.bll.validator.gluster.GlusterBrickValidator brickValidator = spy(command.getBrickValidator()); doReturn(brickValidator).when(command).getBrickValidator(); doReturn(brickDao).when(brickValidator).getGlusterBrickDao(); doReturn(dbUtils).when(command).getDbUtils(); doReturn(getVds(VDSStatus.Up)).when(command).getUpServer(); doReturn(getVolumeWithRemoveBricksTask(volumeWithRemoveBricksTask)).when(volumeDao).getById(volumeWithRemoveBricksTask); doReturn(getBricks(volumeWithoutRemoveBricksTask)).when(brickDao).getGlusterVolumeBricksByTaskId(any(org.ovirt.engine.core.compat.Guid.class)); doReturn(getVolumeWithRemoveBricksTaskNotFinished(volumeWithRemoveBricksTaskNotFinished)).when(volumeDao).getById(volumeWithRemoveBricksTaskNotFinished); doReturn(getVolume(volumeWithoutAsyncTask)).when(volumeDao).getById(volumeWithoutAsyncTask); doReturn(getVolumeWithoutRemoveBricksTask(volumeWithoutRemoveBricksTask)).when(volumeDao).getById(volumeWithoutRemoveBricksTask); doReturn(getVolumeWithRemoveBricksTaskNull(volumeWithRemoveBricksTaskNull)).when(volumeDao).getById(volumeWithRemoveBricksTaskNull); doReturn(null).when(volumeDao).getById(null); }
public void PostNetworkAction(org.ovirt.engine.core.compat.Guid networkGuid, boolean succeeded) { org.ovirt.engine.ui.uicommonweb.models.datacenters.DataCenterNetworkModel networkModel = ((org.ovirt.engine.ui.uicommonweb.models.datacenters.DataCenterNetworkModel) (getWindow())); if (succeeded) { Cancel(); } else { networkModel.StopProgress(); return; } networkModel.StopProgress(); org.ovirt.engine.core.common.businessentities.Network network = networkModel.getcurrentNetwork(); org.ovirt.engine.core.compat.Guid networkId = (networkModel.getIsNew()) ? networkGuid : network.getId(); java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VDSGroup> attachNetworkToClusters = org.ovirt.engine.ui.uicommonweb.Linq.Except(networkModel.getnewClusters(), networkModel.getOriginalClusters()); java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase> actionParameters1 = new java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase>(); for (org.ovirt.engine.core.common.businessentities.VDSGroup attachNetworkToCluster : attachNetworkToClusters) { org.ovirt.engine.core.common.businessentities.Network tempVar = new org.ovirt.engine.core.common.businessentities.Network(); tempVar.setId(networkId); tempVar.setname(network.getname()); tempVar.setCluster(new org.ovirt.engine.core.common.businessentities.network_cluster()); actionParameters1.add(new org.ovirt.engine.core.common.action.AttachNetworkToVdsGroupParameter(attachNetworkToCluster, tempVar)); } org.ovirt.engine.ui.frontend.Frontend.RunMultipleAction(VdcActionType.AttachNetworkToVdsGroup, actionParameters1); }
private java.lang.Long parseSafeLong(java.util.Map<java.lang.String, java.lang.Object> innerMap, java.lang.String key) { return (innerMap.containsKey(key)) && (org.apache.commons.lang.StringUtils.isNumeric(innerMap.get(key).toString())) ? java.lang.Long.parseLong(innerMap.get(key).toString()) : null; }
public static void getStorageDomainById(org.ovirt.engine.ui.frontend.AsyncQuery aQuery, org.ovirt.engine.core.compat.Guid storageDomainId) { aQuery.converterCallback = new org.ovirt.engine.ui.frontend.IAsyncConverter() { @java.lang.Override public java.lang.Object Convert(java.lang.Object source, org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery) { return source != null ? ((org.ovirt.engine.core.common.businessentities.StorageDomain) (source)) : null; } }; org.ovirt.engine.ui.frontend.Frontend.RunQuery(VdcQueryType.GetStorageDomainById, new org.ovirt.engine.core.common.queries.IdQueryParameters(storageDomainId), aQuery); }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface> getPluggedForMac(java.lang.String macAddress) { return getCallsHandler().executeReadList("GetPluggedVmInterfacesByMac", mapper, getCustomMapSqlParameterSource().addValue("mac_address", macAddress)); }
@org.junit.Test public void readOnlyIsSupportedByDiskInterface() { disk.setReadOnly(true); disk.setDiskInterface(DiskInterface.VirtIO); assertThat(validator.isReadOnlyPropertyCompatibleWithInterface(), org.ovirt.engine.core.bll.validator.ValidationResultMatchers.isValid()); disk.setReadOnly(false); disk.setDiskInterface(DiskInterface.IDE); assertThat(validator.isReadOnlyPropertyCompatibleWithInterface(), org.ovirt.engine.core.bll.validator.ValidationResultMatchers.isValid()); }
@org.junit.Test public void testReadBooleanListEndElement() { org.ovirt.api.metamodel.runtime.xml.XmlReader reader = openReader("<action><values><value>true</value><value>false</value></values></action>"); reader.next(); reader.readBooleans(); assertEquals(javax.xml.stream.XMLStreamConstants.END_ELEMENT, reader.getEventType()); assertEquals("action", reader.getLocalName()); }
@java.lang.Override public void onAttachOrDetach(com.google.gwt.event.logical.shared.AttachEvent event) { com.google.gwt.core.client.Scheduler.get().scheduleDeferred(new com.google.gwt.core.client.Scheduler.ScheduledCommand() { @java.lang.Override public void execute() { recalculateSize(); showScrollButtons(); } }); }
public com.google.gwt.safehtml.shared.SafeHtml getName(T item) { java.lang.String result = ""; if (item instanceof org.ovirt.engine.core.common.businessentities.Nameable) { result = ((org.ovirt.engine.core.common.businessentities.Nameable) (item)).getName(); } return com.google.gwt.safehtml.shared.SafeHtmlUtils.fromString(result); }
public org.ovirt.engine.core.bll.ValidationResult valuesConsistent() { org.ovirt.engine.core.common.businessentities.network.HostNetworkQos qos = getQos(); if (qos == null) { return org.ovirt.engine.core.bll.ValidationResult.VALID; } java.lang.Integer outUpperlimit = qos.getOutAverageUpperlimit(); java.lang.Integer outRealtime = qos.getOutAverageRealtime(); return ((outUpperlimit != null) && (outRealtime != null)) && (outUpperlimit < outRealtime) ? new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_HOST_NETWORK_QOS_INCONSISTENT_VALUES) : org.ovirt.engine.core.bll.ValidationResult.VALID; }
protected org.ovirt.engine.api.model.Users mapDbUserCollection(java.util.List<org.ovirt.engine.core.common.businessentities.DbUser> entities) { org.ovirt.engine.api.model.Users collection = new org.ovirt.engine.api.model.Users(); for (org.ovirt.engine.core.common.businessentities.DbUser entity : entities) { org.ovirt.engine.api.model.User user = map(entity); user = populate(user, entity); user = addLinks(user, org.ovirt.engine.api.model.BaseResource.class); collection.getUsers().add(user); } return collection; }
@org.junit.Test public void testRemoveCantDo() throws java.lang.Exception { setUpEntityQueryExpectations(VdcQueryType.GetVdsGroupsByStoragePoolId, org.ovirt.engine.core.common.queries.StoragePoolQueryParametersBase.class, new java.lang.String[]{ "StoragePoolId" }, new java.lang.Object[]{ org.ovirt.engine.api.restapi.resource.BackendDataCenterClustersResourceTest.dataCenterId }, setUpVDSGroups(), null); doTestBadRemove(false, true, org.ovirt.engine.api.restapi.resource.CANT_DO); }
@org.junit.Test public void testAlreadyExistStorageDomain() { when(command.getStorageDomainStaticDao().get(any(org.ovirt.engine.core.compat.Guid.class))).thenReturn(org.ovirt.engine.core.bll.storage.domain.AddExistingBlockStorageDomainCommandTest.getStorageDomain()); assertFalse("Storage Domain already exists", command.canAddDomain()); assertTrue("Import block Storage Domain should have failed due to already existing Storage Domain", command.getReturnValue().getValidationMessages().contains(EngineMessage.ACTION_TYPE_FAILED_STORAGE_DOMAIN_ALREADY_EXIST.toString())); }
protected void forceCreationWarning(java.util.ArrayList<java.lang.String> usedLunsMessages) { org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel confirmationModel = new org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel(); setConfirmWindow(confirmationModel); confirmationModel.setTitle(org.ovirt.engine.ui.uicommonweb.models.vms.AbstractDiskModel.CONSTANTS.forceStorageDomainCreation()); confirmationModel.setMessage(org.ovirt.engine.ui.uicommonweb.models.vms.AbstractDiskModel.CONSTANTS.lunsAlreadyPartOfSD()); confirmationModel.setHelpTag(HelpTag.force_lun_disk_creation); confirmationModel.setHashName("force_lun_disk_creation"); confirmationModel.setItems(usedLunsMessages); org.ovirt.engine.ui.uicommonweb.UICommand forceSaveCommand = new org.ovirt.engine.ui.uicommonweb.UICommand("OnForceSave", this); forceSaveCommand.setTitle(org.ovirt.engine.ui.uicommonweb.models.vms.AbstractDiskModel.CONSTANTS.ok()); forceSaveCommand.setIsDefault(true); confirmationModel.getCommands().add(forceSaveCommand); org.ovirt.engine.ui.uicommonweb.UICommand cancelconfirmCommand = new org.ovirt.engine.ui.uicommonweb.UICommand("CancelConfirm", this); cancelconfirmCommand.setTitle(org.ovirt.engine.ui.uicommonweb.models.vms.AbstractDiskModel.CONSTANTS.cancel()); cancelconfirmCommand.setIsCancel(true); confirmationModel.getCommands().add(cancelconfirmCommand); }
protected abstract org.ovirt.engine.core.common.businessentities.HostJobInfo.HostJobType getHostJobType();
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Maintenance Host(s)") java.lang.String maintenanceHostsTitle();
@java.lang.Override public org.ovirt.engine.ui.uicommonweb.validation.ValidationResult validate(java.lang.Object value) { org.ovirt.engine.ui.uicommonweb.validation.ValidationResult result = new org.ovirt.engine.ui.uicommonweb.validation.ValidationResult(); if (((value != null) && (value instanceof java.lang.String)) && ((((java.lang.String) (value)).length()) > (getMaxLength()))) { result.setSuccess(false); result.getReasons().add(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getMessages().lenValidationFieldMusnotExceed(getMaxLength())); } return result; }
@java.lang.Override protected void executeCommand() { org.ovirt.engine.core.utils.transaction.TransactionSupport.executeInNewTransaction(() -> { initImportClonedTemplateDisks(); addVmTemplateToDb(); mapDbUsers(); updateOriginalTemplateNameOnDerivedVms(); addVmInterfaces(); getCompensationContext().stateChanged(); org.ovirt.engine.core.bll.exportimport.vmHandler.addVmInitToDB(getVmTemplate().getVmInit()); return null; }); boolean doesVmTemplateContainImages = !(getImages().isEmpty()); if (doesVmTemplateContainImages && (!(org.ovirt.engine.core.bll.exportimport.ImportVmTemplateCommand.getParameters().isImagesExistOnTargetStorageDomain()))) { moveOrCopyAllImageGroups(getVmTemplateId(), getImages()); } org.ovirt.engine.core.bll.exportimport.ImportVmTemplateCommand.getVmDeviceUtils().addImportedDevices(getVmTemplate(), org.ovirt.engine.core.bll.exportimport.ImportVmTemplateCommand.getParameters().isImportAsNewEntity(), false); if ((!doesVmTemplateContainImages) || (org.ovirt.engine.core.bll.exportimport.ImportVmTemplateCommand.getParameters().isImagesExistOnTargetStorageDomain())) { endMoveOrCopyCommand(); } discardHelper.logIfDisksWithIllegalPassDiscardExist(getVmTemplateId()); checkTrustedService(); org.ovirt.engine.core.bll.exportimport.ImportVmTemplateCommand.setSucceeded(true); }
public java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase> buildParameters(java.util.List<org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface> nics) { java.util.Set<org.ovirt.engine.core.compat.Guid> nonUpdateableHosts = new java.util.HashSet<>(); java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase> parameters = new java.util.ArrayList<>(); boolean vlanNetwork = org.ovirt.engine.core.utils.NetworkUtils.isVlan(network); for (org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface nic : nics) { org.ovirt.engine.core.common.action.SetupNetworksParameters setupNetworkParams = createSetupNetworksParameters(nic.getVdsId()); org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface nicToConfigure = getNicToConfigure(setupNetworkParams.getInterfaces(), nic.getId()); if (network.getName().equals(nicToConfigure.getNetworkName())) { nicToConfigure.setNetworkName(null); } else if (vlanNetwork) { org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface vlan = getVlanDevice(setupNetworkParams.getInterfaces(), nicToConfigure); if (vlan == null) { nonUpdateableHosts.add(nic.getVdsId()); } else { setupNetworkParams.getInterfaces().remove(vlan); } } else { nonUpdateableHosts.add(nic.getVdsId()); continue; } parameters.add(setupNetworkParams); } reportNonUpdateableHosts(nonUpdateableHosts); return parameters; }
@java.lang.Override protected void setUpQueryExpectations(java.lang.String query, java.lang.Object failure) throws java.lang.Exception { setUpEntityQueryExpectations(VdcQueryType.GetErrataForHost, org.ovirt.engine.core.common.queries.GetErrataCountsParameters.class, new java.lang.String[]{ "Id" }, new java.lang.Object[]{ GUIDS[0] }, getErrataData(), failure); control.replay(); }
private void extractRemovedNetworks() { for (org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface iface : getExistingIfaces().values()) { java.lang.String networkName = iface.getNetworkName(); if ((org.apache.commons.lang.StringUtils.isNotBlank(networkName)) && (!(attachedNetworksNames.contains(networkName)))) { removedNetworks.add(networkName); final java.util.List<java.lang.String> vmNames = getVmInterfaceManager().findActiveVmsUsingNetworks(params.getVdsId(), java.util.Collections.singleton(networkName)); for (java.lang.String vmName : vmNames) { addDetailedViolation(EngineMessage.NETWORK_CANNOT_DETACH_NETWORK_USED_BY_VMS, vmName, java.util.Collections.singletonMap("networkNames", networkName)); } } } }
public void dismissEvent() { final org.ovirt.engine.core.common.businessentities.AuditLog auditLog = org.ovirt.engine.ui.uicommonweb.models.events.EventListModel.getSelectedItem(); if (auditLog == null) { return; } org.ovirt.engine.core.common.action.RemoveAuditLogByIdParameters params = new org.ovirt.engine.core.common.action.RemoveAuditLogByIdParameters(auditLog.getAuditLogId()); org.ovirt.engine.ui.frontend.Frontend.getInstance().runAction(VdcActionType.RemoveAuditLogById, params, new org.ovirt.engine.ui.uicompat.IFrontendActionAsyncCallback() { @java.lang.Override public void executed(org.ovirt.engine.ui.uicompat.FrontendActionAsyncResult result) { org.ovirt.engine.ui.uicommonweb.models.events.EventListModel.this.refresh(); } }); }
@org.junit.Test public void testUpdateWithNonGuidId() { try { javax.ws.rs.core.UriInfo uriInfo = mockUri("hosts", "00000001-0001-0001-0001-000000000011", "nics", "116"); javax.ws.rs.core.Request request = mockRequest("PUT"); control.replay(); org.ovirt.engine.api.model.Fault fault = usageFinder.getUsageMessage(uriInfo, request); assertEquals("For correct usage, see: http://localhost:8080/ovirt-engine/api/model#services/host-nic/methods/update", fault.getDetail()); } catch (java.net.URISyntaxException | java.lang.ClassNotFoundException | java.io.IOException e) { fail(); } }
@java.lang.Override protected void ExecuteVdsBrokerCommand() { status = org.ovirt.engine.core.vdsbroker.gluster.StartRebalanceGlusterVolumeVDSCommand.getBroker().glusterVolumeRebalanceStart(org.ovirt.engine.core.vdsbroker.gluster.StartRebalanceGlusterVolumeVDSCommand.getParameters().getVolumeName(), org.ovirt.engine.core.vdsbroker.gluster.StartRebalanceGlusterVolumeVDSCommand.getParameters().isFixLayoutOnly(), org.ovirt.engine.core.vdsbroker.gluster.StartRebalanceGlusterVolumeVDSCommand.getParameters().isForceAction()); org.ovirt.engine.core.vdsbroker.gluster.StartRebalanceGlusterVolumeVDSCommand.proceedProxyReturnValue(); }
private boolean shouldCommandEndOnAsyncOpEnd(org.ovirt.engine.core.bll.CommandBase<?> cmd) { return (cmd.getParameters().getEndProcedure()) == (org.ovirt.engine.core.common.action.VdcActionParametersBase.EndProcedure.COMMAND_MANAGED); }
@org.junit.Test public void vmNotDuringSnapshotReturnsInvalidResultWhenInSnapshot() throws java.lang.Exception { when(snapshotDao.exists(vmId, SnapshotStatus.LOCKED)).thenReturn(true); org.ovirt.engine.core.bll.snapshots.SnapshotsValidatorTest.validateInvalidResult(validator.vmNotDuringSnapshot(vmId), EngineMessage.ACTION_TYPE_FAILED_VM_IS_DURING_SNAPSHOT); }
private boolean shouldBeConfigureAsBondSlave(java.lang.String interfaceName) { for (org.ovirt.engine.core.common.businessentities.network.Bond bond : params.getBonds()) { if (bond.getSlaves().contains(interfaceName)) { return true; } } org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface existingNic = existingInterfacesMap.get(interfaceName); if (existingNic == null) { return false; } if (existingNic.isPartOfBond()) { java.lang.String bondName = existingNic.getBondName(); org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface bond = existingInterfacesMap.get(bondName); boolean bondWasRemoved = params.getRemovedBonds().contains(bond.getId()); boolean slaveWasRemovedFromBond = (bondsMap.containsKey(bondName)) ? !(bondsMap.get(bondName).getSlaves().contains(interfaceName)) : false; return (!bondWasRemoved) && (!slaveWasRemovedFromBond); } return false; }
private void updateSpiceUsbAutoShare(final org.ovirt.engine.ui.uicommonweb.models.vms.ISpice spice) { org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().getSpiceUsbAutoShare(new org.ovirt.engine.ui.frontend.AsyncQuery(new org.ovirt.engine.ui.frontend.AsyncCallback<java.lang.Boolean>() { @java.lang.Override public void onSuccess(java.lang.Boolean returnValue) { spice.getOptions().setUsbAutoShare(returnValue); } })); }
@java.lang.Override protected boolean canDoAction() { if ((((org.ovirt.engine.core.bll.RemoveFenceAgentCommand.getParameters()) == null) || ((org.ovirt.engine.core.bll.RemoveFenceAgentCommand.getParameters().getAgent()) == null)) || ((org.ovirt.engine.core.bll.RemoveFenceAgentCommand.getParameters().getAgent().getId()) == null)) { return failCanDoAction(EngineMessage.VDS_REMOVE_FENCE_AGENT_ID_REQUIRED); } return super.canDoAction(); }
private void updateRngDeviceIfNecessary(org.ovirt.engine.core.compat.Guid vmBaseId, org.ovirt.engine.core.compat.Version customCompatibilityLevel, org.ovirt.engine.core.common.action.HasRngDevice updateParameters) { final org.ovirt.engine.core.compat.Version oldEffectiveVersion = org.ovirt.engine.core.common.utils.CompatibilityVersionUtils.getEffective(customCompatibilityLevel, () -> oldCluster.getCompatibilityVersion()); final org.ovirt.engine.core.compat.Version newEffectiveVersion = org.ovirt.engine.core.common.utils.CompatibilityVersionUtils.getEffective(customCompatibilityLevel, () -> getCluster().getCompatibilityVersion()); final java.util.Optional<org.ovirt.engine.core.common.businessentities.VmRngDevice> updatedDeviceOptional = rngDeviceUtils.createUpdatedRngDeviceIfNecessary(oldEffectiveVersion, newEffectiveVersion, vmBaseId, org.ovirt.engine.core.bll.UpdateClusterCommand.cloneContext()); if (updatedDeviceOptional.isPresent()) { updateParameters.setUpdateRngDevice(true); updateParameters.setRngDevice(updatedDeviceOptional.get()); } }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.VDS> filter(java.util.List<org.ovirt.engine.core.common.businessentities.VDS> hosts, org.ovirt.engine.core.common.businessentities.VM vm, java.util.Map<java.lang.String, java.lang.String> parameters, org.ovirt.engine.core.common.scheduling.PerHostMessages messages) { java.util.List<org.ovirt.engine.core.common.businessentities.VDS> list = new java.util.ArrayList<>(); for (org.ovirt.engine.core.common.businessentities.VDS vds : hosts) { org.ovirt.engine.core.common.businessentities.VDSGroup cluster = getVdsGroupDao().get(vds.getVdsGroupId()); java.lang.Integer cores = org.ovirt.engine.core.bll.scheduling.SlaValidator.getEffectiveCpuCores(vds, ((cluster != null) && (cluster.getCountThreadsAsCores()))); if ((cores != null) && ((vm.getNumOfCpus()) > cores)) { messages.addMessage(vds.getId(), EngineMessage.VAR__DETAIL__NOT_ENOUGH_CORES.toString()); org.ovirt.engine.core.bll.scheduling.policyunits.CPUPolicyUnit.log.debug("Host '{}' has less cores ({}) than vm cores ({})", vds.getName(), cores, vm.getNumOfCpus()); continue; } list.add(vds); } return list; }
public void signOut() { for (org.ovirt.engine.ui.uicommonweb.models.SearchableListModel listModel : getItems()) { listModel.stopRefresh(); } getEventList().stopRefresh(); getAlertList().stopRefresh(); getTaskList().stopRefresh(); getBookmarkList().stopRefresh(); getRoleListModel().stopRefresh(); getSystemPermissionListModel().stopRefresh(); getClusterPolicyListModel().stopRefresh(); if (org.ovirt.engine.ui.frontend.Frontend.getInstance().getIsUserLoggedIn()) { org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery = new org.ovirt.engine.ui.frontend.AsyncQuery(); _asyncQuery.setHandleFailure(true); _asyncQuery.setModel(this); _asyncQuery.asyncCallback = new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object ReturnValue) { } }; setLoggedInUser(null); getSignedOutEvent().raise(this, EventArgs.EMPTY); org.ovirt.engine.ui.frontend.Frontend.getInstance().logoffAsync(org.ovirt.engine.ui.frontend.Frontend.getInstance().getLoggedInUser(), _asyncQuery); } }
public static org.ovirt.engine.core.common.errors.EngineMessage forValue(int value) { return org.ovirt.engine.core.common.errors.EngineMessage.values()[value]; }
public org.ovirt.engine.ui.uicommonweb.UICommand getImportVmCommand() { return importVmCommand; }
public void updateVmFromFullList(java.util.Map<java.lang.String, java.lang.Object> vmInfo) { if ((!(org.ovirt.engine.core.common.utils.VmDeviceCommonUtils.isOldClusterVersion(getGroupCompatibilityVersion(vdsId)))) && (isVmDevicesChanged(org.ovirt.engine.core.vdsbroker.VmDevicesMonitoring.getVmId(vmInfo), org.ovirt.engine.core.vdsbroker.VmDevicesMonitoring.UPDATE_HASH, fetchTime))) { processFullList(vmInfo); } }
@org.junit.Test public void shouldHaveNotingToMigrate() { when(rulesEnforcer.chooseNextVmToMigrate(any(org.ovirt.engine.core.common.businessentities.VDSGroup.class))).thenReturn(null); verify(arem, never()).migrateVM(any(org.ovirt.engine.core.common.businessentities.VM.class)); }
@java.lang.Override public javax.ws.rs.core.Response add(org.ovirt.engine.api.model.Disk disk) { validateParameters(disk, "provisionedSize|size", "format", "interface"); validateEnums(org.ovirt.engine.api.model.Disk.class, disk); org.ovirt.engine.core.common.action.AddDiskParameters params = new org.ovirt.engine.core.common.action.AddDiskParameters(); params.setDiskInfo(getMapper(org.ovirt.engine.api.model.Disk.class, org.ovirt.engine.api.model.Disk.class).map(disk, null)); if (((disk.isSetStorageDomains()) && (disk.getStorageDomains().isSetStorageDomains())) && (disk.getStorageDomains().getStorageDomains().get(0).isSetId())) { params.setStorageDomainId(org.ovirt.engine.core.compat.Guid.createGuidFromString(disk.getStorageDomains().getStorageDomains().get(0).getId())); } else if ((disk.isSetStorageDomains()) && (disk.getStorageDomains().getStorageDomains().get(0).isSetName())) { params.setStorageDomainId(getEntity(org.ovirt.engine.core.common.businessentities.storage_domains.class, SearchType.StorageDomain, ("Storage: name=" + (disk.getStorageDomains().getStorageDomains().get(0).getName()))).getId()); } return performCreation(VdcActionType.AddDisk, params, new org.ovirt.engine.api.restapi.resource.QueryIdResolver(org.ovirt.engine.core.common.queries.VdcQueryType.GetDiskByDiskId, org.ovirt.engine.core.common.queries.GetDiskByDiskIdParameters.class)); }
public static void getAllVmTemplates(org.ovirt.engine.ui.frontend.AsyncQuery aQuery, final boolean refresh) { aQuery.converterCallback = new org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.TemplateConverter(); org.ovirt.engine.core.common.queries.VdcQueryParametersBase params = new org.ovirt.engine.core.common.queries.VdcQueryParametersBase(); params.setRefresh(refresh); org.ovirt.engine.ui.frontend.Frontend.RunQuery(VdcQueryType.GetAllVmTemplates, params, aQuery); }
public void setUpdateAvailable(boolean updateAvailable) { vdsDynamic.setUpdateAvailable(updateAvailable); }
@java.lang.Override public org.ovirt.engine.core.common.AuditLogType getAuditLogTypeValue() { return org.ovirt.engine.core.bll.ClearAllDismissedAuditLogsCommand.getSucceeded() ? org.ovirt.engine.core.common.AuditLogType.USER_CLEAR_ALL_DISMISSED_AUDIT_LOG : org.ovirt.engine.core.common.AuditLogType.USER_CLEAR_ALL_DISMISSED_AUDIT_LOG_FAILED; }
public java.util.Map<java.lang.String, java.util.List<java.util.Map<java.lang.String, java.lang.String>>> getHBAs() { return vdsDynamic.getHBAs(); }
public org.ovirt.engine.core.bll.ValidationResult diskImagesHaveNoDerivedDisks(org.ovirt.engine.core.compat.Guid storageDomainId) { java.util.List<java.lang.String> disksInfo = new java.util.LinkedList<>(); for (org.ovirt.engine.core.common.businessentities.DiskImage diskImage : diskImages) { if (((diskImage.getVmEntityType()) != null) && (diskImage.getVmEntityType().isTemplateType())) { java.util.List<org.ovirt.engine.core.common.businessentities.DiskImage> basedDisks = getDiskImageDAO().getAllSnapshotsForParent(diskImage.getImageId()); for (org.ovirt.engine.core.common.businessentities.DiskImage basedDisk : basedDisks) { if ((storageDomainId == null) || (basedDisk.getStorageIds().contains(storageDomainId))) { disksInfo.add(java.lang.String.format("%s (%s) ", basedDisk.getDiskAlias(), basedDisk.getId())); } } } } if (!(disksInfo.isEmpty())) { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.VdcBllMessages.ACTION_TYPE_FAILED_DETECTED_DERIVED_DISKS, java.lang.String.format("$disksInfo %s", java.lang.String.format(org.apache.commons.lang.StringUtils.join(disksInfo, "%n")))); } return org.ovirt.engine.core.bll.ValidationResult.VALID; }
public void setIsLocal(boolean isLocal) { this.local = isLocal; }
private void expandTree(com.google.gwt.user.cellview.client.TreeNode node) { expandTree(node, org.ovirt.engine.ui.webadmin.widget.tree.SystemTree.ALL_LEVELS); }
@org.junit.Before public void setUp() { host = createHost(); org.mockito.Mockito.when(vdsStaticDao.get(org.ovirt.engine.core.bll.host.util.HostIdToLoggableNameFunctionTest.hostId)).thenReturn(host); }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("IOps") java.lang.String iopsLabelQosPopup();
public void Manage() { if ((getWindow()) != null) { return; } org.ovirt.engine.core.compat.Guid storagePoolId = ((getEntity().getstorage_pool_id()) != null) ? getEntity().getstorage_pool_id().getValue() : org.ovirt.engine.core.compat.NGuid.Empty; org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery = new org.ovirt.engine.ui.frontend.AsyncQuery(); _asyncQuery.setModel(this); _asyncQuery.asyncCallback = new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void OnSuccess(java.lang.Object model, java.lang.Object result) { org.ovirt.engine.ui.uicommonweb.models.clusters.ClusterNetworkListModel clusterNetworkListModel = ((org.ovirt.engine.ui.uicommonweb.models.clusters.ClusterNetworkListModel) (model)); java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Network> dcNetworks = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Network>) (result)); org.ovirt.engine.ui.uicommonweb.models.ListModel networkToManage = createNetworkList(dcNetworks); clusterNetworkListModel.setWindow(networkToManage); networkToManage.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().assignDetachNetworksTitle()); networkToManage.setHashName("assign_networks"); } }; org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.GetNetworkList(_asyncQuery, storagePoolId); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Brick Directory should not contain any space") java.lang.String invalidBrickDirectoryContainsSpaceMsg();
@java.lang.Override protected boolean canDoAction() { org.ovirt.engine.core.bll.validator.HostValidator validator = new org.ovirt.engine.core.bll.validator.HostValidator(org.ovirt.engine.core.bll.ActivateVdsCommand.getVds()); return ((validate(validator.hostExists())) && (validate(validator.validateStatusForActivation()))) && (validate(validator.validateUniqueId())); }
public static java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Network> GetClusterNetworkList(org.ovirt.engine.core.compat.Guid clusterId) { org.ovirt.engine.core.common.queries.VdcQueryReturnValue returnValue = org.ovirt.engine.ui.frontend.Frontend.RunQuery(VdcQueryType.GetAllNetworksByClusterId, new org.ovirt.engine.core.common.queries.VdsGroupQueryParamenters(clusterId)); if (((returnValue != null) && (returnValue.getSucceeded())) && ((returnValue.getReturnValue()) != null)) { return ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Network>) (returnValue.getReturnValue())); } return new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Network>(); }
@java.lang.Override public boolean equals(java.lang.Object obj) { if ((this) == obj) { return true; } if (!(obj instanceof org.ovirt.engine.core.common.businessentities.storage.LUNs)) { return false; } org.ovirt.engine.core.common.businessentities.storage.LUNs other = ((org.ovirt.engine.core.common.businessentities.storage.LUNs) (obj)); return ((((((((((((((((((((java.util.Objects.equals(id, other.id)) && (java.util.Objects.equals(_lunConnections, other._lunConnections))) && (java.util.Objects.equals(lunMapping, other.lunMapping))) && (java.util.Objects.equals(physicalVolumeId, other.physicalVolumeId))) && ((deviceSize) == (other.deviceSize))) && ((pvSize) == (other.pvSize))) && (java.util.Objects.equals(discardMaxSize, other.discardMaxSize))) && (java.util.Objects.equals(discardZeroesData, other.discardZeroesData))) && ((lunType) == (other.lunType))) && (java.util.Objects.equals(pathsDictionary, other.pathsDictionary))) && (java.util.Objects.equals(pathsCapacity, other.pathsCapacity))) && (java.util.Objects.equals(vendorName, other.vendorName))) && (java.util.Objects.equals(productId, other.productId))) && (java.util.Objects.equals(serial, other.serial))) && (java.util.Objects.equals(vendorId, other.vendorId))) && (java.util.Objects.equals(volumeGroupId, other.volumeGroupId))) && (java.util.Objects.equals(status, other.status))) && (java.util.Objects.equals(diskId, other.diskId))) && (java.util.Objects.equals(diskAlias, other.diskAlias))) && (java.util.Objects.equals(storageDomainId, other.storageDomainId))) && (java.util.Objects.equals(storageDomainName, other.storageDomainName)); }
@java.lang.Override protected org.ovirt.engine.api.model.Template doPopulate(org.ovirt.engine.api.model.Template model, org.ovirt.engine.core.common.businessentities.VmTemplate entity) { if (!(model.isSetConsole())) { model.setConsole(new org.ovirt.engine.api.model.Console()); } model.getConsole().setEnabled((!(getConsoleDevicesForEntity(entity.getId()).isEmpty()))); if (!(model.isSetVirtioScsi())) { model.setVirtioScsi(new org.ovirt.engine.api.model.VirtIOSCSI()); } model.getVirtioScsi().setEnabled((!(org.ovirt.engine.api.restapi.util.VmHelper.getVirtioScsiControllersForEntity(this, entity.getId()).isEmpty()))); model.setSoundcardEnabled((!(org.ovirt.engine.api.restapi.util.VmHelper.getSoundDevicesForEntity(this, entity.getId()).isEmpty()))); java.util.List<org.ovirt.engine.core.common.businessentities.VmRngDevice> rngDevices = getRngDevices(entity.getId()); if ((rngDevices != null) && (!(rngDevices.isEmpty()))) { model.setRngDevice(org.ovirt.engine.api.restapi.types.RngDeviceMapper.map(rngDevices.get(0), null)); } return model; }
@java.lang.Override public void onSuccess(java.lang.Object target, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.models.storage.StorageModel storageModel = ((org.ovirt.engine.ui.uicommonweb.models.storage.StorageModel) (target)); org.ovirt.engine.ui.uicommonweb.models.storage.StorageModelBehavior storageModelBehavior = behavior; java.util.List<org.ovirt.engine.core.common.businessentities.StoragePool> dataCenters = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StoragePool>) (returnValue)); dataCenters = storageModelBehavior.filterDataCenter(dataCenters); org.ovirt.engine.ui.uicommonweb.models.storage.StorageModel.addEmptyDataCenterToList(dataCenters); org.ovirt.engine.core.common.businessentities.StoragePool oldSelectedItem = storageModel.getDataCenter().getSelectedItem(); storageModel.getDataCenter().setItems(dataCenters); if (oldSelectedItem != null) { storageModel.getDataCenter().setSelectedItem(org.ovirt.engine.ui.uicommonweb.Linq.firstOrNull(dataCenters, new org.ovirt.engine.ui.uicommonweb.Linq.IdPredicate<>(oldSelectedItem.getId()))); } else { storageModel.getDataCenter().setSelectedItem(((getStorage()) == null ? org.ovirt.engine.ui.uicommonweb.Linq.firstOrNull(dataCenters) : org.ovirt.engine.ui.uicommonweb.Linq.firstOrNull(dataCenters, new org.ovirt.engine.ui.uicommonweb.Linq.IdPredicate<>(org.ovirt.engine.ui.uicommonweb.models.storage.StorageModel.UnassignedDataCenterId)))); } }
private void InitVdsBroker() { org.ovirt.engine.core.vdsbroker.VdsManager.log.infoFormat("Initialize vdsBroker ({0},{1})", _vds.getHostName(), _vds.getPort()); int clientTimeOut = (org.ovirt.engine.core.common.config.Config.<java.lang.Integer>getValue(ConfigValues.vdsTimeout)) * 1000; int connectionTimeOut = (org.ovirt.engine.core.common.config.Config.<java.lang.Integer>getValue(ConfigValues.vdsConnectionTimeout)) * 1000; int clientRetries = org.ovirt.engine.core.common.config.Config.<java.lang.Integer>getValue(ConfigValues.vdsRetries); _vdsProxy = org.ovirt.engine.core.vdsbroker.jsonrpc.TransportFactory.createVdsServer(_vds.getProtocol(), _vds.getHostName(), _vds.getPort(), clientTimeOut, connectionTimeOut, clientRetries); }
@java.lang.Override protected void setActionMessageParameters() { addCanDoActionMessage(VdcBllMessages.VAR__ACTION__DISABLE); addCanDoActionMessage(VdcBllMessages.VAR__TYPE__GLUSTER_HOOK); }
@java.lang.Override public void onSuccess(java.lang.Integer returnValue) { maxSpmPriority = returnValue; InitSpmPriorities1(); }
@org.junit.Test public void testAllDomainsHaveSpaceForNewDisksSuccess() { setUpGeneralValidations(); setUpDiskValidations(); java.util.List<org.ovirt.engine.core.common.businessentities.DiskImage> disksList = java.util.Collections.emptyList(); doReturn(disksList).when(cmd).getDisksList(); doReturn(ValidationResult.VALID).when(multipleStorageDomainsValidator).allDomainsHaveSpaceForNewDisks(disksList); org.ovirt.engine.core.bll.CanDoActionTestUtils.runAndAssertCanDoActionSuccess(cmd); verify(multipleStorageDomainsValidator).allDomainsHaveSpaceForNewDisks(disksList); }
public java.util.Collection<java.lang.String> getReasonMessages() { java.util.List<java.lang.String> lines = new java.util.ArrayList<>(); for (java.util.Map.Entry<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.common.errors.EngineMessage, java.lang.String>> line : filteredOutReasons.entrySet()) { lines.add(line.getValue().getFirst().name()); lines.add(java.lang.String.format("$%1$s %2$s", "hostName", hostNames.get(line.getKey()))); lines.add(java.lang.String.format("$%1$s %2$s", "filterName", line.getValue().getSecond())); final java.util.List<java.lang.String> detailMessages = details.getMessages(line.getKey()); if ((detailMessages == null) || (detailMessages.isEmpty())) { lines.add(EngineMessage.SCHEDULING_HOST_FILTERED_REASON.name()); } else { lines.addAll(detailMessages); lines.add(EngineMessage.SCHEDULING_HOST_FILTERED_REASON_WITH_DETAIL.name()); } } return lines; }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Allow to create new Cluster") java.lang.String allowToCreateNewClusterRoleTreeTooltip();
@java.lang.Override public javax.ws.rs.core.Response add(org.ovirt.engine.api.model.VmPool pool) { validateParameters(pool, "name", "template.id|name", "cluster.id|name"); org.ovirt.engine.core.common.businessentities.VmTemplate template = getVmTemplate(pool); if (namedTemplate(pool)) { pool.getTemplate().setId(template.getId().toString()); } if (namedCluster(pool)) { pool.getCluster().setId(getClusterId(pool)); } org.ovirt.engine.core.common.businessentities.VmPool entity = map(pool); entity.setVmPoolType(VmPoolType.Automatic); org.ovirt.engine.core.common.businessentities.VM vm = mapToVM(pool, template); int size = (pool.isSetSize()) ? pool.getSize() : 1; org.ovirt.engine.core.common.action.AddVmPoolWithVmsParameters params = new org.ovirt.engine.core.common.action.AddVmPoolWithVmsParameters(entity, vm, size, (-1)); params.setConsoleEnabled((!(getConsoleDevicesForEntity(template.getId()).isEmpty()))); params.setVirtioScsiEnabled((!(org.ovirt.engine.api.restapi.util.VmHelper.getInstance().getVirtioScsiControllersForEntity(template.getId()).isEmpty()))); params.setSoundDeviceEnabled((pool.isSetSoundcardEnabled() ? pool.isSoundcardEnabled() : !(org.ovirt.engine.api.restapi.util.VmHelper.getInstance().getSoundDevicesForEntity(template.getId()).isEmpty()))); return performCreate(VdcActionType.AddVmPoolWithVms, params, new org.ovirt.engine.api.restapi.resource.QueryIdResolver<org.ovirt.engine.core.compat.Guid>(org.ovirt.engine.core.common.queries.VdcQueryType.GetVmPoolById, org.ovirt.engine.core.common.queries.IdQueryParameters.class)); }
@java.lang.Override public void init(final org.ovirt.engine.ui.uicommonweb.models.gluster.VolumeGeoRepSessionDetailsModel model) { super.init(model); model.getPropertyChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs e = ((org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs) (args)); if (e.propertyName.equalsIgnoreCase("selectedSessionSummaryRow")) { org.ovirt.engine.core.common.businessentities.gluster.GlusterGeoRepSessionDetails selectedSessionDetail = model.getGeoRepSessionSummary().getSelectedItem().getEntity(); getView().setCheckPointCompletedAtVisibility(selectedSessionDetail.isCheckpointCompleted()); getView().updateSessionDetailProperties(selectedSessionDetail); } } }); }
private void performActionForServicesOfCluster() { java.util.List<java.util.concurrent.Callable<org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.common.businessentities.VDS, org.ovirt.engine.core.common.vdscommands.VDSReturnValue>>> commandList = getCallableVdsCmdList(); if (!(commandList.isEmpty())) { invokeManageGlusterService(commandList); } else { setSucceeded(false); } }
private void UpdateActionAvailability() { getCopyCommand().setIsExecutionAllowed(((((getSelectedItems()) != null) && ((getSelectedItems().size()) > 0)) && (isCopyCommandAvailable()))); org.ovirt.engine.ui.uicommonweb.models.quota.ChangeQuotaModel.updateChangeQuotaActionAvailability(((getItems()) != null ? ((java.util.List<org.ovirt.engine.core.common.businessentities.Disk>) (getItems())) : null), ((getSelectedItems()) != null ? ((java.util.List<org.ovirt.engine.core.common.businessentities.Disk>) (getSelectedItems())) : null), getSystemTreeSelectedItem(), getChangeQuotaCommand()); }
private void unplugFromExternalNetwork() { externalNetworkManagerFactory.create(org.ovirt.engine.core.bll.network.vm.ActivateDeactivateVmNicCommand.getParameters().getNic(), getNetwork()).deallocateIfExternal(); }
@java.lang.Override public final void freeMacs(java.util.List<java.lang.String> macs) { java.util.List<java.lang.String> macsToRelease = filterOutUnusedMacs(macs); if (macsToRelease.isEmpty()) { org.ovirt.engine.core.bll.network.macpool.TransactionalMacPoolDecorator.log.warn("Trying to release MACs using empty collection as parameter."); } else { org.ovirt.engine.core.bll.network.macpool.TransactionalMacPoolDecorator.TransactionalStrategyState strategyForMacRelease = getStrategyForMacRelease(); org.ovirt.engine.core.bll.network.macpool.TransactionalMacPoolDecorator.log.debug("Using {} as release strategy", strategyForMacRelease); strategyForMacRelease.releaseMacsOnCommit(macsToRelease); } }
@java.lang.Override protected void executeVmCommand() { org.ovirt.engine.core.common.vdscommands.VDSReturnValue retVal = runHibernateBrokerVDSCommand(); if (retVal.getSucceeded()) { vmManager.succededToHibernate(); org.ovirt.engine.core.vdsbroker.HibernateVDSCommand.getVDSReturnValue().setSucceeded(true); } else { log.error("Failed to hibernate VM '{}' in VDS = '{}' : error = '{}'", org.ovirt.engine.core.vdsbroker.HibernateVDSCommand.getParameters().getVmId(), org.ovirt.engine.core.vdsbroker.HibernateVDSCommand.getParameters().getVdsId(), retVal.getExceptionString()); org.ovirt.engine.core.vdsbroker.HibernateVDSCommand.getVDSReturnValue().setSucceeded(false); org.ovirt.engine.core.vdsbroker.HibernateVDSCommand.getVDSReturnValue().setExceptionString(retVal.getExceptionString()); org.ovirt.engine.core.vdsbroker.HibernateVDSCommand.getVDSReturnValue().setExceptionObject(retVal.getExceptionObject()); org.ovirt.engine.core.vdsbroker.HibernateVDSCommand.getVDSReturnValue().setVdsError(retVal.getVdsError()); } }
protected void syncSearch(org.ovirt.engine.core.common.queries.QueryType queryType, org.ovirt.engine.core.common.queries.QueryParametersBase queryParametersBase, org.ovirt.engine.ui.uicommonweb.models.AsyncQuery<org.ovirt.engine.core.common.queries.VdcQueryReturnValue> asyncCallback) { queryParametersBase.setRefresh(getIsQueryFirstTime()); org.ovirt.engine.ui.frontend.Frontend.getInstance().runQuery(queryType, queryParametersBase, asyncCallback); setIsQueryFirstTime(false); }
@java.lang.Override public java.lang.String toString() { java.lang.StringBuilder builder = new java.lang.StringBuilder(); builder.append(getName()).append(" {id=").append(getId()).append(", description=").append(getDescription()).append(", comment=").append(getComment()).append(", subnet=").append(getSubnet()).append(", gateway=").append(getGateway()).append(", type=").append(getType()).append(", vlanId=").append(getVlanId()).append(", stp=").append(getStp()).append(", dataCenterId=").append(getDataCenterId()).append(", mtu=").append(getMtu()).append(", vmNetwork=").append(isVmNetwork()).append(", cluster=").append(getCluster()).append(", providedBy=").append(getProvidedBy()).append(", label=").append(getLabel()).append(", qosId=").append(getQosId()).append("}"); return builder.toString(); }
@org.junit.Test public void testWithNullChildObjects() { org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeAdvancedDetails volDetailsEntity = new org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeAdvancedDetails(); volDetailsEntity.setBrickDetails(getBrickDetails(1, 0, 0)); volDetailsEntity.getBrickDetails().get(0).setClients(null); volDetailsEntity.getBrickDetails().get(0).setMemoryStatus(null); org.ovirt.engine.api.model.GlusterBrickAdvancedDetails model = org.ovirt.engine.api.restapi.types.GlusterBrickDetailMapper.map(volDetailsEntity, null); assertNotNull(model); assertNull(model.getGlusterClients()); assertEquals(model.getMntOptions(), volDetailsEntity.getBrickDetails().get(0).getBrickProperties().getMntOptions()); assertNull(model.getMemoryPools()); }
@org.junit.Test public void testAdd() { try { javax.ws.rs.core.UriInfo uriInfo = mockUri("hosts", "00000001-0001-0001-0001-000000000011", "nics"); javax.ws.rs.core.Request request = mockRequest("POST"); control.replay(); org.ovirt.engine.api.model.Fault fault = usageFinder.getUsageMessage(uriInfo, request); assertEquals("For correct usage, see: http://localhost:8080/ovirt-engine/api/model#services/host-nics/methods/add", fault.getDetail()); } catch (java.lang.ClassNotFoundException | java.io.IOException | java.net.URISyntaxException e) { fail(); } }
@java.lang.Override protected boolean canDoAction() { boolean returnValue = true; org.ovirt.engine.core.common.businessentities.Role oldRole = org.ovirt.engine.core.bll.UpdateRoleCommand.getRoleDao().get(org.ovirt.engine.core.bll.UpdateRoleCommand.getRole().getId()); if (oldRole == null) { addCanDoActionMessage(EngineMessage.ERROR_CANNOT_UPDATE_ROLE_ID); returnValue = false; } else { if (checkIfRoleIsReadOnly(org.ovirt.engine.core.bll.UpdateRoleCommand.getReturnValue().getCanDoActionMessages())) { returnValue = false; addCanDoActionMessage(EngineMessage.VAR__ACTION__UPDATE); } else if ((!(org.apache.commons.lang.StringUtils.equals(org.ovirt.engine.core.bll.UpdateRoleCommand.getRole().getName(), oldRole.getName()))) && ((org.ovirt.engine.core.bll.UpdateRoleCommand.getRoleDao().getByName(org.ovirt.engine.core.bll.UpdateRoleCommand.getRole().getName())) != null)) { addCanDoActionMessage(EngineMessage.ACTION_TYPE_FAILED_NAME_ALREADY_USED); returnValue = false; } else if ((org.ovirt.engine.core.bll.UpdateRoleCommand.getRole().getType()) != (oldRole.getType())) { addCanDoActionMessage(EngineMessage.ERROR_CANNOT_UPDATE_ROLE_TYPE); returnValue = false; } } if (!returnValue) { addCanDoActionMessage(EngineMessage.VAR__TYPE__ROLE); addCanDoActionMessage(EngineMessage.VAR__ACTION__UPDATE); } return returnValue; }
@org.ovirt.engine.ui.common.DefaultStringValue("The selected snapshot's memory can't be properly restored since it was created in different " + "cluster version. Please confirm the memory shall be restored anyway.") java.lang.String snapshotContainsMemoryIncompatibleCluster();
@org.junit.Test public void testStoragePoolDoesntExist() { final int domainSizeGB = 20; final int sizeRequired = 5; org.ovirt.engine.core.bll.AddVmCommand<org.ovirt.engine.core.common.action.VmManagementParametersBase> cmd = setupCanAddVmTests(domainSizeGB, sizeRequired); doReturn(null).when(cmd).getStoragePool(); assertFalse(cmd.canDoAction()); assertTrue(cmd.getReturnValue().getCanDoActionMessages().contains(VdcBllMessages.ACTION_TYPE_FAILED_STORAGE_POOL_NOT_EXIST.toString())); }
@java.lang.Override public boolean isFloppySupported(int osId, org.ovirt.engine.core.compat.Version version) { return getBoolean(getValueByVersion(idToUnameLookup.get(osId), "devices.floppy.support", version), false); }
@java.lang.Override protected void executeCommand() { org.ovirt.engine.core.common.vdscommands.VDSReturnValue returnValue = runVdsCommand(VDSCommandType.DeleteGlusterVolumeGeoRepSession, new org.ovirt.engine.core.common.vdscommands.gluster.GlusterVolumeGeoRepSessionVDSParameters(upServer.getId(), getGeoRepSession().getMasterVolumeName(), getGeoRepSession().getSlaveHostName(), getGeoRepSession().getSlaveVolumeName())); setSucceeded(returnValue.getSucceeded()); if (getSucceeded()) { getGlusterGeoRepDao().remove(getGeoRepSession().getId()); } else { handleVdsError(AuditLogType.GEOREP_SESSION_DELETE_FAILED, returnValue.getVdsError().getMessage()); } }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Hook Content") java.lang.String viewContentGlusterHookTitle();
@org.ovirt.engine.api.restapi.types.Mapping(from = org.ovirt.engine.api.model.SchedulingPolicyUnit.class, to = org.ovirt.engine.core.common.scheduling.PolicyUnit.class) public static org.ovirt.engine.core.common.scheduling.PolicyUnit map(org.ovirt.engine.api.model.SchedulingPolicyUnit model, org.ovirt.engine.core.common.scheduling.PolicyUnit template) { org.ovirt.engine.core.common.scheduling.PolicyUnit entity = (template != null) ? template : new org.ovirt.engine.core.common.scheduling.PolicyUnit(); if (model.isSetId()) { entity.setId(org.ovirt.engine.api.restapi.utils.GuidUtils.asGuid(model.getId())); } if (model.isSetName()) { entity.setName(model.getName()); } if (model.isSetDescription()) { entity.setDescription(model.getDescription()); } if (model.isSetType()) { entity.setPolicyUnitType(org.ovirt.engine.api.restapi.types.PolicyUnitMapper.map(org.ovirt.engine.core.common.scheduling.org.ovirt.engine.api.model.PolicyUnitType.valueOf(model.getType().toUpperCase()), null)); } if (model.isSetEnabled()) { entity.setEnabled(model.isEnabled()); } if (model.isSetInternal()) { entity.setInternal(model.isInternal()); } if (model.isSetPropertiesMetaData()) { entity.setParameterRegExMap(org.ovirt.engine.api.restapi.utils.CustomPropertiesParser.toMap(model.getPropertiesMetaData())); } return entity; }
private org.ovirt.engine.core.vdsbroker.vdsbroker.VmInfoBuilderBase createBuilder() { if (org.ovirt.engine.core.common.utils.VmDeviceCommonUtils.isOldClusterVersion(vm.getCompatibilityVersion())) { return new org.ovirt.engine.core.vdsbroker.vdsbroker.VmOldInfoBuilder(vm, createInfo); } else { return new org.ovirt.engine.core.vdsbroker.vdsbroker.VmInfoBuilder(vm, org.ovirt.engine.core.vdsbroker.vdsbroker.CreateVDSCommand.getParameters().getVdsId(), createInfo); } }
private static org.ovirt.engine.core.common.action.VdcActionType getEndActionType(org.ovirt.engine.core.common.businessentities.AsyncTasks dbAsyncTask) { org.ovirt.engine.core.common.action.VdcActionType commandType = dbAsyncTask.getActionParameters().getCommandType(); if (!(VdcActionType.Unknown.equals(commandType))) { return commandType; } return dbAsyncTask.getaction_type(); }
@java.lang.Override public java.lang.String getValue(org.ovirt.engine.core.common.businessentities.VDSGroup object) { return object.getName(); }
private void addReportedIpConfiguration(org.ovirt.engine.core.common.businessentities.network.ReportedConfigurations result) { if (!(isPrimaryAddressExist())) { return; } org.ovirt.engine.core.common.businessentities.network.NetworkBootProtocol definedBootProtocol = getPrimaryAddress().getBootProtocol(); result.add(ReportedConfigurationType.BOOT_PROTOCOL, iface.getIpv4BootProtocol(), definedBootProtocol); if ((definedBootProtocol == (org.ovirt.engine.core.common.businessentities.network.NetworkBootProtocol.STATIC_IP)) && ((iface.getIpv4BootProtocol()) == definedBootProtocol)) { result.add(ReportedConfigurationType.NETMASK, iface.getIpv4Subnet(), getPrimaryAddress().getNetmask(), isNetworkSubnetInSync()); result.add(ReportedConfigurationType.IP_ADDRESS, iface.getIpv4Address(), getPrimaryAddress().getAddress()); result.add(ReportedConfigurationType.GATEWAY, iface.getIpv4Gateway(), getPrimaryAddress().getGateway(), isGatewayInSync()); } }
private void logStorageDeviceMessage(org.ovirt.engine.core.common.AuditLogType logType, org.ovirt.engine.core.common.businessentities.VDS vds, final org.ovirt.engine.core.common.businessentities.gluster.StorageDevice device) { logUtil.logAuditMessage(vds.getVdsGroupId(), null, vds, logType, java.util.Collections.singletonMap("storageDevice", device.getName())); }
public static java.util.List<java.lang.String> runAndAssertCanDoActionFailure(org.ovirt.engine.core.bll.CommandBase<?> command, org.ovirt.engine.core.common.errors.VdcBllMessages message) { return org.ovirt.engine.core.bll.CanDoActionTestUtils.runAndAssertCanDoActionFailure("", command, message); }
@java.lang.Override protected void performBootstrap() { super.performBootstrap(); com.google.gwt.user.client.Window.setTitle(dynamicMessages.applicationTitle()); org.ovirt.engine.ui.webadmin.uimode.UiModeData uiModeData = org.ovirt.engine.ui.webadmin.uimode.UiModeData.instance(); if (uiModeData != null) { handleUiMode(uiModeData); } placeManager.revealCurrentPlace(); }
@java.lang.Override protected void perform() { java.lang.String iface = null; int index = 0; if (org.ovirt.engine.core.bll.storage.disk.ChangeDiskCommand.getVm().getCompatibilityVersion().greaterOrEquals(Version.v4_0)) { iface = org.ovirt.engine.core.bll.storage.disk.ChangeDiskCommand.getVmDeviceUtils().getCdInterface(org.ovirt.engine.core.bll.storage.disk.ChangeDiskCommand.getVm()); index = org.ovirt.engine.core.common.utils.VmDeviceCommonUtils.getCdDeviceIndex(iface); } cdImagePath = org.ovirt.engine.core.bll.storage.disk.image.ImagesHandler.cdPathWindowsToLinux(org.ovirt.engine.core.bll.storage.disk.ChangeDiskCommand.getParameters().getCdImagePath(), org.ovirt.engine.core.bll.storage.disk.ChangeDiskCommand.getVm().getStoragePoolId(), org.ovirt.engine.core.bll.storage.disk.ChangeDiskCommand.getVm().getRunOnVds()); setActionReturnValue(runVdsCommand(VDSCommandType.ChangeDisk, new org.ovirt.engine.core.common.vdscommands.ChangeDiskVDSCommandParameters(org.ovirt.engine.core.bll.storage.disk.ChangeDiskCommand.getVdsId(), org.ovirt.engine.core.bll.storage.disk.ChangeDiskCommand.getVm().getId(), iface, index, cdImagePath)).getReturnValue()); org.ovirt.engine.core.bll.VmHandler.updateCurrentCd(org.ovirt.engine.core.bll.storage.disk.ChangeDiskCommand.getVdsId(), org.ovirt.engine.core.bll.storage.disk.ChangeDiskCommand.getVm(), org.ovirt.engine.core.bll.storage.disk.ChangeDiskCommand.getParameters().getCdImagePath()); org.ovirt.engine.core.bll.storage.disk.ChangeDiskCommand.setSucceeded(true); }
private boolean isMatchPath(java.lang.String[] linkPathSegments, java.util.List<javax.ws.rs.core.PathSegment> uriPathSegments) { for (int i = 0; i < (linkPathSegments.length); i++) { java.lang.String uriPathSegment = uriPathSegments.get(i).getPath(); if ((!(isUUID(uriPathSegment))) && (!(uriPathSegment.equals(linkPathSegments[i])))) { return false; } } return true; }
@java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { super.eventRaised(ev, sender, args); if (ev.matchesDefinition(EntityModel.entityChangedEventDefinition)) { if (sender == (getIsWipeAfterDelete())) { wipeAfterDelete_EntityChanged(args); } else if (sender == (getIsAttachDisk())) { attachDisk_EntityChanged(args); } else if (sender == (getIsReadOnly())) { updateScsiPassthroguhChangeability(); } else if (sender == (getIsScsiPassthrough())) { updateSgIoUnfilteredChangeability(); updateReadOnlyChangeability(); } else if (sender == (getIsInternal())) { isInternal_EntityChanged(); } } else if ((ev.matchesDefinition(ListModel.selectedItemChangedEventDefinition)) && (sender == (getVolumeType()))) { volumeType_SelectedItemChanged(); } else if ((ev.matchesDefinition(ListModel.selectedItemChangedEventDefinition)) && (sender == (getDiskInterface()))) { DiskInterface_SelectedItemChanged(); } else if ((ev.matchesDefinition(ListModel.selectedItemChangedEventDefinition)) && (sender == (getDataCenter()))) { datacenter_SelectedItemChanged(); } else if ((ev.matchesDefinition(ListModel.selectedItemChangedEventDefinition)) && (sender == (getStorageDomain()))) { storageDomain_SelectedItemChanged(); } else if ((ev.matchesDefinition(org.ovirt.engine.ui.frontend.Frontend.getInstance().getQueryStartedEventDefinition())) && (org.ovirt.engine.core.common.utils.ObjectUtils.objectsEqual(org.ovirt.engine.ui.frontend.Frontend.getInstance().getCurrentContext(), getHash()))) { frontend_QueryStarted(); } else if ((ev.matchesDefinition(org.ovirt.engine.ui.frontend.Frontend.getInstance().getQueryCompleteEventDefinition())) && (org.ovirt.engine.core.common.utils.ObjectUtils.objectsEqual(org.ovirt.engine.ui.frontend.Frontend.getInstance().getCurrentContext(), getHash()))) { frontend_QueryComplete(); } }
private void nameNotChangedOrNotTakenTest(org.hamcrest.Matcher<org.ovirt.engine.core.bll.ValidationResult> matcher) { org.ovirt.engine.core.common.businessentities.network.NetworkQoS otherQos = new org.ovirt.engine.core.common.businessentities.network.NetworkQoS(); allQos.add(otherQos); allQos.add(oldQos); otherQos.setName("foo"); oldQos.setName("bar"); assertThat(validator.nameNotChangedOrNotTaken(), matcher); }
@java.lang.Override public void setUp() throws java.lang.Exception { super.setUp(); dao = dbFacade.getVmPoolDao(); vmDao = dbFacade.getVmDao(); existingVmPool = dao.get(org.ovirt.engine.core.dao.VmPoolDAOTest.EXISTING_VM_POOL_ID); deletableVmPool = dao.get(org.ovirt.engine.core.dao.VmPoolDAOTest.DELETABLE_VM_POOL_ID); newVmPool = new org.ovirt.engine.core.common.businessentities.VmPool(); newVmPool.setName("New VM Pool"); newVmPool.setVmPoolDescription("This is a new VM pool."); newVmPool.setVdsGroupId(org.ovirt.engine.core.dao.VmPoolDAOTest.VDS_GROUP_ID); newVmPoolMap = new org.ovirt.engine.core.common.businessentities.VmPoolMap(org.ovirt.engine.core.dao.VmPoolDAOTest.FREE_VM_ID, org.ovirt.engine.core.dao.VmPoolDAOTest.EXISTING_VM_POOL_ID); }
@org.junit.Test public void portIsInvalid() { assertThat(validator.portIsValid(), org.ovirt.engine.core.bll.validator.ValidationResultMatchers.failsWith(EngineMessage.ACTION_TYPE_FAILED_VDS_WITH_INVALID_SSH_PORT)); }
public void install() { final org.ovirt.engine.core.common.businessentities.VDS host = ((org.ovirt.engine.core.common.businessentities.VDS) (getSelectedItem())); if ((host.getVdsType()) == (org.ovirt.engine.core.common.businessentities.VDSType.oVirtNode)) { host.setSshUsername(HostModel.AdminUserName); } org.ovirt.engine.ui.uicommonweb.models.hosts.InstallModel model = new org.ovirt.engine.ui.uicommonweb.models.hosts.InstallModel(); model.setVds(host); setWindow(model); model.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().installHostTitle()); model.setHelpTag(HelpTag.install_host); model.setHashName("install_host"); model.getOVirtISO().setIsAvailable(false); model.getOverrideIpTables().setIsAvailable(false); model.getHostVersion().setEntity(host.getHostOs()); model.getHostVersion().setIsAvailable(false); getWindow().startProgress(null); model.getUserPassword().setIsAvailable(true); model.getUserPassword().setIsChangable(true); org.ovirt.engine.core.compat.Version v3 = new org.ovirt.engine.core.compat.Version(3, 0); boolean isLessThan3 = (host.getVdsGroupCompatibilityVersion().compareTo(v3)) < 0; if (!isLessThan3) { model.getOverrideIpTables().setIsAvailable(true); model.getOverrideIpTables().setEntity(true); } addInstallCommands(model, host, false); getWindow().stopProgress(); }
public org.ovirt.engine.core.common.businessentities.VmInit buildCloudInitParameters() { org.ovirt.engine.core.common.businessentities.VmInit vmInit = new org.ovirt.engine.core.common.businessentities.VmInit(); if (getHostnameEnabled()) { vmInit.setHostname(((java.lang.String) (getHostname().getEntity()))); } if (getRootPasswordEnabled()) { vmInit.setRootPassword(((java.lang.String) (getRootPassword().getEntity()))); } vmInit.setAuthorizedKeys(((java.lang.String) (getAuthorizedKeys().getEntity()))); if (((java.lang.Boolean) (getRegenerateKeysEnabled().getEntity()))) { vmInit.setRegenerateKeys(java.lang.Boolean.TRUE); } if (((java.lang.Boolean) (getNetworkEnabled().getEntity()))) { saveNetworkFields(); if (!(networkMap.isEmpty())) { for (java.util.Map.Entry<java.lang.String, org.ovirt.engine.core.common.businessentities.VmInitNetwork> entry : networkMap.entrySet()) { org.ovirt.engine.core.common.businessentities.VmInitNetwork params = entry.getValue(); if ((params.getBootProtocol()) == (org.ovirt.engine.core.common.businessentities.network.NetworkBootProtocol.DHCP)) { params.setIp(null); params.setNetmask(null); params.setGateway(null); } params.setStartOnBoot(networkStartOnBoot.contains(entry.getKey())); params.setName(entry.getKey()); } vmInit.setNetworks(new java.util.ArrayList(networkMap.values())); } } vmInit.setDnsServers(((java.lang.String) (getDnsServers().getEntity()))); vmInit.setDnsSearch(((java.lang.String) (getDnsSearchDomains().getEntity()))); vmInit.setCustomScript(((java.lang.String) (getCustomScript().getEntity()))); vmInit.setPasswordAlreadyStored(((java.lang.Boolean) (getPasswordSet().getEntity()))); return vmInit; }
private <T> T execute(java.util.concurrent.Callable<T> callable) { try { return callable.call(); } catch (com.woorea.openstack.base.client.OpenStackResponseException e) { executeFailedMessages.add(EngineError.CINDER_ERROR.name()); executeFailedMessages.add(java.lang.String.format("$cinderException %1$s", e.getMessage())); throw e; } catch (java.lang.Exception e) { throw new java.lang.RuntimeException(e); } }
private void addQosData(java.lang.String qosEntryName, java.lang.Integer average, java.lang.Integer peak, java.lang.Integer burst) { if ((average != null) && (average > 0)) { java.util.Map<java.lang.String, java.lang.Integer> qosData = new java.util.HashMap<>(); qosData.put(VdsProperties.QOS_AVERAGE, (average * (org.ovirt.engine.core.vdsbroker.vdsbroker.NetworkQosMapper.MEGABITS_TO_KILOBYTES))); qosData.put(VdsProperties.QOS_PEAK, (peak * (org.ovirt.engine.core.vdsbroker.vdsbroker.NetworkQosMapper.MEGABITS_TO_KILOBYTES))); qosData.put(VdsProperties.QOS_BURST, (burst * (org.ovirt.engine.core.vdsbroker.vdsbroker.NetworkQosMapper.MEGABYTES_TO_KILOBYTES))); map.put(qosEntryName, qosData); } }
private boolean isStoragePoolMemoryBackend() { return org.ovirt.engine.core.common.FeatureSupported.storagePoolMemoryBackend(org.ovirt.engine.core.vdsbroker.vdsbroker.ConnectStoragePoolVDSCommand.getParameters().getStoragePool().getcompatibility_version()); }
private org.ovirt.engine.core.common.businessentities.storage.VolumeType getVolumeTypeForDomain() { if ((volumeTypeForDomain) == null) { org.ovirt.engine.core.common.businessentities.StorageDomainStatic sdStatic = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getStorageDomainStaticDao().get(storageDomainId); volumeTypeForDomain = org.ovirt.engine.core.bll.memory.MemoryUtils.storageTypeToMemoryVolumeType(sdStatic.getStorageType()); } return volumeTypeForDomain; }
public void remove() { if ((getWindow()) != null) { return; } org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel model = new org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel(); setWindow(model); model.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().removeRolesTitle()); model.setHelpTag(HelpTag.remove_role); model.setHashName("remove_role"); java.util.ArrayList<java.lang.String> list = new java.util.ArrayList<java.lang.String>(); for (org.ovirt.engine.core.common.businessentities.Role role : org.ovirt.engine.ui.uicommonweb.Linq.<org.ovirt.engine.core.common.businessentities.Role>cast(getSelectedItems())) { list.add(role.getname()); } model.setItems(list); org.ovirt.engine.ui.uicommonweb.UICommand tempVar = org.ovirt.engine.ui.uicommonweb.UICommand.createDefaultOkUiCommand("OnRemove", this); model.getCommands().add(tempVar); org.ovirt.engine.ui.uicommonweb.UICommand tempVar2 = org.ovirt.engine.ui.uicommonweb.UICommand.createCancelUiCommand("Cancel", this); model.getCommands().add(tempVar2); }
private void connectToConsoles() { java.lang.StringBuilder errorMessages = null; final java.util.List<org.ovirt.engine.core.common.businessentities.VM> list = getSelectedItems(); if ((list == null) || (list.isEmpty())) { return; } for (org.ovirt.engine.core.common.businessentities.VM vm : list) { try { consoleModelsCache.getVmConsolesForEntity(vm).connect(); } catch (org.ovirt.engine.ui.uicommonweb.models.VmConsoles e) { final java.lang.String errorMessage = e.getLocalizedErrorMessage(); if (errorMessage != null) { if (errorMessages == null) { errorMessages = new java.lang.StringBuilder(); } else { errorMessages.append("\r\n"); } errorMessages.append(vm.getName()).append(" - ").append(errorMessage); } } } if (errorMessages != null) { errorPopupManager.show(errorMessages.toString()); } }
@java.lang.Override public void validateEnums(org.ovirt.engine.api.model.VM vm) { if (vm.isSetType()) { validateEnum(org.ovirt.engine.api.model.VmType.class, vm.getType(), true); } if (vm.isSetUsb()) { usbValidator.validateEnums(vm.getUsb()); } if (vm.isSetOs()) { osValidator.validateEnums(vm.getOs()); } if (vm.isSetDisplay()) { displayValidator.validateEnums(vm.getDisplay()); } if (vm.isSetPlacementPolicy()) { placementPolicyValidator.validateEnums(vm.getPlacementPolicy()); } if (vm.isSetCpu()) { cpuValidator.validateEnums(vm.getCpu()); } if (vm.isSetPayloads()) { for (org.ovirt.engine.api.model.Payload payload : vm.getPayloads().getPayload()) { payloadValidator.validateEnums(payload); } } if ((vm.isSetInitialization()) && (vm.getInitialization().isSetConfiguration())) { configurationValidator.validateEnums(vm.getInitialization().getConfiguration()); } if (vm.isSetInitialization()) { if (vm.getInitialization().isSetCloudInit()) { cloudInitValidator.validateEnums(vm.getInitialization().getCloudInit()); } } }
protected void setVirtioScsiController(org.ovirt.engine.api.model.VM model) { if (!(model.isSetVirtioScsi())) { model.setVirtioScsi(new org.ovirt.engine.api.model.VirtIOSCSI()); } model.getVirtioScsi().setEnabled((!(org.ovirt.engine.api.restapi.util.VmHelper.getVirtioScsiControllersForEntity(this, new org.ovirt.engine.core.compat.Guid(model.getId())).isEmpty()))); }
@java.lang.Override protected void performBootstrap() { super.performBootstrap(); com.google.gwt.user.client.Window.setTitle(dynamicMessages.applicationTitle()); org.ovirt.engine.core.common.mode.ApplicationMode uiMode = org.ovirt.engine.ui.webadmin.uimode.UiModeData.getUiMode(); if (uiMode != null) { org.ovirt.engine.ui.uicommonweb.models.ApplicationModeHelper.setUiMode(uiMode); } placeManager.revealCurrentPlace(); }
public boolean initGlusterHost(org.ovirt.engine.core.common.businessentities.VDS vds) { org.ovirt.engine.core.common.vdscommands.VDSReturnValue returnValue = runVdsCommand(VDSCommandType.GetGlusterHostUUID, new org.ovirt.engine.core.common.vdscommands.VdsIdVDSCommandParametersBase(vds.getId())); if ((returnValue.getSucceeded()) && ((returnValue.getReturnValue()) != null)) { org.ovirt.engine.core.compat.Guid addedServerUuid = org.ovirt.engine.core.compat.Guid.createGuidFromString(((java.lang.String) (returnValue.getReturnValue()))); if (hostUuidExists(vds, addedServerUuid)) { setNonOperational(vds, NonOperationalReason.GLUSTER_HOST_UUID_ALREADY_EXISTS, null); return false; } saveGlusterHostUuid(vds, addedServerUuid); } else { setNonOperational(vds, NonOperationalReason.GLUSTER_HOST_UUID_NOT_FOUND, null); return false; } refreshGlusterStorageDevices(vds); boolean ret = initGlusterPeerProcess(vds); glusterServerDao.updatePeerStatus(vds.getId(), (ret ? org.ovirt.engine.core.common.businessentities.gluster.PeerStatus.CONNECTED : org.ovirt.engine.core.common.businessentities.gluster.PeerStatus.DISCONNECTED)); if (ret) { addGlusterWebhook(vds); } return ret; }
@java.lang.Override protected boolean canDoAction() { org.ovirt.engine.core.common.businessentities.StorageDomain storage = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getStorageDomainDao().getForStoragePool(org.ovirt.engine.core.bll.RemoveVmFromImportExportCommand.getParameters().getStorageDomainId(), org.ovirt.engine.core.bll.RemoveVmFromImportExportCommand.getParameters().getStoragePoolId()); if (storage == null) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_STORAGE_DOMAIN_NOT_EXIST); } if (((storage.getStatus()) == null) || ((storage.getStatus()) != (org.ovirt.engine.core.common.businessentities.StorageDomainStatus.Active))) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_STORAGE_DOMAIN_STATUS_ILLEGAL); } if ((storage.getStorageDomainType()) != (org.ovirt.engine.core.common.businessentities.StorageDomainType.ImportExport)) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_STORAGE_DOMAIN_TYPE_ILLEGAL); } if ((getVm()) == null) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_VM_NOT_FOUND_ON_EXPORT_DOMAIN); } org.ovirt.engine.core.common.businessentities.VM vm = org.ovirt.engine.core.bll.RemoveVmFromImportExportCommand.getVmDao().get(org.ovirt.engine.core.bll.RemoveVmFromImportExportCommand.getVmId()); if ((vm != null) && ((vm.getStatus()) == (org.ovirt.engine.core.common.businessentities.VMStatus.ImageLocked))) { if (org.ovirt.engine.core.bll.tasks.CommandCoordinatorUtil.hasTasksForEntityIdAndAction(vm.getId(), VdcActionType.ExportVm)) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_VM_DURING_EXPORT); } } return true; }
public org.ovirt.engine.core.vdsbroker.irsbroker.IIrsServer getIrsProxy() { if ((getmIrsProxy()) == null) { final org.ovirt.engine.core.common.businessentities.StoragePool storagePool = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getStoragePoolDao().get(_storagePoolId); if ((storagePool.getStatus()) != (org.ovirt.engine.core.common.businessentities.StoragePoolStatus.Uninitialized)) { java.lang.String host = org.ovirt.engine.core.utils.transaction.TransactionSupport.executeInScope(TransactionScopeOption.Suppress, new org.ovirt.engine.core.utils.transaction.TransactionMethod<java.lang.String>() { @java.lang.Override public java.lang.String runInTransaction() { return gethostFromVds(); } }); if (host != null) { int clientTimeOut = (org.ovirt.engine.core.common.config.Config.<java.lang.Integer>getValue(ConfigValues.vdsTimeout)) * 1000; int connectionTimeOut = (org.ovirt.engine.core.common.config.Config.<java.lang.Integer>getValue(ConfigValues.vdsConnectionTimeout)) * 1000; int heartbeat = (org.ovirt.engine.core.common.config.Config.<java.lang.Integer>getValue(ConfigValues.vdsHeartbeatInSeconds)) * 1000; int clientRetries = org.ovirt.engine.core.common.config.Config.<java.lang.Integer>getValue(ConfigValues.vdsRetries); irsProxy = org.ovirt.engine.core.vdsbroker.jsonrpc.TransportFactory.createIrsServer(getProtocol(), host, getmIrsPort(), clientTimeOut, connectionTimeOut, clientRetries, heartbeat); runStoragePoolUpEvent(storagePool); } } } return getmIrsProxy(); }
@java.lang.Override protected boolean canDoAction() { if (!(super.canDoAction())) { return false; } oldPool = org.ovirt.engine.core.bll.UpdateVmPoolWithVmsCommand.getVmPoolDAO().get(org.ovirt.engine.core.bll.UpdateVmPoolWithVmsCommand.getVmPool().getVmPoolId()); if ((oldPool) == null) { return failCanDoAction(VdcBllMessages.VM_POOL_CANNOT_UPDATE_POOL_NOT_FOUND); } if ((org.ovirt.engine.core.bll.UpdateVmPoolWithVmsCommand.getParameters().getVmsCount()) < 0) { return failCanDoAction(VdcBllMessages.VM_POOL_CANNOT_DECREASE_VMS_FROM_POOL); } return true; }
@java.lang.Override public org.ovirt.engine.core.common.businessentities.VDS getValue(S object) { if (object instanceof org.ovirt.engine.core.common.businessentities.VDS) { return ((org.ovirt.engine.core.common.businessentities.VDS) (object)); } return null; }
public void setConfigOptions(org.ovirt.engine.ui.uicommonweb.models.ListModel<org.ovirt.engine.ui.uicommonweb.models.EntityModel<org.ovirt.engine.ui.uicommonweb.models.gluster.VolumeSnapshotOptionModel>> configOptions) { this.configOptions = configOptions; }
@java.lang.Override public org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc glusterVolumeBrickAdd(java.lang.String volumeName, java.lang.String[] bricks, int replicaCount, int stripeCount, boolean force) { org.ovirt.vdsm.jsonrpc.client.JsonRpcRequest request = new org.ovirt.vdsm.jsonrpc.client.RequestBuilder("GlusterVolume.addBrick").withParameter("volumeName", volumeName).withParameter("brickList", new java.util.ArrayList<java.lang.String>(java.util.Arrays.asList(bricks))).withParameter("replicaCount", replicaCount).withParameter("stripeCount", stripeCount).withParameter("force", force).build(); java.util.Map<java.lang.String, java.lang.Object> response = new org.ovirt.engine.core.vdsbroker.jsonrpc.FutureMap(this.client, request); return new org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc(response); }
private void initListerners(final org.ovirt.engine.ui.uicommonweb.models.storage.DisksAllocationModel model) { model.getPropertyChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener<org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs>() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs args) { if ("Disks".equals(args.propertyName)) { addDiskList(model); } else if ("QuotaEnforcmentType".equals(args.propertyName)) { updateColumnsAvailability(model); updateListHeader(model); } } }); }
protected org.ovirt.engine.core.common.businessentities.StorageDomain electNewMaster(boolean duringReconstruct, boolean selectInactiveWhenNoActiveUnknownDomains) { org.ovirt.engine.core.common.businessentities.StorageDomain newMaster = null; if ((org.ovirt.engine.core.bll.storage.StorageDomainCommandBase.getStoragePool()) != null) { java.util.List<org.ovirt.engine.core.common.businessentities.StorageDomain> storageDomains = org.ovirt.engine.core.bll.storage.StorageDomainCommandBase.getStorageDomainDAO().getAllForStoragePool(org.ovirt.engine.core.bll.storage.StorageDomainCommandBase.getStoragePool().getId()); java.util.Collections.sort(storageDomains, org.ovirt.engine.core.bll.storage.StorageDomainCommandBase.LastTimeUsedAsMasterComp.instance); if ((storageDomains.size()) > 0) { org.ovirt.engine.core.common.businessentities.StorageDomain storageDomain = org.ovirt.engine.core.bll.storage.StorageDomainCommandBase.getStorageDomain(); for (org.ovirt.engine.core.common.businessentities.StorageDomain dbStorageDomain : storageDomains) { if (((storageDomain == null) || (duringReconstruct || (!(dbStorageDomain.getId().equals(storageDomain.getId()))))) && ((dbStorageDomain.getStorageDomainType()) == (org.ovirt.engine.core.common.businessentities.StorageDomainType.Data))) { if (((dbStorageDomain.getStatus()) == (org.ovirt.engine.core.common.businessentities.StorageDomainStatus.Active)) || ((dbStorageDomain.getStatus()) == (org.ovirt.engine.core.common.businessentities.StorageDomainStatus.Unknown))) { newMaster = dbStorageDomain; break; } else if ((selectInactiveWhenNoActiveUnknownDomains && (newMaster == null)) && ((dbStorageDomain.getStatus()) == (org.ovirt.engine.core.common.businessentities.StorageDomainStatus.InActive))) { newMaster = dbStorageDomain; } } } } } return newMaster; }
private java.util.Date getDateFromDiskDescription(java.util.Map<java.lang.String, java.lang.Object> map) { try { return new java.text.SimpleDateFormat(org.ovirt.engine.core.utils.ovf.OvfParser.formatStrFromDiskDescription).parse(map.get(OvfInfoFileConstants.LastUpdated).toString()); } catch (java.text.ParseException e) { log.errorFormat("LastUpdate Date could not be parsed from disk desscription. Exception: {0}", e); return null; } }
@java.lang.Override public void render(org.ovirt.engine.ui.webadmin.widget.table.column.Context context, P value, com.google.gwt.safehtml.shared.SafeHtmlBuilder sb) { if (value == null) { clearAll(); } int progress = getProgressValue(freeSize, totalSize); java.lang.String sizeString = getProgressText(freeSize, totalSize); java.lang.String color = (progress < 70) ? "#669966" : progress < 95 ? "#FF9900" : "#FF0000"; java.lang.String toolTip = org.ovirt.engine.ui.webadmin.widget.table.column.GlusterCapacityCell.messages.glusterCapacityInfo(getSizeString(freeSize, inUnit), getSizeString(usedSize, inUnit), getSizeString(totalSize, inUnit)); com.google.gwt.safehtml.shared.SafeHtml safeHtml = org.ovirt.engine.ui.webadmin.widget.table.column.GlusterCapacityCell.templates.glusterCapcityProgressBar(progress, sizeString, color, toolTip); sb.append(safeHtml); }
protected static boolean doesStorageDomainHaveSpaceForRequest(org.ovirt.engine.core.common.businessentities.StorageDomain storageDomain, long sizeRequested) { return new org.ovirt.engine.core.bll.validator.StorageDomainValidator(storageDomain).isDomainHasSpaceForRequest(sizeRequested).isValid(); }
@org.ovirt.engine.ui.webadmin.DefaultMessage("All references to objects that reside on Storage Domain {0} in the database will be removed. You may need to manually clean the storage in order to reuse it.") java.lang.String storageDestroyPopupMessageLabel(java.lang.String storageName);
@java.lang.Override public void handleFailure() { org.ovirt.engine.core.bll.snapshots.RemoveSnapshotSingleDiskLiveCommand.log.error("Command id: '{} failed child command status for step '{}'", org.ovirt.engine.core.bll.snapshots.RemoveSnapshotSingleDiskLiveCommand.getCommandId(), org.ovirt.engine.core.bll.snapshots.RemoveSnapshotSingleDiskLiveCommand.getParameters().getCommandStep()); }
private static java.lang.String extractSubnet(java.util.Map<java.lang.String, java.lang.Object> properties) { return ((java.lang.String) (properties.get("netmask"))); }
public static void LogoffAsync(org.ovirt.engine.core.common.businessentities.DbUser dbUser, final org.ovirt.engine.ui.frontend.AsyncQuery callback) { org.ovirt.engine.ui.frontend.gwtservices.GenericApiGWTServiceAsync service = GenericApiGWTServiceAsync.Util.getInstance(); org.ovirt.engine.ui.frontend.Frontend.LogoffAsync(dbUser, callback, service); }
private void queryVfMap() { final org.ovirt.engine.ui.frontend.AsyncQuery asyncQuery = new org.ovirt.engine.ui.frontend.AsyncQuery(); asyncQuery.asyncCallback = new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValueObj) { org.ovirt.engine.core.common.queries.VdcQueryReturnValue returnValue = ((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (returnValueObj)); vfMap = returnValue.getReturnValue(); if ((vfMap) == null) { vfMap = java.util.Collections.emptyMap(); } queryFreeBonds(); } }; org.ovirt.engine.core.common.businessentities.VDS vds = getEntity(); org.ovirt.engine.core.common.queries.IdQueryParameters params = new org.ovirt.engine.core.common.queries.IdQueryParameters(vds.getId()); params.setRefresh(false); org.ovirt.engine.ui.frontend.Frontend.getInstance().runQuery(VdcQueryType.GetVfToPfMapByHostId, params, asyncQuery); }
public org.ovirt.engine.core.bll.CommandMultiAsyncTasks getCommandMultiAsyncTasks() { org.ovirt.engine.core.bll.CommandMultiAsyncTasks entityInfo = null; synchronized(org.ovirt.engine.core.bll.tasks.CommandAsyncTask._lockObject) { entityInfo = org.ovirt.engine.core.bll.tasks.CommandAsyncTask._multiTasksByCommandIds.get(getCommandId()); } return entityInfo; }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Allow changing VM administrative properties") java.lang.String allowChangingVmAdminPropertiesRoleTreeTooltip();
@java.lang.Override public org.ovirt.engine.core.compat.Guid getStorageDomainId() { if ((cachedStorageDomainId) == null) { java.util.List<org.ovirt.engine.core.common.businessentities.storage.DiskImage> diskDummiesForMemSize = org.ovirt.engine.core.bll.memory.MemoryUtils.createDiskDummies(org.ovirt.engine.core.bll.utils.VmUtils.getSnapshotMemorySizeInBytes(org.ovirt.engine.core.bll.HibernateVmCommand.getVm()), MemoryUtils.METADATA_SIZE_IN_BYTES); org.ovirt.engine.core.common.businessentities.StorageDomain storageDomain = org.ovirt.engine.core.bll.memory.MemoryStorageHandler.getInstance().findStorageDomainForMemory(org.ovirt.engine.core.bll.HibernateVmCommand.getStoragePoolId(), diskDummiesForMemSize, org.ovirt.engine.core.bll.storage.disk.image.ImagesHandler.filterImageDisks(org.ovirt.engine.core.bll.HibernateVmCommand.getDiskDao().getAllForVm(org.ovirt.engine.core.bll.HibernateVmCommand.getVmId()), false, false, false), org.ovirt.engine.core.bll.HibernateVmCommand.getVm()); if (storageDomain != null) { cachedStorageDomainId = storageDomain.getId(); } } return cachedStorageDomainId; }
@java.lang.Override protected boolean canDoAction() { org.ovirt.engine.core.bll.network.cluster.NetworkClusterValidator validator = new org.ovirt.engine.core.bll.network.cluster.NetworkClusterValidator(getNetworkCluster()); return (validate(networkClusterAttachmentExists())) && ((!(org.ovirt.engine.core.utils.NetworkUtils.isManagementNetwork(getNetwork()))) || (validate(validator.managementNetworkAttachment(getNetworkName())))); }
@java.lang.Override public void markAsInvalid(java.util.List<java.lang.String> validationHints) { super.markAsInvalid(validationHints); java.lang.String tooltipText = org.ovirt.engine.ui.common.widget.AbstractValidatedWidgetWithLabel.getValidationTooltipText(validationHints); labelTooltip.setText(tooltipText); labelTooltip.reconfigure(); contentWidgetContainerTooltip.setText(tooltipText); contentWidgetContainerTooltip.reconfigure(); }
@java.lang.Override public org.ovirt.engine.core.common.action.VdcActionParametersBase getParameters(org.ovirt.engine.api.model.StorageConnectionExtension model, org.ovirt.engine.core.common.businessentities.storage.StorageServerConnectionExtension entity) { org.ovirt.engine.core.common.businessentities.storage.StorageServerConnectionExtension connExt = org.ovirt.engine.api.restapi.types.StorageServerConnectionExtensionMapper.map(model, entity); return new org.ovirt.engine.core.common.action.StorageServerConnectionExtensionParameters(connExt); }
private void validateUpdateWipeAfterDelete(org.ovirt.engine.core.common.businessentities.VMStatus status) { org.ovirt.engine.core.common.businessentities.storage.DiskImage disk = createDiskImage(); when(diskDao.get(diskImageGuid)).thenReturn(disk); command.getParameters().getDiskInfo().setWipeAfterDelete(true); initializeCommand(createVm(status)); org.ovirt.engine.core.bll.ValidateTestUtils.runAndAssertValidateSuccess(command); }
public static void getDomainListViaPublic(org.ovirt.engine.ui.frontend.AsyncQuery aQuery, boolean filterInternalDomain) { aQuery.converterCallback = new org.ovirt.engine.ui.frontend.IAsyncConverter() { @java.lang.Override public java.lang.Object Convert(java.lang.Object source, org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery) { return source != null ? new java.util.ArrayList<java.lang.String>(((java.util.ArrayList<java.lang.String>) (source))) : new java.util.ArrayList<java.lang.String>(); } }; org.ovirt.engine.core.common.queries.GetDomainListParameters tempVar = new org.ovirt.engine.core.common.queries.GetDomainListParameters(); tempVar.setFilterInternalDomain(filterInternalDomain); org.ovirt.engine.ui.frontend.Frontend.RunPublicQuery(VdcQueryType.GetDomainList, tempVar, aQuery); }
@org.ovirt.engine.ui.common.DefaultStringValue("Enables/disables Random Number Generator device. If 'period' and 'bytes' are empty, libvirt default is used. If you specify 'period' you need to specify 'bytes' as well.") java.lang.String rngDevExplanation();
private java.lang.String getVmIsBeingImportedMessage() { java.lang.StringBuilder builder = new java.lang.StringBuilder(VdcBllMessages.ACTION_TYPE_FAILED_VM_IS_BEING_IMPORTED.name()); if ((getVmName()) != null) { builder.append(java.lang.String.format("$VmName %1$s", getVmName())); } return builder.toString(); }
private java.util.List<org.ovirt.engine.core.common.businessentities.network.Network> getSingletonVlanNetworkList(int vlanId, org.ovirt.engine.core.compat.Guid networkId) { org.ovirt.engine.core.common.businessentities.network.Network network = new org.ovirt.engine.core.common.businessentities.network.Network(); network.setVlanId(vlanId); network.setId(networkId); return java.util.Collections.singletonList(network); }
private void onRemove() { final org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel model = ((org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel) (getWindow())); if ((model.getProgress()) != null) { return; } final java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase> list = new java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase>(); for (java.util.Map.Entry<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.ui.uicommonweb.models.EntityModel> entry : vmsRemoveMap.entrySet()) { list.add(new org.ovirt.engine.core.common.action.RemoveVmParameters(entry.getKey(), false, ((java.lang.Boolean) (entry.getValue().getEntity())))); } model.startProgress(null); org.ovirt.engine.ui.frontend.Frontend.getInstance().runMultipleAction(VdcActionType.RemoveVm, list, new org.ovirt.engine.ui.uicompat.IFrontendMultipleActionAsyncCallback() { @java.lang.Override public void executed(org.ovirt.engine.ui.uicompat.FrontendMultipleActionAsyncResult result) { org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel localModel = ((org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel) (result.getState())); localModel.stopProgress(); cancel(); } }, model); }
public void stopRefresh() { getTimer().stop(); }
@java.lang.Override public int hashCode() { final int prime = 31; int result = 1; result = (prime * result) + ((id) == null ? 0 : id.hashCode()); result = (prime * result) + ((defaultEndTime) == null ? 0 : defaultEndTime.hashCode()); result = (prime * result) + ((defaultStartTime) == null ? 0 : defaultStartTime.hashCode()); result = (prime * result) + (defaultTimeInDays); result = (prime * result) + ((parameters) == null ? 0 : parameters.hashCode()); result = (prime * result) + ((vdsGroupId) == null ? 0 : vdsGroupId.hashCode()); result = (prime * result) + ((vdsGroupName) == null ? 0 : vdsGroupName.hashCode()); result = (prime * result) + (vmPoolAssignedCount); result = (prime * result) + ((description) == null ? 0 : description.hashCode()); result = (prime * result) + ((name) == null ? 0 : name.hashCode()); result = (prime * result) + (vmPoolRunningCount); result = (prime * result) + ((type) == null ? 0 : type.hashCode()); result = (prime * result) + (maxAssignedVmsPerUser); return result; }
@java.lang.Override public org.ovirt.engine.api.model.NIC update(org.ovirt.engine.api.model.NIC resource) { validateParameters(resource, requiredUpdateFields); org.ovirt.engine.core.common.businessentities.Network network = findNetwork(resource); if (network != null) { resource.getNetwork().setName(network.getname()); resource.getNetwork().setId(null); } return performUpdate(resource, entityResolver, updateType, updateParametersProvider); }
protected static org.ovirt.engine.core.common.businessentities.VmDevice getVmDeviceByDiskId(org.ovirt.engine.core.compat.Guid diskId, org.ovirt.engine.core.compat.Guid vmId) { return org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVmDeviceDao().get(new org.ovirt.engine.core.common.businessentities.VmDeviceId(diskId, vmId)); }
@org.junit.Test public void testOtherFieldsNotValidatedInImport() { org.ovirt.engine.core.common.action.ImportVmParameters parameters = createParameters(); java.lang.String tooLongString = org.ovirt.engine.core.utils.RandomUtils.instance().nextPropertyString(((org.ovirt.engine.core.common.businessentities.BusinessEntitiesDefinitions.GENERAL_MAX_SIZE) + 1)); parameters.getVm().setUserDefinedProperties(tooLongString); parameters.setImportAsNewEntity(true); org.ovirt.engine.core.bll.ImportVmCommand<org.ovirt.engine.core.common.action.ImportVmParameters> command = new org.ovirt.engine.core.bll.ImportVmCommandTest.ImportVmCommandStub(parameters); command.poolPerDc = macPoolPerDc; command.postConstruct(); java.util.Set<javax.validation.ConstraintViolation<org.ovirt.engine.core.common.action.ImportVmParameters>> validate = org.ovirt.engine.core.common.utils.ValidationUtils.getValidator().validate(parameters, command.getValidationGroups().toArray(new java.lang.Class<?>[0])); assertTrue(validate.isEmpty()); parameters.getVm().setUserDefinedProperties(tooLongString); parameters.setImportAsNewEntity(false); command = new org.ovirt.engine.core.bll.ImportVmCommandTest.ImportVmCommandStub(parameters); command.poolPerDc = macPoolPerDc; command.postConstruct(); validate = org.ovirt.engine.core.common.utils.ValidationUtils.getValidator().validate(parameters, command.getValidationGroups().toArray(new java.lang.Class<?>[0])); assertTrue(validate.isEmpty()); }
@com.gwtplatform.mvp.client.annotations.TabInfo(container = org.ovirt.engine.ui.webadmin.section.main.presenter.tab.network.NetworkSubTabPanelPresenter.class) static com.gwtplatform.mvp.client.TabData getTabData(org.ovirt.engine.ui.webadmin.ApplicationConstants applicationConstants, org.ovirt.engine.ui.common.uicommon.model.SearchableDetailModelProvider<org.ovirt.engine.core.common.businessentities.network.VnicProfile, org.ovirt.engine.ui.uicommonweb.models.networks.NetworkListModel, org.ovirt.engine.ui.uicommonweb.models.networks.NetworkProfileListModel> modelProvider) { return new org.ovirt.engine.ui.common.widget.tab.ModelBoundTabData(applicationConstants.networkProfileSubTabLabel(), 1, modelProvider); }
@java.lang.Override protected void changeDefualtHost() { super.changeDefualtHost(); doChangeDefautlHost(vm.fetchDedicatedVmForSingleHost()); }
protected Q setUpSpyQuery(P parameters) throws java.lang.Exception { org.ovirt.engine.core.dal.dbbroker.DbFacade dbFacadeMock = org.ovirt.engine.core.bll.AbstractQueryTest.mock(org.ovirt.engine.core.dal.dbbroker.DbFacade.class); org.ovirt.engine.core.common.businessentities.aaa.DbUser dbUserMock = org.ovirt.engine.core.bll.AbstractQueryTest.mock(org.ovirt.engine.core.common.businessentities.aaa.DbUser.class); when(engineSessionDao.save(org.ovirt.engine.core.bll.AbstractQueryTest.any(org.ovirt.engine.core.common.businessentities.EngineSession.class))).thenReturn(org.ovirt.engine.core.utils.RandomUtils.instance().nextLong()); when(engineSessionDao.remove(org.ovirt.engine.core.bll.AbstractQueryTest.any(java.lang.Long.class))).thenReturn(1); sessionDataContainer.setUser(parameters.getSessionId(), dbUserMock); java.lang.reflect.Constructor<? extends Q> con = getQueryType().getConstructor(getParameterType()); query = org.ovirt.engine.core.bll.AbstractQueryTest.spy(con.newInstance(parameters)); doReturn(sessionDataContainer).when(query).getSessionDataContainer(); doReturn(dbFacadeMock).when(query).getDbFacade(); doReturn(dbUserMock).when(query).initUser(); initQuery(query); query.postConstruct(); return query; }
public static org.ovirt.engine.core.common.businessentities.LdapGroup getGroupByGroupGuid(org.ovirt.engine.core.compat.Guid groupGuid) { return null; }
@org.junit.Test public void canDoActionFailedShareableDiskOnGlusterDomain() throws java.lang.Exception { org.ovirt.engine.core.common.action.UpdateVmDiskParameters parameters = createParameters(); org.ovirt.engine.core.common.businessentities.DiskImage disk = createShareableDisk(VolumeFormat.RAW); org.ovirt.engine.core.common.businessentities.StorageDomain storage = addNewStorageDomainToDisk(disk, StorageType.GLUSTERFS); parameters.setDiskInfo(disk); when(diskDao.get(diskImageGuid)).thenReturn(createDiskImage()); when(storageDomainStaticDao.get(storage.getId())).thenReturn(storage.getStorageStaticData()); initializeCommand(parameters); assertFalse(command.canDoAction()); assertTrue(command.getReturnValue().getCanDoActionMessages().contains(VdcBllMessages.ACTION_TYPE_FAILED_SHAREABLE_DISKS_NOT_SUPPORTED_ON_GLUSTER_DOMAIN.toString())); }
private boolean canRemoveVmImageDisk() { if (!(listVms.isEmpty())) { org.ovirt.engine.core.compat.Guid storagePoolId = listVms.get(0).getStoragePoolId(); org.ovirt.engine.core.common.businessentities.storage_pool sp = org.ovirt.engine.core.bll.RemoveDiskCommand.getStoragePoolDAO().get(storagePoolId); if (!(validate(new org.ovirt.engine.core.bll.storage.StoragePoolValidator(sp).isUp()))) { return false; } java.util.List<org.ovirt.engine.core.common.businessentities.Disk> diskList = java.util.Arrays.asList(getDisk()); if (!(org.ovirt.engine.core.bll.ImagesHandler.PerformImagesChecks(org.ovirt.engine.core.bll.RemoveDiskCommand.getReturnValue().getCanDoActionMessages(), storagePoolId, true, false, false, true, org.ovirt.engine.core.bll.ImagesHandler.filterImageDisks(diskList, true, false)))) { return false; } } org.ovirt.engine.core.bll.snapshots.SnapshotsValidator snapshotsValidator = new org.ovirt.engine.core.bll.snapshots.SnapshotsValidator(); for (org.ovirt.engine.core.common.businessentities.VM vm : listVms) { if ((!(validate(snapshotsValidator.vmNotDuringSnapshot(vm.getId())))) || (!(validate(snapshotsValidator.vmNotInPreview(vm.getId()))))) { return false; } } return true; }
@org.ovirt.engine.ui.webadmin.Template("<td style='text-align: right;'>{0}</td>" + (((("<td style='text-align: center; white-space: nowrap; width: 10%;'>" + "<div style='font-size: 10px; text-align: center;'>{1}</div>") + "<div style='width: 25px;'>{2}</div>") + "</td>") + "<td style='text-align: left;'>{3}</td>")) com.google.gwt.safehtml.shared.SafeHtml vmCountInOutMigrations(java.lang.String prefix, java.lang.String vmCountStr, com.google.gwt.safehtml.shared.SafeHtml image, java.lang.String postfix);
private static void notifyClientOfLogoutEvent(org.ovirt.engine.core.sso.utils.SsoContext ssoContext, java.lang.String clientId, java.lang.String token) throws java.lang.Exception { org.ovirt.engine.core.sso.utils.ClientInfo clientInfo = ssoContext.getClienInfo(clientId); java.lang.String url = clientInfo.getClientNotificationCallback(); if (org.apache.commons.lang.StringUtils.isNotEmpty(url)) { org.apache.http.client.methods.HttpPost request = org.ovirt.engine.core.sso.utils.SsoUtils.createPost(url); java.util.List<org.apache.http.message.BasicNameValuePair> form = new java.util.ArrayList<>(3); form.add(new org.apache.http.message.BasicNameValuePair("event", "logout")); form.add(new org.apache.http.message.BasicNameValuePair("token", token)); form.add(new org.apache.http.message.BasicNameValuePair("token_type", "bearer")); request.setEntity(new org.apache.http.client.entity.UrlEncodedFormEntity(form, java.nio.charset.StandardCharsets.UTF_8)); org.ovirt.engine.core.sso.utils.SsoUtils.execute(request, ssoContext, clientId); } }
@java.lang.Override protected void executeCommand() { org.ovirt.engine.core.common.businessentities.StorageServerConnections currConnection = getConnection(); boolean isValidConnection = true; org.ovirt.engine.core.common.utils.Pair<java.lang.Boolean, java.lang.Integer> result = connect(org.ovirt.engine.core.bll.storage.AddStorageServerConnectionCommand.getVds().getId()); isValidConnection = result.getFirst(); if (isValidConnection && ((org.apache.commons.lang.StringUtils.isNotEmpty(currConnection.getid())) || ((org.ovirt.engine.core.bll.storage.AddStorageServerConnectionCommand.getDbFacade().getStorageServerConnectionDao().get(currConnection.getid())) == null))) { currConnection.setid(org.ovirt.engine.core.compat.Guid.NewGuid().toString()); org.ovirt.engine.core.bll.storage.AddStorageServerConnectionCommand.getDbFacade().getStorageServerConnectionDao().save(currConnection); org.ovirt.engine.core.bll.storage.AddStorageServerConnectionCommand.getReturnValue().setActionReturnValue(getConnection().getid()); org.ovirt.engine.core.bll.storage.AddStorageServerConnectionCommand.setSucceeded(true); } else { org.ovirt.engine.core.common.errors.VdcFault fault = new org.ovirt.engine.core.common.errors.VdcFault(); fault.setError(org.ovirt.engine.core.common.errors.VdcBllErrors.forValue(result.getSecond())); org.ovirt.engine.core.bll.storage.AddStorageServerConnectionCommand.getReturnValue().setFault(fault); org.ovirt.engine.core.bll.storage.AddStorageServerConnectionCommand.setSucceeded(false); } }
@java.lang.Override public org.ovirt.engine.ui.common.widget.action.ActionButton addMenuListItem(org.ovirt.engine.ui.common.widget.action.ActionButtonDefinition<T> menuItemDef) { org.ovirt.engine.ui.common.widget.action.ActionAnchorListItem menuItem = new org.ovirt.engine.ui.common.widget.action.ActionAnchorListItem(menuItemDef.getText()); java.lang.String menuItemId = menuItemDef.getUniqueId(); if (menuItemId != null) { menuItem.asWidget().getElement().setId(org.ovirt.engine.ui.common.utils.ElementIdUtils.createElementId(getElementId(), menuItemId)); } actionItemMap.put(menuItemDef, menuItem); actionKebab.addMenuItem(menuItem, menuItemDef.getIndex()); return menuItem; }
@java.lang.Override public void saveOrUpdate(org.ovirt.engine.core.common.businessentities.aaa.DbUser user) { setIdIfNeeded(user); new org.springframework.jdbc.core.simple.SimpleJdbcCall(getJdbcTemplate()).withProcedureName("InsertOrUpdateUser").execute(new org.ovirt.engine.core.dao.DbUserDaoImpl.DbUserMapSqlParameterSource(user)); }
@java.lang.Override protected void executeCommand() { getMacPoolDao().remove(getParameters().getMacPoolId()); org.ovirt.engine.core.bll.network.macpoolmanager.MacPoolPerDcSingleton.getInstance().removePool(getParameters().getMacPoolId()); getReturnValue().setSucceeded(true); }
protected org.ovirt.engine.core.common.action.VdcReturnValueBase attemptRollback(org.ovirt.engine.core.common.action.VdcActionType commandType, org.ovirt.engine.core.common.action.VdcActionParametersBase params) { if (canPerformRollbackUsingCommand(commandType, params)) { params.setExecutionReason(CommandExecutionReason.ROLLBACK_FLOW); params.setTransactionScopeOption(TransactionScopeOption.RequiresNew); return getBackend().runInternalAction(commandType, params, context.clone()); } return new org.ovirt.engine.core.common.action.VdcReturnValueBase(); }
@java.lang.Override protected boolean validate() { if (!(super.validate())) { return false; } org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity volume = getGlusterVolume(); if (volume.isOnline()) { addValidationMessage(EngineMessage.ACTION_TYPE_FAILED_GLUSTER_VOLUME_IS_UP); addValidationMessageVariable("volumeName", volume.getName()); return false; } if ((volume.getSnapshotsCount()) > 0) { addValidationMessage(EngineMessage.ACTION_TYPE_FAILED_GLUSTER_VOLUME_HAS_SNAPSHOTS); addValidationMessageVariable("volumeName", volume.getName()); addValidationMessageVariable("noOfSnapshots", volume.getSnapshotsCount()); return false; } return true; }
public static boolean validHostname(java.lang.String address) { if ((address == null) || (address.trim().isEmpty())) { return false; } return (org.ovirt.engine.core.common.utils.ValidationUtils.isValidIpAddressOrHostname(address)) || (org.ovirt.engine.core.common.utils.ValidationUtils.isValidIpv6Address(address)); }
@java.lang.Override public java.lang.String getEntityOldName() { return _oldVds.getVdsName(); }
@org.junit.Test public void testRemoveFailed() throws java.lang.Exception { setUpEntityQueryExpectations(VdcQueryType.GetVdsGroupsByStoragePoolId, org.ovirt.engine.core.common.queries.StoragePoolQueryParametersBase.class, new java.lang.String[]{ "StoragePoolId" }, new java.lang.Object[]{ org.ovirt.engine.api.restapi.resource.BackendDataCenterClustersResourceTest.dataCenterId }, setUpVDSGroups(), null); doTestBadRemove(true, false, org.ovirt.engine.api.restapi.resource.FAILURE); }
public static void populateMemoryUtilizationHosts(org.ovirt.engine.ui.frontend.server.dashboard.Utilization utilization, javax.sql.DataSource dwhDataSource) throws org.ovirt.engine.ui.frontend.server.dashboard.DashboardDataException { org.ovirt.engine.ui.frontend.server.dashboard.dao.HostDwhDao dao = new org.ovirt.engine.ui.frontend.server.dashboard.dao.HostDwhDao(dwhDataSource); java.util.List<org.ovirt.engine.ui.frontend.server.dashboard.models.TrendResources> usageList = dao.getMemoryUtilizationHosts(); for (org.ovirt.engine.ui.frontend.server.dashboard.models.TrendResources usage : usageList) { org.ovirt.engine.ui.frontend.server.dashboard.UtilizedEntity entity = new org.ovirt.engine.ui.frontend.server.dashboard.UtilizedEntity(); entity.setName(usage.getName()); entity.setUsed(((usage.getUsed()) / 1024)); entity.setTotal(((usage.getTotal()) / 1024)); entity.setTrend(org.ovirt.engine.ui.frontend.server.dashboard.UtilizationHelper.calculateTrend(usage.getUsed(), usage.getPreviousUsed())); utilization.addResource(entity); } }
public void setQos(org.ovirt.engine.core.common.businessentities.network.HostNetworkQos qos) { if (qos != null) { assert (qos.getName()) == null : "Overriding QoS entity must not be named!"; assert (qos.getStoragePoolId()) == null : "Overriding QoS entity must not be linked to a specific DC!"; } this.qos = qos; }
@org.junit.Test public void shouldDetectDuplicateCpuAssignment() { vmNumaNodes.get(0).setCpuIds(java.util.Collections.singletonList(0)); vmNumaNodes.get(1).setCpuIds(java.util.Collections.singletonList(0)); assertValidationFailure(underTest.checkVmNumaNodesIntegrity(vm, vm.getvNumaNodeList()), EngineMessage.VM_NUMA_NODE_DUPLICATE_CPU_IDS); }
private void run() { java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase> list = new java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase>(); for (java.lang.Object item : getSelectedItems()) { org.ovirt.engine.core.common.businessentities.VM a = ((org.ovirt.engine.core.common.businessentities.VM) (item)); boolean reinitialize = (!(a.isInitialized())) && (org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.isWindowsOsType(a.getVmOsId())); org.ovirt.engine.core.common.action.RunVmParams tempVar = new org.ovirt.engine.core.common.action.RunVmParams(a.getId()); tempVar.setReinitialize(reinitialize); list.add(tempVar); } org.ovirt.engine.ui.frontend.Frontend.RunMultipleAction(VdcActionType.RunVm, list, new org.ovirt.engine.ui.uicompat.IFrontendMultipleActionAsyncCallback() { @java.lang.Override public void executed(org.ovirt.engine.ui.uicompat.FrontendMultipleActionAsyncResult result) { } }, null); }
public java.lang.StringBuilder GetTagNameAndChildrenNames() { java.lang.StringBuilder builder = new java.lang.StringBuilder(); builder.append("'").append(gettag_name()).append("'"); for (org.ovirt.engine.core.common.businessentities.tags tag : _children) { builder.append(("," + (tag.GetTagNameAndChildrenNames()))); } return builder; }
public void setSELinuxEnforceMode(java.lang.Integer value) { mVdsDynamic.setSELinuxEnforceMode(value); }
protected void writeAdditionalJsData(javax.servlet.http.HttpServletRequest request, java.io.PrintWriter writer) { org.ovirt.engine.core.common.users.VdcUser loggedUser = getLoggedInUser(request); if (loggedUser != null) { java.util.Map<java.lang.String, java.lang.String> userInfoData = new java.util.HashMap<java.lang.String, java.lang.String>(); userInfoData.put("id", loggedUser.getUserId().toString()); userInfoData.put("userName", loggedUser.getUserName()); userInfoData.put("domain", loggedUser.getDomainControler()); writeJsObject(writer, "userInfo", userInfoData); } }
@org.junit.Test public void testGetNetworkQos() { org.ovirt.engine.core.common.businessentities.network.NetworkQoS result = dao.get(org.ovirt.engine.core.dao.network.NetworkQosDaoTest.qosAId); org.ovirt.engine.core.common.businessentities.network.NetworkQoS trueA = new org.ovirt.engine.core.common.businessentities.network.NetworkQoS(); trueA.setId(org.ovirt.engine.core.dao.network.NetworkQosDaoTest.qosAId); trueA.setName("qos_a"); trueA.setStoragePoolId(FixturesTool.STORAGE_POOL_MIXED_TYPES); trueA.setInboundAverage(1000); trueA.setInboundPeak(2000); trueA.setInboundBurst(500); trueA.setOutboundAverage(1000); trueA.setOutboundPeak(2000); trueA.setOutboundBurst(500); assertNotNull(result); assertTrue(trueA.equals(result)); }
private static org.apache.http.client.methods.HttpPost createPost(java.lang.String url) throws java.lang.Exception { org.apache.http.client.methods.HttpPost request = new org.apache.http.client.methods.HttpPost(); request.setURI(new java.net.URI(url)); request.setHeader("Accept", "application/json"); return request; }
private java.util.stream.Stream<org.ovirt.engine.core.common.businessentities.CommandEntity> findFailedChildCommandEntities(org.ovirt.engine.core.bll.CommandBase command) { final java.util.List<org.ovirt.engine.core.common.businessentities.CommandEntity> childCommandEntities = org.ovirt.engine.core.bll.tasks.CommandCoordinatorUtil.findChildCommands(command.getCommandId()); return childCommandEntities.stream().filter(( childCommand) -> !(childCommand.getReturnValue().getSucceeded())); }
@java.lang.Override @java.lang.SuppressWarnings("serial") protected java.util.Map<java.lang.String, org.ovirt.engine.core.common.utils.Pair<java.lang.String, java.lang.String>> getExclusiveLocks() { if (((org.ovirt.engine.core.bll.ImportVmCommandBase.getParameters().getVm()) != null) && (!(org.apache.commons.lang.StringUtils.isBlank(org.ovirt.engine.core.bll.ImportVmCommandBase.getParameters().getVm().getName())))) { return new java.util.HashMap<java.lang.String, org.ovirt.engine.core.common.utils.Pair<java.lang.String, java.lang.String>>() { { put(getParameters().getVm().getName(), org.ovirt.engine.core.bll.LockMessagesMatchUtil.makeLockingPair(LockingGroup.VM_NAME, EngineMessage.ACTION_TYPE_FAILED_NAME_ALREADY_USED)); put(getParameters().getVm().getId().toString(), org.ovirt.engine.core.bll.LockMessagesMatchUtil.makeLockingPair(LockingGroup.VM, getVmIsBeingImportedMessage())); } }; } return null; }
@java.lang.Override public int setTabIndexes(int nextTabIndex) { return nextTabIndex; }
@java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object ReturnValue) { org.ovirt.engine.ui.uicommonweb.models.storage.StorageSnapshotListModel storageSnapshotListModel = ((org.ovirt.engine.ui.uicommonweb.models.storage.StorageSnapshotListModel) (model)); java.util.ArrayList<org.ovirt.engine.core.common.businessentities.DiskImage> newItems = ((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (ReturnValue)).getReturnValue(); java.util.Collections.sort(newItems, new org.ovirt.engine.ui.uicommonweb.Linq.DiskImageByActualSizeComparer()); java.util.Collections.reverse(newItems); storageSnapshotListModel.setItems(newItems); }
@org.junit.Test public void isVirtioScsiEnabledDefaultedToTrue() { org.ovirt.engine.core.bll.AddVmCommand<org.ovirt.engine.core.common.action.VmManagementParametersBase> cmd = setupCanAddVmTests(0, 0); doReturn(createVdsGroup()).when(cmd).getVdsGroup(); junit.framework.Assert.assertTrue("isVirtioScsiEnabled hasn't been defaulted to true on cluster >= 3.3.", cmd.isVirtioScsiEnabled()); }
private void onCreateQuota() { if (hasUnlimitedSpecificQuota()) { org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel confirmModel = new org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel(); setConfirmWindow(confirmModel); confirmModel.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().changeDCQuotaEnforcementModeTitle()); confirmModel.setHelpTag(HelpTag.set_unlimited_specific_quota); confirmModel.setHashName("set_unlimited_specific_quota"); confirmModel.setMessage(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().youAreAboutToCreateUnlimitedSpecificQuotaMsg()); org.ovirt.engine.ui.uicommonweb.UICommand tempVar = new org.ovirt.engine.ui.uicommonweb.UICommand("OnCreateQuotaInternal", this); tempVar.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().ok()); getConfirmWindow().getCommands().add(tempVar); org.ovirt.engine.ui.uicommonweb.UICommand tempVar2 = new org.ovirt.engine.ui.uicommonweb.UICommand("CancelConfirmation", this); tempVar2.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().cancel()); tempVar2.setIsCancel(true); tempVar2.setIsDefault(true); getConfirmWindow().getCommands().add(tempVar2); } else { onCreateQuotaInternal(false); } }
@java.lang.Override protected void syncSearch() { super.syncSearch(); org.ovirt.engine.ui.frontend.AsyncQuery asyncQuery = new org.ovirt.engine.ui.frontend.AsyncQuery(this, new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { setItems(((java.util.Collection) (((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (returnValue)).getReturnValue()))); } }); org.ovirt.engine.core.common.queries.IdQueryParameters params = new org.ovirt.engine.core.common.queries.IdQueryParameters(getEntity().getId()); params.setRefresh(getIsQueryFirstTime()); org.ovirt.engine.ui.frontend.Frontend.getInstance().runQuery(VdcQueryType.GetAttachedClustersByClusterPolicyId, params, asyncQuery); setIsQueryFirstTime(false); }
org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc glusterVolumeGeoRepSessionDelete(java.lang.String volumeName, java.lang.String remoteHost, java.lang.String remoteVolumeName, java.lang.String userName);
@org.ovirt.engine.core.utils.timer.OnTimerMethodAnnotation("poll") public void poll() { if (manager.isMonitoringNeeded()) { org.ovirt.engine.core.vdsbroker.VmsListFetcher fetcher = (getRefreshStatistics()) ? new org.ovirt.engine.core.vdsbroker.VmsStatisticsFetcher(manager) : new org.ovirt.engine.core.vdsbroker.VmsListFetcher(manager); long fetchTime = java.lang.System.nanoTime(); if (fetcher.fetch()) { getVmsMonitoring(fetcher, fetchTime).perform(); } else { org.ovirt.engine.core.vdsbroker.PollVMStatsRefresher.log.info("Failed to fetch vms info for host '{}' - skipping VMs monitoring.", manager.getVdsName()); } } updateIteration(); }
private void refreshVmStats(java.util.List<org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.common.businessentities.VM, org.ovirt.engine.core.vdsbroker.vdsbroker.entities.VmInternalData>> monitoredVms) { for (org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.common.businessentities.VM, org.ovirt.engine.core.vdsbroker.vdsbroker.entities.VmInternalData> monitoredVm : monitoredVms) { if (tryLockVmForUpdate(monitoredVm)) { org.ovirt.engine.core.vdsbroker.VmAnalyzer vmAnalyzer = getVmAnalyzer(monitoredVm); vmAnalyzers.add(vmAnalyzer); vmAnalyzer.analyze(); } } addUnmanagedVms(); flush(); }
@org.ovirt.engine.core.utils.lock.AcquireWriteLock boolean addMac(java.lang.String mac);
private java.lang.String findValidMigrationIpAddress(org.ovirt.engine.core.common.businessentities.network.Network migrationNetwork, java.util.function.Function<org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface, java.lang.String> ipAddressGetter) { final java.lang.String migrationSourceIpAddress = getMigrationNetworkAddress(org.ovirt.engine.core.bll.MigrateVmCommand.getVds().getId(), migrationNetwork.getName(), ipAddressGetter); if (org.apache.commons.lang.StringUtils.isNotEmpty(migrationSourceIpAddress)) { final java.lang.String migrationDestinationIpAddress = getMigrationNetworkAddress(getDestinationVds().getId(), migrationNetwork.getName(), ipAddressGetter); if (org.apache.commons.lang.StringUtils.isNotEmpty(migrationDestinationIpAddress)) { return migrationDestinationIpAddress; } } return null; }
public static org.ovirt.engine.core.common.businessentities.gluster.GlusterBrickEntity findBrick(java.util.Collection<org.ovirt.engine.core.common.businessentities.gluster.GlusterBrickEntity> bricks, org.ovirt.engine.core.common.businessentities.gluster.GlusterBrickEntity searchBrick) { return org.ovirt.engine.core.common.utils.gluster.GlusterCoreUtil.findBrick(bricks, searchBrick.getServerId(), searchBrick.getBrickDirectory()); }
protected org.ovirt.engine.core.common.action.CreateAllSnapshotsFromVmParameters getCreateSnapshotParameters() { org.ovirt.engine.core.common.action.CreateAllSnapshotsFromVmParameters params = new org.ovirt.engine.core.common.action.CreateAllSnapshotsFromVmParameters(enclosingCommand.getParameters().getVmId(), "Auto-generated for Live Storage Migration"); params.setParentCommand(VdcActionType.LiveMigrateVmDisks); params.setSnapshotType(SnapshotType.REGULAR); params.setParentParameters(enclosingCommand.getParameters()); params.setImagesParameters(enclosingCommand.getParameters().getImagesParameters()); params.setTaskGroupSuccess(enclosingCommand.getParameters().getTaskGroupSuccess()); params.setNeedsLocking(false); return params; }
@org.junit.Test public void testAttributeAndElement() { org.ovirt.engine.api.types.V4Vm object = vm().id("123").name("myvm").build(); assertEquals("<vm id=\"123\"><name>myvm</name></vm>", objectToXml(object)); }
@java.lang.Override public com.google.gwt.resources.client.ImageResource getValue(T item) { java.lang.String osTypeName = org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().getOsUniqueOsNames().get(extractor.extractOsType(item)); com.google.gwt.resources.client.ResourcePrototype resource = resourcesWithLookup.getResource((osTypeName + "SmallImage")); if (!(resource instanceof com.google.gwt.resources.client.ImageResource)) { resource = resourcesWithLookup.otherSmallImage(); } return ((com.google.gwt.resources.client.ImageResource) (resource)); }
@java.lang.Override public void updateIfNeeded(org.ovirt.engine.core.common.businessentities.VdsDynamic vdsDynamic) { org.ovirt.engine.core.common.businessentities.VdsDynamic dbData = get(vdsDynamic.getId()); if (!(dbData.equals(vdsDynamic))) { update(vdsDynamic); } else { org.ovirt.engine.core.dao.VdsDynamicDAODbFacadeImpl.log.debug("Ignored an unneeded update of VdsDynamic"); } }
private java.util.Map<java.lang.String, java.lang.String> getServerFingerprints(org.w3c.dom.NodeList listOfPeers) { java.util.Map<java.lang.String, java.lang.String> fingerprints = new java.util.HashMap<java.lang.String, java.lang.String>(); fingerprints.put(org.ovirt.engine.core.bll.gluster.GetGlusterServersForImportQuery.getParameters().getServerName(), org.ovirt.engine.core.bll.gluster.GetGlusterServersForImportQuery.getParameters().getFingerprint()); for (int i = 0; i < (listOfPeers.getLength()); i++) { org.w3c.dom.Node firstPeer = listOfPeers.item(i); if ((firstPeer.getNodeType()) == (org.w3c.dom.Node.ELEMENT_NODE)) { org.w3c.dom.Element firstHostElement = ((org.w3c.dom.Element) (firstPeer)); int state = org.ovirt.engine.core.utils.XmlUtils.getIntValue(firstHostElement, org.ovirt.engine.core.bll.gluster.GetGlusterServersForImportQuery.STATE); if (state == (org.ovirt.engine.core.bll.gluster.GetGlusterServersForImportQuery.PEER_IN_CLUSTER)) { java.lang.String hostName = org.ovirt.engine.core.utils.XmlUtils.getTextValue(firstHostElement, org.ovirt.engine.core.bll.gluster.GetGlusterServersForImportQuery.HOST_NAME); fingerprints.put(hostName, getFingerprint(hostName)); } } } return fingerprints; }
private java.lang.String getGlusterNetworkAddress(org.ovirt.engine.core.compat.Guid hostId, java.lang.String glusterNetworkName) { final java.util.List<org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface> nics = getInterfaceDAO().getAllInterfacesForVds(hostId); for (org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface nic : nics) { if (glusterNetworkName.equals(nic.getNetworkName())) { return nic.getAddress(); } } return null; }
public static java.lang.String crypt(java.lang.String password) { byte[] r = new byte[org.ovirt.engine.core.uutils.crypto.CryptMD5.SALT_MAX_LENGTH]; char[] salt = new char[r.length]; org.ovirt.engine.core.uutils.crypto.CryptMD5.SECURE_RANDOM.nextBytes(r); for (int i = 0; i < (r.length); i++) { salt[i] = org.ovirt.engine.core.uutils.crypto.CryptMD5.b64t[(((r[i]) & 255) % (org.ovirt.engine.core.uutils.crypto.CryptMD5.b64t.length))]; } return org.ovirt.engine.core.uutils.crypto.CryptMD5.crypt(password, new java.lang.String(salt)); }
@org.junit.Test public void shouldFilterHostsWithNotEnoughCpuCores() { cluster.setCountThreadsAsCores(false); final java.util.List<org.ovirt.engine.core.common.businessentities.VDS> candidates = filter(); assertThat(candidates).doesNotContain(vdsWithCores); }
@java.lang.Override protected com.woorea.openstack.glance.Glance getClient() { if ((client) == null) { client = new com.woorea.openstack.glance.Glance(((getProvider().getUrl()) + (org.ovirt.engine.core.bll.provider.storage.OpenStackImageProviderProxy.API_VERSION))); client.setTokenProvider(getTokenProvider()); } return client; }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("Local") java.lang.String storageTypeLocal();
@org.junit.Test public void testGet() { org.ovirt.engine.core.common.businessentities.UserProfile result = dao.get(existingProfile.getId()); assertNotNull(result); assertEquals(existingProfile, result); }
@java.lang.Override public org.ovirt.engine.core.common.businessentities.DbGroup getByIdOrExternalId(org.ovirt.engine.core.compat.Guid id, java.lang.String domain, java.lang.String externalId) { if (id != null) { org.ovirt.engine.core.common.businessentities.DbGroup existing = get(id); if (existing != null) { return existing; } } if ((domain != null) && (externalId != null)) { org.ovirt.engine.core.common.businessentities.DbGroup existing = getByExternalId(domain, externalId); if (existing != null) { return existing; } } if ((domain != null) && (id != null)) { org.ovirt.engine.core.common.businessentities.DbGroup existing = getByExternalId(domain, id.toString()); if (existing != null) { return existing; } } return null; }
private void commonUpdate(org.ovirt.engine.core.compat.Guid vfsConfigId, boolean allNetworksAllowed) { org.ovirt.engine.core.common.businessentities.network.HostNicVfsConfig before = dao.get(vfsConfigId); before.setNicId(FixturesTool.VDS_NETWORK_INTERFACE_WITHOUT_QOS); before.setMaxNumOfVfs(((before.getMaxNumOfVfs()) + 1)); before.setNumOfVfs(((before.getNumOfVfs()) + 1)); before.setAllNetworksAllowed(allNetworksAllowed); if (allNetworksAllowed) { before.setNetworks(new java.util.HashSet<org.ovirt.engine.core.compat.Guid>()); before.setNetworkLabels(new java.util.HashSet<java.lang.String>()); } else { addNetworks(before); addLabels(before); } dao.update(before); org.ovirt.engine.core.common.businessentities.network.HostNicVfsConfig after = dao.get(vfsConfigId); assertNotNull(after); assertHostNicVfsConfigEquals(before, after); }
private boolean detachStorageDomainSucceeded(org.ovirt.engine.core.compat.Guid storageDomainId) { log.info("Domain '{}' is already attached to a different storage pool, clean the storage domain metadata.", storageDomainId); org.ovirt.engine.core.common.vdscommands.StorageDomainVdsCommandParameters params = new org.ovirt.engine.core.common.vdscommands.StorageDomainVdsCommandParameters(storageDomainId, org.ovirt.engine.core.bll.storage.pool.AddStoragePoolWithStoragesCommand.getVds().getId()); org.ovirt.engine.core.common.vdscommands.VDSReturnValue ret = runVdsCommand(VDSCommandType.CleanStorageDomainMetaData, params); if (!(ret.getSucceeded())) { log.error("Failed to clean metadata for storage domain '{}'.", storageDomainId); return false; } log.info("Successfully cleaned metadata for storage domain '{}'.", storageDomainId); return true; }
@java.lang.Override public void setSubTabPanelVisible(boolean subTabPanelVisible) { if ((this.subTabPanelVisible) != subTabPanelVisible) { splitPanel.clear(); if (subTabPanelVisible) { splitPanel.addSouth(subTabPanelContainer, org.ovirt.engine.ui.userportal.section.main.view.AbstractSideTabWithDetailsView.subTabPanelHeight); splitPanel.add(table); splitPanel.init(); } else { splitPanel.add(table); } this.subTabPanelVisible = subTabPanelVisible; } }
@java.lang.Override protected void handleAutoLogin(org.ovirt.engine.ui.common.auth.AutoLoginData autoLoginData) { super.handleAutoLogin(autoLoginData); com.google.gwt.core.client.Scheduler.get().scheduleDeferred(new com.google.gwt.core.client.Scheduler.ScheduledCommand() { @java.lang.Override public void execute() { restApiSessionManager.reuseCurrentSession(); } }); }
@java.lang.Override protected boolean canDoAction() { parameters = getParameters(); if (!(super.canDoAction())) { return false; } if (getGeoRepSession().getStatus().equals(GeoRepSessionStatus.ACTIVE)) { addCanDoActionMessage(EngineMessage.ACTION_TYPE_FAILED_GEOREP_SESSION_ALREADY_RESUMED); return false; } return true; }
@org.junit.Test public void testValidateNetworkExclusiveOnNicAtMostOneNonVmNetworkViolated() throws java.lang.Exception { checkVmNetworkIsSoleAssignedInterface(org.ovirt.engine.core.bll.validator.ValidationResultMatchers.failsWith(VdcBllMessages.NETWORK_INTERFACES_NOT_EXCLUSIVELY_USED_BY_NETWORK), nonVmNetwork1, nonVmNetwork2); }
@java.lang.Override protected void setActionMessageParameters() { addValidationMessage(EngineMessage.VAR__TYPE__GLUSTER_VOLUME_SNAPSHOT_CONFIG); addValidationMessage(EngineMessage.VAR__ACTION__VOLUME_SNAPSHOT_CONFIG_UPDATE); }
private org.ovirt.engine.core.bll.ValidationResult referencedNetworkAttachmentActuallyExists(org.ovirt.engine.core.compat.Guid networkAttachmentId) { boolean doesNotReferenceExistingNetworkAttachment = networkAttachmentId == null; if (doesNotReferenceExistingNetworkAttachment) { return org.ovirt.engine.core.bll.ValidationResult.VALID; } for (org.ovirt.engine.core.common.businessentities.network.NetworkAttachment existingAttachment : existingAttachments) { if (existingAttachment.getId().equals(networkAttachmentId)) { return org.ovirt.engine.core.bll.ValidationResult.VALID; } } return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.NETWORK_ATTACHMENT_NOT_EXISTS); }
@org.junit.Test public void canDoActionSucceedsOnDiskDomainCheckWhenNoDisks() throws java.lang.Exception { org.ovirt.engine.core.compat.Guid storageId = org.ovirt.engine.core.compat.Guid.newGuid(); initializeCommand(storageId); mockVm(); mockStorageDomain(storageId); mockStoragePoolIsoMap(); mockInterfaceList(); mockMaxPciSlots(); runAndAssertCanDoActionSuccess(); }
private java.lang.String showRpdConsole(org.ovirt.engine.ui.uicommonweb.models.HasConsoleModel model) { if (consoleUtils.canOpenRDPConsole(model)) { model.getAdditionalConsoleModel().getConnectCommand().Execute(); } else if (!(consoleUtils.isRDPAvailable())) { return createErrorMessage(model, "RDP"); } return null; }
@java.lang.Override public void onNext(java.util.Map<java.lang.String, java.lang.Object> map) { try { java.util.List<org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.common.businessentities.VM, org.ovirt.engine.core.vdsbroker.vdsbroker.entities.VmInternalData>> changedVms = new java.util.ArrayList<>(); java.util.List<org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.common.businessentities.VM, org.ovirt.engine.core.vdsbroker.vdsbroker.entities.VmInternalData>> devicesChangedVms = new java.util.ArrayList<>(); java.util.List<org.ovirt.engine.core.vdsbroker.vdsbroker.entities.VmInternalData> vdsmVms = convertEvent(map); prepareChanges(vdsmVms, changedVms, devicesChangedVms); new org.ovirt.engine.core.vdsbroker.VmsMonitoring(manager, changedVms, devicesChangedVms, auditLogDirector).perform(); } finally { subscription.request(1); } }
@java.lang.Override public boolean eval(org.ovirt.engine.core.common.businessentities.VDS p) { return (getOccupiedVmSlots(p, parameters)) >= worstVdsOccupiedVmSlots; }
private boolean updateFileList(org.ovirt.engine.core.compat.Guid storageDomainId, org.ovirt.engine.core.compat.Guid storagePoolId, org.ovirt.engine.core.common.businessentities.storage.ImageFileType imageType) { switch (imageType) { case All : return updateAllFileListFromVDSM(storagePoolId, storageDomainId); case ISO : return updateIsoListFromVDSM(storagePoolId, storageDomainId); case Floppy : return updateFloppyListFromVDSM(storagePoolId, storageDomainId); default : org.ovirt.engine.core.bll.storage.domain.IsoDomainListSyncronizer.log.warn("Refreshing Iso domain using unsupported imageType: {}", imageType); return false; } }
public org.ovirt.engine.core.bll.ValidationResult validateCinderDiskSnapshotsLimits() { return validate(new java.util.concurrent.Callable<org.ovirt.engine.core.bll.ValidationResult>() { @java.lang.Override public org.ovirt.engine.core.bll.ValidationResult call() { java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.bll.validator.storage.CinderDisksValidator.CinderStorageRelatedDisksAndProxy> relatedCinderDisksByStorageMap = getRelatedCinderDisksToStorageDomainMap(); java.util.Collection<org.ovirt.engine.core.bll.validator.storage.CinderDisksValidator.CinderStorageRelatedDisksAndProxy> relatedCinderDisksByStorageCollection = relatedCinderDisksByStorageMap.values(); for (org.ovirt.engine.core.bll.validator.storage.CinderDisksValidator.CinderStorageRelatedDisksAndProxy relatedCinderDisksByStorage : relatedCinderDisksByStorageCollection) { com.woorea.openstack.cinder.model.Limits limits = relatedCinderDisksByStorage.getProxy().getLimits(); int numOfDisks = relatedCinderDisksByStorage.getCinderDisks().size(); if (isLimitExceeded(limits, VolumeClassification.Snapshot, numOfDisks)) { java.lang.String storageName = getStorageDomainDao().get(relatedCinderDisksByStorage.getStorageDomainId()).getStorageName(); return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.CANNOT_ADD_CINDER_DISK_SNAPSHOT_LIMIT_EXCEEDED, java.lang.String.format("$maxTotalSnapshots %d", limits.getAbsolute().getMaxTotalVolumes()), java.lang.String.format("$storageName %s", storageName)); } } return org.ovirt.engine.core.bll.ValidationResult.VALID; } }); }
@java.lang.Override protected org.ovirt.engine.api.model.ExternalHostProvider doPopulate(org.ovirt.engine.api.model.ExternalHostProvider model, org.ovirt.engine.core.common.businessentities.Provider entity) { return model; }
public java.util.List<java.math.BigInteger> readIntegers() { return readStrings().stream().map(this::parseInteger).collect(java.util.stream.Collectors.toList()); }
public void AttachTask(org.ovirt.engine.core.bll.CommandAsyncTask asyncTask) { synchronized(_listTasks) { if (!(_listTasks.containsKey(asyncTask.getVdsmTaskId()))) { org.ovirt.engine.core.bll.CommandMultiAsyncTasks.log.infoFormat("CommandMultiAsyncTasks::AttachTask: Attaching task '{0}' to command '{1}'.", asyncTask.getVdsmTaskId(), getCommandId()); _listTasks.put(asyncTask.getVdsmTaskId(), asyncTask); } } }
public java.util.Map<org.ovirt.api.metamodel.concepts.Method, java.util.Set<org.ovirt.api.metamodel.concepts.Method>> getBaseMethodsMap(java.util.List<org.ovirt.api.metamodel.concepts.Method> methods) { java.util.Map<org.ovirt.api.metamodel.concepts.Method, java.util.Set<org.ovirt.api.metamodel.concepts.Method>> baseMethods = new java.util.HashMap<>(); methods.forEach(( x) -> updateBaseMethodsMap(x, methods, baseMethods)); return baseMethods; }
private void storeTimeZone() { if ((params.getTimeZone()) != null) { userData.put("timezone", params.getTimeZone()); } }
@java.lang.Override public void deallocate(org.ovirt.engine.core.common.businessentities.network.VmNic nic) { try { com.woorea.openstack.quantum.model.Port port = locatePort(nic); if (port != null) { getClient().ports().delete(port.getId()).execute(); } } catch (java.lang.RuntimeException e) { throw new org.ovirt.engine.core.common.errors.EngineException(org.ovirt.engine.core.common.errors.EngineError.PROVIDER_FAILURE, e); } }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Could not find any host in Up status in the cluster. Please try again later.") java.lang.String cannotAddBricksNoUpServerFound();
@java.lang.Override protected void executeCommand() { java.lang.String connectionId = org.ovirt.engine.core.bll.storage.connection.RemoveStorageServerConnectionCommand.getConnection().getId(); org.ovirt.engine.core.bll.storage.connection.RemoveStorageServerConnectionCommand.getStorageServerConnectionDao().remove(connectionId); log.info("Removing connection '{}' from database ", connectionId); if (org.ovirt.engine.core.compat.Guid.isNullOrEmpty(org.ovirt.engine.core.bll.storage.connection.RemoveStorageServerConnectionCommand.getParameters().getVdsId())) { log.info("No vdsId passed - hosts will not be disconnected."); } else { org.ovirt.engine.core.bll.storage.connection.RemoveStorageServerConnectionCommand.disconnectStorage(); } org.ovirt.engine.core.bll.storage.connection.RemoveStorageServerConnectionCommand.setSucceeded(true); }
protected org.ovirt.engine.core.common.businessentities.storage.ImageTransfer updateEntity(org.ovirt.engine.core.common.businessentities.storage.ImageTransfer updates, boolean clearResourceId) { return imageTransferUpdater.updateEntity(updates, org.ovirt.engine.core.bll.storage.disk.image.UploadImageCommand.getCommandId(), clearResourceId); }
protected org.ovirt.engine.core.dao.network.NetworkQoSDao getNetworkQoSDao() { return getDbFacade().getQosDao(); }
private void setBondingOptions(org.ovirt.engine.ui.uicommonweb.models.ListModel<java.util.Map.Entry<java.lang.String, org.ovirt.engine.ui.uicommonweb.models.EntityModel<java.lang.String>>> value) { privateBondingOptions = value; }
@java.lang.Override public void updateInterfaceForVds(org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface entity) { org.springframework.jdbc.core.namedparam.MapSqlParameterSource parameterSource = getCustomMapSqlParameterSource().addValue("addr", entity.getAddress()).addValue("bond_name", entity.getBondName()).addValue("bond_type", entity.getBondType()).addValue("gateway", entity.getGateway()).addValue("id", entity.getId()).addValue("is_bond", entity.getBonded()).addValue("bond_opts", entity.getBondOptions()).addValue("mac_addr", entity.getMacAddress()).addValue("name", entity.getName()).addValue("network_name", entity.getNetworkName()).addValue("speed", entity.getSpeed()).addValue("subnet", entity.getSubnet()).addValue("boot_protocol", entity.getBootProtocol()).addValue("type", entity.getType()).addValue("vds_id", entity.getVdsId()).addValue("vlan_id", entity.getVlanId()).addValue("mtu", entity.getMtu()).addValue("bridged", entity.isBridged()).addValue("labels", org.ovirt.engine.core.utils.SerializationFactory.getSerializer().serialize(entity.getLabels())); getCallsHandler().executeModification("Updatevds_interface", parameterSource); }
protected void doNonBlockingAction(final org.ovirt.engine.core.common.action.VdcActionType task, final org.ovirt.engine.core.common.action.VdcActionParametersBase params) { org.ovirt.engine.core.common.interfaces.BackendLocal backend = getBackend(); setCorrelationId(params); setJobOrStepId(params); backend.runAction(VdcActionType.RunAsyncAction, sessionize(new org.ovirt.engine.core.common.action.RunAsyncActionParameters(task, sessionize(params)))); }
protected java.util.List<org.ovirt.engine.core.common.businessentities.RepoFileMetaData> getUserRequestForStorageDomainRepoFileList() { return org.ovirt.engine.core.bll.IsoDomainListSyncronizer.getInstance().getUserRequestForStorageDomainRepoFileList(getStorageDomainId(), GetImagesListQuery.getParameters().getFileTypeExtension(), GetImagesListQuery.getParameters().getForceRefresh()); }
public org.ovirt.engine.core.bll.ValidationResult dataCenterExists() { return org.ovirt.engine.core.bll.ValidationResult.failWith(EngineMessage.ACTION_TYPE_FAILED_STORAGE_POOL_NOT_EXIST).when(((getDataCenter()) == null)); }
@java.lang.Override protected void syncSearch() { if ((getEntity()) == null) { setItems(null); return; } super.syncSearch(); org.ovirt.engine.core.common.businessentities.StorageDomain storageDomain = getEntity(); org.ovirt.engine.ui.frontend.Frontend.getInstance().runQuery(VdcQueryType.GetEntitiesWithLeaseByStorageId, new org.ovirt.engine.core.common.queries.IdQueryParameters(storageDomain.getId()), new org.ovirt.engine.ui.uicommonweb.models.storage.SetItemsAsyncQuery()); }
static org.ovirt.engine.api.model.VM setUpEntityExpectations(org.ovirt.engine.core.common.businessentities.VM entity, org.ovirt.engine.core.common.businessentities.VmStatistics statistics, int index, org.ovirt.engine.core.compat.Guid vmId) { entity.setId(vmId); entity.setVdsGroupId(GUIDS[2]); entity.setName(NAMES[index]); entity.setVmDescription(DESCRIPTIONS[index]); entity.setCpuPerSocket(4); entity.setNumOfSockets(2); entity.setUsageMemPercent(20); entity.setDisplayType(DisplayType.cirrus); entity.setDisplaySecurePort(5900); entity.setNumOfMonitors(2); entity.setVmType(VmType.Server); entity.setRunOnVdsName(NAMES[((NAMES.length) - 1)]); entity.setOrigin((index == 0 ? org.ovirt.engine.core.common.businessentities.OriginType.HOSTED_ENGINE : org.ovirt.engine.core.common.businessentities.OriginType.OVIRT)); entity.setBootSequence(null); org.ovirt.engine.api.restapi.resource.BackendVmsResourceTest.setUpStatisticalEntityExpectations(entity, statistics); return entity; }
public void flush() { network.setDataCenterId(getSelectedDc().getId()); network.setName(((java.lang.String) (getName().getEntity()))); network.setStp(((java.lang.Boolean) (getIsStpEnabled().getEntity()))); network.setDescription(((java.lang.String) (getDescription().getEntity()))); network.setLabel(((java.lang.String) (getNetworkLabel().getEntity()))); network.setVmNetwork(((java.lang.Boolean) (getIsVmNetwork().getEntity()))); network.setMtu(0); if (((java.lang.Boolean) (getHasMtu().getEntity()))) { network.setMtu(java.lang.Integer.parseInt(getMtu().getEntity().toString())); } network.setVlanId(null); if (((java.lang.Boolean) (getHasVLanTag().getEntity()))) { network.setVlanId(java.lang.Integer.parseInt(getVLanTag().getEntity().toString())); } }
private boolean validateStoragePropertiesUpdate() { if ((!(checkStorageDomainStatusNotEqual(StorageDomainStatus.Locked))) || (!(validateStorageNameUpdate()))) { return false; } java.util.List<java.lang.String> props = org.ovirt.engine.core.utils.ObjectIdentityChecker.GetChangedFields(oldDomain, org.ovirt.engine.core.bll.storage.UpdateStorageDomainCommand.getStorageDomain().getStorageStaticData()); props.remove("storageName"); props.remove("description"); props.remove("comment"); props.remove("wipeAfterDelete"); props.remove("warningLowSpaceIndicator"); props.remove("criticalSpaceActionBlocker"); if (!(props.isEmpty())) { log.warn("There was an attempt to update the following fields although they are not allowed to be updated: {}", org.apache.commons.lang.StringUtils.join(props, ",")); return failCanDoAction(EngineMessage.ERROR_CANNOT_CHANGE_STORAGE_DOMAIN_FIELDS); } return true; }
public void resetEmulatedMachine() { if ((org.ovirt.engine.ui.uicommonweb.models.clusters.ClusterListModel.getWindow()) != null) { return; } org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel model = new org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel(); setWindow(model); model.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().resetClusterEmulatedMachineTitle()); model.setMessage(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().resetClusterEmulatedMachineMessage()); model.setHelpTag(HelpTag.reset_emulated_machine_cluster); model.setHashName("reset_cluster_emulated_machine"); java.util.ArrayList<java.lang.String> list = new java.util.ArrayList<java.lang.String>(); for (org.ovirt.engine.core.common.businessentities.VDSGroup vdsGroup : org.ovirt.engine.ui.uicommonweb.Linq.<org.ovirt.engine.core.common.businessentities.VDSGroup>cast(org.ovirt.engine.ui.uicommonweb.models.clusters.ClusterListModel.getSelectedItems())) { list.add(vdsGroup.getName()); } model.setItems(list); model.getCommands().add(org.ovirt.engine.ui.uicommonweb.UICommand.createDefaultOkUiCommand("OnResetClusterEmulatedMachine", this)); model.getCommands().add(org.ovirt.engine.ui.uicommonweb.UICommand.createCancelUiCommand("Cancel", this)); }
private void determineLabelValue(org.ovirt.engine.ui.uicommonweb.models.hosts.FenceAgentModel model) { if (org.ovirt.engine.ui.uicompat.external.StringUtils.isEmpty(model.getManagementIp().getEntity())) { showControls(false); } else if (model.isInConcurrentGroup()) { agentLabel.setVisible(false); concurrentGroupLabel.setVisible(true); topRow.addStyleName(style.highlightRow()); showControls(true); showConcurrentGroup(model); } else { agentLabel.setVisible(true); topRow.removeStyleName(style.highlightRow()); concurrentGroupLabel.setVisible(false); agentLabel.setText(model.getDisplayString()); showControls(true); } }
@java.lang.Override public void edit(final org.ovirt.engine.ui.uicommonweb.models.storage.SanStorageModelBase object) { driver.edit(object); object.getPropertyChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener<org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs>() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs args) { java.lang.String propName = args.propertyName; if (propName.equals("ProposeDiscoverTargets")) { setProposeDiscover(object.getProposeDiscoverTargets()); } else if (propName.equals("Message")) { messageLabel.setText(object.getMessage()); } } }); addKeyPressHandler(new com.google.gwt.event.dom.client.KeyPressHandler() { @java.lang.Override public void onKeyPress(com.google.gwt.event.dom.client.KeyPressEvent event) { if ((com.google.gwt.event.dom.client.KeyCodes.KEY_ENTER) == (event.getNativeEvent().getKeyCode())) { object.getDiscoverTargetsCommand().execute(); setIsFocused(false); } } }); setProposeDiscover(object.getProposeDiscoverTargets()); initButtons(object); }
public boolean isHostedEngine() { return ((OriginType.HOSTED_ENGINE) == (getOrigin())) || ((OriginType.MANAGED_HOSTED_ENGINE) == (getOrigin())); }
public void setImageTypeId(org.ovirt.engine.core.compat.Guid imageTypeId) { this.imageTypeId = imageTypeId; }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Events") java.lang.String eventsTitle();
public java.lang.Object call() throws java.lang.Exception { if (((java.lang.Boolean) (_parser.cliEnvironmentGet(VdsmEnv.OVIRT_NODE)))) { _messages.post(InstallerMessages.Severity.INFO, "Host is ovirt-node"); _setNode(); } return null; }
@java.lang.Override protected org.springframework.jdbc.core.namedparam.MapSqlParameterSource createFullParametersMapper(org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity volume) { return getCustomMapSqlParameterSource().addValue("id", volume.getId()).addValue("cluster_id", volume.getClusterId()).addValue("vol_name", volume.getName()).addValue("vol_type", org.ovirt.engine.core.common.utils.EnumUtils.nameOrNull(volume.getVolumeType())).addValue("status", org.ovirt.engine.core.common.utils.EnumUtils.nameOrNull(volume.getStatus())).addValue("replica_count", volume.getReplicaCount()).addValue("stripe_count", volume.getStripeCount()).addValue("disperse_count", volume.getDisperseCount()).addValue("redundancy_count", volume.getRedundancyCount()).addValue("is_arbiter", volume.getIsArbiter()); }
protected final void execute() { setCommandStatus(CommandStatus.ACTIVE); if ((getCallback()) != null) { persistCommand(getParameters().getParentCommand(), true); } getReturnValue().setCanDoAction(true); getReturnValue().setIsSyncronious(true); if ((!(hasTaskHandlers())) || ((getExecutionIndex()) == 0)) { org.ovirt.engine.core.bll.job.ExecutionHandler.addStep(getExecutionContext(), StepEnum.EXECUTING, null); } try { handleTransactivity(); org.ovirt.engine.core.utils.transaction.TransactionSupport.executeInScope(scope, this); } catch (javax.ejb.TransactionRolledbackLocalException e) { log.info("Transaction was aborted in '{}'", this.getClass().getName()); compensate(); } finally { try { if (getCommandShouldBeLogged()) { logCommand(); } if (getSucceeded()) { if (getCommandShouldBeLogged()) { logRenamedEntity(); } startPollingAsyncTasks(); } } finally { if ((noAsyncOperations()) && (!(org.ovirt.engine.core.bll.job.ExecutionHandler.checkIfJobHasTasks(getExecutionContext())))) { org.ovirt.engine.core.bll.job.ExecutionHandler.endJob(getExecutionContext(), getSucceeded()); } } } }
public static void setParameters(org.ovirt.engine.core.common.businessentities.CommandEntity commandEntity, org.ovirt.engine.core.common.action.VdcActionParametersBase params) { commandEntity.getData().put(org.ovirt.engine.core.bll.tasks.CommandEntityUtils.PARAMETERS_KEY, params); }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("Sync MoM Policy") java.lang.String updateMomPolicyClusterHost();
public void auditInvalidInterfaces(java.lang.String entityName) { if (!(invalidNetworkNames.isEmpty())) { org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase logable = new org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase(); logable.addCustomValue("EntityName", entityName); logable.addCustomValue("Networks", org.apache.commons.lang.StringUtils.join(invalidNetworkNames, ',')); logable.addCustomValue("Interfaces", org.apache.commons.lang.StringUtils.join(invalidIfaceNames, ',')); org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogDirector.log(logable, logType); } }
@java.lang.Override public void init(final org.ovirt.engine.ui.uicommonweb.models.clusters.ClusterModel model) { super.init(model); model.getPropertyChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener<org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs>() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs args) { java.lang.String propName = args.propertyName; if ("AllowClusterWithVirtGlusterEnabled".equals(propName)) { getView().allowClusterWithVirtGlusterEnabled(model.getAllowClusterWithVirtGlusterEnabled()); } } }); java.lang.String spiceProxyInConfig = ((java.lang.String) (org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().getConfigValuePreConverted(ConfigurationValues.SpiceProxyDefault))); java.lang.String spiceProxyMessage = (org.ovirt.engine.core.compat.StringHelper.isNullOrEmpty(spiceProxyInConfig)) ? messages.noSpiceProxyDefined() : spiceProxyInConfig; getView().setSpiceProxyOverrideExplanation(messages.consoleOverrideSpiceProxyMessage(messages.consoleOverrideDefinedInGlobalConfig(), spiceProxyMessage)); }
protected org.ovirt.engine.core.utils.ssh.SSHClient connect(java.lang.String serverName) { org.ovirt.engine.core.utils.ssh.SSHClient client = new org.ovirt.engine.core.utils.ssh.SSHClient(); java.lang.Integer timeout = (org.ovirt.engine.core.common.config.Config.<java.lang.Integer>GetValue(ConfigValues.ConnectToServerTimeoutInSeconds)) * 1000; client.setHardTimeout(timeout); client.setSoftTimeout(timeout); client.setHost(serverName, org.ovirt.engine.core.utils.gluster.GlusterUtil.SSH_PORT); try { client.connect(); return client; } catch (java.lang.Exception e) { log.debug(java.lang.String.format("Could not connect to server %1$s: %2$s", serverName, e.getMessage())); throw new java.lang.RuntimeException(e); } }
@java.lang.Override public org.ovirt.engine.core.vdsbroker.gluster.StorageDeviceListReturnForXmlRpc getStorageDeviceList() { org.ovirt.vdsm.jsonrpc.client.JsonRpcRequest request = new org.ovirt.vdsm.jsonrpc.client.RequestBuilder("GlusterHost.storageDevicesList").build(); java.util.Map<java.lang.String, java.lang.Object> response = new org.ovirt.engine.core.vdsbroker.jsonrpc.FutureMap(this.client, request).withResponseKey("deviceInfo"); return new org.ovirt.engine.core.vdsbroker.gluster.StorageDeviceListReturnForXmlRpc(response); }
protected final void updateNumaEnabledHelper() { boolean enabled = true; if (((((getModel().getMigrationMode().getSelectedItem()) != (org.ovirt.engine.core.common.businessentities.MigrationSupport.PINNED_TO_HOST)) || (getModel().getIsAutoAssign().getEntity())) || ((getModel().getDefaultHost().getSelectedItem()) == null)) || (!(getModel().getDefaultHost().getSelectedItem().isNumaSupport()))) { enabled = false; } if (enabled) { getModel().getNumaEnabled().setMessage(constants.numaInfoMessage()); } else { getModel().getNumaEnabled().setMessage(constants.numaDisabledInfoMessage()); getModel().getNumaNodeCount().setEntity(0); } getModel().getNumaEnabled().setEntity(enabled); }
private int getTotalHostsStat() { return org.ovirt.engine.core.bll.GetSystemStatisticsQuery.getDbFacade().getSystemStatisticsValue(org.ovirt.engine.core.bll.GetSystemStatisticsQuery.HOST_ENTITY_NAME); }
@java.lang.Override protected void setActionMessageParameters() { addCanDoActionMessage(EngineMessage.VAR__ACTION__CREATE); addCustomValue(GlusterConstants.VOLUME_SNAPSHOT_NAME, getParameters().getSnapshot().getSnapshotName()); super.setActionMessageParameters(); }
private org.ovirt.engine.api.model.GlusterBrick populateAdvancedDetails(org.ovirt.engine.api.model.GlusterBrick model, org.ovirt.engine.core.common.businessentities.gluster.GlusterBrickEntity entity) { org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity volumeEntity = getEntity(org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity.class, VdcQueryType.GetGlusterVolumeById, new org.ovirt.engine.core.common.queries.IdQueryParameters(entity.getVolumeId()), null, true); org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeAdvancedDetails detailsEntity = getEntity(org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeAdvancedDetails.class, VdcQueryType.GetGlusterVolumeAdvancedDetails, new org.ovirt.engine.core.common.queries.gluster.GlusterVolumeAdvancedDetailsParameters(volumeEntity.getClusterId(), volumeEntity.getName(), entity.getQualifiedName(), true), null, true); model = getMapper(org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeAdvancedDetails.class, org.ovirt.engine.api.model.GlusterBrick.class).map(detailsEntity, model); return model; }
public org.ovirt.engine.core.bll.ValidationResult isConnectionDoesNotExistForHostAndTarget(org.ovirt.engine.core.common.businessentities.storage.StorageServerConnectionExtension connExt) { org.ovirt.engine.core.common.businessentities.storage.StorageServerConnectionExtension existingConnExt = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getStorageServerConnectionExtensionDao().getByHostIdAndTarget(connExt.getHostId(), connExt.getIqn()); if ((existingConnExt != null) && (!(existingConnExt.getId().equals(connExt.getId())))) { org.ovirt.engine.core.common.businessentities.VDS host = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVdsDao().get(connExt.getHostId()); return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_STORAGE_CONNECTION_EXTENSION_ALREADY_EXISTS, java.lang.String.format(java.lang.String.format("$target %s", connExt.getIqn())), java.lang.String.format("$vdsName %s", host.getName())); } return org.ovirt.engine.core.bll.ValidationResult.VALID; }
public static void Init() { org.ovirt.engine.core.bll.VmTemplateHandler.mUpdateVmTemplate = new org.ovirt.engine.core.utils.ObjectIdentityChecker(org.ovirt.engine.core.bll.VmTemplateHandler.class); org.ovirt.engine.core.bll.VmTemplateHandler.BlankVmTemplateId = new org.ovirt.engine.core.compat.Guid("00000000-0000-0000-0000-000000000000"); org.ovirt.engine.core.bll.VmTemplateHandler.mUpdateVmTemplate.AddPermittedFields(new java.lang.String[]{ "name", "description", "domain", "os", "osType", "autoSuspend", "interfaces", "memSizeMb", "numOfSockets", "cpuPerSocket", "vdsGroupId", "numOfMonitors", "allowConsoleReconnect", "usbPolicy", "timeZone", "diskMap", "defaultBootSequence", "disabled", "isoPath", "diskImageMap", "defaultDisplayType", "priority", "autoStartup", "stateless", "initrdUrl", "kernelUrl", "kernelParams", "images", "interfaces", "quotaId", "quotaName", "quotaEnforcementType", "migrationSupport", "dedicatedVmForVds", "smartcardEnabled", "dbGeneration", "deleteProtected", "quotaDefault", "tunnelMigration", "vncKeyboardLayout" }); }
@org.ovirt.engine.ui.frontend.DefaultStringValue("Cannot ${action} ${type}. Sub Version of selected template (${subVersionId}) is being concurrently removed. Please wait and try again later.") java.lang.String ACTION_TYPE_FAILED_SUBVERSION_BEING_CONCURRENTLY_REMOVED();
@java.lang.Override protected boolean canDoAction() { final org.ovirt.engine.core.bll.validator.ClusterValidator validator = new org.ovirt.engine.core.bll.validator.ClusterValidator(org.ovirt.engine.core.bll.AddVdsGroupCommand.getDbFacade(), org.ovirt.engine.core.bll.AddVdsGroupCommand.getVdsGroup()); return (((((((((((((validate(validator.nameNotUsed())) && (validate(validator.cpuTypeSupportsVirtService()))) && (validate(validator.versionSupported()))) && (validate(validator.dataCenterVersionMismatch()))) && (validate(validator.dataCenterExists()))) && (validate(validator.localStoragePoolAttachedToSingleCluster()))) && (validate(validator.qosBaloonSupported()))) && (validate(validator.glusterServiceSupported()))) && (validate(validator.clusterServiceDefined()))) && (validate(validator.mixedClusterServicesSupported()))) && (validate(validator.attestationServerConfigured()))) && (validate(validator.migrationSupported(org.ovirt.engine.core.bll.AddVdsGroupCommand.getArchitecture())))) && (org.ovirt.engine.core.bll.AddVdsGroupCommand.validateClusterPolicy())) && (validate(validator.virtIoRngSupported())); }
@java.lang.Override protected void executeCommand() { org.ovirt.engine.core.common.vdscommands.VDSReturnValue vdsReturnValue = runVdsCommand(VDSCommandType.SetAmountOfMemory, new org.ovirt.engine.core.vdsbroker.SetAmountOfMemoryVDSCommand.Params(org.ovirt.engine.core.bll.HotSetAmountOfMemoryCommand.getVm().getRunOnVds(), org.ovirt.engine.core.bll.HotSetAmountOfMemoryCommand.getVm().getId(), createMemoryDevice())); if (vdsReturnValue.getSucceeded()) { org.ovirt.engine.core.bll.HotSetAmountOfMemoryCommand.setSucceeded(true); } else { org.ovirt.engine.core.common.errors.VdcFault fault = new org.ovirt.engine.core.common.errors.VdcFault(); fault.setError(vdsReturnValue.getVdsError().getCode()); fault.setMessage(vdsReturnValue.getVdsError().getMessage()); org.ovirt.engine.core.bll.HotSetAmountOfMemoryCommand.getReturnValue().setFault(fault); } }
public org.ovirt.engine.ui.uicommonweb.models.EntityModel<java.lang.String> getWarningLabel() { return warningLabel; }
private void addKernelCmdlineCheckboxesListeners() { getKernelCmdlineIommu().getEntityChangedEvent().addListener(this); getKernelCmdlineKvmNested().getEntityChangedEvent().addListener(this); getKernelCmdlineUnsafeInterrupts().getEntityChangedEvent().addListener(this); getKernelCmdlinePciRealloc().getEntityChangedEvent().addListener(this); }
@java.lang.Override public org.ovirt.engine.api.common.security.auth.Principal validate(java.lang.String sessionId) { org.ovirt.engine.api.common.security.auth.Principal principal = null; org.ovirt.engine.core.common.queries.VdcQueryParametersBase params = new org.ovirt.engine.core.common.queries.VdcQueryParametersBase(); params.setSessionId(sessionId); org.ovirt.engine.core.common.queries.VdcQueryReturnValue queryReturnValue = backend.RunPublicQuery(VdcQueryType.ValidateSession, params); if (queryReturnValue != null) { org.ovirt.engine.core.common.businessentities.DbUser user = queryReturnValue.getReturnValue(); if (user != null) { principal = new org.ovirt.engine.api.common.security.auth.Principal(user.getLoginName(), null, user.getDomain()); sessionHelper.setSessionId(sessionId); current.set(user); } } if (principal != null) { validateSessionSucceeded(queryReturnValue); } else { validateSessionFailed(queryReturnValue); } return principal; }
public void setForceLabel(java.lang.String forceLabel) { this.forceLabel = forceLabel; onPropertyChanged(new org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs("forceLabel")); }
@java.lang.Override public boolean equals(java.lang.Object obj) { if ((this) == obj) { return true; } if (obj == null) { return false; } if (!(obj instanceof org.ovirt.engine.core.common.businessentities.network.VnicProfile)) { return false; } org.ovirt.engine.core.common.businessentities.network.VnicProfile other = ((org.ovirt.engine.core.common.businessentities.network.VnicProfile) (obj)); if (!(org.ovirt.engine.core.common.utils.ObjectUtils.objectsEqual(getCustomProperties(), other.getCustomProperties()))) { return false; } if (!(org.ovirt.engine.core.common.utils.ObjectUtils.objectsEqual(getId(), other.getId()))) { return false; } if (!(org.ovirt.engine.core.common.utils.ObjectUtils.objectsEqual(getName(), other.getName()))) { return false; } if (!(org.ovirt.engine.core.common.utils.ObjectUtils.objectsEqual(getNetworkId(), other.getNetworkId()))) { return false; } if (!(org.ovirt.engine.core.common.utils.ObjectUtils.objectsEqual(getNetworkQosId(), other.getNetworkQosId()))) { return false; } if ((isPortMirroring()) != (other.isPortMirroring())) { return false; } if (!(org.ovirt.engine.core.common.utils.ObjectUtils.objectsEqual(getDescription(), other.getDescription()))) { return false; } return true; }
public void fillMetadataDevicesInfo(org.ovirt.engine.core.common.businessentities.StorageDomainStatic storageDomainStatic, org.ovirt.engine.core.compat.Guid vdsId) { try { @java.lang.SuppressWarnings("unchecked") org.ovirt.engine.core.common.businessentities.StorageDomainStatic domainFromIrs = ((org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.common.businessentities.StorageDomainStatic, org.ovirt.engine.core.compat.Guid>) (resourceManager.runVdsCommand(VDSCommandType.HSMGetStorageDomainInfo, new org.ovirt.engine.core.common.vdscommands.HSMGetStorageDomainInfoVDSCommandParameters(vdsId, storageDomainStatic.getId())).getReturnValue())).getFirst(); storageDomainStatic.setFirstMetadataDevice(domainFromIrs.getFirstMetadataDevice()); storageDomainStatic.setVgMetadataDevice(domainFromIrs.getVgMetadataDevice()); } catch (java.lang.Exception e) { storageDomainStatic.setFirstMetadataDevice(null); storageDomainStatic.setVgMetadataDevice(null); org.ovirt.engine.core.bll.storage.domain.BlockStorageDomainHelper.log.info("Failed to get the domain info"); } }
private boolean nicWithoutMacAddress(org.ovirt.engine.core.common.businessentities.network.VmNic vmNic) { return (vmNic.getMacAddress()) == null; }
@org.ovirt.engine.api.restapi.types.Mapping(from = org.ovirt.engine.core.common.businessentities.qos.QosBase.class, to = org.ovirt.engine.api.model.QoS.class) public static org.ovirt.engine.api.model.QoS map(org.ovirt.engine.core.common.businessentities.qos.QosBase entity, org.ovirt.engine.api.model.QoS template) { org.ovirt.engine.api.model.QoS model = (template != null) ? template : new org.ovirt.engine.api.model.QoS(); model.setId(entity.getId().toString()); model.setName(entity.getName()); model.setType(org.ovirt.engine.api.restapi.types.QosTypeMapper.qosTypeToString(entity.getQosType())); model.setDataCenter(new org.ovirt.engine.api.model.DataCenter()); model.getDataCenter().setId(entity.getStoragePoolId().toString()); model.setDescription(entity.getDescription()); org.ovirt.engine.api.restapi.types.QosMapper.mapQosTypeToModel(entity, model); return model; }
private void updateGraphicsDevice() { for (org.ovirt.engine.core.common.businessentities.GraphicsType type : org.ovirt.engine.core.bll.UpdateVmCommand.getParameters().getGraphicsDevices().keySet()) { org.ovirt.engine.core.common.businessentities.GraphicsDevice vmGraphicsDevice = getGraphicsDevOfType(type); if (vmGraphicsDevice == null) { if ((org.ovirt.engine.core.bll.UpdateVmCommand.getParameters().getGraphicsDevices().get(type)) != null) { org.ovirt.engine.core.bll.UpdateVmCommand.getParameters().getGraphicsDevices().get(type).setVmId(getVmId()); org.ovirt.engine.core.bll.UpdateVmCommand.getBackend().runInternalAction(VdcActionType.AddGraphicsDevice, new org.ovirt.engine.core.bll.GraphicsParameters(org.ovirt.engine.core.bll.UpdateVmCommand.getParameters().getGraphicsDevices().get(type))); } } else { if ((org.ovirt.engine.core.bll.UpdateVmCommand.getParameters().getGraphicsDevices().get(type)) == null) { org.ovirt.engine.core.bll.UpdateVmCommand.getBackend().runInternalAction(VdcActionType.RemoveGraphicsDevice, new org.ovirt.engine.core.bll.GraphicsParameters(vmGraphicsDevice)); } else { org.ovirt.engine.core.bll.UpdateVmCommand.getParameters().getGraphicsDevices().get(type).setVmId(getVmId()); org.ovirt.engine.core.bll.UpdateVmCommand.getBackend().runInternalAction(VdcActionType.UpdateGraphicsDevice, new org.ovirt.engine.core.bll.GraphicsParameters(org.ovirt.engine.core.bll.UpdateVmCommand.getParameters().getGraphicsDevices().get(type))); } } } }
protected void updateLiveStorageMigrationEnabled() { final org.ovirt.engine.core.common.businessentities.VM vm = getEntity(); org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().getDataCenterById(new org.ovirt.engine.ui.frontend.AsyncQuery(this, new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object target, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.models.vms.VmDiskListModel model = ((org.ovirt.engine.ui.uicommonweb.models.vms.VmDiskListModel) (target)); org.ovirt.engine.core.common.businessentities.StoragePool dataCenter = ((org.ovirt.engine.core.common.businessentities.StoragePool) (returnValue)); org.ovirt.engine.core.compat.Version dcCompatibilityVersion = ((dataCenter.getCompatibilityVersion()) != null) ? dataCenter.getCompatibilityVersion() : new org.ovirt.engine.core.compat.Version(); org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().isCommandCompatible(new org.ovirt.engine.ui.frontend.AsyncQuery(model, new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object target, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.models.vms.VmDiskListModel model = ((org.ovirt.engine.ui.uicommonweb.models.vms.VmDiskListModel) (target)); model.setIsLiveStorageMigrationEnabled(((java.lang.Boolean) (returnValue))); } }), VdcActionType.LiveMigrateVmDisks, vm.getCompatibilityVersion(), dcCompatibilityVersion); } }), vm.getStoragePoolId()); }
@java.lang.Override protected java.util.Map<java.lang.String, org.ovirt.engine.core.common.utils.Pair<java.lang.String, java.lang.String>> getExclusiveLocks() { return java.util.Collections.singletonMap(org.ovirt.engine.core.bll.hostdeploy.InstallVdsInternalCommand.getParameters().getVdsId().toString(), org.ovirt.engine.core.bll.LockMessagesMatchUtil.makeLockingPair(LockingGroup.VDS, EngineMessage.ACTION_TYPE_FAILED_OBJECT_LOCKED)); }
public org.ovirt.engine.core.bll.ValidationResult isCompatibleWithOs() { java.util.List<java.lang.String> networkDevices = getOsRepository().getNetworkDevices(osId, version); java.util.List<org.ovirt.engine.core.common.businessentities.network.VmInterfaceType> interfaceTypes = new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.network.VmInterfaceType>(); for (java.lang.String networkDevice : networkDevices) { interfaceTypes.add(org.ovirt.engine.core.common.businessentities.network.VmInterfaceType.valueOf(networkDevice)); } return !(interfaceTypes.contains(org.ovirt.engine.core.common.businessentities.network.VmInterfaceType.forValue(nic.getType()))) ? new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.VdcBllMessages.ACTION_TYPE_FAILED_VM_INTERFACE_TYPE_IS_NOT_SUPPORTED_BY_OS) : org.ovirt.engine.core.bll.ValidationResult.VALID; }
@java.lang.Override public java.lang.String renderNullSafe(org.ovirt.engine.core.common.businessentities.StoragePool dc) { return dc.getName(); }
@java.lang.Override protected void executeCommand() { getDbFacade().getDiskProfileDao().remove(getParameters().getProfileId()); setSucceeded(true); }
@java.lang.Override protected void setActionMessageParameters() { addValidationMessageVariable("volumeName", org.ovirt.engine.core.bll.gluster.GlusterAsyncCommandBase.getGlusterVolumeName()); addValidationMessageVariable("vdsGroup", org.ovirt.engine.core.bll.gluster.GlusterAsyncCommandBase.getVdsGroupName()); }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.VDS> filter(java.util.List<org.ovirt.engine.core.common.businessentities.VDS> hosts, org.ovirt.engine.core.common.businessentities.VM vm, java.util.Map<java.lang.String, java.lang.String> parameters, org.ovirt.engine.core.common.scheduling.PerHostMessages messages) { if (vm.isHostedEngine()) { java.util.List<org.ovirt.engine.core.common.businessentities.VDS> hostsToRunOn = new java.util.ArrayList<>(); for (org.ovirt.engine.core.common.businessentities.VDS host : hosts) { int haScore = host.getHighlyAvailableScore(); if (haScore > 0) { hostsToRunOn.add(host); org.ovirt.engine.core.bll.scheduling.policyunits.HostedEngineHAClusterFilterPolicyUnit.log.debug("Host '{}' wasn't filtered out as it has a score of {}", host.getName(), haScore); } else { org.ovirt.engine.core.bll.scheduling.policyunits.HostedEngineHAClusterFilterPolicyUnit.log.debug("Host '{}' was filtered out as it doesn't have a positive score (the score is {})", host.getName(), haScore); messages.addMessage(host.getId(), EngineMessage.VAR__DETAIL__NOT_HE_HOST.name()); } } return hostsToRunOn; } else { return hosts; } }
public static boolean CommonNetworkValidation(final org.ovirt.engine.core.common.businessentities.Network network, java.util.ArrayList<java.lang.String> canDoActionMessages) { if ((network.getstorage_pool_id()) != null) { java.util.List<org.ovirt.engine.core.common.businessentities.VDSGroup> groups = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVdsGroupDAO().getAllForStoragePool(network.getstorage_pool_id().getValue()); for (org.ovirt.engine.core.common.businessentities.VDSGroup cluster : groups) { java.util.List<org.ovirt.engine.core.common.businessentities.Network> networks = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getNetworkDAO().getAllForCluster(cluster.getId()); if (null != (org.ovirt.engine.core.utils.linq.LinqUtils.firstOrNull(networks, new org.ovirt.engine.core.utils.linq.Predicate<org.ovirt.engine.core.common.businessentities.Network>() { @java.lang.Override public boolean eval(org.ovirt.engine.core.common.businessentities.Network n) { return n.getname().equals(network.getname()); } }))) { canDoActionMessages.add(VdcBllMessages.NETWORK_CLUSTER_NETWORK_IN_USE.toString()); return false; } } } return true; }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("disk_type=") java.lang.String diskTypeSearchPrefix();
@java.lang.Override public org.ovirt.engine.core.vdsbroker.gluster.GlusterVolumeStatusReturnForXmlRpc glusterVolumeStatus(org.ovirt.engine.core.compat.Guid clusterId, java.lang.String volumeName, java.lang.String brickName, java.lang.String volumeStatusOption) { org.ovirt.vdsm.jsonrpc.client.JsonRpcRequest request = new org.ovirt.vdsm.jsonrpc.client.RequestBuilder("GlusterVolume.status").withParameter("volumeName", volumeName).withParameter("brick", brickName).withParameter("statusOption", volumeStatusOption).build(); java.util.Map<java.lang.String, java.lang.Object> response = new org.ovirt.engine.core.vdsbroker.jsonrpc.FutureMap(this.client, request).withIgnoreResponseKey(); return new org.ovirt.engine.core.vdsbroker.gluster.GlusterVolumeStatusReturnForXmlRpc(clusterId, response); }
public void auditClientIpChange() { final org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase event = new org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase(); event.setVmId(dbVm.getId()); event.setUserName(dbVm.getConsoleCurentUserName()); java.lang.String clientIp = vdsmVm.getVmDynamic().getClientIp(); auditLogDirector.log(event, ((clientIp == null) || (clientIp.isEmpty()) ? org.ovirt.engine.core.common.AuditLogType.VM_CONSOLE_DISCONNECTED : org.ovirt.engine.core.common.AuditLogType.VM_CONSOLE_CONNECTED)); }
public org.ovirt.engine.core.bll.ValidationResult validateUniqueId() { if ((org.apache.commons.lang.StringUtils.isBlank(vds.getUniqueId())) && (org.ovirt.engine.core.common.config.Config.<java.lang.Boolean>getValue(ConfigValues.InstallVds))) { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.VDS_NO_UUID); } return ValidationResult.VALID; }
@java.lang.Override public java.lang.String getValue(org.ovirt.engine.core.common.scheduling.AffinityGroup group) { java.lang.String hostNames = java.lang.String.join(", ", getHostNames(group)); if (hostNames.isEmpty()) { return org.ovirt.engine.ui.webadmin.section.main.view.tab.AbstractSubTabAffinityGroupsView.constants.noMembersAffinityGroup(); } return hostNames; }
public static void proceedLUNInDb(final org.ovirt.engine.core.common.businessentities.storage.LUNs lun, org.ovirt.engine.core.common.businessentities.storage.StorageType storageType) { org.ovirt.engine.core.bll.storage.domain.StorageDomainCommandBase.proceedLUNInDb(lun, storageType, ""); }
@java.lang.Override public int compare(org.ovirt.engine.core.common.businessentities.event_subscriber o1, org.ovirt.engine.core.common.businessentities.event_subscriber o2) { return lexoNumericComparator.compare(o1.getevent_up_name(), o2.getevent_up_name()); }
@org.ovirt.engine.ui.uicompat.DefaultMessage("Error connecting to {0} using {1} protocol") java.lang.String errorConnectingToConsole(java.lang.String name, java.lang.String s);
@java.lang.Override protected boolean canDoAction() { if ((org.ovirt.engine.core.bll.CreateAllSnapshotsFromVmCommand.getVm()) == null) { addCanDoActionMessage(VdcBllMessages.ACTION_TYPE_FAILED_VM_NOT_FOUND); return false; } if (!(org.ovirt.engine.core.bll.CreateAllSnapshotsFromVmCommand.canRunActionOnNonManagedVm())) { return false; } if (!(isSpecifiedDisksExist(getParameters().getDisks()))) { return false; } org.ovirt.engine.core.bll.validator.VmValidator vmValidator = createVmValidator(); org.ovirt.engine.core.bll.snapshots.SnapshotsValidator snapshotValidator = createSnapshotValidator(); org.ovirt.engine.core.bll.validator.storage.StoragePoolValidator spValidator = createStoragePoolValidator(); if (!((((((((validateVM(vmValidator)) && (validate(spValidator.isUp()))) && (validate(vmValidator.vmNotIlegal()))) && (validate(vmValidator.vmNotLocked()))) && (validate(snapshotValidator.vmNotDuringSnapshot(org.ovirt.engine.core.bll.CreateAllSnapshotsFromVmCommand.getVmId())))) && (validate(snapshotValidator.vmNotInPreview(org.ovirt.engine.core.bll.CreateAllSnapshotsFromVmCommand.getVmId())))) && (validate(vmValidator.vmNotDuringMigration()))) && (validate(vmValidator.vmNotRunningStateless())))) { return false; } return validateStorage(); }
@org.junit.Test public void testIsDomainExistAndActiveDomainNotExists() { validator = new org.ovirt.engine.core.bll.validator.storage.StorageDomainValidator(null); assertEquals("Wrong failure for null domain", EngineMessage.ACTION_TYPE_FAILED_STORAGE_DOMAIN_NOT_EXIST, validator.isDomainExistAndActive().getMessage()); }
@java.lang.Override public org.ovirt.engine.core.bll.ValidationResult vmNotInPreview(org.ovirt.engine.core.compat.Guid vmId) { if (vmInPreview) { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_VM_IN_PREVIEW); } return org.ovirt.engine.core.bll.ValidationResult.VALID; }
private void initListBoxEditors() { raidTypeEditor = new org.ovirt.engine.ui.common.widget.editor.ListModelListBoxEditor(new org.ovirt.engine.ui.common.widget.renderer.EnumRenderer<org.ovirt.engine.core.common.businessentities.RaidType>()); cacheDevicePathEditor = new org.ovirt.engine.ui.common.widget.editor.ListModelListBoxEditor(new org.ovirt.engine.ui.common.widget.renderer.NameRenderer<org.ovirt.engine.core.common.businessentities.gluster.StorageDevice>()); cacheModeEditor = new org.ovirt.engine.ui.common.widget.editor.ListModelListBoxEditor(new org.ovirt.engine.ui.common.widget.renderer.EnumRenderer<org.ovirt.engine.core.common.businessentities.CacheModeType>()); }
@java.lang.Override public void executeCommand(org.ovirt.engine.ui.uicommonweb.UICommand command) { super.executeCommand(command); if (command == (getNewCommand())) { newSubnet(); } else if (command == (getRemoveCommand())) { remove(); } }
@java.lang.SuppressWarnings("unchecked") @java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.vm_pools> getAllForUser(org.ovirt.engine.core.compat.Guid userid) { java.util.List<org.ovirt.engine.core.common.businessentities.vm_pools> result = new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.vm_pools>(); org.hibernate.Query query = getSession().createQuery("from DbUser where id = :user_id"); query.setParameter("user_id", userid); org.ovirt.engine.core.common.businessentities.DbUser user = ((org.ovirt.engine.core.common.businessentities.DbUser) (query.uniqueResult())); if (user != null) { org.hibernate.Criteria criteria = getSession().createCriteria(org.ovirt.engine.core.common.businessentities.LdapGroup.class).add(org.hibernate.criterion.Restrictions.in("name", org.ovirt.engine.core.dao.VmPoolDAOHibernateImpl.splitApartNames(user.getgroups()))); java.util.List<org.ovirt.engine.core.common.businessentities.LdapGroup> adElements = criteria.list(); org.ovirt.engine.core.compat.Guid[] ids = new org.ovirt.engine.core.compat.Guid[(adElements.size()) + 1]; ids[0] = userid; for (int index = 0; index < (adElements.size()); index++) { ids[(index + 1)] = adElements.get(index).getid(); } query = getSession().createQuery(("select pool " + (((("from vm_pools pool, permissions perms, roles role " + "where pool.id = perms.objectId ") + "and perms.adElementId in ( :adElements ) ") + "and perms.roleId = role.id ") + "and role.type = 2"))); query.setParameterList("adElements", ids); result = query.list(); } return result; }
private boolean isNewServer(org.ovirt.engine.core.compat.Guid serverId, org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity volumeBeforeBrickAdd) { java.util.List<org.ovirt.engine.core.common.businessentities.gluster.GlusterBrickEntity> bricks = volumeBeforeBrickAdd.getBricks(); for (org.ovirt.engine.core.common.businessentities.gluster.GlusterBrickEntity currentBrick : bricks) { if (currentBrick.getServerId().equals(serverId)) { return false; } } return true; }
@java.lang.Override protected void executeQueryCommand() { org.ovirt.engine.core.bll.GetAllStoragePoolsQuery.getQueryReturnValue().setReturnValue(org.ovirt.engine.core.bll.GetAllStoragePoolsQuery.getDbFacade().getStoragePoolDAO().getAll(org.ovirt.engine.core.bll.GetAllStoragePoolsQuery.getUserID(), org.ovirt.engine.core.bll.GetAllStoragePoolsQuery.getParameters().isFiltered())); }
public static void runAndAssertCanDoActionSuccess(org.ovirt.engine.core.bll.CommandBase<?> command) { boolean canDoAction = command.canDoAction(); assertTrue(java.text.MessageFormat.format("Command''s canDoAction expected to succeed, but failed, messages are: {0}", command.getReturnValue().getCanDoActionMessages()), canDoAction); }
private java.util.List<org.ovirt.engine.core.common.businessentities.VDS> runExternalFilters(java.util.ArrayList<org.ovirt.engine.core.bll.scheduling.PolicyUnitImpl> filters, java.util.List<org.ovirt.engine.core.common.businessentities.VDS> hostList, org.ovirt.engine.core.common.businessentities.VM vm, java.util.Map<java.lang.String, java.lang.String> parameters, java.util.List<java.lang.String> messages, java.lang.String correlationId, org.ovirt.engine.core.bll.scheduling.SchedulingManager.SchedulingResult result) { java.util.List<org.ovirt.engine.core.compat.Guid> filteredIDs = null; if (filters != null) { java.util.List<java.lang.String> filterNames = new java.util.ArrayList<java.lang.String>(); for (org.ovirt.engine.core.bll.scheduling.PolicyUnitImpl filter : filters) { filterNames.add(filter.getName()); } java.util.List<org.ovirt.engine.core.compat.Guid> hostIDs = new java.util.ArrayList<org.ovirt.engine.core.compat.Guid>(); for (org.ovirt.engine.core.common.businessentities.VDS host : hostList) { hostIDs.add(host.getId()); } filteredIDs = org.ovirt.engine.core.bll.scheduling.external.ExternalSchedulerFactory.getInstance().runFilters(filterNames, hostIDs, vm.getId(), parameters); if (filteredIDs != null) { logFilterActions(hostList, new java.util.HashSet<org.ovirt.engine.core.compat.Guid>(filteredIDs), VdcBllMessages.VAR__FILTERTYPE__EXTERNAL, java.util.Arrays.toString(filterNames.toArray()), result, correlationId); } } return intersectHosts(hostList, filteredIDs); }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("total") java.lang.String total();
@java.lang.Override protected void Connect() { if ((getEntity()) != null) { getLogger().Debug("Connecting to Spice console..."); if (!(getspice().getIsInstalled())) { getLogger().Info("Spice client is not installed."); getspice().Install(); return; } if ((getConfigurator().getIsAdmin()) && ((getspice().getCurrentVersion().compareTo(getspice().getDesiredVersion())) < 0)) { getLogger().Info((("Spice client version is not as desired (" + (getspice().getDesiredVersion())) + ")")); getspice().Install(); return; } if ((getEntity().getRunOnVds()) == null) { return; } if ((!(getEntity().getVmOs().isWindows())) || (!(getEntity().getHasSpiceDriver()))) { getspice().setIsWanOptionsEnabled(false); } org.ovirt.engine.ui.uicommonweb.UICommand setVmTicketCommand = new org.ovirt.engine.ui.uicommonweb.UICommand("setVmCommand", new org.ovirt.engine.ui.uicommonweb.BaseCommandTarget() { @java.lang.Override public void ExecuteCommand(org.ovirt.engine.ui.uicommonweb.UICommand uiCommand) { setVmTicket(); } }); executeCommandWithConsoleSafenessWarning(setVmTicketCommand); } }
private boolean checkCanPerformRegularUpdate() { if ((oldDisk.getDiskInterface()) != (newDisk.getDiskInterface())) { java.util.List<org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface> allVmInterfaces = org.ovirt.engine.core.bll.UpdateVmDiskCommand.getVmNetworkInterfaceDao().getAllForVm(org.ovirt.engine.core.bll.UpdateVmDiskCommand.getVmId()); java.util.List<org.ovirt.engine.core.common.businessentities.Disk> allVmDisks = new java.util.LinkedList<org.ovirt.engine.core.common.businessentities.Disk>(getOtherVmDisks()); allVmDisks.add(newDisk); if (!(checkPciAndIdeLimit(org.ovirt.engine.core.bll.UpdateVmDiskCommand.getVm().getNumOfMonitors(), allVmInterfaces, allVmDisks, org.ovirt.engine.core.bll.UpdateVmDiskCommand.getReturnValue().getCanDoActionMessages()))) { return false; } } if (newDisk.isBoot()) { org.ovirt.engine.core.bll.VmHandler.updateDisksForVm(org.ovirt.engine.core.bll.UpdateVmDiskCommand.getVm(), getOtherVmDisks()); if (!(isDiskCanBeAddedToVm(newDisk))) { return false; } } org.ovirt.engine.core.bll.ImagesHandler.setDiskAlias(newDisk, org.ovirt.engine.core.bll.UpdateVmDiskCommand.getVm()); return validateShareableDisk(); }
@java.lang.Override public java.lang.String toString() { return java.lang.String.format("%s, storageType=%s", super.toString(), getStorageType()); }
public void setSnapshotAction(org.ovirt.engine.core.common.businessentities.SnapshotActionEnum snapshotAction) { this.snapshotAction = snapshotAction; }
@java.lang.Override org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.common.businessentities.VM, org.ovirt.engine.core.vdsbroker.monitoring.VdsmVm> build() { return createHANotRunningAndUknown(); }
org.ovirt.engine.ui.common.uicommon.model.DetailModelProvider<org.ovirt.engine.ui.uicommonweb.models.vms.VmListModel<java.lang.Void>, org.ovirt.engine.ui.uicommonweb.models.vms.VmGuestInfoModel> getSubTabVirtualMachineGuestInfoModelProvider();
private org.ovirt.engine.core.common.businessentities.network.NetworkFilter resolveVnicProfileDefaultNetworkFilter() { if (org.ovirt.engine.core.common.config.Config.<java.lang.Boolean>getValue(ConfigValues.EnableMACAntiSpoofingFilterRules)) { return networkFilterDao.getNetworkFilterByName(NetworkFilter.VDSM_NO_MAC_SPOOFING); } return null; }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Brick Directory should be at least 2 characters") java.lang.String invalidBrickDirectoryAtleastTwoCharacterseMsg();
public void initialize(org.ovirt.engine.ui.uicommonweb.models.SystemTreeItemModel SystemTreeSelectedItem) { super.initialize(); setHash(((getHashName()) + (new java.util.Date()))); getMemSize().setEntity(256); getMinAllocatedMemory().setEntity(256); getIsStateless().setEntity(false); getIsRunAndPause().setEntity(false); getIsSmartcardEnabled().setEntity(false); isConsoleDeviceEnabled.setEntity(false); getIsHighlyAvailable().setEntity(false); getIsAutoAssign().setEntity(true); getIsTemplatePublic().setEntity(true); getBehavior().enableSinglePCI(false); getHostCpu().setEntity(false); getMigrationMode().setIsChangable(true); getCdImage().setIsChangable(false); initOSType(); initDisplayProtocol(); initFirstBootDevice(); initNumOfMonitors(); initAllowConsoleReconnect(); initMinimalVmMemSize(); initMaximalVmMemSize32OS(); initMigrationMode(); initVncKeyboardLayout(); behavior.initialize(SystemTreeSelectedItem); }
@org.junit.Test public void testRemoveNonExistant() throws java.lang.Exception { setUpEntityQueryExpectations(VdcQueryType.GetNetworksByStoragePoolId, org.ovirt.engine.core.common.queries.StorageDomainAndPoolQueryParameters.class, new java.lang.String[]{ "StoragePoolId" }, new java.lang.Object[]{ org.ovirt.engine.api.restapi.resource.BackendDataCenterNetworksResourceTest.DATA_CENTER_ID }, new java.util.LinkedList<org.ovirt.engine.core.common.businessentities.network.Network>(), null); control.replay(); try { collection.remove(org.ovirt.engine.api.restapi.resource.NON_EXISTANT_GUID.toString()); fail("expected WebApplicationException"); } catch (javax.ws.rs.WebApplicationException wae) { assertNotNull(wae.getResponse()); assertEquals(404, wae.getResponse().getStatus()); } }
private static org.ovirt.engine.api.rsdl.ServiceTreeNode buildNode(java.lang.Class<?> resource, java.lang.String path) { return new org.ovirt.engine.api.rsdl.ServiceTreeNode.Builder().name(resource.getSimpleName()).path(path).subCollections(org.ovirt.engine.api.rsdl.ServiceTree.getSubServices(resource)).actions(org.ovirt.engine.api.rsdl.ServiceTree.getActions(resource)).build(); }
public void edit() { T qos = ((T) (org.ovirt.engine.ui.uicommonweb.models.datacenters.qos.DataCenterQosListModel.getSelectedItem())); if ((org.ovirt.engine.ui.uicommonweb.models.datacenters.qos.DataCenterQosListModel.getWindow()) != null) { return; } final org.ovirt.engine.ui.uicommonweb.models.datacenters.qos.EditQosModel<T, P> qosModel = getEditQosModel(qos); setWindow(qosModel); qosModel.getDataCenters().setItems(java.util.Arrays.asList(getEntity()), getEntity()); }
@java.lang.Override protected void setActionMessageParameters() { super.setActionMessageParameters(); addCanDoActionMessage(EngineMessage.VAR__ACTION__DESTROY_DOMAIN); }
private void generateEnumWriter(org.ovirt.api.metamodel.concepts.EnumType type) { javaBuffer = new org.ovirt.api.metamodel.tool.JavaClassBuffer(); org.ovirt.api.metamodel.tool.JavaClassName writerName = javaTypes.getXmlWriterName(type); javaBuffer.setClassName(writerName); generateEnumWriterSource(type); try { javaBuffer.write(outDir); } catch (java.io.IOException exception) { throw new java.lang.RuntimeException((("Can\'t write file for XML writer \"" + writerName) + "\""), exception); } }
@java.lang.Override public org.ovirt.engine.core.common.businessentities.VDS get(org.ovirt.engine.core.compat.Guid id, org.ovirt.engine.core.compat.Guid userID, boolean isFiltered) { java.util.List<org.ovirt.engine.core.common.businessentities.VDS> vdsList = getCallsHandler().executeReadList("GetVdsByVdsId", org.ovirt.engine.core.dao.VdsDaoImpl.VdsRowMapper.instance, getCustomMapSqlParameterSource().addValue("vds_id", id).addValue("user_id", userID).addValue("is_filtered", isFiltered)); return (vdsList.size()) == 0 ? null : uniteAgentsSingleVds(vdsList); }
private void updateAffinityLabels() { java.util.List<org.ovirt.engine.core.common.businessentities.Label> affinityLabels = org.ovirt.engine.core.bll.UpdateVmCommand.getParameters().getAffinityLabels(); java.util.List<org.ovirt.engine.core.compat.Guid> labelIds = affinityLabels.stream().map(Label::getId).collect(java.util.stream.Collectors.toList()); labelDao.updateLabelsForVm(getVmId(), labelIds); }
@java.lang.Override public void onSuccess(java.lang.Object target, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel model = ((org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel) (target)); org.ovirt.engine.core.common.businessentities.VmTemplate template = ((org.ovirt.engine.core.common.businessentities.VmTemplate) (returnValue)); if (useLatest) { template = createLatestTemplate(template); } setupBaseTemplate(template.getBaseTemplateId()); model.getTemplate().setItems(java.util.Collections.singletonList(template)); model.getTemplate().setSelectedItem(template); model.getTemplate().setIsChangable(false); if (!(template.getId().equals(Guid.Empty))) { getModel().getVmInitModel().init(template); } }
private org.ovirt.engine.core.common.vdscommands.VDSFenceReturnValue fence(org.ovirt.engine.core.common.businessentities.FenceAgent fenceAgent, int retries) { org.ovirt.engine.core.bll.FenceExecutor fenceExecutor = createFenceExecutor(); org.ovirt.engine.core.common.vdscommands.VDSFenceReturnValue fenceExecutionResult = fenceExecutor.fence(getAction(), fenceAgent); if (wasSkippedDueToStatus(fenceExecutionResult)) { log.info("Attemp to {} host using fence agent '{}' skipped, host is already at the requested state.", getAction().name().toLowerCase(), fenceAgent.getId()); } else if (wasSkippedDueToPolicy(fenceExecutionResult)) { return fenceExecutionResult; } else { if (fenceExecutionResult.getSucceeded()) { boolean requiredStatusAchieved = waitForStatus(); int i = 0; while ((!requiredStatusAchieved) && (i < retries)) { fenceExecutionResult = fenceExecutor.fence(getAction(), fenceAgent); requiredStatusAchieved = waitForStatus(); i++; } if (requiredStatusAchieved) { handleSpecificCommandActions(); } else { auditFailure(); } fenceExecutionResult.setSucceeded(requiredStatusAchieved); } else { logAgentFailure(fenceExecutionResult); } } return fenceExecutionResult; }
@java.lang.Override public void onFailure(final org.ovirt.engine.ui.frontend.communication.VdcOperation<org.ovirt.engine.core.common.action.VdcActionType, org.ovirt.engine.core.common.action.VdcActionParametersBase> operation, final java.lang.Throwable caught) { if (ignoreFailure(caught)) { return; } org.ovirt.engine.ui.frontend.Frontend.logger.log(java.util.logging.Level.SEVERE, ("Failed to execute runAction: " + caught), caught); failureEventHandler(caught); org.ovirt.engine.ui.uicompat.FrontendActionAsyncResult f = new org.ovirt.engine.ui.uicompat.FrontendActionAsyncResult(actionType, parameters, null, state); if (callback != null) { callback.executed(f); } fireAsyncOperationCompleteEvent(state); }
@com.gwtplatform.mvp.client.annotations.TabInfo(container = org.ovirt.engine.ui.webadmin.section.main.presenter.tab.pool.PoolSubTabPanelPresenter.class) static com.gwtplatform.mvp.client.TabData getTabData() { return new org.ovirt.engine.ui.common.uicommon.model.GroupedTabData(org.ovirt.engine.ui.webadmin.section.main.presenter.tab.pool.SubTabPoolPermissionPresenter.constants.poolPermissionSubTabLabel(), 2); }
@java.lang.Override protected void setActionMessageParameters() { addCanDoActionMessage(VdcBllMessages.VAR__ACTION__ATTACH); addCanDoActionMessage(VdcBllMessages.VAR__TYPE__STORAGE__CONNECTION); }
@java.lang.Override public int hashCode() { final int prime = 31; int result = 1; result = (prime * result) + ((id.tagId) == null ? 0 : id.tagId.hashCode()); result = (prime * result) + ((id.templateId) == null ? 0 : id.templateId.hashCode()); result = (prime * result) + ((defaultDisplayType) == null ? 0 : defaultDisplayType.hashCode()); return result; }
private void updateFunctions(org.ovirt.engine.ui.uicommonweb.models.configure.scheduling.NewClusterPolicyModel model) { org.ovirt.engine.ui.webadmin.section.main.view.popup.scheduling.panels.FunctionPolicyUnitPanel functionPolicyUnitPanel; usedFunctionPanel.clear(); for (org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.common.scheduling.PolicyUnit, java.lang.Integer> pair : model.getUsedFunctions()) { functionPolicyUnitPanel = new org.ovirt.engine.ui.webadmin.section.main.view.popup.scheduling.panels.FunctionPolicyUnitPanel(pair.getFirst(), model, true, model.getClusterPolicy().isLocked(), pair.getSecond()); usedFunctionPanel.add(functionPolicyUnitPanel); functionPolicyUnitPanel.initWidget(); } unusedFunctionPanel.clear(); for (org.ovirt.engine.core.common.scheduling.PolicyUnit policyUnit : model.getUnusedFunctions()) { functionPolicyUnitPanel = new org.ovirt.engine.ui.webadmin.section.main.view.popup.scheduling.panels.FunctionPolicyUnitPanel(policyUnit, model, false, false, null); unusedFunctionPanel.add(functionPolicyUnitPanel); functionPolicyUnitPanel.initWidget(); } }
private void updatePassDiscardAvailability() { if (!(org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().isPassDiscardFeatureSupported(getDataCenter().getSelectedItem().getCompatibilityVersion()))) { getPassDiscard().setIsAvailable(false); return; } if (getIsFloating()) { getPassDiscard().setIsAvailable(false); } else { org.ovirt.engine.core.common.businessentities.storage.DiskInterface selectedInterface = getDiskInterface().getSelectedItem(); org.ovirt.engine.core.common.businessentities.storage.DiskStorageType selectedDiskStorageType = getDiskStorageType().getEntity(); boolean isApplicableInterface = (selectedInterface == (org.ovirt.engine.core.common.businessentities.storage.DiskInterface.VirtIO_SCSI)) || (selectedInterface == (org.ovirt.engine.core.common.businessentities.storage.DiskInterface.IDE)); boolean isApplicableDiskStorageType = (selectedDiskStorageType == (org.ovirt.engine.core.common.businessentities.storage.DiskStorageType.LUN)) || (selectedDiskStorageType == (org.ovirt.engine.core.common.businessentities.storage.DiskStorageType.IMAGE)); boolean isApplicableStorageType = (selectedDiskStorageType == (org.ovirt.engine.core.common.businessentities.storage.DiskStorageType.LUN)) || (((getStorageDomain().getSelectedItem()) != null) && (getStorageDomain().getSelectedItem().getStorageType().isInternal())); if ((isApplicableInterface && isApplicableDiskStorageType) && isApplicableStorageType) { getPassDiscard().setIsAvailable(true); if (!(getIsNew())) { getPassDiscard().setEntity(getDiskVmElement().isPassDiscard()); } } else { getPassDiscard().setIsAvailable(false); getPassDiscard().setEntity(false); } } }
@org.junit.Test public void readOnlyIsNotSupportedByDiskInterface() { disk.setReadOnly(true); disk.setDiskInterface(DiskInterface.IDE); assertThat(validator.isReadOnlyPropertyCompatibleWithInterface(), org.ovirt.engine.core.bll.validator.ValidationResultMatchers.failsWith(VdcBllMessages.ACTION_TYPE_FAILED_IDE_INTERFACE_DOES_NOT_SUPPORT_READ_ONLY_ATTR)); }
@javax.validation.constraints.NotNull private java.util.List<org.ovirt.engine.core.common.businessentities.VDS> runExternalFilters(@javax.validation.constraints.NotNull java.util.ArrayList<org.ovirt.engine.core.bll.scheduling.PolicyUnitImpl> filters, @javax.validation.constraints.NotNull java.util.List<org.ovirt.engine.core.common.businessentities.VDS> hostList, @javax.validation.constraints.NotNull org.ovirt.engine.core.common.businessentities.VM vm, @javax.validation.constraints.NotNull java.util.Map<java.lang.String, java.lang.String> parameters, @javax.validation.constraints.NotNull java.util.List<java.lang.String> messages, @javax.validation.constraints.NotNull java.lang.String correlationId, @javax.validation.constraints.NotNull org.ovirt.engine.core.bll.scheduling.SchedulingManager.SchedulingResult result) { java.util.List<org.ovirt.engine.core.compat.Guid> hostIDs = hostList.stream().map(VDS::getId).collect(java.util.stream.Collectors.toList()); java.util.List<java.lang.String> filterNames = filters.stream().filter(( f) -> !(f.getPolicyUnit().isInternal())).map(( f) -> f.getPolicyUnit().getName()).collect(java.util.stream.Collectors.toList()); java.util.List<org.ovirt.engine.core.compat.Guid> filteredIDs = externalBroker.runFilters(filterNames, hostIDs, vm.getId(), parameters); logFilterActions(hostList, new java.util.HashSet(filteredIDs), EngineMessage.VAR__FILTERTYPE__EXTERNAL, java.util.Arrays.toString(filterNames.toArray()), result, correlationId); hostList = intersectHosts(hostList, filteredIDs); return hostList; }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Content must be Base64") java.lang.String cloudInitBase64Message();
public void addJob(org.ovirt.engine.core.common.businessentities.VmJob job) { getVmJobDao().save(job); jobsRepository.put(job.getId(), job); org.ovirt.engine.core.vdsbroker.monitoring.VmJobsMonitoring.log.info("Stored placeholder for job id '{}'", job.getId()); }
private int getActiveHostsStat() { java.lang.String[] activeVdsStatuses = new java.lang.String[]{ java.lang.String.valueOf(VDSStatus.Up.getValue()), java.lang.String.valueOf(VDSStatus.PreparingForMaintenance.getValue()) }; return org.ovirt.engine.core.bll.GetSystemStatisticsQuery.getDbFacade().getSystemStatisticsValue(org.ovirt.engine.core.bll.GetSystemStatisticsQuery.HOST_ENTITY_NAME, org.apache.commons.lang.StringUtils.join(activeVdsStatuses, org.ovirt.engine.core.bll.GetSystemStatisticsQuery.COMMA_DELIMITER)); }
@java.lang.Override public void OnSuccess(java.lang.Object target, java.lang.Object returnValue) { final org.ovirt.engine.ui.uicommonweb.models.vms.ExportVmModel model = ((org.ovirt.engine.ui.uicommonweb.models.vms.ExportVmModel) (target)); @java.lang.SuppressWarnings("unchecked") final java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Disk> diskList = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Disk>) (returnValue)); final java.util.List<java.lang.String> list = new java.util.ArrayList<java.lang.String>(); for (org.ovirt.engine.core.common.businessentities.Disk disk : diskList) { if (!(disk.isAllowSnapshot())) { list.add(disk.getDiskAlias()); } } if (!(list.isEmpty())) { final java.lang.String s = org.ovirt.engine.ui.uicompat.external.StringUtils.join(list, ", "); model.setMessage(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getMessages().disksWillNotBePartOfTheExportedVM(s)); } }
@java.lang.Override protected org.ovirt.engine.ui.common.widget.form.key_value.KeyLineWidget createWidget(org.ovirt.engine.ui.uicommonweb.models.vms.key_value.KeyLineModel value) { org.ovirt.engine.ui.common.widget.form.key_value.KeyLineWidget keyLineWidget = new org.ovirt.engine.ui.common.widget.form.key_value.KeyLineWidget(); keyLineWidget.edit(value); keyLineWidget.setUsePatternFly(usePatternFly); widgets.add(keyLineWidget); return keyLineWidget; }
private org.ovirt.engine.core.common.businessentities.VolumeType getMemoryVolumeType() { return org.ovirt.engine.core.bll.HibernateVmCommand.getMemoryVolumeTypeForStorageDomain(org.ovirt.engine.core.bll.HibernateVmCommand.getStorageDomain().getStorageType()); }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.VDS> filter(java.util.List<org.ovirt.engine.core.common.businessentities.VDS> hosts, org.ovirt.engine.core.common.businessentities.VM vm, java.util.Map<java.lang.String, java.lang.String> parameters, org.ovirt.engine.core.common.scheduling.PerHostMessages messages) { if ((vm.getRunOnVds()) != null) { java.util.List<org.ovirt.engine.core.common.businessentities.VDS> hostsToRunOn = new java.util.ArrayList<>(); org.ovirt.engine.core.common.businessentities.VDS srcVds = getVdsDao().get(vm.getRunOnVds()); for (org.ovirt.engine.core.common.businessentities.VDS host : hosts) { if (host.getId().equals(vm.getRunOnVds())) { org.ovirt.engine.core.bll.scheduling.policyunits.MigrationPolicyUnit.log.debug("Vm '{}' already runs on host '{}', filtering host", vm.getName(), host.getName()); messages.addMessage(host.getId(), EngineMessage.VAR__DETAIL__SAME_HOST.toString()); continue; } if (!(validateDestinationVdsAddress(srcVds, host))) { org.ovirt.engine.core.bll.scheduling.policyunits.MigrationPolicyUnit.log.debug("Host '{}' resolves to the same machine as host '{}', filtering out", srcVds.getName(), host.getName()); messages.addMessage(host.getId(), EngineMessage.VAR__DETAIL__SAME_HOST.toString()); continue; } hostsToRunOn.add(host); } return hostsToRunOn; } return hosts; }
public java.lang.String getFirstMetadataDevice() { return firstMetadataDevice; }
public void updateConvertOperation(java.lang.String description, int progress) { this.convertOperationDescription = description; this.convertOperationProgress = progress; }
public org.ovirt.engine.core.bll.network.macpool.MacPool createDecoratedPool(org.ovirt.engine.core.bll.network.macpool.MacPool macPool, java.util.List<org.ovirt.engine.core.bll.network.macpool.MacPoolDecorator> decorators) { org.ovirt.engine.core.bll.network.macpool.MacPool lockedPool = lockedObjectFactory.createLockingInstance(macPool, org.ovirt.engine.core.bll.network.macpool.MacPool.class, lockForMacPool(macPool.getId())); org.ovirt.engine.core.bll.network.macpool.MacPool decoratedPool = decoratePool(lockedPool, decorators); return decoratedPool; }
void initTableActionButtons() { getTable().addActionButton(new org.ovirt.engine.ui.webadmin.widget.action.WebAdminButtonDefinition<org.ovirt.engine.core.common.businessentities.storage.Disk>(org.ovirt.engine.ui.webadmin.section.main.view.tab.storage.SubTabStorageDiskView.constants.removeDisk()) { @java.lang.Override protected org.ovirt.engine.ui.uicommonweb.UICommand resolveCommand() { return getDetailModel().getRemoveCommand(); } }); }
@org.junit.Test public void canDoActionFailsMissingIsoFile() { mockVdsWithOsVersion(org.ovirt.engine.core.bll.UpgradeOvirtNodeInternalCommandTest.VALID_OVIRT_VERSION); org.ovirt.engine.core.common.action.InstallVdsParameters param = org.ovirt.engine.core.bll.UpgradeOvirtNodeInternalCommandTest.createParameters(); param.setoVirtIsoFile(org.ovirt.engine.core.bll.UpgradeOvirtNodeInternalCommandTest.INVALID_VERSION_OVIRT_ISO_FILENAME); org.ovirt.engine.core.bll.UpgradeOvirtNodeInternalCommand<org.ovirt.engine.core.common.action.InstallVdsParameters> command = createCommand(param); org.ovirt.engine.core.bll.UpgradeOvirtNodeInternalCommandTest.assertFailsWithCanDoActionMessage(command, VdcBllMessages.VDS_CANNOT_INSTALL_MISSING_IMAGE_FILE); }
private void addVmCluster(final java.util.List<org.ovirt.engine.core.common.businessentities.StoragePool> dataCenters, final java.util.List<org.ovirt.engine.core.common.businessentities.VDSGroup> clusters) { org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getClusterById(new org.ovirt.engine.ui.frontend.AsyncQuery(new java.lang.Object[]{ getModel(), clusters }, new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object target, java.lang.Object returnValue) { java.lang.Object[] array = ((java.lang.Object[]) (target)); org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel model = ((org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel) (array[0])); java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VDSGroup> clusterList = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VDSGroup>) (array[1])); org.ovirt.engine.core.common.businessentities.VDSGroup cluster = ((org.ovirt.engine.core.common.businessentities.VDSGroup) (returnValue)); if (cluster != null) { clusterList.add(cluster); } java.util.Collections.sort(clusterList, new org.ovirt.engine.ui.uicommonweb.Linq.VdsGroupByNameComparer()); model.setDataCentersAndClusters(model, dataCenters, clusters, vm.getVdsGroupId()); } }, getModel().getHash()), vm.getVdsGroupId()); }
public java.lang.String getProvider() { return provider; }
@java.lang.Override public void build(S source, D destination, org.ovirt.engine.ui.uicommonweb.builders.BuilderList<S, D> rest) { parentsRest.head().build(source, destination, parentsRest.tail()); }
@java.lang.Override protected void executeCommand() { org.ovirt.engine.core.common.action.VdcReturnValueBase returnValueBase; final org.ovirt.engine.core.compat.Guid vdsId = org.ovirt.engine.core.bll.RestartVdsCommand.getVdsId(); final java.lang.String sessionId = org.ovirt.engine.core.bll.RestartVdsCommand.getParameters().getSessionId(); returnValueBase = executeVdsFenceAction(vdsId, sessionId, FenceActionType.Stop, VdcActionType.StopVds); if (returnValueBase.getSucceeded()) { executeFenceVdsManuallyAction(vdsId, sessionId); returnValueBase = executeVdsFenceAction(vdsId, sessionId, FenceActionType.Start, VdcActionType.StartVds); setSucceeded(returnValueBase.getSucceeded()); setFenceSucceeded(org.ovirt.engine.core.bll.RestartVdsCommand.getSucceeded()); } else { super.handleError(); org.ovirt.engine.core.bll.RestartVdsCommand.setSucceeded(false); } if (!(org.ovirt.engine.core.bll.RestartVdsCommand.getSucceeded())) { log.warnFormat("Restart host action failed, updating host {0} to {1}", vdsId, VDSStatus.NonResponsive.name()); runVdsCommand(VDSCommandType.SetVdsStatus, new org.ovirt.engine.core.common.vdscommands.SetVdsStatusVDSCommandParameters(vdsId, org.ovirt.engine.core.common.businessentities.VDSStatus.NonResponsive)); } }
public static void getNumOfMonitorList(org.ovirt.engine.ui.frontend.AsyncQuery aQuery) { aQuery.converterCallback = new org.ovirt.engine.ui.frontend.IAsyncConverter() { @java.lang.Override public java.lang.Object Convert(java.lang.Object source, org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery) { java.util.ArrayList<java.lang.Integer> nums = new java.util.ArrayList<java.lang.Integer>(); if (source != null) { java.lang.Iterable numEnumerable = ((java.lang.Iterable) (source)); java.util.Iterator numIterator = numEnumerable.iterator(); while (numIterator.hasNext()) { nums.add(java.lang.Integer.parseInt(numIterator.next().toString())); } } return nums; } }; org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getConfigFromCache(new org.ovirt.engine.core.common.queries.GetConfigurationValueParameters(org.ovirt.engine.core.common.queries.ConfigurationValues.ValidNumOfMonitors, org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getDefaultConfigurationVersion()), aQuery); }
public static <T extends org.ovirt.engine.core.common.action.VdcActionParametersBase> java.util.List<java.lang.String> validateInputs(java.util.List<java.lang.Class<?>> validationGroupList, T parameters) { java.util.List<java.lang.String> messages = java.util.Collections.emptyList(); java.util.Set<javax.validation.ConstraintViolation<T>> violations = org.ovirt.engine.core.common.utils.ValidationUtils.getValidator().validate(parameters, validationGroupList.toArray(new java.lang.Class<?>[validationGroupList.size()])); if (!(violations.isEmpty())) { messages = new java.util.ArrayList<java.lang.String>(violations.size()); for (javax.validation.ConstraintViolation<T> constraintViolation : violations) { messages.add(constraintViolation.getMessage()); } } return messages; }
private org.ovirt.engine.core.common.businessentities.HostJobInfo.HostJobStatus handleUndeterminedJobStatus(org.ovirt.engine.core.bll.storage.StorageJobCommand<?> cmd, boolean jobsReportedByHost) { if (isEntityPollingSupported(cmd)) { log.info("Command {} id: '{}': attempting to determine the job status by polling the entity.", cmd.getActionType(), cmd.getCommandId()); org.ovirt.engine.core.common.businessentities.HostJobInfo.HostJobStatus jobStatus = pollEntity(cmd); handlePolledJobStatus(cmd, jobStatus); if (jobStatus != null) { return jobStatus; } org.ovirt.engine.core.bll.storage.EntityPollingCommand entityPollingCommand = ((org.ovirt.engine.core.bll.storage.EntityPollingCommand) (cmd)); if (!(cmd.getParameters().getJobStarted())) { entityPollingCommand.attemptToFenceJob(); } return null; } if (cmd.failJobWithUndeterminedStatus()) { log.error(("Command {} id: '{}': failed to determine the actual job status, considering as failed as per" + " the command implementation"), cmd.getActionType(), cmd.getCommandId()); return org.ovirt.engine.core.common.businessentities.HostJobInfo.HostJobStatus.failed; } if (jobsReportedByHost) { log.error(("Command {} id: '{}': entity polling isn't supported and the job isn't reported by the host," + "assuming it failed so that the command execution will end."), cmd.getActionType(), cmd.getCommandId()); return org.ovirt.engine.core.common.businessentities.HostJobInfo.HostJobStatus.failed; } log.error("Command {} id: '{}': failed to determine the actual job status, will retry to poll the job soon", cmd.getActionType(), cmd.getCommandId()); return null; }
@org.junit.Test public void lunAlreadyPartOfStorageDomains() { org.ovirt.engine.core.common.businessentities.storage.LUNs lun1 = new org.ovirt.engine.core.common.businessentities.storage.LUNs(); lun1.setLUN_id(org.ovirt.engine.core.bll.storage.domain.StorageDomainCommandBaseTest.GUIDS[0].toString()); lun1.setStorageDomainId(org.ovirt.engine.core.compat.Guid.newGuid()); org.ovirt.engine.core.common.businessentities.storage.LUNs lun2 = new org.ovirt.engine.core.common.businessentities.storage.LUNs(); lun2.setLUN_id(org.ovirt.engine.core.bll.storage.domain.StorageDomainCommandBaseTest.GUIDS[1].toString()); lun2.setStorageDomainId(org.ovirt.engine.core.compat.Guid.newGuid()); doReturn(lunDao).when(cmd).getLunDao(); when(lunDao.getAll()).thenReturn(java.util.Arrays.asList(lun1, lun2)); java.util.List<java.lang.String> specifiedLunIds = java.util.Collections.singletonList(org.ovirt.engine.core.bll.storage.domain.StorageDomainCommandBaseTest.GUIDS[0].toString()); assertTrue(cmd.isLunsAlreadyInUse(specifiedLunIds)); java.util.List<java.lang.String> messages = cmd.getReturnValue().getCanDoActionMessages(); assertEquals(messages.size(), 2); assertEquals(messages.get(0), EngineMessage.ACTION_TYPE_FAILED_LUNS_ALREADY_PART_OF_STORAGE_DOMAINS.toString()); assertEquals(messages.get(1), java.lang.String.format("$lunIds %1$s", cmd.getFormattedLunId(lun1, lun1.getStorageDomainName()))); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Snapshot cannot be created since the VM contains a stateless Snapshot.") java.lang.String snapshotCannotBeCreatedStatelessSnapshotMsg();
protected void updateUsbNativeMessageVisibility(final org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel object) { org.ovirt.engine.core.common.businessentities.VDSGroup vdsGroup = ((org.ovirt.engine.core.common.businessentities.VDSGroup) (object.getSelectedCluster())); changeApplicationLevelVisibility(nativeUsbWarningMessage, (((((object.getUsbPolicy().getSelectedItem()) == (org.ovirt.engine.core.common.businessentities.UsbPolicy.ENABLED_NATIVE)) && (vdsGroup != null)) && ((vdsGroup.getcompatibility_version()) != null)) && (!((java.lang.Boolean) (org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getConfigValuePreConverted(ConfigurationValues.MigrationSupportForNativeUsb, vdsGroup.getcompatibility_version().getValue())))))); }
public void updateExternalStatus(org.ovirt.engine.core.compat.Guid id, org.ovirt.engine.core.common.businessentities.ExternalStatus status) { org.springframework.jdbc.core.namedparam.MapSqlParameterSource parameterSource = getCustomMapSqlParameterSource().addValue("vds_guid", id).addValue("external_status", status); getCallsHandler().executeModification("UpdateHostExternalStatus", parameterSource); }
@java.lang.Override public org.ovirt.engine.core.bll.tasks.interfaces.CommandCallback getCallback() { return org.ovirt.engine.core.bll.snapshots.CreateAllSnapshotsFromVmCommand.getParameters().isUseCinderCommandCallback() ? new org.ovirt.engine.core.bll.ConcurrentChildCommandsExecutionCallback() : null; }
static void RunMultipleActions(final java.util.List<org.ovirt.engine.core.common.action.VdcActionType> actionTypes, final java.util.List<org.ovirt.engine.core.common.action.VdcActionParametersBase> parameters, final java.util.List<org.ovirt.engine.ui.uicompat.IFrontendActionAsyncCallback> callbacks, final org.ovirt.engine.ui.uicompat.IFrontendActionAsyncCallback failureCallback, final java.lang.Object state, final org.ovirt.engine.ui.frontend.gwtservices.GenericApiGWTServiceAsync service) { if (((actionTypes.isEmpty()) || (parameters.isEmpty())) || (callbacks.isEmpty())) { return; } org.ovirt.engine.ui.frontend.Frontend.runActionImpl(actionTypes.get(0), parameters.get(0), new org.ovirt.engine.ui.uicompat.IFrontendActionAsyncCallback() { @java.lang.Override public void executed(final org.ovirt.engine.ui.uicompat.FrontendActionAsyncResult result) { org.ovirt.engine.core.common.action.VdcReturnValueBase returnValue = result.getReturnValue(); boolean success = (returnValue != null) && (returnValue.getSucceeded()); if (success || (failureCallback == null)) { org.ovirt.engine.ui.uicompat.IFrontendActionAsyncCallback callback = callbacks.get(0); if (callback != null) { callback.executed(result); } actionTypes.remove(0); parameters.remove(0); callbacks.remove(0); org.ovirt.engine.ui.frontend.Frontend.RunMultipleActions(actionTypes, parameters, callbacks, failureCallback, state, service); } else { failureCallback.executed(result); } } }, state, true, service); }
private static void appendEntry(java.lang.StringBuilder builder, java.util.Map.Entry<java.lang.String, java.lang.Object> entry) { builder.append(entry.getKey()).append('=').append(entry.getValue()); }
private void initExternalProviderList() { startProgress(null); org.ovirt.engine.ui.frontend.AsyncQuery getProvidersQuery = new org.ovirt.engine.ui.frontend.AsyncQuery(); getProvidersQuery.asyncCallback = new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object result) { java.util.List<org.ovirt.engine.core.common.businessentities.Provider> providers = ((java.util.List<org.ovirt.engine.core.common.businessentities.Provider>) (result)); getExternalProviders().setItems(providers); selectExternalProvider(); stopProgress(); } }; org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getAllNetworkProviders(getProvidersQuery); }
@org.ovirt.engine.ui.frontend.DefaultStringValue("Failed to create geo-replication session.") java.lang.String GlusterGeoRepSessionCreateFailed();
private boolean updateVms() { for (org.ovirt.engine.core.common.businessentities.VmStatic vm : vmsLockedForUpdate) { org.ovirt.engine.core.common.action.VmManagementParametersBase updateParams = new org.ovirt.engine.core.common.action.VmManagementParametersBase(vm); updateParams.setLockProperties(org.ovirt.engine.core.common.action.LockProperties.create(LockProperties.Scope.None)); updateParams.setClusterLevelChangeFromVersion(oldCluster.getCompatibilityVersion()); upgradeGraphicsDevices(vm, updateParams); updateRngDeviceIfNecessary(vm.getId(), vm.getCustomCompatibilityVersion(), updateParams); org.ovirt.engine.core.common.action.VdcReturnValueBase result = runInternalAction(VdcActionType.UpdateVm, updateParams, org.ovirt.engine.core.bll.UpdateClusterCommand.cloneContextAndDetachFromParent()); if (!(result.getSucceeded())) { java.util.List<java.lang.String> params = new java.util.ArrayList<>(); params.add("$action Update"); params.add("$type VM"); params.add(parseErrorMessage(result.getValidationMessages())); java.util.List<java.lang.String> messages = org.ovirt.engine.core.bll.Backend.getInstance().getErrorsTranslator().translateErrorText(params); failedUpgradeEntities.put(vm.getName(), getFailedMessage(messages)); } } return true; }
private boolean diskContainsPreExtendSnapshots() { return validate(createDiskImagesValidator(getImage()).childDiskWasExtended(org.ovirt.engine.core.bll.storage.disk.MoveOrCopyDiskCommand.getStorageDomain())); }
@org.junit.Test public void updatePosixEmptyVFSType() { org.ovirt.engine.core.common.businessentities.StorageServerConnections newPosixConnection = createPosixConnection("multipass.my.domain.tlv.company.com:/export/allstorage/data1", StorageType.POSIXFS, null, "timeo=30"); parameters.setStorageServerConnection(newPosixConnection); org.ovirt.engine.core.bll.CanDoActionTestUtils.runAndAssertCanDoActionFailure(command, VdcBllMessages.VALIDATION_STORAGE_CONNECTION_EMPTY_VFSTYPE); }
private org.ovirt.engine.ui.uicommonweb.models.storage.IStorageModel prepareGlusterStorageForEdit(org.ovirt.engine.core.common.businessentities.StorageDomain storage) { final org.ovirt.engine.ui.uicommonweb.models.storage.GlusterStorageModel model = new org.ovirt.engine.ui.uicommonweb.models.storage.GlusterStorageModel(); model.setRole(storage.getStorageDomainType()); model.getPath().setIsChangable(true); model.getVfsType().setIsChangable(false); model.getMountOptions().setIsChangable(false); org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.GetStorageConnectionById(new org.ovirt.engine.ui.frontend.AsyncQuery(null, new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void OnSuccess(java.lang.Object target, java.lang.Object returnValue) { org.ovirt.engine.core.common.businessentities.StorageServerConnections connection = ((org.ovirt.engine.core.common.businessentities.StorageServerConnections) (returnValue)); model.getPath().setEntity(connection.getconnection()); model.getVfsType().setEntity(connection.getVfsType()); model.getMountOptions().setEntity(connection.getMountOptions()); } }), storage.getStorage(), true); return model; }
@java.lang.Override public void loadFromLocalStorage(org.ovirt.engine.ui.uicommonweb.models.VmConsoles vmConsoles) { java.lang.String vmId = vmConsoles.getVm().getId().toString(); org.ovirt.engine.ui.common.utils.ConsoleContext context = vmConsoles.getConsoleContext(); org.ovirt.engine.ui.common.utils.ConsoleOptionsFrontendPersisterImpl.KeyMaker keyMaker = new org.ovirt.engine.ui.common.utils.ConsoleOptionsFrontendPersisterImpl.KeyMaker(vmId, context); java.lang.String selectedProtocolString = clientStorage.getLocalItem(keyMaker.make(org.ovirt.engine.ui.common.utils.ConsoleOptionsFrontendPersisterImpl.SELECTED_PROTOCOL)); if ((selectedProtocolString == null) || ("".equals(selectedProtocolString))) { return; } org.ovirt.engine.ui.uicommonweb.models.ConsoleProtocol selectedProtocol = org.ovirt.engine.ui.uicommonweb.models.ConsoleProtocol.valueOf(selectedProtocolString); if (!(vmConsoles.canSelectProtocol(selectedProtocol))) { return; } if (selectedProtocol == (org.ovirt.engine.ui.uicommonweb.models.ConsoleProtocol.SPICE)) { loadSpiceData(vmConsoles, keyMaker); } else if (selectedProtocol == (org.ovirt.engine.ui.uicommonweb.models.ConsoleProtocol.VNC)) { loadVncData(vmConsoles, keyMaker); } else if (selectedProtocol == (org.ovirt.engine.ui.uicommonweb.models.ConsoleProtocol.RDP)) { loadRdpData(vmConsoles, keyMaker); } }
void onWindowFocusChange(boolean inFocus) { org.ovirt.engine.ui.uicommonweb.models.GridTimer modelTimer = getModelTimer(); if ((modelTimer.isActive()) && (!(modelTimer.isPaused()))) { modelTimer.stop(); if (inFocus) { modelTimer.setRefreshRate(readRefreshRate()); } else { modelTimer.setRefreshRate(org.ovirt.engine.ui.common.widget.refresh.AbstractRefreshManager.OUT_OF_FOCUS_REFRESH_RATE); } modelTimer.start(); } }
@org.junit.Test public void canDoActionFailsLongName() { sd.setStorageName(org.ovirt.engine.core.utils.RandomUtils.instance().nextString(11)); org.ovirt.engine.core.bll.CanDoActionTestUtils.runAndAssertCanDoActionFailure(cmd, EngineMessage.ACTION_TYPE_FAILED_NAME_LENGTH_IS_TOO_LONG); }
@java.lang.Override public javax.ws.rs.core.Response move(org.ovirt.engine.api.model.Action action) { validateParameters(action, "storageDomain.id|name"); org.ovirt.engine.core.compat.Guid storageDomainId = getStorageDomainId(action); org.ovirt.engine.core.compat.Guid imageId = asGuid(getDisk().getImageId()); org.ovirt.engine.core.common.action.MoveDisksParameters params = new org.ovirt.engine.core.common.action.MoveDisksParameters(java.util.Collections.singletonList(new org.ovirt.engine.core.common.action.MoveDiskParameters(imageId, org.ovirt.engine.core.compat.Guid.Empty, storageDomainId))); return doAction(VdcActionType.MoveDisks, params, action); }
public void updateCurrentStorageItem() { org.ovirt.engine.core.common.businessentities.StorageDomainType storageDomainType = getAvailableStorageDomainTypeItems().getSelectedItem(); org.ovirt.engine.core.common.businessentities.storage.StorageType storageType = getAvailableStorageTypeItems().getSelectedItem(); for (org.ovirt.engine.ui.uicommonweb.models.storage.IStorageModel model : getItems()) { if (((model.getType()) == storageType) && ((model.getRole()) == storageDomainType)) { setCurrentStorageItem(model); break; } } }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Data Center can be changed only when the Host is in Maintenance mode.") java.lang.String dcCanOnlyBeChangedWhenHostInMaintMode();
@org.junit.Test public void testReadOneSkipsAndIngoresUnknownElements() { org.ovirt.api.metamodel.runtime.xml.XmlReader reader = openReader(("<vm>" + (("<junk>ugly</junk>" + "<name>myvm</name>") + "</vm>"))); org.ovirt.engine.api.types.V4Vm vm = org.ovirt.engine.api.xml.V4XmlVmReader.readOne(reader); assertEquals("myvm", vm.name()); }
private void addGraphicsDevice() { for (org.ovirt.engine.core.common.businessentities.GraphicsDevice graphicsDevice : org.ovirt.engine.core.bll.AddVmCommand.getParameters().getGraphicsDevices().values()) { if (graphicsDevice == null) { continue; } graphicsDevice.setVmId(org.ovirt.engine.core.bll.AddVmCommand.getVmId()); org.ovirt.engine.core.bll.AddVmCommand.getBackend().runInternalAction(VdcActionType.AddGraphicsDevice, new org.ovirt.engine.core.bll.GraphicsParameters(graphicsDevice)); } }
private void buildFaultResult() { org.ovirt.engine.core.common.errors.VdcFault fault = new org.ovirt.engine.core.common.errors.VdcFault(); fault.setError(EngineError.ReachedMaxNumberOfHostsInDC); fault.setMessage(org.ovirt.engine.core.bll.Backend.getInstance().getVdsErrorsTranslator().TranslateErrorTextSingle(fault.getError().toString())); org.ovirt.engine.core.bll.AddVdsSpmIdCommand.getReturnValue().setFault(fault); }
private void updateVdsData() { org.ovirt.engine.core.utils.transaction.TransactionSupport.executeInNewTransaction(new org.ovirt.engine.core.utils.transaction.TransactionMethod<java.lang.Void>() { @java.lang.Override public java.lang.Void runInTransaction() { getCompensationContext().snapshotEntity(getVds().getStaticData()); org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVdsStaticDao().update(getParameters().getVdsStaticData()); getCompensationContext().stateChanged(); return null; } }); if (org.ovirt.engine.core.bll.UpdateVdsCommand.getParameters().getInstallVds()) { runVdsCommand(VDSCommandType.SetVdsStatus, new org.ovirt.engine.core.common.vdscommands.SetVdsStatusVDSCommandParameters(org.ovirt.engine.core.bll.UpdateVdsCommand.getVdsId(), org.ovirt.engine.core.common.businessentities.VDSStatus.Installing)); } }
@java.lang.Override protected java.lang.String renderNullSafe(org.ovirt.engine.core.common.businessentities.network.NetworkQoS qos) { return qos.getName(); }
@java.lang.Override protected void revealInParent() { com.gwtplatform.mvp.client.proxy.RevealContentEvent.fire(this, MainContentPresenter.TYPE_SetSubTabPanelContent, this); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("The selected IDE disk(s) will be attached, but will not be activated. In order to activate them, you should shut the VM down and manually activate them.") java.lang.String ideDisksWillBeAttachedButNotActivated();
@org.ovirt.engine.ui.common.Template("<table cellspacing='0' cellpadding='0'><tr>" + (((((("<td style='background: url({2});width:2px;'></td>" + "<td style='text-align:center;'>") + "<div class='db_bg_image {5} {6}' style='background: url({3}) repeat-x; height: 20px; display: flex;'>") + "<span style=\'vertical-align: middle; line-height: 20px; margin-top: 2px;\' class=\"db_image_container\">{0}</span><div style=\'line-height: 19px;\'>{1}</div></div>") + "</td>") + "<td style='background: url({4});width:2px;'></td>") + "</tr></table>")) com.google.gwt.safehtml.shared.SafeHtml dialogButton(com.google.gwt.safehtml.shared.SafeHtml image, java.lang.String text, java.lang.String start, java.lang.String stretch, java.lang.String end, java.lang.String contentStyleName, java.lang.String customContentStyleName);
private void runStoragePoolUpEvent(final org.ovirt.engine.core.common.businessentities.StoragePool storagePool) { org.ovirt.engine.core.utils.threadpool.ThreadPoolUtil.execute(new java.lang.Runnable() { @java.lang.Override public void run() { try { if (isMasterDomainUp()) { org.ovirt.engine.core.vdsbroker.ResourceManager.getInstance().getEventListener().storagePoolUpEvent(storagePool); } } catch (java.lang.RuntimeException exp) { org.ovirt.engine.core.vdsbroker.irsbroker.IrsProxyData.log.error("Error in StoragePoolUpEvent: {}", exp.getMessage()); org.ovirt.engine.core.vdsbroker.irsbroker.IrsProxyData.log.debug("Exception", exp); } } private boolean isMasterDomainUp() { return org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getStorageDomainDao().getStorageDomains(_storagePoolId, StorageDomainType.Master).stream().anyMatch(( d) -> ((d.getStatus()) == StorageDomainStatus.Active) || ((d.getStatus()) == StorageDomainStatus.Unknown)); } }); }
@org.junit.Test public void parametersWithSecureDeletionAreNotFixedOnBlockDomainWhenPostZeroIsFalse() { org.ovirt.engine.core.bll.storage.domain.PostZeroHandlerTest.ParametersWithPostZero parameters = org.ovirt.engine.core.bll.storage.domain.PostZeroHandler.fixParametersWithPostZero(new org.ovirt.engine.core.bll.storage.domain.PostZeroHandlerTest.ParametersWithPostZero(false), false); assertPostZeroValue(parameters, false); }
public static org.ovirt.engine.sdk4.ConnectionBuilder connection() { java.lang.Class<? extends org.ovirt.engine.sdk4.ConnectionBuilder> clazz = null; try { clazz = ((java.lang.Class<org.ovirt.engine.sdk4.ConnectionBuilder>) (java.lang.Class.forName("org.ovirt.engine.sdk4.internal.ConnectionBuilder45"))); } catch (java.lang.Throwable ex) { try { clazz = ((java.lang.Class<org.ovirt.engine.sdk4.ConnectionBuilder>) (java.lang.Class.forName("org.ovirt.engine.sdk4.internal.ConnectionBuilder42"))); } catch (java.lang.Throwable e) { throw new java.lang.Error("No connection implementation found", e); } } try { return clazz.newInstance(); } catch (java.lang.Exception e) { throw new java.lang.Error("Failed to initialize connection implementation", e); } }
@org.junit.Test public void canDoActionFailWithUnsupportedDiskInterface() throws java.lang.Exception { org.ovirt.engine.core.compat.Guid storageId = org.ovirt.engine.core.compat.Guid.newGuid(); initializeCommand(storageId); mockVm(); mockStorageDomain(storageId); mockStoragePoolIsoMap(); mockMaxPciSlots(); when(diskValidator.isReadOnlyPropertyCompatibleWithInterface()).thenReturn(ValidationResult.VALID); when(diskValidator.isDiskInterfaceSupported(any(org.ovirt.engine.core.common.businessentities.VM.class))).thenReturn(new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.VdcBllMessages.ACTION_TYPE_DISK_INTERFACE_UNSUPPORTED)); when(diskValidator.isVirtIoScsiValid(any(org.ovirt.engine.core.common.businessentities.VM.class))).thenReturn(ValidationResult.VALID); when(diskValidator.areBootableAndSharableCompatibleWithDisk()).thenReturn(ValidationResult.VALID); when(command.getDiskValidator(any(org.ovirt.engine.core.common.businessentities.Disk.class))).thenReturn(diskValidator); assertFalse(command.canDoAction()); assertTrue(command.getReturnValue().getCanDoActionMessages().contains(VdcBllMessages.ACTION_TYPE_DISK_INTERFACE_UNSUPPORTED.toString())); }
@java.lang.Override protected boolean canDoAction() { boolean result = true; org.ovirt.engine.core.common.businessentities.AuditLog event = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getAuditLogDao().get(org.ovirt.engine.core.bll.RemoveExternalEventCommand.getParameters().getId()); if (event == null) { addCanDoActionMessage(VdcBllMessages.ACTION_TYPE_FAILED_EXTERNAL_EVENT_NOT_FOUND); result = false; } if (OVIRT.equalsIgnoreCase(event.getOrigin())) { addCanDoActionMessage(VdcBllMessages.ACTION_TYPE_FAILED_EXTERNAL_EVENT_ILLEGAL_ORIGIN); result = false; } if (!(event.getseverity().equals(AuditLogSeverity.ALERT))) { addCanDoActionMessage(VdcBllMessages.ACTION_TYPE_FAILED_EXTERNAL_EVENT_ILLRGAL_OPERATION); result = false; } if (!result) { addCanDoActionMessage(VdcBllMessages.VAR__ACTION__REMOVE); addCanDoActionMessage(VdcBllMessages.VAR__TYPE__EXTERNAL_EVENT); } return result; }
private void updateDiscoveredHostList(java.lang.String searchFilter) { org.ovirt.engine.core.common.businessentities.Provider provider = getProviders().getSelectedItem(); if (provider != null) { org.ovirt.engine.ui.frontend.AsyncQuery getHostsQuery = new org.ovirt.engine.ui.frontend.AsyncQuery(); getHostsQuery.asyncCallback = new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object result) { java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VDS> hosts = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VDS>) (result)); org.ovirt.engine.ui.uicommonweb.models.ListModel<org.ovirt.engine.core.common.businessentities.VDS> hostNameListModel = getExternalHostName(); hostNameListModel.setItems(hosts); hostNameListModel.setIsChangable(true); setEnableSearchHost(true); } }; org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getExternalProviderHostList(getHostsQuery, provider.getId(), true, searchFilter); } else { getExternalHostName().setItems(null); getExternalHostName().setIsChangable(false); setEnableSearchHost(false); } }
private void canDoActionFailedWithReason(final org.ovirt.engine.core.common.errors.EngineMessage message) { assertFalse(cmd.canDoAction()); assertTrue(cmd.getReturnValue().getCanDoActionMessages().contains(message.toString())); }
@java.lang.Override protected void onLoadingStateChanged(com.google.gwt.user.cellview.client.LoadingStateChangeEvent.LoadingState state) { super.onLoadingStateChanged(state); enforceScrollPosition(); if (state == (com.google.gwt.user.cellview.client.LoadingStateChangeEvent.LoadingState.LOADING)) { com.google.gwt.core.client.Scheduler.get().scheduleDeferred(new com.google.gwt.core.client.Scheduler.ScheduledCommand() { @java.lang.Override public void execute() { doAutoSelect = true; } }); } }
@java.lang.Override protected void childCommandsExecutionEnded(org.ovirt.engine.core.bll.CommandBase<?> command, boolean anyFailed, java.util.List<org.ovirt.engine.core.compat.Guid> childCmdIds, org.ovirt.engine.core.compat.backendcompat.CommandExecutionStatus status, int completedChildren) { org.ovirt.engine.core.bll.storage.disk.cinder.AddCinderDiskCommand<org.ovirt.engine.core.common.action.AddDiskParameters> addCinderDiskCommand = ((org.ovirt.engine.core.bll.storage.disk.cinder.AddCinderDiskCommand<org.ovirt.engine.core.common.action.AddDiskParameters>) (command)); org.ovirt.engine.core.compat.Guid diskId = getDiskId(addCinderDiskCommand); org.ovirt.engine.core.common.businessentities.storage.ImageStatus imageStatus = addCinderDiskCommand.getCinderBroker().getDiskStatus(diskId); org.ovirt.engine.core.common.businessentities.storage.DiskImage disk = ((org.ovirt.engine.core.common.businessentities.storage.CinderDisk) (command.getDiskDao().get(diskId))); if ((imageStatus != null) && (imageStatus != (disk.getImageStatus()))) { switch (imageStatus) { case OK : setCommandEndStatus(command, false, status, childCmdIds); break; case ILLEGAL : setCommandEndStatus(command, true, status, childCmdIds); break; } } }
@org.junit.Test public void testOtherFieldsNotValidatedInImport() { java.lang.String tooLongString = org.ovirt.engine.core.utils.RandomUtils.instance().nextPropertyString(((org.ovirt.engine.core.common.businessentities.BusinessEntitiesDefinitions.GENERAL_MAX_SIZE) + 1)); cmd.getParameters().getVm().setUserDefinedProperties(tooLongString); cmd.getParameters().setImportAsNewEntity(true); cmd.init(); java.util.Set<javax.validation.ConstraintViolation<org.ovirt.engine.core.common.action.ImportVmParameters>> validate = org.ovirt.engine.core.common.utils.ValidationUtils.getValidator().validate(cmd.getParameters(), cmd.getValidationGroups().toArray(new java.lang.Class<?>[0])); assertTrue(validate.isEmpty()); cmd.getParameters().getVm().setUserDefinedProperties(tooLongString); cmd.getParameters().setImportAsNewEntity(false); cmd.init(); validate = org.ovirt.engine.core.common.utils.ValidationUtils.getValidator().validate(cmd.getParameters(), cmd.getValidationGroups().toArray(new java.lang.Class<?>[0])); assertTrue(validate.isEmpty()); }
public void setXenProxyHosts(org.ovirt.engine.ui.uicommonweb.models.ListModel<org.ovirt.engine.core.common.businessentities.VDS> proxyHosts) { this.xenProxyHosts = proxyHosts; }
protected org.ovirt.engine.core.compat.Guid getUpServerId() { if ((brick) == null) { return getUpServerId(clusterId); } org.ovirt.engine.core.common.businessentities.VDS brickServer = org.ovirt.engine.core.bll.gluster.GetGlusterVolumeAdvancedDetailsQuery.getVdsDao().get(brick.getServerId()); if ((brickServer.getStatus()) == (org.ovirt.engine.core.common.businessentities.VDSStatus.Up)) { return brickServer.getId(); } return super.getUpServerId(clusterId); }
public org.ovirt.engine.core.bll.ValidationResult networkNotUsedByRunningVms() { java.util.List<org.ovirt.engine.core.common.businessentities.VM> runningVms = new java.util.ArrayList<>(); java.util.List<org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface> vnics = getDbFacade().getVmNetworkInterfaceDao().getAllForNetwork(network.getId()); java.util.Map<org.ovirt.engine.core.compat.Guid, java.util.List<org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface>> vnicsByVmId = org.ovirt.engine.core.common.businessentities.Entities.vmInterfacesByVmId(vnics); for (org.ovirt.engine.core.common.businessentities.VM vm : getVms()) { if (vm.isRunningOrPaused()) { for (org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface nic : vnicsByVmId.get(vm.getId())) { if (org.ovirt.engine.core.bll.common.predicates.VmNetworkCanBeUpdatedPredicate.getInstance().eval(nic)) { runningVms.add(vm); break; } } } } return networkNotUsed(runningVms, VdcBllMessages.VAR__ENTITIES__VMS); }
@javax.ws.rs.Path("{action: (?:allocatevm)}/{oid}") public org.ovirt.engine.api.v3.servers.V3ActionServer getActionResource(@javax.ws.rs.PathParam("action") java.lang.String action, @javax.ws.rs.PathParam("oid") java.lang.String oid) { return new org.ovirt.engine.api.v3.servers.V3ActionServer(getDelegate().getActionResource(action, oid)); }
private void cluster_SelectedItemChanged() { org.ovirt.engine.core.common.businessentities.VDSGroup cluster = getCluster().getSelectedItem(); if (cluster != null) { org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().getPmTypeList(new org.ovirt.engine.ui.frontend.AsyncQuery(this, new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { java.util.List<java.lang.String> pmTypes = ((java.util.ArrayList<java.lang.String>) (returnValue)); updatePmTypeList(pmTypes); } }), cluster.getCompatibilityVersion()); java.lang.Boolean jsonSupported = ((java.lang.Boolean) (org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().getConfigValuePreConverted(ConfigurationValues.JsonProtocolSupported, cluster.getCompatibilityVersion().toString()))); getProtocol().setEntity(jsonSupported); getProtocol().setIsChangeable(jsonSupported); if (((getDataCenter()) != null) && ((getDataCenter().getItems()) != null)) { for (org.ovirt.engine.core.common.businessentities.StoragePool datacenter : getDataCenter().getItems()) { if (datacenter.getId().equals(cluster.getStoragePoolId())) { getDataCenter().setSelectedItem(datacenter, false); break; } } } } }
@java.lang.Override protected void setActionMessageParameters() { addCanDoActionMessage(EngineMessage.VAR__ACTION__REGISTER); addCanDoActionMessage(EngineMessage.VAR__TYPE__VM_DISK); }
@java.lang.Override public com.google.gwt.resources.client.ImageResource getValue(org.ovirt.engine.core.common.businessentities.VM vm) { if ((vm.getVmPoolId()) == null) { org.ovirt.engine.ui.webadmin.widget.table.column.VmTypeConfig config = org.ovirt.engine.ui.webadmin.widget.table.column.VmTypeConfig.from(vm.getVmType(), vm.isStateless()); setTitle(config.getTooltip(org.ovirt.engine.ui.webadmin.widget.table.column.VmTypeColumn.constants)); return config.getImageResource(getApplicationResources()); } else { return getApplicationResources().manyDesktopsImage(); } }
protected void setUpGetSystemVersionExpectations() { org.ovirt.engine.core.common.queries.VdcQueryReturnValue productRpmQueryResult = createMock(org.ovirt.engine.core.common.queries.VdcQueryReturnValue.class); expect(productRpmQueryResult.getSucceeded()).andReturn(true).anyTimes(); expect(productRpmQueryResult.getReturnValue()).andReturn(org.ovirt.engine.api.restapi.resource.BackendApiResourceTest.SYSTEM_VERSION).anyTimes(); expect(backend.runQuery(eq(VdcQueryType.GetConfigurationValue), getProductRPMVersionParams())).andReturn(productRpmQueryResult); org.ovirt.engine.core.common.queries.VdcQueryReturnValue productVersionQueryResult = createMock(org.ovirt.engine.core.common.queries.VdcQueryReturnValue.class); expect(productVersionQueryResult.getSucceeded()).andReturn(true).anyTimes(); expect(productVersionQueryResult.getReturnValue()).andReturn(new org.ovirt.engine.core.compat.Version(org.ovirt.engine.api.restapi.resource.BackendApiResourceTest.MAJOR, org.ovirt.engine.api.restapi.resource.BackendApiResourceTest.MINOR, org.ovirt.engine.api.restapi.resource.BackendApiResourceTest.BUILD, org.ovirt.engine.api.restapi.resource.BackendApiResourceTest.REVISION)).anyTimes(); expect(backend.runQuery(eq(VdcQueryType.GetProductVersion), getProductVersionParams())).andReturn(productVersionQueryResult); }
public java.util.List<org.ovirt.api.metamodel.concepts.MemberInvolvementTree> getMemberInvolvementTrees() { return memberInvolvementTrees; }
@java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.EventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().getUserProfile(model.asyncQuery(new org.ovirt.engine.ui.frontend.AsyncCallback<org.ovirt.engine.core.common.queries.VdcQueryReturnValue>() { @java.lang.Override public void onSuccess(org.ovirt.engine.core.common.queries.VdcQueryReturnValue returnValue) { org.ovirt.engine.core.common.businessentities.UserProfile profile = returnValue.getReturnValue(); java.lang.Boolean connectAutomatically = (profile == null) ? java.lang.Boolean.TRUE : profile.isUserPortalVmLoginAutomatically(); if (connectAutomatically) { handleConnectAutomatically(); } } })); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("LUN is not usable") java.lang.String lunUnusable();
@org.junit.Test public void canDoActionSucceeds() { mockVdsWithOsVersion(org.ovirt.engine.core.bll.UpgradeOvirtNodeInternalCommandTest.VALID_OVIRT_VERSION); org.ovirt.engine.core.common.action.InstallVdsParameters param = org.ovirt.engine.core.bll.UpgradeOvirtNodeInternalCommandTest.createParameters(); param.setoVirtIsoFile(org.ovirt.engine.core.bll.UpgradeOvirtNodeInternalCommandTest.VALID_VERSION_OVIRT_ISO_FILENAME); org.ovirt.engine.core.bll.UpgradeOvirtNodeInternalCommand<org.ovirt.engine.core.common.action.InstallVdsParameters> command = createCommand(param); assertTrue(command.canDoAction()); }
@java.lang.Override public void OnSuccess(java.lang.Object model, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.models.userportal.UserPortalBasicListModel userPortalBasicListModel = ((org.ovirt.engine.ui.uicommonweb.models.userportal.UserPortalBasicListModel) (model)); java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VM> vms = new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VM>(); java.util.ArrayList<org.ovirt.engine.core.common.businessentities.vm_pools> pools = new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.vm_pools>(); org.ovirt.engine.core.common.queries.VdcQueryReturnValue retValue = ((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (returnValue)); if ((retValue != null) && (retValue.getSucceeded())) { java.util.List<java.lang.Object> list = ((java.util.ArrayList<java.lang.Object>) (retValue.getReturnValue())); if (list != null) { for (java.lang.Object object : list) { if (object instanceof org.ovirt.engine.core.common.businessentities.VM) { vms.add(((org.ovirt.engine.core.common.businessentities.VM) (object))); } else if (object instanceof org.ovirt.engine.core.common.businessentities.vm_pools) { pools.add(((org.ovirt.engine.core.common.businessentities.vm_pools) (object))); } } } } userPortalBasicListModel.setvms(vms); userPortalBasicListModel.setpools(pools); userPortalBasicListModel.OnVmAndPoolLoad(); }
protected void removeVmNetworkInterfaces() { new org.ovirt.engine.core.bll.network.VmInterfaceManager(macPool).removeAll(org.ovirt.engine.core.bll.ImportVmCommand.getVmId()); }
public void setRngSourceHwrng(org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel.NotChangableForVmInPoolEntityModel<java.lang.Boolean> rngSourceHwrng) { this.rngSourceHwrng = rngSourceHwrng; }
@java.lang.Override public void executeCommand() { super.executeCommand(); if ((org.ovirt.engine.core.bll.ImportVmFromConfigurationCommand.getSucceeded()) && (!(vmDisksToAttach.isEmpty()))) { org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogDirector.log(this, attemptToAttachDisksToImportedVm(vmDisksToAttach)); } setActionReturnValue(org.ovirt.engine.core.bll.ImportVmFromConfigurationCommand.getVm().getId()); }
@java.lang.Override public java.lang.String getVerb(org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkItemModel<?> op1) { return org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkOperation.BOND_WITH.getVerb(op1); }
@java.lang.Override protected boolean canDoAction() { org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity volume = getGlusterVolume(); if (!(super.canDoAction())) { return false; } if ((!(org.ovirt.engine.core.bll.gluster.tasks.GlusterTaskUtils.isTaskOfType(volume, GlusterTaskType.REMOVE_BRICK))) || (!(org.ovirt.engine.core.bll.gluster.tasks.GlusterTaskUtils.isTaskStatus(volume, JobExecutionStatus.STARTED)))) { return failCanDoAction(VdcBllMessages.ACTION_TYPE_FAILED_GLUSTER_VOLUME_REMOVE_BRICKS_NOT_STARTED); } return true; }
@java.lang.Override protected void executeCommand() { for (org.ovirt.engine.core.compat.Guid vdsId : org.ovirt.engine.core.bll.DetachVdsFromTagCommand.getVdsList()) { if (((org.ovirt.engine.core.bll.DetachVdsFromTagCommand.getTagId()) != null) && ((org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getTagDao().getTagVdsByTagIdAndByVdsId(org.ovirt.engine.core.bll.DetachVdsFromTagCommand.getTagId(), vdsId)) != null)) { org.ovirt.engine.core.common.businessentities.VDS vds = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVdsDao().get(vdsId); if (vds != null) { appendCustomCommaSeparatedValue("VdsNames", vds.getName()); } org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getTagDao().detachVdsFromTag(org.ovirt.engine.core.bll.DetachVdsFromTagCommand.getTagId(), vdsId); org.ovirt.engine.core.bll.DetachVdsFromTagCommand.setSucceeded(true); } } }
@java.lang.Override protected org.springframework.jdbc.core.RowMapper<org.ovirt.engine.core.common.businessentities.VmDynamic> createEntityRowMapper() { return org.ovirt.engine.core.dao.VmDynamicDaoImpl.VmDynamicRowMapper.instance; }
private void toggleVisibleWidgets(int currentWidth) { int widgetWidth = 0; boolean foundEdge = false; if ((contentPanel.getWidgetCount()) > 1) { for (int i = 0; i < ((contentPanel.getWidgetCount()) - 1); i++) { com.google.gwt.user.client.ui.Widget widget = contentPanel.getWidget(i); widget.setVisible(true); if (foundEdge || ((widgetWidth + (widget.getOffsetWidth())) > currentWidth)) { widget.setVisible(false); toolbarOnlyActionButtonList.get(i).setCascaded(true); foundEdge = true; } else { toolbarOnlyActionButtonList.get(i).setCascaded(false); widget.setVisible(true); } widgetWidth += widget.getOffsetWidth(); } } }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("Please select Hosts from the same data center") java.lang.String hostsFromDifferentDCsError();
protected void setNetworkId(org.ovirt.engine.api.model.NIC nic) { if ((nic.isSetNetwork()) && (!(nic.getNetwork().isSetId()))) { org.ovirt.engine.core.compat.Guid clusterId = getClusterId(); org.ovirt.engine.core.common.businessentities.Network network = lookupClusterNetwork(clusterId, ((nic.getNetwork().getId()) == null ? null : asGuid(nic.getNetwork().getId())), nic.getNetwork().getName()); if (network != null) { nic.getNetwork().setName(null); nic.getNetwork().setId(network.getId().toString()); } } }
@java.lang.Override protected void executeQueryCommand() { try { executeQueryCommandChecked(); } catch (java.io.IOException ex) { throw new org.ovirt.engine.core.common.errors.EngineException(org.ovirt.engine.core.common.errors.EngineError.FailedToCreateWebsocketProxyTicket, new java.lang.RuntimeException(ex)); } }
private java.util.Map<java.lang.String, java.lang.String> getFingerprints(java.util.Set<java.lang.String> servers) { java.util.Map<java.lang.String, java.lang.String> fingerprints = new java.util.HashMap<java.lang.String, java.lang.String>(); for (java.lang.String server : servers) { fingerprints.put(server, getFingerprint(server)); } return fingerprints; }
@org.junit.Test public void testIsBalloonEnabled() throws java.lang.Exception { assertTrue(OsRepositoryImpl.INSTANCE.isBalloonEnabled(777, null)); assertTrue(OsRepositoryImpl.INSTANCE.getBalloonSupportMap().get(777).get(null)); }
private boolean isSucceededWithReasonGiven() { return (isSucceededWithHA()) && (org.apache.commons.lang.StringUtils.isNotEmpty(org.ovirt.engine.core.bll.MaintenanceVdsCommand.getVds().getMaintenanceReason())); }
@java.lang.Override protected void writeHeader() { super.writeHeader(); _writer.setPrefix(org.ovirt.engine.core.utils.ovf.OVIRT_PREFIX, org.ovirt.engine.core.utils.ovf.OVIRT_URI); _writer.writeNamespace(org.ovirt.engine.core.utils.ovf.OVIRT_PREFIX, org.ovirt.engine.core.utils.ovf.OVIRT_URI); }
@org.junit.Before public void prepareParams() { oldNFSConnection = createNFSConnection("multipass.my.domain.tlv.company.com:/export/allstorage/data1", StorageType.NFS, NfsVersion.V4, 50, 0); oldPosixConnection = createPosixConnection("multipass.my.domain.tlv.company.com:/export/allstorage/data1", StorageType.POSIXFS, "nfs", "timeo=30"); prepareCommand(); }
@java.lang.Override public void setSpicePluginImplEnabled(boolean enabled, java.lang.String reason) { spicePluginImplRadioButton.setEnabled(enabled); if (!enabled) { spicePluginImplRadioButtonTooltip.setText(reason); } }
private void beforeFirstRefreshTreatment(boolean isVdsUpOrGoingToMaintenance) { if (_vdsManager.getbeforeFirstRefresh()) { boolean flagsChanged = false; final java.util.concurrent.atomic.AtomicBoolean processHardwareCapsNeededTemp = new java.util.concurrent.atomic.AtomicBoolean(); _vdsManager.refreshCapabilities(processHardwareCapsNeededTemp, _vds); flagsChanged = processHardwareCapsNeededTemp.get(); _vdsManager.setbeforeFirstRefresh(false); refreshedCapabilities = true; _saveVdsDynamic = true; processHardwareCapsNeeded = (processHardwareCapsNeeded) ? processHardwareCapsNeeded : flagsChanged; } else if (isVdsUpOrGoingToMaintenance || ((_vds.getStatus()) == (org.ovirt.engine.core.common.businessentities.VDSStatus.Error))) { return; } if ((_vds.getStatus()) != (org.ovirt.engine.core.common.businessentities.VDSStatus.Up)) { org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase logable = new org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase(_vds.getId()); logable.addCustomValue("HostStatus", _vds.getStatus().toString()); auditLog(logable, AuditLogType.VDS_DETECTED); } }
@java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object ReturnValue) { java.util.List<org.ovirt.engine.core.common.businessentities.network.NetworkQoS> networkQoSes = ((java.util.List<org.ovirt.engine.core.common.businessentities.network.NetworkQoS>) (ReturnValue)); getNetworkQoS().setItems(networkQoSes); getNetworkQoS().setSelectedItem(org.ovirt.engine.ui.uicommonweb.Linq.findNetworkQosById(networkQoSes, defaultQosId)); }
@java.lang.Override public void init(final org.ovirt.engine.ui.uicommonweb.models.gluster.GlusterVolumeGeoRepCreateModel model) { super.init(model); model.getPropertyChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { if (((org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs) (args)).propertyName.equalsIgnoreCase("RecommendationViolations")) { getView().setSuggestedConfigViolations(model.getRecommendationViolations()); } else if (((org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs) (args)).propertyName.equalsIgnoreCase("QueryFailed")) { getView().setFailureMessage(model.getQueryFailureMessage()); } } }); }
public static java.util.Collection<java.lang.String> replaceWith(java.lang.String propertyName, java.util.List<java.lang.Object> items) { int size = java.lang.Math.min(org.ovirt.engine.core.utils.ReplacementUtils.MAX_NUMBER_OF_PRINTED_ITEMS, items.size()); java.util.List<java.lang.String> printedItems = new java.util.ArrayList<java.lang.String>(size); for (int i = 0; i < size; i++) { printedItems.add(java.lang.String.format("\t%s", java.lang.String.valueOf(items.get(i)))); } if ((items.size()) > (org.ovirt.engine.core.utils.ReplacementUtils.MAX_NUMBER_OF_PRINTED_ITEMS)) { printedItems.add("\t..."); } java.util.ArrayList<java.lang.String> replacements = new java.util.ArrayList<java.lang.String>(); replacements.add(java.text.MessageFormat.format("${0} {1}", propertyName, org.apache.commons.lang.StringUtils.join(printedItems, ",\n"))); replacements.add(java.text.MessageFormat.format("${0}_COUNTER {1}", propertyName, items.size())); return replacements; }
protected boolean ValidateNotificationMethod(java.util.List<org.ovirt.engine.core.common.businessentities.EventNotificationMethod> eventNotificationMethods, org.ovirt.engine.core.common.businessentities.event_subscriber event_subscriber, org.ovirt.engine.core.common.businessentities.DbUser user) { boolean retValue = true; org.ovirt.engine.core.common.EventNotificationMethods notificationMethod = eventNotificationMethods.get(0).getmethod_type(); switch (notificationMethod) { case EMAIL : java.lang.String mailAdress = (org.apache.commons.lang.StringUtils.isEmpty(event_subscriber.getmethod_address())) ? user.getemail() : event_subscriber.getmethod_address(); if ((org.apache.commons.lang.StringUtils.isEmpty(mailAdress)) || (!(org.ovirt.engine.core.bll.EventSubscriptionCommandBase.ValidatMailAddress(mailAdress)))) { addCanDoActionMessage(VdcBllMessages.USER_DOES_NOT_HAVE_A_VALID_EMAIL); retValue = false; } break; default : addCanDoActionMessage(VdcBllMessages.EN_UNKNOWN_NOTIFICATION_METHOD); retValue = false; break; } return retValue; }
protected void setObjectName(java.lang.Object object, java.lang.String name) { ((org.ovirt.engine.ui.uicommonweb.models.vms.ImportVmData) (object)).getVm().setName(name); }
java.lang.String storageIscsiAvailableActionsForActiveDomainsLabel();
@java.lang.Override public java.lang.String toString() { return java.lang.String.format("%s, storageDomain=%s, args=%s", super.toString(), getStorageDomain(), getArgs()); }
protected void handleSetMessageQueryResult(org.ovirt.engine.ui.uicompat.FrontendMultipleQueryAsyncResult result) { setHelpTag(getRemoveQosHelpTag()); setHashName(getRemoveQosHashName()); int index = 0; int numberOfTimesUsedByDiskProfiles = 0; java.util.ArrayList<java.lang.String> list = new java.util.ArrayList<>(); for (org.ovirt.engine.core.common.queries.QueryReturnValue returnValue : result.getReturnValues()) { java.util.List<org.ovirt.engine.core.common.businessentities.Nameable> diskProfileEntities = returnValue.getReturnValue(); java.lang.String qosName = sourceListModel.getSelectedItems().get(index).getName(); if ((diskProfileEntities.size()) == 0) { list.add(qosName); } else { numberOfTimesUsedByDiskProfiles += diskProfileEntities.size(); java.util.List<java.lang.String> diskProfileNames = new java.util.ArrayList<>(); for (org.ovirt.engine.core.common.businessentities.Nameable diskProfileEntity : diskProfileEntities) { java.lang.String diskProfileName = diskProfileEntity.getName(); diskProfileNames.add(diskProfileName); } java.lang.String diskProfileNamesAsString = java.lang.String.join(", ", diskProfileNames); list.add(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getMessages().removeStorageQoSItem(qosName, diskProfileNamesAsString)); } index++; } setMessage(getRemoveQosMessage(numberOfTimesUsedByDiskProfiles)); setItems(list); }
protected void loadTemplateData(org.ovirt.engine.core.common.businessentities.VmTemplate template) { org.ovirt.engine.core.bll.utils.VmDeviceUtils.setVmDevices(template); if (((template.getInterfaces()) == null) || (template.getInterfaces().isEmpty())) { template.setInterfaces(getVmNetworkInterfaceDao().getAllForTemplate(template.getId())); } }
public java.util.List<org.ovirt.engine.core.compat.Guid> loadStorageDomainIdsForOvfIds(java.util.Collection<org.ovirt.engine.core.compat.Guid> ovfIds);
@java.lang.Override protected java.util.Map<java.lang.String, org.ovirt.engine.core.common.utils.Pair<java.lang.String, java.lang.String>> getExclusiveLocks() { if (!(org.ovirt.engine.core.bll.gluster.GeoRepSessionCommandBase.isInternalExecution())) { return java.util.Collections.singletonMap(getGeoRepSession().getId().toString(), org.ovirt.engine.core.bll.LockMessagesMatchUtil.makeLockingPair(LockingGroup.GLUSTER_GEOREP, EngineMessage.ACTION_TYPE_FAILED_GEOREP_SESSION_LOCKED)); } return null; }
@org.junit.Test public void canDoAction_vmNameExists_Test() { doReturn(new org.ovirt.engine.core.common.scheduling.AffinityGroup()).when(affinityGroupDao).getByName(anyString()); org.ovirt.engine.core.bll.CanDoActionTestUtils.runAndAssertCanDoActionFailure(command, EngineMessage.ACTION_TYPE_FAILED_AFFINITY_GROUP_NAME_EXISTS); }
public void forceRemove() { org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel model = new org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel(); setWindow(model); model.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().forceRemoveDataCenterTitle()); model.setHelpTag(HelpTag.force_remove_data_center); model.setHashName("force_remove_data_center"); model.getLatch().setIsAvailable(true); model.getLatch().setIsChangable(true); java.util.ArrayList<java.lang.String> list = new java.util.ArrayList<java.lang.String>(); for (org.ovirt.engine.core.common.businessentities.StoragePool a : org.ovirt.engine.ui.uicommonweb.Linq.<org.ovirt.engine.core.common.businessentities.StoragePool>cast(getSelectedItems())) { list.add(a.getName()); } model.setItems(list); org.ovirt.engine.ui.uicommonweb.UICommand tempVar = new org.ovirt.engine.ui.uicommonweb.UICommand("OnForceRemove", this); tempVar.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().ok()); tempVar.setIsDefault(true); model.getCommands().add(tempVar); org.ovirt.engine.ui.uicommonweb.UICommand tempVar2 = new org.ovirt.engine.ui.uicommonweb.UICommand("Cancel", this); tempVar2.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().cancel()); tempVar2.setIsCancel(true); model.getCommands().add(tempVar2); }
@java.lang.Override protected void executeCommand() { org.ovirt.engine.core.compat.Guid taskId = persistAsyncTaskPlaceHolder(VdcActionType.RemoveVmTemplate); org.ovirt.engine.core.common.vdscommands.VDSReturnValue vdsReturnValue = runVdsCommand(VDSCommandType.DeleteImageGroup, org.ovirt.engine.core.bll.storage.domain.PostZeroHandler.fixParametersWithPostZero(new org.ovirt.engine.core.common.vdscommands.DeleteImageGroupVDSCommandParameters(org.ovirt.engine.core.bll.RemoveTemplateSnapshotCommand.getParameters().getStoragePoolId(), org.ovirt.engine.core.bll.RemoveTemplateSnapshotCommand.getParameters().getStorageDomainId(), org.ovirt.engine.core.bll.RemoveTemplateSnapshotCommand.getParameters().getImageGroupID(), org.ovirt.engine.core.bll.RemoveTemplateSnapshotCommand.getParameters().getWipeAfterDelete(), false))); if (vdsReturnValue.getSucceeded()) { org.ovirt.engine.core.bll.RemoveTemplateSnapshotCommand.getReturnValue().getInternalVdsmTaskIdList().add(createTask(taskId, vdsReturnValue.getCreationInfo(), VdcActionType.RemoveVmTemplate, VdcObjectType.Storage, org.ovirt.engine.core.bll.RemoveTemplateSnapshotCommand.getParameters().getStorageDomainId())); org.ovirt.engine.core.bll.RemoveTemplateSnapshotCommand.setSucceeded(true); } }
@java.lang.Override public void onClick(com.google.gwt.event.dom.client.ClickEvent event) { org.ovirt.engine.ui.uicommonweb.models.OptionsModel model = optionsProvider.getModel(); model.executeCommand(model.getEditCommand()); }
@java.lang.Override protected void executeCommand() { org.ovirt.engine.core.common.action.HostSetupNetworksParameters params = new org.ovirt.engine.core.common.action.HostSetupNetworksParameters(org.ovirt.engine.core.bll.network.host.AddNetworkAttachmentCommand.getParameters().getVdsId()); org.ovirt.engine.core.common.businessentities.network.NetworkAttachment networkAttachment = org.ovirt.engine.core.bll.network.host.AddNetworkAttachmentCommand.getParameters().getNetworkAttachment(); params.getNetworkAttachments().add(networkAttachment); org.ovirt.engine.core.compat.Guid networkId = networkAttachment.getNetworkId(); org.ovirt.engine.core.compat.Guid nicId = networkAttachment.getNicId(); org.ovirt.engine.core.common.action.VdcReturnValueBase returnValue = runInternalAction(VdcActionType.HostSetupNetworks, params); if (returnValue.getSucceeded()) { org.ovirt.engine.core.compat.Guid createdAttachmentId = resolveCreatedAttachmentId(networkId, nicId); org.ovirt.engine.core.bll.network.host.AddNetworkAttachmentCommand.getReturnValue().setActionReturnValue(createdAttachmentId); } else { propagateFailure(returnValue); } setSucceeded(returnValue.getSucceeded()); }
@org.junit.Test public void testGustIp() { org.ovirt.engine.core.common.businessentities.VM vm = new org.ovirt.engine.core.common.businessentities.VM(); org.ovirt.engine.core.common.businessentities.VmDynamic vmDynamic = new org.ovirt.engine.core.common.businessentities.VmDynamic(); vmDynamic.setStatus(VMStatus.Up); vmDynamic.setVmIp("2.2.2.2"); vm.setDynamicData(vmDynamic); org.ovirt.engine.api.model.VM map = org.ovirt.engine.api.restapi.types.VmMapper.map(vm, ((org.ovirt.engine.api.model.VM) (null))); }
public static org.ovirt.engine.core.common.businessentities.VmNumaNode createVmNumaNode(int index, java.util.List<org.ovirt.engine.core.common.businessentities.VdsNumaNode> vdsNumaNodes) { org.ovirt.engine.core.common.businessentities.VmNumaNode numaNode = org.ovirt.engine.core.bll.utils.NumaTestUtils.createVmNumaNode(index); final java.util.List<java.lang.Integer> numaPinning = new java.util.ArrayList<>(); for (org.ovirt.engine.core.common.businessentities.VdsNumaNode vdsNumaNode : vdsNumaNodes) { numaPinning.add(vdsNumaNode.getIndex()); } numaNode.setVdsNumaNodeList(numaPinning); return numaNode; }
private void Run() { java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase> list = new java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase>(); for (java.lang.Object item : getSelectedItems()) { org.ovirt.engine.core.common.businessentities.VM a = ((org.ovirt.engine.core.common.businessentities.VM) (item)); boolean reinitialize = (!(a.isInitialized())) && (org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.IsWindowsOsType(a.getVmOs())); org.ovirt.engine.core.common.action.RunVmParams tempVar = new org.ovirt.engine.core.common.action.RunVmParams(a.getId()); tempVar.setReinitialize(reinitialize); list.add(tempVar); } org.ovirt.engine.ui.frontend.Frontend.RunMultipleAction(VdcActionType.RunVm, list, new org.ovirt.engine.ui.uicompat.IFrontendMultipleActionAsyncCallback() { @java.lang.Override public void Executed(org.ovirt.engine.ui.uicompat.FrontendMultipleActionAsyncResult result) { } }, null); }
@java.lang.Override public void setColumnId(java.lang.String columnId) { this.columnId = columnId; }
@org.junit.Test public void testJsonEmptyDiskDescription() throws java.io.IOException { disk1.setDiskAlias("DiskAlias"); disk1.setDiskDescription(""); org.ovirt.engine.core.bll.ImagesHandlerTest.assertDiskDescriptionMap(disk1); }
@java.lang.Override public java.lang.String getValue(org.ovirt.engine.core.common.businessentities.DiskImage disk) { org.ovirt.engine.ui.uicommonweb.models.vms.ImportDiskData importData = importModel.getDiskImportData(disk.getId()); java.util.ArrayList<java.lang.String> storageDomainsNameList = new java.util.ArrayList<java.lang.String>(); org.ovirt.engine.core.common.businessentities.StorageDomain selectedStorageDomain = null; if ((importData != null) && ((importData.getStorageDomains()) != null)) { for (org.ovirt.engine.core.common.businessentities.StorageDomain storageDomain : importData.getStorageDomains()) { storageDomainsNameList.add(new org.ovirt.engine.ui.common.widget.renderer.StorageDomainFreeSpaceRenderer<org.ovirt.engine.core.common.businessentities.StorageDomain>().render(storageDomain)); if ((importData.getSelectedStorageDomain()) != null) { if (storageDomain.getId().equals(importData.getSelectedStorageDomain().getId())) { selectedStorageDomain = storageDomain; } } } } ((org.ovirt.engine.ui.webadmin.widget.table.column.CustomSelectionCell) (getCell())).setOptions(storageDomainsNameList); if (!(storageDomainsNameList.isEmpty())) { if (selectedStorageDomain != null) { return new org.ovirt.engine.ui.common.widget.renderer.StorageDomainFreeSpaceRenderer<org.ovirt.engine.core.common.businessentities.StorageDomain>().render(selectedStorageDomain); } else { return storageDomainsNameList.get(0); } } return ""; }
public boolean isUpdateSignature(org.ovirt.api.metamodel.concepts.Method method) { return ((method.getBase()) != null) && (method.getBase().getName().equals(org.ovirt.api.metamodel.tool.util.JaxrsGeneratorUtils.UPDATE)); }
private void initStorageOvfExtraData(org.ovirt.engine.core.compat.Guid storageDomainId, java.util.List<org.ovirt.engine.core.common.businessentities.OvfEntityData> ovfEntityDataFromTar, java.nio.ByteBuffer metaDataBuffer) { java.util.Map<java.lang.String, java.lang.Object> diskDescriptionMap; java.lang.String storageMetaData = new java.lang.String(metaDataBuffer.array()); try { diskDescriptionMap = org.ovirt.engine.core.utils.JsonHelper.jsonToMap(storageMetaData); } catch (java.io.IOException e) { org.ovirt.engine.core.utils.OvfUtils.log.error("Failed to convert storage ovf extra data from json to map: '{}'.", storageMetaData); e.printStackTrace(); return; } setVmsStatus(storageDomainId, diskDescriptionMap, ovfEntityDataFromTar); }
@java.lang.Override public org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.common.businessentities.VM, org.ovirt.engine.core.common.businessentities.VmDevice> mapRow(java.sql.ResultSet rs, int rowNum) throws java.sql.SQLException { @java.lang.SuppressWarnings("synthetic-access") org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.common.businessentities.VM, org.ovirt.engine.core.common.businessentities.VmDevice> entity = new org.ovirt.engine.core.common.utils.Pair(); entity.setFirst(org.ovirt.engine.core.dao.VmDaoImpl.VMRowMapper.instance.mapRow(rs, rowNum)); entity.setSecond(VmDeviceDaoImpl.VmDeviceRowMapper.instance.mapRow(rs, rowNum)); return entity; }
private void storeIpv6(org.ovirt.engine.core.common.businessentities.VmInitNetwork iface, java.lang.StringBuilder output) { storeIp("inet6", new org.ovirt.engine.core.utils.network.vm.VmInitNetworkIpv6InfoFetcher(iface), output); }
java.lang.String[] dnsServers();
protected org.ovirt.engine.core.common.businessentities.LdapUser populateUserData(org.ovirt.engine.core.common.businessentities.LdapUser user, java.lang.String domain) { if (user == null) { return null; } user.setDomainControler(domain); java.util.HashMap<java.lang.String, org.ovirt.engine.core.common.businessentities.LdapGroup> groupsDict = new java.util.HashMap<java.lang.String, org.ovirt.engine.core.common.businessentities.LdapGroup>(); org.ovirt.engine.core.bll.adbroker.GroupsDNQueryGenerator generator = new org.ovirt.engine.core.bll.adbroker.GroupsDNQueryGenerator(); proceedGroupsSearchResult(user.getMemberof(), groupsDict, generator); user.setGroups(groupsDict); return user; }
private static org.ovirt.engine.core.common.businessentities.StoragePool createNewStoragePool() { org.ovirt.engine.core.common.businessentities.StoragePool pool = org.ovirt.engine.core.bll.storage.UpdateStoragePoolCommandTest.createBasicPool(); pool.setIsLocal(false); pool.setcompatibility_version(org.ovirt.engine.core.bll.storage.UpdateStoragePoolCommandTest.VERSION_1_1); return pool; }
public boolean validateVmProperties(org.ovirt.engine.core.common.businessentities.VM vm, java.util.List<java.lang.String> messages) { java.util.List<org.ovirt.engine.core.utils.customprop.VmPropertiesUtils.ValidationError> validationErrors = getVmPropertiesUtils().validateVMProperties(vm.getVdsGroupCompatibilityVersion(), vm.getStaticData()); if (!(validationErrors.isEmpty())) { org.ovirt.engine.core.bll.VmHandler.handleCustomPropertiesError(validationErrors, messages); return false; } return true; }
@java.lang.Override protected boolean validate() { org.ovirt.engine.core.common.businessentities.Tags tag = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getTagDao().getByName(org.ovirt.engine.core.bll.UpdateTagCommand.getParameters().getTag().getTagName()); if ((tag != null) && (!(tag.getTagId().equals(org.ovirt.engine.core.bll.UpdateTagCommand.getParameters().getTag().getTagId())))) { addValidationMessage(EngineMessage.TAGS_SPECIFY_TAG_IS_IN_USE); return false; } tag = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getTagDao().get(org.ovirt.engine.core.bll.UpdateTagCommand.getParameters().getTag().getTagId()); if (((tag.getIsReadonly()) != null) && (tag.getIsReadonly())) { addValidationMessage(EngineMessage.TAGS_CANNOT_EDIT_READONLY_TAG); return false; } return true; }
protected static void reportUnsupportedVnicProfileFeatures(org.ovirt.engine.core.common.businessentities.VM vm, org.ovirt.engine.core.common.businessentities.network.VmNic nic, org.ovirt.engine.core.common.businessentities.network.VnicProfile vnicProfile, java.util.List<org.ovirt.engine.core.vdsbroker.vdsbroker.VmInfoBuilderBase.VnicProfileProperties> unsupportedFeatures) { if (unsupportedFeatures.isEmpty()) { return; } org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase event = new org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase(); event.setVmId(vm.getId()); event.setClusterId(vm.getClusterId()); event.setCustomId(nic.getId().toString()); event.setCompatibilityVersion(vm.getCompatibilityVersion().toString()); event.addCustomValue("NicName", nic.getName()); event.addCustomValue("VnicProfile", (vnicProfile == null ? null : vnicProfile.getName())); java.lang.String[] unsupportedFeatureNames = new java.lang.String[unsupportedFeatures.size()]; for (int i = 0; i < (unsupportedFeatures.size()); i++) { unsupportedFeatureNames[i] = unsupportedFeatures.get(i).getFeatureName(); } event.addCustomValue("UnsupportedFeatures", org.apache.commons.lang.StringUtils.join(unsupportedFeatureNames, ", ")); new org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogDirector().log(event, AuditLogType.VNIC_PROFILE_UNSUPPORTED_FEATURES); }
private void setVolumeOptions(org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity volume) { java.util.List<java.lang.String> errors = new java.util.ArrayList<>(); for (org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeOptionEntity option : volume.getOptions()) { option.setVolumeId(volume.getId()); org.ovirt.engine.core.common.action.VdcReturnValueBase setOptionReturnValue = runInternalAction(VdcActionType.SetGlusterVolumeOption, new org.ovirt.engine.core.common.action.gluster.GlusterVolumeOptionParameters(option), createCommandContext(volume, option)); if (!(setOptionReturnValue.getSucceeded())) { setSucceeded(false); errors.addAll(setOptionReturnValue.getValidationMessages()); errors.addAll(setOptionReturnValue.getExecuteFailedMessages()); } } if (!(errors.isEmpty())) { handleVdsErrors(AuditLogType.GLUSTER_VOLUME_OPTION_SET_FAILED, errors); } }
public void persistCommandAssociatedEntities(java.util.Collection<org.ovirt.engine.core.common.businessentities.CommandAssociatedEntity> cmdAssociatedEntities) { org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getCommandEntityDao().insertCommandAssociatedEntities(cmdAssociatedEntities); }
@com.gwtplatform.mvp.client.annotations.ProxyEvent public void onUiCommonInit(org.ovirt.engine.ui.common.uicommon.model.UiCommonInitEvent event) { modelProvider.getModel().getEntityChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { java.lang.Object entity = modelProvider.getModel().getEntity(); if (entity != null) { onDetailModelEntityChange(entity); } } }); modelProvider.getModel().getPropertyChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs pcArgs = ((org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs) (args)); if (PropertyChangedEventArgs.PROGRESS.equals(pcArgs.propertyName)) { if ((modelProvider.getModel().getProgress()) != null) { com.google.gwt.core.client.Scheduler.get().scheduleDeferred(new com.google.gwt.core.client.Scheduler.ScheduledCommand() { @java.lang.Override public void execute() { if ((getTable()) != null) { getTable().setLoadingState(LoadingState.LOADING); } } }); } } } }); }
@java.lang.SuppressWarnings("unchecked") @java.lang.Override public org.ovirt.engine.api.model.GlusterBricks list() { java.util.List<org.ovirt.engine.core.common.businessentities.gluster.GlusterBrickEntity> bricks = getBackendCollection(VdcQueryType.GetGlusterVolumeBricks, new org.ovirt.engine.core.common.queries.gluster.IdQueryParameters(asGuid(getVolumeId()))); return mapCollection(bricks); }
public boolean isEligibleForCheckUpdates() { return ((this) == (org.ovirt.engine.core.common.businessentities.VDSStatus.Up)) || ((this) == (org.ovirt.engine.core.common.businessentities.VDSStatus.NonOperational)); }
@java.lang.Override public void onSuccess(final java.util.List<org.ovirt.engine.ui.frontend.communication.VdcOperation<org.ovirt.engine.core.common.action.VdcActionType, org.ovirt.engine.core.common.action.VdcActionParametersBase>> operationList, final java.util.List<org.ovirt.engine.core.common.action.VdcReturnValueBase> resultObject) { org.ovirt.engine.ui.frontend.Frontend.logger.finer("Frontend: successfully executed runMultipleAction, determining result!"); java.util.ArrayList<org.ovirt.engine.core.common.action.VdcReturnValueBase> failed = new java.util.ArrayList<org.ovirt.engine.core.common.action.VdcReturnValueBase>(); for (org.ovirt.engine.core.common.action.VdcReturnValueBase v : resultObject) { if (!(v.getCanDoAction())) { failed.add(v); } } if (!(failed.isEmpty())) { translateErrors(failed); getEventsHandler().runMultipleActionFailed(actionType, failed); } if (callback != null) { callback.executed(new org.ovirt.engine.ui.uicompat.FrontendMultipleActionAsyncResult(actionType, parameters, resultObject, state)); } fireAsyncOperationCompleteEvent(state); org.ovirt.engine.ui.frontend.communication.RefreshActiveModelEvent.fire(this, true); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Are you sure you want to Power Off the following Virtual Machines?") java.lang.String areYouSureYouWantToStopTheFollowingVirtualMachinesMsg();
public static void GetVmTemplatesWithPermittedAction(org.ovirt.engine.ui.frontend.AsyncQuery aQuery, org.ovirt.engine.core.common.businessentities.ActionGroup actionGroup) { aQuery.converterCallback = new org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.TemplateConverter(); org.ovirt.engine.core.common.queries.GetEntitiesWithPermittedActionParameters getEntitiesWithPermittedActionParameters = new org.ovirt.engine.core.common.queries.GetEntitiesWithPermittedActionParameters(); getEntitiesWithPermittedActionParameters.setActionGroup(actionGroup); org.ovirt.engine.ui.frontend.Frontend.RunQuery(VdcQueryType.GetVmTemplatesWithPermittedAction, getEntitiesWithPermittedActionParameters, aQuery); }
@java.lang.Override public org.ovirt.engine.api.model.StorageDomain update(org.ovirt.engine.api.model.StorageDomain incoming) { validateEnums(org.ovirt.engine.api.model.StorageDomain.class, incoming); org.ovirt.engine.api.restapi.resource.QueryIdResolver<org.ovirt.engine.core.compat.Guid> storageDomainResolver = new org.ovirt.engine.api.restapi.resource.QueryIdResolver<org.ovirt.engine.core.compat.Guid>(org.ovirt.engine.core.common.queries.VdcQueryType.GetStorageDomainById, org.ovirt.engine.core.common.queries.IdQueryParameters.class); org.ovirt.engine.core.common.businessentities.StorageDomain entity = getEntity(storageDomainResolver, true); org.ovirt.engine.api.model.StorageDomain model = map(entity, new org.ovirt.engine.api.model.StorageDomain()); org.ovirt.engine.core.common.businessentities.storage.StorageType storageType = entity.getStorageType(); if (storageType != null) { switch (storageType) { case ISCSI : case FCP : extendStorageDomain(incoming, model, storageType); break; default : break; } } return addLinks(performUpdate(incoming, entity, model, storageDomainResolver, VdcActionType.UpdateStorageDomain, new org.ovirt.engine.api.restapi.resource.BackendStorageDomainResource.UpdateParametersProvider()), new java.lang.String[]{ "templates", "vms" }); }
private void copyVmPermissions(org.ovirt.engine.core.bll.UniquePermissionsSet permissionsToAdd) { if ((!(isVmInDb)) || (!(org.ovirt.engine.core.bll.AddVmTemplateCommand.getParameters().isCopyVmPermissions()))) { return; } org.ovirt.engine.core.dao.PermissionDAO dao = org.ovirt.engine.core.bll.AddVmTemplateCommand.getDbFacade().getPermissionDao(); java.util.List<org.ovirt.engine.core.common.businessentities.Permissions> vmPermissions = dao.getAllForEntity(org.ovirt.engine.core.bll.AddVmTemplateCommand.getVmId(), org.ovirt.engine.core.bll.AddVmTemplateCommand.getEngineSessionSeqId(), false); for (org.ovirt.engine.core.common.businessentities.Permissions vmPermission : vmPermissions) { permissionsToAdd.addPermission(vmPermission.getad_element_id(), vmPermission.getrole_id(), org.ovirt.engine.core.bll.AddVmTemplateCommand.getParameters().getVmTemplateId(), VdcObjectType.VmTemplate); } }
@java.lang.Override protected void initializeModelHandlers() { super.initializeModelHandlers(); getModel().getResetRequestedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener<org.ovirt.engine.ui.uicompat.EventArgs>() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.EventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { java.util.ArrayList<org.ovirt.engine.ui.uicommonweb.models.SystemTreeItemModel> items = getModel().getItems(); if ((items != null) && (!(items.isEmpty()))) { selectionModel.setSelected(items.get(0), true); } } }); }
@org.junit.Test public void testExecuteQueryNotSupported() { setup(org.ovirt.engine.core.bll.network.host.GetMultipleTlvsByHostIdTest.ExpectedError.NOT_SUPPORTED); getQuery().executeQueryCommand(); java.util.Map<java.lang.String, org.ovirt.engine.core.common.businessentities.network.LldpInfo> returnValue = getQuery().getQueryReturnValue().getReturnValue(); assertEquals(returnValue, null); }
protected void setGetNetworksQueryExpectations(int times, java.util.List<org.ovirt.engine.core.common.businessentities.Network> networks) throws java.lang.Exception { while ((times--) > 0) { setUpEntityQueryExpectations(VdcQueryType.GetAllNetworksByClusterId, org.ovirt.engine.core.common.queries.VdsGroupQueryParamenters.class, new java.lang.String[]{ "VdsGroupId" }, new java.lang.Object[]{ GUIDS[0] }, networks); } }
@org.ovirt.engine.core.utils.lock.AcquireWriteLock java.util.List<java.lang.String> allocateMacAddresses(int numberOfAddresses);
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Allow to Edit Cluster properties") java.lang.String allowToEditClusterPropertiesRoleTreeTooltip();
public static void GetExternalProviderHostList(org.ovirt.engine.ui.frontend.AsyncQuery aQuery, org.ovirt.engine.core.compat.Guid providerId, boolean filterOutExistingHosts, java.lang.String searchFilter) { aQuery.converterCallback = new org.ovirt.engine.ui.frontend.IAsyncConverter() { @java.lang.Override public java.lang.Object Convert(java.lang.Object source, org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery) { if (source == null) { return new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VDS>(); } return source; } }; org.ovirt.engine.ui.frontend.Frontend.RunQuery(VdcQueryType.GetHostListFromExternalProvider, new org.ovirt.engine.core.common.queries.GetHostListFromExternalProviderParameters(providerId, filterOutExistingHosts, searchFilter), aQuery); }
@java.lang.Override public org.ovirt.engine.api.model.ClusterFeatures list() { org.ovirt.engine.api.model.ClusterFeatures features = new org.ovirt.engine.api.model.ClusterFeatures(); java.util.Set<org.ovirt.engine.core.common.businessentities.SupportedAdditionalClusterFeature> addlFeatures = getOptionalEntity(java.util.Set.class, VdcQueryType.GetClusterFeaturesByClusterId, new org.ovirt.engine.core.common.queries.IdQueryParameters(clusterId), clusterId.toString(), false); if (addlFeatures != null) { for (org.ovirt.engine.core.common.businessentities.SupportedAdditionalClusterFeature entity : addlFeatures) { if (entity.isEnabled()) { features.getClusterFeatures().add(addLinks(map(entity.getFeature(), null))); } } } return features; }
@org.junit.Test public void testIscsiLunDiskWithNoAddressCantBeAdded() { org.ovirt.engine.core.common.businessentities.storage.LunDisk disk = org.ovirt.engine.core.bll.storage.disk.AddDiskCommandTest.createISCSILunDisk(); org.ovirt.engine.core.common.action.AddDiskParameters parameters = org.ovirt.engine.core.bll.storage.disk.AddDiskCommandTest.createParameters(); parameters.setDiskInfo(disk); initializeCommand(org.ovirt.engine.core.compat.Guid.newGuid(), parameters); disk.getLun().getLunConnections().get(0).setConnection(null); assertFalse("checkIfLunDiskCanBeAdded() succeded for ISCSI lun which LUNs has storage_server_connection with a null address", command.checkIfLunDiskCanBeAdded(spyDiskValidator(disk))); assertTrue("checkIfLunDiskCanBeAdded() failed but correct can do action hasn't been added to the return response", verifyValidationMessagesContainMessage(EngineMessage.ACTION_TYPE_FAILED_DISK_LUN_ISCSI_MISSING_CONNECTION_PARAMS)); clearValidationMessages(); disk.getLun().getLunConnections().get(0).setConnection(""); assertFalse("checkIfLunDiskCanBeAdded() succeded for ISCSI lun which LUNs has storage_server_connection with a empty address", command.checkIfLunDiskCanBeAdded(spyDiskValidator(disk))); assertTrue("checkIfLunDiskCanBeAdded() failed but correct can do action hasn't been added to the return response", verifyValidationMessagesContainMessage(EngineMessage.ACTION_TYPE_FAILED_DISK_LUN_ISCSI_MISSING_CONNECTION_PARAMS)); }
@org.junit.Test public void getHugeMemoryFitsIntoOneHugePage() { org.ovirt.engine.core.common.businessentities.VmBase base = new org.ovirt.engine.core.common.businessentities.VmBase(); base.setCustomProperties("hugepages=1048576"); base.setMemSizeMb(1024); assertThat(org.ovirt.engine.core.common.utils.HugePageUtils.getHugePages(base).size(), is(1)); assertThat(org.ovirt.engine.core.common.utils.HugePageUtils.getHugePages(base).get(1048576), is(1)); }
public void setVdsName(java.lang.String value) { this.mVdsStatic.setVdsName(value); }
@java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StoragePool> pools = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StoragePool>) (returnValue)); org.ovirt.engine.core.common.businessentities.StoragePool pool = pools.get(0); if (pool != null) { org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getStorageDomainList(((org.ovirt.engine.ui.frontend.AsyncQuery) (model)), pool.getId()); } }
@java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.EventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { if ((disk.getVm()) == null) { return; } boolean isVirtioScsiEnabled = java.lang.Boolean.TRUE.equals(((org.ovirt.engine.ui.uicommonweb.models.EntityModel) (sender)).getEntity()); interfaceInfoIcon.setVisible((!isVirtioScsiEnabled)); }
public org.ovirt.engine.core.bll.ValidationResult networkNotUsedByRunningVms() { java.util.List<org.ovirt.engine.core.common.businessentities.VM> runningVms = new java.util.ArrayList<>(); java.util.List<org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface> vnics = getDbFacade().getVmNetworkInterfaceDao().getAllForNetwork(network.getId()); java.util.Map<org.ovirt.engine.core.compat.Guid, java.util.List<org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface>> vnicsByVmId = org.ovirt.engine.core.common.businessentities.Entities.vmInterfacesByVmId(vnics); for (org.ovirt.engine.core.common.businessentities.VM vm : getVms()) { if (vm.isRunningOrPaused()) { for (org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface nic : vnicsByVmId.get(vm.getId())) { if (org.ovirt.engine.core.bll.common.predicates.VmNetworkCanBeUpdatedPredicate.getInstance().eval(nic)) { runningVms.add(vm); break; } } } } return networkNotUsed(runningVms, EngineMessage.VAR__ENTITIES__VMS, EngineMessage.VAR__ENTITIES__VM); }
@java.lang.Override public void Executed(org.ovirt.engine.ui.uicompat.FrontendActionAsyncResult result) { org.ovirt.engine.core.common.action.VdcReturnValueBase ticketReturnValue = result.getReturnValue(); if ((ticketReturnValue != null) && ((ticketReturnValue.getActionReturnValue()) != null)) { otp64 = ((java.lang.String) (ticketReturnValue.getActionReturnValue())); if ((org.ovirt.engine.core.compat.StringHelper.isNullOrEmpty(getEntity().getdisplay_ip())) || (org.ovirt.engine.core.compat.StringHelper.stringsEqual(getEntity().getdisplay_ip(), "0"))) { org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery = new org.ovirt.engine.ui.frontend.AsyncQuery(); _asyncQuery.setModel(this); _asyncQuery.asyncCallback = new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void OnSuccess(java.lang.Object model, java.lang.Object ReturnValue) { org.ovirt.engine.ui.uicommonweb.models.vms.VncConsoleModel consoleModel = ((org.ovirt.engine.ui.uicommonweb.models.vms.VncConsoleModel) (model)); consoleModel.postGetHost(((java.lang.String) (((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (ReturnValue)).getReturnValue()))); } }; org.ovirt.engine.ui.frontend.Frontend.RunQuery(VdcQueryType.GetManagementInterfaceAddressByVdsId, new org.ovirt.engine.core.common.queries.VdsIdParametersBase(getEntity().getrun_on_vds().getValue()), _asyncQuery); } else { postGetHost(getEntity().getdisplay_ip()); } } }
public synchronized org.ovirt.engine.sdk.Api getConnection() throws java.io.IOException, org.ovirt.engine.sdk.exceptions.ServerException, org.ovirt.engine.sdk.exceptions.UnsecuredConnectionAttemptError { if ((api) == null) { java.lang.String url = java.lang.String.format("%s://%s:%s/ovirt-engine/api", protocol, server, port); org.ovirt.optimizer.service.OvirtClient.log.debug(java.lang.String.format("Logging to %s as %s", url, username)); api = new org.ovirt.engine.sdk.Api(url, username, password, null, null, requestTimeout, true, true, null, false); } return api; }
public static java.util.ArrayList<org.ovirt.engine.core.common.businessentities.LUNs> ParseLUNList(java.util.Map<java.lang.String, java.lang.Object>[] lunList) { java.util.ArrayList<org.ovirt.engine.core.common.businessentities.LUNs> result = new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.LUNs>(lunList.length); for (java.util.Map<java.lang.String, java.lang.Object> xlun : lunList) { result.add(org.ovirt.engine.core.vdsbroker.vdsbroker.GetDeviceListVDSCommand.ParseLunFromXmlRpc(xlun)); } return result; }
public org.ovirt.engine.core.bll.ValidationResult glusterNetworkSupported() { return (networkCluster.isGluster()) && (!(org.ovirt.engine.core.common.gluster.GlusterFeatureSupported.glusterNetworkRoleSupported(version))) ? new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.GLUSTER_NETWORK_NOT_SUPPORTED_FOR_POOL_LEVEL) : org.ovirt.engine.core.bll.ValidationResult.VALID; }
@java.lang.Override public org.ovirt.engine.core.vdsbroker.vdsbroker.VMListReturnForXmlRpc getExternalVmList(java.lang.String uri, java.lang.String username, java.lang.String password, java.util.List<java.lang.String> vmsNames) { org.ovirt.vdsm.jsonrpc.client.RequestBuilder requestBuilder = new org.ovirt.vdsm.jsonrpc.client.RequestBuilder("Host.getExternalVMs").withParameter("uri", uri).withParameter("username", username).withParameter("password", password).withOptionalParameterAsList("vm_names", vmsNames); org.ovirt.vdsm.jsonrpc.client.JsonRpcRequest request = requestBuilder.build(); java.util.Map<java.lang.String, java.lang.Object> response = new org.ovirt.engine.core.vdsbroker.jsonrpc.FutureMap(this.client, request).withResponseKey("vmList").withResponseType(java.lang.Object[].class); return new org.ovirt.engine.core.vdsbroker.vdsbroker.VMListReturnForXmlRpc(response); }
@org.ovirt.engine.ui.common.DefaultStringValue("Watchdog Action") java.lang.String watchdogAction();
private void onRemove() { final org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel model = ((org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel) (org.ovirt.engine.ui.uicommonweb.models.vms.VmListModel.getWindow())); if ((model.getProgress()) != null) { return; } final java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase> list = new java.util.ArrayList<>(); for (java.util.Map.Entry<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.ui.uicommonweb.models.EntityModel> entry : vmsRemoveMap.entrySet()) { list.add(new org.ovirt.engine.core.common.action.RemoveVmParameters(entry.getKey(), false, ((java.lang.Boolean) (entry.getValue().getEntity())))); } model.startProgress(null); org.ovirt.engine.ui.frontend.Frontend.getInstance().runMultipleAction(VdcActionType.RemoveVm, list, new org.ovirt.engine.ui.uicompat.IFrontendMultipleActionAsyncCallback() { @java.lang.Override public void executed(org.ovirt.engine.ui.uicompat.FrontendMultipleActionAsyncResult result) { org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel localModel = ((org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel) (result.getState())); localModel.stopProgress(); cancel(); } }, model); }
@org.junit.Test public void bridgePropertiesNonVm() { org.ovirt.engine.core.common.businessentities.network.Network network = createManagementNetwork(); network.setVmNetwork(false); mockExistingNetworks(network); org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface iface = createNicSyncedWithNetwork("eth0", network); mockExistingIfaces(iface); iface.setCustomProperties(createCustomProperties()); org.ovirt.engine.core.bll.network.host.SetupNetworksHelper helper = createHelper(createParametersForNics(iface), Version.v3_5); validateAndExpectViolation(helper, EngineMessage.ACTION_TYPE_FAILED_NETWORK_CUSTOM_PROPERTIES_BAD_INPUT, org.ovirt.engine.core.bll.network.host.SetupNetworksHelperTest.MANAGEMENT_NETWORK_NAME); }
private void updatePmModels() { boolean isPm = getIsPm().getEntity(); getPmProxyPreferencesList().setIsChangeable(getIsPm().getEntity()); getDisableAutomaticPowerManagement().setIsValid(true); getDisableAutomaticPowerManagement().setIsChangeable(isPm); getFenceAgentListModel().setIsChangeable(isPm); getPmKdumpDetection().setIsChangeable(isPm); getFenceAgentListModel().setIsChangeable(isPm); getFenceAgentListModel().setHost(this); }
public java.util.Map<java.lang.String, java.lang.Object> reconstructMaster(java.lang.String spUUID, java.lang.String poolName, java.lang.String masterDom, java.util.Map<java.lang.String, java.lang.String> domDict, int masterVersion, java.lang.String lockPolicy, int lockRenewalIntervalSec, int leaseTimeSec, int ioOpTimeoutSec, int leaseRetries, int hostSpmId);
@org.junit.Test public void testVmDuringSnaoshot() { setUpGeneralValidations(); doReturn(new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.dal.VdcBllMessages.ACTION_TYPE_FAILED_VM_IS_DURING_SNAPSHOT)).when(snapshotsValidator).vmNotDuringSnapshot(any(org.ovirt.engine.core.compat.Guid.class)); doReturn(org.ovirt.engine.core.bll.CreateAllSnapshotsFromVmCommandTest.getEmptyDiskList()).when(cmd).getDisksList(); assertFalse(cmd.canDoAction()); assertTrue(cmd.getReturnValue().getCanDoActionMessages().contains(VdcBllMessages.ACTION_TYPE_FAILED_VM_IS_DURING_SNAPSHOT.name())); }
public void setAuthUrl(java.lang.String authUrl) { this.authUrl = authUrl; }
public void engineInitialize() { createInternalAAAConfigurations(); createKerberosLdapAAAConfigurations(); for (java.io.File directory : org.ovirt.engine.core.utils.EngineLocalConfig.getInstance().getExtensionsDirectories()) { if (!(directory.exists())) { org.ovirt.engine.core.utils.extensionsmgr.EngineExtensionsManager.log.warn("The directory '{}' cotaning configuration files does not exist.", directory.getAbsolutePath()); } else { java.io.File[] files = directory.listFiles(); if (files != null) { java.util.Arrays.sort(files); for (java.io.File file : files) { if (file.getName().endsWith(".properties")) { try { load(file); } catch (java.lang.Exception ex) { org.ovirt.engine.core.utils.extensionsmgr.EngineExtensionsManager.log.error("Could not load extension based on configuration file '{}'. Please check the configuration file is valid. Exception message is: {}", file.getAbsolutePath(), ex.getMessage()); org.ovirt.engine.core.utils.extensionsmgr.EngineExtensionsManager.log.debug("", ex); } } } } } } for (org.ovirt.engine.core.extensions.mgr.ExtensionProxy extension : getLoadedExtensions()) { if (org.ovirt.engine.core.utils.EngineLocalConfig.getInstance().getBoolean(((org.ovirt.engine.core.utils.extensionsmgr.EngineExtensionsManager.ENGINE_EXTENSION_ENABLED) + (extension.getContext().<java.lang.String>get(Base.ContextKeys.INSTANCE_NAME))), java.lang.Boolean.parseBoolean(extension.getContext().<java.util.Properties>get(Base.ContextKeys.CONFIGURATION).getProperty(Base.ConfigKeys.ENABLED, "true")))) { initialize(extension.getContext().<java.lang.String>get(Base.ContextKeys.INSTANCE_NAME)); } } dump(); }
public void setSkipFencingIfConnectivityBrokenEnabled(org.ovirt.engine.ui.uicommonweb.models.EntityModel<java.lang.Boolean> skipFencingIfConnectivityBrokenEnabled) { this.skipFencingIfConnectivityBrokenEnabled = skipFencingIfConnectivityBrokenEnabled; }
@org.junit.Test public void testNetworkAttachedToClusterWhenNotAttached() throws java.lang.Exception { org.ovirt.engine.core.common.businessentities.network.Network network = new org.ovirt.engine.core.common.businessentities.network.Network(); network.setId(org.ovirt.engine.core.compat.Guid.newGuid()); org.ovirt.engine.core.common.businessentities.network.NetworkAttachment attachment = new org.ovirt.engine.core.common.businessentities.network.NetworkAttachment(); attachment.setNetworkId(network.getId()); org.ovirt.engine.core.common.businessentities.network.NetworkClusterId networkClusterId = new org.ovirt.engine.core.common.businessentities.network.NetworkClusterId(host.getVdsGroupId(), network.getId()); when(networkClusterDaoMock.get(eq(networkClusterId))).thenReturn(null); when(networkDaoMock.get(eq(network.getId()))).thenReturn(network); assertThat(createNetworkAttachmentValidator(attachment).networkAttachedToCluster(), org.ovirt.engine.core.bll.validator.ValidationResultMatchers.failsWith(EngineMessage.NETWORK_NOT_EXISTS_IN_CLUSTER)); }
private void registerHandlers() { model.getPropertyChangedEvent().addListener(( ev, sender, args) -> { java.lang.String propName = args.propertyName; if ((Model.PROP_WINDOW.equals(propName)) && ((model.getWindow()) == null)) { if (model.getSpecificClusterQuota().getEntity()) { quotaClusterTable.asEditor().edit(model.getAllDataCenterClusters()); } else { quotaClusterTable.asEditor().edit(model.getQuotaClusters()); } if (model.getSpecificStorageQuota().getEntity()) { quotaStorageTable.asEditor().edit(model.getAllDataCenterStorages()); } else { quotaStorageTable.asEditor().edit(model.getQuotaStorages()); } } }); model.getSpecificClusterQuota().getEntityChangedEvent().addListener(clusterListener); model.getSpecificStorageQuota().getEntityChangedEvent().addListener(storageListener); }
@java.lang.SuppressWarnings("deprecation") @java.lang.Override public org.ovirt.engine.core.dal.dbbroker.MapSqlParameterMapper<org.ovirt.engine.core.common.businessentities.gluster.GlusterHookEntity> getBatchMapper() { throw new org.ovirt.engine.core.compat.NotImplementedException("Unsupported operation"); }
public org.ovirt.engine.core.bll.ValidationResult isDiskAttachedToVm(org.ovirt.engine.core.common.businessentities.VM vm) { java.util.List<org.ovirt.engine.core.common.businessentities.VM> vms = getVmDao().getVmsListForDisk(disk.getId(), true); java.lang.String[] replacements = new java.lang.String[]{ org.ovirt.engine.core.utils.ReplacementUtils.createSetVariableString(org.ovirt.engine.core.bll.validator.storage.DiskValidator.DISK_NAME_VARIABLE, disk.getDiskAlias()), org.ovirt.engine.core.utils.ReplacementUtils.createSetVariableString(org.ovirt.engine.core.bll.validator.storage.DiskValidator.VM_NAME_VARIABLE, vm.getName()) }; return org.ovirt.engine.core.bll.ValidationResult.failWith(EngineMessage.ACTION_TYPE_FAILED_DISK_NOT_ATTACHED_TO_VM, replacements).when(vms.stream().noneMatch(( vm1) -> vm1.getId().equals(vm.getId()))); }
protected java.lang.String getSizeString(java.lang.Double size, org.ovirt.engine.core.common.utils.SizeConverter.SizeUnit inUnit) { if (size == null) { return constants.notAvailableLabel(); } else { org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.common.utils.SizeConverter.SizeUnit, java.lang.Double> sizeWithUnits = org.ovirt.engine.core.common.utils.SizeConverter.autoConvert(size.longValue(), inUnit); return org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getMessages().sizeUnitString(formatSize(sizeWithUnits.getSecond()), sizeWithUnits.getFirst()); } }
private static boolean checkImagesNotInStatus(java.util.List<java.lang.String> messages, java.util.List<org.ovirt.engine.core.common.businessentities.DiskImage> images, org.ovirt.engine.core.common.businessentities.ImageStatus status, org.ovirt.engine.core.dal.VdcBllMessages failMessage) { boolean returnValue = true; java.util.List<java.lang.String> disksInStatus = new java.util.ArrayList<java.lang.String>(); for (org.ovirt.engine.core.common.businessentities.DiskImage diskImage : images) { if ((diskImage.getImageStatus()) == status) { disksInStatus.add(diskImage.getDiskAlias()); returnValue = false; } } if ((disksInStatus.size()) > 0) { org.ovirt.engine.core.common.utils.ListUtils.nullSafeAdd(messages, failMessage.toString()); org.ovirt.engine.core.common.utils.ListUtils.nullSafeAdd(messages, java.lang.String.format("$%1$s %2$s", "diskAliases", org.apache.commons.lang.StringUtils.join(disksInStatus, ", "))); } return returnValue; }
@java.lang.Override protected void executeCommand() { org.ovirt.engine.core.common.businessentities.VDSGroup vdsGroup = getVdsGroup(); boolean initSucceeded = true; getVds().setPowerManagementControlledByPolicy(true); org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVdsDynamicDao().updateVdsDynamicPowerManagementPolicyFlag(getVds().getId(), getVds().isPowerManagementControlledByPolicy()); if (vdsGroup.supportsTrustedService()) { initSucceeded = initTrustedService(); } if (initSucceeded && (vdsGroup.supportsVirtService())) { initSucceeded = initVirtResources(); } if (initSucceeded && (vdsGroup.supportsGlusterService())) { initSucceeded = initGlusterHost(); } setSucceeded(initSucceeded); if (getSucceeded()) { org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase logable = new org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase(getVds().getId()); logable.addCustomValue("HostStatus", getVds().getStatus().toString()); org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogDirector.log(logable, AuditLogType.VDS_DETECTED); } }
@org.ovirt.engine.api.restapi.types.Mapping(from = org.ovirt.engine.api.model.InstanceType.class, to = org.ovirt.engine.api.model.InstanceType.class) public static org.ovirt.engine.api.model.InstanceType map(org.ovirt.engine.core.common.businessentities.InstanceType entity, org.ovirt.engine.api.model.InstanceType incoming) { org.ovirt.engine.api.model.InstanceType model = (incoming != null) ? incoming : new org.ovirt.engine.api.model.InstanceType(); mapCommonEntityToModel(model, ((org.ovirt.engine.core.common.businessentities.VmTemplate) (entity))); model.setDisplay(org.ovirt.engine.api.restapi.types.DisplayMapper.map(entity, null)); if ((entity.getDefaultBootSequence()) != null) { org.ovirt.engine.api.model.OperatingSystem os = model.getOs(); if (os == null) { os = new org.ovirt.engine.api.model.OperatingSystem(); } if ((entity.getDefaultBootSequence()) != null) { for (org.ovirt.engine.api.model.Boot boot : org.ovirt.engine.api.restapi.types.VmMapper.map(entity.getDefaultBootSequence(), null)) { os.getBoot().add(boot); } } model.setOs(os); } return model; }
private java.lang.Integer integerOrNull(java.lang.Object o) { if (o instanceof java.lang.Integer) { return ((java.lang.Integer) (o)); } else if (o instanceof java.lang.String) { try { return java.lang.Integer.parseInt(((java.lang.String) (o))); } catch (java.lang.Exception e) { } } return null; }
@java.lang.Override public org.ovirt.engine.core.dal.dbbroker.MapSqlParameterMapper<org.ovirt.engine.core.common.businessentities.gluster.GlusterBrickEntity> getBatchMapper() { return new org.ovirt.engine.core.dal.dbbroker.MapSqlParameterMapper<org.ovirt.engine.core.common.businessentities.gluster.GlusterBrickEntity>() { @java.lang.Override public org.springframework.jdbc.core.namedparam.MapSqlParameterSource map(org.ovirt.engine.core.common.businessentities.gluster.GlusterBrickEntity entity) { org.springframework.jdbc.core.namedparam.MapSqlParameterSource paramValue = new org.springframework.jdbc.core.namedparam.MapSqlParameterSource().addValue("volume_id", entity.getVolumeId()).addValue("server_id", entity.getServerId()).addValue("brick_dir", entity.getBrickDirectory()).addValue("status", entity.getStatus().name()).addValue("id", entity.getId().toString()).addValue("brick_order", entity.getBrickOrder()).addValue("network_id", entity.getNetworkId()).addValue("task_id", ((entity.getAsyncTask().getTaskId()) != null ? entity.getAsyncTask().getTaskId().toString() : "")).addValue("unsynced_entries", entity.getUnSyncedEntries()).addValue("unsynced_entries_history", org.apache.commons.lang.StringUtils.join(entity.getUnSyncedEntriesTrend(), ",")); return paramValue; } }; }
private java.lang.String getVdsCertificateSubject() { return org.ovirt.engine.core.bll.ConfigureConsoleOptionsQuery.getBackend().runInternalQuery(VdcQueryType.GetVdsCertificateSubjectByVmId, new org.ovirt.engine.core.common.queries.IdQueryParameters(getCachedVm().getId())).getReturnValue(); }
@java.lang.Override public void render(org.ovirt.engine.ui.common.widget.table.cell.Context context, java.lang.String value, com.google.gwt.safehtml.shared.SafeHtmlBuilder sb, java.lang.String id) { if (value != null) { sb.append(template.link(id)); super.render(context, value, sb, (id + (org.ovirt.engine.ui.common.widget.table.cell.LinkCell.CONTENT_ID_SUFFIX))); sb.appendHtmlConstant("</a>"); } }
@java.lang.Override public void cleanup() { driver.cleanup(); if ((unitVmModel) != null) { unitVmModel.cleanup(); unitVmModel = null; } }
@java.lang.Override protected boolean canDoAction() { clusterId = getParameters().getClusterId(); serverId = getParameters().getServerId(); serviceType = getParameters().getServiceType(); actionType = getParameters().getActionType(); if (!(org.ovirt.engine.core.bll.gluster.ManageGlusterServiceCommand.manageActionDetailsMap.keySet().contains(actionType))) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_INVALID_ACTION_TYPE); } if ((org.ovirt.engine.core.compat.Guid.isNullOrEmpty(clusterId)) && (org.ovirt.engine.core.compat.Guid.isNullOrEmpty(serverId))) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_CLUSTERID_AND_SERVERID_BOTH_NULL); } if ((!(org.ovirt.engine.core.compat.Guid.isNullOrEmpty(clusterId))) && ((getClusterUtils().getAllUpServers(clusterId).size()) == 0)) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_NO_SERVERS_FOR_CLUSTER); } return true; }
private static DnsResolverConfiguration.NameServersList mapAddressesToNameServerList(java.util.List<java.lang.String> addresses) { org.ovirt.engine.api.model.DnsResolverConfiguration.NameServersList result = new org.ovirt.engine.api.model.DnsResolverConfiguration.NameServersList(); result.getNameServers().addAll(addresses); return result; }
@java.lang.Override public T mapRow(java.sql.ResultSet rs, int rowNum) throws java.sql.SQLException { T entity = createNetworkEntity(); entity.setId(org.ovirt.engine.core.dao.network.NetworkDaoDbFacadeImpl.NetworkRowMapperBase.getGuidDefaultEmpty(rs, "id")); entity.setName(rs.getString("name")); entity.setDescription(rs.getString("description")); entity.setComment(rs.getString("free_text_comment")); entity.setType(((java.lang.Integer) (rs.getObject("type")))); entity.setAddr(rs.getString("addr")); entity.setSubnet(rs.getString("subnet")); entity.setGateway(rs.getString("gateway")); entity.setVlanId(((java.lang.Integer) (rs.getObject("vlan_id")))); entity.setStp(rs.getBoolean("stp")); entity.setDataCenterId(org.ovirt.engine.core.dao.network.NetworkDaoDbFacadeImpl.NetworkRowMapperBase.getGuidDefaultEmpty(rs, "storage_pool_id")); entity.setMtu(rs.getInt("mtu")); entity.setVmNetwork(rs.getBoolean("vm_network")); org.ovirt.engine.core.compat.Guid providerId = org.ovirt.engine.core.dao.network.NetworkDaoDbFacadeImpl.NetworkRowMapperBase.getGuid(rs, "provider_network_provider_id"); if (providerId != null) { entity.setProvidedBy(new org.ovirt.engine.core.common.businessentities.network.ProviderNetwork(providerId, rs.getString("provider_network_external_id"))); } entity.setQosId(org.ovirt.engine.core.dao.network.NetworkDaoDbFacadeImpl.NetworkRowMapperBase.getGuid(rs, "qos_id")); entity.setLabel(rs.getString("label")); return entity; }
private java.net.HttpURLConnection createURLConnection() throws java.io.IOException { logger.debug(java.lang.String.format("createURLConnection: getSessionUserGetSessionUserServletURL=%s, sslInsecure=%s, sslNoHostVerification=%s, sslTrustStoreType=%s, sslTrustStorePath=%s, sslProtocol=%s", getSessionUserGetSessionUserServletURL, sslInsecure, sslNoHostVerification, sslTrustStoreType, sslTrustStorePath, sslProtocol)); java.net.HttpURLConnection servletConnection = ((java.net.HttpURLConnection) (getSessionUserGetSessionUserServletURL.openConnection())); if ("https".equals(getSessionUserGetSessionUserServletURL.getProtocol())) { javax.net.ssl.HttpsURLConnection httpsConnection = ((javax.net.ssl.HttpsURLConnection) (servletConnection)); httpsConnection.setSSLSocketFactory(sslctx.getSocketFactory()); if ((sslInsecure) || (sslNoHostVerification)) { httpsConnection.setHostnameVerifier(new javax.net.ssl.HostnameVerifier() { @java.lang.Override public boolean verify(java.lang.String hostname, javax.net.ssl.SSLSession session) { return true; } }); } } servletConnection.setRequestMethod("POST"); servletConnection.setDoOutput(true); servletConnection.setDoInput(true); servletConnection.setReadTimeout(10000); servletConnection.setRequestProperty("Content-Type", "application/x-www-form-urlencoded"); return servletConnection; }
protected boolean pciAndIdeWithinLimit(org.ovirt.engine.core.common.businessentities.VmStatic vm, java.util.List<org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface> allInterfaces) { java.util.List<org.ovirt.engine.core.common.businessentities.Disk> allDisks = org.ovirt.engine.core.bll.network.vm.AbstractVmInterfaceCommand.getDiskDao().getAllForVm(org.ovirt.engine.core.bll.network.vm.AbstractVmInterfaceCommand.getVmId()); return checkPciAndIdeLimit(vm.getNumOfMonitors(), allInterfaces, allDisks, org.ovirt.engine.core.bll.network.vm.AbstractVmInterfaceCommand.getReturnValue().getCanDoActionMessages()); }
protected void addVmTemplateToDb() { getVmTemplate().setVdsGroupId(getParameters().getVdsGroupId()); if (!(org.ovirt.engine.core.bll.VmHandler.validateDedicatedVdsExistOnSameCluster(getVmTemplate(), null))) { getVmTemplate().setDedicatedVmForVds(null); } getVmTemplate().setStatus(VmTemplateStatus.Locked); getVmTemplate().setQuotaId(getParameters().getQuotaId()); org.ovirt.engine.core.bll.VmHandler.updateImportedVmUsbPolicy(getVmTemplate()); org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVmTemplateDao().save(getVmTemplate()); getCompensationContext().snapshotNewEntity(getVmTemplate()); int count = 1; for (org.ovirt.engine.core.common.businessentities.DiskImage image : getImages()) { image.setActive(true); org.ovirt.engine.core.common.businessentities.image_storage_domain_map map = org.ovirt.engine.core.bll.BaseImagesCommand.saveImage(image); getCompensationContext().snapshotNewEntity(image.getImage()); getCompensationContext().snapshotNewEntity(map); if (!(org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getBaseDiskDao().exists(image.getId()))) { image.setDiskAlias(org.ovirt.engine.core.bll.ImagesHandler.getSuggestedDiskAlias(image, getVmTemplateName(), count)); count++; org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getBaseDiskDao().save(image); getCompensationContext().snapshotNewEntity(image); } org.ovirt.engine.core.common.businessentities.DiskImageDynamic diskDynamic = new org.ovirt.engine.core.common.businessentities.DiskImageDynamic(); diskDynamic.setId(image.getImageId()); diskDynamic.setactual_size(image.getActualSizeInBytes()); org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getDiskImageDynamicDao().save(diskDynamic); getCompensationContext().snapshotNewEntity(diskDynamic); } }
protected void loadRdpData(org.ovirt.engine.ui.uicommonweb.models.HasConsoleModel model, org.ovirt.engine.ui.common.utils.ConsoleOptionsFrontendPersisterImpl.KeyMaker keyMaker) { if ((!(consoleUtils.isRDPAvailable())) || ((model.getAdditionalConsoleModel()) == null)) { return; } model.setSelectedProtocol(ConsoleProtocol.RDP); try { org.ovirt.engine.ui.uicommonweb.models.vms.RdpConsoleModel.ClientConsoleMode consoleMode = RdpConsoleModel.ClientConsoleMode.valueOf(clientStorage.getLocalItem(keyMaker.make(org.ovirt.engine.ui.common.utils.ConsoleOptionsFrontendPersisterImpl.RDP_CLIENT_MODE))); asRdpConsoleModel(model).setRdpImplementation(consoleMode); } catch (java.lang.Exception e) { } org.ovirt.engine.ui.uicommonweb.models.vms.IRdp rdp = asRdpConsoleModel(model).getrdp(); rdp.setUseLocalDrives(readBool(keyMaker.make(org.ovirt.engine.ui.common.utils.ConsoleOptionsFrontendPersisterImpl.USE_LOCAL_DRIVES))); }
protected org.ovirt.engine.core.bll.ValidationResult macAvailable() { org.ovirt.engine.core.bll.network.macpool.MacPool macPool = org.ovirt.engine.core.bll.network.vm.ActivateDeactivateVmNicCommand.getMacPool(); java.lang.Boolean allowDupMacs = macPool.isDuplicateMacAddressesAllowed(); org.ovirt.engine.core.bll.network.VmInterfaceManager vmInterfaceManager = new org.ovirt.engine.core.bll.network.VmInterfaceManager(macPool); if (allowDupMacs || (!(vmInterfaceManager.existsPluggedInterfaceWithSameMac(org.ovirt.engine.core.bll.network.vm.ActivateDeactivateVmNicCommand.getParameters().getNic())))) { return org.ovirt.engine.core.bll.ValidationResult.VALID; } else { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.NETWORK_MAC_ADDRESS_IN_USE); } }
@java.lang.Override public void edit(org.ovirt.engine.ui.uicommonweb.models.storage.ImportCloneModel object) { if ((((org.ovirt.engine.ui.uicommonweb.models.vms.ImportEntityData) (object.getEntity())).getEntity()) instanceof org.ovirt.engine.core.common.businessentities.VM) { dialogLabelEditor.setText(messages.sameVmNameExists(((org.ovirt.engine.ui.uicommonweb.models.vms.ImportVmData) (object.getEntity())).getVm().getName())); cloneEditor.asRadioButton().setHTML(templates.twoLinesRadioButtonLabel(constants.cloneImportVm(), constants.cloneImportVmDetails()).asString()); suffixEditor.setLabel(constants.cloneImportSuffixVm()); } else { dialogLabelEditor.setText(((((constants.sameTemplateNameExists()) + " (") + (((org.ovirt.engine.ui.uicommonweb.models.vms.ImportTemplateData) (object.getEntity())).getTemplate().getName())) + ")")); cloneEditor.setLabel(constants.cloneImportTemplate()); suffixEditor.setLabel(constants.cloneImportSuffixTemplate()); } org.ovirt.engine.ui.webadmin.section.main.view.popup.storage.backup.ImportCloneDialogPopupView.Driver.driver.edit(object); }
@java.lang.Override public javax.ws.rs.core.Response add(org.ovirt.engine.api.model.Step step) { validateParameters(step, "type", "status.state", "description"); java.lang.String id; if (step.isSetParentStep()) { validateParameters(step, "parentStep.id"); id = step.getParentStep().getId(); } else { id = jobId.toString(); } return performCreate(VdcActionType.AddExternalStep, new org.ovirt.engine.core.common.action.AddExternalStepParameters(asGuid(id), step.getDescription(), org.ovirt.engine.api.restapi.types.StepMapper.map(org.ovirt.engine.api.model.StepEnum.fromValue(step.getType())), org.ovirt.engine.api.restapi.types.JobMapper.map(step.getStatus(), null)), new org.ovirt.engine.api.restapi.resource.QueryIdResolver<org.ovirt.engine.core.compat.Guid>(org.ovirt.engine.core.common.queries.VdcQueryType.GetStepByStepId, org.ovirt.engine.core.common.queries.IdQueryParameters.class)); }
public void loadVmFromOva() { if (!(validateOvaConfiguration())) { return; } startProgress(null); org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().getVmFromOva(new org.ovirt.engine.ui.frontend.AsyncQuery(this, new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object target, java.lang.Object returnValue) { org.ovirt.engine.core.common.queries.VdcQueryReturnValue queryReturnValue = ((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (returnValue)); if (queryReturnValue.getSucceeded()) { org.ovirt.engine.core.common.businessentities.VM vm = queryReturnValue.getReturnValue(); updateVms(java.util.Collections.singletonList(vm)); clearError(); } else { setError(messages.failedToLoadOva(getOvaPath().getEntity())); } stopProgress(); } }), getHosts().getSelectedItem().getId(), getOvaPath().getEntity()); }
void afterVMsRefreshTreatment() { getVdsEventListener().destroyVms(vmsToDestroy); for (org.ovirt.engine.core.compat.Guid vm_guid : _vmsToRerun) { org.ovirt.engine.core.vdsbroker.VmsMonitoring.log.error("Rerun VM '{}'. Called from VDS '{}'", vm_guid, vds.getName()); org.ovirt.engine.core.vdsbroker.ResourceManager.getInstance().RerunFailedCommand(vm_guid, vds.getId()); } for (org.ovirt.engine.core.compat.Guid vm_guid : _succededToRunVms) { vdsManager.succededToRunVm(vm_guid); } getVdsEventListener().updateSlaPolicies(_succededToRunVms, vds.getId()); _autoVmsToRun.removeAll(_vmsToRerun); getVdsEventListener().runFailedAutoStartVMs(_autoVmsToRun); for (java.util.Map.Entry<org.ovirt.engine.core.common.businessentities.VM, org.ovirt.engine.core.common.businessentities.VmDynamic> pair : _vmsClientIpChanged.entrySet()) { getVdsEventListener().processOnClientIpChange(vds, pair.getValue().getId()); } for (org.ovirt.engine.core.common.businessentities.VmDynamic runningVm : _poweringUpVms) { getVdsEventListener().processOnVmPoweringUp(runningVm.getId()); } getVdsEventListener().processOnVmStop(_vmsMovedToDown); for (org.ovirt.engine.core.compat.Guid vm_guid : _vmsToRemoveFromAsync) { org.ovirt.engine.core.vdsbroker.ResourceManager.getInstance().RemoveAsyncRunningVm(vm_guid); } }
public void initializeHandlers() { modelProvider.getModel().getEntityChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener<org.ovirt.engine.ui.uicompat.EventArgs>() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.EventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { java.lang.Object entity = modelProvider.getModel().getEntity(); if (entity != null) { onDetailModelEntityChange(entity); } } }); modelProvider.getModel().getPropertyChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener<org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs>() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs args) { if (PropertyChangedEventArgs.PROGRESS.equals(args.propertyName)) { if ((modelProvider.getModel().getProgress()) != null) { com.google.gwt.core.client.Scheduler.get().scheduleDeferred(new com.google.gwt.core.client.Scheduler.ScheduledCommand() { @java.lang.Override public void execute() { if ((getTable()) != null) { getTable().setLoadingState(LoadingState.LOADING); } } }); } } } }); }
private static void AddBootProtocol(org.ovirt.engine.core.vdsbroker.xmlrpc.XmlRpcStruct cfg, org.ovirt.engine.core.common.businessentities.VdsNetworkInterface iface) { if (cfg != null) { if ((cfg.getItem("BOOTPROTO")) != null) { if (cfg.getItem("BOOTPROTO").toString().toLowerCase().equals("dhcp")) { iface.setBootProtocol(NetworkBootProtocol.Dhcp); } else { iface.setBootProtocol(NetworkBootProtocol.None); } } else if ((cfg.containsKey("IPADDR")) && (!(org.apache.commons.lang.StringUtils.isEmpty(cfg.getItem("IPADDR").toString())))) { iface.setBootProtocol(NetworkBootProtocol.StaticIp); if (cfg.containsKey(VdsProperties.gateway)) { java.lang.Object gateway = cfg.getItem(VdsProperties.gateway); if ((gateway != null) && (!(org.apache.commons.lang.StringUtils.isEmpty(gateway.toString())))) { org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.setGatewayIfManagementNetwork(iface, gateway.toString()); } } } else { iface.setBootProtocol(NetworkBootProtocol.None); } } }
public void getVmsFromExternalServer(org.ovirt.engine.ui.frontend.AsyncQuery aQuery, org.ovirt.engine.core.compat.Guid dataCenterId, org.ovirt.engine.core.compat.Guid vdsId, java.lang.String url, java.lang.String username, java.lang.String password, org.ovirt.engine.core.common.businessentities.OriginType originType, java.util.List<java.lang.String> vmsToImport) { aQuery.converterCallback = new org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.ListConverter(); org.ovirt.engine.ui.frontend.Frontend.getInstance().runQuery(VdcQueryType.GetVmsFromExternalProvider, new org.ovirt.engine.core.common.queries.GetVmsFromExternalProviderQueryParameters(url, username, password, originType, vdsId, dataCenterId, vmsToImport), aQuery); }
@java.lang.Override protected void executeCommand() { if ((org.ovirt.engine.core.bll.DetachUserGroupFromTagCommand.getTagId()) != null) { for (org.ovirt.engine.core.compat.Guid groupGuid : org.ovirt.engine.core.bll.DetachUserGroupFromTagCommand.getGroupList()) { org.ovirt.engine.core.common.businessentities.aaa.DbGroup group = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getDbGroupDao().get(groupGuid); if ((org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getTagDao().getTagUserGroupByGroupIdAndByTagId(org.ovirt.engine.core.bll.DetachUserGroupFromTagCommand.getTagId(), groupGuid)) != null) { if (group != null) { appendCustomCommaSeparatedValue("DetachGroupsNames", group.getName()); } org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getTagDao().detachUserGroupFromTag(org.ovirt.engine.core.bll.DetachUserGroupFromTagCommand.getTagId(), groupGuid); noActionDone = false; org.ovirt.engine.core.bll.DetachUserGroupFromTagCommand.setSucceeded(true); } } } }
public void refreshGeoRepDataForVolume(final org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity volume) { if (volume == null) { throw new org.ovirt.engine.core.common.errors.EngineException(org.ovirt.engine.core.common.errors.EngineError.GlusterVolumeGeoRepSyncFailed, "No volume information"); } org.ovirt.engine.core.common.businessentities.VDSGroup cluster = getClusterDao().get(volume.getClusterId()); discoverGeoRepDataInCluster(cluster, volume); java.util.List<org.ovirt.engine.core.common.businessentities.gluster.GlusterGeoRepSession> geoRepSessions = getGeoRepDao().getGeoRepSessions(volume.getId()); refreshGeoRepSessionStatusForSessions(cluster, geoRepSessions); }
@java.lang.Override protected void initStorageDomains() { org.ovirt.engine.core.common.businessentities.Disk disk = getDisks().get(0).getDisk(); if ((disk.getDiskStorageType()) != (org.ovirt.engine.core.common.businessentities.Disk.DiskStorageType.IMAGE)) { return; } org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().getStorageDomainList(new org.ovirt.engine.ui.frontend.AsyncQuery(this, new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object target, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.models.vms.MoveDiskModel moveDiskModel = ((org.ovirt.engine.ui.uicommonweb.models.vms.MoveDiskModel) (target)); java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StorageDomain> storageDomains = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StorageDomain>) (returnValue)); moveDiskModel.onInitStorageDomains(storageDomains); } }), ((org.ovirt.engine.core.common.businessentities.DiskImage) (disk)).getStoragePoolId()); }
@java.lang.Override protected void endWithFailure() { org.ovirt.engine.core.bll.CreateSnapshotCommand.revertTasks(); if (((org.ovirt.engine.core.bll.CreateSnapshotCommand.getDestinationDiskImage()) != null) && (!(org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVmDao().getVmsListForDisk(org.ovirt.engine.core.bll.CreateSnapshotCommand.getDestinationDiskImage().getId()).isEmpty()))) { if (!(org.ovirt.engine.core.bll.CreateSnapshotCommand.getDestinationDiskImage().getParentId().equals(Guid.Empty))) { if (!(org.ovirt.engine.core.bll.CreateSnapshotCommand.getDestinationDiskImage().getParentId().equals(org.ovirt.engine.core.bll.CreateSnapshotCommand.getDestinationDiskImage().getImageTemplateId()))) { org.ovirt.engine.core.common.businessentities.DiskImage previousSnapshot = org.ovirt.engine.core.bll.CreateSnapshotCommand.getDiskImageDao().getSnapshotById(org.ovirt.engine.core.bll.CreateSnapshotCommand.getDestinationDiskImage().getParentId()); previousSnapshot.setActive(true); if ((org.ovirt.engine.core.bll.CreateSnapshotCommand.getParameters().getOldLastModifiedValue()) != null) { previousSnapshot.setLastModified(org.ovirt.engine.core.bll.CreateSnapshotCommand.getParameters().getOldLastModifiedValue()); } org.ovirt.engine.core.bll.CreateSnapshotCommand.getImageDao().update(previousSnapshot.getImage()); } } } super.endWithFailure(); }
@org.junit.Test @java.lang.SuppressWarnings("unchecked") public void nameNotAvailable() throws java.lang.Exception { org.ovirt.engine.core.common.businessentities.Provider<org.ovirt.engine.core.common.businessentities.Provider.AdditionalProperties> otherProvider = createProvider(provider.getName()); when(((org.ovirt.engine.core.common.businessentities.Provider<org.ovirt.engine.core.common.businessentities.Provider.AdditionalProperties>) (providerDao.getByName(provider.getName())))).thenReturn(otherProvider); assertThat(validator.nameAvailable(), failsWith(EngineMessage.ACTION_TYPE_FAILED_NAME_ALREADY_USED)); }
@org.junit.Test public void testListWithMultipleObjects() { java.util.List<org.ovirt.engine.api.types.V4Vm> list = new java.util.ArrayList<>(); list.add(vm().build()); list.add(vm().build()); assertEquals("<vms><vm></vm><vm></vm></vms>", listToXml(list.iterator())); }
public void setContent(java.lang.String content) { this.content = content; }
@javax.ws.rs.Path("{action: (?:restore)}/{oid}") public org.ovirt.engine.api.v3.servers.V3ActionServer getActionResource(@javax.ws.rs.PathParam("action") java.lang.String action, @javax.ws.rs.PathParam("oid") java.lang.String oid) { return new org.ovirt.engine.api.v3.servers.V3ActionServer(getDelegate().getActionResource(action, oid)); }
public org.ovirt.engine.core.bll.network.macpool.ReadMacPool getMacPoolForCluster(org.ovirt.engine.core.compat.Guid clusterId) { return getMacPoolById(getMacPoolId(clusterId)); }
@java.lang.Override protected void init() { org.ovirt.engine.core.common.businessentities.VM vmFromConfiguration = org.ovirt.engine.core.bll.exportimport.ImportVmFromConfigurationCommand.getParameters().getVm(); if (vmFromConfiguration != null) { vmFromConfiguration.getStaticData().setClusterId(org.ovirt.engine.core.bll.exportimport.ImportVmFromConfigurationCommand.getParameters().getClusterId()); if (!(org.ovirt.engine.core.bll.exportimport.ImportVmFromConfigurationCommand.isImagesAlreadyOnTarget())) { setDisksToBeAttached(vmFromConfiguration); } org.ovirt.engine.core.bll.exportimport.ImportVmFromConfigurationCommand.getParameters().setContainerId(vmFromConfiguration.getId()); } else { initUnregisteredVM(); } if ((Guid.Empty.equals(org.ovirt.engine.core.bll.exportimport.ImportVmFromConfigurationCommand.getParameters().getVmId())) && ((org.ovirt.engine.core.bll.exportimport.ImportVmFromConfigurationCommand.getParameters().getVm()) != null)) { org.ovirt.engine.core.bll.exportimport.ImportVmFromConfigurationCommand.getParameters().setVmId(org.ovirt.engine.core.bll.exportimport.ImportVmFromConfigurationCommand.getParameters().getVm().getId()); } setClusterId(org.ovirt.engine.core.bll.exportimport.ImportVmFromConfigurationCommand.getParameters().getClusterId()); org.ovirt.engine.core.bll.exportimport.ImportVmFromConfigurationCommand.getParameters().setStoragePoolId(org.ovirt.engine.core.bll.exportimport.ImportVmFromConfigurationCommand.getCluster().getStoragePoolId()); super.init(); }
@java.lang.Override protected boolean canDoAction() { if (!(super.canDoAction())) { return false; } for (org.ovirt.engine.core.common.businessentities.VDS vds : getServersInCluster()) { if ((vds.getStatus()) != (org.ovirt.engine.core.common.businessentities.VDSStatus.Up)) { setVdsName(vds.getName()); addCanDoActionMessage(EngineMessage.ACTION_TYPE_FAILED_SERVER_STATUS_NOT_UP); addCanDoActionMessage(java.lang.String.format("$%1$s %2$s", "VdsName", vds.getName())); return false; } } return true; }
private static java.lang.Integer divide(java.lang.Integer num, int divisor) { if (num == null) { return null; } else { return ((int) ((num.floatValue()) / divisor)); } }
private void upgradeNode() { try (final org.ovirt.engine.core.bll.OVirtNodeUpgrade upgrade = new org.ovirt.engine.core.bll.OVirtNodeUpgrade(org.ovirt.engine.core.bll.InstallVdsCommand.getVds(), _iso)) { upgrade.setCorrelationId(org.ovirt.engine.core.bll.InstallVdsCommand.getCorrelationId()); org.ovirt.engine.core.bll.InstallVdsCommand.log.infoFormat("Execute upgrade host {0}, {1}", org.ovirt.engine.core.bll.InstallVdsCommand.getVds().getId(), org.ovirt.engine.core.bll.InstallVdsCommand.getVds().getName()); setVdsStatus(VDSStatus.Installing); upgrade.execute(); switch (upgrade.getDeployStatus()) { case Failed : throw new org.ovirt.engine.core.bll.InstallVdsCommand.VdsInstallException(org.ovirt.engine.core.common.businessentities.VDSStatus.InstallFailed, org.apache.commons.lang.StringUtils.EMPTY); case Reboot : setVdsStatus(VDSStatus.Reboot); RunSleepOnReboot(getStatusOnReboot()); break; case Complete : setCompletedVdsStatus(); break; } org.ovirt.engine.core.bll.InstallVdsCommand.log.infoFormat("After upgrade host {0}, {1}: success", org.ovirt.engine.core.bll.InstallVdsCommand.getVds().getId(), org.ovirt.engine.core.bll.InstallVdsCommand.getVds().getName()); org.ovirt.engine.core.bll.InstallVdsCommand.setSucceeded(true); } catch (org.ovirt.engine.core.bll.InstallVdsCommand.VdsInstallException e) { handleError(e, e.getStatus()); } catch (java.lang.Exception e) { handleError(e, VDSStatus.InstallFailed); } }
public static boolean isVersionMatchStorageType(org.ovirt.engine.core.compat.Version version, org.ovirt.engine.core.common.businessentities.StorageType type) { return !((((type == (org.ovirt.engine.core.common.businessentities.StorageType.LOCALFS)) && ((version.compareTo(new org.ovirt.engine.core.compat.Version(2, 2))) <= 0)) || ((type == (org.ovirt.engine.core.common.businessentities.StorageType.POSIXFS)) && ((version.compareTo(new org.ovirt.engine.core.compat.Version(3, 0))) <= 0))) || ((type == (org.ovirt.engine.core.common.businessentities.StorageType.GLUSTERFS)) && ((version.compareTo(new org.ovirt.engine.core.compat.Version(3, 2))) <= 0))); }
protected void updateMtuSelectorsChangeability() { if (((getSelectedDc()) != null) && (!(isMTUOverrideSupported()))) { setMtuSelectorsChangeability(false, org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getMessages().mtuOverrideNotSupported(getSelectedDc().getcompatibility_version().toString())); return; } if (getExport().getEntity()) { setMtuSelectorsChangeability(false, null); return; } setMtuSelectorsChangeability(true, null); }
@org.junit.Test public void testIpConfiguredForStaticBootProtocolWhenIpConfigurationIsNotNullAndBootProtocolIsStaticAndAddressIsNull() throws java.lang.Exception { doTestIpConfiguredForStaticBootProtocol(null, "255.255.255.0"); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Stop Rebalance") java.lang.String stopRebalance();
@java.lang.Override public void onValueChange(com.google.gwt.event.logical.shared.ValueChangeEvent<java.lang.Boolean> event) { getView().spiceSelected(event.getValue()); getView().setWanOptionsVisible(((wanOptionsAvailable) && (event.getValue()))); getView().rdpSelected((!(event.getValue()))); }
public static java.lang.String createConnectionString(java.lang.String host, java.lang.String port, boolean sslTarget) { return com.google.gwt.http.client.URL.encode(org.ovirt.engine.ui.common.uicommon.WebClientConsoleInvoker.createConnectionJsonString(host, port, sslTarget)); }
@java.lang.Override protected void populateTabMap() { getTabNameMapping().put(TabName.IPV4_TAB, this.ipv4Tab.getTabListItem()); getTabNameMapping().put(TabName.IPV6_TAB, this.ipv6Tab.getTabListItem()); getTabNameMapping().put(TabName.QOS_TAB, this.qosTab.getTabListItem()); getTabNameMapping().put(TabName.CUSTOM_PROPERTIES_TAB, this.customPropertiesTab.getTabListItem()); getTabNameMapping().put(TabName.DNS_CONFIGURATION_TAB, this.dnsConfigurationTab.getTabListItem()); }
private java.util.List<org.ovirt.engine.core.common.businessentities.storage.LUNs> getDeviceList(org.ovirt.engine.core.compat.Guid hostId, org.ovirt.engine.core.common.businessentities.storage.StorageType storageType) { return getEntity(java.util.List.class, VdcQueryType.GetDeviceList, new org.ovirt.engine.core.common.queries.GetDeviceListQueryParameters(hostId, storageType, false, null), "GetDeviceList", true); }
@java.lang.Override protected java.lang.String getNoActiveSourceDomainMessage() { return constants.sourceStorageDomainIsNotActiveMsg(); }
private org.ovirt.engine.core.utils.customprop.VmPropertiesUtils mockVmPropertiesUtils() { org.ovirt.engine.core.utils.customprop.VmPropertiesUtils utils = spy(new org.ovirt.engine.core.utils.customprop.VmPropertiesUtils()); doReturn(("sap_agent=^(true|false)$;sndbuf=^[0-9]+$;" + ("vhost=^(([a-zA-Z0-9_]*):(true|false))(,(([a-zA-Z0-9_]*):(true|false)))*$;" + "viodiskcache=^(none|writeback|writethrough)$"))).when(utils).getPredefinedVMProperties(any(org.ovirt.engine.core.compat.Version.class)); doReturn("").when(utils).getUserdefinedVMProperties(any(org.ovirt.engine.core.compat.Version.class)); doReturn(new java.util.HashSet<org.ovirt.engine.core.compat.Version>(java.util.Arrays.asList(Version.v3_2, Version.v3_3))).when(utils).getSupportedClusterLevels(); doReturn(utils).when(runVmValidator).getVmPropertiesUtils(); try { utils.init(); } catch (org.ovirt.engine.core.utils.exceptions.InitializationException e) { e.printStackTrace(); } return utils; }
private java.util.Map<java.lang.String, java.lang.Integer> getSystemStatistics() { java.util.Map<java.lang.String, java.lang.Integer> res = new java.util.HashMap<java.lang.String, java.lang.Integer>(); int totalVMs = getTotalVMsStat(); int activeVMs = getActiveVMsStat(); int downVMs = ((totalVMs - activeVMs) < 0) ? 0 : totalVMs - activeVMs; int totalHosts = getTotalHostsStat(); int activeHosts = getActiveHostsStat(); int maintenanceHosts = getMaintenanceHostsStat(); int downHosts = (((totalHosts - activeHosts) - maintenanceHosts) < 0) ? 0 : (totalHosts - activeHosts) - maintenanceHosts; res.put(QueryConstants.SYSTEM_STATS_TOTAL_VMS_FIELD, totalVMs); res.put(QueryConstants.SYSTEM_STATS_ACTIVE_VMS_FIELD, activeVMs); res.put(QueryConstants.SYSTEM_STATS_DOWN_VMS_FIELD, downVMs); res.put(QueryConstants.SYSTEM_STATS_TOTAL_HOSTS_FIELD, totalHosts); res.put(QueryConstants.SYSTEM_STATS_ACTIVE_HOSTS_FIELD, activeHosts); res.put(QueryConstants.SYSTEM_STATS_MAINTENANCE_HOSTS_FIELD, maintenanceHosts); res.put(QueryConstants.SYSTEM_STATS_DOWN_HOSTS_FIELD, downHosts); res.put(QueryConstants.SYSTEM_STATS_TOTAL_USERS_FIELD, getTotalUsersStat()); res.put(QueryConstants.SYSTEM_STATS_ACTIVE_USERS_FIELD, getActiveUsersStat()); res.put(QueryConstants.SYSTEM_STATS_TOTAL_STORAGE_DOMAINS_FIELD, getTotalStorageDomainsStat()); res.put(QueryConstants.SYSTEM_STATS_ACTIVE_STORAGE_DOMAINS_FIELD, getActiveStorageDomainsStat()); return res; }
private org.ovirt.engine.core.common.utils.Pair<java.lang.String, java.lang.String> parseGraphicsAndDisplayPair(java.lang.String displayAndGraphicsString) { java.util.ArrayList<java.lang.String> splitted = trimElements(displayAndGraphicsString.split("/")); return (splitted.size()) == 2 ? new org.ovirt.engine.core.common.utils.Pair(splitted.get(0), splitted.get(1)) : null; }
@java.lang.Override protected void endSuccessfully() { org.ovirt.engine.core.bll.ImageSpmCommand.setSucceeded(true); }
@org.junit.Test public void updateWithLowerVersionThanHosts() { createCommandWithDefaultVdsGroup(); cpuExists(); cpuManufacturersMatch(); VdsExistWithHigherVersion(); architectureIsUpdatable(); canDoActionFailedWithReason(VdcBllMessages.VDS_GROUP_CANNOT_UPDATE_COMPATIBILITY_VERSION_WITH_LOWER_HOSTS); }
protected void getHostLists(java.util.List<org.ovirt.engine.core.common.businessentities.VDS> allHosts, java.util.Map<java.lang.String, java.lang.String> parameters, java.util.List<org.ovirt.engine.core.common.businessentities.VDS> emptyHosts, java.util.List<org.ovirt.engine.core.common.businessentities.VDS> maintenanceHosts, java.util.List<org.ovirt.engine.core.common.businessentities.VDS> downHosts) { for (org.ovirt.engine.core.common.businessentities.VDS vds : allHosts) { if (((((vds.getStatus()) == (org.ovirt.engine.core.common.businessentities.VDSStatus.Up)) && ((vds.getVmCount()) == 0)) && ((vds.getVmMigrating()) == 0)) && ((org.ovirt.engine.core.bll.scheduling.pending.PendingVM.collectForHost(getPendingResourceManager(), vds.getId()).size()) == 0)) { emptyHosts.add(vds); } else if ((vds.isPowerManagementControlledByPolicy()) && (!(vds.isDisablePowerManagementPolicy()))) { if ((vds.getStatus()) == (org.ovirt.engine.core.common.businessentities.VDSStatus.Maintenance)) { maintenanceHosts.add(vds); } else if ((vds.getStatus()) == (org.ovirt.engine.core.common.businessentities.VDSStatus.Down)) { downHosts.add(vds); } } } }
protected org.ovirt.engine.core.common.queries.VdcQueryReturnValue runInternalQuery(org.ovirt.engine.core.common.queries.VdcQueryType type, org.ovirt.engine.core.common.queries.VdcQueryParametersBase queryParams) { return getBackend().runInternalQuery(type, queryParams, context.getEngineContext()); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Error in fetching fingerprint") java.lang.String errorLoadingFingerprint();
@java.lang.Override protected void ExecuteVdsIdCommand() { if ((_vdsManager) == null) { org.ovirt.engine.core.vdsbroker.HibernateVDSCommand.getVDSReturnValue().setSucceeded(false); return; } org.ovirt.engine.core.common.vdscommands.VDSReturnValue retVal = runHibernateBrokerVDSCommand(); if (retVal.getSucceeded()) { changeVmStatusToSavingState(); org.ovirt.engine.core.vdsbroker.HibernateVDSCommand.getVDSReturnValue().setSucceeded(true); } else { log.errorFormat("Failed to hibernate vm '{0}' in vds = {1} : {2}, error = {3}", org.ovirt.engine.core.vdsbroker.HibernateVDSCommand.getParameters().getVmId(), org.ovirt.engine.core.vdsbroker.HibernateVDSCommand.getVds().getId(), org.ovirt.engine.core.vdsbroker.HibernateVDSCommand.getVds().getName(), retVal.getExceptionString()); org.ovirt.engine.core.vdsbroker.HibernateVDSCommand.getVDSReturnValue().setSucceeded(false); org.ovirt.engine.core.vdsbroker.HibernateVDSCommand.getVDSReturnValue().setExceptionString(retVal.getExceptionString()); org.ovirt.engine.core.vdsbroker.HibernateVDSCommand.getVDSReturnValue().setExceptionObject(retVal.getExceptionObject()); org.ovirt.engine.core.vdsbroker.HibernateVDSCommand.getVDSReturnValue().setVdsError(retVal.getVdsError()); } }
@java.lang.Override public void remove(org.ovirt.engine.core.compat.Guid id) { org.hibernate.Session session = getSession(); org.hibernate.Transaction transaction = session.beginTransaction(); org.hibernate.Query query = session.createQuery("delete from tags_user_group_map tugm where tugm.groupId = :group_id"); query.setParameter("group_id", id); query.executeUpdate(); org.ovirt.engine.core.common.businessentities.LdapGroup instance = get(id); if (instance != null) { session.delete(instance); } transaction.commit(); }
public org.ovirt.engine.core.common.businessentities.StorageDomain getStorageDomain(org.ovirt.engine.core.compat.Guid poolId, org.ovirt.engine.core.common.businessentities.StorageDomainType type, org.ovirt.engine.core.common.businessentities.StorageDomainStatus status) { java.lang.Integer statusNum = (status == null) ? null : status.getValue(); return getCallsHandler().executeRead("Getstorage_domain_by_type_storagePoolId_and_status", org.ovirt.engine.core.dao.StorageDomainDaoImpl.StorageDomainRowMapper.instance, getCustomMapSqlParameterSource().addValue("storage_pool_id", poolId).addValue("storage_domain_type", type.getValue()).addValue("status", statusNum)); }
@org.junit.Test public void testAllDomainsWithinThresholdsOneLacking() { domain1.getStorageDynamicData().setAvailableDiskSize(((org.ovirt.engine.core.bll.validator.storage.MultipleStorageDomainsValidatorTest.CRITICAL_SPACE_THRESHOLD) + 1)); domain2.getStorageDynamicData().setAvailableDiskSize(((org.ovirt.engine.core.bll.validator.storage.MultipleStorageDomainsValidatorTest.CRITICAL_SPACE_THRESHOLD) - 1)); domain1.setCriticalSpaceActionBlocker(org.ovirt.engine.core.bll.validator.storage.MultipleStorageDomainsValidatorTest.CRITICAL_SPACE_THRESHOLD); domain2.setCriticalSpaceActionBlocker(org.ovirt.engine.core.bll.validator.storage.MultipleStorageDomainsValidatorTest.CRITICAL_SPACE_THRESHOLD); org.ovirt.engine.core.bll.ValidationResult result = validator.allDomainsWithinThresholds(); assertFalse("domain2 should not be within thresholds", result.isValid()); assertEquals("Wrong validation error", EngineMessage.ACTION_TYPE_FAILED_DISK_SPACE_LOW_ON_STORAGE_DOMAIN, result.getMessage()); }
protected org.ovirt.engine.core.bll.provider.BaseProviderProxy.ConnectionWrapper createConnection(java.lang.String relativePath) { java.net.URL hostUrl = getUrl(); org.ovirt.engine.core.uutils.net.HttpURLConnectionBuilder builder = null; java.net.HttpURLConnection result = null; try { builder = new org.ovirt.engine.core.uutils.net.HttpURLConnectionBuilder().appendRelativePath(hostUrl, relativePath); if (new java.io.File(org.ovirt.engine.core.utils.EngineLocalConfig.getInstance().getExternalProvidersTrustStore().getAbsolutePath()).exists()) { builder.setTrustStore(org.ovirt.engine.core.utils.EngineLocalConfig.getInstance().getExternalProvidersTrustStore().getAbsolutePath()).setTrustStorePassword(org.ovirt.engine.core.utils.EngineLocalConfig.getInstance().getExternalProvidersTrustStorePassword()).setTrustStoreType(org.ovirt.engine.core.utils.EngineLocalConfig.getInstance().getExternalProvidersTrustStoreType()); } result = builder.create(); handleCredentials(result); } catch (java.lang.Exception ex) { org.ovirt.engine.core.bll.provider.BaseProviderProxy.log.error("Cannot communicate with provider", ex); throw new org.ovirt.engine.core.common.errors.VdcBLLException(org.ovirt.engine.core.common.errors.VdcBllErrors.PROVIDER_FAILURE); } return createWrapper(result); }
private static org.ovirt.engine.api.model.OperatingSystem mapOperatingSystem(org.ovirt.engine.core.common.businessentities.VDS entity) { final org.ovirt.engine.api.model.OperatingSystem model = new org.ovirt.engine.api.model.OperatingSystem(); if (org.apache.commons.lang.StringUtils.isNotBlank(entity.getHostOs())) { org.ovirt.engine.core.utils.OS hostOs = org.ovirt.engine.core.utils.OS.fromPackageVersionString(entity.getHostOs()); org.ovirt.engine.api.model.Version version = new org.ovirt.engine.api.model.Version(); if ((hostOs.getVersion().getMajor()) != (org.ovirt.engine.core.compat.Version.VERSION_NOT_SET)) { version.setMajor(hostOs.getVersion().getMajor()); } if ((hostOs.getVersion().getMinor()) != (org.ovirt.engine.core.compat.Version.VERSION_NOT_SET)) { version.setMinor(hostOs.getVersion().getMinor()); } if ((hostOs.getVersion().getBuild()) != (org.ovirt.engine.core.compat.Version.VERSION_NOT_SET)) { version.setBuild(hostOs.getVersion().getBuild()); } version.setFullVersion(hostOs.getFullVersion()); model.setVersion(version); model.setType(hostOs.getName()); } model.setCustomKernelCmdline(java.util.Objects.toString(entity.getCurrentKernelCmdline(), "")); model.setReportedKernelCmdline(entity.getKernelArgs()); return model; }
@org.junit.Test public void testInstall() throws java.lang.Exception { setUpGetEntityWithNoCertificateInfoExpectations(1); setUriInfo(setUpActionExpectations(VdcActionType.UpdateVds, org.ovirt.engine.core.common.action.UpdateVdsActionParameters.class, new java.lang.String[]{ "RootPassword" }, new java.lang.Object[]{ NAMES[2] })); org.ovirt.engine.api.model.Action action = new org.ovirt.engine.api.model.Action(); action.setRootPassword(NAMES[2]); verifyActionResponse(resource.install(action)); }
private org.ovirt.engine.api.model.Hosts mapCollection(java.util.List<org.ovirt.engine.core.common.businessentities.VDS> entities) { org.ovirt.engine.api.model.Hosts collection = new org.ovirt.engine.api.model.Hosts(); for (org.ovirt.engine.core.common.businessentities.VDS entity : entities) { collection.getHosts().add(addLinks(populate(map(entity), entity))); } return collection; }
@java.lang.Override protected boolean canDoAction() { if ((org.ovirt.engine.core.bll.RegisterDiskCommand.getParameters().getDiskImage().getDiskStorageType()) != (org.ovirt.engine.core.common.businessentities.Disk.DiskStorageType.IMAGE)) { addCanDoActionMessageVariable("diskId", org.ovirt.engine.core.bll.RegisterDiskCommand.getParameters().getDiskImage().getId()); addCanDoActionMessageVariable("storageType", org.ovirt.engine.core.bll.RegisterDiskCommand.getParameters().getDiskImage().getDiskStorageType()); addCanDoActionMessage(VdcBllMessages.ACTION_TYPE_FAILED_UNSUPPORTED_DISK_STORAGE_TYPE); return false; } if (!(validate(new org.ovirt.engine.core.bll.validator.StorageDomainValidator(org.ovirt.engine.core.bll.RegisterDiskCommand.getStorageDomain()).isDomainExistAndActive()))) { addCanDoActionMessageVariable("diskId", org.ovirt.engine.core.bll.RegisterDiskCommand.getParameters().getDiskImage().getId()); addCanDoActionMessageVariable("domainId", org.ovirt.engine.core.bll.RegisterDiskCommand.getStorageDomainId()); addCanDoActionMessage(VdcBllMessages.ACTION_TYPE_FAILED_STORAGE_DOMAIN_UNAVAILABLE); return false; } if (!(org.ovirt.engine.core.bll.RegisterDiskCommand.getStorageDomain().getStorageDomainType().isDataDomain())) { addCanDoActionMessageVariable("domainId", org.ovirt.engine.core.bll.RegisterDiskCommand.getParameters().getStorageDomainId()); addCanDoActionMessageVariable("domainType", org.ovirt.engine.core.bll.RegisterDiskCommand.getStorageDomain().getStorageDomainType()); addCanDoActionMessage(VdcBllMessages.ACTION_TYPE_FAILED_STORAGE_DOMAIN_TYPE_UNSUPPORTED); return false; } if (!(setAndValidateDiskProfiles())) { return false; } return true; }
@java.lang.Override public java.lang.String getRawValue(org.ovirt.engine.ui.uicommonweb.models.storage.LunModel model) { return org.ovirt.engine.ui.common.widget.uicommon.storage.SanStorageTargetToLunList.messages.gigabytes(java.lang.String.valueOf(model.getSize())); }
org.ovirt.engine.core.vdsbroker.irsbroker.OneUuidReturn copyImage(java.lang.String sdUUID, java.lang.String spUUID, java.lang.String vmGUID, java.lang.String srcImgGUID, java.lang.String srcVolUUID, java.lang.String dstImgGUID, java.lang.String dstVolUUID, java.lang.String descr, java.lang.String dstSdUUID, int volType, int volFormat, int preallocate, java.lang.String postZero, java.lang.Boolean discard, java.lang.String force);
@java.lang.Override public javax.net.ssl.TrustManager[] getTrustManagers() throws java.security.GeneralSecurityException { if ((trustManagers) == null) { javax.net.ssl.TrustManagerFactory tmfactory = javax.net.ssl.TrustManagerFactory.getInstance(javax.net.ssl.TrustManagerFactory.getDefaultAlgorithm()); tmfactory.init(getTrustStore()); trustManagers = tmfactory.getTrustManagers(); } return trustManagers; }
@org.junit.Test public void testStartWithPauseAndStateless() throws java.lang.Exception { setUpWindowsGetEntityExpectations(2, false); setUriInfo(setUpActionExpectations(VdcActionType.RunVmOnce, org.ovirt.engine.core.common.action.RunVmOnceParams.class, new java.lang.String[]{ "VmId", "RunAndPause", "RunAsStateless" }, new java.lang.Object[]{ GUIDS[0], true, java.lang.Boolean.TRUE })); org.ovirt.engine.api.model.Action action = new org.ovirt.engine.api.model.Action(); action.setPause(true); action.setVm(new org.ovirt.engine.api.model.VM()); action.getVm().setStateless(true); verifyActionResponse(resource.start(action)); }
java.util.List<java.util.Map<java.lang.String, java.lang.Object>> getNetworkInterfaces(org.ovirt.vdsmfake.domain.VM vm) { java.util.Map<java.lang.String, java.lang.Object> resultMap = new java.util.HashMap(); java.util.List<java.lang.String> inet6Addresses = new java.util.ArrayList<>(); java.util.List<java.lang.String> inet4Addresses = new java.util.ArrayList<>(); java.util.List<java.util.Map<java.lang.String, java.lang.Object>> nets = new java.util.ArrayList<>(); resultMap.put("name", "eth0"); inet6Addresses.add("fe80::21a:4aff:fe16:2016"); inet6Addresses.add("2620:52:0:2380:21a:4aff:fe16:2016"); resultMap.put("inet6", inet6Addresses); inet4Addresses.add(vm.getIp()); resultMap.put("inet", inet4Addresses); resultMap.put("hw", vm.getMacAddress()); nets.add(resultMap); log.debug("network list is {}", nets.toString()); return nets; }
public org.ovirt.engine.core.bll.ValidationResult clusterNotChanged() { return org.ovirt.engine.core.bll.ValidationResult.failWith(EngineMessage.VDS_CANNOT_UPDATE_CLUSTER).unless(oldHost.getVdsGroupId().equals(getHost().getVdsGroupId())); }
@org.junit.Test public void testNetworkAttachedToClusterWhenAttached() throws java.lang.Exception { org.ovirt.engine.core.common.businessentities.network.Network network = new org.ovirt.engine.core.common.businessentities.network.Network(); network.setId(org.ovirt.engine.core.compat.Guid.newGuid()); org.ovirt.engine.core.common.businessentities.network.NetworkAttachment attachment = new org.ovirt.engine.core.common.businessentities.network.NetworkAttachment(); attachment.setNetworkId(network.getId()); org.ovirt.engine.core.common.businessentities.network.NetworkClusterId networkClusterId = new org.ovirt.engine.core.common.businessentities.network.NetworkClusterId(host.getVdsGroupId(), attachment.getNetworkId()); when(networkClusterDaoMock.get(eq(networkClusterId))).thenReturn(new org.ovirt.engine.core.common.businessentities.network.NetworkCluster()); when(networkDaoMock.get(eq(network.getId()))).thenReturn(network); assertThat(createNetworkAttachmentValidator(attachment).networkAttachedToCluster(), org.ovirt.engine.core.bll.validator.ValidationResultMatchers.isValid()); }
public org.ovirt.engine.core.bll.ValidationResult vmNotDuringMigration() { for (org.ovirt.engine.core.common.businessentities.VM vm : vms) { if (((vm.getStatus()) == (org.ovirt.engine.core.common.businessentities.VMStatus.MigratingFrom)) || ((vm.getStatus()) == (org.ovirt.engine.core.common.businessentities.VMStatus.MigratingTo))) { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_MIGRATION_IN_PROGRESS); } } return org.ovirt.engine.core.bll.ValidationResult.VALID; }
public java.util.Map deleteImage(java.lang.String imgUUID, java.lang.String spUUID, java.lang.String sdUUID, boolean postZero, boolean force) { try { log.info("Removing volume: {}", imgUUID); final java.util.Map resultMap = getOKStatus(); final org.ovirt.vdsmfake.domain.Task task = new org.ovirt.vdsmfake.domain.Task(getUuid()); resultMap.put("uuid", task.getId()); syncTask(null, task); org.ovirt.vdsmfake.task.TaskProcessor.getInstance().addTask(new org.ovirt.vdsmfake.task.TaskRequest(org.ovirt.vdsmfake.task.TaskType.FINISH_REMOVE_VOLUME, 5000L, task)); return resultMap; } catch (java.lang.Exception e) { throw error(e); } }
public java.lang.String getProviderName() { org.ovirt.engine.core.common.businessentities.Provider provider = getDeletedProvider(); return provider == null ? null : provider.getName(); }
public org.ovirt.engine.core.common.action.CreateSnapshotForVmParameters.CreateSnapshotStage getCreateSnapshotStage() { return createSnapshotStage; }
@org.ovirt.engine.ui.frontend.DefaultStringValue("Cannot ${action} ${type}: The disk ${diskAlias} is locked. Please try again in a few minutes.") java.lang.String ACTION_TYPE_FAILED_DISK_IS_LOCKED();
@java.lang.Override public int compare(org.ovirt.engine.core.common.scheduling.PolicyUnit pu1, org.ovirt.engine.core.common.scheduling.PolicyUnit pu2) { if ((pu1.isInternal()) != (pu2.isInternal())) { return !(pu1.isInternal()) ? -1 : 1; } if ((pu1.isEnabled()) != (pu2.isEnabled())) { return !(pu1.isEnabled()) ? -1 : 1; } if ((pu1.getPolicyUnitType()) != (pu2.getPolicyUnitType())) { if ((pu1.getPolicyUnitType().equals(PolicyUnitType.Filter)) || (pu2.getPolicyUnitType().equals(PolicyUnitType.LoadBalancing))) { return -1; } if ((pu2.getPolicyUnitType().equals(PolicyUnitType.Filter)) || (pu1.getPolicyUnitType().equals(PolicyUnitType.LoadBalancing))) { return 1; } } return lexoNumeric.compare(pu1.getName(), pu2.getName()); }
private boolean setVmsInTransitionAsUnknown(java.util.Set<org.ovirt.engine.core.compat.Guid> hostIds) { boolean runningVmsInTransition = false; final java.util.List<org.ovirt.engine.core.common.businessentities.VM> vms = vmDao.getAll(); for (org.ovirt.engine.core.common.businessentities.VM vm : vms) { if (!(vm.isNotRunning())) { if (((vm.getRunOnVds()) != null) && (hostIds.contains(vm.getRunOnVds()))) { resourceManager.SetVmUnknown(vm); } } if (isVmInTransition(vm)) { runningVmsInTransition = true; } } return runningVmsInTransition; }
private void runQueryByIdParameter(org.ovirt.engine.core.common.queries.VdcQueryType queryType, org.ovirt.engine.ui.frontend.AsyncQuery aQuery, org.ovirt.engine.core.compat.Guid id) { aQuery.converterCallback = new org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.AsIsAsyncConverter(); org.ovirt.engine.ui.frontend.Frontend.getInstance().runQuery(queryType, new org.ovirt.engine.core.common.queries.IdQueryParameters(id), aQuery); }
@org.junit.Test public void noVdsGroup() { simulateVdsGroupDoesNotExist(); assertCanDoActionFailure(EngineMessage.VDS_CLUSTER_IS_NOT_VALID.toString()); }
@java.lang.Override protected void executeQueryCommand() { getQueryReturnValue().setReturnValue(getDbFacade().getDiskProfileDao().getAll()); }
public org.ovirt.engine.ui.uicommonweb.models.EntityModel<java.lang.Boolean> getAllowOverbooking() { return allowOverbooking; }
public org.ovirt.engine.core.bll.ValidationResult nicExists() { return org.ovirt.engine.core.bll.ValidationResult.failWith(EngineMessage.HOST_NETWORK_INTERFACE_NOT_EXIST).when(((attachment.getNicName()) == null)); }
@java.lang.Override public com.google.gwt.safehtml.shared.SafeHtml getTooltip(org.ovirt.engine.core.common.businessentities.VDS vds, com.google.gwt.dom.client.Element parent, com.google.gwt.dom.client.NativeEvent event) { com.google.gwt.dom.client.Element target = event.getEventTarget().cast(); if (ImageElement.TAG.equalsIgnoreCase(target.getTagName())) { switch (org.ovirt.engine.ui.common.utils.JqueryUtils.index(target)) { case 0 : return com.google.gwt.safehtml.shared.SafeHtmlUtils.fromSafeConstant(getStatusTooltipText(vds.getStatus())); case 1 : return getAlertTooltipText(vds); } } return null; }
public org.ovirt.engine.core.common.businessentities.VDSType getVdsType() { return this.mVdsStatic.getVdsType(); }
private boolean evaluateHostUpgradeInternalCommandProgress(java.util.List<org.ovirt.engine.core.compat.Guid> childCmdIds, org.ovirt.engine.core.bll.CommandBase<?> rootCommand) { org.ovirt.engine.core.common.businessentities.CommandEntity upgradeCommand = getHostUpgradeInternalCommand(childCmdIds); if (upgradeCommand == null) { return false; } switch (upgradeCommand.getCommandStatus()) { case ACTIVE : case NOT_STARTED : return false; case FAILED : case FAILED_RESTARTED : case ENDED_WITH_FAILURE : case UNKNOWN : rootCommand.setCommandStatus(CommandStatus.FAILED); return true; case SUCCEEDED : case ENDED_SUCCESSFULLY : rootCommand.setCommandStatus(CommandStatus.SUCCEEDED); return true; } return true; }
private void onRestoreSnapshot() { runAction(VdcActionType.RestoreGlusterVolumeSnapshot, new org.ovirt.engine.core.common.action.gluster.GlusterVolumeSnapshotActionParameters(getEntity().getId(), ((org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeSnapshotEntity) (getSelectedItem())).getSnapshotName(), true)); }
@javax.ws.rs.POST @org.ovirt.engine.api.model.Actionable @javax.ws.rs.Path("testconnectivity") public javax.ws.rs.core.Response testConnectivity(org.ovirt.engine.api.model.Action action);
@java.lang.Override public void vdsNonOperational(org.ovirt.engine.core.compat.Guid vdsId, org.ovirt.engine.core.common.businessentities.NonOperationalReason reason, boolean logCommand, org.ovirt.engine.core.compat.Guid domainId) { org.ovirt.engine.core.common.businessentities.StorageDomainStatic storageDomain = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getStorageDomainStaticDao().get(domainId); java.util.Map<java.lang.String, java.lang.String> customLogValues = null; if (storageDomain != null) { customLogValues = java.util.Collections.singletonMap("StorageDomainNames", storageDomain.getName()); } vdsNonOperational(vdsId, reason, logCommand, domainId, customLogValues); }
static org.ovirt.engine.api.model.Network setUpEntityExpectations(org.ovirt.engine.core.common.businessentities.Network entity, boolean isDisplay, int index) { expect(entity.getis_display()).andReturn(isDisplay).anyTimes(); return org.ovirt.engine.api.restapi.resource.AbstractBackendNetworksResourceTest.setUpEntityExpectations(entity, index); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Allow to define/configure roles in the System") java.lang.String allowToDefineConfigureRolesInTheSystemRoleTreeTooltip();
@java.lang.Override protected boolean validate() { if (getParameters().getPubKeys().isEmpty()) { return failValidation(EngineMessage.ACTION_TYPE_FAILED_GLUSTER_NO_PUB_KEYS_PASSED); } if ((getParameters().getId()) == null) { return failValidation(EngineMessage.ACTION_TYPE_FAILED_HOST_NOT_EXIST); } return super.validate(); }
@java.lang.Override public org.ovirt.engine.core.common.AuditLogType getAuditLogTypeValue() { switch (org.ovirt.engine.core.bll.RemoveVmCommand.getActionState()) { case EXECUTE : return org.ovirt.engine.core.bll.RemoveVmCommand.getSucceeded() ? disksLeftInVm.isEmpty() ? org.ovirt.engine.core.common.AuditLogType.USER_REMOVE_VM_FINISHED : org.ovirt.engine.core.common.AuditLogType.USER_REMOVE_VM_FINISHED_WITH_ILLEGAL_DISKS : org.ovirt.engine.core.common.AuditLogType.USER_FAILED_REMOVE_VM; case END_FAILURE : case END_SUCCESS : default : return disksLeftInVm.isEmpty() ? org.ovirt.engine.core.common.AuditLogType.UNASSIGNED : org.ovirt.engine.core.common.AuditLogType.USER_REMOVE_VM_FINISHED_WITH_ILLEGAL_DISKS; } }
public java.util.Map getStorageDomainsList(java.lang.String spUUID, int domainType, int poolType, java.lang.String path) { try { org.ovirt.vdsmfake.domain.DataCenter dataCenter = getDataCenterById(spUUID); java.util.Map resultMap = getOKStatus(); java.util.List domlist = lst(); for (org.ovirt.vdsmfake.domain.StorageDomain storageDomain : dataCenter.getStorageDomainMap().values()) { if ((spUUID != null) && (!(storageDomain.getId().equals(spUUID)))) { continue; } if ((domainType != 0) && ((StorageDomain.DomainClass.getByCode(domainType)) != (storageDomain.getDomainClass()))) { continue; } if ((poolType != 0) && ((StorageDomain.StorageType.getByCode(poolType)) != (storageDomain.getStorageType()))) { continue; } if ((path != null) && (!(path.equals(storageDomain.getConnection())))) { continue; } domlist.add(storageDomain.getId()); } resultMap.put("domlist", domlist); return resultMap; } catch (java.lang.Exception e) { throw error(e); } }
private void changeStatus(org.ovirt.engine.core.common.vdscommands.DestroyVmVDSCommandParameters parameters, org.ovirt.engine.core.common.businessentities.VM curVm) { if (org.ovirt.engine.core.vdsbroker.DestroyVmVDSCommand.getVdsId().equals(curVm.getRunOnVds())) { org.ovirt.engine.core.vdsbroker.ResourceManager.getInstance().InternalSetVmStatus(curVm, (parameters.getGracefully() ? org.ovirt.engine.core.common.businessentities.VMStatus.PoweringDown : org.ovirt.engine.core.common.businessentities.VMStatus.Down)); } }
public static java.util.List<java.lang.String> initRange(java.lang.String start, java.lang.String end) { return org.ovirt.engine.core.utils.MacAddressRangeUtils.innerInitRange(start, end, false); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Edit iSCSI Bond") java.lang.String editIscsiBondTitle();
@java.lang.Override public void onSuccess(java.lang.Object target, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel model = ((org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel) (target)); model.setDataCentersAndClusters(model, dataCenters, ((java.util.List<org.ovirt.engine.core.common.businessentities.VDSGroup>) (returnValue)), vm.getVdsGroupId()); initTemplate(); initCdImage(); initSoundCard(vm.getId()); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("If kernel parameters are specified, kernel path must be specified as well.") java.lang.String kernelParamsInvalid();
public org.ovirt.engine.core.bll.ValidationResult exists() { if ((vds) == null) { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.VdcBllMessages.VDS_DOES_NOT_EXIST); } return ValidationResult.VALID; }
public java.util.List<org.ovirt.engine.core.compat.Guid> getSelectedVmIds() { java.util.List<org.ovirt.engine.core.compat.Guid> list = new java.util.ArrayList<org.ovirt.engine.core.compat.Guid>(); for (org.ovirt.engine.ui.uicommonweb.models.vms.key_value.KeyValueLineModel keyModel : getItems()) { java.lang.String selectedItem = keyModel.getKeys().getSelectedItem(); if (isKeyValid(selectedItem)) { list.add(allVmNameMap.get(selectedItem).getId()); } } return list; }
@java.lang.Override public org.ovirt.engine.core.common.businessentities.Permission getForRoleAndAdElementAndObject(org.ovirt.engine.core.compat.Guid roleid, org.ovirt.engine.core.compat.Guid elementid, org.ovirt.engine.core.compat.Guid objectid) { org.springframework.jdbc.core.namedparam.MapSqlParameterSource parameterSource = getCustomMapSqlParameterSource().addValue("role_id", roleid).addValue("ad_element_id", elementid).addValue("object_id", objectid); return getCallsHandler().executeRead("GetPermissionsByRoleIdAndAdElementIdAndObjectId", org.ovirt.engine.core.dao.PermissionDaoImpl.PermissionRowMapper.instance, parameterSource); }
protected org.ovirt.engine.core.common.businessentities.VmDevice createVmDevice() { return new org.ovirt.engine.core.common.businessentities.VmDevice(new org.ovirt.engine.core.common.businessentities.VmDeviceId(disk.getId(), org.ovirt.engine.core.bll.AttachDiskToVmCommand.getVmId()), org.ovirt.engine.core.common.businessentities.VmDeviceGeneralType.DISK, VmDeviceType.DISK.getName(), "", 0, null, true, org.ovirt.engine.core.bll.AttachDiskToVmCommand.getParameters().isPlugUnPlug(), org.ovirt.engine.core.bll.AttachDiskToVmCommand.getParameters().isReadOnly(), "", null, org.ovirt.engine.core.bll.AttachDiskToVmCommand.getParameters().getSnapshotId()); }
private org.ovirt.engine.ui.uicommonweb.validation.ValidationResult validateBrowserParsabilityAndDimensions(java.lang.String icon) { final int maxWidth = 150; final int maxHeight = 120; final com.google.gwt.user.client.ui.Image image = new com.google.gwt.user.client.ui.Image(icon); boolean complete = isComplete(image.getElement()); if (!complete) { return org.ovirt.engine.ui.uicommonweb.validation.ValidationResult.fail(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().iconIsNotParsable()); } boolean valid = ((image.getWidth()) <= maxWidth) && ((image.getHeight()) <= maxHeight); if (valid) { return org.ovirt.engine.ui.uicommonweb.validation.ValidationResult.ok(); } return org.ovirt.engine.ui.uicommonweb.validation.ValidationResult.fail(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getMessages().iconDimensionsTooLarge(image.getWidth(), image.getWidth(), maxWidth, maxHeight)); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("VM Interface Profile") java.lang.String vnicProfileTitle();
@org.junit.Test public void syncNetworkQosNotSupported() { org.ovirt.engine.core.common.businessentities.network.Network network = createManagementNetwork(); mockExistingNetworks(network); org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface iface = createNicSyncedWithNetwork("eth0", network); mockExistingIfaces(iface); org.ovirt.engine.core.compat.Guid qosId = org.ovirt.engine.core.compat.Guid.newGuid(); when(qosDao.get(qosId)).thenReturn(createQos()); network.setQosId(qosId); org.ovirt.engine.core.bll.network.host.SetupNetworksHelper helper = createHelper(createParametersForSync(iface)); validateAndExpectViolation(helper, EngineMessage.ACTION_TYPE_FAILED_HOST_NETWORK_QOS_NOT_SUPPORTED, org.ovirt.engine.core.bll.network.host.SetupNetworksHelperTest.MANAGEMENT_NETWORK_NAME); }
public boolean hasCommandEntitiesWithRootCommandId(org.ovirt.engine.core.compat.Guid rootCommandId) { org.ovirt.engine.core.common.businessentities.CommandEntity cmdEntity; for (org.ovirt.engine.core.compat.Guid cmdId : commandsCache.keySet()) { cmdEntity = commandsCache.get(cmdId); if ((((cmdEntity != null) && (!(org.ovirt.engine.core.compat.Guid.isNullOrEmpty(cmdEntity.getRootCommandId())))) && (!(cmdEntity.getRootCommandId().equals(cmdId)))) && (cmdEntity.getRootCommandId().equals(rootCommandId))) { return true; } } return false; }
protected void addVmStatic() { org.ovirt.engine.core.common.businessentities.VmStatic vmStatic = org.ovirt.engine.core.bll.AddVmCommand.getParameters().getVmStaticData(); if ((vmStatic.getOrigin()) == null) { vmStatic.setOrigin(org.ovirt.engine.core.common.businessentities.OriginType.valueOf(org.ovirt.engine.core.common.config.Config.<java.lang.String>GetValue(ConfigValues.OriginType))); } vmStatic.setId(org.ovirt.engine.core.bll.AddVmCommand.getVmId()); vmStatic.setQuotaId(getQuotaId()); vmStatic.setCreationDate(new java.util.Date()); if ((vmStatic.getCustomProperties()) != null) { org.ovirt.engine.core.utils.customprop.VmPropertiesUtils.VMCustomProperties properties = org.ovirt.engine.core.utils.customprop.VmPropertiesUtils.getInstance().parseProperties(org.ovirt.engine.core.bll.AddVmCommand.getVdsGroupDAO().get(org.ovirt.engine.core.bll.AddVmCommand.getParameters().getVm().getVdsGroupId()).getcompatibility_version(), vmStatic.getCustomProperties()); java.lang.String predefinedProperties = properties.getPredefinedProperties(); java.lang.String userDefinedProperties = properties.getUseDefinedProperties(); vmStatic.setPredefinedProperties(predefinedProperties); vmStatic.setUserDefinedProperties(userDefinedProperties); } getVmStaticDao().save(vmStatic); org.ovirt.engine.core.bll.AddVmCommand.getCompensationContext().snapshotNewEntity(vmStatic); }
private com.google.gwt.user.client.ui.Widget getRadioGroupPanel() { allButton = new com.google.gwt.user.client.ui.RadioButton("diskTypeView"); imagesButton = new com.google.gwt.user.client.ui.RadioButton("diskTypeView"); lunsButton = new com.google.gwt.user.client.ui.RadioButton("diskTypeView"); allButton.getElement().getStyle().setMarginRight(20, Unit.PX); imagesButton.getElement().getStyle().setMarginRight(20, Unit.PX); lunsButton.getElement().getStyle().setMarginRight(20, Unit.PX); com.google.gwt.user.client.ui.FlowPanel buttonsPanel = new com.google.gwt.user.client.ui.FlowPanel(); buttonsPanel.getElement().getStyle().setProperty("marginLeft", "auto"); buttonsPanel.getElement().getStyle().setProperty("marginRight", "auto"); buttonsPanel.add(allButton); buttonsPanel.add(imagesButton); buttonsPanel.add(lunsButton); setDiskStorageType(DiskStorageType.IMAGE); localize(constants); return buttonsPanel; }
@org.junit.Test public void nullTest() { org.ovirt.engine.ui.uicommonweb.validation.ValidationResult validationResult = underTest.validate(null); org.junit.Assert.assertEquals(failureValidationResultEmptyNotAllowed, validationResult); }
@java.lang.Override public void executed(org.ovirt.engine.ui.uicompat.FrontendMultipleActionAsyncResult result) { boolean hasError = false; for (org.ovirt.engine.core.common.action.VdcReturnValueBase singleResult : result.getReturnValue()) { if ((!(singleResult.isValid())) || ((waitForResult) && (!(singleResult.getSucceeded())))) { hasError = true; getActionFlowState().addFailure(actionType, singleResult); } } if (hasError && (!(runNextInCaseOfError))) { then(null); } runNextAction(); }
private boolean fetchStorageDomainInfo() { org.ovirt.engine.core.common.queries.VdcQueryReturnValue allDomainsQuery = org.ovirt.engine.core.bll.ImportHostedEngineStorageDomainCommand.getBackend().runInternalQuery(VdcQueryType.GetExistingStorageDomainList, new org.ovirt.engine.core.common.queries.GetExistingStorageDomainListParameters(org.ovirt.engine.core.bll.ImportHostedEngineStorageDomainCommand.getParameters().getVdsId(), null, org.ovirt.engine.core.common.businessentities.StorageDomainType.Data, null)); if (allDomainsQuery.getSucceeded()) { for (org.ovirt.engine.core.common.businessentities.StorageDomain sd : ((java.util.List<org.ovirt.engine.core.common.businessentities.StorageDomain>) (allDomainsQuery.getReturnValue()))) { if (sd.getName().equals(org.ovirt.engine.core.common.config.Config.<java.lang.String>getValue(ConfigValues.HostedEngineStorageDomainName))) { heStorageDomain = sd; return true; } } } else { log.error(("Failed query for all Storage Domains." + " The import command can not proceed without this info")); } return false; }
@org.junit.Test public void externalNetworkNotSupported() throws java.lang.Exception { externalNetworkSupportTest(failsWith(EngineMessage.ACTION_TYPE_FAILED_EXTERNAL_NETWORK_NOT_SUPPORTED), false); }
protected java.util.List<org.ovirt.engine.core.common.businessentities.Permission> setUpPermissionsWithAdElementId(org.ovirt.engine.core.compat.Guid adElementId) { java.util.List<org.ovirt.engine.core.common.businessentities.Permission> perms = new java.util.ArrayList<>(); for (int i = 0; i < (NAMES.length); i++) { org.ovirt.engine.core.common.businessentities.Permission entity = getEntity(i); entity.setAdElementId(adElementId); perms.add(entity); } return perms; }
@java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs args) { java.lang.String propName = args.propertyName; if ("IsCiscoUcsPrimaryPmTypeSelected".equals(propName)) { getView().updatePrimaryPmSlotLabelText(model.isCiscoUcsPrimaryPmTypeSelected()); } else if ("IsCiscoUcsSecondaryPmTypeSelected".equals(propName)) { getView().updateSecondaryPmSlotLabelText(model.isCiscoUcsSecondaryPmTypeSelected()); } }
public org.ovirt.engine.core.bll.ValidationResult hotUpdateDoneWithInternalNetwork(org.ovirt.engine.core.common.businessentities.network.Network oldNetwork, org.ovirt.engine.core.common.businessentities.network.Network newNetwork) { return ((oldNetwork == null) || (!(oldNetwork.isExternal()))) && ((newNetwork == null) || (!(newNetwork.isExternal()))) ? org.ovirt.engine.core.bll.ValidationResult.VALID : new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_EXTERNAL_NETWORK_CANNOT_BE_REWIRED); }
@java.lang.Override protected org.springframework.jdbc.core.RowMapper<org.ovirt.engine.core.common.businessentities.VmIcon> createEntityRowMapper() { return new org.springframework.jdbc.core.RowMapper<org.ovirt.engine.core.common.businessentities.VmIcon>() { @java.lang.Override public org.ovirt.engine.core.common.businessentities.VmIcon mapRow(java.sql.ResultSet rs, int rowNum) throws java.sql.SQLException { org.ovirt.engine.core.common.businessentities.VmIcon icon = new org.ovirt.engine.core.common.businessentities.VmIcon(); icon.setId(getGuid(rs, org.ovirt.engine.core.dao.VmIconDaoImpl.ID_COLUMN)); icon.setDataUrl(rs.getString(org.ovirt.engine.core.dao.VmIconDaoImpl.DATA_URL_COLUMN)); return icon; } }; }
@java.lang.Override protected org.ovirt.engine.core.common.businessentities.VDS getEntity(int index) { org.ovirt.engine.core.common.businessentities.VDS entity = org.ovirt.engine.api.restapi.resource.BackendHostsResourceTest.setUpEntityExpectations(control.createMock(org.ovirt.engine.core.common.businessentities.VDS.class), null, index); return entity; }
protected org.ovirt.engine.core.compat.Guid createTask(org.ovirt.engine.core.compat.Guid taskId, org.ovirt.engine.core.common.vdscommands.VDSReturnValue vdsReturnValue, org.ovirt.engine.core.compat.Guid storageDomainId) { java.lang.String message = org.ovirt.engine.core.dal.job.ExecutionMessageDirector.resolveStepMessage(StepEnum.MERGE_SNAPSHOTS, org.ovirt.engine.core.bll.RemoveSnapshotSingleDiskCommand.getJobMessageProperties()); return super.createTask(taskId, vdsReturnValue.getCreationInfo(), org.ovirt.engine.core.bll.RemoveSnapshotSingleDiskCommand.getParameters().getParentCommand(), message, VdcObjectType.Storage, storageDomainId); }
private org.ovirt.engine.core.common.businessentities.VmInit buildModelSpecificParameters(boolean isWindows) { org.ovirt.engine.core.common.businessentities.VmInit vmInit = buildCloudInitParameters(); if (isWindows && ((java.lang.Boolean) (getWindowsSysprepTimeZoneEnabled().getEntity()))) { java.util.Map.Entry<java.lang.String, java.lang.String> entry = ((java.util.Map.Entry<java.lang.String, java.lang.String>) (getWindowsSysprepTimeZone().getSelectedItem())); vmInit.setTimeZone(entry.getKey()); } else if ((!isWindows) && ((java.lang.Boolean) (getTimeZoneEnabled().getEntity()))) { java.util.Map.Entry<java.lang.String, java.lang.String> entry = ((java.util.Map.Entry<java.lang.String, java.lang.String>) (getTimeZoneList().getSelectedItem())); vmInit.setTimeZone(entry.getKey()); } if (isWindows) { vmInit.setDomain(getSysprepDomain().getSelectedItem()); } return vmInit; }
@java.lang.Override protected void setActionMessageParameters() { addValidationMessage(EngineMessage.VAR__ACTION__SET); addValidationMessage(EngineMessage.VAR__TYPE__GLUSTER_GEOREP_CONFIG); addValidationMessageVariable("configName", getParameters().getConfigKey()); addValidationMessageVariable("geoRepSessionKey", getGeoRepSession().getSessionKey()); addValidationMessageVariable("configValue", getParameters().getConfigValue()); }
@org.junit.Test public void testRunPublicQuery_GetConfigurationValue() { java.lang.String sessionId = "sessionId"; org.ovirt.engine.core.common.queries.VdcQueryType queryType = org.ovirt.engine.core.common.queries.VdcQueryType.GetConfigurationValue; org.ovirt.engine.core.common.queries.VdcQueryReturnValue returnIntValue = new org.ovirt.engine.core.common.queries.VdcQueryReturnValue(); returnIntValue.setSucceeded(true); returnIntValue.setReturnValue(java.lang.Integer.valueOf(255)); when(mockBackend.runPublicQuery(eq(VdcQueryType.GetConfigurationValue), eq(mockConfigQueryParams))).thenReturn(returnIntValue); java.lang.Object result = testServlet.runPublicQuery(queryType, mockConfigQueryParams, sessionId); assertThat(result, is(org.ovirt.engine.ui.frontend.server.gwt.AbstractGwtDynamicHostPageServletTest.instanceOf(java.lang.Integer.class))); verify(mockConfigQueryParams).setSessionId(sessionId); verify(mockConfigQueryParams).setHttpSessionId(sessionId); verify(mockConfigQueryParams).setFiltered(testServlet.filterQueries()); verify(mockBackend).runPublicQuery(queryType, mockConfigQueryParams); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Edit Pool") java.lang.String editPoolTitle();
@java.lang.Override public void setMainTabSelectedItem(org.ovirt.engine.core.common.businessentities.StorageDomain selectedItem) { driver.edit(getDetailModel()); org.ovirt.engine.core.common.businessentities.StorageDomain entity = ((org.ovirt.engine.core.common.businessentities.StorageDomain) (getDetailModel().getEntity())); if (entity != null) { totalSize.setValue(entity.getTotalDiskSize()); availableSize.setValue(entity.getAvailableDiskSize()); usedSize.setValue(entity.getUsedDiskSize()); allocatedSize.setValue(entity.getCommittedDiskSize()); overAllocationRatio.setValue(entity.getStorageDomainOverCommitPercent()); warningLowSpaceIndicator.setValue(org.ovirt.engine.ui.webadmin.section.main.view.tab.storage.SubTabStorageGeneralView.messages.percentWithValueInGB(entity.getWarningLowSpaceIndicator(), entity.getWarningLowSpaceSize())); criticalSpaceActionBlocker.setValue(entity.getCriticalSpaceActionBlocker()); } formBuilder.update(getDetailModel()); }
@java.lang.Override protected boolean canDoAction() { disk = org.ovirt.engine.core.bll.HotPlugDiskToVmCommand.getDiskDao().get(org.ovirt.engine.core.bll.HotPlugDiskToVmCommand.getParameters().getDiskId()); return ((((org.ovirt.engine.core.bll.HotPlugDiskToVmCommand.isVmExist()) && (org.ovirt.engine.core.bll.HotPlugDiskToVmCommand.isVmInUpPausedDownStatus())) && (isDiskExist(disk))) && (checkCanPerformPlugUnPlugDisk())) && (org.ovirt.engine.core.bll.HotPlugDiskToVmCommand.isVmNotInPreviewSnapshot()); }
private static java.util.Map<java.lang.String, java.lang.Object> search(java.lang.String token, java.util.Map<java.lang.String, java.lang.Object> params, java.lang.String queryType, java.lang.String scope) { java.net.HttpURLConnection connection = null; try { connection = org.ovirt.engine.core.aaa.SSOOAuthServiceUtils.createConnection("/oauth/token-info"); org.ovirt.engine.core.aaa.SSOOAuthServiceUtils.setClientIdSecretBasicAuthHeader(connection); org.ovirt.engine.core.uutils.net.URLBuilder urlBuilder = new org.ovirt.engine.core.uutils.net.URLBuilder(connection.getURL()).addParameter("query_type", queryType).addParameter("scope", scope); if (org.apache.commons.lang.StringUtils.isNotEmpty(token)) { urlBuilder.addParameter("token", token); } if (params != null) { urlBuilder.addParameter("params", org.ovirt.engine.core.aaa.SSOOAuthServiceUtils.encode(new org.ovirt.engine.core.utils.serialization.json.JsonObjectSerializer().serialize(params))); } org.ovirt.engine.core.aaa.SSOOAuthServiceUtils.postData(connection, urlBuilder.buildURL().getQuery()); return org.ovirt.engine.core.aaa.SSOOAuthServiceUtils.getData(connection); } catch (java.lang.Exception ex) { return org.ovirt.engine.core.aaa.SSOOAuthServiceUtils.buildMapWithError("server_error", ex.getMessage()); } finally { if (connection != null) { connection.disconnect(); } } }
public static org.ovirt.engine.core.vdsbroker.VMStatsRefresher create(final org.ovirt.engine.core.vdsbroker.VdsManager manager, final org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogDirector auditLogDirector, final org.ovirt.engine.core.utils.timer.SchedulerUtil scheduler) { return new org.ovirt.engine.core.vdsbroker.PollVMStatsRefresher(manager, auditLogDirector, scheduler); }
@java.lang.Override protected void executeCommand() { if (org.ovirt.engine.core.bll.RemoveVmTemplateCommand.getVmTemplate().isBaseTemplate()) { shiftBaseTemplateToSuccessor(); } java.util.List<org.ovirt.engine.core.common.businessentities.storage.Disk> templateImages = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getDiskDao().getAllForVm(org.ovirt.engine.core.bll.RemoveVmTemplateCommand.getVmTemplateId()); final java.util.List<org.ovirt.engine.core.common.businessentities.storage.CinderDisk> cinderDisks = org.ovirt.engine.core.bll.storage.disk.image.ImagesHandler.filterDisksBasedOnCinder(templateImages); final java.util.List<org.ovirt.engine.core.common.businessentities.storage.DiskImage> diskImages = org.ovirt.engine.core.bll.storage.disk.image.DisksFilter.filterImageDisks(templateImages, org.ovirt.engine.core.bll.ONLY_ACTIVE); org.ovirt.engine.core.bll.VmTemplateHandler.lockVmTemplateInTransaction(org.ovirt.engine.core.bll.RemoveVmTemplateCommand.getVmTemplateId(), org.ovirt.engine.core.bll.RemoveVmTemplateCommand.getCompensationContext()); if ((!(diskImages.isEmpty())) || (!(cinderDisks.isEmpty()))) { org.ovirt.engine.core.utils.transaction.TransactionSupport.executeInNewTransaction(() -> { if ((!(diskImages.isEmpty())) && (removeVmTemplateImages())) { org.ovirt.engine.core.bll.VmHandler.removeVmInitFromDB(getVmTemplate()); setSucceeded(true); } if (!(cinderDisks.isEmpty())) { removeCinderDisks(cinderDisks); setSucceeded(true); } return null; }); } if (org.ovirt.engine.core.bll.RemoveVmTemplateCommand.noAsyncOperations()) { handleEndAction(); } }
@java.lang.Override public int hashCode() { final int prime = 31; int result = super.hashCode(); result = (prime * result) + ((defaultDisplayType) == null ? 0 : defaultDisplayType.hashCode()); result = (prime * result) + (initialized ? 1231 : 1237); result = (prime * result) + (diskSize); result = (prime * result) + ((name) == null ? 0 : name.hashCode()); result = (prime * result) + ((predefinedProperties) == null ? 0 : predefinedProperties.hashCode()); result = (prime * result) + ((userDefinedProperties) == null ? 0 : userDefinedProperties.hashCode()); result = (prime * result) + ((vmtGuid) == null ? 0 : vmtGuid.hashCode()); result = (prime * result) + (useHostCpuFlags ? 0 : 1); return result; }
@java.lang.Override public boolean isReadable(java.lang.Class<?> type, java.lang.reflect.Type genericType, java.lang.annotation.Annotation[] annotations, javax.ws.rs.core.MediaType mediaType) { return org.ovirt.engine.api.restapi.xml.JAXBProvider.SUPPORTED_VERSION.equals(org.ovirt.engine.api.restapi.invocation.CurrentManager.get().getVersion()); }
@org.junit.Test public void canSetNumaConfigurationWithVmFromParams() { mockCommandWithVmFromParams(); command.executeCommand(); verify(vmNumaNodeDao).massSaveNumaNode(eq(paramNumaNodes), any(org.ovirt.engine.core.compat.Guid.class)); }
protected org.ovirt.engine.core.compat.Guid addStorageDomain(org.ovirt.engine.core.common.businessentities.storage.StorageType storageType, org.ovirt.engine.core.common.businessentities.StorageDomainType storageDomainType) { org.ovirt.engine.core.common.businessentities.StorageDomainStatic domainStaticEntry = new org.ovirt.engine.core.common.businessentities.StorageDomainStatic(); domainStaticEntry.setId(org.ovirt.engine.core.compat.Guid.newGuid()); domainStaticEntry.setStorage(provider.getId().toString()); domainStaticEntry.setStorageName(provider.getName()); domainStaticEntry.setDescription(provider.getDescription()); domainStaticEntry.setStorageFormat(StorageFormatType.V1); domainStaticEntry.setStorageType(storageType); domainStaticEntry.setStorageDomainType(storageDomainType); domainStaticEntry.setWipeAfterDelete(false); org.ovirt.engine.core.bll.provider.storage.AbstractOpenStackStorageProviderProxy.getDbFacade().getStorageDomainStaticDao().save(domainStaticEntry); org.ovirt.engine.core.common.businessentities.StorageDomainDynamic domainDynamicEntry = new org.ovirt.engine.core.common.businessentities.StorageDomainDynamic(); domainDynamicEntry.setId(domainStaticEntry.getId()); domainDynamicEntry.setAvailableDiskSize(0); domainDynamicEntry.setUsedDiskSize(0); org.ovirt.engine.core.bll.provider.storage.AbstractOpenStackStorageProviderProxy.getDbFacade().getStorageDomainDynamicDao().save(domainDynamicEntry); return domainStaticEntry.getId(); }
public org.ovirt.engine.core.common.businessentities.AsyncTask getAsyncTaskFromDb(org.ovirt.engine.core.compat.Guid asyncTaskId) { org.ovirt.engine.core.common.businessentities.AsyncTask asyncTask = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getAsyncTaskDao().get(asyncTaskId); if (asyncTask != null) { asyncTask.setRootCmdEntity(getCommandEntity(asyncTask.getRootCommandId())); asyncTask.setChildCmdEntity(getCommandEntity(asyncTask.getCommandId())); } return asyncTask; }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Detach Storage") java.lang.String detachStorageTitle();
private boolean canRemoveVmImageDisk() { if (!(listVms.isEmpty())) { org.ovirt.engine.core.compat.Guid storagePoolId = listVms.get(0).getStoragePoolId(); org.ovirt.engine.core.common.businessentities.StoragePool sp = org.ovirt.engine.core.bll.storage.disk.RemoveDiskCommand.getStoragePoolDao().get(storagePoolId); if (!(validate(new org.ovirt.engine.core.bll.validator.storage.StoragePoolValidator(sp).isUp()))) { return false; } java.util.List<org.ovirt.engine.core.common.businessentities.storage.DiskImage> diskList = org.ovirt.engine.core.bll.storage.disk.image.DisksFilter.filterImageDisks(java.util.Collections.singletonList(getDisk()), org.ovirt.engine.core.bll.storage.disk.ONLY_NOT_SHAREABLE, org.ovirt.engine.core.bll.storage.disk.ONLY_ACTIVE); org.ovirt.engine.core.bll.validator.storage.DiskImagesValidator diskImagesValidator = new org.ovirt.engine.core.bll.validator.storage.DiskImagesValidator(diskList); if (!(validate(diskImagesValidator.diskImagesNotLocked()))) { return false; } } org.ovirt.engine.core.bll.snapshots.SnapshotsValidator snapshotsValidator = new org.ovirt.engine.core.bll.snapshots.SnapshotsValidator(); for (org.ovirt.engine.core.common.businessentities.VM vm : listVms) { if ((!(validate(snapshotsValidator.vmNotDuringSnapshot(vm.getId())))) || (!(validate(snapshotsValidator.vmNotInPreview(vm.getId()))))) { return false; } } return true; }
@java.lang.Override protected boolean isRoleSet(org.ovirt.engine.core.common.businessentities.network.NetworkCluster originalNetworkCluster) { return originalNetworkCluster.isDisplay(); }
@java.lang.Override protected void executeCommand() { org.ovirt.engine.core.compat.Guid taskId = persistAsyncTaskPlaceHolder(VdcActionType.RemoveVmTemplate); org.ovirt.engine.core.common.vdscommands.VDSReturnValue vdsReturnValue = runVdsCommand(VDSCommandType.DeleteImageGroup, org.ovirt.engine.core.bll.storage.domain.PostDeleteActionHandler.fixParameters(new org.ovirt.engine.core.common.vdscommands.DeleteImageGroupVDSCommandParameters(org.ovirt.engine.core.bll.snapshots.RemoveTemplateSnapshotCommand.getParameters().getStoragePoolId(), org.ovirt.engine.core.bll.snapshots.RemoveTemplateSnapshotCommand.getParameters().getStorageDomainId(), org.ovirt.engine.core.bll.snapshots.RemoveTemplateSnapshotCommand.getParameters().getImageGroupID(), org.ovirt.engine.core.bll.snapshots.RemoveTemplateSnapshotCommand.getParameters().getWipeAfterDelete(), false))); if (vdsReturnValue.getSucceeded()) { org.ovirt.engine.core.bll.snapshots.RemoveTemplateSnapshotCommand.getReturnValue().getInternalVdsmTaskIdList().add(createTask(taskId, vdsReturnValue.getCreationInfo(), VdcActionType.RemoveVmTemplate, VdcObjectType.Storage, org.ovirt.engine.core.bll.snapshots.RemoveTemplateSnapshotCommand.getParameters().getStorageDomainId())); org.ovirt.engine.core.bll.snapshots.RemoveTemplateSnapshotCommand.setSucceeded(true); } }
private boolean isStartProfileAvailable(java.util.List<org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity> list) { if ((getSelectedItems().size()) == 0) { return false; } else { for (org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity volumeEntity : list) { if ((volumeEntity.getStatus()) == (org.ovirt.engine.core.common.businessentities.gluster.GlusterStatus.DOWN)) { return false; } if (((volumeEntity.getOptionValue("diagnostics.latency-measurement")) != null) && (volumeEntity.getOptionValue("diagnostics.latency-measurement").equals("on"))) { return false; } } return true; } }
private org.ovirt.engine.core.common.businessentities.storage.DiskImage createMetadataDisk(org.ovirt.engine.core.common.businessentities.VM vm, org.ovirt.engine.core.common.businessentities.Snapshot snapshot) { org.ovirt.engine.core.common.businessentities.StorageDomainStatic sd = validateStorageDomainExistsInDb(snapshot, memoryDiskDomainMap.get(snapshot.getMetadataDiskId())); org.ovirt.engine.core.common.businessentities.storage.DiskImage disk = isMemoryDiskAlreadyExistsInDb(snapshot, snapshot.getMetadataDiskId()); if ((sd == null) || (disk != null)) { return null; } org.ovirt.engine.core.common.businessentities.storage.DiskImage memoryDisk = org.ovirt.engine.core.bll.memory.MemoryUtils.createSnapshotMetadataDisk(org.ovirt.engine.core.bll.memory.MemoryUtils.generateMemoryDiskDescription(vm, snapshot.getDescription())); memoryDisk.setId(snapshot.getMetadataDiskId()); memoryDisk.setImageId(getMemoryDiskImageId(snapshot.getMetadataDiskId())); memoryDisk.setStorageIds(new java.util.ArrayList(java.util.Collections.singletonList(sd.getId()))); memoryDisk.setStoragePoolId(org.ovirt.engine.core.bll.exportimport.ImportVmCommand.getStoragePoolId()); memoryDisk.setCreationDate(snapshot.getCreationDate()); memoryDisk.setActive(true); memoryDisk.setWipeAfterDelete(vm.getDiskList().stream().anyMatch(DiskImage::isWipeAfterDelete)); return memoryDisk; }
private void validateBase64() { try { rawImageData = javax.xml.bind.DatatypeConverter.parseBase64Binary(base64Data); } catch (java.lang.ArrayIndexOutOfBoundsException | java.lang.IllegalArgumentException e) { validationResult = new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.VM_ICON_BASE64_PART_MALFORMED); } }
@java.lang.Override public void setTooltip(com.google.gwt.safehtml.shared.SafeHtml tooltip) { buttonTooltip.setHtml(tooltip); }
public boolean candidateOperation(java.lang.String op1Key, java.lang.String op1Type, java.lang.String op2Key, java.lang.String op2Type, boolean drop) { org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkInterfaceModel nic1 = null; org.ovirt.engine.ui.uicommonweb.models.hosts.network.LogicalNetworkModel network1 = null; org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkInterfaceModel nic2 = null; org.ovirt.engine.ui.uicommonweb.models.hosts.network.LogicalNetworkModel network2 = null; if (org.ovirt.engine.ui.uicommonweb.models.hosts.HostSetupNetworksModel.NIC.equals(op1Type)) { nic1 = nicMap.get(op1Key); } else if (org.ovirt.engine.ui.uicommonweb.models.hosts.HostSetupNetworksModel.NETWORK.equals(op1Type)) { network1 = networkMap.get(op1Key); } if (org.ovirt.engine.ui.uicommonweb.models.hosts.HostSetupNetworksModel.NIC.equals(op2Type)) { nic2 = nicMap.get(op2Key); } else if (org.ovirt.engine.ui.uicommonweb.models.hosts.HostSetupNetworksModel.NETWORK.equals(op2Type)) { network2 = networkMap.get(op2Key); } org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkItemModel<?> op1 = (nic1 == null) ? network1 : nic1; org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkItemModel<?> op2 = (nic2 == null) ? network2 : nic2; return candidateOperation(op1, op2, drop); }
@java.lang.Override protected java.util.Map<java.lang.String, org.ovirt.engine.core.common.utils.Pair<java.lang.String, java.lang.String>> getSharedLocks() { final java.lang.String lockMessage = (EngineMessage.ACTION_TYPE_FAILED_CLUSTER_IS_BEING_UPDATED.name()) + (org.ovirt.engine.core.utils.ReplacementUtils.createSetVariableString("clusterName", oldGroup.getName())); return vmsLockedForUpdate.stream().collect(java.util.stream.Collectors.toMap(( vm) -> vm.getId().toString(), ( vm) -> org.ovirt.engine.core.bll.LockMessagesMatchUtil.makeLockingPair(LockingGroup.VM, lockMessage))); }
@org.junit.Test public void dontSyncNetworkOnDefaultMtu() { org.ovirt.engine.core.common.businessentities.Network net = createNetwork("net"); org.ovirt.engine.core.common.businessentities.VdsNetworkInterface nic = createNicSyncedWithNetwork("nic0", net); nic.setMtu(org.ovirt.engine.core.utils.RandomUtils.instance().nextInt()); mockExistingNetworks(net); mockExistingIfaces(nic); org.ovirt.engine.core.bll.SetupNetworksHelper helper = createHelper(createParametersForSync(nic)); validateAndAssertNoChanges(helper); }
public java.util.Date getCertificationExpirationDate() { if (((this.sslSession) == null) || (!(this.sslSession.isValid()))) { throw new java.lang.IllegalStateException("SSL session is not available"); } try { return ((java.security.cert.X509Certificate) (this.sslSession.getPeerCertificates()[0])).getNotAfter(); } catch (javax.net.ssl.SSLPeerUnverifiedException e) { logException(org.ovirt.vdsm.jsonrpc.client.reactors.SSLClient.log, "Failed to get peer certificates", e); throw new java.lang.RuntimeException(e); } }
@org.junit.Test public void testNotRemovingUsedPoolRecordIsUsed() throws java.lang.Exception { macPool.setId(org.ovirt.engine.core.compat.Guid.newGuid()); final org.ovirt.engine.core.common.businessentities.StoragePool storagePool = new org.ovirt.engine.core.common.businessentities.StoragePool(); storagePool.setName("storagePool"); when(storagePoolDao.getAllDataCentersByMacPoolId(macPool.getId())).thenReturn(java.util.Collections.singletonList(storagePool)); assertThat(macPoolValidator.notRemovingUsedPool(), failsWith(VdcBllMessages.ACTION_TYPE_FAILED_CANNOT_REMOVE_STILL_USED_MAC_POOL)); }
public java.lang.Integer getMemCommited() { return vdsDynamic.getMemCommited(); }
@java.lang.Override public boolean validateStoragePoolConnectionsInHost(org.ovirt.engine.core.common.businessentities.VDS vds, java.util.List<org.ovirt.engine.core.common.businessentities.StorageServerConnections> connections, org.ovirt.engine.core.compat.Guid storagePoolId) { if ((connections.size()) > 0) { @java.lang.SuppressWarnings("unchecked") java.util.Map<java.lang.String, java.lang.String> validateConnections = ((java.util.Map<java.lang.String, java.lang.String>) (org.ovirt.engine.core.bll.Backend.getInstance().getResourceManager().RunVdsCommand(VDSCommandType.ValidateStorageServerConnection, new org.ovirt.engine.core.common.vdscommands.ConnectStorageServerVDSCommandParameters(vds.getId(), storagePoolId, org.ovirt.engine.core.common.businessentities.StorageType.ISCSI, connections)).getReturnValue())); return IsConnectSucceeded(validateConnections, connections); } return true; }
protected org.ovirt.engine.core.common.action.CreateAllSnapshotsFromVmParameters getCreateSnapshotParameters() { org.ovirt.engine.core.common.action.CreateAllSnapshotsFromVmParameters params = new org.ovirt.engine.core.common.action.CreateAllSnapshotsFromVmParameters(org.ovirt.engine.core.bll.storage.lsm.LiveMigrateVmDisksCommand.getParameters().getVmId(), "Auto-generated for Live Storage Migration"); params.setParentCommand(VdcActionType.LiveMigrateVmDisks); params.setSnapshotType(SnapshotType.REGULAR); params.setParentParameters(org.ovirt.engine.core.bll.storage.lsm.LiveMigrateVmDisksCommand.getParameters()); params.setImagesParameters(org.ovirt.engine.core.bll.storage.lsm.LiveMigrateVmDisksCommand.getParameters().getImagesParameters()); params.setTaskGroupSuccess(org.ovirt.engine.core.bll.storage.lsm.LiveMigrateVmDisksCommand.getParameters().getTaskGroupSuccess()); params.setDisks(getMovedDisks()); params.setDiskIdsToIgnoreInChecks(getMovedDiskIds()); params.setNeedsLocking(false); params.setEndProcedure(EndProcedure.COMMAND_MANAGED); return params; }
public static org.ovirt.engine.ui.common.widget.uicommon.popup.vm.PopupWidgetConfig simpleField() { return new org.ovirt.engine.ui.common.widget.uicommon.popup.vm.PopupWidgetConfig(false, false, false, false); }
private java.util.Locale getLocaleFromCookies(final javax.servlet.http.Cookie[] cookies) { java.util.Locale locale = null; if (cookies != null) { for (javax.servlet.http.Cookie cookie : cookies) { if (org.ovirt.engine.core.LocaleFilter.LOCALE.equalsIgnoreCase(cookie.getName())) { locale = org.ovirt.engine.core.utils.LocaleUtils.getLocaleFromString(cookie.getValue()); break; } } } return locale; }
private org.ovirt.engine.core.common.action.VdcReturnValueBase executeCommand(final org.ovirt.engine.core.bll.CommandBase<?> command) { command.persistCommand(command.getParameters().getParentCommand(), true); org.ovirt.engine.core.bll.tasks.interfaces.CommandCallBack callBack = command.getCallBack(); if (callBack != null) { cmdCallBackMap.put(command.getCommandId(), callBack); } org.ovirt.engine.core.common.action.VdcReturnValueBase result = org.ovirt.engine.core.bll.utils.BackendUtils.getBackendCommandObjectsHandler(org.ovirt.engine.core.bll.tasks.CommandExecutor.log).runAction(command, null); updateCommand(command, result); if (callBack != null) { callBack.executed(result); } return result; }
@java.lang.Override public boolean getIsAvailable() { return (getDetailModel().getPath()) != null; }
@org.junit.Test public void vlanIdTakenBySameNetwork() throws java.lang.Exception { vlanIdAvailableTest(ValidationResult.VALID, getSingletonVlanNetworkList(DEFAULT_VLAN_ID, DEFAULT_GUID)); }
public static java.util.Optional<java.lang.Integer> getSizeOfMemoryDeviceMb(org.ovirt.engine.core.common.businessentities.VmDevice memoryDevice) { if (!(org.ovirt.engine.core.common.utils.VmDeviceCommonUtils.isMemory(memoryDevice))) { throw new java.lang.RuntimeException(((("Memory device expected but device " + memoryDevice) + " passed of type ") + (memoryDevice.getType()))); } return org.ovirt.engine.core.common.utils.VmDeviceCommonUtils.getSpecParamsIntValue(memoryDevice, org.ovirt.engine.core.common.utils.VmDeviceCommonUtils.SPEC_PARAM_SIZE); }
@java.lang.Override protected boolean canDoAction() { if (!(org.ovirt.engine.core.common.FeatureSupported.isIscsiMultipathingSupported(org.ovirt.engine.core.bll.storage.AddIscsiBondCommand.getStoragePool().getCompatibilityVersion()))) { return failCanDoAction(EngineMessage.ISCSI_BOND_NOT_SUPPORTED); } org.ovirt.engine.core.bll.validator.IscsiBondValidator validator = new org.ovirt.engine.core.bll.validator.IscsiBondValidator(); return ((validate(validator.iscsiBondWithTheSameNameExistInDataCenter(getIscsiBond()))) && (validate(validator.validateAddedLogicalNetworks(getIscsiBond())))) && (validate(validator.validateAddedStorageConnections(getIscsiBond()))); }
public java.util.List<java.lang.String> getNamesOfVms() { return namesOfVms; }
protected void logToAudit() { }
@org.ovirt.engine.api.restapi.types.Mapping(from = org.ovirt.engine.api.model.User.class, to = org.ovirt.engine.core.common.businessentities.DbUser.class) public static org.ovirt.engine.core.common.businessentities.DbUser map(org.ovirt.engine.api.model.User model, org.ovirt.engine.core.common.businessentities.DbUser template) { org.ovirt.engine.core.common.businessentities.DbUser entity = (template != null) ? template : new org.ovirt.engine.core.common.businessentities.DbUser(); if (model.isSetName()) { entity.setLoginName(model.getName()); } if (model.isSetId()) { java.lang.String id = model.getId(); entity.setId(org.ovirt.engine.api.restapi.utils.GuidUtils.asGuid(id)); } if (model.isSetDomain()) { org.ovirt.engine.api.model.Domain domain = model.getDomain(); if (domain.isSetName()) { entity.setDomain(domain.getName()); } } if (model.isSetDomainEntryId()) { entity.setExternalId(org.ovirt.engine.api.restapi.utils.DirectoryEntryIdUtils.decode(model.getDomainEntryId())); } return entity; }
protected java.lang.String getChangePasswordMsg(boolean edit) throws java.io.UnsupportedEncodingException, org.ovirt.engine.extensions.aaa.builtin.tools.ManageDomainsResult { if (!(args.contains(org.ovirt.engine.extensions.aaa.builtin.tools.ManageDomainsArguments.ARG_CHANGE_PASSWORD_MSG))) { return null; } java.lang.String emptyValueDescription = (edit) ? " (Not providing a value will cause the existing value to be reset)" : ""; java.lang.String changePasswordMsgStr = java.lang.System.console().readLine((("Please enter message or URL to appear when user tries to login with an expired password" + emptyValueDescription) + ":")); if ((changePasswordMsgStr != null) && (((changePasswordMsgStr.indexOf("http")) == 0) || ((changePasswordMsgStr.indexOf("https")) == 0))) { try { java.net.URL url = new java.net.URL(changePasswordMsgStr); org.ovirt.engine.extensions.aaa.builtin.tools.ManageDomains.log.debug((("Validated that " + url) + " is in correct format")); } catch (java.net.MalformedURLException ex) { throw new org.ovirt.engine.extensions.aaa.builtin.tools.ManageDomainsResult(ManageDomainsResultEnum.INVALID_ARGUMENT_VALUE, "The provided value begins with a URL prefix of either http or https. However this is not a valid URL"); } } return org.apache.commons.lang.StringUtils.isNotEmpty(changePasswordMsgStr) ? java.net.URLEncoder.encode(changePasswordMsgStr, "UTF-8") : ""; }
@org.junit.Before public void before() { org.ovirt.engine.core.dao.AsyncTaskDAO asyncTaskDao = mock(org.ovirt.engine.core.dao.AsyncTaskDAO.class); when(asyncTaskDao.getAll()).thenReturn(java.util.Collections.EMPTY_LIST); when(org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getAsyncTaskDao()).thenReturn(asyncTaskDao); org.ovirt.engine.core.dao.CommandEntityDao cmdEntityDao = mock(org.ovirt.engine.core.dao.CommandEntityDao.class); when(org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getCommandEntityDao()).thenReturn(cmdEntityDao); when(cmdEntityDao.getAll()).thenReturn(java.util.Collections.EMPTY_LIST); }
protected void setEffectiveCompatibilityVersion(org.ovirt.engine.core.compat.Version effectiveCompatibilityVersion) { this.effectiveCompatibilityVersion = effectiveCompatibilityVersion; }
private void addSpmStates(org.ovirt.engine.api.model.VersionCaps version, org.ovirt.engine.api.model.SpmState[] values) { if (org.ovirt.engine.api.restapi.utils.VersionUtils.greaterOrEqual(version, org.ovirt.engine.api.restapi.resource.BackendCapabilitiesResource.VERSION_3_5)) { org.ovirt.engine.api.model.SpmStates states = new org.ovirt.engine.api.model.SpmStates(); for (org.ovirt.engine.api.model.SpmState state : values) { states.getSpmStates().add(state.value()); } version.setSpmStates(states); } }
protected void mockVmRunHandler() { org.ovirt.engine.core.common.businessentities.storage_pool sp = new org.ovirt.engine.core.common.businessentities.storage_pool(); sp.setstatus(StoragePoolStatus.Up); when(spDao.get(any(org.ovirt.engine.core.compat.Guid.class))).thenReturn(sp); doReturn(spDao).when(vmRunHandler).getStoragePoolDAO(); doReturn(vmRunHandler).when(command).getVmRunHandler(); doReturn(true).when(vmRunHandler).performStorageDomainChecks(any(org.ovirt.engine.core.common.businessentities.VM.class), anyListOf(java.lang.String.class), any(org.ovirt.engine.core.common.action.RunVmParams.class), anyListOf(org.ovirt.engine.core.common.businessentities.DiskImage.class)); doReturn(true).when(vmRunHandler).performImageChecksForRunningVm(any(org.ovirt.engine.core.common.businessentities.VM.class), anyListOf(java.lang.String.class), any(org.ovirt.engine.core.common.action.RunVmParams.class), anyListOf(org.ovirt.engine.core.common.businessentities.DiskImage.class)); }
@java.lang.Override public boolean equals(java.lang.Object obj) { if ((this) == obj) { return true; } if (!(obj instanceof org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity)) { return false; } org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity other = ((org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity) (obj)); return (((((((((((((((((java.util.Objects.equals(name, other.getName())) && (java.util.Objects.equals(clusterId, other.clusterId))) && ((volumeType) == (other.volumeType))) && ((status) == (other.status))) && (java.util.Objects.equals(replicaCount, other.replicaCount))) && (java.util.Objects.equals(stripeCount, other.stripeCount))) && (java.util.Objects.equals(disperseCount, other.disperseCount))) && (java.util.Objects.equals(redundancyCount, other.redundancyCount))) && (java.util.Objects.equals(isArbiter, other.isArbiter))) && (org.ovirt.engine.core.common.utils.ObjectUtils.haveSameElements(getOptions(), other.getOptions()))) && (org.ovirt.engine.core.common.utils.ObjectUtils.haveSameElements(accessProtocols, other.accessProtocols))) && (org.ovirt.engine.core.common.utils.ObjectUtils.haveSameElements(transportTypes, other.transportTypes))) && (org.ovirt.engine.core.common.utils.ObjectUtils.haveSameElements(bricks, other.bricks))) && (java.util.Objects.equals(asyncTask, other.asyncTask))) && (java.util.Objects.equals(advancedDetails, other.advancedDetails))) && (java.util.Objects.equals(snapshotsCount, other.snapshotsCount))) && (java.util.Objects.equals(snapMaxLimit, other.snapMaxLimit))) && (java.util.Objects.equals(snapshotScheduled, other.snapshotScheduled)); }
static org.ovirt.engine.core.bll.ValidationResult validateDefaultFlagIsNotChanged(org.ovirt.engine.core.common.businessentities.MacPool macPoolFromDb, org.ovirt.engine.core.common.businessentities.MacPool newMacPool) { if ((macPoolFromDb == null) || (newMacPool == null)) { throw new java.lang.IllegalArgumentException(); } final boolean defaultChanged = (macPoolFromDb.isDefaultPool()) != (newMacPool.isDefaultPool()); return org.ovirt.engine.core.bll.ValidationResult.failWith(EngineMessage.ACTION_TYPE_FAILED_CHANGING_DEFAULT_MAC_POOL_IS_NOT_SUPPORTED).when(defaultChanged); }
private void verifyModelWithDetails(org.ovirt.engine.api.model.GlusterBrick model, int index) { verifyModel(model, index); assertEquals(GlusterTestHelper.BRICK_PORT, model.getPort()); assertEquals(GlusterTestHelper.BRICK_MNT_OPT, model.getMntOptions()); }
private boolean isLibrbdAvailable() { if (!(org.ovirt.engine.core.bll.storage.CINDERStorageHelper.isLibrbdAvailable(getVds()))) { log.error("Couldn't found librbd1 package on vds {} (needed for Cinder storage domains).", getVds().getName()); setNonOperational(NonOperationalReason.LIBRBD_PACKAGE_NOT_AVAILABLE); return false; } return true; }
private void newMacPool() { org.ovirt.engine.ui.uicommonweb.models.macpool.SharedMacPoolModel model = new org.ovirt.engine.ui.uicommonweb.models.macpool.SharedMacPoolModel(this, org.ovirt.engine.core.common.action.VdcActionType.AddMacPool); model.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().newSharedMacPoolTitle()); model.setHashName("new_shared_mac_pool"); model.setHelpTag(HelpTag.new_shared_mac_pool); model.setEntity(new org.ovirt.engine.core.common.businessentities.MacPool()); setWindow(model); }
@org.junit.Test public void testGetLocaleStringFromPath_IllegalPath() { assertNull("Path without '/' should return null", testServlet.getLocaleStringFromPath("index.html")); }
@java.lang.Override public void onSuccess(java.lang.Object target, java.lang.Object returnValue) { java.lang.Boolean isUnique = ((java.lang.Boolean) (returnValue)); if (((model.getIsNew()) && (!isUnique)) || (((!(model.getIsNew())) && (!isUnique)) && ((name.compareToIgnoreCase(getCurrentPool().getName())) != 0))) { model.getName().getInvalidityReasons().add(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().nameMustBeUniqueInvalidReason()); model.getName().setIsValid(false); model.setValidTab(TabName.GENERAL_TAB, false); return; } java.lang.String selectedCpu = model.getCustomCpu().getSelectedItem(); if (((selectedCpu != null) && (!(selectedCpu.isEmpty()))) && (!(model.getCustomCpu().getItems().contains(selectedCpu)))) { org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel confirmModel = new org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel(); confirmModel.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().vmUnsupportedCpuTitle()); confirmModel.setMessage(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().vmUnsupportedCpuMessage()); confirmModel.setHelpTag(HelpTag.edit_unsupported_cpu); confirmModel.setHashName("edit_unsupported_cpu"); confirmModel.getCommands().add(new org.ovirt.engine.ui.uicommonweb.UICommand("OnSave_Phase2", this).setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().ok()).setIsDefault(true)); confirmModel.getCommands().add(org.ovirt.engine.ui.uicommonweb.UICommand.createCancelUiCommand("CancelConfirmation", this)); setConfirmWindow(confirmModel); } else { savePoolPostValidation(); } }
@java.lang.Override public javax.ws.rs.core.Response approve(org.ovirt.engine.api.model.Action action) { if ((action.isSetCluster()) && ((action.getCluster().isSetId()) || (action.getCluster().isSetName()))) { update(setCluster(get(), action.getCluster())); } validateEnums(org.ovirt.engine.api.model.Action.class, action); org.ovirt.engine.core.common.action.ApproveVdsParameters params = new org.ovirt.engine.core.common.action.ApproveVdsParameters(guid); params = ((org.ovirt.engine.core.common.action.ApproveVdsParameters) (getMapper(org.ovirt.engine.api.model.Action.class, org.ovirt.engine.core.common.action.VdsOperationActionParameters.class).map(action, ((org.ovirt.engine.core.common.action.VdsOperationActionParameters) (params))))); params.setAuthMethod(VdsOperationActionParameters.AuthenticationMethod.PublicKey); if (action.isSetRootPassword()) { params.setAuthMethod(VdsOperationActionParameters.AuthenticationMethod.Password); params.setRootPassword(action.getRootPassword()); } else if ((action.isSetSsh()) && (action.getSsh().isSetAuthenticationMethod())) { if (action.getSsh().getAuthenticationMethod().equals(AuthenticationMethod.PASSWORD.value())) { params.setAuthMethod(VdsOperationActionParameters.AuthenticationMethod.Password); if ((action.getSsh().isSetUser()) && (action.getSsh().getUser().isSetPassword())) { params.setPassword(action.getSsh().getUser().getPassword()); } } } return doAction(VdcActionType.ApproveVds, params, action); }
@java.lang.Override public void onSuccess(org.ovirt.engine.core.common.queries.VdcQueryReturnValue returnValue) { List<org.ovirt.engine.core.common.businessentities.VmDevice> rngDevices = returnValue.getReturnValue(); getModel().getIsRngEnabled().setEntity((!(rngDevices.isEmpty()))); if (!(rngDevices.isEmpty())) { org.ovirt.engine.core.common.businessentities.VmRngDevice rngDevice = new org.ovirt.engine.core.common.businessentities.VmRngDevice(rngDevices.get(0)); getModel().setRngDevice(rngDevice); } }
private void registerAllOvfDisks(java.util.List<org.ovirt.engine.core.common.businessentities.DiskImage> ovfStoreDiskImages) { for (org.ovirt.engine.core.common.businessentities.DiskImage ovfStoreDiskImage : ovfStoreDiskImages) { ovfStoreDiskImage.setDiskAlias(OvfInfoFileConstants.OvfStoreDescriptionLabel); ovfStoreDiskImage.setDiskDescription(OvfInfoFileConstants.OvfStoreDescriptionLabel); ovfStoreDiskImage.setShareable(true); org.ovirt.engine.core.common.action.RegisterDiskParameters registerDiskParams = new org.ovirt.engine.core.common.action.RegisterDiskParameters(ovfStoreDiskImage, org.ovirt.engine.core.bll.storage.AttachStorageDomainToPoolCommand.getParameters().getStorageDomainId()); boolean registerDiskResult = runInternalAction(VdcActionType.RegisterDisk, registerDiskParams, org.ovirt.engine.core.bll.storage.AttachStorageDomainToPoolCommand.cloneContext()).getSucceeded(); log.info("Register new floating OVF_STORE disk with disk id '{}' for storage domain '{}' has {}", ovfStoreDiskImage.getId(), org.ovirt.engine.core.bll.storage.AttachStorageDomainToPoolCommand.getParameters().getStorageDomainId(), (registerDiskResult ? "succeeded" : "failed")); if (registerDiskResult) { addOvfStoreDiskToDomain(ovfStoreDiskImage); } } }
@org.junit.Test public void testrunMultipleActions_1action() { java.util.List<org.ovirt.engine.core.common.action.VdcActionType> actionTypes = new java.util.ArrayList<>(); actionTypes.add(VdcActionType.AddDisk); java.util.List<org.ovirt.engine.core.common.action.VdcActionParametersBase> testParameters = new java.util.ArrayList<>(); testParameters.add(new org.ovirt.engine.core.common.action.VdcActionParametersBase()); java.util.List<org.ovirt.engine.ui.uicompat.IFrontendActionAsyncCallback> callbacks = new java.util.ArrayList<>(); callbacks.add(mockActionCallback); frontend.runMultipleActions(actionTypes, testParameters, callbacks, mockActionFailureCallback, testState); verify(mockService).runAction(eq(VdcActionType.AddDisk), eq(testParameters.get(0)), callbackAction.capture()); org.ovirt.engine.core.common.action.VdcReturnValueBase returnValue = new org.ovirt.engine.core.common.action.VdcReturnValueBase(); returnValue.setValid(true); returnValue.setSucceeded(true); callbackAction.getValue().onSuccess(returnValue); verify(mockActionCallback).executed(callbackParam.capture()); assertEquals(callbackParam.getValue().getReturnValue(), returnValue); assertEquals("List size should be 0", 0, actionTypes.size()); assertEquals("List size should be 0", 0, testParameters.size()); assertEquals("List size should be 0", 0, callbacks.size()); verifyAsyncActionStartedAndSucceeded(); }
@java.lang.SuppressWarnings("unchecked") public void onDiscover() { java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase> mulipleActionParameters = new java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase>(); org.ovirt.engine.core.compat.Guid dcId = ((org.ovirt.engine.core.common.businessentities.StoragePool) (getDataCenters().getSelectedItem())).getId(); for (org.ovirt.engine.ui.uicommonweb.models.providers.ExternalNetwork externalNetwork : ((java.lang.Iterable<org.ovirt.engine.ui.uicommonweb.models.providers.ExternalNetwork>) (getNetworkList().getItems()))) { if (externalNetwork.isAttached()) { externalNetwork.getNetwork().setDataCenterId(dcId); org.ovirt.engine.core.common.action.AddNetworkStoragePoolParameters params = new org.ovirt.engine.core.common.action.AddNetworkStoragePoolParameters(dcId, externalNetwork.getNetwork()); params.setPublicUse(externalNetwork.isPublicUse()); mulipleActionParameters.add(params); } } org.ovirt.engine.ui.frontend.Frontend.RunMultipleAction(VdcActionType.AddNetwork, mulipleActionParameters); cancel(); }
public static boolean verifyAddVm(java.util.List<java.lang.String> reasons, int nicsCount, int vmPriority, org.ovirt.engine.core.bll.network.macpoolmanager.MacPoolManagerStrategy macPool) { boolean returnValue = true; if ((macPool.getAvailableMacsCount()) < nicsCount) { if (reasons != null) { reasons.add(VdcBllMessages.MAC_POOL_NOT_ENOUGH_MAC_ADDRESSES.toString()); } returnValue = false; } else if (!(org.ovirt.engine.core.bll.VmTemplateCommand.isVmPriorityValueLegal(vmPriority, reasons))) { returnValue = false; } return returnValue; }
public void getHostListByStatus(org.ovirt.engine.ui.frontend.AsyncQuery<java.util.List<org.ovirt.engine.core.common.businessentities.VDS>> aQuery, org.ovirt.engine.core.common.businessentities.VDSStatus status, boolean doRefresh) { aQuery.converterCallback = new org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.ListConverter(); org.ovirt.engine.core.common.queries.SearchParameters searchParameters = new org.ovirt.engine.core.common.queries.SearchParameters(("Host: " + (status == null ? "" : "status=" + (status.name()))), org.ovirt.engine.core.common.interfaces.SearchType.VDS); searchParameters.setMaxCount(9999); org.ovirt.engine.ui.frontend.Frontend.getInstance().runQuery(VdcQueryType.Search, (doRefresh ? searchParameters : searchParameters.withoutRefresh()), aQuery); }
public org.ovirt.engine.ui.uicommonweb.models.providers.NeutronAgentModel getNeutronAgentModel() { return neutronAgentModel; }
@org.junit.Test public void testBreakingExistingBondWithNetworkAttached() throws java.lang.Exception { org.ovirt.engine.core.common.businessentities.network.NetworkAttachment networkAttachment = org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkOperation.newNetworkAttachment(networkA, existingBond, null, dataFromHostSetupNetworksModel.networksToSync); existingNetworkAttachments.add(networkAttachment); when(logicalNetworkModelOfNetworkA.hasVlan()).thenReturn(false); when(logicalNetworkModelOfNetworkA.isAttached()).thenReturn(true); when(logicalNetworkModelOfNetworkA.getAttachedToNic()).thenReturn(networkInterfaceModelOfNicA); when(bondNetworkInterfaceModelA.getItems()).thenReturn(java.util.Collections.singletonList(logicalNetworkModelOfNetworkA)); when(bondNetworkInterfaceModelA.getIface()).thenReturn(existingBond); NetworkOperation.BREAK_BOND.getTarget().executeNetworkCommand(bondNetworkInterfaceModelA, null, dataFromHostSetupNetworksModel); assertThat(dataFromHostSetupNetworksModel.newOrModifiedNetworkAttachments.size(), is(0)); assertThat(dataFromHostSetupNetworksModel.removedNetworkAttachments.size(), is(1)); org.ovirt.engine.core.compat.Guid removedNetworkAttachmentId = dataFromHostSetupNetworksModel.removedNetworkAttachments.iterator().next().getId(); assertThat("id mismatch", removedNetworkAttachmentId, nullValue()); assertThat(dataFromHostSetupNetworksModel.newOrModifiedBonds.size(), is(0)); assertThat(dataFromHostSetupNetworksModel.removedBonds.size(), is(1)); org.ovirt.engine.core.compat.Guid removedBondId = dataFromHostSetupNetworksModel.removedBonds.iterator().next().getId(); assertThat("id mismatch", removedBondId, is(existingBond.getId())); }
public void initModelSortHandler(org.ovirt.engine.ui.uicommonweb.models.SortedListModel<T> sortedModel) { org.ovirt.engine.ui.common.widget.table.ColumnResizeCellTable.addColumnSortHandler(( event) -> applySort(event, sortedModel)); }
@java.lang.Override public java.lang.Object getQueryableId() { return getId(); }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface> getAllInterfacesByClusterId(org.ovirt.engine.core.compat.Guid clusterId) { return getCallsHandler().executeReadList("GetInterfacesByClusterId", org.ovirt.engine.core.dao.network.InterfaceDaoDbFacadeImpl.vdsNetworkInterfaceRowMapper, getCustomMapSqlParameterSource().addValue("cluster_id", clusterId)); }
void initTable(org.ovirt.engine.ui.webadmin.ApplicationConstants constants) { org.ovirt.engine.ui.common.widget.table.column.TextColumnWithTooltip<org.ovirt.engine.core.common.businessentities.event_subscriber> eventNameColumn = new org.ovirt.engine.ui.common.widget.table.column.EnumColumn<org.ovirt.engine.core.common.businessentities.event_subscriber, org.ovirt.engine.core.common.AuditLogType>() { @java.lang.Override protected org.ovirt.engine.core.common.AuditLogType getRawValue(org.ovirt.engine.core.common.businessentities.event_subscriber object) { return java.lang.Enum.valueOf(org.ovirt.engine.core.common.AuditLogType.class, object.getevent_up_name()); } }; eventNameColumn.makeSortable(new java.util.Comparator<org.ovirt.engine.core.common.businessentities.event_subscriber>() { private final org.ovirt.engine.core.common.businessentities.comparators.LexoNumericComparator lexoNumericComparator = new org.ovirt.engine.core.common.businessentities.comparators.LexoNumericComparator(); @java.lang.Override public int compare(org.ovirt.engine.core.common.businessentities.event_subscriber o1, org.ovirt.engine.core.common.businessentities.event_subscriber o2) { return lexoNumericComparator.compare(o1.getevent_up_name(), o2.getevent_up_name()); } }); getTable().addColumn(eventNameColumn, constants.eventNameEventNotifier()); getTable().addActionButton(new org.ovirt.engine.ui.webadmin.widget.action.WebAdminButtonDefinition<org.ovirt.engine.core.common.businessentities.event_subscriber>(constants.manageEventsEventNotifier()) { @java.lang.Override protected org.ovirt.engine.ui.uicommonweb.UICommand resolveCommand() { return getDetailModel().getManageEventsCommand(); } }); }
private XmlNode getNode(org.ovirt.engine.core.compat.backendcompat.XmlNodeList nodeList, java.lang.String attributeName, java.lang.String attributeValue) { for (XmlNode section : nodeList) { java.lang.String value = section.attributes.get(attributeName).getValue(); if (value.equals(attributeValue)) { return section; } } return null; }
@java.lang.Override public java.util.List<org.ovirt.engine.api.model.Statistic> getStatistics(org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface iface) { org.ovirt.engine.core.common.businessentities.network.NetworkStatistics s = iface.getStatistics(); return asList(setDatum(clone(org.ovirt.engine.api.restapi.resource.NicStatisticalQuery.DATA_RX), org.ovirt.engine.api.restapi.util.RxTxCalculator.percent2bytes(iface.getSpeed(), s.getReceiveRate())), setDatum(clone(org.ovirt.engine.api.restapi.resource.NicStatisticalQuery.DATA_TX), org.ovirt.engine.api.restapi.util.RxTxCalculator.percent2bytes(iface.getSpeed(), s.getTransmitRate())), setDatum(clone(org.ovirt.engine.api.restapi.resource.NicStatisticalQuery.ERRS_RX), s.getReceiveDropRate()), setDatum(clone(org.ovirt.engine.api.restapi.resource.NicStatisticalQuery.ERRS_TX), s.getTransmitDropRate())); }
public org.ovirt.engine.ui.uicommonweb.models.EntityModel getPortMirroring() { return privatePortMirroring; }
private void propagateInternalCommandFailure(org.ovirt.engine.core.common.action.VdcReturnValueBase internalReturnValue) { org.ovirt.engine.core.bll.storage.disk.UpdateVmDiskCommand.getReturnValue().getExecuteFailedMessages().clear(); org.ovirt.engine.core.bll.storage.disk.UpdateVmDiskCommand.getReturnValue().getExecuteFailedMessages().addAll(internalReturnValue.getExecuteFailedMessages()); org.ovirt.engine.core.bll.storage.disk.UpdateVmDiskCommand.getReturnValue().setFault(internalReturnValue.getFault()); org.ovirt.engine.core.bll.storage.disk.UpdateVmDiskCommand.getReturnValue().getValidationMessages().clear(); org.ovirt.engine.core.bll.storage.disk.UpdateVmDiskCommand.getReturnValue().getValidationMessages().addAll(internalReturnValue.getValidationMessages()); org.ovirt.engine.core.bll.storage.disk.UpdateVmDiskCommand.getReturnValue().setValid(internalReturnValue.isValid()); }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.StorageDomainStatic> getAllForStoragePool(org.ovirt.engine.core.compat.Guid id) { return getCallsHandler().executeReadList("Getstorage_domain_staticBystorage_pool_id", org.ovirt.engine.core.dao.StorageDomainStaticDaoImpl.StorageDomainStaticRowMapper.instance, getStoragePoolIdParameterSource(id)); }
public int removeByVdsmTaskId(final org.ovirt.engine.core.compat.Guid vdsmTaskId) { return org.ovirt.engine.core.utils.transaction.TransactionSupport.executeInScope(TransactionScopeOption.Required, new org.ovirt.engine.core.utils.transaction.TransactionMethod<java.lang.Integer>() { @java.lang.Override public java.lang.Integer runInTransaction() { org.ovirt.engine.core.common.businessentities.AsyncTask asyncTask = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getAsyncTaskDao().getByVdsmTaskId(vdsmTaskId); int retVal = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getAsyncTaskDao().removeByVdsmTaskId(vdsmTaskId); if (shouldRemoveCommand(asyncTask)) { coco.removeCommand(asyncTask.getCommandId()); if (!(coco.hasCommandEntitiesWithRootCommandId(asyncTask.getRootCommandId()))) { coco.removeCommand(asyncTask.getRootCommandId()); } } return retVal; } }); }
public void setStatus(org.ovirt.engine.core.compat.Guid clusterId, final java.util.Collection<org.ovirt.engine.core.common.businessentities.network.Network> networks) { final org.ovirt.engine.core.bll.network.cluster.NetworkClusterHelper.RequiredNetworkClusterStatusUpdater requiredNetworkClusterStatusUpdater = new org.ovirt.engine.core.bll.network.cluster.NetworkClusterHelper.RequiredNetworkClusterStatusUpdater(clusterId); for (org.ovirt.engine.core.common.businessentities.network.Network network : networks) { org.ovirt.engine.core.common.businessentities.network.NetworkCluster networkCluster = networkClusterDao.get(new org.ovirt.engine.core.common.businessentities.network.NetworkClusterId(clusterId, network.getId())); boolean doUpdateNetworkClusterStatus = networkCluster != null; if (doUpdateNetworkClusterStatus) { if (networkCluster.isRequired()) { requiredNetworkClusterStatusUpdater.update(networkCluster, network.getName()); } else { updateNetworkClusterStatus(networkCluster, NetworkStatus.OPERATIONAL); } } } }
@java.lang.Override public java.lang.String getEntityOldName() { return getOldNetwork().getName(); }
private void validate() { if (!(managementNetworkModel.isAttached())) { okCommand.getExecuteProhibitionReasons().add(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().mgmtNotAttachedToolTip()); okCommand.setIsExecutionAllowed(false); } else { okCommand.setIsExecutionAllowed(true); } }
@java.lang.Override public java.lang.String getValue(java.lang.Object object) { return java.lang.String.valueOf(((org.ovirt.engine.ui.uicommonweb.models.vms.ImportVmData) (object)).getVm().getClusterArch()); }
@java.lang.Override protected javax.mail.PasswordAuthentication getPasswordAuthentication() { return new javax.mail.PasswordAuthentication(userName, password); }
@javax.annotation.PostConstruct public void initialize() { org.ovirt.engine.core.bll.job.JobRepositoryCleanupManager.log.info("Start initializing {}", getClass().getSimpleName()); succeededJobTime = org.ovirt.engine.core.common.config.Config.<java.lang.Integer>getValue(ConfigValues.SucceededJobCleanupTimeInMinutes); failedJobTime = org.ovirt.engine.core.common.config.Config.<java.lang.Integer>getValue(ConfigValues.FailedJobCleanupTimeInMinutes); java.lang.Integer cleanupFrequency = org.ovirt.engine.core.common.config.Config.<java.lang.Integer>getValue(ConfigValues.JobCleanupRateInMinutes); executor.scheduleWithFixedDelay(this::cleanCompletedJob, cleanupFrequency, cleanupFrequency, java.util.concurrent.TimeUnit.MINUTES); org.ovirt.engine.core.bll.job.JobRepositoryCleanupManager.log.info("Finished initializing {}", getClass().getSimpleName()); }
@org.ovirt.engine.core.utils.timer.OnTimerMethodAnnotation("refreshGlusterServices") public void refreshGlusterServices() { if (getServiceNameMap().isEmpty()) { populateServiceMap(); } java.util.List<org.ovirt.engine.core.common.businessentities.VDSGroup> clusters = getClusterDao().getAll(); for (org.ovirt.engine.core.common.businessentities.VDSGroup cluster : clusters) { if (supportsGlusterServicesFeature(cluster)) { try { java.util.List<org.ovirt.engine.core.common.businessentities.VDS> serversList = getClusterUtils().getAllServers(cluster.getId()); if (serversList.isEmpty()) { java.util.Map<org.ovirt.engine.core.common.businessentities.gluster.ServiceType, org.ovirt.engine.core.common.businessentities.gluster.GlusterServiceStatus> statusMap = new java.util.HashMap<>(); for (org.ovirt.engine.core.common.businessentities.gluster.ServiceType type : getClusterServiceMap(cluster).keySet()) { statusMap.put(type, GlusterServiceStatus.UNKNOWN); } addOrUpdateClusterServices(cluster, statusMap); } else { java.util.List<java.util.concurrent.Callable<java.util.Map<java.lang.String, org.ovirt.engine.core.common.businessentities.gluster.GlusterServiceStatus>>> taskList = createTaskList(serversList); if ((taskList != null) && ((taskList.size()) > 0)) { refreshClusterServices(cluster, org.ovirt.engine.core.utils.threadpool.ThreadPoolUtil.invokeAll(taskList)); } } } catch (java.lang.Exception e) { org.ovirt.engine.core.bll.gluster.GlusterServiceSyncJob.log.error("Error while refreshing service statuses of cluster '{}': {}", cluster.getName(), e.getMessage()); org.ovirt.engine.core.bll.gluster.GlusterServiceSyncJob.log.debug("Exception", e); } } } }
@java.lang.Override public int hashCode() { return java.util.Objects.hash(vmDynamic, vmGuestAgentInterfaces, vmStatistics, lunsMap, interfaceStatistics, diskStatistics); }
@java.lang.Override protected java.lang.String getText(org.ovirt.engine.core.common.businessentities.gluster.FopStats entity) { return ((entity.getMinLatencyFormatted().getFirst()) + " ") + (entity.getMinLatencyFormatted().getSecond()); }
private void onSaveConfirmCV(org.ovirt.engine.ui.uicommonweb.models.clusters.ClusterModel model) { if (!(model.getVersion().getSelectedItem().equals(org.ovirt.engine.ui.uicommonweb.models.clusters.ClusterListModel.getSelectedItem().getCompatibilityVersion()))) { final org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel confirmModel = new org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel(); setConfirmWindow(confirmModel); confirmModel.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().changeClusterCompatibilityVersionTitle()); confirmModel.setHelpTag(HelpTag.change_cluster_compatibility_version); confirmModel.setHashName("change_cluster_compatibility_version"); org.ovirt.engine.ui.uicommonweb.UICommand tempVar = org.ovirt.engine.ui.uicommonweb.UICommand.createDefaultOkUiCommand("OnSaveConfirmCpuThreads", this); org.ovirt.engine.ui.uicommonweb.models.clusters.ClusterListModel.getConfirmWindow().getCommands().add(tempVar); org.ovirt.engine.ui.uicommonweb.UICommand tempVar2 = org.ovirt.engine.ui.uicommonweb.UICommand.createCancelUiCommand("CancelConfirmation", this); org.ovirt.engine.ui.uicommonweb.models.clusters.ClusterListModel.getConfirmWindow().getCommands().add(tempVar2); checkForNonResponsiveHosts(confirmModel); } else { onSaveConfirmCpuThreads(); } }
public static void GetGlusterHosts(org.ovirt.engine.ui.frontend.AsyncQuery aQuery, java.lang.String hostAddress, java.lang.String rootPassword, java.lang.String fingerprint) { aQuery.converterCallback = new org.ovirt.engine.ui.frontend.IAsyncConverter() { @java.lang.Override public java.lang.Object Convert(java.lang.Object source, org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery) { return source; } }; org.ovirt.engine.core.common.queries.gluster.GlusterServersQueryParameters parameters = new org.ovirt.engine.core.common.queries.gluster.GlusterServersQueryParameters(hostAddress, rootPassword); parameters.setFingerprint(fingerprint); org.ovirt.engine.ui.frontend.Frontend.RunQuery(VdcQueryType.GetGlusterServers, parameters, aQuery); }
@org.junit.Test public void testAlreadyExistStorageDomain() { when(command.getStorageDomainStaticDao().get(any(org.ovirt.engine.core.compat.Guid.class))).thenReturn(org.ovirt.engine.core.bll.storage.domain.AddExistingBlockStorageDomainCommandTest.getStorageDomain()); assertFalse("Storage Domain already exists", command.canAddDomain()); assertTrue("Import block Storage Domain should have failed due to already existing Storage Domain", command.getReturnValue().getCanDoActionMessages().contains(EngineMessage.ACTION_TYPE_FAILED_STORAGE_DOMAIN_ALREADY_EXIST.toString())); }
public org.ovirt.engine.core.bll.ValidationResult networkNotChanged() { if (org.apache.commons.lang.ObjectUtils.equals(vnicProfile.getNetworkId(), getOldVnicProfile().getNetworkId())) { return org.ovirt.engine.core.bll.ValidationResult.VALID; } return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_CANNOT_CHANGE_VNIC_PROFILE_NETWORK); }
private org.ovirt.engine.core.common.scheduling.PolicyUnit createFromDiscoveryUnit(org.ovirt.engine.core.bll.scheduling.external.ExternalSchedulerDiscoveryUnit discoveryUnit, org.ovirt.engine.core.common.scheduling.PolicyUnitType type) { org.ovirt.engine.core.common.scheduling.PolicyUnit policy = new org.ovirt.engine.core.common.scheduling.PolicyUnit(); policy.setInternal(false); policy.setName(discoveryUnit.getName()); policy.setPolicyUnitType(type); policy.setDescription(discoveryUnit.getDescription()); if (!(org.apache.commons.lang.StringUtils.isEmpty(discoveryUnit.getRegex()))) { policy.setParameterRegExMap(org.ovirt.engine.core.utils.customprop.SimpleCustomPropertiesUtil.getInstance().convertProperties(discoveryUnit.getRegex())); } else { policy.setParameterRegExMap(new java.util.LinkedHashMap<java.lang.String, java.lang.String>()); } return policy; }
private void createSyncNetworkParameters(org.ovirt.engine.core.common.businessentities.network.Network network, java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase> parameters, java.util.Collection<org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface> nics) { java.util.Set<org.ovirt.engine.core.compat.Guid> hostIdsToSync = new java.util.HashSet<>(); for (org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface nic : nics) { org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface.NetworkImplementationDetails networkImplementationDetails = networkImplementationDetailsUtils.calculateNetworkImplementationDetails(nic, network); boolean networkShouldBeSynced = (networkImplementationDetails != null) && (!(networkImplementationDetails.isInSync())); if (networkShouldBeSynced) { hostIdsToSync.add(nic.getVdsId()); } } for (org.ovirt.engine.core.compat.Guid hostId : hostIdsToSync) { org.ovirt.engine.core.common.action.PersistentHostSetupNetworksParameters setupNetworkParams = createHostSetupNetworksParameters(hostId); setupNetworkParams.setNetworkNames(network.getName()); org.ovirt.engine.core.common.businessentities.network.NetworkAttachment attachment = getNetworkIdToAttachmentMap(hostId).get(network.getId()); attachment.setOverrideConfiguration(true); setupNetworkParams.getNetworkAttachments().add(attachment); parameters.add(setupNetworkParams); } }
public org.ovirt.engine.core.bll.ValidationResult interfaceInHost(org.ovirt.engine.core.compat.Guid hostId) { return org.ovirt.engine.core.bll.ValidationResult.failWith(EngineMessage.NIC_NOT_EXISTS_ON_HOST).when((!(iface.getVdsId().equals(hostId)))); }
@org.junit.Test public void canDoActionFailedVMHasNotDisk() throws java.lang.Exception { initializeCommand(createParameters()); createNullDisk(); org.ovirt.engine.core.bll.CanDoActionTestUtils.runAndAssertCanDoActionFailure(command, EngineMessage.ACTION_TYPE_FAILED_DISK_NOT_EXIST); }
public void setIncludeServerHooks(boolean includeServerHooks) { this.includeServerHooks = includeServerHooks; }
public static void isAnyHostUpInCluster(org.ovirt.engine.ui.frontend.AsyncQuery aQuery, java.lang.String clusterName) { aQuery.converterCallback = new org.ovirt.engine.ui.frontend.IAsyncConverter() { @java.lang.Override public java.lang.Object Convert(java.lang.Object source, org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery) { if ((source != null) && ((((java.util.List) (source)).size()) > 0)) { return true; } return false; } }; org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.GetUpHostListByCluster(aQuery, clusterName, 1); }
@org.ovirt.engine.ui.frontend.DefaultStringValue("Cannot ${action} ${type}. ${interface} disks can't be read-only.") java.lang.String ACTION_TYPE_FAILED_INTERFACE_DOES_NOT_SUPPORT_READ_ONLY_ATTR();
public static org.ovirt.engine.ui.uicommonweb.models.vms.DiskModel diskToModel(org.ovirt.engine.core.common.businessentities.storage.Disk disk) { org.ovirt.engine.ui.uicommonweb.models.vms.DiskModel diskModel = new org.ovirt.engine.ui.uicommonweb.models.vms.DiskModel(); diskModel.getAlias().setEntity(disk.getDiskAlias()); if ((disk.getDiskStorageType()) == (org.ovirt.engine.core.common.businessentities.storage.DiskStorageType.IMAGE)) { org.ovirt.engine.core.common.businessentities.storage.DiskImage diskImage = ((org.ovirt.engine.core.common.businessentities.storage.DiskImage) (disk)); org.ovirt.engine.ui.uicommonweb.models.EntityModel<java.lang.Integer> sizeEntity = new org.ovirt.engine.ui.uicommonweb.models.EntityModel<java.lang.Integer>(); sizeEntity.setEntity(((int) (diskImage.getSizeInGigabytes()))); diskModel.setSize(sizeEntity); org.ovirt.engine.ui.uicommonweb.models.ListModel volumeList = new org.ovirt.engine.ui.uicommonweb.models.ListModel(); volumeList.setItems(((diskImage.getVolumeType()) == (org.ovirt.engine.core.common.businessentities.storage.VolumeType.Preallocated) ? new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.storage.VolumeType>(java.util.Arrays.asList(new org.ovirt.engine.core.common.businessentities.storage.VolumeType[]{ org.ovirt.engine.core.common.businessentities.storage.VolumeType.Preallocated })) : org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().getVolumeTypeList())); volumeList.setSelectedItem(diskImage.getVolumeType()); diskModel.setVolumeType(volumeList); } diskModel.setDisk(disk); return diskModel; }
public org.ovirt.engine.core.bll.ValidationResult settingSpecificNetworksAllowed() { return org.ovirt.engine.core.bll.ValidationResult.failWith(VdcBllMessages.ACTION_TYPE_FAILED_CANNOT_SET_SPECIFIC_NETWORKS, getNicNameReplacement()).when(oldVfsConfig.isAllNetworksAllowed()); }
@org.junit.Test public void testGetLocalesKeysUnSupported() { org.ovirt.engine.core.utils.servlet.UnsupportedLocaleHelperTest.unvalidatedUnsupportedLocales.add("ko_KR"); java.util.List<java.lang.String> locales = org.ovirt.engine.core.utils.servlet.UnsupportedLocaleHelper.getLocalesKeys(ConfigValues.UnsupportedLocalesFilterOverrides); assertNotNull("Result should not be null", locales); assertEquals("There should be 1 locales", 1, locales.size()); assertEquals("Locale should be ko_KR", "ko_KR", locales.get(0)); }
public boolean isUseLatestVersion() { return vmStatic.isUseLatestVersion(); }
@java.lang.Override public void onSuccess(java.lang.Object target, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel model = ((org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel) (target)); model.setDataCentersAndClusters(model, dataCenters, ((java.util.List<org.ovirt.engine.core.common.businessentities.VDSGroup>) (returnValue)), null); initTemplate(); initCdImage(); getPoolModelBehaviorInitializedEvent().raise(this, EventArgs.Empty); }
@org.junit.Test public void testSave() { org.ovirt.engine.core.common.businessentities.storage.DiskImage newImage = new org.ovirt.engine.core.common.businessentities.storage.DiskImage(); newImage.setImageId(org.ovirt.engine.core.compat.Guid.newGuid()); newImage.setVolumeFormat(VolumeFormat.COW); newImage.setVolumeType(VolumeType.Sparse); newImage.setActive(true); newImage.setImageTemplateId(org.ovirt.engine.core.dao.DiskImageDynamicDaoTest.EXISTING_IMAGE_DISK_TEMPLATE); newImage.setId(org.ovirt.engine.core.compat.Guid.newGuid()); imageDao.save(newImage.getImage()); diskDao.save(newImage); org.ovirt.engine.core.common.businessentities.storage.DiskImageDynamic dynamic = createDiskImageDynamic(newImage.getImageId()); dao.save(createDiskImageDynamic(newImage.getImageId())); org.ovirt.engine.core.common.businessentities.storage.DiskImageDynamic result = dao.get(dynamic.getId()); assertNotNull(result); assertEquals(dynamic, result); }
@java.lang.Override public org.ovirt.engine.api.model.Templates list() { if (isFiltered()) return mapCollection(getBackendCollection(VdcQueryType.GetAllVmTemplates, new org.ovirt.engine.core.common.queries.VdcQueryParametersBase())); else return mapCollection(getBackendCollection(SearchType.VmTemplate)); }
@java.lang.Override public org.ovirt.engine.core.common.action.VdcActionParametersBase getParameters(org.ovirt.engine.api.model.Network incoming, org.ovirt.engine.core.common.businessentities.Network entity) { org.ovirt.engine.core.common.businessentities.Network updated = getMapper(modelType, org.ovirt.engine.api.model.Network.class).map(incoming, entity); return new org.ovirt.engine.core.common.action.AddNetworkStoragePoolParameters(entity.getstorage_pool_id().getValue(), updated); }
@java.lang.Override public void setUp() throws java.lang.Exception { super.setUp(); dao = dbFacade.getVmNetworkInterfaceDao(); vmDevicesDao = dbFacade.getVmDeviceDao(); StatsDao = dbFacade.getVmNetworkStatisticsDao(); existingVmInterface = dao.get(FixturesTool.VM_NETWORK_INTERFACE); existingTemplateInterface = dao.get(FixturesTool.TEMPLATE_NETWORK_INTERFACE); newVmInterface = new org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface(); newVmInterface.setStatistics(new org.ovirt.engine.core.common.businessentities.network.VmNetworkStatistics()); newVmInterface.setId(org.ovirt.engine.core.compat.Guid.NewGuid()); newVmInterface.setName("eth77"); newVmInterface.setNetworkName("enginet"); newVmInterface.setLinked(true); newVmInterface.setSpeed(1000); newVmInterface.setType(3); newVmInterface.setMacAddress("01:C0:81:21:71:17"); newVmDevice.setType(VmDeviceGeneralType.INTERFACE); newVmDevice.setDevice("bridge"); newVmDevice.setAddress("sample"); newVmDevice.setBootOrder(1); newVmDevice.setIsManaged(true); newVmDevice.setIsPlugged(true); newVmDevice.setIsReadOnly(false); java.util.Map<java.lang.String, java.lang.String> customProp = new java.util.LinkedHashMap<>(); customProp.put("prop1", "val1"); newVmDevice.setCustomProperties(customProp); }
@java.lang.Override protected void executeNetworkCommand(org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkItemModel<?> op1, org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkItemModel<?> op2, java.util.List<org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface> allNics, java.lang.Object... params) { assert (op1 instanceof org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkInterfaceModel) && (!(op1 instanceof org.ovirt.engine.ui.uicommonweb.models.hosts.network.BondNetworkInterfaceModel)); assert (op2 instanceof org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkInterfaceModel) && (!(op2 instanceof org.ovirt.engine.ui.uicommonweb.models.hosts.network.BondNetworkInterfaceModel)); assert (params.length) == 1 : "incorrect params length"; org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkInterfaceModel nic1 = ((org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkInterfaceModel) (op1)); org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkInterfaceModel nic2 = ((org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkInterfaceModel) (op2)); org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkOperation.clearNetworks(nic1, allNics); org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkOperation.clearNetworks(nic2, allNics); org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface bond = ((org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface) (params[0])); java.lang.String bondName = bond.getName(); allNics.add(bond); nic1.getIface().setBondName(bondName); nic2.getIface().setBondName(bondName); }
@java.lang.Override protected org.ovirt.engine.ui.common.widget.table.SimpleActionTable<org.ovirt.engine.ui.uicommonweb.models.userportal.UserPortalItemModel> createActionTable() { return new org.ovirt.engine.ui.userportal.widget.table.column.UserPortalSimpleActionTable<org.ovirt.engine.ui.uicommonweb.models.userportal.UserPortalItemModel>(modelProvider, getTableResources(), org.ovirt.engine.ui.userportal.gin.ClientGinjectorProvider.getEventBus(), org.ovirt.engine.ui.userportal.gin.ClientGinjectorProvider.getClientStorage(), new org.ovirt.engine.ui.userportal.widget.refresh.UserPortalRefreshManager(modelProvider, org.ovirt.engine.ui.userportal.gin.ClientGinjectorProvider.getEventBus(), org.ovirt.engine.ui.userportal.gin.ClientGinjectorProvider.getClientStorage())); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Data Center Re-Initialize") java.lang.String dataCenterReInitializeTitle();
public org.ovirt.engine.core.bll.ValidationResult hasSpaceForAllDisks(java.util.Collection<org.ovirt.engine.core.common.businessentities.storage.DiskImage> newDiskImages, java.util.Collection<org.ovirt.engine.core.common.businessentities.storage.DiskImage> clonedDiskImages) { if (storageDomain.getStorageType().isCinderDomain()) { return org.ovirt.engine.core.bll.ValidationResult.VALID; } java.lang.Long availableSize = storageDomain.getAvailableDiskSizeInBytes(); double totalSizeForNewDisks = getTotalSizeForNewDisks(newDiskImages); double totalSizeForClonedDisks = getTotalSizeForClonedDisks(clonedDiskImages); double totalSizeForDisks = totalSizeForNewDisks + totalSizeForClonedDisks; return validateRequiredSpace(availableSize, totalSizeForDisks); }
public java.util.List<org.ovirt.engine.core.common.errors.EngineMessage> getErrorMessages() { return errorMessages; }
public static void addDisksLink(org.ovirt.engine.api.v3.types.V3VM vm) { if (vm != null) { org.ovirt.engine.api.v3.helpers.V3LinkHelper.addLink(vm.getLinks(), "disks", "vms", vm.getId(), "disks"); } }
@java.lang.Override public org.ovirt.engine.core.bll.provider.ProviderValidator getProviderValidator() { return new org.ovirt.engine.core.bll.provider.ProviderValidator(provider) { @java.lang.Override public org.ovirt.engine.core.bll.ValidationResult validateAddProvider() { org.ovirt.engine.core.common.businessentities.VmwareVmProviderProperties properties = org.ovirt.engine.core.bll.provider.vms.VmwareVmProviderProxy.this.provider.getAdditionalProperties(); org.ovirt.engine.core.compat.Guid proxyHostId = properties.getProxyHostId(); if (proxyHostId != null) { org.ovirt.engine.core.common.businessentities.VDS proxyHost = getVdsDao().get(proxyHostId); if (proxyHost == null) { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.VDS_DOES_NOT_EXIST); } if (!(proxyHost.getStoragePoolId().equals(properties.getStoragePoolId()))) { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_VDS_NOT_IN_DEST_STORAGE_POOL); } } return org.ovirt.engine.core.bll.ValidationResult.VALID; } private org.ovirt.engine.core.dao.VdsDao getVdsDao() { return org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVdsDao(); } }; }
protected boolean formatStorage(org.ovirt.engine.core.common.businessentities.StorageDomain dom, org.ovirt.engine.core.common.businessentities.VDS vds) { try { return getVdsBroker().RunVdsCommand(VDSCommandType.FormatStorageDomain, new org.ovirt.engine.core.common.vdscommands.FormatStorageDomainVDSCommandParameters(vds.getId(), dom.getId())).getSucceeded(); } catch (org.ovirt.engine.core.common.errors.VdcBLLException e) { if ((e.getErrorCode()) != (org.ovirt.engine.core.common.errors.VdcBllErrors.StorageDomainDoesNotExist)) { throw e; } log.warnFormat("Storage Domain {0} which was about to be formatted does not exist in VDS {1}", dom.getName(), vds.getName()); return true; } }
private void localize(org.ovirt.engine.ui.webadmin.ApplicationConstants constants) { dataCenterEditor.setLabel(constants.dataCenterVolume()); clusterEditor.setLabel(constants.volumeClusterVolume()); nameEditor.setLabel(constants.clusterPopupNameLabel()); typeListEditor.setLabel(constants.typeVolume()); replicaCountEditor.setLabel(constants.replicaCountVolume()); stripeCountEditor.setLabel(constants.stripeCountVolume()); transportTypesLabel.setText(constants.transportTypeVolume()); tcpTransportTypeEditor.setLabel(constants.tcpVolume()); rdmaTransportTypeEditor.setLabel(constants.rdmaVolume()); bricksLabel.setText(constants.bricksVolume()); addBricksButton.setLabel(constants.addBricksVolume()); accessProtocolsLabel.setText(constants.accessProtocolsVolume()); gluster_accecssProtocolEditor.setLabel(constants.glusterVolume()); nfs_accecssProtocolEditor.setLabel(constants.nfsVolume()); cifs_accecssProtocolEditor.setLabel(constants.cifsVolume()); allowAccessEditor.setLabel(constants.allowAccessFromVolume()); allowAccessLabel.setText(constants.allowAccessFromLabelVolume()); optimizeForVirtStoreEditor.setLabel(constants.optimizeForVirtStoreVolume()); }
private static org.ovirt.engine.core.common.businessentities.storage.DiskVmElement buildDiskVmElementWithDiskInterfaceFromExternalProvider(java.util.Map<java.lang.String, java.lang.Object> map, org.ovirt.engine.core.common.businessentities.storage.DiskImage image, org.ovirt.engine.core.compat.Guid vmId) { org.ovirt.engine.core.common.businessentities.storage.DiskVmElement dve = new org.ovirt.engine.core.common.businessentities.storage.DiskVmElement(image.getId(), vmId); java.lang.String diskDevName = ((java.lang.String) (map.get(VdsProperties.DISK_TARGET_DEV_NAME))); diskDevName = ((diskDevName == null) || ((diskDevName.length()) < 3)) ? "" : diskDevName.substring(0, 2); switch (diskDevName) { case "sd" : dve.setDiskInterface(DiskInterface.VirtIO_SCSI); break; case "hd" : dve.setDiskInterface(DiskInterface.IDE); break; case "vd" : default : dve.setDiskInterface(DiskInterface.VirtIO); } return dve; }
private void processImages(final boolean useCopyImages) { org.ovirt.engine.core.utils.transaction.TransactionSupport.executeInNewTransaction(() -> { addVmImagesAndSnapshots(); addMemoryImages(); updateSnapshotsFromExport(); if (useCopyImages) { moveOrCopyAllImageGroups(); } getVmDeviceUtils().addImportedDevices(getVm().getStaticData(), getParameters().isImportAsNewEntity()); if (getParameters().isImportAsNewEntity()) { getParameters().setVm(getVm()); setVmId(getVm().getId()); } return null; }); }
org.ovirt.engine.ui.common.widget.action.ActionButton addActionButton(org.ovirt.engine.ui.common.widget.action.ActionButtonDefinition<T> buttonDef);
@org.junit.Test public void validateBondOptionsForNewAttachementWithOutOfSyncVmNetworOverridden() { validateValidBonds(false, true, false, true); }
@java.lang.Override protected void EndSuccessfully() { org.ovirt.engine.core.bll.ExportVmCommand.EndActionOnAllImageGroups(); org.ovirt.engine.core.common.businessentities.VM vm = org.ovirt.engine.core.bll.ExportVmCommand.getVm(); org.ovirt.engine.core.bll.VmHandler.UnLockVm(vm); endDiskRelatedActions(vm); if (org.ovirt.engine.core.bll.ExportVmCommand.getParameters().getCopyCollapse()) { endCopyCollapseOperations(vm); } else { updateSnapshotOvf(vm); } org.ovirt.engine.core.bll.ExportVmCommand.setSucceeded(true); }
@java.lang.Override public org.ovirt.engine.core.vdsbroker.gluster.GlusterVolumeGeoRepStatusForXmlRpc glusterVolumeGeoRepSessionList(java.lang.String volumeName) { try { java.util.Map<java.lang.String, java.lang.Object> response; response = vdsServer.glusterVolumeGeoRepSessionList(volumeName); return new org.ovirt.engine.core.vdsbroker.gluster.GlusterVolumeGeoRepStatusForXmlRpc(response); } catch (java.lang.reflect.UndeclaredThrowableException ute) { throw new org.ovirt.engine.core.vdsbroker.xmlrpc.XmlRpcRunTimeException(ute); } }
@java.lang.Override public java.util.List<org.ovirt.engine.core.compat.Guid> getAsyncTaskIdsByUser(org.ovirt.engine.core.compat.Guid userId) { org.springframework.jdbc.core.namedparam.MapSqlParameterSource parameterSource = getCustomMapSqlParameterSource().addValue("user_id", userId); return getCallsHandler().executeReadList("GetAsyncTasksIdsByUserId", org.ovirt.engine.core.dao.AsyncTaskDaoImpl.IdRowMapper.instance, parameterSource); }
public java.lang.String scheduleACronJob(java.lang.Object instance, java.lang.String methodName, java.lang.Class<?>[] inputTypes, java.lang.Object[] inputParams, java.lang.String cronExpression, java.util.Date startAt, java.util.Date endBy) { org.quartz.JobDetail job = createJobWithBasicMapValues(instance, methodName, inputTypes, inputParams); try { java.lang.String triggerName = generateUniqueNameForInstance(instance, org.ovirt.engine.core.utils.timer.SchedulerUtilBaseImpl.TRIGGER_PREFIX); org.quartz.Trigger trigger = newTrigger().withIdentity(triggerName, Scheduler.DEFAULT_GROUP).withSchedule(cronSchedule(cronExpression)).startAt(startAt).endAt(endBy).build(); sched.scheduleJob(job, trigger); } catch (java.lang.Exception se) { log.error("failed to schedule job: {}", se.getMessage()); log.debug("Exception", se); throw new java.lang.RuntimeException(se); } return job.getKey().getName(); }
private void logNoDeviceToHotUnplug(java.util.List<org.ovirt.engine.core.common.businessentities.VmDevice> vmMemoryDevices) { final org.ovirt.engine.core.common.AuditLogType message = (vmMemoryDevices.isEmpty()) ? org.ovirt.engine.core.common.AuditLogType.NO_MEMORY_DEVICE_TO_HOT_UNPLUG : org.ovirt.engine.core.common.AuditLogType.NO_SUITABLE_MEMORY_DEVICE_TO_HOT_UNPLUG; if (!(vmMemoryDevices.isEmpty())) { final int originalMemoryMb = oldVm.getMemSizeMb(); org.ovirt.engine.core.bll.UpdateVmCommand.addCustomValue(org.ovirt.engine.core.bll.UpdateVmCommand.AUDIT_LOG_OLD_MEMORY_MB, java.lang.String.valueOf(originalMemoryMb)); addCustomValue(org.ovirt.engine.core.bll.UpdateVmCommand.AUDIT_LOG_NEW_MEMORY_MB, java.lang.String.valueOf(org.ovirt.engine.core.bll.UpdateVmCommand.getParameters().getVm().getMemSizeMb())); final java.lang.String unplugOptions = vmMemoryDevices.stream().filter(VmDeviceCommonUtils::isMemoryDeviceHotUnpluggable).map(( device) -> org.ovirt.engine.core.common.utils.VmDeviceCommonUtils.getSizeOfMemoryDeviceMb(device).get()).map(( deviceSize) -> java.lang.String.format("%dMB (%dMB)", deviceSize, memoryAfterHotUnplug(originalMemoryMb, deviceSize))).collect(java.util.stream.Collectors.joining(", ")); org.ovirt.engine.core.bll.UpdateVmCommand.addCustomValue(org.ovirt.engine.core.bll.UpdateVmCommand.AUDIT_LOG_MEMORY_HOT_UNPLUG_OPTIONS, unplugOptions); } auditLogDirector.log(this, message); }
protected boolean checkStoragePool() { if ((org.ovirt.engine.core.bll.storage.StorageHandlingCommandBase.getStoragePool()) == null) { addValidationMessage(EngineMessage.ACTION_TYPE_FAILED_STORAGE_POOL_NOT_EXIST); return false; } return true; }
@org.junit.Test public void jsonInvalidJson() throws java.io.IOException { provider.initMigrationPolicies("this is not a valid json"); org.ovirt.engine.core.common.migration.MigrationPolicy policy = provider.getMigrationPolicy(org.ovirt.engine.core.compat.Guid.newGuid()); assertTrue((policy instanceof org.ovirt.engine.core.common.migration.NoMigrationPolicy)); }
private javax.ws.rs.core.Response addDomain(org.ovirt.engine.core.common.action.VdcActionType action, org.ovirt.engine.api.model.StorageDomain model, org.ovirt.engine.core.common.businessentities.StorageDomainStatic entity, org.ovirt.engine.core.compat.Guid hostId, org.ovirt.engine.core.common.businessentities.StorageServerConnections connection) { javax.ws.rs.core.Response response = null; boolean isConnNew = false; if ((connection.getstorage_type().isFileDomain()) && (org.apache.commons.lang.StringUtils.isEmpty(connection.getid()))) { isConnNew = true; connection.setid(addStorageServerConnection(connection, hostId)); } entity.setStorage(connection.getid()); if (((action == (org.ovirt.engine.core.common.action.VdcActionType.AddNFSStorageDomain)) || (action == (org.ovirt.engine.core.common.action.VdcActionType.AddPosixFsStorageDomain))) || (action == (org.ovirt.engine.core.common.action.VdcActionType.AddGlusterFsStorageDomain))) { org.ovirt.engine.core.common.businessentities.StorageDomain existing = getExistingStorageDomain(hostId, entity.getStorageType(), entity.getStorageDomainType(), connection); if (existing != null) { org.ovirt.engine.api.restapi.types.StorageDomainMapper.map(model, existing.getStorageStaticData()); entity = existing.getStorageStaticData(); action = org.ovirt.engine.core.common.action.VdcActionType.AddExistingFileStorageDomain; } } try { if (action != (org.ovirt.engine.core.common.action.VdcActionType.AddExistingFileStorageDomain)) { validateParameters(model, 2, "name"); } response = performCreate(action, getAddParams(entity, hostId), ID_RESOLVER); } catch (javax.ws.rs.WebApplicationException e) { if (isConnNew) { removeStorageServerConnection(connection, hostId); } throw e; } return response; }
@org.junit.Test public void testRangeStartAndRangeStopAreInclusive() throws java.lang.Exception { assertThat(new org.ovirt.engine.core.bll.network.macpoolmanager.Range(org.ovirt.engine.core.bll.network.macpoolmanager.RangeTest.MAC_FROM_RANGE, org.ovirt.engine.core.bll.network.macpoolmanager.RangeTest.MAC_FROM_RANGE).getAvailableCount(), is(1)); }
private void removeHostedEngineLunDisk() { java.util.List<org.ovirt.engine.core.common.businessentities.storage.BaseDisk> disks = org.ovirt.engine.core.bll.storage.domain.ImportHostedEngineStorageDomainCommand.getDbFacade().getBaseDiskDao().getDisksByAlias(StorageConstants.HOSTED_ENGINE_LUN_DISK_ALIAS); if ((disks != null) && (!(disks.isEmpty()))) { org.ovirt.engine.core.common.businessentities.storage.BaseDisk heDirectLun = disks.get(0); org.ovirt.engine.core.common.action.VdcReturnValueBase removeDisk = org.ovirt.engine.core.bll.storage.domain.ImportHostedEngineStorageDomainCommand.getBackend().runInternalAction(VdcActionType.RemoveDisk, new org.ovirt.engine.core.common.action.RemoveDiskParameters(heDirectLun.getId())); if (!(removeDisk.getSucceeded())) { org.ovirt.engine.core.bll.storage.domain.ImportHostedEngineStorageDomainCommand.setSucceeded(false); log.error("Failed to remove the hosted engine direct lun disk"); return; } } org.ovirt.engine.core.bll.storage.domain.ImportHostedEngineStorageDomainCommand.setSucceeded(true); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Custom") java.lang.String customInstanceTypeName();
private java.lang.Iterable<org.ovirt.engine.core.common.businessentities.VDSGroup> findMigrationFreeClusters() { final java.util.List<org.ovirt.engine.core.common.businessentities.VM> migratingVms = vmDao.getAllByStatus(VMStatus.MigratingFrom); final java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.businessentities.VDSGroup> allClusters = new java.util.HashMap<>(); for (org.ovirt.engine.core.common.businessentities.VDSGroup cluster : vdsGroupDao.getAll()) { allClusters.put(cluster.getId(), cluster); } for (org.ovirt.engine.core.common.businessentities.VM vm : migratingVms) { allClusters.remove(vm.getVdsGroupId()); } return allClusters.values(); }
@org.ovirt.engine.core.utils.timer.OnTimerMethodAnnotation("refreshHeavyWeightData") public void refreshHeavyWeightData() { log.debug("Refreshing Gluster Data [heavyweight]"); for (org.ovirt.engine.core.common.businessentities.VDSGroup cluster : getClusterDao().getAll()) { if ((org.ovirt.engine.core.common.gluster.GlusterFeatureSupported.refreshHeavyWeight(cluster.getcompatibility_version())) && (cluster.supportsGlusterService())) { try { refreshClusterHeavyWeightData(cluster); } catch (java.lang.Exception e) { log.error("Error while refreshing Gluster heavyweight data of cluster '{}': {}", cluster.getName(), e.getMessage()); log.debug("Exception", e); } } } }
public void updateCpuSharesSelection() { boolean foundEnum = false; for (org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel.CpuSharesAmount cpuSharesAmount : UnitVmModel.CpuSharesAmount.values()) { if ((cpuSharesAmount.getValue()) == (getModel().getCpuSharesAmount().getEntity())) { getModel().getCpuSharesAmountSelection().setSelectedItem(cpuSharesAmount); foundEnum = true; break; } } if (!foundEnum) { java.lang.Integer currentVal = getModel().getCpuSharesAmount().getEntity(); getModel().getCpuSharesAmountSelection().setSelectedItem(UnitVmModel.CpuSharesAmount.CUSTOM); getModel().getCpuSharesAmount().setEntity(currentVal); } }
public static synchronized java.lang.String[] getLinksToExclude(org.ovirt.engine.api.model.StorageDomain storageDomain) { return org.ovirt.engine.api.restapi.resource.BackendStorageDomainResource.isIsoDomain(storageDomain) ? new java.lang.String[]{ "templates", "vms", "disks", "images" } : org.ovirt.engine.api.restapi.resource.BackendStorageDomainResource.isExportDomain(storageDomain) ? new java.lang.String[]{ "files", "images" } : org.ovirt.engine.api.restapi.resource.BackendStorageDomainResource.isImageDomain(storageDomain) ? new java.lang.String[]{ "templates", "vms", "files", "disks", "storageconnections" } : new java.lang.String[]{ "files", "images" }; }
public void setActualSizeInBytes(long size) { actualSizeInBytes = size; setActualSize((((getActualSizeInBytes()) * 1.0) / ((1024 * 1024) * 1024))); }
private java.util.Map<org.ovirt.engine.core.compat.Guid, java.util.List<java.lang.Integer>> getAllNumaNodeCpuMap() { java.util.List<org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.compat.Guid, java.lang.Integer>> numaNodesCpus = getCallsHandler().executeReadList("GetAllFromNumaNodeCpuMap", org.ovirt.engine.core.dao.VmNumaNodeDaoImpl.vmNumaNodeCpusRowMapper, null); java.util.Map<org.ovirt.engine.core.compat.Guid, java.util.List<java.lang.Integer>> numaNodesCpusMap = new java.util.HashMap<>(); for (org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.compat.Guid, java.lang.Integer> pair : numaNodesCpus) { if (!(numaNodesCpusMap.containsKey(pair.getFirst()))) { numaNodesCpusMap.put(pair.getFirst(), new java.util.ArrayList<java.lang.Integer>()); } numaNodesCpusMap.get(pair.getFirst()).add(pair.getSecond()); } return numaNodesCpusMap; }
private static void updateCommonInterfaceData(org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface iface, org.ovirt.engine.core.common.businessentities.VDS host, java.util.Map.Entry<java.lang.String, java.util.Map<java.lang.String, java.lang.Object>> ifaceEntry) { iface.setName(ifaceEntry.getKey()); iface.setId(org.ovirt.engine.core.compat.Guid.newGuid()); iface.setVdsId(host.getId()); org.ovirt.engine.core.common.businessentities.network.VdsNetworkStatistics iStats = new org.ovirt.engine.core.common.businessentities.network.VdsNetworkStatistics(); iStats.setId(iface.getId()); iStats.setVdsId(host.getId()); iface.setStatistics(iStats); java.util.Map<java.lang.String, java.lang.Object> nicProperties = ifaceEntry.getValue(); if (nicProperties != null) { iface.setAddress(org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.extractAddress(nicProperties)); iface.setSubnet(org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.extractSubnet(nicProperties)); java.lang.String mtu = ((java.lang.String) (nicProperties.get(VdsProperties.MTU))); if (org.apache.commons.lang.StringUtils.isNotBlank(mtu)) { iface.setMtu(java.lang.Integer.parseInt(mtu)); } org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.addBootProtocol(((java.util.Map<java.lang.String, java.lang.Object>) (nicProperties.get("cfg"))), host, iface); } }
@java.lang.Override protected boolean canDoAction() { if ((getNic()) == null) { return failCanDoAction(EngineMessage.HOST_NETWORK_INTERFACE_NOT_EXIST); } if ((!(org.ovirt.engine.core.utils.NetworkUtils.isLabeled(getNic()))) || (!(getNic().getLabels().contains(getLabel())))) { return failCanDoAction(EngineMessage.INTERFACE_NOT_LABELED); } return true; }
@org.junit.Test public void testBondNotUpdatedAndRemovedSimultaneouslyNotValid() { org.ovirt.engine.core.common.action.HostSetupNetworksParameters params = new org.ovirt.engine.core.bll.network.host.HostSetupNetworksValidatorTest.ParametersBuilder().addBonds(org.ovirt.engine.core.common.action.CreateOrUpdateBond.fromBond(bond)).addRemovedBonds(bond.getId()).build(); org.ovirt.engine.core.bll.network.host.HostSetupNetworksValidator validator = new org.ovirt.engine.core.bll.network.host.HostSetupNetworksValidatorTest.HostSetupNetworksValidatorBuilder().setParams(params).build(); org.ovirt.engine.core.common.errors.EngineMessage engineMessage = org.ovirt.engine.core.common.errors.EngineMessage.BONDS_UPDATED_AND_REMOVED_SIMULTANEOUSLY; assertThat(validator.bondNotUpdatedAndRemovedSimultaneously(), failsWith(engineMessage, org.ovirt.engine.core.utils.ReplacementUtils.getListVariableAssignmentString(engineMessage, java.util.Collections.singletonList(bond.getName())))); }
@java.lang.Override protected void executeCommand() { org.ovirt.engine.core.common.vdscommands.VDSReturnValue vdsReturnaValue = runVdsCommand(VDSCommandType.StopRebalanceGlusterVolume, new org.ovirt.engine.core.common.vdscommands.gluster.GlusterVolumeVDSParameters(upServer.getId(), getGlusterVolumeName())); if (!(vdsReturnaValue.getSucceeded())) { handleVdsError(AuditLogType.GLUSTER_VOLUME_REBALANCE_STOP_FAILED, vdsReturnaValue.getVdsError().getMessage()); setSucceeded(false); return; } org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeTaskStatusEntity rebalanceStatusEntity = ((org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeTaskStatusEntity) (vdsReturnaValue.getReturnValue())); org.ovirt.engine.core.common.job.JobExecutionStatus stepStatus = rebalanceStatusEntity.getStatusSummary().getStatus(); if ((stepStatus != null) && (JobExecutionStatus.FINISHED.equals(stepStatus))) { endStepJob(stepStatus, getStepMessageMap(stepStatus), true); } else { endStepJob(JobExecutionStatus.ABORTED, getStepMessageMap(JobExecutionStatus.ABORTED), false); } releaseVolumeLock(); setSucceeded(vdsReturnaValue.getSucceeded()); getReturnValue().setActionReturnValue(rebalanceStatusEntity); }
@java.lang.Override public void run() { getBackend().runInternalAction(VdcActionType.PersistentSetupNetworks, params); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Export Virtual Machine") java.lang.String exportVirtualMachineTitle();
@java.lang.Override protected boolean canDoAction() { org.ovirt.engine.core.bll.snapshots.SnapshotsValidator snapshotsValidator = createSnapshotsValidator(); if ((!(validate(snapshotsValidator.snapshotExists(getSnapshot())))) || (!(validate(snapshotsValidator.vmNotDuringSnapshot(getSnapshot().getVmId()))))) { return false; } if ((org.ovirt.engine.core.bll.AddVmTemplateFromSnapshotCommand.getVm()) == null) { return failCanDoAction(VdcBllMessages.ACTION_TYPE_FAILED_VM_SNAPSHOT_HAS_NO_CONFIGURATION, java.lang.String.format("$VmName %1$s", org.ovirt.engine.core.bll.AddVmTemplateFromSnapshotCommand.getVmName()), java.lang.String.format("$SnapshotName %1$s", org.ovirt.engine.core.bll.AddVmTemplateFromSnapshotCommand.getSnapshotName())); } if ((org.ovirt.engine.core.bll.AddVmTemplateFromSnapshotCommand.getVdsGroup()) == null) { return failCanDoAction(VdcBllMessages.VMT_CLUSTER_IS_NOT_VALID); } return super.canDoAction(); }
private java.util.List<org.ovirt.engine.core.common.businessentities.VDS> filter() { return policyUnit.filter(java.util.Arrays.asList(hostWithCpus, hostWithoutCpus), vm, null, perHostMessages); }
@org.junit.Test public void internalPreparingForMaintenanceAllowed() { internalActionAllowed(StorageDomainStatus.PreparingForMaintenance); }
private void endCreateAllSnapshots() { org.ovirt.engine.core.common.action.VdcReturnValueBase returnValue = org.ovirt.engine.core.bll.Backend.getInstance().endAction(VdcActionType.CreateAllSnapshotsFromVm, getCreateSnapshotParameters(), org.ovirt.engine.core.bll.job.ExecutionHandler.createDefaultContexForTasks(enclosingCommand.getExecutionContext())); enclosingCommand.getReturnValue().setSucceeded(returnValue.getSucceeded()); }
@java.lang.Override public org.ovirt.engine.core.common.businessentities.MacPool flush() { getEntity().setName(getName().getEntity()); getEntity().setDescription(getDescription().getEntity()); return super.flush(); }
public org.ovirt.engine.core.bll.ValidationResult hasUniqueName() { return org.ovirt.engine.core.bll.ValidationResult.failWith(EngineMessage.ACTION_TYPE_FAILED_NAME_ALREADY_USED).when((!(macPoolNameUnique()))); }
private void removeNetworkFromHosts() { org.ovirt.engine.core.bll.network.cluster.NetworkHelper.removeNetworkFromHostsInCluster(getPersistedNetwork(), org.ovirt.engine.core.bll.network.cluster.DetachNetworkToVdsGroupCommand.getParameters().getVdsGroupId(), org.ovirt.engine.core.bll.network.cluster.DetachNetworkToVdsGroupCommand.cloneContextAndDetachFromParent()); }
java.util.Map<java.lang.String, java.lang.String> getMessageMap(final java.lang.String prefix, final java.util.Locale locale) { java.util.List<org.ovirt.engine.core.utils.branding.BrandingTheme> messageThemes = getBrandingThemes(); java.util.Map<java.lang.String, java.lang.String> keyValues = new java.util.HashMap<java.lang.String, java.lang.String>(); if (messageThemes != null) { for (org.ovirt.engine.core.utils.branding.BrandingTheme theme : messageThemes) { java.util.ResourceBundle messagesBundle = theme.getMessagesBundle(locale); for (java.lang.String key : messagesBundle.keySet()) { if ((key.startsWith((((org.ovirt.engine.core.utils.branding.BrandingManager.BRAND_PREFIX) + ".") + prefix))) || (key.startsWith(org.ovirt.engine.core.utils.branding.BrandingManager.COMMON_PREFIX))) { keyValues.put(key.replaceFirst(((((org.ovirt.engine.core.utils.branding.BrandingManager.BRAND_PREFIX) + "\\.") + prefix) + "\\."), "").replaceFirst(((org.ovirt.engine.core.utils.branding.BrandingManager.COMMON_PREFIX) + "\\."), ""), messagesBundle.getString(key)); } } } } return keyValues; }
@java.lang.Override protected boolean canDoAction() { if (!(super.canDoAction())) { return false; } if ((getParameters().getClusterId()) == null) { addCanDoActionMessage(EngineMessage.ACTION_TYPE_FAILED_CLUSTER_IS_NOT_VALID); return false; } if (!(getGlusterUtil().isGlusterSnapshotSupported(getVdsGroup().getCompatibilityVersion(), getVdsGroup().getId()))) { failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_VOLUME_SNAPSHOT_NOT_SUPPORTED); } if ((getParameters().getConfigParams()) == null) { addCanDoActionMessage(EngineMessage.ACTION_TYPE_FAILED_GLUSTER_VOLUME_SNAPSHOT_CONFIG_PARAMS_IS_EMPTY); return false; } for (org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeSnapshotConfig param : getParameters().getConfigParams()) { if (org.apache.commons.lang.StringUtils.isEmpty(param.getParamValue())) { addCustomValue("snapshotConfigParam", param.getParamName()); addCanDoActionMessage(EngineMessage.ACTION_TYPE_FAILED_GLUSTER_VOLUME_SNAPSHOT_CONFIG_PARAM_VALUE_IS_EMPTY); return false; } } return true; }
@java.lang.Override public int hashCode() { final int prime = 31; int result = 1; result = (prime * result) + ((imagesParameters) == null ? 0 : imagesParameters.hashCode()); result = (prime * result) + (shouldbelogged ? 1231 : 1237); result = (prime * result) + ((transctionOption) == null ? 0 : transctionOption.hashCode()); result = (prime * result) + ((entityInfo) == null ? 0 : entityInfo.hashCode()); result = (prime * result) + (multipleAction ? 1231 : 1237); result = (prime * result) + ((parametersCurrentUser) == null ? 0 : parametersCurrentUser.hashCode()); result = (prime * result) + ((parentCommand) == null ? 0 : parentCommand.hashCode()); result = (prime * result) + ((vdsmTaskIds) == null ? 0 : vdsmTaskIds.hashCode()); result = (prime * result) + ((correlationId) == null ? 0 : correlationId.hashCode()); result = (prime * result) + (executionIndex); result = (prime * result) + ((jobId) == null ? 0 : jobId.hashCode()); result = (prime * result) + ((stepId) == null ? 0 : stepId.hashCode()); return result; }
@org.junit.experimental.theories.Theory public void testPlainHeartbeat(int incoming, int outgoing) { org.ovirt.vdsm.jsonrpc.client.reactors.Reactor listeningReactor = null; org.ovirt.vdsm.jsonrpc.client.reactors.Reactor sendingReactor = null; try { listeningReactor = new org.ovirt.vdsm.jsonrpc.client.reactors.stomp.StompReactor(); sendingReactor = new org.ovirt.vdsm.jsonrpc.client.reactors.stomp.StompReactor(); this.testHeartbeat(listeningReactor, sendingReactor, incoming, outgoing); } catch (java.io.IOException | org.ovirt.vdsm.jsonrpc.client.ClientConnectionException | java.lang.InterruptedException | java.util.concurrent.ExecutionException e) { fail(); } finally { if (sendingReactor != null) { try { sendingReactor.close(); } catch (java.io.IOException ignored) { } } if (listeningReactor != null) { try { listeningReactor.close(); } catch (java.io.IOException ignored) { } } } }
@org.junit.Test(expected = org.ovirt.engine.core.vdsbroker.vdsbroker.VDSNetworkException.class) public void testErrorHandling() { org.ovirt.engine.core.common.vdscommands.VDSReturnValue value = new org.ovirt.engine.core.common.vdscommands.VDSReturnValue(); value.setSucceeded(false); value.setExceptionObject(new org.ovirt.engine.core.vdsbroker.vdsbroker.VDSNetworkException("unknown host")); when(updater.getResourceManager()).thenReturn(resourceManager); when(updater.getVdsEventListener()).thenReturn(vdsEventlistener); when(resourceManager.runVdsCommand(any(org.ovirt.engine.core.common.vdscommands.VDSCommandType.class), any(org.ovirt.engine.core.common.vdscommands.VDSParametersBase.class))).thenReturn(value); updater.refreshVdsStats(); }
@org.junit.Test public void shouldDoNothingWithoutGroups() { assertNull(enforcer.chooseNextVmToMigrate(vdsGroup)); }
@java.lang.SuppressWarnings("unchecked") @org.junit.Test public void testGetPeers() throws javax.naming.AuthenticationException { org.ovirt.engine.core.bll.utils.GlusterUtilTest.EXPECTED_MAP.put(org.ovirt.engine.core.bll.utils.GlusterUtilTest.SERVER_NAME1, org.ovirt.engine.core.bll.utils.GlusterUtilTest.FINGER_PRINT1); org.ovirt.engine.core.bll.utils.GlusterUtilTest.EXPECTED_MAP.put(org.ovirt.engine.core.bll.utils.GlusterUtilTest.SERVER_NAME2, org.ovirt.engine.core.bll.utils.GlusterUtilTest.FINGER_PRINT2); doReturn(org.ovirt.engine.core.bll.utils.GlusterUtilTest.EXPECTED_MAP).when(glusterUtil).getFingerprints(any(java.util.Set.class)); java.util.Set<java.lang.String> peers = glusterUtil.getPeers(org.ovirt.engine.core.bll.utils.GlusterUtilTest.SERVER_NAME1, org.ovirt.engine.core.bll.utils.GlusterUtilTest.USER, org.ovirt.engine.core.bll.utils.GlusterUtilTest.PASSWORD); assertNotNull(peers); assertTrue(peers.contains(org.ovirt.engine.core.bll.utils.GlusterUtilTest.SERVER_NAME1)); assertTrue(peers.contains(org.ovirt.engine.core.bll.utils.GlusterUtilTest.SERVER_NAME2)); }
protected java.lang.Integer extractDisplayPort(org.ovirt.engine.core.common.businessentities.GraphicsType graphicsType) { org.ovirt.engine.core.common.businessentities.GraphicsInfo graphicsInfo = getEntity().getGraphicsInfos().get(graphicsType); if ((graphicsInfo != null) && ((graphicsInfo.getPort()) != null)) { return graphicsInfo.getPort(); } return 0; }
@java.lang.Override public org.ovirt.engine.core.common.businessentities.gluster.GlusterBrickEntity mapRow(java.sql.ResultSet rs, int rowNum) throws java.sql.SQLException { org.ovirt.engine.core.common.businessentities.gluster.GlusterBrickEntity brick = new org.ovirt.engine.core.common.businessentities.gluster.GlusterBrickEntity(); brick.setId(org.ovirt.engine.core.compat.Guid.createGuidFromString(rs.getString("id"))); brick.setVolumeId(org.ovirt.engine.core.compat.Guid.createGuidFromString(rs.getString("volume_id"))); org.ovirt.engine.core.compat.Guid serverId = org.ovirt.engine.core.compat.Guid.createGuidFromString(rs.getString("server_id")); brick.setServerId(serverId); brick.setServerName(getHostNameOfServer(serverId)); brick.setBrickDirectory(rs.getString("brick_dir")); brick.setBrickOrder(rs.getInt("brick_order")); brick.setStatus(org.ovirt.engine.core.common.businessentities.gluster.GlusterBrickStatus.valueOf(rs.getString("status"))); return brick; }
private void verifyCalls(boolean attachToAllClusters) { verify(backend).runInternalAction(eq(ActionType.AddNetwork), any(), any()); verify(networkHelper).addVnicProfileWithoutFilter(any(), anyBoolean()); org.mockito.verification.VerificationMode expectedNumberOfCalls = (attachToAllClusters) ? times(1) : never(); verify(backend, expectedNumberOfCalls).runInternalQuery(eq(QueryType.GetClustersByStoragePoolId), any(), any()); verify(networkHelper, expectedNumberOfCalls).attachNetworkToClusters(eq(NETWORK_ID), any()); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("New MAC Address Pool") java.lang.String newSharedMacPoolTitle();
@java.lang.Override protected java.util.Map<java.lang.String, org.ovirt.engine.core.common.utils.Pair<java.lang.String, java.lang.String>> getExclusiveLocks() { return java.util.Collections.singletonMap(org.ovirt.engine.core.bll.storage.ActivateStorageDomainCommand.getStorageDomainId().toString(), org.ovirt.engine.core.bll.LockMessagesMatchUtil.makeLockingPair(LockingGroup.STORAGE, EngineMessage.ACTION_TYPE_FAILED_OBJECT_LOCKED)); }
@java.lang.Override public org.ovirt.engine.api.resource.HostNumaNodesResource getHostNumaNodesResource() { return inject(new org.ovirt.engine.api.restapi.resource.BackendHostNumaNodesResource(id)); }
private void setDetailList() { vmGeneralModel.setIsAvailable(false); vmSnapshotListModel.setIsAvailable(false); vmMonitorModel.setIsAvailable(false); vmDiskListModel.setIsAvailable(false); vmInterfaceListModel.setIsAvailable(false); poolGeneralModel.setIsAvailable(false); poolDiskListModel.setIsAvailable(false); poolInterfaceListModel.setIsAvailable(false); permissionListModel.setIsAvailable(true); vmEventListModel.setIsAvailable(true); vmAppListModel.setIsAvailable(true); vmGuestInfoModel.setIsAvailable(true); vmGuestContainerListModel.setIsAvailable(true); java.util.List<org.ovirt.engine.ui.uicommonweb.models.HasEntity<?>> list = new java.util.ArrayList<>(); list.add(vmGeneralModel); list.add(poolGeneralModel); list.add(vmInterfaceListModel); list.add(poolInterfaceListModel); list.add(vmDiskListModel); list.add(poolDiskListModel); list.add(vmSnapshotListModel); list.add(permissionListModel); list.add(vmEventListModel); list.add(vmAppListModel); list.add(vmMonitorModel); list.add(vmGuestInfoModel); list.add(vmGuestContainerListModel); setDetailModels(((java.util.List) (list))); }
@org.junit.Test public void testGuestOs2() { org.ovirt.engine.core.common.businessentities.VM vm = new org.ovirt.engine.core.common.businessentities.VM(); org.ovirt.engine.core.common.businessentities.VmDynamic vmDynamic = new org.ovirt.engine.core.common.businessentities.VmDynamic(); vmDynamic.setStatus(VMStatus.Up); vmDynamic.setGuestOsType(OsType.Windows); vmDynamic.setGuestOsCodename(""); vmDynamic.setGuestOsDistribution(""); vmDynamic.setGuestOsVersion("6.2.4800"); vmDynamic.setGuestOsArch(ArchitectureType.x86_64); vmDynamic.setGuestOsKernelVersion(""); vm.setDynamicData(vmDynamic); org.ovirt.engine.api.model.VM map = org.ovirt.engine.api.restapi.types.VmMapper.map(vm, ((org.ovirt.engine.api.model.VM) (null))); assertNotNull(map.getGuestOperatingSystem()); assertEquals(map.getGuestOperatingSystem().getFamily(), "Windows"); assertEquals(map.getGuestOperatingSystem().getCodename(), ""); assertEquals(map.getGuestOperatingSystem().getDistribution(), ""); assertEquals(map.getGuestOperatingSystem().getVersion().getFullVersion(), "6.2.4800"); assertNotNull(map.getGuestOperatingSystem().getVersion().getMajor()); assertEquals(((long) (map.getGuestOperatingSystem().getVersion().getMajor())), 6); assertNotNull(map.getGuestOperatingSystem().getVersion().getMinor()); assertEquals(((long) (map.getGuestOperatingSystem().getVersion().getMinor())), 2); assertNotNull(map.getGuestOperatingSystem().getVersion().getBuild()); assertEquals(((long) (map.getGuestOperatingSystem().getVersion().getBuild())), 4800); assertNull(map.getGuestOperatingSystem().getVersion().getRevision()); assertEquals(map.getGuestOperatingSystem().getArchitecture(), "x86_64"); assertNull(map.getGuestOperatingSystem().getKernel()); }
void updateHost() { if ((getDataCenter().getItems()) == null) { return; } if ((getSelectedItem()) == null) { return; } org.ovirt.engine.core.common.businessentities.StoragePool dataCenter = ((org.ovirt.engine.core.common.businessentities.StoragePool) (getDataCenter().getSelectedItem())); boolean localFsOnly = (getSelectedItem()) instanceof org.ovirt.engine.ui.uicommonweb.models.storage.LocalStorageModel; org.ovirt.engine.core.compat.Guid dataCenterId = (dataCenter == null) ? null : dataCenter.getId(); org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getHostsForStorageOperation(new org.ovirt.engine.ui.frontend.AsyncQuery(this, new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.models.storage.StorageModel storageModel = ((org.ovirt.engine.ui.uicommonweb.models.storage.StorageModel) (model)); java.lang.Iterable<org.ovirt.engine.core.common.businessentities.VDS> hosts = ((java.lang.Iterable<org.ovirt.engine.core.common.businessentities.VDS>) (returnValue)); storageModel.postUpdateHost(hosts); } }, getHash()), dataCenterId, localFsOnly); }
public org.ovirt.engine.api.model.Network get() { org.ovirt.engine.core.common.businessentities.Network entity = parent.lookupNetwork(guid); if (entity == null) { return notFound(); } return addLinks(map(entity)); }
private void createGeoRepSession() { if (((getWindow()) != null) || ((getEntity()) == null)) { return; } final org.ovirt.engine.ui.uicompat.UIConstants constants = org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants(); org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity selectedMasterVolume = getEntity(); final org.ovirt.engine.ui.uicommonweb.models.gluster.GlusterVolumeGeoRepCreateModel geoRepCreateModel = new org.ovirt.engine.ui.uicommonweb.models.gluster.GlusterVolumeGeoRepCreateModel(selectedMasterVolume); setWindow(geoRepCreateModel); geoRepCreateModel.getSlaveUserName().setEntity(constants.rootUser()); geoRepCreateModel.getShowEligibleVolumes().setEntity(true); org.ovirt.engine.ui.uicommonweb.UICommand ok = new org.ovirt.engine.ui.uicommonweb.UICommand("onCreateSession", this); ok.setTitle(constants.ok()); ok.setIsDefault(true); geoRepCreateModel.getCommands().add(ok); org.ovirt.engine.ui.uicommonweb.UICommand close = new org.ovirt.engine.ui.uicommonweb.UICommand("closeWindow", this); close.setTitle(constants.cancel()); close.setIsCancel(true); geoRepCreateModel.getCommands().add(close); }
@java.lang.Override public org.ovirt.engine.core.common.vdscommands.VDSReturnValue get(long timeout, java.util.concurrent.TimeUnit unit) throws java.util.concurrent.TimeoutException { try { status = new org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc(httpTask.get(timeout, unit)); org.ovirt.engine.core.vdsbroker.vdsbroker.FutureVDSCommand.proceedProxyReturnValue(); } catch (java.util.concurrent.TimeoutException e) { httpTask.cancel(true); org.ovirt.engine.core.vdsbroker.vdsbroker.VDSNetworkException ex = new org.ovirt.engine.core.vdsbroker.vdsbroker.VDSNetworkException("Timeout during xml-rpc call"); ex.setVdsError(new org.ovirt.engine.core.common.errors.VDSError(org.ovirt.engine.core.common.errors.VdcBllErrors.VDS_NETWORK_ERROR, "Timeout during xml-rpc call")); setVdsRuntimeError(ex); log.error("Timeout waiting for VDSM response: {}", e.getMessage()); log.debug("Exception", e); throw e; } catch (java.lang.Exception e) { log.error("Error: {}", e.getMessage()); log.error("Exception", e); org.ovirt.engine.core.vdsbroker.vdsbroker.FutureVDSCommand.setVdsRuntimeError((e instanceof java.lang.RuntimeException ? ((java.lang.RuntimeException) (e)) : new java.lang.RuntimeException(e))); } return org.ovirt.engine.core.vdsbroker.vdsbroker.FutureVDSCommand.getVDSReturnValue(); }
@org.junit.Before public void setUp() throws java.lang.Exception { testServlet = new org.ovirt.engine.ui.frontend.server.gwt.BrandingServlet(); testServlet.init(mockBrandingManager); when(mockBrandingManager.getBrandingRootPath()).thenReturn(mockFile); when(mockFile.getAbsolutePath()).thenReturn("/abs/test"); when(mockRequest.getPathInfo()).thenReturn("/test/something.txt"); when(mockResponse.getOutputStream()).thenReturn(mockResponseOutputStream); java.io.File testFile = new java.io.File(this.getClass().getClassLoader().getResource("./org/ovirt/engine/ui/frontend/server/gwt/BrandingServletTest.class").getFile()); testFileEtag = testServlet.generateEtag(testFile); }
private void load() throws org.ovirt.engine.core.extensions.mgr.ConfigurationException { for (java.io.File directory : org.ovirt.engine.core.utils.EngineLocalConfig.getInstance().getExtensionsDirectories()) { load(directory); } activate(); }
@org.junit.Test public void oldHostDoesNotExist() { validator = new org.ovirt.engine.core.bll.validator.UpdateHostValidator(dbFacade, oldHost, null, false); assertThat(validator.hostExists(), org.ovirt.engine.core.bll.validator.ValidationResultMatchers.failsWith(EngineMessage.VDS_INVALID_SERVER_ID)); }
private void setResetEmulatedMachineCommand(org.ovirt.engine.ui.uicommonweb.UICommand value) { resetEmulatedMachineCommand = value; }
protected org.ovirt.engine.core.bll.ValidationResult networkNotUsed(java.util.List<? extends org.ovirt.engine.core.common.businessentities.Nameable> entities, org.ovirt.engine.core.common.errors.EngineMessage entitiesReplacementPlural, org.ovirt.engine.core.common.errors.EngineMessage entitiesReplacementSingular) { return new org.ovirt.engine.core.common.utils.PluralMessages().getNetworkInUse(getEntitiesNames(entities), entitiesReplacementSingular, entitiesReplacementPlural); }
public static void removeVolumeAlert(org.ovirt.engine.core.compat.Guid volumeId, org.ovirt.engine.core.common.AuditLogType type) { org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getAuditLogDao().removeAllOfTypeForVolume(volumeId, type.getValue()); }
@org.junit.Test public void passwordIsEmpty() { assertThat(validator.passwordNotEmpty(false, AuthenticationMethod.Password, null), org.ovirt.engine.core.bll.validator.ValidationResultMatchers.failsWith(EngineMessage.VDS_CANNOT_INSTALL_EMPTY_PASSWORD)); }
public static void populateStorageUtilizationDomains(org.ovirt.engine.ui.frontend.server.dashboard.Utilization utilization, javax.sql.DataSource dwhDataSource) throws org.ovirt.engine.ui.frontend.server.dashboard.DashboardDataException { org.ovirt.engine.ui.frontend.server.dashboard.dao.StorageDomainDwhDao dao = new org.ovirt.engine.ui.frontend.server.dashboard.dao.StorageDomainDwhDao(dwhDataSource); java.util.List<org.ovirt.engine.ui.frontend.server.dashboard.models.TrendResources> usageList = dao.getStorageDomainUtilization(); for (org.ovirt.engine.ui.frontend.server.dashboard.models.TrendResources usage : usageList) { org.ovirt.engine.ui.frontend.server.dashboard.UtilizedEntity entity = new org.ovirt.engine.ui.frontend.server.dashboard.UtilizedEntity(); entity.setName(usage.getName()); entity.setUsed(((usage.getUsed()) / 1024)); entity.setTotal(((usage.getTotal()) / 1024)); entity.setTrend(org.ovirt.engine.ui.frontend.server.dashboard.UtilizationHelper.calculateTrend(usage.getUsed(), usage.getPreviousUsed())); utilization.addResource(entity); } }
@org.junit.Test public void getMixedLunConnections() { org.ovirt.engine.core.common.businessentities.LUNs lun = new org.ovirt.engine.core.common.businessentities.LUNs(); java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StorageServerConnections> connections = new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StorageServerConnections>(); connections.add(new org.ovirt.engine.core.common.businessentities.StorageServerConnections("Some LUN connection", "id", "iqn", "password", org.ovirt.engine.core.common.businessentities.StorageType.ISCSI, "Username", "port", "portal")); connections.add(new org.ovirt.engine.core.common.businessentities.StorageServerConnections("Other LUN connection", "id", "iqn", "password", org.ovirt.engine.core.common.businessentities.StorageType.FCP, "Username", "port", "portal")); lun.setLunConnections(connections); java.util.Map<org.ovirt.engine.core.common.businessentities.StorageType, java.util.List<org.ovirt.engine.core.common.businessentities.StorageServerConnections>> connectionsByType = org.ovirt.engine.core.bll.storage.StorageHelperBase.filterConnectionsByStorageType(lun); assertTrue("Map of storage connections should not be empty.", (!(connectionsByType.isEmpty()))); assertEquals("Map of storage connections should have only two types of connections.", 2, connectionsByType.size()); assertEquals("Map of ISCSI storage connections should have only 1 ISCSI connections.", 1, connectionsByType.get(StorageType.ISCSI).size()); assertEquals("Map of FCP storage connections should have only 1 FCP connections.", 1, connectionsByType.get(StorageType.FCP).size()); }
@java.lang.Override protected boolean canDoAction() { java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.businessentities.storage_domains> domainsMap = new java.util.HashMap<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.businessentities.storage_domains>(); if (!(canDoAction_beforeCloneVm(domainsMap))) { return false; } if (getParameters().isImportAsNewEntity()) { initImportClonedVm(); } return canDoAction_afterCloneVm(domainsMap); }
@java.lang.Override protected boolean validate() { org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity glusterVolume = getGlusterVolume(); if (!(super.validate())) { return false; } boolean isVolumeDistributed = glusterVolume.getVolumeType().isDistributedType(); if (!isVolumeDistributed) { return failValidation(EngineMessage.ACTION_TYPE_FAILED_GLUSTER_VOLUME_NOT_DISTRIBUTED); } else if ((glusterVolume.getBricks().size()) == 1) { return failValidation(EngineMessage.ACTION_TYPE_FAILED_GLUSTER_VOLUME_DISTRIBUTED_AND_HAS_SINGLE_BRICK); } org.ovirt.engine.core.bll.validator.gluster.GlusterBrickValidator brickValidator = new org.ovirt.engine.core.bll.validator.gluster.GlusterBrickValidator(); return validate(brickValidator.canRebalance(glusterVolume)); }
private int getResourceType(org.ovirt.engine.core.utils.ovf.xml.XmlNode node, java.lang.String resource) { if (((selectSingleNode(node, resource, _xmlNS)) != null) && (!(org.apache.commons.lang.StringUtils.isEmpty(selectSingleNode(node, resource, _xmlNS).innerText)))) { return java.lang.Integer.parseInt(selectSingleNode(node, resource, _xmlNS).innerText); } return -1; }
protected java.util.List<org.ovirt.engine.core.utils.customprop.CustomPropertiesUtils.ValidationError> validateCustomProperties(org.ovirt.engine.core.common.businessentities.VmStatic vmStaticFromParams) { return org.ovirt.engine.core.utils.customprop.VmPropertiesUtils.getInstance().validateVMProperties(org.ovirt.engine.core.bll.VmCommand.getVdsGroup().getcompatibility_version(), vmStaticFromParams); }
@java.lang.Override protected void updateDetailsAvailability() { super.updateDetailsAvailability(); org.ovirt.engine.core.common.businessentities.network.NetworkView network = ((org.ovirt.engine.core.common.businessentities.network.NetworkView) (getSelectedItem())); networkExternalSubnetListModel.setIsAvailable(((network != null) && (network.isExternal()))); }
@java.lang.Override public java.lang.String getName() { return name; }
@java.lang.Override public org.ovirt.engine.core.common.businessentities.Role getByName(java.lang.String name) { org.springframework.jdbc.core.namedparam.MapSqlParameterSource parameterSource = getCustomMapSqlParameterSource().addValue("name", name); return getCallsHandler().executeRead("GetRoleByName", org.ovirt.engine.core.dao.RoleDaoImpl.RolesRowMapper.instance, parameterSource); }
@org.junit.Test public void testVmLocked() { setUpGeneralValidations(); doReturn(new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_VM_IS_LOCKED)).when(vmValidator).vmNotLocked(); doReturn(org.ovirt.engine.core.bll.snapshots.CreateAllSnapshotsFromVmCommandTest.getEmptyDiskList()).when(cmd).getDisksList(); assertFalse(cmd.validate()); assertTrue(cmd.getReturnValue().getValidationMessages().contains(EngineMessage.ACTION_TYPE_FAILED_VM_IS_LOCKED.name())); }
@org.junit.Before public void setup() { validator = spy(new org.ovirt.engine.core.bll.network.dc.UpdateNetworkCommand.UpdateNetworkValidator(network)); }
@java.lang.Override protected void setActionMessageParameters() { addCanDoActionMessage(EngineMessage.VAR__ACTION__MANUAL_FENCE); addCanDoActionMessage(EngineMessage.VAR__TYPE__HOST); }
public void appendCustomCommaSeparatedValue(final java.lang.String name, final java.lang.String value) { appendCustomValue(name, value, org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase.COMMA_SEPARATOR); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Host Hooks") java.lang.String hostHooksTitle();
public static void GetDataCenterByClusterServiceList(org.ovirt.engine.ui.frontend.AsyncQuery aQuery, boolean supportsVirtService, boolean supportsGlusterService) { aQuery.converterCallback = new org.ovirt.engine.ui.frontend.IAsyncConverter() { @java.lang.Override public java.lang.Object Convert(java.lang.Object source, org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery) { if (source == null) { return new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.storage_pool>(); } final java.util.ArrayList<org.ovirt.engine.core.common.businessentities.storage_pool> storagePoolList = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.storage_pool>) (source)); java.util.Collections.sort(storagePoolList, new org.ovirt.engine.ui.uicommonweb.Linq.StoragePoolByNameComparer()); return source; } }; final org.ovirt.engine.core.common.queries.GetStoragePoolsByClusterServiceParameters parameters = new org.ovirt.engine.core.common.queries.GetStoragePoolsByClusterServiceParameters(); parameters.setSupportsVirtService(supportsVirtService); parameters.setSupportsGlusterService(supportsGlusterService); org.ovirt.engine.ui.frontend.Frontend.RunQuery(VdcQueryType.GetStoragePoolsByClusterService, parameters, aQuery); }
private java.lang.String getNetworkName() { org.ovirt.engine.core.common.businessentities.VmNetworkInterface vmNetworkInterface = org.ovirt.engine.core.bll.PlugUnplugVmNicCommand.getVmNetworkInterfaceDAO().get(org.ovirt.engine.core.bll.PlugUnplugVmNicCommand.getParameters().getNicId()); return vmNetworkInterface == null ? null : vmNetworkInterface.getNetworkName(); }
@org.ovirt.engine.ui.common.DefaultMessage("Changes that require Virtual Machine reboot:") java.lang.String nextRunConfigurationExists();
@java.lang.Override protected boolean canDoAction() { if ((getDiskImage()) == null) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_DISK_NOT_EXIST); } if (!(validate(new org.ovirt.engine.core.bll.validator.storage.StorageDomainValidator(org.ovirt.engine.core.bll.ExportRepoImageCommand.getStorageDomain()).isDomainExistAndActive()))) { return false; } if (!(getDiskImage().getParentId().equals(Guid.Empty))) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_DISK_CONFIGURATION_NOT_SUPPORTED); } for (org.ovirt.engine.core.common.businessentities.VM vm : org.ovirt.engine.core.bll.ExportRepoImageCommand.getVmDao().getVmsListForDisk(getDiskImage().getId(), false)) { if ((vm.getStatus()) != (org.ovirt.engine.core.common.businessentities.VMStatus.Down)) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_VM_IS_RUNNING); } } org.ovirt.engine.core.bll.validator.storage.DiskImagesValidator diskImagesValidator = new org.ovirt.engine.core.bll.validator.storage.DiskImagesValidator(java.util.Arrays.asList(getDiskImage())); if ((!(validate(diskImagesValidator.diskImagesNotIllegal()))) || (!(validate(diskImagesValidator.diskImagesNotLocked())))) { return false; } return true; }
public static void getAllowClusterWithVirtGlusterEnabled(org.ovirt.engine.ui.frontend.AsyncQuery aQuery) { aQuery.converterCallback = new org.ovirt.engine.ui.frontend.IAsyncConverter() { @java.lang.Override public java.lang.Object Convert(java.lang.Object source, org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery) { return source != null ? source : java.lang.Boolean.TRUE; } }; org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getConfigFromCache(new org.ovirt.engine.core.common.queries.GetConfigurationValueParameters(org.ovirt.engine.core.common.queries.ConfigurationValues.AllowClusterWithVirtGlusterEnabled, org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getDefaultConfigurationVersion()), aQuery); }
private org.ovirt.engine.core.common.vdscommands.VDSReturnValue runFenceAction(org.ovirt.engine.core.common.businessentities.FenceActionType actionType, org.ovirt.engine.core.common.businessentities.FenceAgentOrder order) { java.lang.String managementIp = getManagementIp(order); java.lang.String managementPort = getManagementPort(order); java.lang.String managementAgent = getManagementAgent(order); java.lang.String managementUser = getManagementUser(order); java.lang.String managementPassword = getManagementPassword(order); java.lang.String managementOptions = getManagementOptions(order); org.ovirt.engine.core.bll.FenceExecutor.log.infoFormat(("Executing <{0}> Power Management command, Proxy Host:{1}, " + "Agent:{2}, Target Host:{3}, Management IP:{4}, User:{5}, Options:{6}, Fencing policy:{7}"), actionType, proxyHostName, managementAgent, _vds.getName(), managementIp, managementUser, managementOptions, fencingPolicy); return org.ovirt.engine.core.bll.Backend.getInstance().getResourceManager().RunVdsCommand(VDSCommandType.FenceVds, new org.ovirt.engine.core.common.vdscommands.FenceVdsVDSCommandParameters(proxyHostId, _vds.getId(), managementIp, managementPort, managementAgent, managementUser, managementPassword, managementOptions, actionType, fencingPolicy)); }
@java.lang.Override protected void syncSearch() { if ((getEntity()) == null) { return; } org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getGlusterVolumeGeoRepStatusForMasterVolume(new org.ovirt.engine.ui.frontend.AsyncQuery(this, new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { java.util.List<org.ovirt.engine.core.common.businessentities.gluster.GlusterGeoRepSession> geoRepSessions = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.gluster.GlusterGeoRepSession>) (returnValue)); java.util.Collections.sort(geoRepSessions, new org.ovirt.engine.ui.uicommonweb.Linq.GlusterVolumeGeoRepSessionComparer()); setItems(geoRepSessions); } }), getEntity().getId()); }
private double calcDistributeMetric(org.ovirt.engine.core.bll.VDS vds, org.ovirt.engine.core.bll.VM vm) { int vcpu = org.ovirt.engine.core.common.config.Config.<java.lang.Integer>GetValue(ConfigValues.VcpuConsumptionPercentage); int spmCpu = ((vds.getspm_status()) == (VdsSpmStatus.None)) ? 0 : org.ovirt.engine.core.common.config.Config.<java.lang.Integer>GetValue(ConfigValues.SpmVCpuConsumption); int hostCores = org.ovirt.engine.core.bll.VdsSelector.getEffectiveCpuCores(vds); double hostCpu = vds.getusage_cpu_percent(); double pendingVcpus = vds.getpending_vcpus_count(); return (hostCpu / vcpu) + (((pendingVcpus + (vm.getNumOfCpus())) + spmCpu) / hostCores); }
private org.ovirt.engine.core.common.businessentities.network.IPv4Address getPrimaryAddress() { return networkDataCenterIpConfigurationDefinition.getPrimaryAddress(); }
@com.google.gwt.i18n.client.Constants.DefaultStringValue("Netmask") java.lang.String cloudInitNetworkNetmaskLabel();
public void getVmGuestAgentInterfacesByVmId(org.ovirt.engine.ui.frontend.AsyncQuery aQuery, org.ovirt.engine.core.compat.Guid vmId) { aQuery.converterCallback = new org.ovirt.engine.ui.frontend.IAsyncConverter() { @java.lang.Override public java.lang.Object Convert(java.lang.Object source, org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery) { if (source == null) { return new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VmGuestAgentInterface>(); } return source; } }; org.ovirt.engine.ui.frontend.Frontend.getInstance().runQuery(VdcQueryType.GetVmGuestAgentInterfacesByVmId, new org.ovirt.engine.core.common.queries.IdQueryParameters(vmId).withoutRefresh(), aQuery); }
@java.lang.Override public void onClick(com.google.gwt.event.dom.client.ClickEvent event) { getEntry(widget).swapButton(createButton(item)); org.ovirt.engine.core.common.utils.Pair<T, V> item = addGhostEntry(); onAdd(item.getFirst(), item.getSecond()); }
public void addOrUpdateTaskInDB(final org.ovirt.engine.core.common.businessentities.AsyncTask asyncTask) { org.ovirt.engine.core.utils.transaction.TransactionSupport.executeInScope(TransactionScopeOption.Required, new org.ovirt.engine.core.utils.transaction.TransactionMethod<java.lang.Void>() { @java.lang.Override public java.lang.Void runInTransaction() { if (!(asyncTask.getChildCmdEntity().getRootCommandId().equals(asyncTask.getChildCmdEntity().getId()))) { coco.persistCommand(asyncTask.getRootCmdEntity()); } coco.persistCommand(asyncTask.getChildCmdEntity()); org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getAsyncTaskDao().saveOrUpdate(asyncTask); return null; } }); }
void init(org.ovirt.engine.ui.frontend.server.gwt.branding.BrandingManager brandingManager) { this.brandingManager = brandingManager; }
public org.ovirt.engine.core.bll.ValidationResult canDisableVirtioScsi(java.util.Collection<? extends org.ovirt.engine.core.common.businessentities.Disk> vmDisks) { if (vmDisks == null) { vmDisks = getDiskDao().getAllForVm(vms.iterator().next().getId(), true); } boolean isVirtioScsiDiskExist = org.apache.commons.collections.CollectionUtils.exists(vmDisks, new org.apache.commons.collections.Predicate() { @java.lang.Override public boolean evaluate(java.lang.Object disk) { return (((org.ovirt.engine.core.common.businessentities.Disk) (disk)).getDiskInterface()) == (org.ovirt.engine.core.common.businessentities.DiskInterface.VirtIO_SCSI); } }); if (isVirtioScsiDiskExist) { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.VdcBllMessages.CANNOT_DISABLE_VIRTIO_SCSI_PLUGGED_DISKS); } return org.ovirt.engine.core.bll.ValidationResult.VALID; }
void clearCurrentSessionId() { clientStorage.removeLocalItem(org.ovirt.engine.ui.webadmin.plugin.restapi.RestApiSessionManager.SESSION_ID_KEY); }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("Add") java.lang.String addIscsiBond();
@java.lang.Override protected void perform() { addMemoryDisk(); addMetadataDisk(); org.ovirt.engine.core.bll.HibernateVmCommand.setSucceeded(true); }
@org.junit.Test public void frontendToBackend_twoBuilders() { new org.ovirt.engine.ui.uicommonweb.builders.BuilderExecutor<org.ovirt.engine.ui.uicommonweb.builders.TestingFrontendModel, org.ovirt.engine.ui.uicommonweb.builders.TestingBackendModel>(new org.ovirt.engine.ui.uicommonweb.builders.BackendAssert(org.ovirt.engine.ui.uicommonweb.builders.BuilderExecutorTest.fe1, org.ovirt.engine.ui.uicommonweb.builders.BuilderExecutorTest.fe2), new org.ovirt.engine.ui.uicommonweb.builders.Property1Builder(), new org.ovirt.engine.ui.uicommonweb.builders.Property2Builder()).build(frontendModel, backendModel); }
@org.junit.Test public void shouldDetectSameOs() { assertThat(new org.ovirt.engine.core.bll.scheduling.OS("os1", new org.ovirt.engine.core.compat.Version("6.3")).isSameOs(new org.ovirt.engine.core.bll.scheduling.OS("os1", new org.ovirt.engine.core.compat.Version("6.3"))), is(true)); }
private boolean validateNetworkInterfaces() { java.util.Map<java.lang.String, org.ovirt.engine.core.common.businessentities.VmNetworkInterface> interfaceNetworkMap = org.ovirt.engine.core.common.businessentities.Entities.interfacesByNetworkName(org.ovirt.engine.core.bll.RunVmCommand.getVm().getInterfaces()); java.util.Set<java.lang.String> interfaceNetworkNames = interfaceNetworkMap.keySet(); java.util.List<org.ovirt.engine.core.common.businessentities.Network> clusterNetworks = org.ovirt.engine.core.bll.RunVmCommand.getNetworkDAO().getAllForCluster(org.ovirt.engine.core.bll.RunVmCommand.getVm().getvds_group_id()); java.util.Set<java.lang.String> clusterNetworksNames = org.ovirt.engine.core.common.businessentities.Entities.objectNames(clusterNetworks); return ((isVmInterfacesConfigured(interfaceNetworkMap)) && (isVmInterfacesAttachedToClusterNetworks(clusterNetworksNames, interfaceNetworkNames))) && (isVmInterfacesAttachedToVmNetworks(clusterNetworks, interfaceNetworkNames)); }
private org.ovirt.engine.core.common.businessentities.DiskImage createNotVirtIODisk() { org.ovirt.engine.core.common.businessentities.DiskImage disk = getDiskImage(); disk.setActive(true); disk.setDiskInterface(DiskInterface.IDE); doReturn(diskDao).when(command).getDiskDao(); when(diskDao.get(diskImageGuid)).thenReturn(disk); when(osRepository.getDiskHotpluggableInterfaces(any(java.lang.Integer.class), any(org.ovirt.engine.core.compat.Version.class))).thenReturn(new java.util.HashSet<java.lang.String>(org.ovirt.engine.core.bll.HotPlugDiskToVmCommandTest.DISK_HOTPLUGGABLE_INTERFACES)); return disk; }
public boolean Validate() { getNetwork().ValidateSelectedItem(new org.ovirt.engine.ui.uicommonweb.validation.IValidation[]{ new org.ovirt.engine.ui.uicommonweb.validation.NotEmptyValidation() }); getBond().ValidateSelectedItem(new org.ovirt.engine.ui.uicommonweb.validation.IValidation[]{ new org.ovirt.engine.ui.uicommonweb.validation.NotEmptyValidation(), new org.ovirt.engine.ui.uicommonweb.validation.LengthValidation(org.ovirt.engine.core.common.businessentities.BusinessEntitiesDefinitions.HOST_NIC_NAME_LENGTH), new org.ovirt.engine.ui.uicommonweb.validation.BondNameValidation() }); getAddress().setIsValid(true); getSubnet().setIsValid(true); getGateway().setIsValid(true); if (getIsStaticAddress()) { getAddress().ValidateEntity(new org.ovirt.engine.ui.uicommonweb.validation.IValidation[]{ new org.ovirt.engine.ui.uicommonweb.validation.NotEmptyValidation(), new org.ovirt.engine.ui.uicommonweb.validation.IpAddressValidation() }); getSubnet().ValidateEntity(new org.ovirt.engine.ui.uicommonweb.validation.IValidation[]{ new org.ovirt.engine.ui.uicommonweb.validation.NotEmptyValidation(), new org.ovirt.engine.ui.uicommonweb.validation.SubnetMaskValidation() }); getGateway().ValidateEntity(new org.ovirt.engine.ui.uicommonweb.validation.IValidation[]{ new org.ovirt.engine.ui.uicommonweb.validation.NotEmptyValidation(), new org.ovirt.engine.ui.uicommonweb.validation.IpAddressValidation() }); } return ((((getBond().getIsValid()) && (getNetwork().getIsValid())) && (getAddress().getIsValid())) && (getSubnet().getIsValid())) && (getGateway().getIsValid()); }
private static void setGateway(org.ovirt.engine.core.common.businessentities.network.NetworkBootProtocol bootProtocol, org.ovirt.engine.core.vdsbroker.vdsbroker.IpInfoFetcher ipInfoFetcher, java.util.function.Consumer<java.lang.String> gatewaySetter) { if (bootProtocol == (org.ovirt.engine.core.common.businessentities.network.NetworkBootProtocol.STATIC_IP)) { java.lang.String gateway = ipInfoFetcher.fetchGateway(); if (org.apache.commons.lang.StringUtils.isNotEmpty(gateway)) { gatewaySetter.accept(gateway); } } }
public static java.util.List<java.lang.String> runAndAssertCanDoActionFailure(org.ovirt.engine.core.bll.CommandBase<?> command, org.ovirt.engine.core.dal.VdcBllMessages message) { boolean canDoAction = command.canDoAction(); java.util.List<java.lang.String> canDoActionMessages = command.getReturnValue().getCanDoActionMessages(); assertFalse("Command's canDoAction expected to fail, but succeeded", canDoAction); assertTrue(java.text.MessageFormat.format("canDoAction messages doesn''t contain expected message: {0}, messages are: {1}", message.name(), canDoActionMessages), canDoActionMessages.contains(message.name())); return canDoActionMessages; }
private org.ovirt.engine.core.bll.ValidationResult networkNotUsedByHost() { java.util.List<org.ovirt.engine.core.common.businessentities.VDS> hostsWithNetwork = org.ovirt.engine.core.bll.network.dc.UpdateNetworkCommand.getVdsDAO().getAllForNetwork(getOldNetwork().getId()); if (hostsWithNetwork.isEmpty()) { return org.ovirt.engine.core.bll.ValidationResult.VALID; } java.util.Collection<java.lang.String> replacements = org.ovirt.engine.core.utils.ReplacementUtils.replaceWithNameable("ENTITIES_USING_NETWORK", hostsWithNetwork); replacements.add(VdcBllMessages.VAR__ENTITIES__HOSTS.name()); return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.dal.VdcBllMessages.ACTION_TYPE_FAILED_NETWORK_IN_USE, replacements); }
public org.ovirt.engine.ui.uicommonweb.models.EntityModel<java.lang.Boolean> getIsRngEnabled() { return isRngEnabled; }
public void setDbGeneration(long value) { this.dbGeneration = value; }
private void updateActionAvailability() { org.ovirt.engine.core.common.businessentities.storage.Disk disk = getSelectedItem(); java.util.ArrayList<org.ovirt.engine.core.common.businessentities.storage.Disk> disks = ((getSelectedItems()) != null) ? ((java.util.ArrayList) (getSelectedItems())) : null; boolean shouldAllowEdit = true; if (disk != null) { shouldAllowEdit = (!(disk.isOvfStore())) && (!(isDiskLocked(disk))); } getNewCommand().setIsExecutionAllowed(true); getEditCommand().setIsExecutionAllowed(((((disk != null) && (disks != null)) && ((disks.size()) == 1)) && shouldAllowEdit)); getRemoveCommand().setIsExecutionAllowed((((disks != null) && ((disks.size()) > 0)) && (isRemoveCommandAvailable()))); getScanAlignmentCommand().setIsExecutionAllowed((((disks != null) && ((disks.size()) > 0)) && (isScanAlignmentCommandAvailable()))); getExportCommand().setIsExecutionAllowed(isExportCommandAvailable()); updateCopyAndMoveCommandAvailability(disks); org.ovirt.engine.ui.uicommonweb.models.quota.ChangeQuotaModel.updateChangeQuotaActionAvailability(((getItems()) != null ? ((java.util.List) (getItems())) : null), ((getSelectedItems()) != null ? ((java.util.List) (getSelectedItems())) : null), getSystemTreeSelectedItem(), getChangeQuotaCommand()); }
@java.lang.Override protected java.util.Map<java.lang.String, org.ovirt.engine.core.common.utils.Pair<java.lang.String, java.lang.String>> getExclusiveLocks() { if (((heStorageDomain) != null) && ((heStorageDomain.getId()) != null)) { return java.util.Collections.singletonMap(heStorageDomain.getId().toString(), org.ovirt.engine.core.bll.LockMessagesMatchUtil.makeLockingPair(LockingGroup.STORAGE, EngineMessage.ACTION_TYPE_FAILED_STORAGE_DEVICE_LOCKED)); } return java.util.Collections.emptyMap(); }
@java.lang.Override public void executed(org.ovirt.engine.ui.uicompat.FrontendActionAsyncResult result) { final org.ovirt.engine.ui.uicommonweb.models.vms.VmListModel<java.lang.Void> vmListModel = ((org.ovirt.engine.ui.uicommonweb.models.vms.VmListModel<java.lang.Void>) (result.getState())); org.ovirt.engine.core.common.action.VdcReturnValueBase returnValueBase = result.getReturnValue(); if ((returnValueBase != null) && (returnValueBase.getSucceeded())) { org.ovirt.engine.core.common.businessentities.VM vm = vmListModel.getcurrentVm(); org.ovirt.engine.core.common.action.VmManagementParametersBase updateVmParams = vmListModel.getUpdateVmParameters(applyCpuChangesLater); org.ovirt.engine.ui.frontend.Frontend.getInstance().runAction(VdcActionType.UpdateVm, updateVmParams, new org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModelNetworkAsyncCallback(model, defaultNetworkCreatingManager, vm.getId()), vmListModel); } else { vmListModel.getWindow().stopProgress(); } }
public java.util.Optional<org.ovirt.engine.core.common.businessentities.VM> getSnapshotUsingMac(org.ovirt.engine.core.compat.Guid macPoolId, java.lang.String mac) { java.util.List<org.ovirt.engine.core.common.businessentities.VM> allVms = getAllVmsInClusters(getIdsOfAllClustersHavingMacPool(macPoolId)).collect(java.util.stream.Collectors.toList()); java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.businessentities.VM> snapshotsById = getAllStatelessVms(allVms).map(VM::getId).map(snapshotsManager::getVmConfigurationInStatelessSnapshotOfVm).filter(java.util.Optional::isPresent).map(java.util.Optional::get).collect(java.util.stream.Collectors.toMap(VM::getId, java.util.function.Function.identity())); java.util.Optional<org.ovirt.engine.core.compat.Guid> snapshotUsingMacId = getVmIdUsingMac(snapshotsById.values().stream().flatMap(( vm) -> vm.getInterfaces().stream()), mac); return snapshotUsingMacId.map(snapshotsById::get); }
private java.util.Map<java.lang.String, java.lang.Object> parseBalloon(org.ovirt.engine.core.utils.ovf.xml.XmlDocument document, java.util.List<org.ovirt.engine.core.common.businessentities.VmDevice> devices) { org.ovirt.engine.core.common.businessentities.VmDevice dbDevice = filterDevice(devices, VmDeviceGeneralType.BALLOON); if (dbDevice == null) { return java.util.Collections.emptyMap(); } org.ovirt.engine.core.utils.ovf.xml.XmlNode node = document.selectSingleNode("//*/memballoon"); if (node == null) { return java.util.Collections.emptyMap(); } java.util.Map<java.lang.String, java.lang.Object> result = new java.util.HashMap<>(); result.put(VdsProperties.Device, "memballoon"); result.put(VdsProperties.DeviceId, dbDevice.getId().getDeviceId().toString()); result.put(VdsProperties.Address, parseAddress(node)); result.put(VdsProperties.Alias, parseAlias(node)); result.put(VdsProperties.SpecParams, dbDevice.getSpecParams()); return result; }
private void initAnchor(java.lang.String url, com.google.gwt.user.client.ui.Anchor anchor) { anchor.setHref(url); anchor.setText(constants.exportToPdf()); anchor.setTarget("_blank"); }
@java.lang.Override public java.lang.Object runInTransaction() { final org.ovirt.engine.core.common.businessentities.StorageDomainType sdType = getStorageDomain().getStorageDomainType(); map.setstatus(StorageDomainStatus.Maintenance); getStoragePoolIsoMapDAO().updateStatus(map.getId(), map.getstatus()); if (sdType == (org.ovirt.engine.core.common.businessentities.StorageDomainType.Master)) { calcStoragePoolStatusByDomainsStatus(); } if ((sdType == (org.ovirt.engine.core.common.businessentities.StorageDomainType.Data)) || (sdType == (org.ovirt.engine.core.common.businessentities.StorageDomainType.Master))) { updateStorageDomainFormat(getStorageDomain()); } return null; }
private void updateStorageTypesByDomainType(org.ovirt.engine.ui.uicommonweb.models.storage.StorageModel storageModel) { org.ovirt.engine.core.common.businessentities.StorageDomainType storageDomainType = domainFunctionListEditor.asEditor().getActualEditor().getValue(); java.util.Set<org.ovirt.engine.core.common.businessentities.storage.StorageType> filteredStorageTypes = new java.util.LinkedHashSet<>(); for (org.ovirt.engine.ui.uicommonweb.models.storage.IStorageModel currModel : storageModel.getItems()) { if ((currModel.getRole()) == storageDomainType) { filteredStorageTypes.add(currModel.getType()); } } storageModel.getAvailableStorageTypeItems().setItems(filteredStorageTypes); }
public org.ovirt.engine.core.common.businessentities.StorageDomain getStorage() { return storageDomain; }
@java.lang.Override public org.ovirt.engine.core.common.job.Job mapRow(java.sql.ResultSet rs, int rowNum) throws java.sql.SQLException { org.ovirt.engine.core.common.job.Job job = new org.ovirt.engine.core.common.job.Job(); job.setId(getGuidDefaultEmpty(rs, "job_id")); job.setActionType(org.ovirt.engine.core.common.action.VdcActionType.valueOf(rs.getString("action_type"))); job.setDescription(rs.getString("description")); job.setStatus(org.ovirt.engine.core.common.job.JobExecutionStatus.valueOf(rs.getString("status"))); job.setOwnerId(getGuid(rs, "owner_id")); job.setVisible(rs.getBoolean("visible")); job.setStartTime(org.ovirt.engine.core.dal.dbbroker.DbFacadeUtils.fromDate(rs.getTimestamp("start_time"))); job.setEndTime(org.ovirt.engine.core.dal.dbbroker.DbFacadeUtils.fromDate(rs.getTimestamp("end_time"))); job.setLastUpdateTime(org.ovirt.engine.core.dal.dbbroker.DbFacadeUtils.fromDate(rs.getTimestamp("last_update_time"))); job.setCorrelationId(rs.getString("correlation_id")); job.setExternal(rs.getBoolean("is_external")); job.setAutoCleared(rs.getBoolean("is_auto_cleared")); return job; }
public java.util.List<java.lang.String> readStrings() { java.util.List<java.lang.String> values = new java.util.ArrayList<>(); java.lang.String startingLocalName = reader.getLocalName(); java.lang.String currentLocalName = startingLocalName; while (forward()) { currentLocalName = reader.getLocalName(); if (currentLocalName.equals(startingLocalName)) { values.add(readString()); } else { skip(); } } return values; }
@java.lang.Override protected boolean canDoAction() { if (((getParameters()) == null) || ((getParameters().getQuotaId()) == null)) { addCanDoActionMessage(EngineMessage.ACTION_TYPE_FAILED_QUOTA_NOT_EXIST); return false; } org.ovirt.engine.core.common.businessentities.Quota quota = getQuota(); if (quota == null) { addCanDoActionMessage(EngineMessage.ACTION_TYPE_FAILED_QUOTA_NOT_EXIST); return false; } if ((!(QuotaEnforcementTypeEnum.DISABLED.equals(quota.getQuotaEnforcementType()))) && (getQuotaDao().isQuotaInUse(quota))) { addCanDoActionMessage(EngineMessage.ACTION_TYPE_FAILED_QUOTA_IN_USE_BY_VM_OR_DISK); return false; } return true; }
protected boolean isConnWithSameDetailsExists(org.ovirt.engine.core.common.businessentities.StorageServerConnections connection, org.ovirt.engine.core.compat.Guid storagePoolId) { java.util.List<org.ovirt.engine.core.common.businessentities.StorageServerConnections> connections = null; if ((connection.getStorageType()) == (org.ovirt.engine.core.common.businessentities.storage.StorageType.LOCALFS)) { java.util.List<org.ovirt.engine.core.common.businessentities.StorageServerConnections> connectionsForPool = (storagePoolId == null) ? java.util.Collections.<org.ovirt.engine.core.common.businessentities.StorageServerConnections>emptyList() : getStorageConnDao().getAllConnectableStorageSeverConnection(storagePoolId); java.util.List<org.ovirt.engine.core.common.businessentities.StorageServerConnections> connectionsForPath = getStorageConnDao().getAllForStorage(connection.getConnection()); connections = ((java.util.List<org.ovirt.engine.core.common.businessentities.StorageServerConnections>) (org.apache.commons.collections.CollectionUtils.intersection(connectionsForPool, connectionsForPath))); } else if (connection.getStorageType().isFileDomain()) { java.lang.String connectionField = connection.getConnection(); connections = getStorageConnDao().getAllForStorage(connectionField); } else { org.ovirt.engine.core.common.businessentities.StorageServerConnections sameConnection = findConnectionWithSameDetails(connection); connections = (sameConnection != null) ? java.util.Arrays.asList(sameConnection) : java.util.Collections.<org.ovirt.engine.core.common.businessentities.StorageServerConnections>emptyList(); } boolean isDuplicateConnExists = ((connections.size()) > 1) || (((connections.size()) == 1) && (!(connections.get(0).getId().equalsIgnoreCase(connection.getId())))); return isDuplicateConnExists; }
private static void populateModelWithIpv6Details(org.ovirt.engine.core.common.businessentities.VmInitNetwork entity, org.ovirt.engine.api.model.NicConfiguration model) { if ((entity.getIpv6BootProtocol()) != null) { model.setIpv6BootProtocol(org.ovirt.engine.api.restapi.types.Ipv6BootProtocolMapper.map(entity.getIpv6BootProtocol())); } model.setIpv6(org.ovirt.engine.api.restapi.types.InitializationMapper.createIpModel(new org.ovirt.engine.core.utils.network.vm.VmInitNetworkIpv6InfoFetcher(entity))); }
protected void bindResourceConfiguration(java.lang.Class<? extends org.ovirt.engine.ui.common.CommonApplicationConstants> constants, java.lang.Class<? extends org.ovirt.engine.ui.common.CommonApplicationMessages> messages, java.lang.Class<? extends org.ovirt.engine.ui.common.CommonApplicationResources> resources, java.lang.Class<? extends org.ovirt.engine.ui.common.CommonApplicationTemplates> templates, java.lang.Class<? extends org.ovirt.engine.ui.common.utils.DynamicMessages> dynamicMessages) { bind(org.ovirt.engine.ui.common.CommonApplicationConstants.class).to(constants).in(com.google.inject.Singleton.class); bind(org.ovirt.engine.ui.common.CommonApplicationMessages.class).to(messages).in(com.google.inject.Singleton.class); bind(org.ovirt.engine.ui.common.CommonApplicationResources.class).to(resources).in(com.google.inject.Singleton.class); bind(org.ovirt.engine.ui.common.CommonApplicationTemplates.class).to(templates).in(com.google.inject.Singleton.class); bind(org.ovirt.engine.ui.common.utils.DynamicMessages.class).to(dynamicMessages).in(com.google.inject.Singleton.class); }
@java.lang.Override public com.google.gwt.safehtml.shared.SafeHtml getTooltip(org.ovirt.engine.core.common.businessentities.VmBase vmBase) { return com.google.gwt.safehtml.shared.SafeHtmlUtils.fromString((vmBase instanceof org.ovirt.engine.core.common.businessentities.VmStatic ? org.ovirt.engine.ui.webadmin.section.main.view.tab.storage.SubTabStorageLeaseView.constants.vm() : org.ovirt.engine.ui.webadmin.section.main.view.tab.storage.SubTabStorageLeaseView.constants.template())); }
@java.lang.Override public java.lang.String getValue(org.ovirt.engine.core.common.businessentities.network.NetworkQoS object) { return (object.getInboundBurst()) == null ? constants.UnlimitedNetworkQoS() : object.getInboundBurst().toString(); }
protected org.ovirt.engine.core.bll.AddVmFromTemplateCommand<org.ovirt.engine.core.common.action.AddVmParameters> createVmFromTemplateCommand(org.ovirt.engine.core.common.businessentities.VM vm) { org.ovirt.engine.core.common.action.AddVmParameters param = new org.ovirt.engine.core.common.action.AddVmParameters(); param.setVm(vm); org.ovirt.engine.core.bll.AddVmFromTemplateCommand<org.ovirt.engine.core.common.action.AddVmParameters> concrete = new org.ovirt.engine.core.bll.AddVmFromTemplateCommand<org.ovirt.engine.core.common.action.AddVmParameters>(param) { @java.lang.Override protected void initUser() { } @java.lang.Override protected void initTemplateDisks() { } @java.lang.Override protected void initStoragePoolId() { } @java.lang.Override public org.ovirt.engine.core.common.businessentities.VmTemplate getVmTemplate() { return createVmTemplate(); } }; org.ovirt.engine.core.bll.AddVmFromTemplateCommand<org.ovirt.engine.core.common.action.AddVmParameters> result = spy(concrete); doReturn(true).when(result).checkNumberOfMonitors(); doReturn(createVmTemplate()).when(result).getVmTemplate(); doReturn(true).when(result).validateCustomProperties(any(org.ovirt.engine.core.common.businessentities.VmStatic.class), anyList()); mockDaos(result); mockBackend(result); org.ovirt.engine.core.bll.AddVmCommandTest.initCommandMethods(result); result.poolPerDc = this.macPoolPerDc; result.postConstruct(); return result; }
@java.lang.Override public org.ovirt.engine.core.common.businessentities.network.NetworkQoS flush() { super.flush(); networkQoS.setName(((java.lang.String) (getName().getEntity()))); networkQoS.setStoragePoolId(((org.ovirt.engine.core.common.businessentities.StoragePool) (getDataCenters().getSelectedItem())).getId()); return networkQoS; }
protected void createNumOfDesktopEditors() { incraseNumOfVmsEditor = new org.ovirt.engine.ui.common.widget.editor.EntityModelTextBoxOnlyEditor(); numOfVmsEditor = new org.ovirt.engine.ui.common.widget.editor.EntityModelTextBoxEditor(); }
@org.junit.Test public void shouldHandleNumMajorVersion() { final org.ovirt.engine.core.bll.scheduling.OS validOs = org.ovirt.engine.core.bll.scheduling.OS.fromPackageVersionString("Centos - 7 - release"); assertThat(validOs.isValid(), is(true)); assertThat(validOs.getVersion().getMajor(), equalTo(7)); assertThat(validOs.getVersion().getMinor(), equalTo((-1))); }
@java.lang.Override public void onSuccess(java.lang.Object target, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.models.vms.VmListModel vmListModel = ((org.ovirt.engine.ui.uicommonweb.models.vms.VmListModel) (target)); java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StoragePool> storagePools = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StoragePool>) (returnValue)); org.ovirt.engine.core.common.businessentities.StoragePool storagePool = ((storagePools.size()) > 0) ? storagePools.get(0) : null; vmListModel.postGetTemplatesNotPresentOnExportDomain(storagePool); }
@java.lang.Override public boolean performNextOperation(int completedChildCount) { if ((org.ovirt.engine.core.bll.storage.lsm.LiveMigrateDiskCommand.getParameters().getLiveDiskMigrateStage()) == (org.ovirt.engine.core.common.action.LiveMigrateDiskParameters.LiveDiskMigrateStage.IMAGE_PLACEHOLDER_CREATION)) { updateStage(LiveDiskMigrateStage.VM_REPLICATE_DISK_START); replicateDiskStart(); updateStage(LiveDiskMigrateStage.IMAGE_DATA_SYNC_EXEC_START); syncImageData(); updateStage(LiveDiskMigrateStage.IMAGE_DATA_SYNC_EXEC_END); return true; } if ((org.ovirt.engine.core.bll.storage.lsm.LiveMigrateDiskCommand.getParameters().getLiveDiskMigrateStage()) == (org.ovirt.engine.core.common.action.LiveMigrateDiskParameters.LiveDiskMigrateStage.IMAGE_DATA_SYNC_EXEC_END)) { updateStage(LiveDiskMigrateStage.VM_REPLICATE_DISK_FINISH); completeLiveMigration(); updateStage(LiveDiskMigrateStage.SOURCE_IMAGE_DELETION); org.ovirt.engine.core.bll.storage.lsm.LiveStorageMigrationHelper.removeImage(this, org.ovirt.engine.core.bll.storage.lsm.LiveMigrateDiskCommand.getParameters().getSourceStorageDomainId(), org.ovirt.engine.core.bll.storage.lsm.LiveMigrateDiskCommand.getParameters().getImageGroupID(), org.ovirt.engine.core.bll.storage.lsm.LiveMigrateDiskCommand.getParameters().getDestinationImageId(), AuditLogType.USER_MOVE_IMAGE_GROUP_FAILED_TO_DELETE_SRC_IMAGE); return false; } return false; }
public java.lang.String getProxyHost() { if (configValue.startsWith(org.ovirt.engine.ui.common.uicommon.NoVncImpl.NoVncProxyConfig.HOST)) { return getVncHost(); } else if (configValue.startsWith(org.ovirt.engine.ui.common.uicommon.NoVncImpl.NoVncProxyConfig.ENGINE)) { return com.google.gwt.user.client.Window.Location.getHostName(); } else if (matchesHostColonPort(configValue)) { return configValue.split(":")[0]; } else { throw new java.lang.IllegalArgumentException("Illegal NoVncImpl configuration."); } }
@java.lang.Override public com.google.gwt.safehtml.shared.SafeHtml getTooltip(org.ovirt.engine.core.common.businessentities.storage.Disk object) { if (object.isBoot()) { return com.google.gwt.safehtml.shared.SafeHtmlUtils.fromSafeConstant(org.ovirt.engine.ui.common.widget.uicommon.disks.DisksViewColumns.constants.bootableDisk()); } return null; }
public void onConfigureVolumeSnapshotOptions() { org.ovirt.engine.ui.uicommonweb.models.gluster.GlusterVolumeSnapshotConfigModel volumeSnapshotConfigModel = ((org.ovirt.engine.ui.uicommonweb.models.gluster.GlusterVolumeSnapshotConfigModel) (getWindow())); org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity volumeEntity = volumeSnapshotConfigModel.getSelectedVolumeEntity(); java.util.List<org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeSnapshotConfig> vdsParams = new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeSnapshotConfig>(); for (org.ovirt.engine.ui.uicommonweb.models.EntityModel<org.ovirt.engine.ui.uicommonweb.models.gluster.VolumeSnapshotOptionModel> volumeCfg : volumeSnapshotConfigModel.getConfigOptions().getItems()) { vdsParams.add(new org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeSnapshotConfig(volumeEntity.getClusterId(), volumeEntity.getId(), volumeCfg.getEntity().getOptionName(), volumeCfg.getEntity().getOptionValue())); } org.ovirt.engine.ui.frontend.Frontend.getInstance().runAction(VdcActionType.UpdateGlusterVolumeSnapshotConfig, new org.ovirt.engine.core.common.action.gluster.UpdateGlusterVolumeSnapshotConfigParameters(volumeEntity.getClusterId(), volumeEntity.getId(), vdsParams), new org.ovirt.engine.ui.uicompat.IFrontendActionAsyncCallback() { @java.lang.Override public void executed(org.ovirt.engine.ui.uicompat.FrontendActionAsyncResult result) { if (((result.getReturnValue()) != null) && (result.getReturnValue().getSucceeded())) { cancel(); } if ((getConfirmWindow()) != null) { setConfirmWindow(null); } } }, this); }
@java.lang.Override protected void logToAudit() { if (isPolicyResetMessage(org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerCommand.getReturnStatus().message)) { return; } org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase auditLogableBase = new org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase(vds.getId()); auditLogableBase.setVds(vds); auditLogableBase.addCustomValue("message", org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerCommand.getReturnStatus().message); auditLogDirector.log(auditLogableBase, AuditLogType.VDS_BROKER_COMMAND_FAILURE); }
@java.lang.Override public void save(org.ovirt.engine.core.common.businessentities.BusinessEntitySnapshot entitySnapshot) { org.ovirt.engine.core.compat.Guid id = entitySnapshot.getId(); if (org.ovirt.engine.core.compat.Guid.isNullOrEmpty(id)) { id = org.ovirt.engine.core.compat.Guid.NewGuid(); entitySnapshot.setId(id); } org.springframework.jdbc.core.namedparam.MapSqlParameterSource parameterSource = getCustomMapSqlParameterSource().addValue("id", entitySnapshot.getId()).addValue("command_id", entitySnapshot.getCommandId()).addValue("command_type", entitySnapshot.getCommandType()).addValue("entity_id", entitySnapshot.getEntityId()).addValue("entity_type", entitySnapshot.getEntityType()).addValue("entity_snapshot", entitySnapshot.getEntitySnapshot()).addValue("snapshot_class", entitySnapshot.getSnapshotClass()).addValue("snapshot_type", entitySnapshot.getSnapshotType()).addValue("insertion_order", entitySnapshot.getInsertionOrder()); getCallsHandler().executeModification("insert_entity_snapshot", parameterSource); }
public org.ovirt.engine.core.bll.validator.storage.StorageDomainToPoolRelationValidator getAttachDomainValidator() { return new org.ovirt.engine.core.bll.validator.storage.StorageDomainToPoolRelationValidator(org.ovirt.engine.core.bll.storage.AddStorageDomainCommand.getStorageDomain().getStorageStaticData(), getTargetStoragePool()); }
@java.lang.Override protected boolean canDoAction() { if (!(super.canDoAction())) { return false; } org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeSnapshotSchedule fetchedSchedule = getGlusterVolumeSnapshotScheduleDao().getByVolumeId(getGlusterVolumeId()); if (fetchedSchedule != null) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_GLUSTER_VOLUME_SNAPSHOT_ALREADY_SCHEDULED); } if (!(getParameters().getForce())) { if (((getGlusterVolumeDao().getByName(getVdsGroupId(), org.ovirt.engine.core.common.config.Config.<java.lang.String>getValue(ConfigValues.GlusterMetaVolumeName))) != null) && (getVdsGroup().isGlusterCliBasedSchedulingOn())) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_GLUSTER_CLI_SCHEDULING_ENABLED); } } return true; }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Reset All") java.lang.String resetAllVolume();
@org.junit.Test public void testMoveOrCopyMemoryDiskFails() { testMoveOrCopyForContentTypeFails(DiskContentType.MEMORY_DUMP_VOLUME); }
protected java.util.List<org.ovirt.engine.core.common.businessentities.VmDevice> getRngDevices() { return cachedRngDevices; }
@java.lang.Override protected void EndWithFailure() { setVm(null); org.ovirt.engine.core.common.businessentities.VM vmFromParams = getParameters().getVm(); if ((getVm()) != null) { org.ovirt.engine.core.bll.VmHandler.UnLockVm(getVm().getId()); for (org.ovirt.engine.core.common.businessentities.DiskImage disk : imageList) { org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getDiskImageDynamicDAO().remove(disk.getImageId()); org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getImageDao().remove(disk.getImageId()); java.util.List<org.ovirt.engine.core.common.businessentities.DiskImage> imagesForDisk = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getDiskImageDAO().getAllSnapshotsForImageGroup(disk.getId()); if ((imagesForDisk == null) || (imagesForDisk.isEmpty())) { org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getBaseDiskDao().remove(disk.getId()); } } RemoveVmNetwork(); new org.ovirt.engine.core.bll.snapshots.SnapshotsManager().removeSnapshots(getVm().getId()); org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVmDynamicDAO().remove(getVmId()); org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVmStatisticsDAO().remove(getVmId()); new org.ovirt.engine.core.bll.snapshots.SnapshotsManager().removeSnapshots(getVmId()); org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVmStaticDAO().remove(getVmId()); setSucceeded(true); } else { setVm(vmFromParams); getReturnValue().setEndActionTryAgain(false); } }
public void initStorageDomains() { if ((getModel().getDisks()) == null) { return; } org.ovirt.engine.ui.uicommonweb.models.templates.TemplateWithVersion templateWithVersion = getModel().getTemplateWithVersion().getSelectedItem(); if ((templateWithVersion != null) && (!(templateWithVersion.getTemplateVersion().getId().equals(Guid.Empty)))) { postInitStorageDomains(); } else { getModel().getStorageDomain().setItems(new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StorageDomain>()); getModel().getStorageDomain().setSelectedItem(null); getModel().getStorageDomain().setIsChangeable(false); } }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.network.VnicProfileView> convert(java.lang.Object returnValue) { this.clusterNetworks = clusterNetworks; java.util.List<org.ovirt.engine.core.common.businessentities.network.VnicProfileView> vnicProfiles = new java.util.ArrayList<>(); vnicProfiles.add(VnicProfileView.EMPTY); if (returnValue == null) { return vnicProfiles; } for (org.ovirt.engine.core.common.businessentities.network.VnicProfileView vnicProfile : ((java.util.List<org.ovirt.engine.core.common.businessentities.network.VnicProfileView>) (returnValue))) { org.ovirt.engine.core.common.businessentities.network.Network network = findNetworkById(vnicProfile.getNetworkId()); if ((network != null) && (network.isVmNetwork())) { vnicProfiles.add(vnicProfile); } } java.util.Collections.sort(vnicProfiles, new org.ovirt.engine.ui.uicommonweb.Linq.VnicProfileViewComparator()); return vnicProfiles; }
private void checkVmName(boolean isImportAsNewEntity, java.lang.String name) { cmd.getParameters().getVm().setName(name); cmd.getParameters().setImportAsNewEntity(isImportAsNewEntity); cmd.init(); java.util.Set<javax.validation.ConstraintViolation<org.ovirt.engine.core.common.action.ImportVmParameters>> validate = org.ovirt.engine.core.common.utils.ValidationUtils.getValidator().validate(cmd.getParameters(), cmd.getValidationGroups().toArray(new java.lang.Class<?>[0])); assertEquals(validate.isEmpty(), (!isImportAsNewEntity)); }
@org.junit.Test public void networkNotInUseByHosts() throws java.lang.Exception { networkNotUsedByHostsTest(ValidationResult.VALID, java.util.Collections.<org.ovirt.engine.core.common.businessentities.VDS>emptyList()); }
private boolean isSameSourceAndDest(org.ovirt.engine.core.common.action.LiveMigrateDiskParameters parameters) { org.ovirt.engine.core.common.businessentities.StorageDomain sourceDomain = getImageSourceDomain(parameters.getImageId()); if (sourceDomain.getId().equals(parameters.getStorageDomainId())) { return failCanDoAction(VdcBllMessages.ACTION_TYPE_FAILED_SOURCE_AND_TARGET_SAME); } return true; }
@java.lang.Override public void setUsePatternFly(boolean use) { super.setUsePatternFly(use); valueField.setUsePatternFly(use); valuesField.setUsePatternFly(use); }
private void migrate() { org.ovirt.engine.core.common.businessentities.VM vm = ((org.ovirt.engine.core.common.businessentities.VM) (getSelectedItem())); if (vm == null) { return; } if ((getWindow()) != null) { return; } org.ovirt.engine.ui.uicommonweb.models.vms.MigrateModel model = new org.ovirt.engine.ui.uicommonweb.models.vms.MigrateModel(); setWindow(model); model.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().migrateVirtualMachinesTitle()); model.setHelpTag(HelpTag.migrate_virtual_machine); model.setHashName("migrate_virtual_machine"); model.setVmsOnSameCluster(true); model.setIsAutoSelect(true); model.setVmList(org.ovirt.engine.ui.uicommonweb.Linq.<org.ovirt.engine.core.common.businessentities.VM>cast(getSelectedItems())); org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getUpHostListByCluster(new org.ovirt.engine.ui.frontend.AsyncQuery(this, new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object target, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.models.vms.VmListModel vmListModel = ((org.ovirt.engine.ui.uicommonweb.models.vms.VmListModel) (target)); vmListModel.postMigrateGetUpHosts(((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VDS>) (returnValue))); } }), vm.getVdsGroupName()); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Name can contain only 'A-Z', 'a-z', '0-9', '_' or '-' characters.") java.lang.String asciiNameValidationMsg();
java.util.List<org.ovirt.engine.core.common.businessentities.VM> getAllForVdsGroup(org.ovirt.engine.core.compat.Guid vds_group_id);
@org.junit.Test public void networkDoesntExist() { simulateVdsGroupExists(); assertCanDoActionFailure(EngineMessage.NETWORK_NOT_EXISTS.toString()); }
@java.lang.Override public java.lang.Object Convert(java.lang.Object source, org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery) { java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VM> vms = org.ovirt.engine.ui.uicommonweb.Linq.<org.ovirt.engine.core.common.businessentities.VM>cast(((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.IVdcQueryable>) (source))); return vms; }
public static void deserialize(com.google.gwt.user.client.rpc.SerializationStreamReader streamReader, org.ovirt.engine.core.common.queries.VdcQueryReturnValue instance) throws com.google.gwt.user.client.rpc.SerializationException { instance.setSucceeded(streamReader.readBoolean()); instance.setExceptionString(streamReader.readString()); java.lang.String type = streamReader.readString(); if (type == null) { } else if (type.equals("java.lang.String")) { instance.setReturnValue(streamReader.readString()); } else if (type.equals("java.lang.Integer")) { instance.setReturnValue(streamReader.readInt()); } else if (type.equals("java.lang.Boolean")) { instance.setReturnValue(streamReader.readBoolean()); } else if (type.equals("java.lang.Double")) { instance.setReturnValue(streamReader.readDouble()); } else if (type.equals("java.lang.Float")) { instance.setReturnValue(streamReader.readFloat()); } else if (type.equals("java.lang.Character")) { instance.setReturnValue(streamReader.readChar()); } else if (type.equals("java.lang.Short")) { instance.setReturnValue(streamReader.readShort()); } else if (type.equals("java.lang.Byte")) { instance.setReturnValue(streamReader.readByte()); } else if (type.equals("java.util.List")) { instance.setReturnValue(streamReader.readObject()); } else if (type.equals("java.util.Map")) { instance.setReturnValue(streamReader.readObject()); } else if (type.equals("java.util.Set")) { instance.setReturnValue(streamReader.readObject()); } else if (type.equals("IVdcQueryable")) { instance.setReturnValue(streamReader.readObject()); } else if (type.equals("UNKNOWN")) { instance.setReturnValue(streamReader.readObject()); } }
public void subscribe(org.ovirt.vdsm.jsonrpc.client.events.EventSubscriber subscriber) { org.ovirt.vdsm.jsonrpc.client.reactors.ReactorFactory.getWorker(this.parallelism).getPublisher().subscribe(subscriber); }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("Count") java.lang.String iopsCountLabelQosPopup();
private org.ovirt.engine.core.bll.ValidationResult networkNotUsedByHost() { java.util.List<org.ovirt.engine.core.common.businessentities.VDS> hostsWithNetwork = org.ovirt.engine.core.bll.network.dc.UpdateNetworkCommand.getVdsDAO().getAllForNetwork(getOldNetwork().getId()); if (hostsWithNetwork.isEmpty()) { return org.ovirt.engine.core.bll.ValidationResult.VALID; } return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.dal.VdcBllMessages.ACTION_TYPE_FAILED_NETWORK_IN_USE_BY_HOSTS, org.ovirt.engine.core.utils.ReplacementUtils.replaceWithNameable("HOSTS_USING_NETWORK", hostsWithNetwork)); }
@java.lang.Override public int hashCode() { return java.util.Objects.hash(super.hashCode(), sysPrepDomainName, sysPrepUserName, sysPrepPassword, vmInit, destinationVdsId, customEmulatedMachine, customCpuName, initrdUrl, kernelUrl, kernelParams, bootMenuEnabled, spiceFileTransferEnabled, spiceCopyPasteEnabled, bootSequence); }
private void parseSecondArgWithKeyValue(java.lang.String arg, java.lang.String key, java.lang.String value) { if (isSetOrMergeAction()) { engineConfigMap.setKey(key); engineConfigMap.setValue(value); } else { org.ovirt.engine.core.config.EngineConfigCLIParser.log.debug((("parseArguments error: second argument '" + arg) + "' has an '=' char but action is not 'set'.")); throw new java.lang.IllegalArgumentException((("Illegal second argument: " + arg) + ".")); } }
public void remove() { if ((getWindow()) != null) { return; } org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel model = new org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel(); setWindow(model); model.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().removeBookmarksTitle()); model.setHashName("remove_bookmark"); model.setMessage(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().bookmarsMsg()); java.util.ArrayList<java.lang.String> list = new java.util.ArrayList<java.lang.String>(); for (java.lang.Object item : getSelectedItems()) { org.ovirt.engine.core.common.businessentities.Bookmark i = ((org.ovirt.engine.core.common.businessentities.Bookmark) (item)); list.add(i.getbookmark_name()); } model.setItems(list); org.ovirt.engine.ui.uicommonweb.UICommand tempVar = new org.ovirt.engine.ui.uicommonweb.UICommand("OnRemove", this); tempVar.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().ok()); tempVar.setIsDefault(true); model.getCommands().add(tempVar); org.ovirt.engine.ui.uicommonweb.UICommand tempVar2 = new org.ovirt.engine.ui.uicommonweb.UICommand("Cancel", this); tempVar2.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().cancel()); tempVar2.setIsCancel(true); model.getCommands().add(tempVar2); }
@java.lang.Override public void setItems(java.lang.Iterable value) { if ((items) != value) { itemsChanging(value, items); items = value; getItemsChangedEvent().raise(this, EventArgs.EMPTY); onPropertyChanged(new org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs("Items")); org.ovirt.engine.ui.uicommonweb.models.userportal.UserPortalItemModel selectedItem = ((org.ovirt.engine.ui.uicommonweb.models.userportal.UserPortalItemModel) (getSelectedItem())); if (((items) != null) && (selectedItem != null)) { for (java.lang.Object object : items) { org.ovirt.engine.ui.uicommonweb.models.userportal.UserPortalItemModel itemModel = ((org.ovirt.engine.ui.uicommonweb.models.userportal.UserPortalItemModel) (object)); if (itemModel.getEntity().equals(selectedItem.getEntity())) { this.selectedItem = itemModel; break; } } } onSelectedItemChanged(); } }
@java.lang.Override public org.ovirt.engine.core.bll.ValidationResult call() { final org.ovirt.engine.core.common.businessentities.storage.CinderDisk disk = cinderDisks.iterator().next(); org.ovirt.engine.core.bll.provider.storage.OpenStackVolumeProviderProxy proxy = diskProxyMap.get(disk.getId()); java.util.List<org.ovirt.engine.core.common.businessentities.storage.CinderVolumeType> volumeTypes = proxy.getVolumeTypes(); boolean volumeTypeExists = org.apache.commons.collections.CollectionUtils.exists(volumeTypes, new org.apache.commons.collections.Predicate() { @java.lang.Override public boolean evaluate(java.lang.Object o) { return ((org.ovirt.engine.core.common.businessentities.storage.CinderVolumeType) (o)).getName().equals(disk.getCinderVolumeType()); } }); if (!volumeTypeExists) { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.CINDER_VOLUME_TYPE_NOT_EXISTS, java.lang.String.format("$cinderVolumeType %s", disk.getCinderVolumeType())); } return org.ovirt.engine.core.bll.ValidationResult.VALID; }
@java.lang.Override public java.util.List<org.ovirt.engine.core.bll.quota.QuotaConsumptionParameter> getQuotaStorageConsumptionParameters() { java.util.List<org.ovirt.engine.core.bll.quota.QuotaConsumptionParameter> list = new java.util.ArrayList<org.ovirt.engine.core.bll.quota.QuotaConsumptionParameter>(); if ((imageTemplates) != null) { for (org.ovirt.engine.core.common.businessentities.DiskImage disk : imageTemplates) { if (((disk.getQuotaId()) != null) && (!(Guid.Empty.equals(disk.getQuotaId())))) { list.add(new org.ovirt.engine.core.bll.quota.QuotaStorageConsumptionParameter(disk.getQuotaId(), null, QuotaStorageConsumptionParameter.QuotaAction.RELEASE, disk.getstorage_ids().get(0), ((double) (disk.getSizeInGigabytes())))); } } } return list; }
@org.junit.Test public void migrationNotSupported() { when(cluster.getCompatibilityVersion()).thenReturn(mock(org.ovirt.engine.core.compat.Version.class)); validator = spy(new org.ovirt.engine.core.bll.validator.ClusterValidator(dbFacade, cluster)); doReturn(false).when(validator).migrationSupportedForArch(any(org.ovirt.engine.core.common.businessentities.ArchitectureType.class)); assertThat(validator.migrationSupported(org.ovirt.engine.core.utils.RandomUtils.instance().nextEnum(org.ovirt.engine.core.common.businessentities.ArchitectureType.class)), org.ovirt.engine.core.bll.validator.ValidationResultMatchers.failsWith(EngineMessage.MIGRATION_ON_ERROR_IS_NOT_SUPPORTED)); }
private boolean isRunningConfigurationNeeded() { return ((org.ovirt.engine.core.bll.UpdateVmCommand.getVm().isNextRunConfigurationExists()) || (!(org.ovirt.engine.core.bll.VmHandler.isUpdateValid(org.ovirt.engine.core.bll.UpdateVmCommand.getVm().getStaticData(), org.ovirt.engine.core.bll.UpdateVmCommand.getParameters().getVmStaticData(), org.ovirt.engine.core.bll.UpdateVmCommand.getVm().getStatus(), isHotSetEnabled())))) || (!(org.ovirt.engine.core.bll.VmHandler.isUpdateValidForVmDevices(getVmId(), org.ovirt.engine.core.bll.UpdateVmCommand.getVm().getStatus(), org.ovirt.engine.core.bll.UpdateVmCommand.getParameters()))); }
@org.junit.Test public void testLogoffAsync_success() { java.lang.Object model = new java.lang.Object(); when(mockAsyncQuery.getModel()).thenReturn(model); org.ovirt.engine.core.common.businessentities.DbUser testUser = new org.ovirt.engine.core.common.businessentities.DbUser(); testUser.setLoginName("testUser"); frontend.logoffAsync(testUser, mockAsyncQuery); verify(mockService).logOff(eq(testUser), callbackAction.capture()); org.ovirt.engine.core.common.action.VdcReturnValueBase returnValue = new org.ovirt.engine.core.common.action.VdcReturnValueBase(); callbackAction.getValue().onSuccess(returnValue); verify(mockAsyncCallback).onSuccess(model, returnValue); verify(mockLoginHandler).onLogout(); }
@java.lang.Override protected void syncSearch() { super.syncSearch(); if (getIsQueryFirstTime()) { org.ovirt.engine.ui.frontend.Frontend.getInstance().runQuery(VdcQueryType.GetAllPolicyUnits, new org.ovirt.engine.core.common.queries.VdcQueryParametersBase(), new org.ovirt.engine.ui.uicommonweb.models.configure.scheduling.AsyncQuery(new org.ovirt.engine.ui.frontend.AsyncCallback<org.ovirt.engine.core.common.queries.VdcQueryReturnValue>() { @java.lang.Override public void onSuccess(org.ovirt.engine.core.common.queries.VdcQueryReturnValue returnValue) { java.util.ArrayList<org.ovirt.engine.core.common.scheduling.PolicyUnit> list = returnValue.getReturnValue(); setPolicyUnits(list); fetchClusterPolicies(); if ((policyUnitModel) != null) { policyUnitModel.getPolicyUnits().setItems(sort(policyUnits)); } } })); } else { fetchClusterPolicies(); } }
@java.lang.Override protected java.util.List<java.lang.Class<?>> getValidationGroups() { org.ovirt.engine.core.bll.storage.domain.AddStorageDomainCommand.addValidationGroup(org.ovirt.engine.core.common.validation.group.CreateEntity.class); return super.getValidationGroups(); }
private void refreshImageOnHost() { log.info("Refreshing volume {} on host {}", org.ovirt.engine.core.bll.MergeExtendCommand.getParameters().getBaseImage().getImageId(), org.ovirt.engine.core.bll.MergeExtendCommand.getParameters().getVdsId()); org.ovirt.engine.core.common.action.RefreshVolumeParameters parameters = new org.ovirt.engine.core.common.action.RefreshVolumeParameters(org.ovirt.engine.core.bll.MergeExtendCommand.getParameters().getVdsId(), org.ovirt.engine.core.bll.MergeExtendCommand.getParameters().getStoragePoolId(), org.ovirt.engine.core.bll.MergeExtendCommand.getParameters().getStorageDomainId(), org.ovirt.engine.core.bll.MergeExtendCommand.getParameters().getImageGroupId(), org.ovirt.engine.core.bll.MergeExtendCommand.getParameters().getBaseImage().getImageId()); parameters.setParentCommand(VdcActionType.MergeExtend); parameters.setParentParameters(org.ovirt.engine.core.bll.MergeExtendCommand.getParameters()); org.ovirt.engine.core.common.action.VdcReturnValueBase returnValue = runInternalAction(VdcActionType.RefreshVolume, parameters); setSucceeded(returnValue.getSucceeded()); if (!(org.ovirt.engine.core.bll.MergeExtendCommand.getSucceeded())) { log.error(("Error refreshing volume {} on host {}, VMs using the volume" + " should be restarted to detect the new size.")); } setCommandStatus((org.ovirt.engine.core.bll.MergeExtendCommand.getSucceeded() ? org.ovirt.engine.core.compat.CommandStatus.SUCCEEDED : org.ovirt.engine.core.compat.CommandStatus.FAILED)); }
@java.lang.Override public void edit(final org.ovirt.engine.ui.uicommonweb.models.hosts.InstallModel model) { driver.edit(model); rbPublicKey.setValue(true); model.setAuthenticationMethod(AuthenticationMethod.PublicKey); displayPassPkWindow(false); rbPassword.addValueChangeHandler(new com.google.gwt.event.logical.shared.ValueChangeHandler<java.lang.Boolean>() { @java.lang.Override public void onValueChange(com.google.gwt.event.logical.shared.ValueChangeEvent<java.lang.Boolean> event) { model.setAuthenticationMethod(AuthenticationMethod.Password); displayPassPkWindow(true); } }); rbPublicKey.addValueChangeHandler(new com.google.gwt.event.logical.shared.ValueChangeHandler<java.lang.Boolean>() { @java.lang.Override public void onValueChange(com.google.gwt.event.logical.shared.ValueChangeEvent<java.lang.Boolean> event) { model.setAuthenticationMethod(AuthenticationMethod.PublicKey); displayPassPkWindow(false); } }); userNameEditor.setEnabled(false); }
public org.ovirt.engine.core.compat.Version getGroupCompatibilityVersion() { return cachedVds.getVdsGroupCompatibilityVersion(); }
private int pinToIoThreads(org.ovirt.engine.core.common.businessentities.VmDevice vmDevice, int pinnedDriveIndex) { if ((vm.getNumOfIoThreads()) != 0) { int pinTo = (pinnedDriveIndex % (vm.getNumOfIoThreads())) + 1; pinnedDriveIndex++; vmDevice.getSpecParams().put(VdsProperties.pinToIoThread, pinTo); } return pinnedDriveIndex; }
@org.junit.Before public void setUp() throws java.lang.Exception { injectorRule.bind(org.ovirt.engine.core.bll.network.macpool.MacPoolPerCluster.class, mock(org.ovirt.engine.core.bll.network.macpool.MacPoolPerCluster.class)); existingSnapshot = createSnapshot(existingSnapshotId); existingVm = createVm(existingVmId); existingSnapshot.setVmConfiguration(org.ovirt.engine.core.bll.snapshots.SnapshotVmConfigurationHelperTest.EXISTING_VM_NAME); existingDiskImage = createDiskImage(existingImageId, existingImageGroupId); snapshotVmConfigurationHelper = spy(new org.ovirt.engine.core.bll.snapshots.SnapshotVmConfigurationHelper()); snapshotsManager = mock(org.ovirt.engine.core.bll.snapshots.SnapshotsManager.class); when(snapshotVmConfigurationHelper.getSnapshotManager()).thenReturn(snapshotsManager); setUpDaoMocks(); }
private org.ovirt.engine.core.common.businessentities.network.HostNetworkQos getDisplayedQos() { org.ovirt.engine.core.common.businessentities.network.HostNetworkQos displayedQos = null; if (networkDialogModel.getQosModel().getIsAvailable()) { displayedQos = new org.ovirt.engine.core.common.businessentities.network.HostNetworkQos(); networkDialogModel.getQosModel().flush(displayedQos); } return displayedQos; }
java.lang.String getFullPath(final java.io.File brandingRootPath, final java.lang.String path) { java.lang.String result = null; java.lang.String mergedPath = java.nio.file.FileSystems.getDefault().getPath(brandingRootPath.getAbsolutePath(), (path == null ? "" : path)).toString(); if ((path != null) && (org.ovirt.engine.core.utils.servlet.ServletUtils.isSane(mergedPath))) { result = mergedPath; } else { org.ovirt.engine.ui.frontend.server.gwt.BrandingServlet.log.error((("The path \"" + mergedPath) + "\" is not sane")); } return result; }
@java.lang.Override public void eventRaised(org.ovirt.engine.core.compat.Event ev, java.lang.Object sender, org.ovirt.engine.core.compat.EventArgs args) { getBehavior().UpdateTimeZone(); }
@java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object result) { if (result != null) { org.ovirt.engine.core.common.businessentities.VM vm = ((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (result)).getReturnValue(); if (vm == null) { return; } setVM(vm); syncSearch(); } }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("The Export Domain is inactive. Data can be retrieved only when the Domain is activated") java.lang.String theExportDomainIsInactiveMsg();
@org.junit.Before public void setup() { vdsGroup1 = createVdsGroup(); vdsGroup2 = createVdsGroup(); when(vdsGroupDao.getAll()).thenReturn(java.util.Arrays.asList(vdsGroup1, vdsGroup2)); when(rulesEnforcer.chooseNextVmToMigrate(eq(vdsGroup1))).thenReturn(vm1); when(rulesEnforcer.chooseNextVmToMigrate(eq(vdsGroup2))).thenReturn(vm2); arem.wakeup(); }
@java.lang.Override protected org.ovirt.engine.ui.uicommonweb.UICommand resolveCommand() { return sharedMacPoolModelProvider.getModel().getRemoveCommand(); }
@java.lang.Override protected void setActionMessageParameters() { addValidationMessage(EngineMessage.VAR__ACTION__UPDATE); addValidationMessage(EngineMessage.VAR__TYPE__PROVIDER); }
private org.ovirt.engine.core.bll.context.CommandContext cloneContextAndDetachFromParent() { return commandContext.clone().withoutCompensationContext().withoutExecutionContext().withoutLock(); }
private static boolean canPlugInterface(org.ovirt.engine.core.common.businessentities.network.VmNic iface) { org.ovirt.engine.core.bll.network.VmInterfaceManager vmIfaceManager = new org.ovirt.engine.core.bll.network.VmInterfaceManager(); if (vmIfaceManager.existsPluggedInterfaceWithSameMac(iface)) { vmIfaceManager.auditLogMacInUseUnplug(iface); return false; } else { return true; } }
@java.lang.Override public void OnSuccess(java.lang.Object target, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.models.storage.StorageListModel storageListModel1 = ((org.ovirt.engine.ui.uicommonweb.models.storage.StorageListModel) (target)); java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StorageDomain> domains = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StorageDomain>) (returnValue)); if (domains != null) { if (domains.isEmpty()) { PostImportFileStorage(storageListModel1.context, false, storageListModel1.storageModel, org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().thereIsNoStorageDomainUnderTheSpecifiedPathMsg()); } else { storageListModel1.ImportFileStorageAddDomain(domains); } } else { PostImportFileStorage(storageListModel1.context, false, storageListModel1.storageModel, org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().failedToRetrieveExistingStorageDomainInformationMsg()); } }
public java.lang.Boolean getIsGeoRepSlave() { return (getGeoRepMasterVolAndClusterName()) != null; }
private void storeRootPassword() { if (!(org.apache.commons.lang.StringUtils.isEmpty(params.getRootPassword()))) { metaData.put(passwordKey, params.getRootPassword()); } }
@org.junit.Test public void testGetAllForClusterFilteredWithPermissionsNoPermissionsAndNoFilter() { java.util.List<org.ovirt.engine.core.common.businessentities.Network> result = dao.getAllForCluster(cluster, org.ovirt.engine.core.dao.UNPRIVILEGED_USER_ID, false); org.ovirt.engine.core.dao.NetworkDAOTest.assertGetAllForClusterResult(result); }
@java.lang.Override public void setAffinityLabelMap(java.util.Map<java.lang.String, java.lang.String> affinityLabelMap) { }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.VmNumaNode> getAllVmNumaNodeByVdsNumaNodeId(org.ovirt.engine.core.compat.Guid vdsNumaNodeId) { org.springframework.jdbc.core.namedparam.MapSqlParameterSource parameterSource = getCustomMapSqlParameterSource().addValue("vds_numa_node_id", vdsNumaNodeId); java.util.List<org.ovirt.engine.core.common.businessentities.VmNumaNode> vmNumaNodes = getCallsHandler().executeReadList("GetVmNumaNodeByVdsNumaNodeId", org.ovirt.engine.core.dao.VmNumaNodeDaoImpl.vmNumaNodeRowMapper, parameterSource); java.util.Map<org.ovirt.engine.core.compat.Guid, java.util.List<java.lang.Integer>> numaNodesCpusMap = getAllNumaNodeCpuMap(); java.util.Map<org.ovirt.engine.core.compat.Guid, java.util.List<org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.utils.Pair<java.lang.Boolean, java.lang.Integer>>>> vmNumaNodesPinMap = getAllVmNumaNodePinInfo(); for (org.ovirt.engine.core.common.businessentities.VmNumaNode node : vmNumaNodes) { if (numaNodesCpusMap.containsKey(node.getId())) { node.setCpuIds(numaNodesCpusMap.get(node.getId())); } if (vmNumaNodesPinMap.containsKey(node.getId())) { node.setVdsNumaNodeList(vmNumaNodesPinMap.get(node.getId())); } } return vmNumaNodes; }
@java.lang.Override public javax.ws.rs.core.Response doImport(org.ovirt.engine.api.model.Action action) { validateParameters(action, "cluster.id|name", "storageDomain.id|name"); org.ovirt.engine.core.compat.Guid destStorageDomainId = getDestStorageDomainId(action); org.ovirt.engine.core.common.action.ImportVmParameters params = new org.ovirt.engine.core.common.action.ImportVmParameters(getEntity(), parent.getStorageDomainId(), destStorageDomainId, parent.getDataCenterId(destStorageDomainId), getClusterId(action)); params.setImageToDestinationDomainMap(getDiskToDestinationMap(action)); params.setForceOverride((action.isSetExclusive() ? action.isExclusive() : false)); boolean collapseSnapshots = org.ovirt.engine.api.common.util.QueryHelper.getBooleanMatrixParameter(uriInfo, org.ovirt.engine.api.restapi.resource.BackendStorageDomainVmResource.COLLAPSE_SNAPSHOTS, true, false); if (collapseSnapshots) { params.setCopyCollapse(collapseSnapshots); } if (action.isSetClone()) { params.setImportAsNewEntity(action.isClone()); if ((action.isSetVm()) && (action.getVm().isSetName())) { params.getVm().setName(action.getVm().getName()); } } return doAction(VdcActionType.ImportVm, params, action); }
@org.junit.Test public void encodeDecodeWithNonAsciiDiskAlias() throws java.lang.Exception { disk.setDiskAlias(""); disk.setDiskDescription("DiskDescription"); assertDiskDescriptionMap(disk, org.ovirt.engine.core.bll.storage.disk.image.MetadataDiskDescriptionHandlerTest.generateDiskAliasJsonEntry(org.ovirt.engine.core.bll.storage.disk.image.MetadataDiskDescriptionHandlerTest.encodeString("")), org.ovirt.engine.core.bll.storage.disk.image.MetadataDiskDescriptionHandlerTest.generateDiskDescriptionJsonEntry("DiskDescription"), org.ovirt.engine.core.bll.storage.disk.image.MetadataDiskDescriptionHandlerTest.generateEncodingJsonEntry(1)); org.ovirt.engine.core.bll.storage.disk.image.MetadataDiskDescriptionHandlerTest.assertDiskDescriptionDecoding(disk); }
private org.ovirt.engine.core.compat.Guid getStoragePoolId() { org.ovirt.engine.core.compat.Guid result = null; org.ovirt.engine.core.common.queries.GetVmTemplateParameters params = org.ovirt.engine.core.bll.GetVmTemplateQuery.getParameters(); if ((params.getDataCenterId()) != null) { result = params.getDataCenterId(); } else if ((params.getClusterId()) != null) { org.ovirt.engine.core.common.businessentities.VDSGroup vdsGroup = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVdsGroupDao().get(params.getClusterId()); if (vdsGroup != null) { result = vdsGroup.getStoragePoolId(); } } return result; }
private void UpdateExternalHostModels() { boolean enabled = ((java.lang.Boolean) (getExternalHostProviderEnabled().getEntity())); if (enabled && ((getProviders().getItems()) == null)) { org.ovirt.engine.ui.frontend.AsyncQuery getProvidersQuery = new org.ovirt.engine.ui.frontend.AsyncQuery(); getProvidersQuery.asyncCallback = new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object result) { java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Provider> providers = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Provider>) (result)); org.ovirt.engine.ui.uicommonweb.models.ListModel providersListModel = getProviders(); providers.add(0, null); providersListModel.setItems(providers); providersListModel.setIsChangable(true); } }; org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.GetAllProvidersByType(getProvidersQuery, ProviderType.FOREMAN); } else { getProviders().setIsChangable(enabled); getProviders().setSelectedItem(null); } }
public boolean isFastForwarding() { return (rateCycle[currentRate]) != (org.ovirt.engine.ui.uicommonweb.models.GridTimer.RATE.NORMAL); }
@java.lang.Override protected void setActionMessageParameters() { addCanDoActionMessage(EngineMessage.VAR__ACTION__ATTACH); addCanDoActionMessage(EngineMessage.VAR__TYPE__STORAGE__CONNECTION); }
protected boolean performImagesChecks() { java.util.List<org.ovirt.engine.core.common.businessentities.storage.DiskImage> diskImagesToCheck = org.ovirt.engine.core.bll.storage.disk.image.DisksFilter.filterImageDisks(getImagesList(), org.ovirt.engine.core.bll.snapshots.ONLY_NOT_SHAREABLE, org.ovirt.engine.core.bll.snapshots.ONLY_ACTIVE); org.ovirt.engine.core.bll.validator.storage.DiskImagesValidator diskImagesValidator = new org.ovirt.engine.core.bll.validator.storage.DiskImagesValidator(diskImagesToCheck); return validate(diskImagesValidator.diskImagesNotLocked()); }
@java.lang.Override public void render(org.ovirt.engine.ui.webadmin.widget.table.column.Context context, org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity object, com.google.gwt.safehtml.shared.SafeHtmlBuilder sb) { org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeAdvancedDetails advancedDetails = object.getAdvancedDetails(); org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeSizeInfo sizeInfo = null; if (advancedDetails != null) { sizeInfo = advancedDetails.getCapacityInfo(); if (sizeInfo != null) { setFreeSize(sizeInfo.getFreeSize().doubleValue()); setTotalSize(sizeInfo.getTotalSize().doubleValue()); setUsedSize(sizeInfo.getUsedSize().doubleValue()); setInUnit(SizeUnit.BYTES); } } super.render(context, (advancedDetails == null ? null : sizeInfo == null ? null : object), sb); }
@java.lang.Override protected void syncSearch() { org.ovirt.engine.ui.frontend.AsyncQuery asyncQuery = new org.ovirt.engine.ui.frontend.AsyncQuery(); asyncQuery.setModel(this); asyncQuery.asyncCallback = new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object ret) { java.util.ArrayList<org.ovirt.engine.core.common.businessentities.IscsiBond> items = ((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (ret)).getReturnValue(); org.ovirt.engine.ui.uicommonweb.models.SearchableListModel dataCenterIscsiBondListModel = ((org.ovirt.engine.ui.uicommonweb.models.SearchableListModel) (model)); dataCenterIscsiBondListModel.setItems(items); } }; org.ovirt.engine.core.common.queries.IdQueryParameters params = new org.ovirt.engine.core.common.queries.IdQueryParameters(getEntity().getId()); params.setRefresh(getIsQueryFirstTime()); org.ovirt.engine.ui.frontend.Frontend.getInstance().runQuery(VdcQueryType.GetIscsiBondsByStoragePoolId, params, asyncQuery); }
@org.junit.Test public void testRemove() { org.ovirt.engine.core.common.businessentities.Network result = dao.getByName(existing_net_name); assertNotNull(result); dao.remove(result.getId()); result = dao.getByName(existing_net_name); assertNull(result); }
private void updatePassDiscardChangeabilityForDirectLun() { if (((getSanStorageModelBase()) != null) && ((getSanStorageModelBase().getAddedLuns()) != null)) { if (getSanStorageModelBase().getAddedLuns().isEmpty()) { getPassDiscard().setIsChangeable(false, null); } else { getPassDiscard().setIsChangeable(isLunSupportDiscard(getSanStorageModelBase().getAddedLuns().get(0).getEntity()), org.ovirt.engine.ui.uicommonweb.models.vms.AbstractDiskModel.constants.discardIsNotSupportedByUnderlyingStorage()); if (!(getPassDiscard().getIsChangable())) { getPassDiscard().setEntity(false); } } } else if ((getLunDisk()) != null) { getPassDiscard().setIsChangeable(isLunSupportDiscard(getLunDisk().getLun()), org.ovirt.engine.ui.uicommonweb.models.vms.AbstractDiskModel.constants.discardIsNotSupportedByUnderlyingStorage()); } }
private org.ovirt.engine.core.common.action.ColdMergeCommandParameters buildColdMergeParameters(org.ovirt.engine.core.common.businessentities.storage.DiskImage baseVolume, org.ovirt.engine.core.common.businessentities.storage.DiskImage topVolume) { org.ovirt.engine.core.common.businessentities.SubchainInfo subchainInfo = new org.ovirt.engine.core.common.businessentities.SubchainInfo(org.ovirt.engine.core.bll.snapshots.ColdMergeSnapshotSingleDiskCommand.getDiskImage().getStorageIds().get(0), baseVolume, topVolume); org.ovirt.engine.core.common.action.ColdMergeCommandParameters parameters = new org.ovirt.engine.core.common.action.ColdMergeCommandParameters(org.ovirt.engine.core.bll.snapshots.ColdMergeSnapshotSingleDiskCommand.getDiskImage().getStoragePoolId(), subchainInfo); parameters.setEndProcedure(VdcActionParametersBase.EndProcedure.COMMAND_MANAGED); parameters.setParentCommand(org.ovirt.engine.core.bll.snapshots.ColdMergeSnapshotSingleDiskCommand.getActionType()); parameters.setParentParameters(org.ovirt.engine.core.bll.snapshots.ColdMergeSnapshotSingleDiskCommand.getParameters()); return parameters; }
@java.lang.Override protected void initTemplateDisks(java.util.List<org.ovirt.engine.core.common.businessentities.storage.DiskImage> disks) { adjustInstanceImages(disks.isEmpty()); super.initTemplateDisks(disks); }
private void addLabels(org.ovirt.engine.core.common.businessentities.network.HostNicVfsConfig newConfig) { java.util.Set<java.lang.String> labels = new java.util.HashSet<>(); labels.add("lbl1"); labels.add("lbl2"); labels.add("lbl3"); labels.add("lbl4"); newConfig.setNetworkLabels(labels); }
protected void getNics(final org.ovirt.engine.ui.frontend.AsyncQuery getNicsQuery, final org.ovirt.engine.core.compat.Guid vmId, final org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel unitVmModel) { org.ovirt.engine.ui.frontend.AsyncQuery osInfoQuery = new org.ovirt.engine.ui.frontend.AsyncQuery(new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { defaultType = org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getDefaultNicType(((java.util.Collection<org.ovirt.engine.core.common.businessentities.network.VmInterfaceType>) (returnValue))); supportedInterfaceTypes = ((java.util.Collection<org.ovirt.engine.core.common.businessentities.network.VmInterfaceType>) (returnValue)); org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getVmNicList(getNicsQuery, vmId); } }); org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getNicTypeList(unitVmModel.getOSType().getSelectedItem(), unitVmModel.getDataCenterWithClustersList().getSelectedItem().getCluster().getcompatibility_version(), osInfoQuery); }
private static java.net.HttpURLConnection create(java.net.URL url) throws java.io.IOException, java.security.GeneralSecurityException { return new org.ovirt.engine.core.uutils.net.HttpURLConnectionBuilder(url).setHttpsProtocol(org.ovirt.engine.core.utils.EngineLocalConfig.getInstance().getProperty("ENGINE_SSO_SERVICE_SSL_PROTOCOL")).setReadTimeout(0).setTrustManagerAlgorithm(javax.net.ssl.TrustManagerFactory.getDefaultAlgorithm()).setTrustStore(org.ovirt.engine.core.utils.EngineLocalConfig.getInstance().getProperty("ENGINE_HTTPS_PKI_TRUST_STORE")).setTrustStorePassword(org.ovirt.engine.core.utils.EngineLocalConfig.getInstance().getProperty("ENGINE_HTTPS_PKI_TRUST_STORE_PASSWORD")).setTrustStoreType(org.ovirt.engine.core.utils.EngineLocalConfig.getInstance().getProperty("ENGINE_HTTPS_PKI_TRUST_STORE_TYPE")).setURL(url).setVerifyChain(org.ovirt.engine.core.utils.EngineLocalConfig.getInstance().getBoolean("ENGINE_SSO_SERVICE_SSL_VERIFY_CHAIN")).setVerifyHost(org.ovirt.engine.core.utils.EngineLocalConfig.getInstance().getBoolean("ENGINE_SSO_SERVICE_SSL_VERIFY_HOST")).create(); }
public java.util.List<java.lang.String> getServiceList() { return serviceList; }
private void setVmWatchdogToParams(final org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel model, org.ovirt.engine.core.common.action.VmTemplateParametersBase updateVmParams) { org.ovirt.engine.core.common.businessentities.VmWatchdogType wdModel = model.getWatchdogModel().getSelectedItem(); updateVmParams.setUpdateWatchdog(true); if (wdModel != null) { org.ovirt.engine.core.common.businessentities.VmWatchdog vmWatchdog = new org.ovirt.engine.core.common.businessentities.VmWatchdog(); vmWatchdog.setAction(model.getWatchdogAction().getSelectedItem()); vmWatchdog.setModel(wdModel); updateVmParams.setWatchdog(vmWatchdog); } }
@org.junit.Before public void setUp() throws java.lang.Exception { org.ovirt.engine.ui.frontend.Frontend.setAppErrorsTranslator(mockCanDoActionErrorsTranslator); org.ovirt.engine.ui.frontend.Frontend.setVdsmErrorsTranslator(mockVdsmErrorsTranslator); Frontend.QueryCompleteEvent = queryCompleteEvent; Frontend.QueryStartedEvent = queryStartEvent; Frontend.frontendFailureEvent = mockFrontendFailureEvent; Frontend.frontendNotLoggedInEvent = mockFrontendNotLoggedInEvent; org.ovirt.engine.ui.frontend.Frontend.Subscribe(new org.ovirt.engine.core.common.queries.VdcQueryType[]{ org.ovirt.engine.core.common.queries.VdcQueryType.Search }); org.ovirt.engine.ui.frontend.Frontend.setEventsHandler(mockEventsHandler); Frontend.constants = mockConstants; when(mockAsyncQuery.getContext()).thenReturn("test"); when(mockAsyncQuery.getDel()).thenReturn(mockAsyncCallback); }
@java.lang.Override protected void readOsSection(XmlNode section) { _vmTemplate.setId(new org.ovirt.engine.core.compat.Guid(section.Attributes.get("ovf:id").getValue())); XmlNode node = section.SelectSingleNode("Description"); if (node != null) { _vmTemplate.setOs(org.ovirt.engine.core.common.businessentities.VmOsType.valueOf(node.InnerText)); } else { _vmTemplate.setOs(VmOsType.Unassigned); } }
public org.ovirt.engine.core.common.businessentities.NonOperationalReason getNonOperationalReason() { return vdsDynamic.getNonOperationalReason(); }
@org.junit.experimental.theories.Theory public void lastVmListNotIncludingExternalVm(org.ovirt.engine.core.vdsbroker.monitoring.VmTestPairs data) { stubCalls(data); assertTrue(vmsListFetcher.fetch()); assumeTrue(((data.vdsmVm()) != null)); assumeTrue(((data.dbVm()) != null)); verify(vdsManager).setLastVmsList(vdsManagerArgumentCaptor.capture()); assertEquals(data.vdsmVm().getVmDynamic(), vdsManagerArgumentCaptor.getValue().get(0)); }
void setDomainMap(java.util.Map<java.lang.String, java.lang.String> domainMap);
private void multipleDecoratorsUsesSameLock(org.ovirt.engine.core.bll.network.macpool.MacPoolDecorator... decorators) { org.ovirt.engine.core.bll.network.macpool.DecoratedMacPoolFactory factory = new org.ovirt.engine.core.bll.network.macpool.DecoratedMacPoolFactory(lockedObjectFactory); java.util.Arrays.stream(decorators).forEach(( decorator) -> factory.createDecoratedPool(poolId, macPool, singletonList(decorator))); org.mockito.ArgumentCaptor<java.util.concurrent.locks.ReentrantReadWriteLock> captor = org.mockito.ArgumentCaptor.forClass(java.util.concurrent.locks.ReentrantReadWriteLock.class); verify(lockedObjectFactory, times(2)).createLockingInstance(eq(macPool), eq(org.ovirt.engine.core.bll.network.macpool.MacPool.class), captor.capture()); assertThat(captor.getAllValues().stream().distinct().count(), is(1L)); }
@java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { java.lang.String mountPoint = ((getDefaultMountFolder().getEntity()) + "/") + (getLvName().getEntity()); getMountPoint().setEntity(mountPoint); }
private void init() { setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().editLogicalNetworkTitle()); setHelpTag(HelpTag.edit_logical_network); setHashName("edit_logical_network"); getName().setEntity(getNetwork().getName()); getDescription().setEntity(getNetwork().getDescription()); getComment().setEntity(getNetwork().getComment()); getIsStpEnabled().setEntity(getNetwork().getStp()); getHasVLanTag().setEntity(((getNetwork().getVlanId()) != null)); getVLanTag().setEntity(getNetwork().getVlanId()); initMtu(); initIsVm(); getExternal().setEntity(getNetwork().isExternal()); getExternal().setIsChangeable(false); getExternalProviders().setIsChangeable(false); getConnectedToPhysicalNetwork().setEntity(isConnectedToPhysicalNetwork()); getConnectedToPhysicalNetwork().setIsChangeable(false); getUsePhysicalNetworkFromDatacenter().setIsChangeable(false); getUsePhysicalNetworkFromCustom().setIsChangeable(false); getDatacenterPhysicalNetwork().setIsChangeable(false); if (isConnectedToPhysicalNetwork()) { if (getNetwork().getProvidedBy().isSetPhysicalNetworkId()) { getUsePhysicalNetworkFromDatacenter().setEntity(true); } else { getUsePhysicalNetworkFromCustom().setEntity(true); getCustomPhysicalNetwork().setEntity(getNetwork().getLabel()); } } else { getNetworkLabel().setSelectedItem(getNetwork().getLabel()); } toggleProfilesAvailability(); }
@java.lang.Override public void onSuccess(java.lang.Object target, java.lang.Object returnValue) { boolean isNameUnique = ((java.lang.Boolean) (returnValue)); if (model.getBehavior().isExistingTemplateBehavior()) { selectedItem = ((org.ovirt.engine.ui.uicommonweb.models.vms.TemplateVmModelBehavior) (model.getBehavior())).getVmTemplate(); } else { selectedItem = ((org.ovirt.engine.ui.uicommonweb.models.templates.ExistingBlankTemplateModelBehavior) (model.getBehavior())).getVmTemplate(); } if ((!isNameUnique) && ((name.compareToIgnoreCase(selectedItem.getName())) != 0)) { model.getName().getInvalidityReasons().add(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().nameMustBeUniqueInvalidReason()); model.getName().setIsValid(false); model.setValidTab(TabName.GENERAL_TAB, false); return; } java.lang.String selectedCpu = model.getCustomCpu().getSelectedItem(); if (((selectedCpu != null) && (!(selectedCpu.isEmpty()))) && (!(model.getCustomCpu().getItems().contains(selectedCpu)))) { org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel confirmModel = new org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel(); confirmModel.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().vmUnsupportedCpuTitle()); confirmModel.setMessage(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().vmUnsupportedCpuMessage()); confirmModel.setHelpTag(HelpTag.edit_unsupported_cpu); confirmModel.setHashName("edit_unsupported_cpu"); confirmModel.getCommands().add(new org.ovirt.engine.ui.uicommonweb.UICommand("postNameUniqueCheck", this).setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().ok()).setIsDefault(true)); confirmModel.getCommands().add(org.ovirt.engine.ui.uicommonweb.UICommand.createCancelUiCommand("CancelConfirmation", this)); setConfirmWindow(confirmModel); } }
org.ovirt.engine.core.vdsbroker.gluster.GlusterVolumeTaskReturnForXmlRpc glusterVolumeRebalanceStatus(java.lang.String volumeName);
private void initializeGeoRepActionConfirmation(java.lang.String title, org.ovirt.engine.ui.uicommonweb.help.HelpTag helpTag, java.lang.String hashName, java.lang.String forceHelp, java.lang.String forceLabelText, java.lang.String commandName, java.lang.String masterVolumeName, java.lang.String slaveVolumeName, java.lang.String slaveHostName, java.lang.String message) { org.ovirt.engine.ui.uicommonweb.models.gluster.GlusterVolumeGeoRepActionConfirmationModel cModel; if ((getWindow()) != null) { if ((getWindow()) instanceof org.ovirt.engine.ui.uicommonweb.models.gluster.GlusterVolumeGeoRepActionConfirmationModel) { cModel = ((org.ovirt.engine.ui.uicommonweb.models.gluster.GlusterVolumeGeoRepActionConfirmationModel) (getWindow())); } else { return; } } else { cModel = new org.ovirt.engine.ui.uicommonweb.models.gluster.GlusterVolumeGeoRepActionConfirmationModel(); cModel.setTitle(title); } cModel.setHelpTag(helpTag); cModel.setHashName(hashName); setWindow(cModel); cModel.initWindow(masterVolumeName, slaveVolumeName, slaveHostName); cModel.setActionConfirmationMessage(message); cModel.setForceHelp(forceHelp); cModel.setForceLabel(forceLabelText); java.util.List<org.ovirt.engine.ui.uicommonweb.UICommand> geoRepActionCommands = java.util.Arrays.asList(org.ovirt.engine.ui.uicommonweb.UICommand.createDefaultOkUiCommand(commandName, this), org.ovirt.engine.ui.uicommonweb.UICommand.createCancelUiCommand("closeWindow", this)); if ((cModel.getCommands().size()) > 0) { cModel.setCommands(geoRepActionCommands); } else { cModel.getCommands().addAll(geoRepActionCommands); } }
protected void init() { org.ovirt.engine.core.bll.TagsDirector.log.info(("Start initializing " + (getClass().getSimpleName()))); tagsMapByID.clear(); tagsMapByName.clear(); org.ovirt.engine.core.common.businessentities.tags root = new org.ovirt.engine.core.common.businessentities.tags("root", null, true, org.ovirt.engine.core.bll.TagsDirector.ROOT_TAG_ID, "root"); AddTagToHash(root); AddChildren(root); org.ovirt.engine.core.bll.TagsDirector.log.info(("Finished initializing " + (getClass().getSimpleName()))); }
@java.lang.Override public int hashCode() { final int prime = 31; int result = 1; result = (prime * result) + ((correlationId) == null ? 0 : correlationId.hashCode()); result = (prime * result) + ((description) == null ? 0 : description.hashCode()); result = (prime * result) + ((endTime) == null ? 0 : endTime.hashCode()); result = (prime * result) + ((externalSystem) == null ? 0 : externalSystem.hashCode()); result = (prime * result) + ((id) == null ? 0 : id.hashCode()); result = (prime * result) + ((jobId) == null ? 0 : jobId.hashCode()); result = (prime * result) + ((parentStepId) == null ? 0 : parentStepId.hashCode()); result = (prime * result) + ((startTime) == null ? 0 : startTime.hashCode()); result = (prime * result) + ((status) == null ? 0 : status.hashCode()); result = (prime * result) + (stepNumber); result = (prime * result) + ((stepType) == null ? 0 : stepType.hashCode()); result = (prime * result) + ((steps) == null ? 0 : steps.hashCode()); result = (prime * result) + (external ? 1231 : 1237); return result; }
@java.lang.Override protected java.util.Map<java.lang.String, java.lang.Object> constructStringAttributes() { java.util.Map<java.lang.String, java.lang.Object> attributes = super.constructStringAttributes(); attributes.put("baseInterface", getBaseInterface()); attributes.put("vlanId", getVlanId()); return attributes; }
@java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { if (!(getShowEligibleVolumes().getEntity())) { getVolumesForForceSessionCreate(); } else { getEligibleVolumes(); setRecommendationViolations(null); } }
@org.ovirt.engine.ui.frontend.DefaultStringValue("Cannot switch Host to Maintenance mode.\nHost still has running VMs on it and is in Non-Responsive state.") java.lang.String VDS_CANNOT_MAINTENANCE_VDS_IS_NOT_RESPONDING_WITH_VMS();
@java.lang.Override protected org.ovirt.engine.api.model.NIC doPopulate(org.ovirt.engine.api.model.NIC model, org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface entity) { return model; }
@java.lang.SuppressWarnings("ConstantConditions") private org.ovirt.engine.core.common.businessentities.network.IPv4Address getIpv4PrimaryAddress() { return getIpConfigurationOfNetworkAttachment().getIpv4PrimaryAddress(); }
private java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.compat.Guid> mapDisks(org.ovirt.engine.api.model.DiskAttachments diskAttachments) { java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.compat.Guid> diskToImageIds = null; if (diskAttachments.isSetDiskAttachments()) { diskToImageIds = diskAttachments.getDiskAttachments().stream().map(DiskAttachment::getDisk).filter(java.util.Objects::nonNull).map(( disk) -> ((org.ovirt.engine.core.common.businessentities.storage.DiskImage) (org.ovirt.engine.api.restapi.types.DiskMapper.map(disk, null)))).collect(java.util.stream.Collectors.toMap(BaseDisk::getId, DiskImage::getImageId)); } return diskToImageIds; }
public static void addVmInitToDB(org.ovirt.engine.core.common.businessentities.VmBase vm) { if ((vm.getVmInit()) != null) { vm.getVmInit().setId(vm.getId()); org.ovirt.engine.core.dao.VmInitDAO db = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVmInitDao(); org.ovirt.engine.core.common.businessentities.VmInit oldVmInit = db.get(vm.getId()); if (oldVmInit == null) { db.save(vm.getVmInit()); } else { if (vm.getVmInit().isPasswordAlreadyStored()) { vm.getVmInit().setRootPassword(oldVmInit.getRootPassword()); } db.update(vm.getVmInit()); } } }
public void setHighlyAvailableGlobalMaintenance(boolean value) { vdsStatistics.setHighlyAvailableGlobalMaintenance(value); }
@java.lang.Override protected void executeVdsBrokerCommand() { if (isRefreshStoragePool()) { refreshStoragePool(); } else { connectStoragePool(); } proceedProxyReturnValue(); }
@java.lang.Override public boolean eval(org.ovirt.engine.core.common.businessentities.VDS p) { return (p.getvm_count()) < (vmCountTemp * (org.ovirt.engine.core.bll.VdsSelector.getEffectiveCpuCores(p))); }
public static org.ovirt.engine.core.compat.Guid createTask(org.ovirt.engine.core.compat.Guid taskId, org.ovirt.engine.core.bll.CommandBase command, org.ovirt.engine.core.common.asynctasks.AsyncTaskCreationInfo asyncTaskCreationInfo, org.ovirt.engine.core.common.action.VdcActionType parentCommand, java.lang.String description, java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.VdcObjectType> entitiesMap) { return org.ovirt.engine.core.bll.tasks.TaskManagerUtil.coco.createTask(taskId, command, asyncTaskCreationInfo, parentCommand, description, entitiesMap); }
@org.ovirt.engine.api.restapi.types.Mapping(from = org.ovirt.engine.api.model.RngSources.class, to = VmRngDevice.Source.class) public static java.util.List<org.ovirt.engine.core.common.businessentities.VmRngDevice.Source> mapRngSources(org.ovirt.engine.api.model.RngSources model, java.util.List<org.ovirt.engine.core.common.businessentities.VmRngDevice.Source> template) { if ((model.getRngSources()) != null) { java.util.List<org.ovirt.engine.core.common.businessentities.VmRngDevice.Source> result = new java.util.ArrayList<>(); for (java.lang.String sourceString : model.getRngSources()) { try { org.ovirt.engine.api.model.RngSource source = org.ovirt.engine.api.model.RngSource.fromValue(sourceString); result.add(org.ovirt.engine.api.restapi.types.RngDeviceMapper.map(source, null)); } catch (java.lang.IllegalArgumentException iae) { } } return result; } return null; }
@java.lang.Override protected java.util.Map<java.lang.String, org.ovirt.engine.core.common.utils.Pair<java.lang.String, java.lang.String>> getExclusiveLocks() { return java.util.Collections.singletonMap(org.ovirt.engine.core.bll.storage.AttachStorageDomainToPoolCommand.getParameters().getStorageDomainId().toString(), org.ovirt.engine.core.bll.LockMessagesMatchUtil.makeLockingPair(LockingGroup.STORAGE, VdcBllMessages.ACTION_TYPE_FAILED_OBJECT_LOCKED)); }
@java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object result) { org.ovirt.engine.ui.uicommonweb.models.gluster.VolumeModel volumeModel = ((org.ovirt.engine.ui.uicommonweb.models.gluster.VolumeModel) (model)); java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VDSGroup> clusters = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VDSGroup>) (result)); org.ovirt.engine.core.common.businessentities.VDSGroup oldCluster = volumeModel.getCluster().getSelectedItem(); org.ovirt.engine.core.common.businessentities.StoragePool selectedDataCenter = getDataCenter().getSelectedItem(); java.util.Iterator<org.ovirt.engine.core.common.businessentities.VDSGroup> iterator = clusters.iterator(); while (iterator.hasNext()) { if (!(iterator.next().supportsGlusterService())) { iterator.remove(); } } if ((clusters.isEmpty()) || (((clusters.size()) > 0) && (clusters.get(0).getStoragePoolId().equals(selectedDataCenter.getId())))) { volumeModel.getCluster().setItems(clusters); if (oldCluster != null) { org.ovirt.engine.core.common.businessentities.VDSGroup newSelectedItem = org.ovirt.engine.ui.uicommonweb.Linq.firstOrNull(clusters, new org.ovirt.engine.ui.uicommonweb.Linq.IdPredicate<>(oldCluster.getId())); if (newSelectedItem != null) { volumeModel.getCluster().setSelectedItem(newSelectedItem); } } if ((volumeModel.getCluster().getSelectedItem()) == null) { volumeModel.getCluster().setSelectedItem(org.ovirt.engine.ui.uicommonweb.Linq.firstOrNull(clusters)); } } }
@org.junit.Test public void testDeleteAllUnusedIcons() { reinitializeDatabase(); prepareDao().removeAllUnusedIcons(); final org.ovirt.engine.core.common.businessentities.VmIcon unusedIcon = prepareDao().get(org.ovirt.engine.core.dao.VmIconDaoTest.UNUSED_ICON_ID); assertNull(unusedIcon); final org.ovirt.engine.core.common.businessentities.VmIcon usedIcon = prepareDao().get(org.ovirt.engine.core.dao.VmIconDaoTest.OTHER_SMALL_ICON_ID); assertNotNull(usedIcon); reinitializeDatabase(); }
protected void initVdss() { setVdsIdRef(org.ovirt.engine.core.bll.MigrateVmCommand.getVm().getRunOnVds()); org.ovirt.engine.core.compat.Guid vdsToRunOn = org.ovirt.engine.core.bll.scheduling.SchedulingManager.getInstance().schedule(org.ovirt.engine.core.bll.MigrateVmCommand.getVdsGroup(), org.ovirt.engine.core.bll.MigrateVmCommand.getVm(), getVdsBlackList(), getVdsWhiteList(), getDestinationVdsId(), new java.util.ArrayList<java.lang.String>(), new org.ovirt.engine.core.bll.scheduling.VdsFreeMemoryChecker(this), org.ovirt.engine.core.bll.MigrateVmCommand.getCorrelationId()); setDestinationVdsId(vdsToRunOn); if ((vdsToRunOn != null) && (!(Guid.Empty.equals(vdsToRunOn)))) { org.ovirt.engine.core.bll.MigrateVmCommand.getRunVdssList().add(vdsToRunOn); } org.ovirt.engine.core.bll.VmHandler.updateVmGuestAgentVersion(org.ovirt.engine.core.bll.MigrateVmCommand.getVm()); if ((vdsToRunOn != null) && (vdsToRunOn.equals(Guid.Empty))) { throw new org.ovirt.engine.core.common.errors.VdcBLLException(org.ovirt.engine.core.common.errors.VdcBllErrors.RESOURCE_MANAGER_CANT_ALLOC_VDS_MIGRATION); } if (((getDestinationVds()) == null) || ((org.ovirt.engine.core.bll.MigrateVmCommand.getVds()) == null)) { throw new org.ovirt.engine.core.common.errors.VdcBLLException(org.ovirt.engine.core.common.errors.VdcBllErrors.RESOURCE_MANAGER_VDS_NOT_FOUND); } }
public java.lang.Boolean getKvmEnabled() { return vdsDynamic.getKvmEnabled(); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Copy Template") java.lang.String copyTemplateTitle();
private static java.util.Collection<org.ovirt.engine.api.extensions.ExtMap> populateRecords(final org.ovirt.engine.core.extensions.mgr.ExtensionProxy extension, final java.lang.String namespace, final org.ovirt.engine.api.extensions.ExtMap input) { final java.util.List<org.ovirt.engine.api.extensions.ExtMap> records = new java.util.ArrayList<>(); org.ovirt.engine.core.sso.search.DirectoryUtils.queryImpl(extension, namespace, input, ( queryResults) -> { boolean result = true; for (org.ovirt.engine.api.extensions.ExtMap queryResult : queryResults) { if ((records.size()) < (org.ovirt.engine.core.sso.search.DirectoryUtils.QUERIES_RESULTS_LIMIT)) { records.add(queryResult); } else { result = false; break; } } return result; }); return records; }
@org.ovirt.engine.ui.uicompat.DefaultMessage("Overriding MTU configuration is not supported for Cluster version {0}") java.lang.String mtuOverrideNotSupported(java.lang.String version);
@java.lang.Override protected org.ovirt.engine.core.common.action.VdcActionParametersBase getAddParameters(org.ovirt.engine.core.common.businessentities.VmWatchdog entity, org.ovirt.engine.api.model.WatchDog device) { org.ovirt.engine.core.common.action.WatchdogParameters watchdogParameters = new org.ovirt.engine.core.common.action.WatchdogParameters(); validateEnums(org.ovirt.engine.api.model.WatchDog.class, device); watchdogParameters.setAction(getMapper(org.ovirt.engine.api.restapi.types.WatchdogAction.class, org.ovirt.engine.core.common.businessentities.VmWatchdogAction.class).map(org.ovirt.engine.api.restapi.types.WatchdogAction.fromValue(device.getAction()), null)); watchdogParameters.setModel(getMapper(org.ovirt.engine.api.restapi.types.WatchdogModel.class, org.ovirt.engine.core.common.businessentities.VmWatchdogType.class).map(org.ovirt.engine.api.restapi.types.WatchdogModel.fromValue(device.getModel()), null)); watchdogParameters.setId(parentId); watchdogParameters.setVm(isVm(parentId)); return watchdogParameters; }
@org.junit.Test public void encodeDecodeWithNonAsciiDiskAliasAndDescription() throws java.lang.Exception { disk.setDiskAlias(""); disk.setDiskDescription(""); assertDiskDescriptionMap(disk, org.ovirt.engine.core.bll.storage.disk.image.MetadataDiskDescriptionHandlerTest.generateDiskAliasJsonEntry(org.ovirt.engine.core.bll.storage.disk.image.MetadataDiskDescriptionHandlerTest.encodeString("")), org.ovirt.engine.core.bll.storage.disk.image.MetadataDiskDescriptionHandlerTest.generateDiskDescriptionJsonEntry(org.ovirt.engine.core.bll.storage.disk.image.MetadataDiskDescriptionHandlerTest.encodeString("")), org.ovirt.engine.core.bll.storage.disk.image.MetadataDiskDescriptionHandlerTest.generateEncodingJsonEntry(3)); org.ovirt.engine.core.bll.storage.disk.image.MetadataDiskDescriptionHandlerTest.assertDiskDescriptionDecoding(disk); }
public static boolean isDisplayTypeSupported(int osId, org.ovirt.engine.core.common.businessentities.DisplayType defaultDisplayType, java.util.List<java.lang.String> reasons, org.ovirt.engine.core.compat.Version clusterVersion) { boolean result = org.ovirt.engine.core.bll.validator.VmValidationUtils.isDisplayTypeSupported(osId, clusterVersion, defaultDisplayType); if (!result) { reasons.add(VdcBllMessages.ACTION_TYPE_FAILED_ILLEGAL_VM_DISPLAY_TYPE_IS_NOT_SUPPORTED_BY_OS.name()); } return result; }
public org.ovirt.engine.core.common.businessentities.KdumpStatus getKdumpStatus() { return kdumpStatus; }
protected java.util.List<org.ovirt.engine.core.common.businessentities.StorageDomainStatic> filterAttachedStorageDomains() { java.util.List<org.ovirt.engine.core.common.businessentities.StorageDomain> connectedStorageDomainsToVds = new java.util.ArrayList<>(); for (org.ovirt.engine.core.common.businessentities.StorageDomain storageDomain : org.ovirt.engine.core.bll.storage.GetStorageDomainsWithAttachedStoragePoolGuidQuery.getParameters().getStorageDomainList()) { if (!(connectStorageDomain(storageDomain))) { logErrorMessage(storageDomain); } else { connectedStorageDomainsToVds.add(storageDomain); } } java.util.List<org.ovirt.engine.core.common.businessentities.StorageDomainStatic> storageDomainsWithAttachedStoragePoolId = getAttachedStorageDomains(connectedStorageDomainsToVds); for (org.ovirt.engine.core.common.businessentities.StorageDomain storageDomain : connectedStorageDomainsToVds) { if (containsRunningHostedEngine(storageDomain)) { log.info("Skipping disconnect Storage Domain {} from VDS '{}' because Hosted Engine VM is running on it.", storageDomain.getName(), getVdsId()); continue; } if (!(disconnectStorageDomain(storageDomain))) { log.warn("Could not disconnect Storage Domain {} from VDS '{}'. ", storageDomain.getName(), getVdsId()); } } return storageDomainsWithAttachedStoragePoolId; }
@org.junit.Test public void testValidateClonedDisk() { org.ovirt.engine.core.bll.validator.StorageDomainValidator sdValidator = new org.ovirt.engine.core.bll.validator.StorageDomainValidator(sd); assertEquals((((((disk.getVolumeFormat()) + ", ") + (disk.getVolumeType())) + ", ") + (sd.getStorageType())), isValidForCloned, sdValidator.hasSpaceForClonedDisk(disk).isValid()); }
@java.lang.Override public com.google.gwt.safehtml.shared.SafeHtml getEnabledHtml() { return !(showTitle) ? enabledImage : !(imageAfterTitle) ? org.ovirt.engine.ui.common.widget.action.ImageUiCommandButtonDefinition.templates.imageTextButton(enabledImage, org.ovirt.engine.ui.common.widget.action.ImageUiCommandButtonDefinition.getText()) : org.ovirt.engine.ui.common.widget.action.ImageUiCommandButtonDefinition.templates.textImageButton(org.ovirt.engine.ui.common.widget.action.ImageUiCommandButtonDefinition.getText(), enabledImage); }
public static org.ovirt.engine.core.common.businessentities.network.HostNetworkQos findHostNetworkQosById(java.lang.Iterable<org.ovirt.engine.core.common.businessentities.network.HostNetworkQos> items, org.ovirt.engine.core.compat.Guid qosId) { for (org.ovirt.engine.core.common.businessentities.network.HostNetworkQos qos : items) { if (qos.getId().equals(qosId)) { return qos; } } return org.ovirt.engine.ui.uicommonweb.models.datacenters.NetworkModel.EMPTY_HOST_NETWORK_QOS; }
protected void findUsers(java.lang.String searchString, org.ovirt.engine.ui.frontend.AsyncQuery query) { org.ovirt.engine.ui.frontend.Frontend.getInstance().runQuery(VdcQueryType.Search, new org.ovirt.engine.core.common.queries.DirectorySearchParameters(((("ADUSER@" + (((org.ovirt.engine.core.aaa.ProfileEntry) (getProfile().getSelectedItem())).getAuthz())) + ": ") + searchString), org.ovirt.engine.core.common.interfaces.SearchType.DirectoryUser, getNamespace().getSelectedItem()), query); }
@org.junit.Test public void testBootProtocolSetForDisplayNetworkWhenBootProtocolIsNone() throws java.lang.Exception { org.ovirt.engine.core.common.businessentities.network.Network network = new org.ovirt.engine.core.common.businessentities.network.Network(); network.setId(org.ovirt.engine.core.compat.Guid.newGuid()); org.ovirt.engine.core.common.businessentities.network.NetworkAttachment attachment = createNetworkAttachmentWithIpConfiguration(NetworkBootProtocol.NONE, null, null); attachment.setNetworkId(network.getId()); doTestBootProtocolSetForDisplayNetworkWhenNullValuedIpConfigurationAndWhenNetworkClusterDisplay(true, org.ovirt.engine.core.bll.validator.ValidationResultMatchers.failsWith(VdcBllMessages.ACTION_TYPE_FAILED_DISPLAY_NETWORK_HAS_NO_BOOT_PROTOCOL), network, attachment); }
public static boolean canReadFile(final java.io.File file) { return ((file != null) && (file.exists())) && (file.canRead()); }
@java.lang.Override protected void verify(org.ovirt.engine.api.model.Cluster model, org.ovirt.engine.api.model.Cluster transform) { assertNotNull(transform); assertEquals(model.getName(), transform.getName()); assertEquals(model.getId(), transform.getId()); assertEquals(model.getDescription(), transform.getDescription()); assertEquals(model.getComment(), transform.getComment()); assertNotNull(transform.getCpu()); assertEquals(model.getCpu().getId(), transform.getCpu().getId()); assertNotNull(transform.getDataCenter()); assertEquals(model.getDataCenter().getId(), transform.getDataCenter().getId()); assertNotNull(transform.getSchedulingPolicy()); assertEquals(model.getSchedulingPolicy().getId(), transform.getSchedulingPolicy().getId()); assertEquals(model.getErrorHandling().getOnError(), transform.getErrorHandling().getOnError()); assertNotNull(transform.getMemoryPolicy()); assertNotNull(transform.getMemoryPolicy().getTransparentHugepages()); assertEquals(transform.getMemoryPolicy().getTransparentHugepages().isEnabled(), transform.getMemoryPolicy().getTransparentHugepages().isEnabled()); assertEquals(model.isVirtService(), transform.isVirtService()); assertEquals(model.isGlusterService(), transform.isGlusterService()); assertEquals(model.isTunnelMigration(), transform.isTunnelMigration()); assertEquals(model.isTrustedService(), transform.isTrustedService()); assertEquals(model.isBallooningEnabled(), transform.isBallooningEnabled()); assertEquals(model.getKsm().isEnabled(), transform.getKsm().isEnabled()); assertEquals(model.getDisplay().getProxy(), transform.getDisplay().getProxy()); assertEquals(model.getSerialNumber().getPolicy(), transform.getSerialNumber().getPolicy()); assertEquals(model.getSerialNumber().getValue(), transform.getSerialNumber().getValue()); }
@org.junit.Test public void testPopulate() throws java.lang.Exception { setupParentExpectations(); setUriInfo(setUpBasicUriExpectations()); setUpGetEntityExpectationsAllContent(1, false); resource.setParent(bricksResourceMock); control.replay(); verifyModelWithDetails(resource.get(), 0); }
@com.gwtplatform.mvp.client.annotations.TabInfo(container = org.ovirt.engine.ui.webadmin.section.main.presenter.tab.network.NetworkSubTabPanelPresenter.class) static com.gwtplatform.mvp.client.TabData getTabData(org.ovirt.engine.ui.webadmin.ApplicationConstants applicationConstants, org.ovirt.engine.ui.common.uicommon.model.SearchableDetailModelProvider<org.ovirt.engine.core.common.utils.PairQueryable<org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface, org.ovirt.engine.core.common.businessentities.VDS>, org.ovirt.engine.ui.uicommonweb.models.networks.NetworkListModel, org.ovirt.engine.ui.uicommonweb.models.networks.NetworkHostListModel> modelProvider) { return new org.ovirt.engine.ui.common.widget.tab.ModelBoundTabData(applicationConstants.networkHostSubTabLabel(), 3, modelProvider); }
void registerModelEventListeners(final org.ovirt.engine.ui.common.uicommon.model.ModelProvider<? extends org.ovirt.engine.ui.uicommonweb.models.EntityModel> modelProvider) { modelProvider.getModel().getPropertyChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener<org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs>() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs args) { if ("IsAvailable".equals(args.propertyName)) { boolean isAvailable = modelProvider.getModel().getIsAvailable(); setAccessible(isAvailable); } } }); }
private org.ovirt.engine.core.common.businessentities.pm.FenceAgent createFenceAgentFromModel(org.ovirt.engine.ui.uicommonweb.models.hosts.FenceAgentModel agentModel) { org.ovirt.engine.core.common.businessentities.pm.FenceAgent agent = new org.ovirt.engine.core.common.businessentities.pm.FenceAgent(); agent.setIp(agentModel.getManagementIp().getEntity()); agent.setUser(agentModel.getPmUserName().getEntity()); agent.setPassword(agentModel.getPmPassword().getEntity()); agent.setType(agentModel.getPmType().getSelectedItem()); agent.setOptionsMap(agentModel.getPmOptionsMap()); if ((agentModel.getPmEncryptOptions().getEntity()) != null) { agent.setEncryptOptions(agentModel.getPmEncryptOptions().getEntity()); } else { agent.setEncryptOptions(false); } if (((agentModel.getPmPort()) != null) && ((agentModel.getPmPort().getEntity()) != null)) { agent.setPort(agentModel.getPmPort().getEntity()); } agent.setOrder(agentModel.getOrder().getEntity()); return agent; }
@org.junit.Test public void canDoActionFailsNullParameterForIsoFile() { mockVdsWithOsVersion(org.ovirt.engine.core.bll.hostdeploy.UpgradeOvirtNodeInternalCommandTest.VALID_OVIRT_VERSION); org.ovirt.engine.core.common.action.hostdeploy.InstallVdsParameters param = org.ovirt.engine.core.bll.hostdeploy.UpgradeOvirtNodeInternalCommandTest.createParameters(); param.setoVirtIsoFile(null); org.ovirt.engine.core.bll.hostdeploy.UpgradeOvirtNodeInternalCommand<org.ovirt.engine.core.common.action.hostdeploy.InstallVdsParameters> command = createCommand(param); org.ovirt.engine.core.bll.hostdeploy.UpgradeOvirtNodeInternalCommandTest.assertFailsWithCanDoActionMessage(command, EngineMessage.VDS_CANNOT_INSTALL_MISSING_IMAGE_FILE); }
@java.lang.Override protected boolean validate() { org.ovirt.engine.core.common.businessentities.StorageDomain domain = storageDomainDao.getForStoragePool(org.ovirt.engine.core.bll.storage.lease.VmLeaseCommandBase.getParameters().getStorageDomainId(), org.ovirt.engine.core.bll.storage.lease.VmLeaseCommandBase.getParameters().getStoragePoolId()); org.ovirt.engine.core.bll.validator.storage.StorageDomainValidator validator = new org.ovirt.engine.core.bll.validator.storage.StorageDomainValidator(domain); return (validate(validator.isDomainExistAndActive())) && (validate(validator.isDataDomain())); }
private void handleRadioButtonClick(com.google.gwt.event.dom.client.ClickEvent event) { getDetailModel().setViewFilterType(viewRadioGroup.getSelectedValue()); boolean attached = (viewRadioGroup.getSelectedValue()) == (org.ovirt.engine.ui.uicommonweb.models.networks.NetworkHostFilter.attached); getTable().ensureColumnPresent(hostStatus, constants.empty(), true, "30px"); getTable().ensureColumnPresent(nameColumn, constants.nameHost(), true, "200px"); getTable().ensureColumnPresent(clusterColumn, constants.clusterHost(), true, "200px"); getTable().ensureColumnPresent(dcColumn, constants.dcHost(), true, "200px"); getTable().ensureColumnPresent(nicStatusColumn, constants.statusNetworkHost(), attached, "140px"); getTable().ensureColumnPresent(nicColumn, constants.nicNetworkHost(), attached, "100px"); getTable().ensureColumnPresent(speedColumn, templates.sub(constants.speedNetworkHost(), constants.mbps()).asString(), attached, "100px"); getTable().ensureColumnPresent(nicRxColumn, templates.sub(constants.rxNetworkHost(), constants.mbps()).asString(), attached, "100px"); getTable().ensureColumnPresent(nicTxColumn, templates.sub(constants.txNetworkHost(), constants.mbps()).asString(), attached, "100px"); getTable().ensureColumnPresent(totalRxColumn, templates.sub(constants.rxTotal(), constants.bytes()).asString(), attached, "150px"); getTable().ensureColumnPresent(totalTxColumn, templates.sub(constants.txTotal(), constants.bytes()).asString(), attached, "150px"); }
@org.ovirt.api.metamodel.annotations.Link types.NetworkLabel[] virtualFunctionAllowedLabels();
@java.lang.Override public java.util.List<org.ovirt.engine.core.bll.utils.PermissionSubject> getPermissionCheckSubjects() { return java.util.Collections.singletonList(new org.ovirt.engine.core.bll.utils.PermissionSubject(org.ovirt.engine.core.bll.MultiLevelAdministrationHandler.SYSTEM_OBJECT_ID, org.ovirt.engine.core.common.VdcObjectType.System, org.ovirt.engine.core.bll.storage.domain.AddStorageDomainCommand.getActionType().getActionGroup())); }
public org.ovirt.engine.core.bll.network.host.HostSetupNetworksValidatorTest.ParametersBuilder addLabels(org.ovirt.engine.core.common.businessentities.network.NicLabel... nicLabels) { if (nullParameters(nicLabels)) { return this; } if ((parameters.getLabels()) == null) { parameters.setLabels(new java.util.HashSet<org.ovirt.engine.core.common.businessentities.network.NicLabel>()); } parameters.getLabels().addAll(java.util.Arrays.asList(nicLabels)); return this; }
public void setIcon(org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel.NotChangableForVmInPoolEntityModel<org.ovirt.engine.ui.uicommonweb.models.vms.IconWithOsDefault> icon) { this.icon = icon; }
@org.junit.Test public void testCanDoActionStorageDomainIsFileStorage() { storageDomain.setStorageType(StorageType.NFS); org.ovirt.engine.core.bll.CanDoActionTestUtils.runAndAssertCanDoActionFailure(cmd, EngineMessage.ACTION_TYPE_FAILED_ALIGNMENT_SCAN_STORAGE_TYPE); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("VM") java.lang.String vmRoleTree();
private java.util.List<java.util.Map<java.lang.String, java.lang.Object>> parseChannels(org.ovirt.engine.core.utils.ovf.xml.XmlDocument document, java.util.List<org.ovirt.engine.core.common.businessentities.VmDevice> devices) { java.util.List<org.ovirt.engine.core.common.businessentities.VmDevice> dbDevices = filterDevices(devices, VmDeviceGeneralType.CHANNEL); java.util.List<java.util.Map<java.lang.String, java.lang.Object>> result = new java.util.ArrayList<>(); for (org.ovirt.engine.core.utils.ovf.xml.XmlNode node : selectNodes(document, VmDeviceGeneralType.CHANNEL)) { java.lang.String address = parseAddress(node); if (address.isEmpty()) { continue; } java.util.Map<java.lang.String, java.lang.Object> dev = new java.util.HashMap<>(); dev.put(VdsProperties.Type, VmDeviceGeneralType.CHANNEL.getValue()); dev.put(VdsProperties.Device, parseAttribute(node, org.ovirt.engine.core.vdsbroker.libvirt.VmDevicesConverter.TYPE)); dev.put(VdsProperties.Address, address); dev.put(VdsProperties.Alias, parseAlias(node)); org.ovirt.engine.core.common.businessentities.VmDevice dbDev = dbDevices.stream().filter(( d) -> d.getDevice().equals(dev.get(VdsProperties.Device))).findFirst().orElse(null); if (dbDev != null) { dbDevices.remove(dbDev); dev.put(VdsProperties.DeviceId, dbDev.getId().getDeviceId().toString()); dev.put(VdsProperties.SpecParams, dbDev.getSpecParams()); } else { dev.put(VdsProperties.DeviceId, org.ovirt.engine.core.compat.Guid.newGuid().toString()); } result.add(dev); } return result; }
public org.ovirt.engine.core.bll.ValidationResult diskImagesNotIllegal() { return diskImagesNotInStatus(ImageStatus.ILLEGAL, EngineMessage.ACTION_TYPE_FAILED_DISKS_ILLEGAL); }
@java.lang.Override public void onSuccess(java.lang.Object target, java.lang.Object returnValue) { java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StorageDomain> storages = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StorageDomain>) (returnValue)); if ((storages != null) && ((storages.size()) > 0)) { java.lang.String storageName = storages.get(0).getStorageName(); onFinish(context, false, storageModel, org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getMessages().createOperationFailedDcGuideMsg(storageName)); } else { saveNewPosixStorage(); } }
@java.lang.Override protected void setActionMessageParameters() { addCanDoActionMessage(EngineMessage.VAR__ACTION__ADD); addCanDoActionMessage(EngineMessage.VAR__TYPE__CLUSTER_POLICY); }
protected boolean isDiskCanBeAddedToVm(org.ovirt.engine.core.common.businessentities.storage.Disk diskInfo, org.ovirt.engine.core.common.businessentities.VM vm) { if ((!(diskInfo.isDiskSnapshot())) && (diskInfo.isBoot())) { for (org.ovirt.engine.core.common.businessentities.storage.Disk disk : vm.getDiskMap().values()) { if ((disk.isBoot()) && (!(disk.isDiskSnapshot()))) { addValidationMessage(EngineMessage.ACTION_TYPE_FAILED_DISK_BOOT_IN_USE); org.ovirt.engine.core.bll.storage.disk.AbstractDiskVmCommand.getReturnValue().getValidationMessages().add(java.lang.String.format("$DiskName %1$s", disk.getDiskAlias())); org.ovirt.engine.core.bll.storage.disk.AbstractDiskVmCommand.getReturnValue().getValidationMessages().add(java.lang.String.format("$VmName %1$s", vm.getName())); return false; } } } return true; }
@org.ovirt.engine.api.restapi.types.Mapping(from = org.ovirt.engine.core.common.businessentities.VDS.class, to = org.ovirt.engine.api.model.ExternalHost.class) public static org.ovirt.engine.api.model.ExternalHost map(org.ovirt.engine.core.common.businessentities.VDS entity, org.ovirt.engine.api.model.ExternalHost template) { org.ovirt.engine.api.model.ExternalHost model = (template != null) ? template : new org.ovirt.engine.api.model.ExternalHost(); java.lang.String name = entity.getName(); if (name != null) { model.setId(string2hex(name)); model.setName(name); } if ((entity.getHostName()) != null) { model.setAddress(entity.getHostName()); } return model; }
public void loadEntitiesNameMap() { org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().getEntitiesNameMap(new org.ovirt.engine.ui.uicommonweb.models.configure.labels.list.AsyncQuery(new org.ovirt.engine.ui.frontend.AsyncCallback<java.util.Map<org.ovirt.engine.core.compat.Guid, java.lang.String>>() { @java.lang.Override public void onSuccess(java.util.Map<org.ovirt.engine.core.compat.Guid, java.lang.String> nameMap) { entitiesNameMap.getEntity().clear(); entitiesNameMap.getEntity().putAll(nameMap); entitiesNameMap.getEntityChangedEvent().raise(this, EventArgs.EMPTY); } })); }
@org.junit.Test public void testUpdateLastAdminCheckStatus() { org.ovirt.engine.core.common.businessentities.aaa.DbUser nonAdminUser = dbFacade.getDbUserDao().getByUsernameAndDomain("userportal2@testportal.redhat.com", "testportal.redhat.com"); assertNotNull(nonAdminUser); assertFalse(nonAdminUser.isAdmin()); dao.updateLastAdminCheckStatus(nonAdminUser.getId()); nonAdminUser = dbFacade.getDbUserDao().get(nonAdminUser.getId()); assertFalse(nonAdminUser.isAdmin()); org.ovirt.engine.core.common.businessentities.Permission perms = new org.ovirt.engine.core.common.businessentities.Permission(); perms.setRoleType(RoleType.ADMIN); perms.setRoleId(org.ovirt.engine.core.dao.DbUserDaoTest.ADMIN_ROLE_TYPE_FROM_FIXTURE_ID); perms.setAdElementId(nonAdminUser.getId()); perms.setObjectId(org.ovirt.engine.core.dao.DbUserDaoTest.SYSTEM_OBJECT_ID); perms.setObjectType(VdcObjectType.System); dbFacade.getPermissionDao().save(perms); assertNotNull(dbFacade.getPermissionDao().get(perms.getId())); dao.updateLastAdminCheckStatus(nonAdminUser.getId()); nonAdminUser = dbFacade.getDbUserDao().get(nonAdminUser.getId()); assertTrue(nonAdminUser.isAdmin()); }
private void InitializeHelpers() { try { for (org.ovirt.engine.core.common.businessentities.StorageType storageType : org.ovirt.engine.core.common.businessentities.StorageType.values()) { java.lang.Class<?> actionType = null; java.lang.String formattedClassName = java.lang.String.format("%1$s.%2$s%3$s", org.ovirt.engine.core.bll.storage.StorageHelperDirector.ACTION_TYPE_PACKAGE, storageType.name(), org.ovirt.engine.core.bll.storage.StorageHelperDirector.ACTION_TYPE_CLASS); try { actionType = java.lang.Class.forName(formattedClassName); } catch (java.lang.ClassNotFoundException cnfe) { org.ovirt.engine.core.bll.storage.StorageHelperDirector.log.debugFormat("StorageHelperDirector Error:: the lookup for following class has failed: {0}", formattedClassName); } if (actionType != null) { java.lang.reflect.Constructor<?> info = actionType.getConstructors()[0]; org.ovirt.engine.core.bll.storage.IStorageHelper currentHelper = ((org.ovirt.engine.core.bll.storage.IStorageHelper) (info.newInstance(null))); _helpers.put(storageType, currentHelper); } } } catch (java.lang.Exception ex) { org.ovirt.engine.core.bll.storage.StorageHelperDirector.log.error("StorageHelperDirector Error:: exception was encountered during InitializeHelpers() execution", ex); throw new org.ovirt.engine.core.compat.ApplicationException("JTODO missing exception", ex); } }
public void setGlusterNetwork(org.ovirt.engine.ui.uicommonweb.models.clusters.ClusterNetworkModel model, boolean value) { if (!(isMultiCluster())) { if (value) { if ((getGlusterNetwork()) != null) { getGlusterNetwork().setGlusterNetwork(false); } glusterNetwork = model; } } model.setGlusterNetwork(value); }
public static boolean isMemoryToBeHotplugged(org.ovirt.engine.core.common.businessentities.VM source, org.ovirt.engine.core.common.businessentities.VM destination, boolean memoryUnplugSupported) { return ((source.getMemSizeMb()) < (destination.getMemSizeMb())) || (memoryUnplugSupported && ((source.getMemSizeMb()) > (destination.getMemSizeMb()))); }
@org.junit.Test public void refuseBalloonOnPPC() { final org.ovirt.engine.core.bll.ImportVmCommand<org.ovirt.engine.core.common.action.ImportVmParameters> c = setupDiskSpaceTest(createParameters()); addBalloonToVm(c.getVmFromExportDomain(null)); c.getParameters().getVm().setClusterArch(ArchitectureType.ppc64); org.ovirt.engine.core.common.businessentities.VDSGroup cluster = new org.ovirt.engine.core.common.businessentities.VDSGroup(); cluster.setArchitecture(ArchitectureType.ppc64); cluster.setCompatibilityVersion(org.ovirt.engine.core.compat.Version.getLast()); doReturn(cluster).when(c).getVdsGroup(); doReturn(true).when(c).validateImages(any(java.util.Map.class)); when(osRepository.isBalloonEnabled(c.getParameters().getVm().getVmOsId(), cluster.getCompatibilityVersion())).thenReturn(false); assertFalse(c.canDoAction()); assertTrue(c.getReturnValue().getCanDoActionMessages().contains(EngineMessage.BALLOON_REQUESTED_ON_NOT_SUPPORTED_ARCH.toString())); }
private static org.ovirt.engine.core.common.asynctasks.AsyncTaskCreationInfo nextAsyncTaskCreationInfo() { org.ovirt.engine.core.common.asynctasks.AsyncTaskCreationInfo info = new org.ovirt.engine.core.common.asynctasks.AsyncTaskCreationInfo(); info.setStepId(org.ovirt.engine.core.compat.Guid.newGuid()); info.setStoragePoolID(org.ovirt.engine.core.compat.Guid.newGuid()); info.setVdsmTaskId(org.ovirt.engine.core.compat.Guid.newGuid()); info.setTaskType(org.ovirt.engine.core.utils.RandomUtils.instance().nextEnum(org.ovirt.engine.core.common.asynctasks.AsyncTaskType.class)); return info; }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Cancel") java.lang.String cancel();
public org.ovirt.engine.core.bll.ValidationResult unplugPlugNotRequired() { return (liveActionRequired()) && (propertiesRequiringUnplugPlugWereUpdated()) ? new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.CANNOT_PERFORM_HOT_UPDATE) : org.ovirt.engine.core.bll.ValidationResult.VALID; }
public void storeInHttpSession(final java.lang.String key, final java.lang.String value) { getOperationManager().storeInHttpSession(key, value); }
private java.lang.String createSearchPattern(java.util.Collection<org.ovirt.engine.core.common.businessentities.VM> vms) { java.lang.String vm_guidKey = "ID ="; java.lang.String vm_nameKey = "NAME ="; java.lang.String orKey = " or "; java.lang.StringBuilder searchPattern = new java.lang.StringBuilder(); searchPattern.append("VM: "); for (org.ovirt.engine.core.common.businessentities.VM vm : vms) { searchPattern.append(vm_guidKey); searchPattern.append(vm.getId().toString()); searchPattern.append(orKey); searchPattern.append(vm_nameKey); searchPattern.append(vm.getName()); searchPattern.append(orKey); } return searchPattern.substring(0, ((searchPattern.length()) - (orKey.length()))); }
@java.lang.Override public java.lang.Object Convert(java.lang.Object source, org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery) { if (source != null) { java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VDSGroup> list = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VDSGroup>) (source)); java.util.Collections.sort(list, new org.ovirt.engine.ui.uicommonweb.Linq.VdsGroupByNameComparer()); return list; } return new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VDSGroup>(); }
private void buildIdToUnameLookup() { try { java.lang.String[] uniqueNames = preferences.node("/os").childrenNames(); idToUnameLookup = new java.util.HashMap<java.lang.Integer, java.lang.String>(uniqueNames.length); for (java.lang.String uniqueName : uniqueNames) { java.util.prefs.Preferences idNode = getKeyNode(uniqueName, "id", null); if (idNode != null) { idToUnameLookup.put(idNode.getInt("value", 0), uniqueName); } } } catch (java.util.prefs.BackingStoreException e) { throw new java.lang.RuntimeException(("Failed to initialize Os Repository due to " + e)); } }
private void gatherNonRunningVms(java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.businessentities.VmDynamic> dbVms) { for (org.ovirt.engine.core.common.businessentities.VmDynamic dbVm : dbVms.values()) { if (!(vdsmVms.containsKey(dbVm.getId()))) { changedVms.add(new org.ovirt.engine.core.common.utils.Pair(dbVm, null)); } } }
private void changeCD(java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs e) { org.ovirt.engine.ui.uicommonweb.models.configure.ChangeCDModel model = ((org.ovirt.engine.ui.uicommonweb.models.configure.ChangeCDModel) (sender)); java.lang.String isoName = model.getTitle(); if (org.ovirt.engine.core.compat.StringHelper.stringsEqual(isoName, org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().noCds())) { return; } java.lang.Object tempVar = getSelectedItem(); org.ovirt.engine.core.common.businessentities.VM vm = ((org.ovirt.engine.core.common.businessentities.VM) ((tempVar instanceof org.ovirt.engine.core.common.businessentities.VM) ? tempVar : null)); if (vm == null) { return; } org.ovirt.engine.ui.frontend.Frontend.getInstance().runMultipleAction(VdcActionType.ChangeDisk, new java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase>(java.util.Arrays.asList(new org.ovirt.engine.core.common.action.VdcActionParametersBase[]{ new org.ovirt.engine.core.common.action.ChangeDiskCommandParameters(vm.getId(), (org.ovirt.engine.core.compat.StringHelper.stringsEqual(isoName, org.ovirt.engine.ui.uicommonweb.models.vms.ConsoleModel.getEjectLabel()) ? "" : isoName)) })), new org.ovirt.engine.ui.uicompat.IFrontendMultipleActionAsyncCallback() { @java.lang.Override public void executed(org.ovirt.engine.ui.uicompat.FrontendMultipleActionAsyncResult result) { } }, null); }
@org.junit.Test public void testSave() { dao.save(newAdGroup); org.ovirt.engine.core.common.businessentities.LdapGroup result = dao.getByName(newAdGroup.getname()); assertEquals(newAdGroup, result); }
void setLocalItem(java.lang.String key, java.lang.String value);
@java.lang.Override public org.ovirt.engine.api.resource.VmNumaNodesResource getVirtualNumaNodesResource() { return inject(new org.ovirt.engine.api.restapi.resource.BackendVmNumaNodesResource(guid)); }
@java.lang.Override protected boolean validate() { if ((((org.ovirt.engine.core.bll.RemoveFenceAgentCommand.getParameters()) == null) || ((org.ovirt.engine.core.bll.RemoveFenceAgentCommand.getParameters().getAgent()) == null)) || ((org.ovirt.engine.core.bll.RemoveFenceAgentCommand.getParameters().getAgent().getId()) == null)) { return failValidation(EngineMessage.VDS_REMOVE_FENCE_AGENT_ID_REQUIRED); } return super.validate(); }
private java.util.List<java.util.Map<java.lang.String, java.lang.Object>> parseHostDevices(org.ovirt.engine.core.utils.ovf.xml.XmlDocument document, java.util.List<org.ovirt.engine.core.common.businessentities.VmDevice> devices) { return java.util.Collections.emptyList(); }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.VM> getAllWithTemplate(org.ovirt.engine.core.compat.Guid id) { return getCallsHandler().executeReadList("GetVmsByVmtGuid", org.ovirt.engine.core.dao.VmDaoImpl.VMRowMapper.instance, getCustomMapSqlParameterSource().addValue("vmt_guid", id)); }
private void updatePath() { org.ovirt.engine.ui.uicommonweb.models.storage.StorageModel model = ((org.ovirt.engine.ui.uicommonweb.models.storage.StorageModel) (getWindow())); org.ovirt.engine.core.common.businessentities.VDS host = model.getHost().getSelectedItem(); org.ovirt.engine.core.compat.Guid hostId = org.ovirt.engine.core.compat.Guid.Empty; if (host != null) { hostId = host.getId(); } org.ovirt.engine.ui.uicommonweb.models.storage.IStorageModel storageModel = model.getCurrentStorageItem(); connection = new org.ovirt.engine.core.common.businessentities.StorageServerConnections(); connection.setid(storageDomain.getStorage()); connection.setconnection(path); connection.setstorage_type(storageModel.getType()); if (storageModel.getType().equals(StorageType.NFS)) { updateNFSProperties(storageModel); } else if (storageModel instanceof org.ovirt.engine.ui.uicommonweb.models.storage.PosixStorageModel) { updatePosixProperties(storageModel); } org.ovirt.engine.core.common.action.StorageServerConnectionParametersBase parameters = new org.ovirt.engine.core.common.action.StorageServerConnectionParametersBase(connection, hostId); org.ovirt.engine.ui.frontend.Frontend.getInstance().runAction(VdcActionType.UpdateStorageServerConnection, parameters, new org.ovirt.engine.ui.uicompat.IFrontendActionAsyncCallback() { @java.lang.Override public void executed(org.ovirt.engine.ui.uicompat.FrontendActionAsyncResult result) { org.ovirt.engine.ui.uicommonweb.models.storage.StorageListModel storageListModel = ((org.ovirt.engine.ui.uicommonweb.models.storage.StorageListModel) (result.getState())); storageListModel.onFinish(storageListModel.context, true, storageListModel.storageModel); } }, this); }
@java.lang.Override public int compare(org.ovirt.engine.core.common.businessentities.Network o1, org.ovirt.engine.core.common.businessentities.Network o2) { return HostInterfaceListModel.ENGINE_NETWORK_NAME.equals(o1.getname()) ? -1 : o1.getname().compareTo(o2.getname()); }
@java.lang.Override public void addColumn(com.google.gwt.user.cellview.client.Column<T, ?> column, com.google.gwt.user.cellview.client.Header<?> header) { if ((columnResizingEnabled) && (header instanceof org.ovirt.engine.ui.common.widget.table.header.AbstractCheckboxHeader)) { header = createResizableCheckboxHeader(header, column); } else if (columnResizingEnabled) { header = createResizableHeader(column, header); } else if ((applyHeaderStyle) && (header instanceof org.ovirt.engine.ui.common.widget.table.header.SafeHtmlHeader)) { org.ovirt.engine.ui.common.widget.table.header.SafeHtmlHeader safeHtmlHeader = ((org.ovirt.engine.ui.common.widget.table.header.SafeHtmlHeader) (header)); com.google.gwt.safehtml.shared.SafeHtml newValue = org.ovirt.engine.ui.common.widget.table.resize.ColumnResizeCellTable.templates.nonResizeableColumnHeader(safeHtmlHeader.getValue()); header = new org.ovirt.engine.ui.common.widget.table.header.SafeHtmlHeader(newValue, safeHtmlHeader.getTooltip()); } super.addColumn(column, header); if (columnResizingEnabled) { if ((emptyNoWidthColumn) != null) { removeColumn(emptyNoWidthColumn); } emptyNoWidthColumn = new org.ovirt.engine.ui.common.widget.table.column.EmptyColumn<T>(); super.addColumn(emptyNoWidthColumn); } }
private org.ovirt.engine.core.utils.transaction.TransactionMethod<java.lang.Boolean> updateVdsNetworksInTx() { return new org.ovirt.engine.core.utils.transaction.TransactionMethod<java.lang.Boolean>() { @java.lang.Override public java.lang.Boolean runInTransaction() { java.util.List<org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface> ifaces = new java.util.ArrayList(getInterfaces()); ifaces.addAll(getRemovedBonds().values()); org.ovirt.engine.core.bll.Backend.getInstance().getResourceManager().RunVdsCommand(VDSCommandType.CollectVdsNetworkData, new org.ovirt.engine.core.common.vdscommands.CollectHostNetworkDataVdsCommandParameters(getVds(), ifaces)); for (org.ovirt.engine.core.common.businessentities.network.Network net : getNetworks()) { org.ovirt.engine.core.bll.network.cluster.NetworkClusterHelper.setStatus(getVdsGroupId(), net); } return java.lang.Boolean.TRUE; } }; }
@java.lang.Override protected void executeIrsBrokerCommand() { uuidReturn = org.ovirt.engine.core.vdsbroker.irsbroker.FinalizeMergeVDSCommand.getIrsProxy().finalizeMerge(org.ovirt.engine.core.vdsbroker.irsbroker.FinalizeMergeVDSCommand.getParameters().getStoragePoolId().toString(), org.ovirt.engine.core.common.utils.SubchainInfoHelper.prepareSubchainInfoForVdsCommand(org.ovirt.engine.core.vdsbroker.irsbroker.FinalizeMergeVDSCommand.getParameters().getSubchainInfo())); org.ovirt.engine.core.vdsbroker.irsbroker.FinalizeMergeVDSCommand.proceedProxyReturnValue(); org.ovirt.engine.core.compat.Guid taskID = new org.ovirt.engine.core.compat.Guid(uuidReturn.uuid); org.ovirt.engine.core.vdsbroker.irsbroker.FinalizeMergeVDSCommand.getVDSReturnValue().setCreationInfo(new org.ovirt.engine.core.common.asynctasks.AsyncTaskCreationInfo(taskID, org.ovirt.engine.core.common.asynctasks.AsyncTaskType.finalizeMerge, org.ovirt.engine.core.vdsbroker.irsbroker.FinalizeMergeVDSCommand.getParameters().getStoragePoolId())); }
public void showAlert(final org.ovirt.engine.ui.common.widget.panel.AlertPanel.Type type, final com.google.gwt.safehtml.shared.SafeHtml message) { showAlert(type, message, 0); }
public static void UpdateHardwareSystemInformation(java.util.Map<java.lang.String, java.lang.Object> hwInfo, org.ovirt.engine.core.common.businessentities.VDS vds) { vds.setHardwareManufacturer(org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.AssignStringValue(hwInfo, VdsProperties.hwManufacturer)); vds.setHardwareProductName(org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.AssignStringValue(hwInfo, VdsProperties.hwProductName)); vds.setHardwareVersion(org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.AssignStringValue(hwInfo, VdsProperties.hwVersion)); vds.setHardwareSerialNumber(org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.AssignStringValue(hwInfo, VdsProperties.hwSerialNumber)); vds.setHardwareUUID(org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.AssignStringValue(hwInfo, VdsProperties.hwUUID)); vds.setHardwareFamily(org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.AssignStringValue(hwInfo, VdsProperties.hwFamily)); }
public void setItems(java.util.ArrayList<org.ovirt.engine.ui.uicommonweb.models.SystemTreeItemModel> value) { if ((items) != value) { itemsChanging(value, items); items = value; itemsChanged(); getItemsChangedEvent().raise(this, EventArgs.EMPTY); onPropertyChanged(new org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs("Items")); } }
protected boolean validateParameters() { if ((getVdsGroup()) == null) { return failCanDoAction(VdcBllMessages.ACTION_TYPE_FAILED_INVALID_CLUSTER_FOR_AFFINITY_GROUP); } if ((getParameters().getAffinityGroup().getEntityIds()) != null) { org.ovirt.engine.core.common.businessentities.VmStatic vmStatic = null; java.util.Set<org.ovirt.engine.core.compat.Guid> vmSet = new java.util.HashSet<>(); for (org.ovirt.engine.core.compat.Guid vmId : getParameters().getAffinityGroup().getEntityIds()) { vmStatic = getVmStaticDAO().get(vmId); if (vmStatic == null) { return failCanDoAction(VdcBllMessages.ACTION_TYPE_FAILED_INVALID_VM_FOR_AFFINITY_GROUP); } if (!(java.util.Objects.equals(vmStatic.getVdsGroupId(), getVdsGroupId()))) { return failCanDoAction(VdcBllMessages.ACTION_TYPE_FAILED_VM_NOT_IN_AFFINITY_GROUP_CLUSTER); } if (vmSet.contains(vmStatic.getId())) { return failCanDoAction(VdcBllMessages.ACTION_TYPE_FAILED_DUPLICTE_VM_IN_AFFINITY_GROUP); } else { vmSet.add(vmStatic.getId()); } } } return hasAffinityCollisions(getParameters().getAffinityGroup()); }
public boolean isIncludeServerHooks() { return includeServerHooks; }
private org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface createVdsNetworkInterface(java.lang.String name) { return createVdsNetworkInterface(null, name); }
@java.lang.Override public int hashCode() { final int prime = 31; int result = 1; result = (prime * result) + ((tagId) == null ? 0 : tagId.hashCode()); result = (prime * result) + ((userId) == null ? 0 : userId.hashCode()); return result; }
@org.junit.Test public void subnetChanged() { org.ovirt.engine.core.common.businessentities.network net = createNetwork("net"); mockExistingNetworks(net); org.ovirt.engine.core.common.businessentities.VdsNetworkInterface nic = createNic("nic0", net.getName()); nic.setBootProtocol(NetworkBootProtocol.StaticIp); nic.setSubnet(org.ovirt.engine.core.utils.RandomUtils.instance().nextString(10)); mockExistingIfaces(nic); nic.setSubnet(org.ovirt.engine.core.utils.RandomUtils.instance().nextString(10)); org.ovirt.engine.core.bll.SetupNetworksHelper helper = createHelper(createParametersForNics(nic)); validateAndAssertNetworkModified(helper, net); }
@org.junit.Test public void testAllDomainsHaveSpaceForClonedDisksFail() { java.util.List<org.ovirt.engine.core.compat.Guid> sdIds = java.util.Arrays.asList(sdId1, sdId2); java.util.List<org.ovirt.engine.core.common.businessentities.storage.DiskImage> disksList = generateDisksList(org.ovirt.engine.core.bll.validator.storage.MultipleStorageDomainsValidatorTest.NUM_DISKS, sdIds); org.ovirt.engine.core.bll.validator.storage.StorageDomainValidator storageDomainValidator = mock(org.ovirt.engine.core.bll.validator.storage.StorageDomainValidator.class); doReturn(new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_DISK_SPACE_LOW_ON_STORAGE_DOMAIN)).when(storageDomainValidator).hasSpaceForClonedDisks(anyList()); doReturn(storageDomainValidator).when(validator).getStorageDomainValidator(any(java.util.Map.Entry.class)); org.ovirt.engine.core.bll.ValidationResult result = validator.allDomainsHaveSpaceForClonedDisks(disksList); assertFalse(result.isValid()); assertEquals("Wrong validation error", EngineMessage.ACTION_TYPE_FAILED_DISK_SPACE_LOW_ON_STORAGE_DOMAIN, result.getMessage()); }
public abstract java.util.List<org.ovirt.engine.core.common.errors.VdcBllMessages> resolveMessage();
protected org.ovirt.engine.core.bll.validator.storage.DiskValidator createDiskValidator() { return new org.ovirt.engine.core.bll.validator.storage.DiskValidator(getImage()); }
public void setRngPeriod(org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel.NotChangableForVmInPoolEntityModel<java.lang.Integer> rngPeriod) { this.rngPeriod = rngPeriod; }
protected org.codehaus.jackson.node.ObjectNode getUserInfoObject(org.ovirt.engine.core.common.businessentities.aaa.DbUser loggedInUser, java.lang.String engineSessionId, java.lang.String ssoToken) { org.codehaus.jackson.node.ObjectNode obj = createObjectNode(); obj.put("id", loggedInUser.getId().toString()); obj.put("userName", loggedInUser.getLoginName()); obj.put("domain", loggedInUser.getDomain()); obj.put("isAdmin", loggedInUser.isAdmin()); obj.put("engineSessionId", engineSessionId); obj.put("ssoToken", ssoToken); return obj; }
@java.lang.Override protected void ExecuteVdsBrokerCommand() { status = executeSnapshotVerb(); org.ovirt.engine.core.vdsbroker.vdsbroker.SnapshotVDSCommand.ProceedProxyReturnValue(); }
@java.lang.Override public void onClick(com.google.gwt.event.dom.client.ClickEvent event) { getModel().getSelectedItems().remove(selectedLabel); refreshItems(); }
@java.lang.Override public org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc glusterHookEnable(java.lang.String glusterCommand, java.lang.String stage, java.lang.String hookName) { try { java.util.Map<java.lang.String, java.lang.Object> xmlRpcReturnValue = vdsServer.glusterHookEnable(glusterCommand, stage, hookName); org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc wrapper = new org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc(xmlRpcReturnValue); return wrapper; } catch (java.lang.reflect.UndeclaredThrowableException ute) { throw new org.ovirt.engine.core.vdsbroker.xmlrpc.XmlRpcRunTimeException(ute); } }
public void refreshCdImages() { updateCdImage(true); }
@org.junit.Test public void networkToSyncMovedToAnotherNic() { org.ovirt.engine.core.common.businessentities.Network net = createNetwork("net"); org.ovirt.engine.core.common.businessentities.VdsNetworkInterface nic1 = createNicSyncedWithNetwork("nic0", net); nic1.setBridged((!(net.isVmNetwork()))); org.ovirt.engine.core.common.businessentities.VdsNetworkInterface nic2 = createNic("nic1", null); mockExistingNetworks(net); mockExistingIfaces(nic1, nic2); nic2.setNetworkName(nic1.getNetworkName()); nic1.setNetworkName(null); org.ovirt.engine.core.bll.SetupNetworksHelper helper = createHelper(createParametersForSync(nic2.getNetworkName(), nic1, nic2)); validateAndAssertNetworkModified(helper, net); }
@org.junit.Test public void testVmsWithIsoAttached() { setup(); mockDomain(); doReturn(domain).when(cmd).getStorageDomain(); doReturn(vmStaticDao).when(cmd).getVmStaticDao(); doReturn(vmDynamicDao).when(cmd).getVmDynamicDao(); org.ovirt.engine.core.common.businessentities.VmStatic vmStatic = new org.ovirt.engine.core.common.businessentities.VmStatic(); vmStatic.setName("TestVM"); vmStatic.setId(org.ovirt.engine.core.compat.Guid.newGuid()); doReturn(java.util.Collections.singletonList(vmStatic)).when(cmd).getVmsWithAttachedISO(); assertFalse(cmd.isRunningVmsWithIsoAttached()); assertTrue(cmd.getReturnValue().getValidationMessages().contains(EngineMessage.ERROR_CANNOT_DEACTIVATE_STORAGE_DOMAIN_WITH_ISO_ATTACHED.toString())); }
@java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs args) { if ((object.getVersion().getSelectedItem()) != null) { java.lang.String clusterVersion = object.getVersion().getSelectedItem().getValue(); serialNumberPolicyEditor.setVisible(org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().isSerialNumberPolicySupported(clusterVersion)); } }
protected org.ovirt.engine.core.compat.Guid getStoragePoolId() { return GetUnregisteredDisksQuery.getParameters().getStoragePoolId(); }
protected java.util.List<org.ovirt.engine.core.common.businessentities.gluster.GlusterBrickEntity> getBricks(org.ovirt.engine.core.compat.Guid volumeId) { java.util.List<org.ovirt.engine.core.common.businessentities.gluster.GlusterBrickEntity> bricks = new java.util.ArrayList<>(); org.ovirt.engine.core.common.businessentities.gluster.GlusterBrickEntity brick1 = new org.ovirt.engine.core.common.businessentities.gluster.GlusterBrickEntity(); brick1.setVolumeId(volumeId); brick1.setId(org.ovirt.engine.core.bll.gluster.AbstractRemoveGlusterVolumeBricksCommandTest.BRICK_UUID1); brick1.setBrickDirectory("/tmp/test-vol0"); brick1.setServerId(SERVER_ID); brick1.setStatus(GlusterStatus.UP); bricks.add(brick1); org.ovirt.engine.core.common.businessentities.gluster.GlusterBrickEntity brick2 = new org.ovirt.engine.core.common.businessentities.gluster.GlusterBrickEntity(); brick2.setVolumeId(volumeId); brick2.setId(org.ovirt.engine.core.bll.gluster.AbstractRemoveGlusterVolumeBricksCommandTest.BRICK_UUID1); brick2.setBrickDirectory("/tmp/test-vol1"); brick2.setServerId(SERVER_ID); brick2.setStatus(GlusterStatus.UP); bricks.add(brick2); return bricks; }
@javax.ws.rs.POST @org.jboss.resteasy.annotations.providers.jaxb.Formatted @javax.ws.rs.Consumes({ MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON, MediaType.APPLICATION_X_YAML }) @org.ovirt.engine.api.model.Actionable @javax.ws.rs.Path("activate") public javax.ws.rs.core.Response activate(org.ovirt.engine.api.model.Action action);
public void onStorageModelUpdated(org.ovirt.engine.ui.uicommonweb.models.storage.IStorageModel model) { getModel().updatedStorageModels.add(model); if ((getModel().updatedStorageModels.size()) == (org.ovirt.engine.ui.uicommonweb.Linq.<org.ovirt.engine.ui.uicommonweb.models.storage.IStorageModel>cast(getModel().getItems()).size())) { getModel().updatedStorageModels.clear(); getModel().getHost().setItems(new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VDS>()); getModel().getHost().setSelectedItem(null); setStorageItems(); if ((getModel().getCurrentStorageItem()) != null) { getModel().updateFormat(); } } }
private org.ovirt.engine.core.bll.ValidationResult reportMtuDifferences(java.util.List<org.ovirt.engine.core.common.businessentities.network.Network> ifaceNetworks) { java.util.List<java.lang.String> mtuDiffNetworks = new java.util.ArrayList<>(); for (org.ovirt.engine.core.common.businessentities.network.Network net : ifaceNetworks) { mtuDiffNetworks.add(java.lang.String.format("%s(%s)", net.getName(), ((net.getMtu()) == 0 ? "default" : java.lang.String.valueOf(net.getMtu())))); } java.lang.String replacements = java.lang.String.format("[%s]", commaSeparated(mtuDiffNetworks)); return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.NETWORK_MTU_DIFFERENCES, replacements); }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.VDSGroup> getClustersWithPermittedAction(org.ovirt.engine.core.compat.Guid userId, org.ovirt.engine.core.common.businessentities.ActionGroup actionGroup) { org.springframework.jdbc.core.namedparam.MapSqlParameterSource parameterSource = getCustomMapSqlParameterSource().addValue("user_id", userId).addValue("action_group_id", actionGroup.getId()); return getCallsHandler().executeReadList("fn_perms_get_vds_groups_with_permitted_action", org.ovirt.engine.core.dao.VdsGroupDaoImpl.VdsGroupRowMapper.instance, parameterSource); }
private boolean networkNotAttachedToCluster() { if (networkExists()) { return failCanDoAction(EngineMessage.NETWORK_ALREADY_ATTACHED_TO_CLUSTER); } return true; }
void save(org.ovirt.engine.core.common.businessentities.LdapGroup group);
@org.junit.Test public void validateFailsForDifferentStorageDevice() { org.ovirt.engine.core.common.businessentities.gluster.StorageDevice storageDevice1 = getStorageDevice("sda"); org.ovirt.engine.core.common.businessentities.gluster.StorageDevice storageDevice2 = getStorageDevice("sdb"); storageDevice2.setDevType("SDA"); doReturn(new org.ovirt.engine.core.common.action.gluster.CreateBrickParameters(HOST_ID, "brick1", "/gluster-bricks/brick1", org.ovirt.engine.core.common.businessentities.RaidType.RAID0, null, null, java.util.Arrays.asList(storageDevice1, storageDevice2), getStorageDevice("sdb"), org.ovirt.engine.core.common.businessentities.CacheModeType.writethrough, 10)).when(cmd).getParameters(); prepareMocks(VDSStatus.Up); assertFalse(cmd.validate()); }
@org.junit.Test public void testQueryFailsIfWrongPassword() { mockQueryParameters(org.ovirt.engine.core.bll.gluster.GetGlusterServersForImportQueryTest.NEW_SERVER, org.ovirt.engine.core.bll.gluster.GetGlusterServersForImportQueryTest.WRONG_PASSWORD); try { getQuery().executeQueryCommand(); fail("Query didn't fail when wrong password was passed!"); } catch (java.lang.RuntimeException e) { assertEquals(EngineMessage.SSH_AUTHENTICATION_FAILED.toString(), e.getMessage()); } }
private java.lang.String messageFormatter(java.lang.String msg, java.lang.String id, java.lang.String method) { org.codehaus.jackson.node.ObjectNode vmDetailNode = new org.codehaus.jackson.map.ObjectMapper().createObjectNode(); vmDetailNode.put("status", msg); vmDetailNode.put("hash", java.lang.Integer.toString(id.hashCode())); org.codehaus.jackson.node.ObjectNode paramsNode = new org.codehaus.jackson.map.ObjectMapper().createObjectNode(); paramsNode.put(id.toString(), vmDetailNode); paramsNode.put("notify_time", java.lang.System.nanoTime()); org.codehaus.jackson.node.ObjectNode node = new org.codehaus.jackson.map.ObjectMapper().createObjectNode(); node.put("params", paramsNode); node.put("jsonrpc", "2.0"); node.put("method", method); return node.toString(); }
public org.ovirt.engine.ui.uicommonweb.models.EntityModel<java.lang.Boolean> getConnectedToPhysicalNetwork() { return connectedToPhysicalNetwork; }
public org.ovirt.engine.core.common.action.PersistentSetupNetworksParameters buildParameters(org.ovirt.engine.core.compat.Guid hostId, java.util.List<org.ovirt.engine.core.common.businessentities.network.Network> networksToRemove, java.util.List<org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface> nics) { org.ovirt.engine.core.common.action.PersistentSetupNetworksParameters parameters = createSetupNetworksParameters(hostId); for (org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface nic : nics) { org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface nicToConfigure = getNicToConfigure(parameters.getInterfaces(), nic.getId()); if (nicToConfigure == null) { throw new org.ovirt.engine.core.common.errors.EngineException(org.ovirt.engine.core.common.errors.EngineError.LABELED_NETWORK_INTERFACE_NOT_FOUND); } java.util.Set<org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface> nicsToRemove = getNicsToRemove(parameters.getInterfaces(), networksToRemove, nicToConfigure); parameters.getInterfaces().removeAll(nicsToRemove); } parameters.setNetworkNames(org.apache.commons.lang.StringUtils.join(org.ovirt.engine.core.common.businessentities.Entities.objectNames(networksToRemove), ", ")); return parameters; }
private void updateAdminStatus(org.ovirt.engine.core.common.businessentities.permissions perm) { org.ovirt.engine.core.common.businessentities.Role role = org.ovirt.engine.core.bll.AddPermissionCommand.getRoleDao().get(perm.getrole_id()); if ((role.getType()) == (org.ovirt.engine.core.common.businessentities.RoleType.ADMIN)) { org.ovirt.engine.core.bll.MultiLevelAdministrationHandler.setIsAdminGUIFlag(perm.getad_element_id(), true); } }
org.ovirt.engine.core.bll.ValidationResult validateCustomProperties(org.ovirt.engine.core.common.utils.customprop.SimpleCustomPropertiesUtil util, java.util.Map<java.lang.String, java.lang.String> validPropertiesForVm, java.util.Map<java.lang.String, java.lang.String> validPropertiesForNonVm) { for (org.ovirt.engine.core.common.businessentities.network.NetworkAttachment attachment : params.getNetworkAttachments()) { org.ovirt.engine.core.common.businessentities.network.Network network = existingNetworkRelatedToAttachment(attachment); if (attachment.hasProperties()) { if (!(networkCustomPropertiesSupported)) { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_NETWORK_CUSTOM_PROPERTIES_NOT_SUPPORTED, org.ovirt.engine.core.utils.ReplacementUtils.createSetVariableString(org.ovirt.engine.core.bll.network.host.HostSetupNetworksValidator.VAR_ACTION_TYPE_FAILED_NETWORK_CUSTOM_PROPERTIES_NOT_SUPPORTED_LIST, network.getName())); } java.util.List<org.ovirt.engine.core.common.utils.customprop.ValidationError> errors = util.validateProperties((network.isVmNetwork() ? validPropertiesForVm : validPropertiesForNonVm), attachment.getProperties()); if (!(errors.isEmpty())) { handleCustomPropertiesError(util, errors); return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_NETWORK_CUSTOM_PROPERTIES_BAD_INPUT, org.ovirt.engine.core.utils.ReplacementUtils.createSetVariableString(org.ovirt.engine.core.bll.network.host.HostSetupNetworksValidator.VAR_ACTION_TYPE_FAILED_NETWORK_CUSTOM_PROPERTIES_BAD_INPUT_LIST, network.getName())); } } } return org.ovirt.engine.core.bll.ValidationResult.VALID; }
private org.ovirt.engine.core.bll.ValidationResult validateNetworkExclusiveOnNics(java.util.Collection<org.ovirt.engine.core.common.businessentities.network.NetworkAttachment> attachmentsToConfigure) { org.ovirt.engine.core.bll.validator.NetworkAttachmentsValidator validator = new org.ovirt.engine.core.bll.validator.NetworkAttachmentsValidator(attachmentsToConfigure, networkBusinessEntityMap, networkExclusivenessValidator); return validator.validateNetworkExclusiveOnNics(); }
public static void Init() { org.ovirt.engine.core.bll.VmHandler.mUpdateVmsStatic = new org.ovirt.engine.core.utils.ObjectIdentityChecker(org.ovirt.engine.core.bll.VmHandler.class, java.util.Arrays.asList(new java.lang.String[]{ "VM", "VmStatic", "VmDynamic" }), org.ovirt.engine.core.common.businessentities.VMStatus.class); org.ovirt.engine.core.bll.VmHandler.mUpdateVmsStatic.AddPermittedFields(new java.lang.String[]{ "vm_name", "description", "domain", "os", "osType", "creation_date", "num_of_monitors", "allowConsoleReconnect", "usb_policy", "is_auto_suspend", "auto_startup", "dedicated_vm_for_vds", "default_display_type", "priority", "default_boot_sequence", "initrd_url", "kernel_url", "kernel_params", "migrationSupport", "minAllocatedMem", "quotaId", "quotaName", "quotaEnforcementType", "cpuPinning", "vmPayload", "balloonEnabled", "images", "interfaces" }); org.ovirt.engine.core.bll.VmHandler.mUpdateVmsStatic.AddFields(java.util.Arrays.asList(new java.lang.Enum<?>[]{ org.ovirt.engine.core.common.businessentities.VMStatus.Down }), java.util.Arrays.asList(new java.lang.String[]{ "vds_group_id", "time_zone", "is_stateless", "nice_level", "mem_size_mb", "num_of_sockets", "cpu_per_socket", "iso_path", "userDefinedProperties", "predefinedProperties", "customProperties" })); }
@java.lang.Override protected java.util.Map<java.lang.String, org.ovirt.engine.core.common.utils.Pair<java.lang.String, java.lang.String>> getExclusiveLocks() { return java.util.Collections.singletonMap(org.ovirt.engine.core.bll.storage.ForceRemoveStorageDomainCommand.getParameters().getStorageDomainId().toString(), org.ovirt.engine.core.bll.LockMessagesMatchUtil.makeLockingPair(LockingGroup.STORAGE, EngineMessage.ACTION_TYPE_FAILED_OBJECT_LOCKED)); }
@org.ovirt.engine.ui.common.DefaultStringValue("When the VM is running, disks attached with an IDE interface won't be activated.") java.lang.String activateVmDiskPopupToolTip();
public static java.util.List<org.ovirt.engine.core.common.businessentities.CommandEntity> findChildCommands(org.ovirt.engine.core.compat.Guid commandId) { final java.util.List<org.ovirt.engine.core.compat.Guid> childCommandIds = org.ovirt.engine.core.bll.tasks.CommandCoordinatorUtil.getChildCommandIds(commandId); final java.util.List<org.ovirt.engine.core.common.businessentities.CommandEntity> childCommands = childCommandIds.stream().map(org.ovirt.engine.core.bll.tasks.CommandCoordinatorUtil::getCommandEntity).collect(java.util.stream.Collectors.toList()); return childCommands; }
private org.ovirt.engine.core.bll.ValidationResult networkDoesNotExist(java.util.List<org.ovirt.engine.core.common.businessentities.network.Network> networks) { return (getNetworkByName(networks)) == null ? org.ovirt.engine.core.bll.ValidationResult.VALID : new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.dal.VdcBllMessages.NETWORK_NAME_ALREADY_EXISTS); }
private boolean hasAffinityCollisions(org.ovirt.engine.core.common.scheduling.AffinityGroup affinityGroup) { java.util.List<org.ovirt.engine.core.common.scheduling.AffinityGroup> affinityGroups = getAffinityGroupDao().getAllAffinityGroupsByClusterId(affinityGroup.getClusterId()); affinityGroups.add(affinityGroup); return validateUnifiedAffinityGroups(affinityGroups); }
private org.ovirt.engine.core.utils.transaction.TransactionMethod<java.lang.Boolean> updateVdsNetworksInTx(final T bckndCmdParams) { return new org.ovirt.engine.core.utils.transaction.TransactionMethod<java.lang.Boolean>() { @java.lang.Override public java.lang.Boolean runInTransaction() { org.ovirt.engine.core.bll.Backend.getInstance().getResourceManager().RunVdsCommand(VDSCommandType.CollectVdsNetworkData, new org.ovirt.engine.core.common.vdscommands.VdsIdAndVdsVDSCommandParametersBase(bckndCmdParams.getVdsId())); for (org.ovirt.engine.core.common.businessentities.Network net : getNetworks()) { org.ovirt.engine.core.bll.AttachNetworkToVdsGroupCommand.SetNetworkStatus(getVdsGroupId(), net); } return java.lang.Boolean.TRUE; } }; }
@java.lang.Override protected void executeCommand() { if (networkExists()) { org.ovirt.engine.core.bll.network.cluster.AttachNetworkToVdsGroupCommand.getNetworkClusterDAO().update(getNetworkCluster()); } else { org.ovirt.engine.core.bll.network.cluster.AttachNetworkToVdsGroupCommand.getNetworkClusterDAO().save(new org.ovirt.engine.core.common.businessentities.network.NetworkCluster(org.ovirt.engine.core.bll.network.cluster.AttachNetworkToVdsGroupCommand.getVdsGroupId(), getNetwork().getId(), org.ovirt.engine.core.common.businessentities.network.NetworkStatus.OPERATIONAL, false, getNetworkCluster().isRequired(), getNetworkCluster().isMigration())); } if (getNetwork().getCluster().isDisplay()) { org.ovirt.engine.core.bll.network.cluster.AttachNetworkToVdsGroupCommand.getNetworkClusterDAO().setNetworkExclusivelyAsDisplay(org.ovirt.engine.core.bll.network.cluster.AttachNetworkToVdsGroupCommand.getVdsGroupId(), getNetwork().getId()); } if (getNetwork().getCluster().isMigration()) { org.ovirt.engine.core.bll.network.cluster.AttachNetworkToVdsGroupCommand.getNetworkClusterDAO().setNetworkExclusivelyAsMigration(org.ovirt.engine.core.bll.network.cluster.AttachNetworkToVdsGroupCommand.getVdsGroupId(), getNetwork().getId()); } org.ovirt.engine.core.bll.network.cluster.NetworkClusterHelper.setStatus(org.ovirt.engine.core.bll.network.cluster.AttachNetworkToVdsGroupCommand.getVdsGroupId(), getNetwork()); org.ovirt.engine.core.bll.network.cluster.AttachNetworkToVdsGroupCommand.setSucceeded(true); }
private void chooseHostForExecution(org.ovirt.engine.core.common.vdscommands.VdsIdVDSCommandParametersBase parametersBase, org.ovirt.engine.core.compat.Guid storagePoolId, org.ovirt.engine.core.bll.CommandBase<?> cmd, java.util.Collection<org.ovirt.engine.core.compat.Guid> executedHosts) { org.ovirt.engine.core.compat.Guid vdsForExecution = getHostForExecution(storagePoolId, executedHosts); parametersBase.setVdsId(vdsForExecution); if (cmd != null) { if (((cmd.getCommandStep()) != null) && ((cmd.getExecutionContext().getStep()) != null)) { org.ovirt.engine.core.compat.Guid stepId = cmd.getExecutionContext().getStep().getId(); if ((cmd.getParameters().getVdsRunningOn()) != null) { stepSubjectEntityDao.remove(cmd.getParameters().getVdsRunningOn(), stepId); } if (vdsForExecution != null) { stepSubjectEntityDao.saveAll(java.util.Collections.singletonList(new org.ovirt.engine.core.common.job.StepSubjectEntity(stepId, org.ovirt.engine.core.common.VdcObjectType.EXECUTION_HOST, vdsForExecution))); updateStepMessage(cmd, vdsForExecution); } } cmd.getParameters().setVdsRunningOn(vdsForExecution); cmd.persistCommand(cmd.getParameters().getParentCommand(), ((cmd.getCallback()) != null)); } }
@org.junit.Test public void networkQosNullAndSupported() throws java.lang.Exception { vnicProfileValidationTest(org.ovirt.engine.core.bll.validator.ValidationResultMatchers.isValid(), true, true, false, true); }
@org.junit.Test public void testCanDoAction() { doReturn(true).when(cmd).validateVmNotDuringSnapshot(); vm.setStatus(VMStatus.Up); org.ovirt.engine.core.bll.CanDoActionTestUtils.runAndAssertCanDoActionFailure(cmd, EngineMessage.VMT_CANNOT_CREATE_TEMPLATE_FROM_DOWN_VM); }
private void addVmsToPool(org.ovirt.engine.core.compat.Guid poolId) { int subsequentFailedAttempts = 0; int vmPoolMaxSubsequentFailures = org.ovirt.engine.core.common.config.Config.<java.lang.Integer>getValue(ConfigValues.VmPoolMaxSubsequentFailures); for (int i = 0; i < (org.ovirt.engine.core.bll.CommonVmPoolWithVmsCommand.getParameters().getVmsCount()); i++) { java.lang.String currentVmName = generateUniqueVmName(); org.ovirt.engine.core.common.action.VdcReturnValueBase returnValue = runInternalAction(VdcActionType.AddVmAndAttachToPool, buildAddVmAndAttachToPoolParameters(poolId, currentVmName), createAddVmStepContext(currentVmName)); if (((returnValue != null) && (!(returnValue.getSucceeded()))) && (!(returnValue.getCanDoActionMessages().isEmpty()))) { for (java.lang.String msg : returnValue.getCanDoActionMessages()) { if (!(org.ovirt.engine.core.bll.CommonVmPoolWithVmsCommand.getReturnValue().getCanDoActionMessages().contains(msg))) { org.ovirt.engine.core.bll.CommonVmPoolWithVmsCommand.getReturnValue().getCanDoActionMessages().add(msg); } } addVmsSucceeded = false; subsequentFailedAttempts++; } else { subsequentFailedAttempts = 0; } if (subsequentFailedAttempts == vmPoolMaxSubsequentFailures) { org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase logable = new org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase(); org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogDirector.log(logable, AuditLogType.USER_VM_POOL_MAX_SUBSEQUENT_FAILURES_REACHED); break; } } }
@java.lang.Override public void update() { com.google.gwt.event.logical.shared.InitializeEvent.fire(this); }
protected void updateCpuPinningVisibility() { if ((getModel().getCluster().getSelectedItem()) != null) { org.ovirt.engine.core.common.businessentities.VDSGroup cluster = ((org.ovirt.engine.core.common.businessentities.VDSGroup) (getModel().getCluster().getSelectedItem())); java.lang.String compatibilityVersion = cluster.getcompatibility_version().toString(); boolean hasCpuPinning = true; if (java.lang.Boolean.FALSE.equals(org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.GetConfigValuePreConverted(ConfigurationValues.CpuPinningEnabled, compatibilityVersion))) { hasCpuPinning = false; } else if ((java.lang.Boolean.FALSE.equals(org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.GetConfigValuePreConverted(ConfigurationValues.CpuPinMigrationEnabled, Config.DefaultConfigurationVersion))) && (isVmMigratable())) { hasCpuPinning = false; } getModel().getCpuPinning().setIsAvailable(hasCpuPinning); if (!hasCpuPinning) { getModel().getCpuPinning().setEntity(""); } } }
protected org.ovirt.engine.core.common.vdscommands.VDSReturnValue performDeleteImageVdsmOperation() { if (org.ovirt.engine.core.bll.storage.disk.image.RemoveImageCommand.getParameters().isShouldLockImage()) { org.ovirt.engine.core.bll.storage.disk.image.ImagesHandler.updateAllDiskImageSnapshotsStatusWithCompensation(org.ovirt.engine.core.bll.storage.disk.image.RemoveImageCommand.getRelevantDiskImage().getId(), ImageStatus.LOCKED, ImageStatus.ILLEGAL, org.ovirt.engine.core.bll.storage.disk.image.RemoveImageCommand.getCompensationContext()); } return runVdsCommand(VDSCommandType.DeleteImageGroup, org.ovirt.engine.core.bll.storage.domain.PostDeleteActionHandler.fixParameters(new org.ovirt.engine.core.common.vdscommands.DeleteImageGroupVDSCommandParameters(org.ovirt.engine.core.bll.storage.disk.image.RemoveImageCommand.getDiskImage().getStoragePoolId(), org.ovirt.engine.core.bll.storage.disk.image.RemoveImageCommand.getStorageDomainId(), org.ovirt.engine.core.bll.storage.disk.image.RemoveImageCommand.getDiskImage().getId(), org.ovirt.engine.core.bll.storage.disk.image.RemoveImageCommand.getDiskImage().isWipeAfterDelete(), org.ovirt.engine.core.bll.storage.disk.image.RemoveImageCommand.getParameters().getForceDelete()))); }
@java.lang.Override protected void executeCommand() { if (getDiskImages().isEmpty()) { org.ovirt.engine.core.bll.SealVmTemplateCommand.setSucceeded(true); return; } org.ovirt.engine.core.common.vdscommands.VDSReturnValue vdsReturnValue = org.ovirt.engine.core.bll.storage.utils.VdsCommandsHelper.runVdsCommandWithFailover(VDSCommandType.SealDisks, buildSealDisksVDSCommandParameters(), getDiskImages().get(0).getStoragePoolId(), this); if (!(vdsReturnValue.getSucceeded())) { setCommandStatus(CommandStatus.FAILED); } setSucceeded(vdsReturnValue.getSucceeded()); }
protected org.ovirt.engine.core.compat.Guid getStoragePoolIdFromVds() { return org.ovirt.engine.core.bll.storage.domain.AttachStorageDomainToPoolCommand.getVds().getStoragePoolId(); }
@java.lang.Override protected void executeQueryCommand() { org.ovirt.engine.core.common.queries.VdcQueryReturnValue returnValue = org.ovirt.engine.core.bll.Backend.getInstance().runInternalQuery(VdcQueryType.GetAuthzGroupsByUserId, org.ovirt.engine.core.bll.GetPermissionsOnBehalfByAdElementIdQuery.getParameters()); java.util.Collection<org.ovirt.engine.core.common.businessentities.aaa.AuthzGroup> authzGroups = returnValue.getReturnValue(); java.util.List<org.ovirt.engine.core.compat.Guid> groupsIds = authzGroups.stream().map(( g) -> dbGroupDao.getByExternalId(g.getAuthz(), g.getId())).filter(java.util.Objects::nonNull).map(( g) -> g.getId()).collect(java.util.stream.Collectors.toList()); org.ovirt.engine.core.bll.GetPermissionsOnBehalfByAdElementIdQuery.getQueryReturnValue().setReturnValue(permissionDao.getAllForAdElementAndGroups(org.ovirt.engine.core.bll.GetPermissionsOnBehalfByAdElementIdQuery.getParameters().getId(), groupsIds, org.ovirt.engine.core.bll.GetPermissionsOnBehalfByAdElementIdQuery.getParameters().isFiltered())); }
protected org.codehaus.jackson.node.ObjectNode getEngineSessionTimeoutObject(java.lang.Integer engineSessionTimeout, java.lang.Integer userSessionHardLimit) { org.codehaus.jackson.node.ObjectNode obj = createObjectNode(); obj.put("sessionTimeout", java.lang.String.valueOf(engineSessionTimeout)); obj.put("sessionHardLimit", java.lang.String.valueOf(userSessionHardLimit)); return obj; }
public java.util.List<java.lang.String> getNamesOfVms() { return namesOfVms; }
private void verifyDomainForMemory(java.util.List<org.ovirt.engine.core.common.businessentities.StorageDomain> storageDomains) { org.ovirt.engine.core.common.businessentities.StorageDomain storageDomain = memoryStorageHandler.findStorageDomainForMemory(storageDomains, disksList); assertEquals(storageDomain, validStorageDomain); }
@org.junit.Test public void networkBelongsToClusterDataCenterNotValid() throws java.lang.Exception { when(cluster.getStoragePoolId()).thenReturn(org.ovirt.engine.core.bll.network.cluster.NetworkClusterValidatorTestBase.TEST_DC_ID1); when(network.getDataCenterId()).thenReturn(org.ovirt.engine.core.bll.network.cluster.NetworkClusterValidatorTestBase.TEST_DC_ID2); assertThat(validator.networkBelongsToClusterDataCenter(cluster, network), both(failsWith(EngineMessage.ACTION_TYPE_FAILED_NETWORK_FROM_DIFFERENT_DC)).and(replacements(org.ovirt.engine.core.bll.network.cluster.NetworkClusterValidatorTestBase.hasItem(org.ovirt.engine.core.bll.network.cluster.NetworkClusterValidatorTestBase.NETWORK_NAME_REPLACEMENT)))); }
private static org.ovirt.engine.core.common.businessentities.storage.VolumeType getVolumeType(org.ovirt.engine.api.model.ExternalVmImport vmImport) { return java.lang.Boolean.TRUE.equals(vmImport.isSparse()) ? org.ovirt.engine.core.common.businessentities.storage.VolumeType.Sparse : org.ovirt.engine.core.common.businessentities.storage.VolumeType.Preallocated; }
private java.util.Map<org.ovirt.engine.core.compat.Guid, java.util.List<org.ovirt.engine.core.common.businessentities.DiskImage>> getStorageToDiskMap() { java.util.Map<org.ovirt.engine.core.compat.Guid, java.util.List<org.ovirt.engine.core.common.businessentities.DiskImage>> storageToDisksMap = new java.util.HashMap<org.ovirt.engine.core.compat.Guid, java.util.List<org.ovirt.engine.core.common.businessentities.DiskImage>>(); for (org.ovirt.engine.core.common.businessentities.DiskImage disk : getSourceImages()) { org.ovirt.engine.core.utils.MultiValueMapUtils.addToMap(disk.getStorageIds().get(0), disk, storageToDisksMap); } return storageToDisksMap; }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("UUID") java.lang.String hardwareUUIDGeneral();
@org.junit.Test public void testAddSupportedClusterFeature() { java.util.Set<org.ovirt.engine.core.common.businessentities.SupportedAdditionalClusterFeature> previouslySupportedFeatures = dao.getSupportedFeaturesByClusterId(org.ovirt.engine.core.dao.ClusterFeatureDaoTest.EXISTING_VDS_GROUP); dao.addSupportedClusterFeature(buildSupportedFeature(org.ovirt.engine.core.dao.ClusterFeatureDaoTest.NEW_SUPPORTED_FEATURE_1, org.ovirt.engine.core.dao.ClusterFeatureDaoTest.EXISTING_VDS_GROUP, true)); java.util.Set<org.ovirt.engine.core.common.businessentities.SupportedAdditionalClusterFeature> supportedFeatures = dao.getSupportedFeaturesByClusterId(org.ovirt.engine.core.dao.ClusterFeatureDaoTest.EXISTING_VDS_GROUP); assertEquals(supportedFeatures.size(), ((previouslySupportedFeatures.size()) + 1)); }
private void endUnlockOps() { org.ovirt.engine.core.bll.VmHandler.UnLockVm(org.ovirt.engine.core.bll.AddVmTemplateCommand.getVm()); org.ovirt.engine.core.bll.VmTemplateHandler.UnLockVmTemplate(org.ovirt.engine.core.bll.AddVmTemplateCommand.getVmTemplateId()); }
@java.lang.Override public java.util.Map<org.ovirt.engine.core.common.utils.Pair<java.lang.Integer, org.ovirt.engine.core.compat.Version>, java.util.Set<java.lang.String>> getUnsupportedCpus() { java.util.Set<org.ovirt.engine.core.compat.Version> versionsWithNull = new java.util.HashSet<org.ovirt.engine.core.compat.Version>(org.ovirt.engine.core.compat.Version.ALL); versionsWithNull.add(null); java.util.HashMap<org.ovirt.engine.core.common.utils.Pair<java.lang.Integer, org.ovirt.engine.core.compat.Version>, java.util.Set<java.lang.String>> unsupportedCpus = new java.util.HashMap<>(); for (int osId : getOsIds()) { for (org.ovirt.engine.core.compat.Version version : versionsWithNull) { unsupportedCpus.put(new org.ovirt.engine.core.common.utils.Pair(osId, version), getUnsupportedCpus(osId, version)); } } return unsupportedCpus; }
@org.ovirt.engine.ui.uicompat.DefaultMessage("Label {0} cannot be assigned to this interface, it is already assigned to interface {1}.") java.lang.String labelInUse(java.lang.String label, java.lang.String ifaceName);
public void setGlusterVersion(org.ovirt.engine.core.compat.RpmVersion value) { this.glusterVersion = value; }
private void sendWarningForNonExportableDisks(java.util.List<org.ovirt.engine.core.common.businessentities.Disk> nonExportableDisks) { if (!(nonExportableDisks.isEmpty())) { final java.util.List<java.lang.String> list = new java.util.ArrayList<java.lang.String>(); for (org.ovirt.engine.core.common.businessentities.Disk disk : nonExportableDisks) { list.add(disk.getDiskAlias()); } final java.lang.String s = org.ovirt.engine.ui.uicompat.external.StringUtils.join(list, ", "); getModel().setMessage(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getMessages().disksWillNotBePartOfTheExportedVMTemplate(s)); } }
@java.lang.Override public void onSelectionChange(com.google.gwt.view.client.SelectionChangeEvent event) { org.ovirt.engine.core.common.businessentities.Bookmark selectedObject = selectionModel.getSelectedObject(); java.util.List<org.ovirt.engine.core.common.businessentities.Bookmark> selectedItems = (selectedObject != null) ? new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Bookmark>(java.util.Arrays.asList(selectedObject)) : new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Bookmark>(); this.setSelectedItems(selectedItems); }
private void onConfigureVmsToImport() { final org.ovirt.engine.ui.uicommonweb.models.vms.ImportVmsModel importVmsModel = ((org.ovirt.engine.ui.uicommonweb.models.vms.ImportVmsModel) (org.ovirt.engine.ui.uicommonweb.models.vms.VmListModel.getWindow())); if (importVmsModel == null) { return; } org.ovirt.engine.ui.uicommonweb.models.vms.ImportVmFromExportDomainModel model = importVmsModel.getSpecificImportModel(); org.ovirt.engine.ui.uicommonweb.models.vms.VmListModel.setWindow(null); setWindow(model); }
@java.lang.Override protected void setActionMessageParameters() { addCanDoActionMessage(EngineMessage.VAR__ACTION__ADD); addCanDoActionMessage(EngineMessage.VAR__TYPE__LABEL); }
@java.lang.Override public com.google.gwt.safehtml.shared.SafeHtml getValue(org.ovirt.engine.core.common.utils.PairQueryable<org.ovirt.engine.core.common.businessentities.VDSGroup, org.ovirt.engine.core.common.businessentities.network.NetworkCluster> object) { java.util.List<com.google.gwt.safehtml.shared.SafeHtml> images = new java.util.LinkedList<>(); if ((object.getSecond()) != null) { if (object.getSecond().isManagement()) { images.add(managementImage); } else { images.add(emptyImage); } if (object.getSecond().isDisplay()) { images.add(displayImage); } else { images.add(emptyImage); } if (object.getSecond().isMigration()) { images.add(migrationImage); } else { images.add(emptyImage); } if (object.getSecond().isGluster()) { images.add(glusterNwImage); } else { images.add(emptyImage); } } return org.ovirt.engine.ui.webadmin.widget.table.column.NetworkRoleColumnHelper.getValue(images); }
private void createMenu(final java.util.List<org.ovirt.engine.core.common.businessentities.VdsNumaNode> numaNodeList, int indexToSkip) { menuBar = new org.ovirt.engine.ui.common.widget.MenuBar(true); for (final org.ovirt.engine.core.common.businessentities.VdsNumaNode numaNode : numaNodeList) { final int nodeIndex = numaNode.getIndex(); menuBar.addItem(org.ovirt.engine.ui.common.view.popup.numa.DraggableVirtualNumaPanel.messages.numaNode(nodeIndex), () -> { org.ovirt.engine.ui.common.presenter.popup.numa.UpdatedVnumaEvent.fire(this, nodeModel.getVm().getId(), true, nodeModel.getIndex(), nodeIndex); org.ovirt.engine.ui.common.view.popup.numa.DraggableVirtualNumaPanel.menuPopup.hide(); }); } if (nodeModel.isPinned()) { menuBar.addSeparator(); menuBar.addItem(org.ovirt.engine.ui.common.view.popup.numa.DraggableVirtualNumaPanel.constants.unPinNode(), () -> { org.ovirt.engine.ui.common.presenter.popup.numa.UpdatedVnumaEvent.fire(this, nodeModel.getVm().getId(), false, nodeModel.getIndex(), (-1)); org.ovirt.engine.ui.common.view.popup.numa.DraggableVirtualNumaPanel.menuPopup.hide(); }); } }
@org.junit.Test public void testGetAllForVmWithNonExistentVm() { java.util.List<org.ovirt.engine.core.common.businessentities.VmJob> jobs = dao.getAllForVm(Guid.Empty); assertTrue(jobs.isEmpty()); }
private boolean isVMPartOfManualPool() { if ((org.ovirt.engine.core.bll.RunVmCommand.getVm().getVmPoolId()) == null) { return false; } final org.ovirt.engine.core.common.businessentities.VmPool vmPool = org.ovirt.engine.core.bll.RunVmCommand.getDbFacade().getVmPoolDao().get(org.ovirt.engine.core.bll.RunVmCommand.getVm().getVmPoolId()); return vmPool.getVmPoolType().equals(VmPoolType.Manual); }
public static void GetMaxVmMemSize(org.ovirt.engine.ui.frontend.AsyncQuery aQuery, boolean is64) { aQuery.converterCallback = new org.ovirt.engine.ui.frontend.IAsyncConverter() { @java.lang.Override public java.lang.Object Convert(java.lang.Object source, org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery) { if (source != null) { return source; } return 262144; } }; org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.GetConfigFromCache(new org.ovirt.engine.core.common.queries.GetConfigurationValueParameters((is64 ? org.ovirt.engine.core.common.queries.ConfigurationValues.VM64BitMaxMemorySizeInMB : org.ovirt.engine.core.common.queries.ConfigurationValues.VM32BitMaxMemorySizeInMB), org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getDefaultConfigurationVersion()), aQuery); }
@org.junit.Test public void testFailedRoDiskResize() { org.ovirt.engine.core.common.businessentities.StorageDomain sd = new org.ovirt.engine.core.common.businessentities.StorageDomain(); sd.setAvailableDiskSize(java.lang.Integer.MAX_VALUE); sd.setStatus(StorageDomainStatus.Active); when(storageDomainDao.getForStoragePool(any(org.ovirt.engine.core.compat.Guid.class), any(org.ovirt.engine.core.compat.Guid.class))).thenReturn(sd); org.ovirt.engine.core.common.action.UpdateVmDiskParameters parameters = createParameters(); ((org.ovirt.engine.core.common.businessentities.storage.DiskImage) (parameters.getDiskInfo())).setSize(((parameters.getDiskInfo().getSize()) * 2)); initializeCommand(parameters); org.ovirt.engine.core.common.businessentities.storage.DiskImage oldDisk = createDiskImage(); doReturn(oldDisk).when(command).getOldDisk(); org.ovirt.engine.core.common.businessentities.VmDevice vmDevice = stubVmDevice(diskImageGuid, vmId); vmDevice.setIsReadOnly(true); assertFalse(command.validateCanResizeDisk()); org.ovirt.engine.core.bll.CanDoActionTestUtils.assertCanDoActionMessages("wrong failure", command, EngineMessage.ACTION_TYPE_FAILED_CANNOT_RESIZE_READ_ONLY_DISK); }
private static org.ovirt.engine.core.common.action.AddDiskParameters createParameters() { org.ovirt.engine.core.common.businessentities.storage.DiskImage image = new org.ovirt.engine.core.common.businessentities.storage.DiskImage(); org.ovirt.engine.core.common.businessentities.storage.DiskVmElement dve = new org.ovirt.engine.core.common.businessentities.storage.DiskVmElement(null, org.ovirt.engine.core.bll.storage.disk.AddDiskCommandTest.vmId); dve.setDiskInterface(DiskInterface.IDE); return new org.ovirt.engine.core.common.action.AddDiskParameters(dve, image); }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.VM> getAllForStoragePool(org.ovirt.engine.core.compat.Guid storagePoolId) { return getCallsHandler().executeReadList("GetAllForStoragePool", org.ovirt.engine.core.dao.VmDAODbFacadeImpl.VMRowMapper.instance, getCustomMapSqlParameterSource().addValue("storage_pool_id", storagePoolId)); }
@org.junit.Test public void shouldKeepSameMajorWithOlderMinor() { newEnoughHost.setHostOs("RHEL - 6.0 - 1.el6"); assertThat(filter(runningVm, newEnoughHost, currentHost)).containsExactly(newEnoughHost, currentHost); }
@java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { org.ovirt.engine.ui.uicommonweb.models.ListModel<org.ovirt.engine.core.common.businessentities.VDSGroup> clusterModel = hostModel.getCluster(); if ((clusterModel.getSelectedItem()) != null) { org.ovirt.engine.core.common.businessentities.VDSGroup cluster = clusterModel.getSelectedItem(); java.lang.Boolean jsonSupported = ((java.lang.Boolean) (org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getConfigValuePreConverted(ConfigurationValues.JsonProtocolSupported, cluster.getcompatibility_version().toString()))); if (jsonSupported) { hostModel.getProtocol().setEntity(true); } else { hostModel.getProtocol().setEntity(false); hostModel.getProtocol().setIsChangable(false); } } }
private boolean isStopProfileAvailable(java.util.List<org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity> list) { if ((getSelectedItems().size()) == 0) { return false; } else { for (org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity volumeEntity : list) { if ((volumeEntity.getStatus()) == (org.ovirt.engine.core.common.businessentities.gluster.GlusterStatus.DOWN)) { return false; } if (((volumeEntity.getOptionValue("diagnostics.latency-measurement")) == null) || (!(volumeEntity.getOptionValue("diagnostics.latency-measurement").equals("on")))) { return false; } } return true; } }
private org.ovirt.engine.core.compat.Guid getQuotaId() { if (((org.ovirt.engine.core.bll.AddDiskCommand.getParameters().getDiskInfo()) != null) && ((org.ovirt.engine.core.common.businessentities.storage.DiskStorageType.IMAGE) == (org.ovirt.engine.core.bll.AddDiskCommand.getParameters().getDiskInfo().getDiskStorageType()))) { org.ovirt.engine.core.compat.Guid quotaId = ((org.ovirt.engine.core.common.businessentities.storage.DiskImage) (org.ovirt.engine.core.bll.AddDiskCommand.getParameters().getDiskInfo())).getQuotaId(); if (!(Guid.Empty.equals(quotaId))) { return quotaId; } } return null; }
@java.lang.Override protected boolean validate() { slaveVolume = getSlaveVolume(); if ((slaveVolume) != null) { setGlusterVolumeId(slaveVolume.getId()); setVdsGroupId(slaveVolume.getClusterId()); } else { return failValidation(EngineMessage.ACTION_TYPE_FAILED_GLUSTER_VOLUME_INVALID); } if ((slaveVolume.getStatus()) != (org.ovirt.engine.core.common.businessentities.gluster.GlusterStatus.UP)) { return failValidation(EngineMessage.ACTION_TYPE_FAILED_GLUSTER_VOLUME_SHOULD_BE_STARTED); } return super.validate(); }
@org.junit.Test public void networkSet() throws java.lang.Exception { assertEquals(ValidationResult.VALID, validator.networkIsSet()); }
public org.ovirt.engine.ui.uicommonweb.models.EntityModel<org.ovirt.engine.core.common.businessentities.network.NetworkView> getNetwork() { return network; }
private void setUpEntityQueryExpectations(org.ovirt.engine.core.common.businessentities.VmTemplate result) throws java.lang.Exception { setUpEntityQueryExpectations(VdcQueryType.GetVmTemplate, org.ovirt.engine.core.common.queries.GetVmTemplateParameters.class, new java.lang.String[]{ "Id" }, new java.lang.Object[]{ org.ovirt.engine.api.restapi.resource.BackendTemplateCdromResourceTest.TEMPLATE_ID }, result); }
public java.lang.String getIp() { return ip; }
@org.junit.Test public void testNetworksUniquelyConfiguredOnHostWhenUniquelyConfigured() throws java.lang.Exception { org.ovirt.engine.core.common.businessentities.network.Network networkA = new org.ovirt.engine.core.common.businessentities.network.Network(); networkA.setId(org.ovirt.engine.core.compat.Guid.newGuid()); org.ovirt.engine.core.common.businessentities.network.Network networkB = new org.ovirt.engine.core.common.businessentities.network.Network(); networkB.setId(org.ovirt.engine.core.compat.Guid.newGuid()); org.ovirt.engine.core.common.businessentities.network.NetworkAttachment networkAttachmentA = createNetworkAttachment(networkA); org.ovirt.engine.core.common.businessentities.network.NetworkAttachment networkAttachmentB = createNetworkAttachment(networkB); org.ovirt.engine.core.bll.network.host.HostSetupNetworksValidator validator = createHostSetupNetworksValidator(java.util.Arrays.asList(networkA, networkB)); assertThat(validator.networksUniquelyConfiguredOnHost(java.util.Arrays.asList(networkAttachmentA, networkAttachmentB)), isValid()); }
public java.util.List<org.ovirt.engine.core.common.businessentities.UnmanagedNetwork> getUnmanagedNetworks(org.ovirt.engine.core.compat.Guid hostId) { java.util.List<org.ovirt.engine.core.common.businessentities.UnmanagedNetwork> unmanagedNetworks = new java.util.ArrayList<>(); org.ovirt.engine.core.common.businessentities.VDS host = vdsDao.get(hostId); if (host != null) { java.util.List<org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface> hostNetworkInterfaces = interfaceDao.getAllInterfacesForVds(hostId); org.ovirt.engine.core.common.businessentities.BusinessEntityMap<org.ovirt.engine.core.common.businessentities.network.Network> clusterNetworkMap = new org.ovirt.engine.core.common.businessentities.BusinessEntityMap(getClusterNetworks(host)); for (org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface vdsNetworkInterface : hostNetworkInterfaces) { java.lang.String networkName = vdsNetworkInterface.getNetworkName(); if ((networkName != null) && (!(clusterNetworkMap.containsKey(networkName)))) { unmanagedNetworks.add(createUnmanagedNetworkEntity(vdsNetworkInterface, networkName)); } } } return unmanagedNetworks; }
public org.ovirt.engine.core.common.businessentities.TemplateProvisioningMethod getTemplateProvisioningMethod() { return templateProvisioningMethod; }
@org.junit.Test public void testSecuredEventMailSender() { org.ovirt.engine.core.common.businessentities.EventAuditLogSubscriber eventData = new org.ovirt.engine.core.common.businessentities.EventAuditLogSubscriber(); eventData.setlog_time(new java.util.Date()); eventData.setevent_type(0); eventData.setuser_name("a test user name"); eventData.setvm_name("a fine test VM"); eventData.setvds_name("a fine test host"); eventData.setmethod_address("mailtest.redhat@gmail.com"); eventData.setvm_template_name("a test template"); eventData.setstorage_pool_name("a test storage pool name"); eventData.setstorage_domain_name("a test storage pool domain"); eventData.setseverity(3); org.ovirt.engine.core.notifier.utils.NotificationProperties.setDefaults("src/test/resources/conf/notifier-mail-test-secured.conf", "src/test/resources/conf/missing.conf"); org.ovirt.engine.core.notifier.utils.sender.mail.EventSenderMailImpl mailSender = new org.ovirt.engine.core.notifier.utils.sender.mail.EventSenderMailImpl(org.ovirt.engine.core.notifier.utils.NotificationProperties.getInstance()); eventData.setmessage("a test message to be sent via secured mode"); mailSender.send(eventData, null); org.ovirt.engine.core.notifier.utils.sender.EventSenderResult sentResult = null; try { sentResult = mailSender.send(eventData, null); } catch (java.lang.Exception e) { sentResult = new org.ovirt.engine.core.notifier.utils.sender.EventSenderResult(); sentResult.setSent(false); } assertTrue(sentResult.isSent()); }
protected void addVmInterfaces() { org.ovirt.engine.core.bll.network.VmInterfaceManager vmInterfaceManager = new org.ovirt.engine.core.bll.network.VmInterfaceManager(); java.util.List<java.lang.String> invalidNetworkNames = new java.util.ArrayList<java.lang.String>(); java.util.List<java.lang.String> invalidIfaceNames = new java.util.ArrayList<java.lang.String>(); java.util.Map<java.lang.String, org.ovirt.engine.core.common.businessentities.Network> networksInVdsByName = org.ovirt.engine.core.common.businessentities.Entities.entitiesByName(getNetworkDAO().getAllForCluster(getVm().getvds_group_id())); for (org.ovirt.engine.core.common.businessentities.VmNetworkInterface iface : getVm().getInterfaces()) { initInterface(iface); if (!(vmInterfaceManager.isValidVmNetwork(iface, networksInVdsByName))) { invalidNetworkNames.add(iface.getNetworkName()); invalidIfaceNames.add(iface.getName()); iface.setNetworkName(StringUtils.EMPTY); } vmInterfaceManager.add(iface, getCompensationContext(), getParameters().isImportAsNewEntity()); } auditInvalidInterfaces(invalidNetworkNames, invalidIfaceNames); }
@org.junit.Before public void setUp() { org.ovirt.engine.core.common.utils.SimpleDependencyInjector.getInstance().bind(org.ovirt.engine.core.common.osinfo.OsRepository.class, osRepository); command = spy(createCommand()); mockVds(); mockVmDevice(false); when(command.getActionType()).thenReturn(getCommandActionType()); org.ovirt.engine.core.bll.snapshots.SnapshotsValidator snapshotsValidator = mock(org.ovirt.engine.core.bll.snapshots.SnapshotsValidator.class); doReturn(snapshotsValidator).when(command).getSnapshotsValidator(); doReturn(ValidationResult.VALID).when(snapshotsValidator).vmNotDuringSnapshot(any(org.ovirt.engine.core.compat.Guid.class)); doReturn(ValidationResult.VALID).when(snapshotsValidator).vmNotInPreview(any(org.ovirt.engine.core.compat.Guid.class)); org.ovirt.engine.core.bll.validator.storage.StorageDomainValidator storageDomainValidator = mock(org.ovirt.engine.core.bll.validator.storage.StorageDomainValidator.class); doReturn(storageDomainValidator).when(command).getStorageDomainValidator(any(org.ovirt.engine.core.common.businessentities.StorageDomain.class)); doReturn(ValidationResult.VALID).when(storageDomainValidator).isDomainExistAndActive(); doReturn(vmNetworkInterfaceDao).when(command).getVmNetworkInterfaceDao(); doReturn(diskValidator).when(command).getDiskValidator(disk); doReturn(ValidationResult.VALID).when(diskValidator).isDiskExists(); doReturn(ValidationResult.VALID).when(diskValidator).isDiskAttachedToVm(vm); }
public org.ovirt.engine.core.bll.ValidationResult providerExist() { return org.ovirt.engine.core.bll.ValidationResult.failWith(EngineMessage.ACTION_TYPE_FAILED_PROVIDER_DOESNT_EXIST).when(((providerDao.get(libvirtSecret.getProviderId())) == null)); }
@org.junit.Test public void PctThresholdLessThanZero() { org.ovirt.engine.core.bll.command.utils.StorageDomainSpaceCheckerTest.SpaceTestSettings settings = new org.ovirt.engine.core.bll.command.utils.StorageDomainSpaceCheckerTest.SpaceTestSettings(); settings.diskSpaceFree = 10; settings.diskSpaceUsed = 0; settings.spaceThresholdGB = 5; settings.spaceThresholdPct = -10; org.ovirt.engine.core.common.businessentities.storage_domains domain = setupForSpaceTest(settings); assertTrue(org.ovirt.engine.core.bll.command.utils.StorageDomainSpaceChecker.isWithinThresholds(domain)); }
protected boolean updateVmImSpm() { java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.compat.KeyValuePairCompat<java.lang.String, java.util.List<org.ovirt.engine.core.compat.Guid>>> metaDictionary = new java.util.HashMap<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.compat.KeyValuePairCompat<java.lang.String, java.util.List<org.ovirt.engine.core.compat.Guid>>>(); org.ovirt.engine.core.bll.OvfDataUpdater.getInstance().loadVmData(org.ovirt.engine.core.bll.ExportVmCommand.getVm()); org.ovirt.engine.core.bll.VmHandler.updateDisksFromDb(org.ovirt.engine.core.bll.ExportVmCommand.getVm()); org.ovirt.engine.core.bll.OvfDataUpdater.getInstance().buildMetadataDictionaryForVm(org.ovirt.engine.core.bll.ExportVmCommand.getVm(), metaDictionary); return org.ovirt.engine.core.bll.OvfDataUpdater.getInstance().executeUpdateVmInSpmCommand(org.ovirt.engine.core.bll.ExportVmCommand.getVm().getStoragePoolId(), metaDictionary, org.ovirt.engine.core.bll.ExportVmCommand.getParameters().getStorageDomainId()); }
@java.lang.Override public void initialize() { super.initialize(); disableNonChangeableEntities(); getAlias().setEntity(getDisk().getDiskAlias()); getDescription().setEntity(getDisk().getDiskDescription()); getIsShareable().setEntity(getDisk().isShareable()); getIsWipeAfterDelete().setEntity(getDisk().isWipeAfterDelete()); getIsScsiPassthrough().setEntity(getDisk().isScsiPassthrough()); getIsSgIoUnfiltered().setEntity(((getDisk().getSgio()) == (org.ovirt.engine.core.common.businessentities.ScsiGenericIO.UNFILTERED))); getIsReadOnly().setEntity(getDisk().getReadOnly()); if ((getDisk().getDiskStorageType()) == (Disk.DiskStorageType.IMAGE)) { org.ovirt.engine.core.common.businessentities.DiskImage diskImage = ((org.ovirt.engine.core.common.businessentities.DiskImage) (getDisk())); getDiskStorageType().setEntity(Disk.DiskStorageType.IMAGE); getSize().setEntity(((int) (diskImage.getSizeInGigabytes()))); getVolumeType().setSelectedItem(diskImage.getVolumeType()); setVolumeFormat(diskImage.getVolumeFormat()); boolean isExtendImageSizeEnabled = (((getVm()) != null) && (!(diskImage.isDiskSnapshot()))) && (org.ovirt.engine.core.common.VdcActionUtils.canExecute(java.util.Arrays.asList(getVm()), org.ovirt.engine.core.common.businessentities.VM.class, VdcActionType.ExtendImageSize)); getSizeExtend().setIsChangable(isExtendImageSizeEnabled); } else { org.ovirt.engine.core.common.businessentities.LunDisk lunDisk = ((org.ovirt.engine.core.common.businessentities.LunDisk) (getDisk())); getDiskStorageType().setEntity(Disk.DiskStorageType.LUN); getSize().setEntity(lunDisk.getLun().getDeviceSize()); getSizeExtend().setIsAvailable(false); } updateReadOnlyChangeability(); updateWipeAfterDeleteChangeability(); }
private void callPersistNetworkAttachmentsAndVerifyThatNetworkAttachmentIsSynced(org.ovirt.engine.core.common.businessentities.network.NetworkAttachment attachment, org.ovirt.engine.core.vdsbroker.vdsbroker.HostNetworkAttachmentsPersister persister) { when(networkAttachmentDao.getAllForHost(eq(hostId))).thenReturn(java.util.Collections.singletonList(attachment)); persister.persistNetworkAttachments(); verify(networkAttachmentDao).getAllForHost(any(org.ovirt.engine.core.compat.Guid.class)); verify(networkAttachmentDao).update(argThat(new org.mockito.ArgumentMatcher<org.ovirt.engine.core.common.businessentities.network.NetworkAttachment>() { @java.lang.Override public boolean matches(java.lang.Object o) { if (!(o instanceof org.ovirt.engine.core.common.businessentities.network.NetworkAttachment)) { return false; } org.ovirt.engine.core.common.businessentities.network.IpConfiguration ipConfiguration = org.ovirt.engine.core.common.utils.NetworkCommonUtils.createIpConfigurationFromVdsNetworkInterface(interfaceWithAttachedClusterNetworkA); org.ovirt.engine.core.common.businessentities.network.NetworkAttachment networkAttachment = ((org.ovirt.engine.core.common.businessentities.network.NetworkAttachment) (o)); return ((((((networkAttachment.getId()) != null) && (networkAttachment.getId().equals(attachment.getId()))) && ((networkAttachment.getNicId()) != null)) && (networkAttachment.getNicId().equals(interfaceWithAttachedClusterNetworkA.getId()))) && (java.util.Objects.equals(networkAttachment.getIpConfiguration(), ipConfiguration))) && (java.util.Objects.equals(networkAttachment.getProperties(), customPropertiesForNics.getCustomPropertiesFor(interfaceWithAttachedClusterNetworkA))); } })); verifyNoMoreInteractions(networkAttachmentDao); }
private static java.util.List<java.lang.String> assertCanDoActionMessages(java.lang.String assertionMessage, org.ovirt.engine.core.bll.CommandBase<?> command, org.ovirt.engine.core.common.errors.VdcBllMessages message) { java.util.List<java.lang.String> canDoActionMessages = command.getReturnValue().getCanDoActionMessages(); assertTrue(java.text.MessageFormat.format("{0}canDoAction messages doesn''t contain expected message: {1}, messages are: {2}", org.ovirt.engine.core.bll.CanDoActionTestUtils.optionalMessage(assertionMessage), message.name(), canDoActionMessages), canDoActionMessages.contains(message.name())); return canDoActionMessages; }
public void setProfile(T profile) { this.profile = profile; }
@org.junit.Test public void testSetDetectEmulatedMachine() { boolean preUpdate = existingCluster.isDetectEmulatedMachine(); boolean updateValue = false; assertNotEquals(updateValue, preUpdate); dao.setEmulatedMachine(existingCluster.getId(), existingCluster.getEmulatedMachine(), updateValue); assertEquals(updateValue, dao.get(existingCluster.getId()).isDetectEmulatedMachine()); }
@org.ovirt.engine.ui.frontend.DefaultStringValue("The engine is not associated with a Foreman/Satellite provider. No errata for the engine are available.") java.lang.String NO_FOREMAN_PROVIDER_FOR_ENGINE();
private org.ovirt.engine.ui.frontend.server.dashboard.Dashboard populateUtilizationCache() throws org.ovirt.engine.ui.frontend.server.dashboard.DashboardDataException { long startTime = java.lang.System.currentTimeMillis(); org.ovirt.engine.ui.frontend.server.dashboard.Dashboard dashboard = getDashboard(); long endTime = java.lang.System.currentTimeMillis(); org.ovirt.engine.ui.frontend.server.dashboard.DashboardDataServlet.dashboardCache.put(org.ovirt.engine.ui.frontend.server.dashboard.DashboardDataServlet.UTILIZATION_KEY, dashboard, org.ovirt.engine.ui.frontend.server.dashboard.DashboardDataServlet.UTILIZATION_CACHE_UPDATE_INTERVAL, java.util.concurrent.TimeUnit.SECONDS); org.ovirt.engine.ui.frontend.server.dashboard.DashboardDataServlet.log.debug("Dashboard utilization cache updated in {}ms", (endTime - startTime)); return dashboard; }
@java.lang.Override protected void setActionMessageParameters() { addValidationMessage(EngineMessage.VAR__ACTION__ADD); addValidationMessage(EngineMessage.VAR__TYPE__GLUSTER_BRICK); }
protected void unlockVm() { org.ovirt.engine.core.bll.VmCommand.setVm(null); if ((org.ovirt.engine.core.bll.VmCommand.getVm()) != null) { if ((org.ovirt.engine.core.bll.VmCommand.getVm().getStatus()) == (org.ovirt.engine.core.common.businessentities.VMStatus.ImageLocked)) { org.ovirt.engine.core.bll.VmHandler.unlockVm(org.ovirt.engine.core.bll.VmCommand.getVm(), org.ovirt.engine.core.bll.VmCommand.getCompensationContext()); } } else { setLoggingForCommand(); log.warn("VM is null - no unlocking"); } }
@com.google.gwt.i18n.client.Constants.DefaultStringValue("Cluster Policy(ies):") java.lang.String removeClusterPolicyMessage();
public java.lang.Boolean call() throws java.lang.Exception { if (Version.v4_1.lessOrEquals(clusterVersion)) { _deploy.getParser().cliEnvironmentSet(java.lang.String.format("%svars/ssl_excludes", VdsmEnv.CONFIG_PREFIX), "OP_NO_TLSv1,OP_NO_TLSv1_1"); } return true; }
public void setNfsServers(org.ovirt.engine.ui.uicommonweb.models.ListModel<org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeProfileStats> nfsServers) { this.nfsServers = nfsServers; }
static java.lang.String getAppList() { java.lang.StringBuilder buf = new java.lang.StringBuilder(); for (java.lang.String name : NAMES) { if ((buf.length()) > 0) { buf.append(","); } buf.append(name); } return buf.toString(); }
@java.lang.Override protected void setActionMessageParameters() { addCanDoActionMessage(EngineMessage.VAR__ACTION__SET); addCanDoActionMessage(EngineMessage.VAR__TYPE__GLUSTER_GEOREP_CONFIG); addCanDoActionMessageVariable("configName", getParameters().getConfigKey()); addCanDoActionMessageVariable("geoRepSessionKey", getGeoRepSession().getSessionKey()); addCanDoActionMessageVariable("configValue", getParameters().getConfigValue()); }
@org.junit.Test public void asMapTwoConvItems() throws java.io.IOException { schedule.addStallingStep(new org.ovirt.engine.core.common.migration.ConvergenceItemWithStallingLimit(8, "action", 10)).addStallingStep(new org.ovirt.engine.core.common.migration.ConvergenceItemWithStallingLimit(12, "action2", 12)); assertEquals(new org.ovirt.engine.core.bll.migration.ConvergenceScheduleTest.ExpectedConvergence().addStalling(8, "action", 10).addStalling(12, "action2", 12), schedule.asMap()); }
@java.lang.SuppressWarnings("unchecked") @org.junit.Test public void testExecuteCommand() { cmd = spy(new org.ovirt.engine.core.bll.gluster.CommitRemoveGlusterVolumeBricksCommand(new org.ovirt.engine.core.common.action.gluster.GlusterVolumeRemoveBricksParameters(volumeWithRemoveBricksTask, getBricks(volumeWithRemoveBricksTask, 2)))); prepareMocks(cmd); mockBackend(true, null); assertTrue(cmd.canDoAction()); cmd.executeCommand(); verify(cmd, times(1)).endStepJobCommitted(); verify(cmd, times(1)).releaseVolumeLock(); assertEquals(cmd.getAuditLogTypeValue(), AuditLogType.GLUSTER_VOLUME_REMOVE_BRICKS_COMMIT); }
@java.lang.Override public void onValidationComplete(org.ovirt.engine.ui.uicommonweb.models.ValidationCompleteEvent event) { if (((event.getModel()) != null) && (event.getModel().equals(presenterWidget.getModel()))) { java.util.Set<org.ovirt.engine.ui.uicommonweb.models.TabName> invalidTabs = ((org.ovirt.engine.ui.uicommonweb.models.HasValidatedTabs) (presenterWidget.getModel())).getInvalidTabs(); java.util.Map<org.ovirt.engine.ui.uicommonweb.models.TabName, org.ovirt.engine.ui.common.widget.dialog.tab.DialogTab> mapping = view.getTabNameMapping(); org.ovirt.engine.ui.common.utils.ValidationTabSwitchHelper.markTabs(invalidTabs, mapping); for (org.ovirt.engine.ui.uicommonweb.models.TabName invalidTabName : invalidTabs) { if (view.getTabPanel().getActiveTab().equals(mapping.get(invalidTabName))) { return; } } org.ovirt.engine.ui.common.utils.ValidationTabSwitchHelper.switchTab(invalidTabs, mapping, view); } }
protected void disableElement(com.google.gwt.dom.client.Element element) { element.getStyle().setProperty("disabled", "true"); element.getStyle().setColor("#999999"); if ((getNodeDisabledTooltip()) != null) { org.ovirt.engine.ui.common.widget.tooltip.ElementTooltipUtils.setTooltipOnElement(getNodeDisabledTooltip(), element); } }
public org.ovirt.engine.core.common.businessentities.storage.QemuImageInfo getQemuImageInfoFromVdsm(org.ovirt.engine.core.compat.Guid storagePoolId, org.ovirt.engine.core.compat.Guid newStorageDomainID, org.ovirt.engine.core.compat.Guid newImageGroupId, org.ovirt.engine.core.compat.Guid newImageId, org.ovirt.engine.core.compat.Guid vdsId, boolean shouldPrepareAndTeardown) { if (vdsId == null) { vdsId = vdsCommandsHelper.getHostForExecution(storagePoolId); } org.ovirt.engine.core.common.businessentities.storage.QemuImageInfo qemuImageInfo = null; if (shouldPrepareAndTeardown) { prepareImage(storagePoolId, newStorageDomainID, newImageGroupId, newImageId, vdsId); } try { qemuImageInfo = ((org.ovirt.engine.core.common.businessentities.storage.QemuImageInfo) (resourceManager.runVdsCommand(VDSCommandType.GetQemuImageInfo, new org.ovirt.engine.core.common.vdscommands.GetVolumeInfoVDSCommandParameters(vdsId, storagePoolId, newStorageDomainID, newImageGroupId, newImageId)).getReturnValue())); } catch (java.lang.Exception e) { org.ovirt.engine.core.bll.storage.disk.image.ImagesHandler.log.error("Unable to get qemu image info from storage", e); } finally { if (shouldPrepareAndTeardown) { try { teardownImage(storagePoolId, newStorageDomainID, newImageGroupId, newImageId, vdsId); } catch (java.lang.Exception e) { org.ovirt.engine.core.bll.storage.disk.image.ImagesHandler.log.warn("Unable to tear down image", e); } } } return qemuImageInfo; }
@org.junit.Test public void checkExecuteCommandWithNullVdsId() { parameters.setStorageServerConnection(NFSConnection); parameters.setVdsId(null); doNothing().when(storageServerConnectionDAO).remove(NFSConnection.getid()); command.executeCommand(); verify(command, never()).disconnectStorage(); }
private boolean singleHostSelected(java.util.List<org.ovirt.engine.core.common.businessentities.VDS> items) { return ((items.size()) == 1) && ((items.get(0)) instanceof org.ovirt.engine.core.common.businessentities.VDS); }
private void performDiskUpdate(final boolean unlockImage) { final org.ovirt.engine.core.common.businessentities.Disk disk = org.ovirt.engine.core.bll.UpdateVmDiskCommand.getDiskDao().get(org.ovirt.engine.core.bll.UpdateVmDiskCommand.getParameters().getDiskId()); applyUserChanges(disk); org.ovirt.engine.core.utils.transaction.TransactionSupport.executeInNewTransaction(new org.ovirt.engine.core.utils.transaction.TransactionMethod<java.lang.Object>() { @java.lang.Override public java.lang.Object runInTransaction() { getVmStaticDAO().incrementDbGeneration(getVm().getId()); updateDeviceProperties(); getBaseDiskDao().update(disk); if ((disk.getDiskStorageType()) == (org.ovirt.engine.core.common.businessentities.Disk.DiskStorageType.IMAGE)) { org.ovirt.engine.core.common.businessentities.DiskImage diskImage = ((org.ovirt.engine.core.common.businessentities.DiskImage) (disk)); diskImage.setQuotaId(getQuotaId()); if (unlockImage && ((diskImage.getImageStatus()) == (org.ovirt.engine.core.common.businessentities.ImageStatus.LOCKED))) { diskImage.setImageStatus(ImageStatus.OK); } getImageDao().update(diskImage.getImage()); updateQuota(diskImage); updateDiskProfile(); } reloadDisks(); updateBootOrder(); setSucceeded(true); return null; } private void updateDeviceProperties() { if (updateReadOnlyRequested()) { vmDeviceForVm.setIsReadOnly(getNewDisk().getReadOnly()); getVmDeviceDao().update(vmDeviceForVm); } if ((getOldDisk().getDiskInterface()) != (getNewDisk().getDiskInterface())) { getVmDeviceDao().clearDeviceAddress(getOldDisk().getId()); } } }); }
@java.lang.Override public org.ovirt.engine.core.compat.Guid getMasterStorageDomainIdForPool(org.ovirt.engine.core.compat.Guid poolId) { return getStorageDomainId(poolId, StorageDomainType.Master); }
@java.lang.Override public void onSuccess(java.lang.String content) { getContentModel().getContent().setEntity(content); stopProgress(); }
@java.lang.Override protected void executeCommand() { if (org.ovirt.engine.core.bll.RemoveVmTemplateCommand.getVmTemplate().isBaseTemplate()) { shiftBaseTemplateToSuccessor(); } final java.util.List<org.ovirt.engine.core.common.businessentities.storage.CinderDisk> cinderDisks = org.ovirt.engine.core.bll.ImagesHandler.filterDisksBasedOnCinder(org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getDiskDao().getAllForVm(org.ovirt.engine.core.bll.RemoveVmTemplateCommand.getVmTemplateId())); org.ovirt.engine.core.bll.VmTemplateHandler.lockVmTemplateInTransaction(org.ovirt.engine.core.bll.RemoveVmTemplateCommand.getVmTemplateId(), org.ovirt.engine.core.bll.RemoveVmTemplateCommand.getCompensationContext()); if ((!(imageTemplates.isEmpty())) || (!(cinderDisks.isEmpty()))) { org.ovirt.engine.core.utils.transaction.TransactionSupport.executeInNewTransaction(new org.ovirt.engine.core.utils.transaction.TransactionMethod<java.lang.Void>() { @java.lang.Override public java.lang.Void runInTransaction() { if ((!(imageTemplates.isEmpty())) && (removeVmTemplateImages())) { org.ovirt.engine.core.bll.VmHandler.removeVmInitFromDB(getVmTemplate()); setSucceeded(true); } if (!(cinderDisks.isEmpty())) { removeCinderDisks(cinderDisks); setSucceeded(true); } return null; } }); } else { HandleEndAction(); } }
private com.google.gwt.user.client.ui.Grid createBaseVlanRow(com.google.gwt.user.client.ui.Widget checkBoxWidget, boolean networkManagementFlag, java.lang.String networkName, java.lang.String address) { com.google.gwt.user.client.ui.Grid row = new com.google.gwt.user.client.ui.Grid(1, 3); row.getColumnFormatter().setWidth(0, org.ovirt.engine.ui.webadmin.widget.host.VLanPanel.CHECK_BOX_COLUMN_WIDTH); row.getColumnFormatter().setWidth(1, org.ovirt.engine.ui.webadmin.widget.host.VLanPanel.NETWORK_NAME_COLUMN_WIDTH); row.getColumnFormatter().setWidth(2, org.ovirt.engine.ui.webadmin.widget.host.VLanPanel.ADDRESS_COLUMN_WIDTH); row.setWidth("100%"); row.setHeight("100%"); row.setWidget(0, 0, checkBoxWidget); com.google.gwt.user.client.ui.Label networkNameLabel = new com.google.gwt.user.client.ui.Label(networkName); if (networkManagementFlag) { networkNameLabel.getElement().getStyle().setFontWeight(FontWeight.BOLD); networkNameLabel.setText(("* " + networkName)); } row.setWidget(0, 1, networkNameLabel); row.setWidget(0, 2, new com.google.gwt.user.client.ui.Label(address)); return row; }
private void UpdateProperties() { org.ovirt.engine.core.common.businessentities.VDS vds = getEntity(); setOS(vds.gethost_os()); setKernelVersion(vds.getkernel_version()); setKvmVersion(vds.getkvm_version()); setLibvirtVersion(vds.getlibvirt_version()); setVdsmVersion(vds.getVersion()); setSpiceVersion(vds.getspice_version()); setIScsiInitiatorName(vds.getIScsiInitiatorName()); setActiveVms(vds.getvm_active()); setCpuName(((vds.getCpuName()) != null ? vds.getCpuName().getCpuName() : null)); setCpuType(vds.getcpu_model()); setNumberOfSockets(vds.getcpu_sockets()); setCoresPerSocket((((vds.getcpu_cores()) != null) && ((vds.getcpu_sockets()) != null) ? (vds.getcpu_cores()) / (vds.getcpu_sockets()) : null)); if (((vds.getvds_group_compatibility_version()) != null) && ((Version.v3_2.compareTo(vds.getvds_group_compatibility_version())) > 0)) { setThreadsPerCore("Unsupported"); } else if (((vds.getCpuThreads()) == null) || ((vds.getcpu_cores()) == null)) { setThreadsPerCore("Unknown"); } else { java.lang.Integer threads = (vds.getCpuThreads()) / (vds.getcpu_cores()); setThreadsPerCore(((threads.toString()) + (threads > 1 ? " (SMT Enabled)" : " (SMT Disabled)"))); } setPhysicalMemory(vds.getphysical_mem_mb()); setSwapTotal(vds.getswap_total()); setSwapFree(vds.getswap_free()); setSharedMemory(vds.getmem_shared_percent()); setMemoryPageSharing(vds.getksm_state()); setAutomaticLargePage(vds.getTransparentHugePagesState()); }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("Enable KSM") java.lang.String enableKsmLabel();
@java.lang.Override public void edit(final org.ovirt.engine.ui.uicommonweb.models.providers.NeutronAgentModel model) { qpidTitle.setVisible(model.getIsAvailable()); interfaceMappings.setLabel(((java.lang.String) (model.getInterfaceMappingsLabel().getEntity()))); model.getPropertyChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { if ("IsAvailable".equals(((org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs) (args)).PropertyName)) { qpidTitle.setVisible(model.getIsAvailable()); } } }); model.getInterfaceMappingsLabel().getEntityChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { interfaceMappings.setLabel(((java.lang.String) (model.getInterfaceMappingsLabel().getEntity()))); } }); driver.edit(model); }
@java.lang.Override public java.lang.Object runInTransaction() { final org.ovirt.engine.core.common.businessentities.StorageDomainType sdType = getStorageDomain().getStorageDomainType(); map.setStatus(StorageDomainStatus.Maintenance); getStoragePoolIsoMapDAO().updateStatus(map.getId(), map.getStatus()); if (sdType == (org.ovirt.engine.core.common.businessentities.StorageDomainType.Master)) { calcStoragePoolStatusByDomainsStatus(); } if ((sdType == (org.ovirt.engine.core.common.businessentities.StorageDomainType.Data)) || (sdType == (org.ovirt.engine.core.common.businessentities.StorageDomainType.Master))) { updateStorageDomainFormat(getStorageDomain()); } java.util.List<org.ovirt.engine.core.common.businessentities.DiskImage> ovfStoreDiskImages = getAllOVFDisks(getParameters().getStorageDomainId(), getStoragePoolIdFromVds()); registerAllOvfDisks(ovfStoreDiskImages, getParameters().getStorageDomainId()); for (org.ovirt.engine.core.common.businessentities.OvfEntityData ovf : unregisteredEntitiesFromOvfDisk) { getUnregisteredOVFDataDao().removeEntity(ovf.getEntityId(), getParameters().getStorageDomainId()); getUnregisteredOVFDataDao().saveOVFData(ovf); log.infoFormat("Adding OVF data of entity id {0} and entity name {1}", ovf.getEntityId(), ovf.getEntityName()); } return null; }
@java.lang.Override public boolean equals(java.lang.Object obj) { if ((this) == obj) { return true; } if (obj == null) { return false; } if ((getClass()) != (obj.getClass())) { return false; } org.ovirt.engine.core.common.businessentities.VmPool other = ((org.ovirt.engine.core.common.businessentities.VmPool) (obj)); return (((((((org.ovirt.engine.core.common.utils.ObjectUtils.objectsEqual(id, other.id)) && ((defaultTimeInDays) == (other.defaultTimeInDays))) && (org.ovirt.engine.core.common.utils.ObjectUtils.objectsEqual(parameters, other.parameters))) && (org.ovirt.engine.core.common.utils.ObjectUtils.objectsEqual(vdsGroupId, other.vdsGroupId))) && (org.ovirt.engine.core.common.utils.ObjectUtils.objectsEqual(description, other.description))) && (org.ovirt.engine.core.common.utils.ObjectUtils.objectsEqual(name, other.name))) && (org.ovirt.engine.core.common.utils.ObjectUtils.objectsEqual(type, other.type))) && ((maxAssignedVmsPerUser) == (other.maxAssignedVmsPerUser)); }
private static void updateNetworkDetailsInInterface(org.ovirt.engine.core.common.businessentities.VdsNetworkInterface iface, java.util.Map<java.lang.String, java.lang.Integer> currVlans, java.util.Map<java.lang.String, java.lang.Integer> networkVlans, java.util.Map<java.lang.String, java.lang.Object> network, org.ovirt.engine.core.common.businessentities.Network net, boolean bridged) { if (iface != null) { iface.setNetworkName(net.getname()); if (currVlans.containsKey(iface.getName())) { networkVlans.put(net.getname(), currVlans.get(iface.getName())); } if (org.apache.commons.lang.StringUtils.equals(iface.getNetworkName(), org.ovirt.engine.core.utils.NetworkUtils.getEngineNetwork())) { iface.setType(((iface.getType()) | (VdsInterfaceType.Management.getValue()))); } iface.setAddress(net.getaddr()); iface.setSubnet(net.getsubnet()); iface.setBridged(bridged); org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.setGatewayIfManagementNetwork(iface, net.getgateway()); java.util.Map<java.lang.String, java.lang.Object> networkConfigAsMap = ((java.util.Map<java.lang.String, java.lang.Object>) (((network.get("cfg")) instanceof java.util.Map) ? network.get("cfg") : null)); org.ovirt.engine.core.vdsbroker.xmlrpc.XmlRpcStruct networkConfig = (networkConfigAsMap == null) ? null : new org.ovirt.engine.core.vdsbroker.xmlrpc.XmlRpcStruct(networkConfigAsMap); org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.AddBootProtocol(networkConfig, iface); } }
protected abstract java.lang.String getReason(T value);
protected org.ovirt.engine.core.common.vdscommands.CreateVDSCommandParameters buildCreateVmParameters() { org.ovirt.engine.core.common.vdscommands.CreateVDSCommandParameters parameters = new org.ovirt.engine.core.common.vdscommands.CreateVDSCommandParameters(org.ovirt.engine.core.bll.RunVmCommand.getVdsId(), org.ovirt.engine.core.bll.RunVmCommand.getVm()); parameters.setRunInUnknownStatus(org.ovirt.engine.core.bll.RunVmCommand.getParameters().isRunInUnknownStatus()); parameters.setVmPayload(vmPayload); parameters.setHibernationVolHandle(getMemoryFromActiveSnapshot()); parameters.setPassthroughVnicToVfMap(flushPassthroughVnicToVfMap()); if ((((initializationType) == (org.ovirt.engine.core.common.businessentities.InitializationType.Sysprep)) && (osRepository.isWindows(org.ovirt.engine.core.bll.RunVmCommand.getVm().getVmOsId()))) && (((org.ovirt.engine.core.bll.RunVmCommand.getVm().getFloppyPath()) == null) || ("".equals(org.ovirt.engine.core.bll.RunVmCommand.getVm().getFloppyPath())))) { parameters.setInitializationType(InitializationType.Sysprep); } if (((initializationType) == (org.ovirt.engine.core.common.businessentities.InitializationType.CloudInit)) && (!(osRepository.isWindows(org.ovirt.engine.core.bll.RunVmCommand.getVm().getVmOsId())))) { parameters.setInitializationType(InitializationType.CloudInit); } return parameters; }
@java.lang.Override public java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.VdcObjectType> getJobSubjectEntityByJobId(org.ovirt.engine.core.compat.Guid jobId) { org.springframework.jdbc.core.namedparam.MapSqlParameterSource parameterSource = getCustomMapSqlParameterSource().addValue("job_id", jobId); java.util.List<org.ovirt.engine.core.common.businessentities.SubjectEntity> list = getCallsHandler().executeReadList("GetJobSubjectEntityByJobId", org.ovirt.engine.core.dao.JobSubjectEntityDaoImpl.jobSubjectEntityRowMapper, parameterSource); java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.VdcObjectType> entityMap = new java.util.HashMap<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.VdcObjectType>(); for (org.ovirt.engine.core.common.businessentities.SubjectEntity jobSubjectEntity : list) { entityMap.put(jobSubjectEntity.getEntityId(), jobSubjectEntity.getEntityType()); } return entityMap; }
private void setDomain(org.ovirt.engine.ui.uicommonweb.models.EntityModel<java.lang.String> value) { privateDomain = value; }
private int getResourceType(org.ovirt.engine.core.utils.ovf.xml.XmlNode node, java.lang.String resource) { if (((selectSingleNode(node, resource, _xmlNS)) != null) && (!(org.apache.commons.lang.StringUtils.isEmpty(selectSingleNode(node, resource, _xmlNS).innerText)))) { return java.lang.Integer.parseInt(selectSingleNode(node, resource, _xmlNS).innerText); } return -1; }
@java.lang.Override protected org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeTaskStatusEntity fetchTaskStatusDetails() { org.ovirt.engine.core.common.vdscommands.VDSReturnValue returnValue = runVdsCommand(VDSCommandType.GetGlusterVolumeRemoveBricksStatus, new org.ovirt.engine.core.common.vdscommands.gluster.GlusterVolumeRemoveBricksVDSParameters(getUpServerId(clusterId), volume.getName(), org.ovirt.engine.core.bll.gluster.GetGlusterVolumeRemoveBricksStatusQuery.getParameters().getBricks(), volume.getReplicaCount())); org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeTaskStatusEntity entity = ((org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeTaskStatusEntity) (returnValue.getReturnValue())); org.ovirt.engine.core.common.asynctasks.gluster.GlusterAsyncTask asyncTask = volume.getAsyncTask(); if (asyncTask != null) { org.ovirt.engine.core.common.job.JobExecutionStatus jobStatusWithEngine = volume.getAsyncTask().getStatus(); updateStatusEntity(entity); if (jobStatusWithEngine == (org.ovirt.engine.core.common.job.JobExecutionStatus.ABORTED)) { entity.getStatusSummary().setStatus(JobExecutionStatus.ABORTED); } } return entity; }
@org.junit.Test public void testAllDomainsWithinTheshold() { setUpGeneralValidations(); setUpDiskValidations(); doReturn(org.ovirt.engine.core.bll.CreateAllSnapshotsFromVmCommandTest.getNonEmptyDiskList()).when(cmd).getDisksList(); doReturn(new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.dal.VdcBllMessages.ACTION_TYPE_FAILED_DISK_SPACE_LOW_ON_TARGET_STORAGE_DOMAIN)).when(multipleStorageDomainsValidator).allDomainsExistAndActive(); assertFalse(cmd.canDoAction()); assertTrue(cmd.getReturnValue().getCanDoActionMessages().contains(VdcBllMessages.ACTION_TYPE_FAILED_DISK_SPACE_LOW_ON_TARGET_STORAGE_DOMAIN.name())); }
@org.junit.Test public void testInterfaceInHostWhenInDifferentHost() throws java.lang.Exception { org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface vdsNetworkInterface = createVdsNetworkInterfaceWithName(); vdsNetworkInterface.setVdsId(org.ovirt.engine.core.compat.Guid.newGuid()); org.ovirt.engine.core.compat.Guid hostId = org.ovirt.engine.core.compat.Guid.newGuid(); org.hamcrest.Matcher<org.ovirt.engine.core.bll.ValidationResult> matcher = org.ovirt.engine.core.bll.validator.ValidationResultMatchers.failsWith(EngineMessage.NIC_NOT_EXISTS_ON_HOST, org.ovirt.engine.core.utils.ReplacementUtils.createSetVariableString(HostInterfaceValidator.VAR_NIC_NOT_EXISTS_ON_HOST_ENTITY, hostId.toString())); assertThat(new org.ovirt.engine.core.bll.validator.HostInterfaceValidator(vdsNetworkInterface).interfaceInHost(hostId), matcher); }
private java.util.List<org.ovirt.engine.core.common.vdscommands.HostNetwork> getNetworksToConfigure() { if ((networksToConfigure) == null) { networksToConfigure = new java.util.ArrayList(org.ovirt.engine.core.bll.network.host.HostSetupNetworksCommand.getParameters().getNetworkAttachments().size()); org.ovirt.engine.core.common.businessentities.BusinessEntityMap<org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface> nics = new org.ovirt.engine.core.common.businessentities.BusinessEntityMap(getExistingNics()); for (org.ovirt.engine.core.common.businessentities.network.NetworkAttachment attachment : org.ovirt.engine.core.bll.network.host.HostSetupNetworksCommand.getParameters().getNetworkAttachments()) { org.ovirt.engine.core.common.businessentities.network.Network network = existingNetworkRelatedToAttachment(attachment); org.ovirt.engine.core.common.vdscommands.HostNetwork networkToConfigure = new org.ovirt.engine.core.common.vdscommands.HostNetwork(network, attachment); networkToConfigure.setBonding(isBonding(attachment, nics)); if ((defaultRouteSupported()) && (defaultRouteRequired(network, attachment.getIpConfiguration()))) { networkToConfigure.setDefaultRoute(true); } org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface iface = nics.get(attachment.getNicId(), attachment.getNicName()); boolean qosConfiguredOnInterface = (iface == null) ? false : org.ovirt.engine.core.utils.NetworkUtils.qosConfiguredOnInterface(iface, network); networkToConfigure.setQosConfiguredOnInterface(qosConfiguredOnInterface); if (qosConfiguredOnInterface) { networkToConfigure.setQos((iface.isQosOverridden() ? iface.getQos() : qosDao.get(network.getQosId()))); } networksToConfigure.add(networkToConfigure); } } return networksToConfigure; }
@java.lang.Override protected boolean validate() { if (org.ovirt.engine.core.bll.storage.disk.ChangeDiskCommand.shouldSkipCommandExecutionCached()) { return true; } if ((org.ovirt.engine.core.bll.storage.disk.ChangeDiskCommand.getVm()) == null) { return failValidation(EngineMessage.ACTION_TYPE_FAILED_VM_NOT_FOUND); } if (!(org.ovirt.engine.core.bll.storage.disk.ChangeDiskCommand.canRunActionOnNonManagedVm())) { return false; } if (!(org.ovirt.engine.core.bll.storage.disk.ChangeDiskCommand.getVm().isRunningOrPaused())) { return org.ovirt.engine.core.bll.storage.disk.ChangeDiskCommand.failVmStatusIllegal(); } if (((org.ovirt.engine.core.bll.storage.domain.IsoDomainListSyncronizer.getInstance().findActiveISODomain(org.ovirt.engine.core.bll.storage.disk.ChangeDiskCommand.getVm().getStoragePoolId())) == null) && (!(org.apache.commons.lang.StringUtils.isEmpty(cdImagePath)))) { return failValidation(EngineMessage.VM_CANNOT_WITHOUT_ACTIVE_STORAGE_DOMAIN_ISO); } if ((org.apache.commons.lang.StringUtils.isNotEmpty(cdImagePath)) && (!(org.apache.commons.lang.StringUtils.endsWithIgnoreCase(cdImagePath, ValidationUtils.ISO_SUFFIX)))) { return failValidation(EngineMessage.ACTION_TYPE_FAILED_INVALID_CDROM_DISK_FORMAT); } return true; }
protected boolean pciAndIdeWithinLimit(org.ovirt.engine.core.common.businessentities.VM vm, java.util.List<org.ovirt.engine.core.common.businessentities.network.VmNic> allInterfaces) { java.util.List<org.ovirt.engine.core.common.businessentities.Disk> allDisks = org.ovirt.engine.core.bll.network.vm.AbstractVmInterfaceCommand.getDiskDao().getAllForVm(org.ovirt.engine.core.bll.network.vm.AbstractVmInterfaceCommand.getVmId()); return checkPciAndIdeLimit(vm.getOs(), vm.getVdsGroupCompatibilityVersion(), vm.getNumOfMonitors(), allInterfaces, allDisks, org.ovirt.engine.core.bll.utils.VmDeviceUtils.isVirtioScsiControllerAttached(org.ovirt.engine.core.bll.network.vm.AbstractVmInterfaceCommand.getVmId()), org.ovirt.engine.core.bll.utils.VmDeviceUtils.hasWatchdog(org.ovirt.engine.core.bll.network.vm.AbstractVmInterfaceCommand.getVmId()), org.ovirt.engine.core.bll.utils.VmDeviceUtils.isBalloonEnabled(org.ovirt.engine.core.bll.network.vm.AbstractVmInterfaceCommand.getVmId()), org.ovirt.engine.core.bll.utils.VmDeviceUtils.isSoundDeviceEnabled(org.ovirt.engine.core.bll.network.vm.AbstractVmInterfaceCommand.getVmId()), org.ovirt.engine.core.bll.network.vm.AbstractVmInterfaceCommand.getReturnValue().getCanDoActionMessages()); }
public org.ovirt.engine.core.bll.ValidationResult stpForVmNetworkOnly() { return org.ovirt.engine.core.bll.ValidationResult.failWith(EngineMessage.NON_VM_NETWORK_CANNOT_SUPPORT_STP).unless(((network.isVmNetwork()) || (!(network.getStp())))); }
@java.lang.Override public java.lang.String getLabel() { if (useRadioButtonWidgetLabel) { return asRadioButton().getText(); } else { return super.getLabel(); } }
private java.lang.reflect.Method resolveGet() throws java.lang.NoSuchMethodException, java.lang.SecurityException { java.lang.reflect.Method methodSignature = org.ovirt.engine.api.restapi.resource.BackendResource.findGetSignature(this.getClass()); if (methodSignature == null) { return null; } java.lang.reflect.Method methodImplementation = this.getClass().getMethod(methodSignature.getName(), methodSignature.getParameterTypes()); return methodImplementation; }
@org.junit.Test public void canDoActionLunsNotPartOfStorageDomain() { java.util.List lunsFromDb = new java.util.ArrayList<>(); org.ovirt.engine.core.common.businessentities.storage.LUNs lun1 = new org.ovirt.engine.core.common.businessentities.storage.LUNs(); lun1.setLUN_id("111"); lun1.setStorageDomainId(sdId); org.ovirt.engine.core.common.businessentities.storage.LUNs lun2 = new org.ovirt.engine.core.common.businessentities.storage.LUNs(); lun2.setLUN_id("222"); lun2.setStorageDomainId(sdId); lunsFromDb.add(lun1); lunsFromDb.add(lun2); when(lunsDao.getAllForVolumeGroup(org.ovirt.engine.core.bll.storage.domain.RefreshLunsSizeCommandTest.STORAGE)).thenReturn(lunsFromDb); org.ovirt.engine.core.bll.CanDoActionTestUtils.runAndAssertCanDoActionFailure(cmd, EngineMessage.ACTION_TYPE_FAILED_LUNS_NOT_PART_OF_STORAGE_DOMAIN); }
protected boolean isStorageDomainTypeCorrect(org.ovirt.engine.core.common.businessentities.StorageDomain storageDomain) { if ((storageDomain.isLocal()) != (org.ovirt.engine.core.bll.storage.StorageHandlingCommandBase.getStoragePool().isLocal())) { addCanDoActionMessage(VdcBllMessages.ERROR_CANNOT_ATTACH_STORAGE_DOMAIN_STORAGE_TYPE_NOT_MATCH); return false; } return true; }
private org.ovirt.engine.core.common.utils.Pair<java.lang.Boolean, java.util.Set<java.lang.String>> insertSharedLock(java.lang.String key, java.lang.String message, boolean isCheckOnly) { org.ovirt.engine.core.bll.lock.InMemoryLockManager.InternalLockView lock = locks.get(key); if (lock != null) { if (!isCheckOnly) { lock.increaseCount(); lock.addMessage(message); } else if (lock.getExclusive()) { return new org.ovirt.engine.core.common.utils.Pair<java.lang.Boolean, java.util.Set<java.lang.String>>(java.lang.Boolean.FALSE, lock.getMessages()); } } else if (!isCheckOnly) { locks.put(key, new org.ovirt.engine.core.bll.lock.InMemoryLockManager.InternalLockView(1, message, false)); } return org.ovirt.engine.core.bll.lock.InMemoryLockManager.LOCK_INSERT_SUCCESS_RESULT; }
@java.lang.Override public void handleRequest(io.undertow.server.HttpServerExchange exchange) throws java.lang.Exception { lastRequestQuery = exchange.getQueryString(); if (!(exchange.getRequestHeaders().getFirst("Authorization").equals(("Bearer " + (org.ovirt.engine.sdk4.ServerTest.TOKEN))))) { exchange.setStatusCode(401); exchange.getResponseSender().send(""); } else { java.lang.Thread.sleep(delay); exchange.setStatusCode(code); exchange.getResponseHeaders().put(Headers.CONTENT_TYPE, "application/xml"); exchange.getResponseSender().send(body); } }
@java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { java.util.List<org.ovirt.engine.ui.uicommonweb.models.profiles.VnicProfileModel> profilesModels = new java.util.LinkedList<org.ovirt.engine.ui.uicommonweb.models.profiles.VnicProfileModel>(); for (org.ovirt.engine.core.common.businessentities.network.VnicProfileView profileView : ((java.util.List<org.ovirt.engine.core.common.businessentities.network.VnicProfileView>) (returnValue))) { org.ovirt.engine.ui.uicommonweb.models.profiles.VnicProfileModel editModel = new org.ovirt.engine.ui.uicommonweb.models.profiles.EditVnicProfileModel(getSourceListModel(), getSelectedDc().getcompatibility_version(), profileView, null, false); if (((profileView.getNetworkQosName()) != null) && (!(profileView.getNetworkQosName().equals("")))) { org.ovirt.engine.core.common.businessentities.network.NetworkQoS networkQoS = new org.ovirt.engine.core.common.businessentities.network.NetworkQoS(); networkQoS.setName(profileView.getNetworkQosName()); editModel.getNetworkQoS().setSelectedItem(networkQoS); } editModel.getNetworkQoS().setIsChangable(false); profilesModels.add(editModel); editModel.getName().setIsChangable(false); } if (profilesModels.isEmpty()) { org.ovirt.engine.ui.uicommonweb.models.profiles.VnicProfileModel newProfileModel = new org.ovirt.engine.ui.uicommonweb.models.profiles.NewVnicProfileModel(getSourceListModel(), getSelectedDc().getcompatibility_version(), false, getSelectedDc().getId()); profilesModels.add(newProfileModel); } getProfiles().setItems(profilesModels); originalProfileModels = profilesModels; }
private boolean validateFreeSpaceOnDestinationDomain(org.ovirt.engine.core.bll.validator.StorageDomainValidator storageDomainValidator, java.util.List<org.ovirt.engine.core.common.businessentities.DiskImage> disksList) { return validate(storageDomainValidator.hasSpaceForClonedDisks(disksList)); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Blank Template cannot be copied") java.lang.String blankTemplateCannotBeCopied();
@org.junit.Test public void qosNotSupported() { org.ovirt.engine.core.common.businessentities.network.Network network = createManagementNetwork(); mockExistingNetworks(network); org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface iface = createNicSyncedWithNetwork("eth0", network); mockExistingIfaces(iface); iface.setQosOverridden(true); iface.setQos(createQos()); org.ovirt.engine.core.bll.network.host.SetupNetworksHelper helper = createHelper(createParametersForNics(iface)); validateAndExpectViolation(helper, VdcBllMessages.ACTION_TYPE_FAILED_HOST_NETWORK_QOS_NOT_SUPPORTED, org.ovirt.engine.core.bll.network.host.SetupNetworksHelperTest.MANAGEMENT_NETWORK_NAME); }
private boolean executeSshPowerDown(java.lang.String version) { boolean ret = false; try (final org.ovirt.engine.core.bll.utils.EngineSSHClient sshClient = new org.ovirt.engine.core.bll.utils.EngineSSHClient();final java.io.ByteArrayOutputStream cmdOut = new java.io.ByteArrayOutputStream();final java.io.ByteArrayOutputStream cmdErr = new java.io.ByteArrayOutputStream()) { try { log.info("Opening SSH power down session on host {}", org.ovirt.engine.core.bll.VdsPowerDownCommand.getVds().getHostName()); sshClient.setVds(org.ovirt.engine.core.bll.VdsPowerDownCommand.getVds()); sshClient.useDefaultKeyPair(); sshClient.connect(); sshClient.authenticate(); log.info("Executing SSH power down command on host {}", org.ovirt.engine.core.bll.VdsPowerDownCommand.getVds().getHostName()); sshClient.executeCommand(org.ovirt.engine.core.common.config.Config.<java.lang.String>getValue(ConfigValues.SshVdsPowerdownCommand, version), null, cmdOut, cmdErr); ret = true; } catch (java.lang.Exception ex) { log.error("SSH power down command failed on host \'{}\': {}\nStdout: {}\nStderr: {}", org.ovirt.engine.core.bll.VdsPowerDownCommand.getVds().getHostName(), ex.getMessage(), cmdOut, cmdErr); log.debug("Exception", ex); } } catch (java.io.IOException e) { log.error("Error opening SSH connection to '{}': {}", org.ovirt.engine.core.bll.VdsPowerDownCommand.getVds().getHostName(), e.getMessage()); log.debug("Exception", e); } return ret; }
private void setUiLanguage(org.ovirt.engine.ui.uicommonweb.models.EntityModel<java.lang.String> value) { privateUiLanguage = value; }
@java.lang.Override protected void convert() { boolean useVirtV2V = (org.ovirt.engine.core.bll.exportimport.ImportVmFromOvaCommand.getParameters().getVm().getOrigin()) != (org.ovirt.engine.core.common.businessentities.OriginType.OVIRT); if (useVirtV2V) { runInternalActionWithTasksContext(ActionType.ConvertOva, buildConvertOvaParameters()); } else { runInternalActionWithTasksContext(ActionType.ExtractOva, buildExtractOvaParameters()); } }
private static boolean isRequiredInterfaceDown(java.util.Map<java.lang.String, org.ovirt.engine.core.common.businessentities.network.Network> networksByName, java.util.List<org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface> interfaces, org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface iface) { if (((iface.getNetworkName()) != null) && (org.ovirt.engine.core.vdsbroker.NetworkMonitoringHelper.isBaseInterfaceDown(iface, interfaces))) { org.ovirt.engine.core.common.businessentities.network.Network net = networksByName.get(iface.getNetworkName()); if (((net != null) && ((net.getCluster().getStatus()) == (org.ovirt.engine.core.common.businessentities.network.NetworkStatus.OPERATIONAL))) && (net.getCluster().isRequired())) { return true; } } return false; }
private boolean fetchStorageDomainInfo() { org.ovirt.engine.core.common.queries.VdcQueryReturnValue allDomainsQuery = getBackend().runInternalQuery(VdcQueryType.GetExistingStorageDomainList, new org.ovirt.engine.core.common.queries.GetExistingStorageDomainListParameters(org.ovirt.engine.core.bll.storage.domain.ImportHostedEngineStorageDomainCommand.getParameters().getVdsId(), null, org.ovirt.engine.core.common.businessentities.StorageDomainType.Data, null)); if (allDomainsQuery.getSucceeded()) { for (org.ovirt.engine.core.common.businessentities.StorageDomain sd : ((java.util.List<org.ovirt.engine.core.common.businessentities.StorageDomain>) (allDomainsQuery.getReturnValue()))) { if (sd.getName().equals(org.ovirt.engine.core.common.config.Config.<java.lang.String>getValue(ConfigValues.HostedEngineStorageDomainName))) { heStorageDomain = sd; return true; } } } else { log.error(("Failed query for all Storage Domains." + " The import command can not proceed without this info")); } return false; }
void registerSelectionChangeHandler(final org.ovirt.engine.ui.common.widget.action.ActionButtonDefinition<T> buttonDef) { final org.ovirt.engine.ui.uicompat.IEventListener<org.ovirt.engine.ui.uicompat.EventArgs> itemSelectionChangeHandler = new org.ovirt.engine.ui.uicompat.IEventListener<org.ovirt.engine.ui.uicompat.EventArgs>() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.EventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { buttonDef.update(); } }; addSelectionChangeListener(itemSelectionChangeHandler); }
private void assertInterfaceModified(org.ovirt.engine.core.bll.network.host.SetupNetworksHelper helper, org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface iface) { java.util.Set<java.lang.String> modifiedNames = new java.util.HashSet<java.lang.String>(); for (org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface modifiedIface : helper.getModifiedInterfaces()) { modifiedNames.add(modifiedIface.getName()); } junit.framework.Assert.assertTrue(java.text.MessageFormat.format("Expected interface ''{0}'' to be modified but it wasn''t. Modified interfaces: {1}", iface, helper.getModifiedInterfaces()), modifiedNames.contains(iface.getName())); }
@org.junit.Test public void testVmOvfCreationBackwardCompatilibily() throws java.lang.Exception { org.ovirt.engine.core.common.businessentities.VM vm = org.ovirt.engine.core.utils.ovf.OvfManagerTest.createVM(); java.lang.String xml = manager.ExportVm(vm, new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.DiskImage>(), Version.v3_0); assertNotNull(xml); final org.ovirt.engine.core.common.businessentities.VM newVm = new org.ovirt.engine.core.common.businessentities.VM(); manager.ImportVm(xml, newVm, new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.DiskImage>(), new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface>()); org.ovirt.engine.core.utils.ovf.OvfManagerTest.assertVm(vm, newVm, vm.getDbGeneration()); }
@java.lang.Override public java.lang.String getDefaultManagementNetworkName() { return org.ovirt.engine.core.common.config.Config.getValue(ConfigValues.DefaultManagementNetwork); }
@java.lang.Override public org.ovirt.engine.core.common.businessentities.storage.ImageTransfer get(org.ovirt.engine.core.compat.Guid id, org.ovirt.engine.core.compat.Guid userId, boolean isFiltered) { org.springframework.jdbc.core.namedparam.MapSqlParameterSource sqlParams = createIdParameterMapper(id); sqlParams.addValue("user_id", userId); sqlParams.addValue("is_filtered", isFiltered); return getCallsHandler().executeRead("GetImageUploadsByCommandId", createEntityRowMapper(), sqlParams); }
@java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object result) { java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StorageDomain> list = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StorageDomain>) (result)); org.ovirt.engine.ui.uicommonweb.models.datacenters.DataCenterStorageListModel dcStorageModel = ((org.ovirt.engine.ui.uicommonweb.models.datacenters.DataCenterStorageListModel) (model)); java.util.ArrayList<org.ovirt.engine.ui.uicommonweb.models.EntityModel> models; models = new java.util.ArrayList<org.ovirt.engine.ui.uicommonweb.models.EntityModel>(); java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StorageDomain> items = ((dcStorageModel.getItems()) != null) ? new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StorageDomain>(org.ovirt.engine.ui.uicommonweb.Linq.<org.ovirt.engine.core.common.businessentities.StorageDomain>cast(dcStorageModel.getItems())) : new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StorageDomain>(); for (org.ovirt.engine.core.common.businessentities.StorageDomain a : list) { if (!(org.ovirt.engine.ui.uicommonweb.Linq.isSDItemExistInList(items, a.getId()))) { org.ovirt.engine.ui.uicommonweb.models.EntityModel tempVar = new org.ovirt.engine.ui.uicommonweb.models.EntityModel(); tempVar.setEntity(a); models.add(tempVar); } } dcStorageModel.postAttachInternal(models); }
@java.lang.Override protected void setActionMessageParameters() { addValidationMessage(EngineMessage.VAR__ACTION__REMOVE); addValidationMessage(EngineMessage.VAR__TYPE__PROVIDER); }
org.ovirt.engine.core.vdsbroker.irsbroker.OneUuidReturnForXmlRpc glusterSnapshotCreate(java.lang.String volumeName, java.lang.String snapshotName, java.lang.String description, boolean force);
public void reuseSession() { if ((getSessionId()) != null) { processSessionId(getSessionId()); } else { getSessionId(new org.ovirt.engine.ui.frontend.communication.StorageCallback() { @java.lang.Override public void onSuccess(java.lang.String result) { if (result != null) { restApiSessionId = result; processSessionId(result); } else { processSessionIdException(); } } @java.lang.Override public void onFailure(java.lang.Throwable caught) { processSessionIdException(); } private void processSessionIdException() { org.ovirt.engine.ui.webadmin.plugin.restapi.RestApiSessionManager.logger.severe("Engine REST API session ID is not available"); } }); } }
protected java.util.List<org.ovirt.engine.core.common.businessentities.storage.LUNs> getDeviceList(java.util.Set<java.lang.String> lunsIds) { if ((AbstractSyncLunsCommand.getParameters().getDeviceList()) == null) { return runGetDeviceList(lunsIds); } if (lunsIds == null) { return AbstractSyncLunsCommand.getParameters().getDeviceList(); } return AbstractSyncLunsCommand.getParameters().getDeviceList().stream().filter(( lun) -> lunsIds.contains(lun.getId())).collect(java.util.stream.Collectors.toList()); }
public java.util.List<org.ovirt.engine.extensions.aaa.builtin.kerberosldap.LdapQueryData> getLdapQueriesData(java.lang.String domain) { int queryLimit = java.lang.Integer.parseInt(configuration.getProperty("config.LDAPQueryPartsNumber")); java.util.List<org.ovirt.engine.extensions.aaa.builtin.kerberosldap.LdapQueryData> results = new java.util.ArrayList<org.ovirt.engine.extensions.aaa.builtin.kerberosldap.LdapQueryData>(); org.ovirt.engine.extensions.aaa.builtin.kerberosldap.LdapQueryData subQueryData = new org.ovirt.engine.extensions.aaa.builtin.kerberosldap.LdapQueryDataImpl(); java.util.ArrayList<java.lang.Object> filterParameters = new java.util.ArrayList<java.lang.Object>(); int counter = 0; for (org.ovirt.engine.core.compat.Guid identifier : ldapIdentifiers) { filterParameters.add(identifier); if (counter >= queryLimit) { subQueryData.setFilterParameters(filterParameters.toArray()); subQueryData.setLdapQueryType(LdapQueryType.getUsersByUserGuids); subQueryData.setBaseDNParameters(null); subQueryData.setDomain(domain); results.add(subQueryData); subQueryData = new org.ovirt.engine.extensions.aaa.builtin.kerberosldap.LdapQueryDataImpl(); filterParameters = new java.util.ArrayList<java.lang.Object>(); counter = 0; } counter++; } if (!(filterParameters.isEmpty())) { subQueryData.setFilterParameters(filterParameters.toArray()); subQueryData.setLdapQueryType(LdapQueryType.getUsersByUserGuids); subQueryData.setBaseDNParameters(null); subQueryData.setDomain(domain); results.add(subQueryData); } return results; }
protected void log() { final javax.transaction.Transaction transaction = org.ovirt.engine.core.utils.transaction.TransactionSupport.suspend(); try { auditLogDirector.log(this, org.ovirt.engine.core.bll.CommandBase.getAuditLogTypeValue()); } catch (final java.lang.RuntimeException ex) { log.error("Error during log command: {}. Exception {}", getClass().getName(), ex.getMessage()); log.debug("Exception", ex); } finally { org.ovirt.engine.core.utils.transaction.TransactionSupport.resume(transaction); } }
@java.lang.Override public javax.ws.rs.core.Response add(org.ovirt.engine.api.model.Role role) { validateParameters(role, "id|name"); validateEnums(org.ovirt.engine.api.model.Role.class, role); if (!(role.isSetId())) { org.ovirt.engine.core.common.businessentities.Role entity = getEntity(org.ovirt.engine.api.model.Role.class, VdcQueryType.GetRoleByName, new org.ovirt.engine.core.common.queries.MultilevelAdministrationByRoleNameParameters(role.getName()), role.getName()); role.setId(entity.getId().toString()); } return performCreation(VdcActionType.AddSystemPermission, new org.ovirt.engine.core.common.action.PermissionsOperationsParametes(newPermission(role.getId())), new org.ovirt.engine.api.restapi.resource.QueryIdResolver(org.ovirt.engine.core.common.queries.VdcQueryType.GetPermissionById, org.ovirt.engine.core.common.queries.MultilevelAdministrationByPermissionIdParameters.class)); }
@java.lang.Override public void scheduleEntry(org.ovirt.engine.ui.frontend.RepeatingCommand cmd) { throw new java.lang.RuntimeException("Not implemented"); }
@java.lang.Override protected java.util.Map<java.lang.String, org.ovirt.engine.core.common.utils.Pair<java.lang.String, java.lang.String>> getExclusiveLocks() { java.util.Map<java.lang.String, org.ovirt.engine.core.common.utils.Pair<java.lang.String, java.lang.String>> locks = new java.util.HashMap<java.lang.String, org.ovirt.engine.core.common.utils.Pair<java.lang.String, java.lang.String>>(); domains = getStorageDomainsByConnId(org.ovirt.engine.core.bll.storage.UpdateStorageServerConnectionCommand.getParameters().getStorageServerConnection().getid()); if ((!(domains.isEmpty())) && ((domains.size()) == 1)) { setStorageDomain(domains.get(0)); locks.put(org.ovirt.engine.core.bll.storage.UpdateStorageServerConnectionCommand.getStorageDomain().getId().toString(), LockMessagesMatchUtil.STORAGE); } locks.put(org.ovirt.engine.core.bll.storage.UpdateStorageServerConnectionCommand.getParameters().getStorageServerConnection().getconnection(), LockMessagesMatchUtil.STORAGE_CONNECTION); return locks; }
@java.lang.Override protected void executeCommand() { boolean isDomainUpdateRequired = doDomainsUseConnection(org.ovirt.engine.core.bll.storage.UpdateStorageServerConnectionCommand.getConnection()); org.ovirt.engine.core.common.businessentities.StoragePoolIsoMap map = null; java.util.List<org.ovirt.engine.core.common.businessentities.StorageDomain> updatedDomains = new java.util.ArrayList<>(); boolean hasConnectStorageSucceeded = false; if (isDomainUpdateRequired) { hasConnectStorageSucceeded = connectToStorage(); org.ovirt.engine.core.common.vdscommands.VDSReturnValue returnValueUpdatedStorageDomain = null; if (hasConnectStorageSucceeded) { changeStorageDomainStatusInTransaction(StorageDomainStatus.Locked); for (org.ovirt.engine.core.common.businessentities.StorageDomain domain : domains) { returnValueUpdatedStorageDomain = getStatsForDomain(domain); if (returnValueUpdatedStorageDomain.getSucceeded()) { org.ovirt.engine.core.common.businessentities.StorageDomain updatedStorageDomain = ((org.ovirt.engine.core.common.businessentities.StorageDomain) (returnValueUpdatedStorageDomain.getReturnValue())); updatedDomains.add(updatedStorageDomain); } } if (!(updatedDomains.isEmpty())) { updateStorageDomain(updatedDomains); } } } org.ovirt.engine.core.bll.storage.UpdateStorageServerConnectionCommand.getStorageConnDao().update(org.ovirt.engine.core.bll.storage.UpdateStorageServerConnectionCommand.getParameters().getStorageServerConnection()); if (isDomainUpdateRequired) { for (org.ovirt.engine.core.common.businessentities.StorageDomain domain : domains) { map = getStoragePoolIsoMap(domain); restoreStateAfterUpdate(map); } if (hasConnectStorageSucceeded) { disconnectFromStorage(); } } org.ovirt.engine.core.bll.storage.UpdateStorageServerConnectionCommand.setSucceeded(true); }
@java.lang.Override protected void verify(org.ovirt.engine.api.model.Cluster model, org.ovirt.engine.api.model.Cluster transform) { assertNotNull(transform); assertEquals(model.getName(), transform.getName()); assertEquals(model.getId(), transform.getId()); assertEquals(model.getDescription(), transform.getDescription()); assertEquals(model.getComment(), transform.getComment()); assertNotNull(transform.getCpu()); assertEquals(model.getCpu().getId(), transform.getCpu().getId()); assertNotNull(transform.getDataCenter()); assertEquals(model.getDataCenter().getId(), transform.getDataCenter().getId()); assertNotNull(transform.getSchedulingPolicy()); assertEquals(model.getSchedulingPolicy().getPolicy(), transform.getSchedulingPolicy().getPolicy()); assertEquals(model.getErrorHandling().getOnError(), transform.getErrorHandling().getOnError()); assertNotNull(transform.getMemoryPolicy()); assertNotNull(transform.getMemoryPolicy().getTransparentHugepages()); assertEquals(transform.getMemoryPolicy().getTransparentHugepages().isEnabled(), transform.getMemoryPolicy().getTransparentHugepages().isEnabled()); assertEquals(model.isVirtService(), transform.isVirtService()); assertEquals(model.isGlusterService(), transform.isGlusterService()); assertEquals(model.isTunnelMigration(), transform.isTunnelMigration()); assertEquals(model.isTrustedService(), transform.isTrustedService()); assertEquals(model.isBallooningEnabled(), transform.isBallooningEnabled()); assertEquals(model.getDisplay().getProxy(), transform.getDisplay().getProxy()); }
java.lang.String GlusterWebhookUpdateException();
@java.lang.Override public void setHasSelectedTags(boolean hasSelectedTags) { if (hasSelectedTags) { searchStringPrefixLabel.addStyleName(style.hasSelectedTags()); searchStringInput.addStyleName(style.hasSelectedTags()); searchBoxClear.addStyleName(style.hasSelectedTags()); } else { searchStringPrefixLabel.removeStyleName(style.hasSelectedTags()); searchStringInput.removeStyleName(style.hasSelectedTags()); searchBoxClear.removeStyleName(style.hasSelectedTags()); } }
@javax.annotation.PostConstruct private void init() { org.ovirt.engine.core.bll.CommandEntityCleanupManager.log.info("Start initializing {}", getClass().getSimpleName()); java.util.Calendar calendar = new java.util.GregorianCalendar(); java.util.Date commandEntityCleanupTime = org.ovirt.engine.core.common.config.Config.<org.ovirt.engine.core.compat.DateTime>getValue(ConfigValues.CommandEntityCleanupTime); calendar.setTimeInMillis(commandEntityCleanupTime.getTime()); java.lang.String cronExpression = java.lang.String.format("%d %d %d * * ?", calendar.get(java.util.Calendar.SECOND), calendar.get(java.util.Calendar.MINUTE), calendar.get(java.util.Calendar.HOUR_OF_DAY)); org.ovirt.engine.core.bll.CommandEntityCleanupManager.log.info("Setting command entity cleanup manager to run at: {}", cronExpression); executor.schedule(this::cleanup, new org.ovirt.engine.core.common.utils.EngineCronTrigger(cronExpression)); org.ovirt.engine.core.bll.CommandEntityCleanupManager.log.info("Finished initializing {}", getClass().getSimpleName()); }
@java.lang.Override protected void verify(org.ovirt.engine.api.model.DataCenter model, org.ovirt.engine.api.model.DataCenter transform) { assertNotNull(transform); assertEquals(model.getName(), transform.getName()); assertEquals(model.getId(), transform.getId()); assertEquals(model.getDescription(), transform.getDescription()); assertEquals(model.getComment(), transform.getComment()); assertEquals(model.isLocal(), transform.isLocal()); assertEquals(model.getStorageFormat(), transform.getStorageFormat()); assertEquals(model.getMacPool().getId(), transform.getMacPool().getId()); assertEquals(model.getQuotaMode(), transform.getQuotaMode()); }
@java.lang.Override protected void onSelectedItemChanging(java.lang.Object newValue, java.lang.Object oldValue) { super.onSelectedItemChanging(newValue, oldValue); java.lang.String url = ((java.lang.String) (getUrl().getEntity())); if (url == null) { url = new java.lang.String(); } url = url.trim(); if ((url.equals("")) || (url.equalsIgnoreCase(getDefaultUrl(((org.ovirt.engine.core.common.businessentities.ProviderType) (oldValue)))))) { getUrl().setEntity(getDefaultUrl(((org.ovirt.engine.core.common.businessentities.ProviderType) (newValue)))); } }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("Snapshot Scheduled") java.lang.String snapshotScheduledLabel();
@org.junit.Test public void testGetByUserId() { org.ovirt.engine.core.common.businessentities.UserProfile result = dao.getByUserId(existingProfile.getUserId()); assertNotNull(result); assertEquals(existingProfile, result); }
public void postOnSetupNetworks() { org.ovirt.engine.ui.uicommonweb.action.SimpleAction closeAction = getCloseAction(); org.ovirt.engine.core.common.action.HostSetupNetworksParameters hostSetupNetworksParameters = createHostSetupNetworksParameters(); org.ovirt.engine.ui.uicommonweb.action.UiAction setupNetworksAction = new org.ovirt.engine.ui.uicommonweb.action.UiVdcAction(org.ovirt.engine.core.common.action.VdcActionType.HostSetupNetworks, hostSetupNetworksParameters, this, true); org.ovirt.engine.ui.uicommonweb.action.UiAction uiAction = setupNetworksAction.then(getVfsConfigAction()).then(getCommitNetworkChangesAction()).then(getLabelUnlabelUiAction()); setupNetworksAction.onAllExecutionsFinish(closeAction); setupNetworksAction.runAction(); }
protected org.ovirt.engine.ui.common.widget.table.SimpleActionTable<T> createActionTable() { return new org.ovirt.engine.ui.userportal.widget.table.column.UserPortalSimpleActionTable<T>(modelProvider, getTableResources(), org.ovirt.engine.ui.userportal.gin.ClientGinjectorProvider.instance().getEventBus(), org.ovirt.engine.ui.userportal.gin.ClientGinjectorProvider.instance().getClientStorage()); }
public void setPasswordAlreadyStored(boolean passwordAlreadyStored) { this.passwordAlreadyStored = passwordAlreadyStored; }
@org.junit.Test public void testOperationSubscription() { org.ovirt.vdsm.jsonrpc.client.events.SubscriptionHolder holder = mock(org.ovirt.vdsm.jsonrpc.client.events.SubscriptionHolder.class); when(holder.getId()).thenReturn("*|*|test|*"); org.ovirt.vdsm.jsonrpc.client.events.SubscriptionMatcher matcher = new org.ovirt.vdsm.jsonrpc.client.events.SubscriptionMatcher(); matcher.add(holder); org.ovirt.vdsm.jsonrpc.client.JsonRpcEvent event = mock(org.ovirt.vdsm.jsonrpc.client.JsonRpcEvent.class); when(event.getMethod()).thenReturn("localhost|testcase|test|uuid"); java.util.Set<org.ovirt.vdsm.jsonrpc.client.events.SubscriptionHolder> holders = matcher.match(event); assertEquals(1, holders.size()); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Allow to edit Logical Networks properties within the Cluster (e.g. non-required or display network)") java.lang.String allowToEditLogicalNetworksForTheClusterRoleTreeTooltip();
java.lang.String parseVolumeIdFromPath(java.lang.String path) { return parsePathSegment(path, 1); }
protected boolean prepareFailureMessageForDomains(java.lang.String domainNames) { org.ovirt.engine.core.bll.storage.RemoveStorageServerConnectionCommand.addCanDoActionMessageVariable("domainNames", domainNames); return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_STORAGE_CONNECTION_BELONGS_TO_SEVERAL_STORAGE_DOMAINS); }
@org.junit.Test public void lowerVersionHostsNoNetwork() { storagePoolWithLowerVersion(); addNonDefaultClusterToPool(); addHostsToCluster(); assertTrue(cmd.canDoAction()); }
private void create(long timestamp) throws java.io.IOException { java.io.File temp = java.io.File.createTempFile(this.archive.getName(), "tmp", this.archive.getParentFile()); try { try (java.io.OutputStream os = new java.io.FileOutputStream(temp)) { org.ovirt.engine.core.utils.archivers.tar.Tar.doTar(os, this.dir); } catch (java.io.IOException e) { throw new java.io.IOException(java.lang.String.format("Cannot create tarball '%1$s'", this.archive), e); } if (!(temp.setLastModified(timestamp))) { throw new java.io.IOException(java.lang.String.format("Cannot set last modified '%1$s' to '%2$d'", temp.getCanonicalPath(), timestamp)); } if (!(temp.renameTo(this.archive))) { throw new java.io.IOException(java.lang.String.format("Cannot rename '%1$s' to '%2$s'", temp.getCanonicalPath(), archive.getCanonicalPath())); } temp = null; } catch (java.io.IOException e) { org.ovirt.engine.core.utils.archivers.tar.CachedTar.log.error("Exception", e); throw e; } finally { if ((temp != null) && (!(temp.delete()))) { org.ovirt.engine.core.utils.archivers.tar.CachedTar.log.error("Cannot delete '{}'", temp.getAbsolutePath()); } } }
private static void setVmTemplateStatus(org.ovirt.engine.core.compat.Guid vmTemplateGuid, org.ovirt.engine.core.common.businessentities.VmTemplateStatus status, org.ovirt.engine.core.bll.context.CompensationContext compensationContext) { org.ovirt.engine.core.common.businessentities.VmTemplate vmTemplate = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVmTemplateDao().get(vmTemplateGuid); if (vmTemplate != null) { if (compensationContext != null) { compensationContext.snapshotEntityStatus(vmTemplate); } vmTemplate.setStatus(status); org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVmTemplateDao().update(vmTemplate); } else { org.ovirt.engine.core.bll.VmTemplateHandler.log.warnFormat("setVmTemplateStatus: vmTemplate is null, not setting status '{0}' to vmTemplate", status); } }
@org.junit.Test public void checkInvalidAddress() { assertFalse(underTest.test(generateVdsNetworkInterface(org.ovirt.engine.core.utils.network.predicate.AbstractVdsNetworkInterfacePredicateTest.INVALID))); }
@java.lang.Override protected void populateTabMap() { getTabNameMapping().put(TabName.PF_TAB, pfTab); getTabNameMapping().put(TabName.VFS_CONFIG_TAB, vfsConfigTab); }
public void detachCinderDomainFromPool(final org.ovirt.engine.core.common.businessentities.StoragePoolIsoMap mapToRemove) { execute(new java.util.concurrent.Callable<java.lang.Object>() { @java.lang.Override public java.lang.Object call() { getStoragePoolIsoMapDAO().remove(new org.ovirt.engine.core.common.businessentities.StoragePoolIsoMapId(mapToRemove.getstorage_id(), mapToRemove.getstorage_pool_id())); return null; } }); }
@org.junit.Test public void testAttachFailDomainAlreadyInPool() { java.util.List<org.ovirt.engine.core.common.businessentities.StoragePoolIsoMap> isoMap = new java.util.ArrayList<>(); isoMap.add(new org.ovirt.engine.core.common.businessentities.StoragePoolIsoMap()); when(storagePoolIsoMapDao.getAllForStorage(any(org.ovirt.engine.core.compat.Guid.class))).thenReturn(isoMap); org.ovirt.engine.core.bll.ValidationResult attachedDomainInsertionResult = validator.validateDomainCanBeAttachedToPool(); assertFalse("Attaching domain that is already in a pool succeeded while it should have failed", attachedDomainInsertionResult.isValid()); assertFailingMessage("Attaching domain that is already in a pool failed with the wrong message", attachedDomainInsertionResult, EngineMessage.ACTION_TYPE_FAILED_STORAGE_DOMAIN_STATUS_ILLEGAL); }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.VmTemplate> getAllTemplatesRelatedToQuotaId(org.ovirt.engine.core.compat.Guid quotaId) { return getCallsHandler().executeReadList("GetAllVmTemplatesRelatedToQuotaId", org.ovirt.engine.core.dao.VmTemplateDaoImpl.VMTemplateRowMapper.instance, getCustomMapSqlParameterSource().addValue("quota_id", quotaId)); }
public static java.lang.Integer getEffectiveCpuCores(org.ovirt.engine.core.common.businessentities.VDS vds) { org.ovirt.engine.core.common.businessentities.VDSGroup vdsGroup = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVdsGroupDao().get(vds.getvds_group_id()); if ((((vds.getCpuThreads()) != null) && (vdsGroup != null)) && (java.lang.Boolean.TRUE.equals(vdsGroup.getCountThreadsAsCores()))) { return vds.getCpuThreads(); } else { return vds.getcpu_cores(); } }
protected org.ovirt.engine.api.model.Templates mapCollection(java.util.List<org.ovirt.engine.core.common.businessentities.VmTemplate> entities) { org.ovirt.engine.core.common.queries.IdsQueryParameters params = new org.ovirt.engine.core.common.queries.IdsQueryParameters(); java.util.List<org.ovirt.engine.core.compat.Guid> ids = org.ovirt.engine.core.common.businessentities.Entities.getIds(entities); params.setId(ids); org.ovirt.engine.core.common.queries.VdcQueryReturnValue queryReturnValue = runQuery(VdcQueryType.GetVmsInit, params); if ((queryReturnValue.getSucceeded()) && ((queryReturnValue.getReturnValue()) != null)) { java.util.List<org.ovirt.engine.core.common.businessentities.VmInit> vmInits = queryReturnValue.getReturnValue(); java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.businessentities.VmInit> initMap = org.ovirt.engine.core.common.businessentities.Entities.businessEntitiesById(vmInits); for (org.ovirt.engine.core.common.businessentities.VmTemplate template : entities) { template.setVmInit(initMap.get(template.getId())); } } org.ovirt.engine.api.model.Templates collection = new org.ovirt.engine.api.model.Templates(); for (org.ovirt.engine.core.common.businessentities.VmTemplate entity : entities) { collection.getTemplates().add(addLinks(populate(map(entity), entity))); } return collection; }
private void addDefaultNetworks() { org.ovirt.engine.core.common.businessentities.network.Network net = new org.ovirt.engine.core.common.businessentities.network.Network(); net.setId(org.ovirt.engine.core.compat.Guid.newGuid()); net.setName(org.ovirt.engine.core.utils.NetworkUtils.getEngineNetwork()); net.setDescription(AddVdsGroupCommand.DefaultNetworkDescription); net.setDataCenterId(org.ovirt.engine.core.bll.storage.AddEmptyStoragePoolCommand.getStoragePool().getId()); net.setVmNetwork(true); org.ovirt.engine.core.bll.storage.AddEmptyStoragePoolCommand.getNetworkDAO().save(net); org.ovirt.engine.core.bll.network.cluster.NetworkHelper.addPermissionsOnNetwork(org.ovirt.engine.core.bll.storage.AddEmptyStoragePoolCommand.getCurrentUser().getId(), net.getId()); org.ovirt.engine.core.common.businessentities.network.VnicProfile profile = org.ovirt.engine.core.bll.network.cluster.NetworkHelper.createVnicProfile(net); org.ovirt.engine.core.bll.storage.AddEmptyStoragePoolCommand.getVnicProfileDao().save(profile); org.ovirt.engine.core.bll.network.cluster.NetworkHelper.addPermissionsOnVnicProfile(org.ovirt.engine.core.bll.storage.AddEmptyStoragePoolCommand.getCurrentUser().getId(), profile.getId(), true); }
public java.lang.String getVmPoolSpiceProxy() { return vmPoolSpiceProxy; }
@java.lang.Override protected void executeCommand() { addVmToDb(); org.ovirt.engine.core.common.businessentities.VM vm = getVm(); if (!(hasSnappableDisks(vm))) { endVmRelatedOps(); } else { processImages(); } setSucceeded(true); }
@org.junit.Test public void lunAlreadyPartOfStorageDomains() { org.ovirt.engine.core.common.businessentities.LUNs lun1 = new org.ovirt.engine.core.common.businessentities.LUNs(); lun1.setLUN_id(org.ovirt.engine.core.bll.storage.StorageDomainCommandBaseTest.GUIDS[0].toString()); lun1.setStorageDomainId(org.ovirt.engine.core.compat.Guid.newGuid()); org.ovirt.engine.core.common.businessentities.LUNs lun2 = new org.ovirt.engine.core.common.businessentities.LUNs(); lun2.setLUN_id(org.ovirt.engine.core.bll.storage.StorageDomainCommandBaseTest.GUIDS[1].toString()); lun2.setStorageDomainId(org.ovirt.engine.core.compat.Guid.newGuid()); doReturn(lunDAO).when(cmd).getLunDao(); when(lunDAO.getAll()).thenReturn(java.util.Arrays.asList(lun1, lun2)); java.util.List<java.lang.String> specifiedLunIds = java.util.Collections.singletonList(org.ovirt.engine.core.bll.storage.StorageDomainCommandBaseTest.GUIDS[0].toString()); assertTrue(cmd.isLunsAlreadyInUse(specifiedLunIds)); java.util.List<java.lang.String> messages = cmd.getReturnValue().getCanDoActionMessages(); assertEquals(messages.size(), 2); assertEquals(messages.get(0), VdcBllMessages.ACTION_TYPE_FAILED_LUNS_ALREADY_PART_OF_STORAGE_DOMAINS.toString()); assertEquals(messages.get(1), java.lang.String.format("$lunIds %1$s", cmd.getFormattedLunId(lun1, lun1.getStorageDomainName()))); }
@com.google.gwt.i18n.client.Messages.DefaultMessage("For Desktop Load - Enable memory page sharing to {0}%") java.lang.String clusterPopupMemoryOptimizationForDesktopLabel(java.lang.String a);
protected java.util.List<org.ovirt.engine.core.common.businessentities.VDSGroup> getVdsGroups() { return getBackendCollection(VdcQueryType.GetVdsGroupsByStoragePoolId, new org.ovirt.engine.core.common.queries.IdQueryParameters(dataCenterId)); }
@org.junit.Test public void noClusterServiceDefined() { assertThat(validator.clusterServiceDefined(), org.ovirt.engine.core.bll.validator.ValidationResultMatchers.failsWith(EngineMessage.VDS_GROUP_AT_LEAST_ONE_SERVICE_MUST_BE_ENABLED)); }
@javax.ws.rs.Path("{action: (?:undelete)}/{oid}") public org.ovirt.engine.api.v3.servers.V3ActionServer getActionResource(@javax.ws.rs.PathParam("action") java.lang.String action, @javax.ws.rs.PathParam("oid") java.lang.String oid) { return new org.ovirt.engine.api.v3.servers.V3ActionServer(getDelegate().getActionResource(action, oid)); }
@java.lang.Override protected boolean canDoAction() { boolean returnValue = true; org.ovirt.engine.core.common.businessentities.Permission p = org.ovirt.engine.core.bll.RemovePermissionCommand.getPermissionDao().get(org.ovirt.engine.core.bll.RemovePermissionCommand.getParameters().getPermission().getId()); if (org.ovirt.engine.core.bll.MultiLevelAdministrationHandler.isLastSuperUserPermission(p.getRoleId())) { org.ovirt.engine.core.bll.RemovePermissionCommand.getReturnValue().getCanDoActionMessages().add(EngineMessage.ERROR_CANNOT_REMOVE_LAST_SUPER_USER_ROLE.toString()); returnValue = false; } else if ((p.getRoleType().equals(RoleType.ADMIN)) && (!(org.ovirt.engine.core.bll.RemovePermissionCommand.isSystemSuperUser()))) { addCanDoActionMessage(EngineMessage.PERMISSION_REMOVE_FAILED_ONLY_SYSTEM_SUPER_USER_CAN_REMOVE_ADMIN_ROLES); returnValue = false; } if (!(java.util.Objects.equals(p.getAdElementId(), org.ovirt.engine.core.bll.RemovePermissionCommand.getParameters().getTargetId()))) { addCanDoActionMessage(EngineMessage.INHERITED_PERMISSION_CANT_BE_REMOVED); returnValue = false; } return returnValue; }
@java.lang.Override protected org.ovirt.engine.core.common.action.LockProperties applyLockProperties(org.ovirt.engine.core.common.action.LockProperties lockProperties) { org.ovirt.engine.core.common.action.LockProperties.Scope scope = (org.ovirt.engine.core.bll.storage.domain.DeactivateStorageDomainCommand.getParameters().isSkipLock()) ? org.ovirt.engine.core.common.action.LockProperties.Scope.None : org.ovirt.engine.core.common.action.LockProperties.Scope.Execution; return lockProperties.withScope(scope); }
private java.util.List<org.ovirt.engine.core.common.businessentities.DbUser> refreshUsers(java.util.List<org.ovirt.engine.core.common.businessentities.DbUser> dbUsers, org.ovirt.engine.core.authentication.Directory directory) { java.util.List<org.ovirt.engine.core.common.utils.ExternalId> ids = new java.util.ArrayList(dbUsers.size()); for (org.ovirt.engine.core.common.businessentities.DbUser dbUser : dbUsers) { ids.add(dbUser.getExternalId()); } java.util.List<org.ovirt.engine.core.authentication.DirectoryUser> directoryUsers = null; if (directory != null) { directoryUsers = directory.findUsers(ids); } else { directoryUsers = java.util.Collections.emptyList(); } java.util.Map<org.ovirt.engine.core.common.utils.ExternalId, org.ovirt.engine.core.authentication.DirectoryUser> index = new java.util.HashMap<>(); for (org.ovirt.engine.core.authentication.DirectoryUser directoryUser : directoryUsers) { index.put(directoryUser.getId(), directoryUser); } java.util.List<org.ovirt.engine.core.common.businessentities.DbUser> refreshed = new java.util.ArrayList<>(); for (org.ovirt.engine.core.common.businessentities.DbUser dbUser : dbUsers) { org.ovirt.engine.core.authentication.DirectoryUser directoryUser = index.get(dbUser.getExternalId()); dbUser = refreshUser(dbUser, directoryUser); if (dbUser != null) { refreshed.add(dbUser); } } return refreshed; }
@org.junit.Test public void networkNotInVfsConfigNotValid() { networkInVfsConfigCommonTest(true); assertThat(validator.networkNotInVfsConfig(org.ovirt.engine.core.bll.validator.VfsConfigValidatorTest.NETWORK_ID), org.ovirt.engine.core.bll.validator.ValidationResultMatchers.failsWith(EngineMessage.ACTION_TYPE_FAILED_NETWORK_ALREADY_IN_VFS_CONFIG, java.lang.String.format(VfsConfigValidator.NIC_NAME_REPLACEMENT, nic.getName()), java.lang.String.format(VfsConfigValidator.NETWORK_NAME_REPLACEMENT, network.getName()))); }
@java.lang.Override protected java.util.Map<java.lang.String, java.lang.String> getExclusiveLocks() { if (!(org.ovirt.engine.core.bll.gluster.GlusterCommandBase.isInternalExecution())) { return java.util.Collections.singletonMap(org.ovirt.engine.core.bll.gluster.GlusterCommandBase.getVdsGroupId().toString(), LockingGroup.GLUSTER.name()); } return super.getExclusiveLocks(); }
private void localize(org.ovirt.engine.ui.webadmin.ApplicationConstants constants) { nameEditor.setLabel(constants.affinityGroupNameLabel()); descriptionEditor.setLabel(constants.affinityDescriptionLabel()); positiveEditor.setLabel(constants.affinityGroupPolarityLabel()); enforcingEditor.setLabel(constants.affinityGroupEnforceTypeLabel()); }
public void setContentType(java.lang.String contentType) { if (contentType != null) { if (contentType.toLowerCase().contains("binary")) { this.contentType = GlusterHookContentType.BINARY; } else { this.contentType = GlusterHookContentType.TEXT; } } }
@java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object result) { java.util.ArrayList<org.ovirt.engine.core.common.businessentities.ExternalDiscoveredHost> hosts = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.ExternalDiscoveredHost>) (result)); org.ovirt.engine.ui.uicommonweb.models.ListModel externalDiscoveredHostsListModel = getExternalDiscoveredHosts(); externalDiscoveredHostsListModel.setItems(hosts); externalDiscoveredHostsListModel.setIsChangable(true); }
@java.lang.Override public boolean check(org.ovirt.engine.core.common.businessentities.VDS vds) { if ((emulatedMachines) == null) { throw new java.lang.IllegalStateException("check() called before isApplicable()"); } return org.ovirt.engine.core.bll.EmulatedMachineClusterEditChecker.getHostEmulatedMachines(vds).containsAll(emulatedMachines); }
@java.lang.Override public void onSuccess(final org.ovirt.engine.ui.frontend.communication.VdcOperation<org.ovirt.engine.core.common.action.VdcActionType, org.ovirt.engine.core.common.action.LoginUserParameters> operation, final org.ovirt.engine.core.common.action.VdcReturnValueBase result) { org.ovirt.engine.ui.frontend.Frontend.logger.finer("Succesful returned result from Login."); org.ovirt.engine.ui.frontend.Frontend.getInstance().setLoggedInUser(((org.ovirt.engine.core.common.businessentities.DbUser) (result.getActionReturnValue()))); result.setCanDoActionMessages(((java.util.ArrayList<java.lang.String>) (translateError(result)))); callback.getDel().onSuccess(callback.getModel(), result); if (((org.ovirt.engine.ui.frontend.Frontend.getInstance().getLoginHandler()) != null) && (result.getSucceeded())) { org.ovirt.engine.ui.frontend.Frontend.getInstance().getLoginHandler().onLoginSuccess(userName, password, domain); } }
private boolean primaryIpv4AddressNotSet() { return (!(hasIpConfiguration())) || (!(getIpConfiguration().hasIpv4PrimaryAddressSet())); }
protected java.util.Collection<org.ovirt.engine.core.compat.Guid> getStorageDomainsIds() { return org.ovirt.engine.core.bll.ImagesHandler.getAllStorageIdsForImageIds(getSourceImages()); }
void saveVmsToDb() { getDbFacade().getVmDynamicDao().updateAllInBatch(_vmDynamicToSave.values()); getDbFacade().getVmStatisticsDao().updateAllInBatch(_vmStatisticsToSave.values()); final java.util.List<org.ovirt.engine.core.common.businessentities.network.VmNetworkStatistics> allVmInterfaceStatistics = new java.util.LinkedList<org.ovirt.engine.core.common.businessentities.network.VmNetworkStatistics>(); for (java.util.List<org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface> list : _vmInterfaceStatisticsToSave.values()) { for (org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface iface : list) { allVmInterfaceStatistics.add(iface.getStatistics()); } } getDbFacade().getVmNetworkStatisticsDao().updateAllInBatch(allVmInterfaceStatistics); getDbFacade().getDiskImageDynamicDao().updateAllInBatch(_vmDiskImageDynamicToSave.values()); getDbFacade().getLunDao().updateAllInBatch(vmLunDisksToSave); getVdsEventListener().addExternallyManagedVms(_externalVmsToAdd); saveVmDevicesToDb(); saveVmJobsToDb(); saveVmGuestAgentNetworkDevices(); saveVmNumaNodeRuntimeData(); }
private java.util.Map<org.ovirt.engine.core.bll.storage.domain.SyncLunsInfoForBlockStorageDomainCommand.LunHandler, java.util.List<org.ovirt.engine.core.common.businessentities.storage.LUNs>> getLunsToUpdateInDb(org.ovirt.engine.core.compat.Guid lunFromVgLunId, org.ovirt.engine.core.compat.Guid lunFromDbLunId, org.ovirt.engine.core.compat.Guid lunFromVgPvId, org.ovirt.engine.core.compat.Guid lunFromDbPvId) { setLunsIds(lunFromVgLunId, lunFromDbLunId, lunFromVgPvId, lunFromDbPvId); return getLunsToUpdateInDb(); }
@java.lang.Override public void updateStep(final org.ovirt.engine.core.common.job.Step step) { org.ovirt.engine.core.utils.transaction.TransactionSupport.executeInNewTransaction(new org.ovirt.engine.core.utils.transaction.TransactionMethod<java.lang.Void>() { @java.lang.Override public java.lang.Void runInTransaction() { try { jobDao.updateJobLastUpdateTime(step.getJobId(), new java.util.Date()); stepDao.update(step); } catch (java.lang.Exception e) { org.ovirt.engine.core.bll.job.JobRepositoryImpl.log.error("Failed to update step '{}', '{}': {}", step.getId(), step.getStepName(), e.getMessage()); org.ovirt.engine.core.bll.job.JobRepositoryImpl.log.debug("Exception", e); } return null; } }); }
@java.lang.Override public void OnSuccess(java.lang.Object model, java.lang.Object returnValue) { if (!(((org.ovirt.engine.core.common.businessentities.VDSGroup) (getCluster().getSelectedItem())).getId().equals(cluster.getId()))) { return; } if (((java.lang.Boolean) (returnValue))) { getAddBricksCommand().setIsExecutionAllowed(true); setMessage(null); } else { getAddBricksCommand().setIsExecutionAllowed(false); setMessage(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().volumeEmptyClusterValidationMsg()); } }
private boolean isConsoleCommandsExecutionAllowed() { final java.util.List<org.ovirt.engine.core.common.businessentities.VM> list = getSelectedItems(); if (list == null) { return false; } for (org.ovirt.engine.core.common.businessentities.VM vm : list) { if (consoleModelsCache.getVmConsolesForEntity(vm).canConnectToConsole()) { return true; } } return false; }
@java.lang.Override protected void endSuccessfully() { HandleEndAction(); }
@java.lang.Override public int hashCode() { final int prime = 31; int result = 1; result = (prime * result) + ((id) == null ? 0 : id.hashCode()); result = (prime * result) + ((created) == null ? 0 : created.hashCode()); return result; }
@java.lang.Override public void setMainTabSelectedItem(org.ovirt.engine.core.common.businessentities.VDSGroup selectedItem) { org.ovirt.engine.ui.webadmin.section.main.view.tab.cluster.SubTabClusterGeneralView.Driver.driver.edit(getDetailModel()); if (selectedItem.supportsVirtService()) { if (selectedItem.getselection_algorithm().equals(VdsSelectionAlgorithm.PowerSave)) { setVisibility(true); leftSlider.setValue(selectedItem.getlow_utilization()); rightSlider.setValue(selectedItem.gethigh_utilization()); policyTimeLabel.setText((((((constants.clusterPolicyForTimeLabel()) + " ") + (selectedItem.getcpu_over_commit_duration_minutes())) + " ") + (constants.clusterPolicyMinTimeLabel()))); policyFieldLabel.setText(constants.clusterPolicyPowSaveLabel()); } else if (selectedItem.getselection_algorithm().equals(VdsSelectionAlgorithm.EvenlyDistribute)) { setVisibility(true); leftSlider.setVisible(false); leftDummySlider.setVisible(true); rightSlider.setValue(selectedItem.gethigh_utilization()); policyTimeLabel.setText((((((constants.clusterPolicyForTimeLabel()) + " ") + (selectedItem.getcpu_over_commit_duration_minutes())) + " ") + (constants.clusterPolicyMinTimeLabel()))); policyFieldLabel.setText(constants.clusterPolicyEvenDistLabel()); } else { setVisibility(false); policyFieldLabel.setText(constants.clusterPolicyNoneLabel()); } } policyPanel.setVisible(selectedItem.supportsVirtService()); form.update(); }
private void removeHostedEngineLunDisk() { java.util.List<org.ovirt.engine.core.common.businessentities.storage.BaseDisk> disks = org.ovirt.engine.core.bll.storage.domain.ImportHostedEngineStorageDomainCommand.getDbFacade().getBaseDiskDao().getDisksByAlias(StorageConstants.HOSTED_ENGINE_LUN_DISK_ALIAS); if ((disks != null) && (!(disks.isEmpty()))) { org.ovirt.engine.core.common.businessentities.storage.BaseDisk heDirectLun = disks.get(0); org.ovirt.engine.core.common.action.VdcReturnValueBase removeDisk = getBackend().runInternalAction(VdcActionType.RemoveDisk, new org.ovirt.engine.core.common.action.RemoveDiskParameters(heDirectLun.getId())); if (!(removeDisk.getSucceeded())) { org.ovirt.engine.core.bll.storage.domain.ImportHostedEngineStorageDomainCommand.setSucceeded(false); log.error("Failed to remove the hosted engine direct lun disk"); } } }
public java.util.List<java.lang.String> validate() { for (org.ovirt.engine.core.common.businessentities.VdsNetworkInterface iface : params.getInterfaces()) { java.lang.String name = iface.getName(); if (addInterfaceToProcessedList(iface)) { if (isBond(iface)) { extractBondIfModified(iface, name); } else { if (org.apache.commons.lang.StringUtils.isNotBlank(iface.getBondName())) { extractBondSlave(iface); } java.lang.String nameWithoutVlanId = org.ovirt.engine.core.utils.NetworkUtils.StripVlan(name); if (!(getExistingIfaces().containsKey(nameWithoutVlanId))) { addViolation(VdcBllMessages.NETWORK_INTERFACES_DONT_EXIST, nameWithoutVlanId); } } if ((violations.isEmpty()) && (org.apache.commons.lang.StringUtils.isNotBlank(iface.getNetworkName()))) { extractNetwork(iface); } } } validateBondSlavesCount(); extractRemovedNetworks(); extractRemovedBonds(); detectSlaveChanges(); return translateViolations(); }
@java.lang.Override public boolean canBeSelected() { boolean hasVmSpiceSupport = java.lang.Boolean.TRUE.equals(org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().hasSpiceSupport(getEntity().getOs(), getEntity().getCompatibilityVersion())); return (getEntity().getGraphicsInfos().containsKey(GraphicsType.SPICE)) && hasVmSpiceSupport; }
private boolean isCheckStatusSupported() { return org.ovirt.engine.core.common.FeatureSupported.getDeviceListWithoutStatusSupported(org.ovirt.engine.core.vdsbroker.vdsbroker.GetDeviceListVDSCommand.getVds().getVdsGroupCompatibilityVersion()); }
protected void updateTimeZone(final java.lang.String selectedTimeZone) { if (org.ovirt.engine.core.compat.StringHelper.isNullOrEmpty(selectedTimeZone)) { updateDefaultTimeZone(); } else { doUpdateTimeZone(selectedTimeZone); } }
protected boolean checkIfImageDiskCanBeAdded(org.ovirt.engine.core.common.businessentities.VM vm, org.ovirt.engine.core.bll.validator.storage.DiskValidator diskValidator) { if (Guid.Empty.equals(getStorageDomainId())) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_STORAGE_DOMAIN_NOT_SPECIFIED); } boolean returnValue; org.ovirt.engine.core.bll.validator.storage.StorageDomainValidator storageDomainValidator = createStorageDomainValidator(); returnValue = (((((((((org.ovirt.engine.core.bll.AddDiskCommand.getParameters().isSkipDomainCheck()) || (validate(storageDomainValidator.isDomainExistAndActive()))) && (!(isShareableDiskOnGlusterDomain()))) && (checkImageConfiguration())) && (validate(storageDomainValidator.hasSpaceForNewDisk(getDiskImageInfo())))) && (validate(storageDomainValidator.isDomainWithinThresholds()))) && (checkExceedingMaxBlockDiskSize())) && (canAddShareableDisk())) && (validate(diskValidator.isVirtIoScsiValid(vm)))) && (validate(diskValidator.isDiskInterfaceSupported(org.ovirt.engine.core.bll.AddDiskCommand.getVm()))); if (returnValue && (vm != null)) { org.ovirt.engine.core.common.businessentities.StoragePool sp = org.ovirt.engine.core.bll.AddDiskCommand.getStoragePool(); returnValue = (((validate(new org.ovirt.engine.core.bll.validator.storage.StoragePoolValidator(sp).isUp())) && (isStoragePoolMatching(vm))) && (org.ovirt.engine.core.bll.AddDiskCommand.isVmNotLocked())) && (org.ovirt.engine.core.bll.AddDiskCommand.isVmNotInPreviewSnapshot()); } return returnValue; }
@java.lang.Override protected java.util.Map<java.lang.String, org.ovirt.engine.core.common.utils.Pair<java.lang.String, java.lang.String>> getExclusiveLocks() { java.util.Map<java.lang.String, org.ovirt.engine.core.common.utils.Pair<java.lang.String, java.lang.String>> locks = new java.util.HashMap<>(); locks.put(org.ovirt.engine.core.bll.RemoveVdsCommand.getParameters().getVdsId().toString(), org.ovirt.engine.core.bll.LockMessagesMatchUtil.makeLockingPair(LockingGroup.VDS, EngineMessage.ACTION_TYPE_FAILED_OBJECT_LOCKED)); return locks; }
@java.lang.Override public boolean isRequiredNetworkAffected(org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkItemModel<?> op1, org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkItemModel<?> op2) { final org.ovirt.engine.ui.uicommonweb.models.hosts.network.LogicalNetworkModel logicalNetworkModel = ((org.ovirt.engine.ui.uicommonweb.models.hosts.network.LogicalNetworkModel) (op1)); return logicalNetworkModel.getNetwork().getCluster().isRequired(); }
private boolean consoleDeviceChanged() { java.util.List<org.ovirt.engine.core.common.businessentities.VmDevice> consoleDevices = org.ovirt.engine.core.bll.UpdateVmCommand.getVmDeviceDao().getVmDeviceByVmIdAndType(org.ovirt.engine.core.bll.UpdateVmCommand.getParameters().getVmId(), VmDeviceGeneralType.CONSOLE); return (org.ovirt.engine.core.bll.UpdateVmCommand.getParameters().isConsoleEnabled()) == (consoleDevices.isEmpty()); }
private void guestAgentIsUpOrBalloonDeflated(org.ovirt.engine.core.compat.Guid vmId) { org.ovirt.engine.core.vdsbroker.VdsUpdateRunTimeInfo.vmsWithUncontrolledBalloon.remove(vmId); }
@org.junit.Test public void testSave() { newVmStatistics.setId(newVmStatic.getId()); newVmStatistics.setMigrationProgressPercent(0); newVmStatistics.setMemoryUsageHistory(java.util.Arrays.asList(2, 3, 4)); newVmStatistics.setCpuUsageHistory(java.util.Arrays.asList(5, 6, 7)); newVmStatistics.setNetworkUsageHistory(java.util.Collections.EMPTY_LIST); dao.save(newVmStatistics); org.ovirt.engine.core.common.businessentities.VmStatistics stats = dao.get(newVmStatic.getId()); assertNotNull(stats); assertEquals(newVmStatistics, stats); }
@java.lang.Override public int hashCode() { if (((service) == null) && ((parentService) == null)) { return 0; } if ((service) == null) { return parentService.hashCode(); } if ((parentService) == null) { return service.hashCode(); } return (997 * (service.hashCode())) ^ (991 * (parentService.hashCode())); }
private javax.ws.rs.core.Response cloneVmFromSnapshot(org.ovirt.engine.core.common.businessentities.VmStatic staticVm, org.ovirt.engine.api.model.VM vm, java.lang.String snapshotId, java.util.HashMap<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.businessentities.DiskImage> images) { org.ovirt.engine.core.compat.Guid sourceSnapshotId = asGuid(snapshotId); org.ovirt.engine.core.common.action.AddVmFromSnapshotParameters params = new org.ovirt.engine.core.common.action.AddVmFromSnapshotParameters(staticVm, sourceSnapshotId); params.setDiskInfoDestinationMap(images); params.setMakeCreatorExplicitOwner(shouldMakeCreatorExplicitOwner()); params.setConsoleEnabled(((vm.isSetConsole()) && (vm.getConsole().isSetEnabled()) ? vm.getConsole().isEnabled() : !(getConsoleDevicesForEntity(staticVm.getId()).isEmpty()))); return performCreate(VdcActionType.AddVmFromSnapshot, params, new org.ovirt.engine.api.restapi.resource.QueryIdResolver<org.ovirt.engine.core.compat.Guid>(org.ovirt.engine.core.common.queries.VdcQueryType.GetVmByVmId, org.ovirt.engine.core.common.queries.IdQueryParameters.class)); }
private boolean isBondModeFailover(java.lang.String bondOptions) { java.util.regex.Matcher matcher = org.ovirt.engine.core.bll.network.host.InterfacesSpeed.BOND_OPTS_MODE_CAPTURE.matcher(bondOptions); matcher.find(); int bondMode = parseInt(matcher.group(1)); return (bondMode == 1) || (bondMode == 3); }
private void editMacPool() { org.ovirt.engine.ui.uicommonweb.models.macpool.SharedMacPoolModel model = new org.ovirt.engine.ui.uicommonweb.models.macpool.SharedMacPoolModel(this, org.ovirt.engine.core.common.action.VdcActionType.UpdateMacPool); model.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().editSharedMacPoolTitle()); model.setHashName("edit_shared_mac_pool"); model.setHelpTag(HelpTag.edit_shared_mac_pool); model.setEntity(((org.ovirt.engine.core.common.businessentities.MacPool) (getSelectedItem()))); setWindow(model); }
public void initTunedProfiles() { this.startProgress(null); org.ovirt.engine.ui.frontend.Frontend.getInstance().runQuery(VdcQueryType.GetGlusterTunedProfiles, new org.ovirt.engine.core.common.queries.VdcQueryParametersBase(), new org.ovirt.engine.ui.frontend.AsyncQuery(new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.models.clusters.ClusterModel.this.stopProgress(); java.util.List<java.lang.String> glusterTunedProfiles = new java.util.ArrayList<>(); if (((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (returnValue)).getSucceeded()) { glusterTunedProfiles.addAll(((java.util.List<java.lang.String>) (((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (returnValue)).getReturnValue()))); } glusterTunedProfile.setItems(glusterTunedProfiles, glusterTunedProfile.getSelectedItem()); glusterTunedProfile.setIsAvailable(((glusterTunedProfile.getItems().size()) > 0)); } })); }
private java.util.List<java.util.ResourceBundle> getBundle(java.lang.String name, java.util.Locale locale) { java.util.List<java.util.ResourceBundle> result = new java.util.ArrayList<java.util.ResourceBundle>(); java.lang.String lastProcessedBundle = null; try { java.io.File themeDirectory = new java.io.File(filePath); java.net.URLClassLoader urlLoader = new java.net.URLClassLoader(new java.net.URL[]{ themeDirectory.toURI().toURL() }); final java.lang.String messageFileNames = brandingProperties.getProperty(name); if (messageFileNames != null) { for (java.lang.String fileName : messageFileNames.split(",")) { fileName = lastProcessedBundle = fileName.trim(); java.lang.String bundleName = ((fileName.lastIndexOf(org.ovirt.engine.core.utils.branding.BrandingTheme.PROPERTIES_FILE_SUFFIX)) != (-1)) ? fileName.substring(0, fileName.lastIndexOf(org.ovirt.engine.core.utils.branding.BrandingTheme.PROPERTIES_FILE_SUFFIX)) : messageFileNames; result.add(java.util.ResourceBundle.getBundle(bundleName, locale, urlLoader)); } } else { org.ovirt.engine.core.utils.branding.BrandingTheme.log.warn(((("Theme " + (this.getPath())) + " has no property defined for key ") + name)); } } catch (java.io.IOException e) { org.ovirt.engine.core.utils.branding.BrandingTheme.log.warn(("Unable to read resources resource " + "bundle, returning null"), e); } catch (java.util.MissingResourceException mre) { org.ovirt.engine.core.utils.branding.BrandingTheme.log.warn(((("Theme " + (this.getPath())) + " is missing ResourceBundle ") + lastProcessedBundle)); } return result; }
@org.junit.Test public void testRemoveRole() { dao.remove(existingRole.getId()); org.ovirt.engine.core.common.businessentities.Role result = dao.get(existingRole.getId()); assertNull(result); }
protected void syncSearch(org.ovirt.engine.core.common.queries.QueryType queryType, org.ovirt.engine.core.common.queries.VdcQueryParametersBase vdcQueryParametersBase) { syncSearch(queryType, vdcQueryParametersBase, new SetItemsAsyncQuery()); }
public static org.ovirt.engine.ui.common.widget.table.column.AbstractTextColumn<org.ovirt.engine.core.common.businessentities.storage.Disk> getAliasColumn(java.lang.String sortBy) { org.ovirt.engine.ui.common.widget.table.column.AbstractTextColumn<org.ovirt.engine.core.common.businessentities.storage.Disk> column = new org.ovirt.engine.ui.common.widget.table.column.AbstractTextColumn<org.ovirt.engine.core.common.businessentities.storage.Disk>() { @java.lang.Override public java.lang.String getValue(org.ovirt.engine.core.common.businessentities.storage.Disk object) { return object.getDiskAlias(); } }; return org.ovirt.engine.ui.common.widget.uicommon.disks.DisksViewColumns.makeSortable(column, sortBy); }
private java.util.List<org.ovirt.engine.core.common.businessentities.Erratum> runErrataListMethod(java.lang.String relativeUrl) { try { org.ovirt.engine.core.bll.host.provider.foreman.ErrataWrapper wrapper = objectMapper.readValue(runHttpGetMethod(relativeUrl), org.ovirt.engine.core.bll.host.provider.foreman.ErrataWrapper.class); return mapErrata(java.util.Arrays.asList(wrapper.getResults())); } catch (java.io.IOException e) { return null; } }
@java.lang.Override public java.lang.Void runInTransaction() { for (org.ovirt.engine.core.common.action.AttachNetworkToVdsGroupParameter param : getParameters().getClusterNetworksParameters()) { org.ovirt.engine.core.bll.network.cluster.AttachNetworkToVdsGroupCommand.attachNetwork(param.getVdsGroupId(), param.getNetworkCluster(), param.getNetwork()); } return null; }
public static org.ovirt.engine.core.vdsbroker.vdsbroker.IVdsServer createVdsServer(java.lang.String hostname, int port, int clientTimeOut, int connectionTimeOut, int clientRetries, int heartbeat) { org.apache.commons.httpclient.HttpClient client = org.ovirt.engine.core.vdsbroker.HttpUtils.getConnection(connectionTimeOut, clientRetries, org.ovirt.engine.core.common.config.Config.getValue(ConfigValues.VdsMaxConnectionsPerHost), org.ovirt.engine.core.common.config.Config.getValue(ConfigValues.MaxTotalConnections)); java.lang.String eventQueue = org.ovirt.engine.core.common.config.Config.getValue(ConfigValues.EventQueueName); return new org.ovirt.engine.core.vdsbroker.jsonrpc.JsonRpcVdsServer(org.ovirt.engine.core.vdsbroker.jsonrpc.JsonRpcUtils.createStompClient(hostname, port, connectionTimeOut, clientTimeOut, clientRetries, heartbeat, org.ovirt.engine.core.common.config.Config.getValue(ConfigValues.EncryptHostCommunication), org.ovirt.engine.core.common.config.Config.getValue(ConfigValues.VdsmSSLProtocol), org.ovirt.engine.core.common.config.Config.getValue(ConfigValues.EventProcessingPoolSize), org.ovirt.engine.core.common.config.Config.getValue(ConfigValues.VdsRequestQueueName), org.ovirt.engine.core.common.config.Config.getValue(ConfigValues.VdsResponseQueueName), eventQueue), client); }
protected boolean isFenceAgentValid(org.ovirt.engine.core.common.businessentities.pm.FenceAgent agent) { if ((org.apache.commons.lang.StringUtils.isEmpty(agent.getUser())) || (org.apache.commons.lang.StringUtils.isEmpty(agent.getPassword()))) { addValidationMessage(EngineMessage.ACTION_TYPE_FAILED_PM_ENABLED_WITHOUT_AGENT_CREDENTIALS); return false; } else { return true; } }
@org.junit.Test public void testWithoutEnoughSparesMemory() throws java.lang.Exception { parameters.put(PolicyUnitParameter.HE_SPARES_COUNT.getDbName(), "3"); hostedEngine.setVmMemSizeMb(7000); hosts.get(3).setPhysicalMemMb(2048); hosts.get(4).setPhysicalMemMb(2048); java.util.List<org.ovirt.engine.core.common.businessentities.VDS> result = policyUnit.filter(cluster, hosts, vm, parameters, messages); assertEquals(3, result.size()); }
@org.junit.Test public void testSave() { dao.save(vnicProfile); org.ovirt.engine.core.common.businessentities.network.VnicProfile result = dao.get(vnicProfile.getId()); assertNotNull(result); assertEquals(vnicProfile.getId(), result.getId()); assertFalse(result.isPortMirroring()); assertFalse(result.isPassthrough()); assertEquals(vnicProfile.getNetworkFilterId(), result.getNetworkFilterId()); assertTrue(result.isMigratable()); }
void localize(org.ovirt.engine.ui.common.CommonApplicationConstants constants) { memoryEditor.setLabel(constants.virtualMachineSnapshotPreviewPopupMemoryLabel()); messageLabel.setText(constants.snapshotContainsMemory()); }
public org.ovirt.engine.core.vdsbroker.irsbroker.OneUuidReturnForXmlRpc importCandidate(java.lang.String sdUUID, java.lang.String vmGUID, java.lang.String templateGUID, java.lang.String templateVolGUID, java.lang.String path, java.lang.String type, java.lang.String force) { java.util.Map<java.lang.String, java.lang.Object> xmlRpcReturnValue = irsServer.importCandidate(sdUUID, vmGUID, templateGUID, templateVolGUID, path, type, force); org.ovirt.engine.core.vdsbroker.irsbroker.OneUuidReturnForXmlRpc wrapper = new org.ovirt.engine.core.vdsbroker.irsbroker.OneUuidReturnForXmlRpc(xmlRpcReturnValue); return wrapper; }
private boolean canFindVmOrTemplate() { boolean retValue = true; if ((org.ovirt.engine.core.bll.MoveOrCopyDiskCommand.getParameters().getOperation()) == (org.ovirt.engine.core.common.businessentities.ImageOperation.Copy)) { java.util.Collection<org.ovirt.engine.core.common.businessentities.VmTemplate> templates = org.ovirt.engine.core.bll.MoveOrCopyDiskCommand.getVmTemplateDAO().getAllForImage(org.ovirt.engine.core.bll.MoveOrCopyDiskCommand.getImage().getImageId()).values(); if (templates.isEmpty()) { addCanDoActionMessage(VdcBllMessages.ACTION_TYPE_FAILED_TEMPLATE_DOES_NOT_EXIST); retValue = false; } else { org.ovirt.engine.core.common.businessentities.VmTemplate vmTemplate = templates.iterator().next(); setVmTemplate(vmTemplate); sharedLockMap = java.util.Collections.singletonMap(vmTemplate.getId(), LockingGroup.TEMPLATE.name()); } } else { java.util.List<org.ovirt.engine.core.common.businessentities.VM> listVms = getVmsForDiskId(); if (!(listVms.isEmpty())) { sharedLockMap = new java.util.HashMap<org.ovirt.engine.core.compat.Guid, java.lang.String>(); for (org.ovirt.engine.core.common.businessentities.VM vm : listVms) { sharedLockMap.put(vm.getId(), LockingGroup.VM.name()); } } } return retValue; }
private void onSave() { org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel model = ((org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel) (getWindow())); if (!(model.validate())) { return; } java.lang.String name = model.getName().getEntity(); boolean isBaseTemplate = false; if (model.getBehavior().isExistingTemplateBehavior()) { isBaseTemplate = ((org.ovirt.engine.ui.uicommonweb.models.vms.TemplateVmModelBehavior) (model.getBehavior())).getVmTemplate().isBaseTemplate(); } else if (model.getBehavior().isBlankTemplateBehavior()) { isBaseTemplate = true; } if (isBaseTemplate) { org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().isTemplateNameUnique(new org.ovirt.engine.ui.frontend.AsyncQuery(this, new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object target, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.models.templates.TemplateListModel templateListModel = ((org.ovirt.engine.ui.uicommonweb.models.templates.TemplateListModel) (target)); boolean isNameUnique = ((java.lang.Boolean) (returnValue)); templateListModel.postNameUniqueCheck(isNameUnique); } }), name); } else { postNameUniqueCheck(true); } }
@org.ovirt.engine.api.restapi.types.Mapping(from = org.ovirt.engine.core.common.businessentities.HasSerialNumberPolicy.class, to = org.ovirt.engine.api.model.SerialNumber.class) public static org.ovirt.engine.api.model.SerialNumber map(org.ovirt.engine.core.common.businessentities.HasSerialNumberPolicy entity, org.ovirt.engine.api.model.SerialNumber template) { if (template == null) { template = new org.ovirt.engine.api.model.SerialNumber(); } org.ovirt.engine.api.model.SerialNumberPolicy policy = org.ovirt.engine.api.restapi.types.SerialNumberMapper.map(entity.getSerialNumberPolicy(), null); template.setPolicy((policy == null ? "" : policy.value())); template.setValue(entity.getCustomSerialNumber()); return template; }
private void updateWANDisableEffects(final org.ovirt.engine.ui.uicommonweb.models.vms.ISpice spice) { org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().getWANDisableEffects(new org.ovirt.engine.ui.frontend.AsyncQuery(new org.ovirt.engine.ui.frontend.AsyncCallback<java.util.List<org.ovirt.engine.core.common.console.ConsoleOptions.WanDisableEffects>>() { @java.lang.SuppressWarnings("unchecked") @java.lang.Override public void onSuccess(java.util.List<org.ovirt.engine.core.common.console.ConsoleOptions.WanDisableEffects> returnValue) { spice.getOptions().setWanDisableEffects(returnValue); } })); }
protected boolean updateVmInSpm() { org.ovirt.engine.core.bll.storage.ovfstore.OvfUpdateProcessHelper ovfHelper = new org.ovirt.engine.core.bll.storage.ovfstore.OvfUpdateProcessHelper(org.ovirt.engine.core.bll.exportimport.ExportVmCommand.getVmDeviceUtils()); java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.compat.KeyValuePairCompat<java.lang.String, java.util.List<org.ovirt.engine.core.compat.Guid>>> metaDictionary = new java.util.HashMap<>(); ovfHelper.loadVmData(org.ovirt.engine.core.bll.exportimport.ExportVmCommand.getVm()); ovfHelper.buildMetadataDictionaryForVm(org.ovirt.engine.core.bll.exportimport.ExportVmCommand.getVm(), metaDictionary, ovfHelper.getVmImagesFromDb(org.ovirt.engine.core.bll.exportimport.ExportVmCommand.getVm())); return ovfHelper.executeUpdateVmInSpmCommand(org.ovirt.engine.core.bll.exportimport.ExportVmCommand.getVm().getStoragePoolId(), metaDictionary, org.ovirt.engine.core.bll.exportimport.ExportVmCommand.getParameters().getStorageDomainId()); }
private void logCommandInfo() { final char EQUAL = '='; final java.lang.String SEP = ","; java.lang.StringBuilder info = new java.lang.StringBuilder(); java.lang.String sep = ""; for (java.util.Map.Entry<java.lang.String, java.lang.Object> createInfoEntry : createInfo.entrySet()) { info.append(sep); info.append(createInfoEntry.getKey()); info.append(EQUAL); info.append(createInfoEntry.getValue()); sep = SEP; } org.ovirt.engine.core.vdsbroker.vdsbroker.CreateVDSCommand.log.infoFormat("{0} {1}", getClass().getName(), info.toString()); }
@java.lang.Override protected void setActionMessageParameters() { addCanDoActionMessage(EngineMessage.VAR__ACTION__UPDATE); addCanDoActionMessage(EngineMessage.VAR__TYPE__VM__CLUSTER); }
public org.ovirt.engine.api.model.Features getFeatures(org.ovirt.engine.api.model.Version version) { org.ovirt.engine.api.model.Features features = new org.ovirt.engine.api.model.Features(); if (org.ovirt.engine.api.restapi.utils.VersionUtils.greaterOrEqual(version, BackendCapabilitiesResource.VERSION_3_0)) { addFeatureTransparentHugePages(features); } if (org.ovirt.engine.api.restapi.utils.VersionUtils.greaterOrEqual(version, BackendCapabilitiesResource.VERSION_3_1)) { addFeatureGluster(features); addFeaturePosixDevice(features); addFeaturePortMirroring(features); addFeatureServerTime(features); addFeatureHostMemory(features); addFeatureHostSockets(features, version); addFeatureIgnoreCase(features); addFeatureMaxResults(features); addFeatureJSONContentType(features); addFeatureCorrelationId(features); addFeatureDiskActivation(features); addFeatureNicActivation(features); addFeatureSnapshotsRefactoring(features); addFeatureRemoveTemplateFromSD(features); addFeatureFloatingDisks(features); addFeatureAsyncDelete(features); addFeatureSessionBasedAuthentication(features); } if (org.ovirt.engine.api.restapi.utils.VersionUtils.greaterOrEqual(version, BackendCapabilitiesResource.VERSION_3_3)) { addFeatureVmApplications(features); addFeatureVnicCustomProperties(features); addFeatureVirtioScsi(features); addFeatureComment(features); addFeatureRefreshHostCapabilities(features); } return features; }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("This will skip fencing for a Host that has live lease on Storage Domains") java.lang.String skipFencingIfSDActiveInfo();
@org.junit.Test public void canDoActionFailsOnSnapshotTypeRegularNotInPreview() { mockSnapshotExists(); mockSnapshot = new org.ovirt.engine.core.common.businessentities.Snapshot(); when(snapshotDao.exists(any(org.ovirt.engine.core.compat.Guid.class), any(org.ovirt.engine.core.compat.Guid.class))).thenReturn(true); mockSnapshotFromDb(); mockSnapshot.setType(SnapshotType.REGULAR); mockSnapshot.setStatus(SnapshotStatus.OK); assertFalse(spyCommand.canDoAction()); assertTrue(spyCommand.getReturnValue().getCanDoActionMessages().contains(EngineMessage.ACTION_TYPE_FAILED_VM_SNAPSHOT_NOT_IN_PREVIEW.toString())); }
public void setPmOptions(org.ovirt.engine.ui.uicommonweb.models.EntityModel<java.lang.String> value) { if (value != null) { options = value; } }
public boolean isProxyHostAvailable(org.ovirt.engine.core.common.businessentities.VDS vds, java.util.List<java.lang.String> messages) { org.ovirt.engine.core.bll.pm.FenceProxyLocator proxyHostLocator = getProxyLocator(vds); if (!(proxyHostLocator.isProxyHostAvailable())) { messages.add(EngineMessage.VDS_NO_VDS_PROXY_FOUND.name()); return false; } else { return true; } }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("New Virtual Machine - Guide Me") java.lang.String newVirtualMachineGuideMeTitle();
protected void moveOrCopyAllImageGroups() { moveOrCopyAllImageGroups(org.ovirt.engine.core.bll.exportimport.ImportVmCommand.getVm().getId(), org.ovirt.engine.core.bll.storage.disk.image.DisksFilter.filterImageDisks(org.ovirt.engine.core.bll.exportimport.ImportVmCommand.getVm().getDiskMap().values(), org.ovirt.engine.core.bll.exportimport.ONLY_ACTIVE)); copyAllMemoryImages(org.ovirt.engine.core.bll.exportimport.ImportVmCommand.getVm().getId()); }
private void initIpConfigurationNetmask() { getTestedNetworkAttachment().getIpConfiguration().getPrimaryAddress().setNetmask(org.ovirt.engine.core.bll.validator.network.NetworkAttachmentIpConfigurationValidatorTest.NETMASK); }
public void setVdsStrength(int value) { this.mVdsStatic.setVdsStrength(value); }
protected void doChangeDefautlHost(org.ovirt.engine.core.compat.Guid hostGuid) { getModel().getIsAutoAssign().setEntity(true); if (hostGuid != null) { org.ovirt.engine.core.compat.Guid vdsId = hostGuid; if ((getModel().getDefaultHost().getItems()) != null) { getModel().getDefaultHost().setSelectedItem(org.ovirt.engine.ui.uicommonweb.Linq.firstOrDefault(getModel().getDefaultHost().getItems(), new org.ovirt.engine.ui.uicommonweb.Linq.HostPredicate(vdsId))); if (((getModel().getDefaultHost().getSelectedItem()) != null) && (getModel().getDefaultHost().getSelectedItem().getId().equals(vdsId))) { getModel().getIsAutoAssign().setEntity(false); } } } }
private int getTotalStorageDomainsStat() { return org.ovirt.engine.core.bll.GetSystemStatisticsQuery.getDbFacade().getSystemStatisticsValue(org.ovirt.engine.core.bll.GetSystemStatisticsQuery.TOTAL_STORAGE_DOMAIN_ENTITY_NAME); }
private void generateAdditionalQueryParameters() { buffer.addImport(java.util.Map.class); buffer.addLine("if (query != null) {"); buffer.addLine("for (Map.Entry<String, String> queryParam : query.entrySet()) {"); buffer.addLine("uriBuilder.addParameter(queryParam.getKey(), queryParam.getValue());"); buffer.addLine("}"); buffer.addLine("}"); }
@org.junit.Test public void shouldDetectDifferentOs() { assertThat(new org.ovirt.engine.core.bll.scheduling.OS("os1", new org.ovirt.engine.core.compat.Version("6.3")).isSameOsFamily(new org.ovirt.engine.core.bll.scheduling.OS("os2", new org.ovirt.engine.core.compat.Version("6.3"))), is(false)); }
@java.lang.Override protected void executeVdsBrokerCommand() { try { status = org.ovirt.engine.core.vdsbroker.SetAmountOfMemoryVDSCommand.getBroker().hotplugMemory(buildData()); org.ovirt.engine.core.vdsbroker.SetAmountOfMemoryVDSCommand.proceedProxyReturnValue(); } catch (java.lang.RuntimeException e) { org.ovirt.engine.core.vdsbroker.SetAmountOfMemoryVDSCommand.setVdsRuntimeError(e); org.ovirt.engine.core.vdsbroker.SetAmountOfMemoryVDSCommand.getVDSReturnValue().setExceptionString(null); } }
public static void addProfileDataToNic(java.util.Map<java.lang.String, java.lang.Object> struct, org.ovirt.engine.core.common.businessentities.VM vm, org.ovirt.engine.core.common.businessentities.VmDevice vmDevice, org.ovirt.engine.core.common.businessentities.network.VmNic nic) { org.ovirt.engine.core.common.businessentities.network.VnicProfile vnicProfile = null; org.ovirt.engine.core.common.businessentities.network.Network network = null; java.lang.String networkName = ""; if ((nic.getVnicProfileId()) != null) { vnicProfile = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVnicProfileDao().get(nic.getVnicProfileId()); if (vnicProfile != null) { network = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getNetworkDao().get(vnicProfile.getNetworkId()); networkName = network.getName(); log.debugFormat("VNIC {0} is using profile {1} on network {2}", nic.getName(), vnicProfile, networkName); org.ovirt.engine.core.vdsbroker.vdsbroker.VmInfoBuilder.addQosForDevice(struct, vnicProfile, vm.getVdsGroupCompatibilityVersion()); } } struct.put(VdsProperties.NETWORK, networkName); if ((vnicProfile != null) && (vnicProfile.isPortMirroring())) { struct.put(VdsProperties.PORT_MIRRORING, (network == null ? java.util.Collections.<java.lang.String>emptyList() : java.util.Collections.singletonList(networkName))); } org.ovirt.engine.core.vdsbroker.vdsbroker.VmInfoBuilder.addCustomPropertiesForDevice(struct, vm, vmDevice, vm.getVdsGroupCompatibilityVersion(), org.ovirt.engine.core.vdsbroker.vdsbroker.VmInfoBuilder.getVnicCustomProperties(vnicProfile)); }
@java.lang.Override protected com.gwtplatform.mvp.shared.proxy.PlaceRequest getMainTabRequest() { return org.ovirt.engine.ui.common.place.PlaceRequestFactory.get(WebAdminApplicationPlaces.errataMainTabPlace); }
public java.lang.String translateErrorTextSingle(java.lang.String errorMsg, java.lang.Boolean changeIfNotFound) { java.lang.String ret = ""; try { if ((errorMsg != null) && ((errorMsg.length()) > 0)) { java.lang.String errMsgCopy = errorMsg; if (!(isDynamicVariable(errorMsg))) { errorMsg = errorMsg.replace('.', '_'); } java.lang.String errorsString = errors.getString(errorMsg); if (errorsString != null) { ret = errorsString.replace("\n", "<br/>"); } else { if ((isDynamicVariable(errorMsg)) || (!changeIfNotFound)) { ret = errorMsg; } else { errorMsg = errMsgCopy; java.lang.String[] splitted = errorMsg.toLowerCase().split("_"); ret = java.lang.String.join(" ", splitted); } } } } catch (java.util.MissingResourceException e) { ret = errorMsg; } return ret; }
@java.lang.Override protected void executeQueryCommand() { getQueryReturnValue().setReturnValue(getDbFacade().getDiskProfileDao().get(getParameters().getId())); }
public boolean isRunAndPause() { return runAndPause; }
@java.lang.Override public javax.ws.rs.core.Response start(org.ovirt.engine.api.model.Action action) { org.ovirt.engine.core.common.action.RunVmParams params; org.ovirt.engine.core.common.action.VdcActionType actionType; if (action.isSetVm()) { org.ovirt.engine.api.model.VM vm = action.getVm(); validateEnums(org.ovirt.engine.api.model.VM.class, vm); actionType = org.ovirt.engine.core.common.action.VdcActionType.RunVmOnce; params = map(vm, map(map(getEntity(entityType, VdcQueryType.GetVmByVmId, new org.ovirt.engine.core.common.queries.IdQueryParameters(guid), id, true), new org.ovirt.engine.api.model.VM()), new org.ovirt.engine.core.common.action.RunVmOnceParams(guid))); if ((vm.isSetPlacementPolicy()) && (vm.getPlacementPolicy().isSetHost())) { validateParameters(vm.getPlacementPolicy(), "host.id|name"); params.setDestinationVdsId(getHostId(vm.getPlacementPolicy().getHost())); } } else { actionType = org.ovirt.engine.core.common.action.VdcActionType.RunVm; params = new org.ovirt.engine.core.common.action.RunVmParams(guid); } if ((action.isSetPause()) && (action.isPause())) { params.setRunAndPause(true); } return doAction(actionType, params, action); }
@java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object result) { org.ovirt.engine.ui.uicommonweb.models.userportal.UserPortalListModel userPortalListModel1 = ((org.ovirt.engine.ui.uicommonweb.models.userportal.UserPortalListModel) (model)); final org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel unitVmModel = ((org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel) (userPortalListModel1.getWindow())); org.ovirt.engine.core.common.action.AddVmFromTemplateParameters param = new org.ovirt.engine.core.common.action.AddVmFromTemplateParameters(gettempVm(), unitVmModel.getDisksAllocationModel().getImageToDestinationDomainMap(), org.ovirt.engine.core.compat.Guid.Empty); param.setMakeCreatorExplicitOwner(true); param.setSoundDeviceEnabled(((java.lang.Boolean) (unitVmModel.getIsSoundcardEnabled().getEntity()))); param.setConsoleEnabled(((java.lang.Boolean) (unitVmModel.getIsConsoleDeviceEnabled().getEntity()))); org.ovirt.engine.ui.frontend.Frontend.RunAction(VdcActionType.AddVmFromTemplate, param, new org.ovirt.engine.ui.uicommonweb.models.userportal.NetworkCreateOrUpdateFrontendActionAsyncCallback(unitVmModel, defaultNetworkCreatingManager), this); }
protected java.util.List<org.ovirt.engine.core.common.businessentities.storage.LUNs> getLogicalUnits() { return getBackendCollection(VdcQueryType.GetDeviceList, new org.ovirt.engine.core.common.queries.GetDeviceListQueryParameters(asGuid(hostId), org.ovirt.engine.core.common.businessentities.storage.StorageType.UNKNOWN, true, null)); }
public void addImage(org.ovirt.engine.core.common.businessentities.storage.DiskImage diskImage) { images.add(new org.ovirt.engine.core.common.businessentities.VdsmImageLocationInfo(diskImage)); }
private boolean stopVolume(org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity volume) { if ((volume != null) && ((volume.getStatus()) == (org.ovirt.engine.core.common.businessentities.gluster.GlusterStatus.UP))) { org.ovirt.engine.core.common.action.VdcReturnValueBase retVal = runInternalAction(VdcActionType.StopGlusterVolume, new org.ovirt.engine.core.common.action.gluster.GlusterVolumeActionParameters(volume.getId(), true)); if (!(retVal.getSucceeded())) { handleVdsError(AuditLogType.GLUSTER_VOLUME_STOP_FAILED, retVal.getExecuteFailedMessages().toString()); setSucceeded(false); return false; } } return true; }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Shareable Disk is not supported by the selected configuration") java.lang.String shareableDiskNotSupportedByConfiguration();
public void fatal(java.lang.Object msg) { error(msg); }
@java.lang.Override public org.ovirt.engine.core.common.businessentities.RepoImage mapRow(java.sql.ResultSet rs, int rowNum) throws java.sql.SQLException { org.ovirt.engine.core.common.businessentities.RepoImage entity = new org.ovirt.engine.core.common.businessentities.RepoImage(); entity.setRepoDomainId(org.ovirt.engine.core.compat.Guid.createGuidFromStringDefaultEmpty(rs.getString("storage_domain_id"))); entity.setLastRefreshed(rs.getLong("last_refreshed")); entity.setFileType(org.ovirt.engine.core.common.businessentities.ImageFileType.forValue(rs.getInt("file_type"))); return entity; }
private void updateExternalHostModels() { org.ovirt.engine.ui.frontend.AsyncQuery getProvidersQuery = new org.ovirt.engine.ui.frontend.AsyncQuery(); getProvidersQuery.asyncCallback = new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object result) { java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Provider> providers = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Provider>) (result)); org.ovirt.engine.ui.uicommonweb.models.ListModel<org.ovirt.engine.core.common.businessentities.Provider> providersListModel = getProviders(); providersListModel.setItems(providers); providersListModel.setIsChangable(true); providersListModel.setSelectedItem(providers.get(0)); getIsDiscorveredHosts().setEntity(null); getIsDiscorveredHosts().setEntity(true); } }; org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getAllProvidersByType(getProvidersQuery, ProviderType.FOREMAN); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Incorrect bricks selected for removal in Distributed Replicate volume.\nEither all the selected bricks should be from the same sub volume or one brick each for every sub volume!") java.lang.String cannotRemoveBricksDistributedReplicateVolume();
public static void Init() { org.ovirt.engine.core.bll.VmTemplateHandler.mUpdateVmTemplate = new org.ovirt.engine.core.utils.ObjectIdentityChecker(org.ovirt.engine.core.bll.VmTemplateHandler.class); org.ovirt.engine.core.bll.VmTemplateHandler.BlankVmTemplateId = new org.ovirt.engine.core.compat.Guid("00000000-0000-0000-0000-000000000000"); org.ovirt.engine.core.bll.VmTemplateHandler.mUpdateVmTemplate.AddPermittedFields(new java.lang.String[]{ "name", "description", "domain", "os", "osType", "is_auto_suspend", "interfaces", "mem_size_mb", "num_of_sockets", "cpu_per_socket", "vds_group_id", "num_of_monitors", "allowConsoleReconnect", "usb_policy", "time_zone", "diskMap", "default_boot_sequence", "iso_path", "diskImageMap", "default_display_type", "priority", "auto_startup", "is_stateless", "initrd_url", "kernel_url", "kernel_params", "images", "interfaces", "quotaId", "quotaName", "quotaEnforcementType", "migrationSupport", "dedicated_vm_for_vds", "smartcardEnabled", "deleteProtected" }); }
@java.lang.Override public boolean validateAndSetQuota() { if ((getStoragePool()) == null) { setStoragePool(org.ovirt.engine.core.bll.CommonVmPoolWithVmsCommand.getStoragePoolDAO().getForVdsGroup(org.ovirt.engine.core.bll.CommonVmPoolWithVmsCommand.getParameters().getVmStaticData().getvds_group_id())); } if (org.ovirt.engine.core.bll.CommonVmPoolWithVmsCommand.getQuotaManager().validateQuotaForStoragePool(getStoragePool(), org.ovirt.engine.core.bll.CommonVmPoolWithVmsCommand.getParameters().getVmStaticData().getvds_group_id(), getQuotaId(), org.ovirt.engine.core.bll.CommonVmPoolWithVmsCommand.getReturnValue().getCanDoActionMessages())) { return org.ovirt.engine.core.bll.CommonVmPoolWithVmsCommand.getQuotaManager().validateAndSetStorageQuota(getStoragePool(), getStorageQuotaListParameters(), org.ovirt.engine.core.bll.CommonVmPoolWithVmsCommand.getReturnValue().getCanDoActionMessages()); } return false; }
private static java.util.concurrent.locks.Lock getSyncObject(org.ovirt.engine.core.compat.Guid domainId, org.ovirt.engine.core.common.businessentities.storage.ImageFileType imageType) { org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.businessentities.storage.ImageFileType> domainPerFileType = new org.ovirt.engine.core.common.utils.Pair(domainId, imageType); org.ovirt.engine.core.bll.storage.domain.IsoDomainListSyncronizer.syncDomainForFileTypeMap.putIfAbsent(domainPerFileType, new java.util.concurrent.locks.ReentrantLock()); return org.ovirt.engine.core.bll.storage.domain.IsoDomainListSyncronizer.syncDomainForFileTypeMap.get(domainPerFileType); }
@org.junit.Test public void vmNotInPreviewReturnsInvalidResultWhenInSnapshot() throws java.lang.Exception { when(snapshotDao.exists(vmId, SnapshotStatus.IN_PREVIEW)).thenReturn(true); org.ovirt.engine.core.bll.snapshots.SnapshotsValidatorTest.validateInvalidResult(validator.vmNotInPreview(vmId), EngineMessage.ACTION_TYPE_FAILED_VM_IN_PREVIEW); }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.StorageDomain> getPermittedStorageDomainsByStoragePool(org.ovirt.engine.core.compat.Guid userId, org.ovirt.engine.core.common.businessentities.ActionGroup actionGroup, org.ovirt.engine.core.compat.Guid storagePoolId) { return getCallsHandler().executeReadList("Getstorage_domains_by_storage_pool_id_with_permitted_action", org.ovirt.engine.core.dao.StorageDomainDaoImpl.StorageDomainRowMapper.instance, getCustomMapSqlParameterSource().addValue("user_id", userId).addValue("action_group_id", actionGroup.getId()).addValue("storage_pool_id", storagePoolId)); }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("Option") java.lang.String volumeSnapshotConfigName();
@java.lang.Override protected org.ovirt.engine.ui.uicommonweb.UICommand resolveCommand() { return getMainModel().getSetConsoleKeyCommand(); }
private void setupMock() throws java.lang.Exception { mockEngineSSHClient = mock(org.ovirt.engine.core.bll.utils.EngineSSHClient.class); doNothing().when(mockEngineSSHClient).connect(); doNothing().when(mockEngineSSHClient).authenticate(); doReturn(mockEngineSSHClient).when(getQuery()).getEngineSSHClient(); }
@java.lang.Override protected void executeCommand() { org.ovirt.engine.core.dao.DbUserDAO dao = org.ovirt.engine.core.bll.AddUserCommand.getDbUserDAO(); org.ovirt.engine.core.aaa.DirectoryUtils.flatGroups(principal); java.util.HashSet<org.ovirt.engine.core.compat.Guid> groupIds = org.ovirt.engine.core.aaa.DirectoryUtils.getGroupIdsFromPrincipal(org.ovirt.engine.core.bll.AddUserCommand.getParameters().getDirectory(), principal); org.ovirt.engine.core.common.businessentities.DbUser dbUser = dao.getByExternalId(org.ovirt.engine.core.bll.AddUserCommand.getParameters().getDirectory(), principal.<java.lang.String>get(PrincipalRecord.ID)); if (dbUser == null) { dbUser = org.ovirt.engine.core.aaa.DirectoryUtils.mapPrincipalRecordToDbUser(org.ovirt.engine.core.bll.AddUserCommand.getParameters().getDirectory(), principal); dbUser.setId(org.ovirt.engine.core.compat.Guid.newGuid()); dbUser.setGroupIds(groupIds); dao.save(dbUser); } else { org.ovirt.engine.core.compat.Guid id = dbUser.getId(); dbUser = org.ovirt.engine.core.aaa.DirectoryUtils.mapPrincipalRecordToDbUser(org.ovirt.engine.core.bll.AddUserCommand.getParameters().getDirectory(), principal); dbUser.setId(id); dbUser.setGroupIds(groupIds); dao.update(dbUser); } setActionReturnValue(dbUser.getId()); org.ovirt.engine.core.bll.AddUserCommand.setSucceeded(true); }
@org.junit.Test public void validateVmMemoryCanStartOnVds() { boolean vmPassedMemoryRequirement = slaValidator.hasPhysMemoryToRunVM(vds, vm, 0); assertTrue(vmPassedMemoryRequirement); }
protected boolean validateFreeSpace(org.ovirt.engine.core.bll.validator.storage.StorageDomainValidator storageDomainValidator, java.util.List<org.ovirt.engine.core.common.businessentities.DiskImage> disksList) { java.util.Collection<org.ovirt.engine.core.common.businessentities.DiskImage> disks = org.ovirt.engine.core.bll.ImagesHandler.getDisksDummiesForStorageAllocations(disksList); return validate(storageDomainValidator.hasSpaceForNewDisks(disks)); }
private void updateNetworksFromParams(final org.ovirt.engine.core.compat.Guid vmId, java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase> parameters) { if ((parameters.size()) == 0) { callback.networkCreated(vmId); return; } org.ovirt.engine.ui.frontend.Frontend.RunMultipleAction(VdcActionType.UpdateVmInterface, parameters, new org.ovirt.engine.ui.uicompat.IFrontendMultipleActionAsyncCallback() { @java.lang.Override public void executed(org.ovirt.engine.ui.uicompat.FrontendMultipleActionAsyncResult result) { callback.networkCreated(vmId); } }, this); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Remove Disk(s)") java.lang.String removeDisksTitle();
protected boolean checkExistingStorageDomain() { if ((org.ovirt.engine.core.bll.storage.AddExistingFileStorageDomainCommand.getStorageDomainStaticDAO().get(org.ovirt.engine.core.bll.storage.AddExistingFileStorageDomainCommand.getStorageDomain().getId())) != null) { return failCanDoAction(VdcBllMessages.ACTION_TYPE_FAILED_STORAGE_DOMAIN_ALREADY_EXIST); } org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.common.businessentities.StorageDomainStatic, org.ovirt.engine.core.compat.Guid> domainFromIrs = executeHSMGetStorageDomainInfo(new org.ovirt.engine.core.common.vdscommands.HSMGetStorageDomainInfoVDSCommandParameters(org.ovirt.engine.core.bll.storage.AddExistingFileStorageDomainCommand.getVdsId(), org.ovirt.engine.core.bll.storage.AddExistingFileStorageDomainCommand.getStorageDomain().getId())); if (domainFromIrs == null) { return failCanDoAction(VdcBllMessages.ACTION_TYPE_FAILED_STORAGE_DOMAIN_NOT_EXIST); } org.ovirt.engine.core.common.businessentities.StorageDomain storageDomainFromIrs = new org.ovirt.engine.core.common.businessentities.StorageDomain(); storageDomainFromIrs.setStorageStaticData(domainFromIrs.getFirst()); org.ovirt.engine.core.bll.validator.storage.StorageDomainValidator validator = new org.ovirt.engine.core.bll.validator.storage.StorageDomainValidator(storageDomainFromIrs); if (!(validate(validator.isHostedEngineStorage()))) { return false; } return concreteCheckExistingStorageDomain(domainFromIrs); }
public static void getDataCentersWithPermittedActionOnClusters(org.ovirt.engine.ui.frontend.AsyncQuery aQuery, org.ovirt.engine.core.common.businessentities.ActionGroup actionGroup, final boolean supportsVirtService, final boolean supportsGlusterService) { aQuery.converterCallback = new org.ovirt.engine.ui.frontend.IAsyncConverter() { @java.lang.Override public java.lang.Object Convert(java.lang.Object source, org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery) { if (source == null) { return new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StoragePool>(); } return source; } }; org.ovirt.engine.core.common.queries.GetDataCentersWithPermittedActionOnClustersParameters getDataCentersWithPermittedActionOnClustersParameters = new org.ovirt.engine.core.common.queries.GetDataCentersWithPermittedActionOnClustersParameters(); getDataCentersWithPermittedActionOnClustersParameters.setActionGroup(actionGroup); getDataCentersWithPermittedActionOnClustersParameters.setSupportsVirtService(supportsVirtService); getDataCentersWithPermittedActionOnClustersParameters.setSupportsGlusterService(supportsGlusterService); org.ovirt.engine.ui.frontend.Frontend.RunQuery(VdcQueryType.GetDataCentersWithPermittedActionOnClusters, getDataCentersWithPermittedActionOnClustersParameters, aQuery); }
org.ovirt.engine.core.vdsbroker.irsbroker.OneUuidReturn moveImage(java.lang.String spUUID, java.lang.String srcDomUUID, java.lang.String dstDomUUID, java.lang.String imgGUID, java.lang.String vmGUID, int op, java.lang.String postZero, java.lang.Boolean discard, java.lang.String force);
@java.lang.Override protected boolean canDoAction() { initializeObjectState(); if (!(validateVmNotDuringSnapshot())) { handleCanDoActionFailure(); return false; } if (!(validateSnapshotExists())) { handleCanDoActionFailure(); return false; } if (!(validateImages())) { handleCanDoActionFailure(); return false; } if (!(validateImageNotInTemplate())) { addCanDoActionMessage(VdcBllMessages.ACTION_TYPE_FAILED_CANNOT_REMOVE_IMAGE_TEMPLATE); handleCanDoActionFailure(); return false; } if (!(validateImageNotActive())) { addCanDoActionMessage(VdcBllMessages.ACTION_TYPE_FAILED_CANNOT_REMOVE_ACTIVE_IMAGE); handleCanDoActionFailure(); return false; } org.ovirt.engine.core.bll.RemoveSnapshotCommand.getReturnValue().setCanDoAction(true); return true; }
public static void populateMemoryUtilizationVms(org.ovirt.engine.ui.frontend.server.dashboard.Utilization utilization, javax.sql.DataSource dwhDataSource) throws org.ovirt.engine.ui.frontend.server.dashboard.DashboardDataException { org.ovirt.engine.ui.frontend.server.dashboard.dao.VmDwhDao dao = new org.ovirt.engine.ui.frontend.server.dashboard.dao.VmDwhDao(dwhDataSource); java.util.List<org.ovirt.engine.ui.frontend.server.dashboard.models.TrendResources> usageList = dao.getMemoryUtilizationVms(); for (org.ovirt.engine.ui.frontend.server.dashboard.models.TrendResources usage : usageList) { org.ovirt.engine.ui.frontend.server.dashboard.UtilizedEntity entity = new org.ovirt.engine.ui.frontend.server.dashboard.UtilizedEntity(); entity.setName(usage.getName()); entity.setUsed(((usage.getUsed()) / 1024)); entity.setTotal(((usage.getTotal()) / 1024)); entity.setTrend(org.ovirt.engine.ui.frontend.server.dashboard.UtilizationHelper.calculateTrend(usage.getUsed(), usage.getPreviousUsed())); utilization.addVm(entity); } }
@java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { if ("IsAvailable".equals(((org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs) (args)).PropertyName)) { qpidTitle.setVisible(model.getIsAvailable()); } }
protected void setupTemplate(org.ovirt.engine.core.compat.Guid templateId, final boolean useLatest) { org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getTemplateById(new org.ovirt.engine.ui.frontend.AsyncQuery(getModel(), new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object target, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel model = ((org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel) (target)); org.ovirt.engine.core.common.businessentities.VmTemplate template = ((org.ovirt.engine.core.common.businessentities.VmTemplate) (returnValue)); if (useLatest) { template = createLatestTemplate(template); } setupBaseTemplate(template.getBaseTemplateId()); model.getTemplate().setItems(java.util.Collections.singletonList(template)); model.getTemplate().setSelectedItem(template); model.getTemplate().setIsChangable(false); if (!(template.getId().equals(Guid.Empty))) { getModel().getVmInitModel().init(template); } } }, getModel().getHash()), templateId); }
@java.lang.Override public org.ovirt.engine.api.model.Label get() { org.ovirt.engine.api.model.Labels labels = parent.list(); if (labels != null) { for (org.ovirt.engine.api.model.Label label : labels.getLabels()) { if (label.getId().equals(id)) { label.setNetwork(new org.ovirt.engine.api.model.Network()); label.getNetwork().setId(parent.getNetworkId().toString()); return addLinks(label); } } } return notFound(); }
protected void refreshModel() { org.ovirt.engine.ui.frontend.AsyncQuery query = new org.ovirt.engine.ui.frontend.AsyncQuery(this, new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.models.events.EventListModel eventListModel = ((org.ovirt.engine.ui.uicommonweb.models.events.EventListModel) (model)); java.util.ArrayList<org.ovirt.engine.core.common.businessentities.AuditLog> list = ((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (returnValue)).getReturnValue(); requestingData = false; for (org.ovirt.engine.core.common.businessentities.AuditLog auditLog : list) { if (((auditLog.getCorrelationId()) != null) && (auditLog.getCorrelationId().startsWith(TaskListModel._WEBADMIN_))) { auditLog.setCorrelationId(auditLog.getCorrelationId().split("_")[2]); } } eventListModel.updateItems(list); } }); org.ovirt.engine.core.common.queries.SearchParameters params = new org.ovirt.engine.core.common.queries.SearchParameters(applySortOptions(org.ovirt.engine.ui.uicommonweb.models.events.EventListModel.getSearchString()), org.ovirt.engine.core.common.interfaces.SearchType.AuditLog, org.ovirt.engine.ui.uicommonweb.models.events.EventListModel.isCaseSensitiveSearch()); params.setMaxCount(org.ovirt.engine.ui.uicommonweb.models.events.EventListModel.getSearchPageSize()); params.setSearchFrom(((getLastEvent()) != null ? getLastEvent().getAuditLogId() : 0)); params.setRefresh(false); org.ovirt.engine.ui.frontend.Frontend.getInstance().runQuery(VdcQueryType.Search, params, query); }
@org.ovirt.engine.api.restapi.types.Mapping(from = org.ovirt.engine.api.model.DisplayType.class, to = java.lang.String.class) public static java.lang.String map(org.ovirt.engine.core.common.businessentities.DisplayType type, java.lang.String incoming) { switch (type) { case vnc : return DisplayType.VNC.value(); case qxl : return DisplayType.SPICE.value(); default : return null; } }
@java.lang.Override protected void setUpEntityQueryExpectations(int times, java.lang.Object failure) throws java.lang.Exception { while ((times--) > 0) { setUpEntityQueryExpectations(VdcQueryType.GetNetworksByStoragePoolId, org.ovirt.engine.core.common.queries.StorageDomainAndPoolQueryParameters.class, new java.lang.String[]{ "StoragePoolId" }, new java.lang.Object[]{ org.ovirt.engine.api.restapi.resource.BackendDataCenterNetworksResourceTest.DATA_CENTER_ID }, getEntityList(), failure); } }
private void updateDiskVmSnapshotId() { org.ovirt.engine.core.compat.Guid snapshotId = org.ovirt.engine.core.bll.AttachDiskToVmCommand.getSnapshotDao().getId(org.ovirt.engine.core.bll.AttachDiskToVmCommand.getVmId(), SnapshotType.ACTIVE); if (disk.getDiskStorageType().isInternal()) { org.ovirt.engine.core.common.businessentities.storage.DiskImage diskImage = ((org.ovirt.engine.core.common.businessentities.storage.DiskImage) (disk)); org.ovirt.engine.core.bll.AttachDiskToVmCommand.getImageDao().updateImageVmSnapshotId(diskImage.getImageId(), snapshotId); } else { throw new org.ovirt.engine.core.common.errors.EngineException(org.ovirt.engine.core.common.errors.EngineError.StorageException, "update of snapshot id was initiated for unsupported disk type"); } }
public java.lang.Long getLastWatchdogEvent() { return lastWatchdogEvent; }
@java.lang.Override protected void setActionMessageParameters() { addValidationMessage(EngineMessage.VAR__ACTION__ADD); addValidationMessage(EngineMessage.VAR__TYPE__QUOTA); }
private java.lang.Boolean getMigrateCompressed() { if (org.ovirt.engine.core.common.FeatureSupported.migrationCompression(MigrateVmCommand.getVm().getCompatibilityVersion())) { if ((MigrateVmCommand.getVm().getMigrateCompressed()) != null) { return MigrateVmCommand.getVm().getMigrateCompressed(); } if ((MigrateVmCommand.getCluster().getMigrateCompressed()) != null) { return MigrateVmCommand.getCluster().getMigrateCompressed(); } return org.ovirt.engine.core.common.config.Config.getValue(ConfigValues.DefaultMigrationCompression); } return null; }
public org.ovirt.engine.core.bll.ValidationResult networkQosExistsOrNull() { return ((vnicProfile.getNetworkQosId()) == null) || ((getDbFacade().getQosDao().get(vnicProfile.getNetworkQosId())) != null) ? org.ovirt.engine.core.bll.ValidationResult.VALID : new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.VdcBllMessages.ACTION_TYPE_FAILED_NETWORK_QOS_NOT_EXISTS); }
@java.lang.Override public void setEnabled(boolean enabled) { contentWidget.setEnabled(enabled); if (enabled) { getFormLabel().getElement().replaceClassName(OvirtCss.LABEL_DISABLED, OvirtCss.LABEL_ENABLED); } else { getFormLabel().getElement().replaceClassName(OvirtCss.LABEL_ENABLED, OvirtCss.LABEL_DISABLED); } }
public static org.ovirt.engine.core.common.businessentities.VmDynamic buildVMDynamicDataFromList(java.util.Map<java.lang.String, java.lang.Object> xmlRpcStruct) { org.ovirt.engine.core.common.businessentities.VmDynamic vmdynamic = new org.ovirt.engine.core.common.businessentities.VmDynamic(); if (xmlRpcStruct.containsKey(VdsProperties.vm_guid)) { try { vmdynamic.setId(new org.ovirt.engine.core.compat.Guid(((java.lang.String) (xmlRpcStruct.get(VdsProperties.vm_guid))))); } catch (org.ovirt.engine.core.compat.FormatException e) { org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.log.info("vm id is not in uuid format, ", e); vmdynamic.setId(new org.ovirt.engine.core.compat.Guid()); } } if (xmlRpcStruct.containsKey(VdsProperties.status)) { vmdynamic.setStatus(org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.convertToVmStatus(((java.lang.String) (xmlRpcStruct.get(VdsProperties.status))))); } return vmdynamic; }
@java.lang.Override public java.nio.channels.SocketChannel call() throws java.io.IOException { java.net.InetAddress address = java.net.InetAddress.getByName(hostname); org.ovirt.vdsm.jsonrpc.client.reactors.ReactorClient.log.info(("Connecting to " + address)); final java.net.InetSocketAddress addr = new java.net.InetSocketAddress(address, port); final java.nio.channels.SocketChannel socketChannel = java.nio.channels.SocketChannel.open(); socketChannel.connect(addr); socketChannel.configureBlocking(false); updateLastHeartbeat(); return socketChannel; }
public static java.util.HashSet<org.ovirt.engine.core.compat.Guid> getGroupIdsFromPrincipal(java.lang.String authz, org.ovirt.engine.api.extensions.ExtMap principal) { java.util.HashSet<org.ovirt.engine.core.compat.Guid> results = new java.util.HashSet<org.ovirt.engine.core.compat.Guid>(); org.ovirt.engine.core.dao.DbGroupDAO dao = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getDbGroupDao(); for (org.ovirt.engine.api.extensions.ExtMap group : principal.get(PrincipalRecord.GROUPS, java.util.Collections.<org.ovirt.engine.api.extensions.ExtMap>emptyList())) { org.ovirt.engine.core.common.businessentities.DbGroup dbGroup = dao.getByExternalId(authz, group.<java.lang.String>get(GroupRecord.ID)); if (dbGroup != null) { results.add(dbGroup.getId()); } } return results; }
private static org.ovirt.engine.core.common.utils.Pair noneAndNone() { org.ovirt.engine.core.common.businessentities.VmInit vmInit = new org.ovirt.engine.core.common.businessentities.VmInit(); org.ovirt.engine.core.common.businessentities.VmInitNetwork underTest = new org.ovirt.engine.core.common.businessentities.VmInitNetwork(); underTest.setStartOnBoot(true); vmInit.setNetworks(java.util.Arrays.asList(underTest)); java.lang.String expectedOutput = null; return new org.ovirt.engine.core.common.utils.Pair(vmInit, expectedOutput); }
@java.lang.Override protected void executeCommand() { org.ovirt.engine.core.vdsbroker.irsbroker.SpmStopOnIrsVDSCommandParameters params = new org.ovirt.engine.core.vdsbroker.irsbroker.SpmStopOnIrsVDSCommandParameters(org.ovirt.engine.core.bll.ForceSelectSPMCommand.getParameters().getStoragePoolId(), org.ovirt.engine.core.bll.ForceSelectSPMCommand.getParameters().getPreferredSPMId()); runVdsCommand(VDSCommandType.SpmStopOnIrs, params); org.ovirt.engine.core.bll.ForceSelectSPMCommand.setSucceeded(true); }
@org.ovirt.engine.ui.frontend.DefaultStringValue("VLAN ID must be a number between 0 and 4094.") java.lang.String NETWORK_VLAN_OUT_OF_RANGE();
@java.lang.Override public com.google.gwt.event.shared.HandlerRegistration addValueChangeHandler(com.google.gwt.event.logical.shared.ValueChangeHandler<org.ovirt.engine.ui.uicommonweb.models.vms.IconWithOsDefault> handler) { return this.addHandler(handler, com.google.gwt.event.logical.shared.ValueChangeEvent.getType()); }
@java.lang.Override public boolean IsBetter(org.ovirt.engine.core.bll.VDS x, org.ovirt.engine.core.bll.VDS y, org.ovirt.engine.core.bll.VM vm) { if (((((((org.ovirt.engine.core.bll.VdsSelector.getEffectiveCpuCores(x)) == null) || ((org.ovirt.engine.core.bll.VdsSelector.getEffectiveCpuCores(y)) == null)) || ((x.getusage_cpu_percent()) == null)) || ((y.getusage_cpu_percent()) == null)) || ((x.getpending_vcpus_count()) == null)) || ((y.getpending_vcpus_count()) == null)) { return false; } return (calcDistributeMetric(x, vm)) > (calcDistributeMetric(y, vm)); }
@com.gwtplatform.mvp.client.annotations.TabInfo(container = org.ovirt.engine.ui.webadmin.section.main.presenter.tab.virtualMachine.VirtualMachineSubTabPanelPresenter.class) static com.gwtplatform.mvp.client.TabData getTabData(org.ovirt.engine.ui.webadmin.gin.ClientGinjector ginjector) { return new org.ovirt.engine.ui.common.widget.tab.ModelBoundTabData(ginjector.getApplicationConstants().virtualMachineEventSubTabLabel(), 7, ginjector.getSubTabVirtualMachineEventModelProvider(), org.ovirt.engine.ui.common.widget.Align.RIGHT); }
@java.lang.Override public java.lang.String toString() { return java.lang.String.format("vmId = %s", getVmId()); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("System") java.lang.String systemRoleTree();
private void mockExistingIfaces(org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface... nics) { java.util.List<org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface> existingIfaces = new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface>(); for (int i = 0; i < (nics.length); i++) { existingIfaces.add(createVdsInterface(nics[i].getId(), nics[i].getName(), nics[i].getBonded(), nics[i].getBondName(), nics[i].getVlanId(), nics[i].getNetworkName(), nics[i].isBridged(), nics[i].getAddress(), nics[i].isQosOverridden(), nics[i].getLabels())); } when(interfaceDAO.getAllInterfacesForVds(any(org.ovirt.engine.core.compat.Guid.class))).thenReturn(existingIfaces); }
public org.ovirt.engine.core.common.businessentities.ExternalStatus getExternalStatus() { return dynamicData.getExternalStatus(); }
protected boolean validateStorageDomainAvailableSpace() { return validate(getStorageDomainValidator().hasSpaceForRemovingDiskSnapshots(getImages())); }
private void setVmsSelectionModel(org.ovirt.engine.ui.uicommonweb.models.configure.scheduling.affinity_groups.VmsSelectionModel vmsSelectionModel) { this.vmsSelectionModel = vmsSelectionModel; }
@org.junit.Test public void testGetBaseNicVerifyDelegation() throws java.lang.Exception { org.ovirt.engine.core.vdsbroker.CalculateBaseNic spy = spy(calculateBaseNic); spy.getBaseNic(baseNic); verify(spy).getBaseNic(any(org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface.class), anyMapOf(java.lang.String.class, org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface.class)); }
public boolean isSearchValidForServerSideSorting() { java.lang.String search = getSearchString(); org.ovirt.engine.core.searchbackend.SyntaxContainer syntaxResult = getSyntaxChecker().analyzeSyntaxState(search, true); if ((syntaxResult.getError()) != (org.ovirt.engine.core.searchbackend.SyntaxError.NO_ERROR)) { return false; } for (org.ovirt.engine.core.searchbackend.SyntaxObject syntaxObject : syntaxResult) { if ((syntaxObject.getType()) == (org.ovirt.engine.core.searchbackend.SyntaxObjectType.SORTBY)) { return false; } } return true; }
public com.google.gwt.view.client.SelectionModel<T> getSelectionModel() { if (isSingleSelectionOnly()) { return getSingleSelectionModel(); } else { return getOrderedMultiSelectionModel(); } }
public java.util.Map<java.lang.String, java.lang.Integer> getOperationsJobWeight() { return operationsJobWeight; }
@java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { java.util.ArrayList<org.ovirt.engine.core.common.businessentities.DiskInterface> diskInterfaces = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.DiskInterface>) (returnValue)); boolean isOsSupportVirtioScsi = diskInterfaces.contains(DiskInterface.VirtIO_SCSI); getModel().getIsVirtioScsiEnabled().setIsChangable(isOsSupportVirtioScsi); if (!isOsSupportVirtioScsi) { getModel().getIsVirtioScsiEnabled().setEntity(false); getModel().getIsVirtioScsiEnabled().setChangeProhibitionReason(constants.cannotEnableVirtioScsiForOs()); } else { if (org.ovirt.engine.core.compat.Guid.isNullOrEmpty(vmId)) { boolean isVirtioScsiEnabled = ((java.lang.Boolean) (org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getConfigValuePreConverted(ConfigurationValues.VirtIoScsiEnabled, cluster.getcompatibility_version().getValue()))); getModel().getIsVirtioScsiEnabled().setEntity(isVirtioScsiEnabled); } else { org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.isVirtioScsiEnabledForVm(new org.ovirt.engine.ui.frontend.AsyncQuery(getModel(), new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { getModel().getIsVirtioScsiEnabled().setEntity(((java.lang.Boolean) (returnValue))); } }), vmId); } } }
public java.lang.String getPrincipal(java.lang.String sessionId) { return getPrincipalName(sessionId); }
@java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object ReturnValue) { setItems(((java.util.List<org.ovirt.engine.core.common.businessentities.Provider>) (((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (ReturnValue)).getReturnValue()))); }
@java.lang.Override protected void init(T parameters) { super.init(parameters); org.ovirt.engine.core.common.businessentities.storage.DiskImage representativeImage = getRepresentativeImage(); if (representativeImage == null) { return; } setImage(representativeImage); setStorageDomainId(representativeImage.getStorageIds().get(0)); org.ovirt.engine.core.bll.snapshots.RemoveDiskSnapshotsCommand.getParameters().setUseCinderCommandCallback((!(org.ovirt.engine.core.bll.storage.disk.image.ImagesHandler.filterDisksBasedOnCinder(getImages()).isEmpty()))); if (!(org.ovirt.engine.core.compat.Guid.isNullOrEmpty(org.ovirt.engine.core.bll.snapshots.RemoveDiskSnapshotsCommand.getParameters().getContainerId()))) { setVmId(org.ovirt.engine.core.bll.snapshots.RemoveDiskSnapshotsCommand.getParameters().getContainerId()); } else { java.util.List<org.ovirt.engine.core.common.businessentities.VM> listVms = org.ovirt.engine.core.bll.snapshots.RemoveDiskSnapshotsCommand.getVmDao().getVmsListForDisk(representativeImage.getId(), false); if (!(listVms.isEmpty())) { org.ovirt.engine.core.common.businessentities.VM vm = listVms.get(0); setVm(vm); } } if (isLiveMerge()) { org.ovirt.engine.core.bll.snapshots.RemoveDiskSnapshotsCommand.clearTaskHandlers(); } }
private void refreshClusters() { log.debug("Discovering clusters..."); java.util.Set<java.lang.String> availableClusters = discovery.getClusters(); if (availableClusters == null) { log.error("Cluster discovery failed"); return; } availableClusters.removeAll(clusterOptimizers.keySet()); java.util.Properties config = new org.ovirt.optimizer.config.ConfigProvider().load().getConfig(); final int maxSteps = java.lang.Integer.parseInt(config.getProperty(ConfigProvider.SOLVER_STEPS)); for (java.lang.String clusterId : availableClusters) { log.info(java.lang.String.format("New cluster %s detected", clusterId)); long timeout = java.lang.Integer.parseInt(configProvider.load().getConfig().getProperty(ConfigProvider.SOLVER_TIMEOUT)); int refresh = java.lang.Integer.parseInt(configProvider.load().getConfig().getProperty(ConfigProvider.SOLVER_DATA_REFRESH)); org.ovirt.optimizer.solver.thread.ClusterOptimizer optimizer = new org.ovirt.optimizer.solver.thread.ClusterOptimizer(clusterId, maxSteps, (timeout * 1000), configProvider.customRuleFiles()); org.ovirt.optimizer.solver.thread.ClusterInfoUpdater updater = new org.ovirt.optimizer.solver.thread.ClusterInfoUpdater(client, optimizer); clusterOptimizers.put(clusterId, optimizer); java.util.concurrent.CompletableFuture.supplyAsync(optimizer, executors.getThreadPool()).thenApply(OptimalDistributionStepsSolution::getClusterId).thenApply(clusterOptimizers::remove); executors.getScheduler().scheduleWithFixedDelay(() -> executors.getThreadPool().submit(updater), 0, refresh, java.util.concurrent.TimeUnit.SECONDS); } }
public static org.ovirt.engine.ui.common.widget.uicommon.popup.vm.PopupWidgetConfig hiddenField() { return new org.ovirt.engine.ui.common.widget.uicommon.popup.vm.PopupWidgetConfig(false, true, false, false); }
public void registerProfile(org.ovirt.engine.core.aaa.AuthenticationProfile profile) { profiles.put(profile.getName(), profile); }
public void setSlaveClusters(org.ovirt.engine.ui.uicommonweb.models.ListModel<java.lang.String> slaveClusters) { this.slaveClusters = slaveClusters; }
public final java.util.List<java.lang.String> TranslateMessages(java.util.List<java.lang.String> errorMsg, boolean changeIfNotFound) { return doTranslation(errorMsg, changeIfNotFound, java.util.Locale.getDefault()); }
@java.lang.Override protected void executeQueryCommand() { org.ovirt.engine.core.bll.storage.disk.GetDiskByDiskIdQuery.getQueryReturnValue().setReturnValue(diskDao.get(org.ovirt.engine.core.bll.storage.disk.GetDiskByDiskIdQuery.getParameters().getId(), org.ovirt.engine.core.bll.storage.disk.GetDiskByDiskIdQuery.getUserID(), org.ovirt.engine.core.bll.storage.disk.GetDiskByDiskIdQuery.getParameters().isFiltered())); }
@java.lang.Override public org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc monitorCommand(java.lang.String vmId, java.lang.String monitorCommand) { org.ovirt.vdsm.jsonrpc.client.JsonRpcRequest request = new org.ovirt.vdsm.jsonrpc.client.RequestBuilder("VM.monitorCommand").withParameter("vmID", vmId).withParameter("command", monitorCommand).build(); java.util.Map<java.lang.String, java.lang.Object> response = new org.ovirt.engine.core.vdsbroker.jsonrpc.FutureMap(this.client, request); return new org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc(response); }
public boolean isRetryExtendTicket() { return retryExtendTicket; }
private void setInterfaces(java.util.ArrayList<org.ovirt.engine.core.common.businessentities.DiskInterface> diskInterfaces) { getDiskInterface().setItems(diskInterfaces); setDefaultInterface(); }
public static void reapAll() { for (java.util.Iterator<java.util.Map.Entry<java.lang.String, org.ovirt.engine.ui.common.widget.tooltip.ElementTooltipDetails>> i = org.ovirt.engine.ui.common.widget.tooltip.ElementTooltip.tooltipRegistry.entrySet().iterator(); i.hasNext();) { java.util.Map.Entry<java.lang.String, org.ovirt.engine.ui.common.widget.tooltip.ElementTooltipDetails> entry = i.next(); org.ovirt.engine.ui.common.widget.tooltip.ElementTooltip tooltip = entry.getValue().getTooltip(); if (tooltip.hasNullAncestor()) { tooltip.hide(); i.remove(); } } }
private java.util.List<org.ovirt.engine.core.common.businessentities.VDS> map(java.util.List<org.ovirt.engine.core.bll.host.provider.foreman.ForemanHostWrapper> foremanHosts) { java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VDS> hosts = new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VDS>(foremanHosts.size()); for (org.ovirt.engine.core.bll.host.provider.foreman.ForemanHostWrapper host : foremanHosts) { org.ovirt.engine.core.common.businessentities.VDS vds = new org.ovirt.engine.core.common.businessentities.VDS(); java.lang.String hostName = host.getHost().getName(); vds.setVdsName(hostName); vds.setHostName(hostName); hosts.add(vds); } return hosts; }
@java.lang.Override public boolean isDisplayNetworkAffected(org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkItemModel<?> op1, org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkItemModel<?> op2) { org.ovirt.engine.ui.uicommonweb.models.hosts.network.LogicalNetworkModel networkToBeAttached = ((org.ovirt.engine.ui.uicommonweb.models.hosts.network.LogicalNetworkModel) (op1)); return (org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkOperation.isDisplayNetwork(networkToBeAttached)) && (networkToBeAttached.isAttached()); }
private void debugQuery(org.ovirt.engine.core.common.queries.VdcQueryType queryType, org.ovirt.engine.core.common.queries.VdcQueryParametersBase parameters) { if (org.ovirt.engine.ui.frontend.server.gwt.GenericApiGWTServiceImpl.log.isDebugEnabled()) { java.lang.StringBuilder builder = new java.lang.StringBuilder(); builder.append("Query type: "); builder.append(queryType); builder.append(", Parameters: "); builder.append(parameters); org.ovirt.engine.ui.frontend.server.gwt.GenericApiGWTServiceImpl.log.debug(builder.toString()); } }
protected org.ovirt.engine.core.common.businessentities.StoragePool setUpStoragePool(org.ovirt.engine.core.compat.Guid id) { org.ovirt.engine.core.common.businessentities.StoragePool pool = control.createMock(org.ovirt.engine.core.common.businessentities.StoragePool.class); expect(pool.getId()).andReturn(id).anyTimes(); return pool; }
public java.lang.String getBondName() { return bondName; }
protected boolean checkDomainCanBeAttached(org.ovirt.engine.core.common.businessentities.StorageDomain storageDomain) { if (!(validateAmountOfIsoAndExportDomainsInDC(storageDomain))) { return false; } if (!(isStorageDomainFormatCorrectForDC(storageDomain, org.ovirt.engine.core.bll.storage.StorageHandlingCommandBase.getStoragePool()))) { return false; } if (!(checkStorageDomainSharedStatusNotLocked(storageDomain))) { return false; } if (!((isStorageDomainOfTypeIsoOrExport(storageDomain)) || (isStorageDomainNotInPool(storageDomain)))) { return false; } if (!(isStorageDomainTypeCorrect(storageDomain))) { return false; } if (!(isStorageDomainCompatibleWithDC(storageDomain))) { return false; } if ((!(isMixedTypesAllowedInDC())) && (isMixedTypeDC(storageDomain))) { return false; } return true; }
@java.lang.Override public java.lang.Object Convert(java.lang.Object source, org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery) { return source != null ? ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Role>) (source)) : new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Role>(); }
@java.lang.Override public int compare(org.ovirt.engine.core.common.businessentities.ProviderType type1, org.ovirt.engine.core.common.businessentities.ProviderType type2) { final org.ovirt.engine.ui.uicompat.EnumTranslator enumTranslator = org.ovirt.engine.ui.uicompat.EnumTranslator.getInstance(); return org.ovirt.engine.core.common.businessentities.comparators.LexoNumericComparator.comp(enumTranslator.get(type1), enumTranslator.get(type2)); }
@java.lang.Override protected boolean validate() { org.ovirt.engine.core.bll.validator.HostValidator hostValidator = new org.ovirt.engine.core.bll.validator.HostValidator(getVds()); if ((!(validate(hostValidator.hostExists()))) || (!(validate(hostValidator.isUp())))) { return false; } if ((getVds().getVdsGroupCompatibilityVersion().compareTo(Version.v3_4)) < 0) { return failValidation(EngineMessage.ACTION_TYPE_FAILED_VDS_HA_MAINT_NOT_SUPPORTED); } if (!(getVds().getHighlyAvailableIsConfigured())) { return failValidation(EngineMessage.ACTION_TYPE_FAILED_VDS_HA_NOT_CONFIGURED); } return true; }
private org.ovirt.engine.core.bll.ValidationResult hostStatusLegalForSetupNetworks() { java.util.List<org.ovirt.engine.core.common.businessentities.VDSStatus> supportedStatuses = java.util.Arrays.asList(VDSStatus.Maintenance, VDSStatus.Up, VDSStatus.NonOperational); boolean hostStatusLegalForSetupNetworks = (supportedStatuses.contains(host.getStatus())) || (((host.getStatus()) == (org.ovirt.engine.core.common.businessentities.VDSStatus.Installing)) && (internalExecution)); if (!hostStatusLegalForSetupNetworks) { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_VDS_STATUS_ILLEGAL, host.getName(), host.getStatus().name()); } return org.ovirt.engine.core.bll.ValidationResult.VALID; }
@org.junit.Test public void testGetAllConnectionsOfNfsDomain() { java.util.List<org.ovirt.engine.core.common.businessentities.StorageServerConnections> connections = dao.getAllForDomain(org.ovirt.engine.core.compat.Guid.createGuidFromString("d9ede37f-e6c3-4bf9-a984-19174070aa31")); assertEquals(connections.size(), 1); assertEquals(connections.get(0).getId(), "0cc146e8-e5ed-482c-8814-270bc48c2981"); }
public void setNumaSupport(boolean numaSupport) { this.numaSupport = numaSupport; }
@org.junit.Test public void testValidateAllClustersLevel() { storagePoolWithVersionHigherThanCluster(); java.util.List<org.ovirt.engine.core.common.businessentities.VDSGroup> clusterList = org.ovirt.engine.core.bll.storage.UpdateStoragePoolCommandTest.createClusterList(); org.ovirt.engine.core.common.businessentities.VDSGroup secondCluster = new org.ovirt.engine.core.common.businessentities.VDSGroup(); secondCluster.setCompatibilityVersion(org.ovirt.engine.core.bll.storage.UpdateStoragePoolCommandTest.VERSION_1_2); secondCluster.setName("secondCluster"); clusterList.add(secondCluster); org.ovirt.engine.core.common.businessentities.VDSGroup thirdCluster = new org.ovirt.engine.core.common.businessentities.VDSGroup(); thirdCluster.setCompatibilityVersion(org.ovirt.engine.core.bll.storage.UpdateStoragePoolCommandTest.VERSION_1_1); thirdCluster.setName("thirdCluster"); clusterList.add(thirdCluster); when(vdsGroupDao.getAllForStoragePool(any(org.ovirt.engine.core.compat.Guid.class))).thenReturn(clusterList); assertFalse(cmd.checkAllClustersLevel()); java.util.List<java.lang.String> messages = cmd.getReturnValue().getCanDoActionMessages(); assertTrue(messages.contains(EngineMessage.ERROR_CANNOT_UPDATE_STORAGE_POOL_COMPATIBILITY_VERSION_BIGGER_THAN_CLUSTERS.toString())); assertTrue(messages.get(0).contains("firstCluster")); assertFalse(messages.get(0).contains("secondCluster")); assertTrue(messages.get(0).contains("thirdCluster")); }
private boolean supportsGlusterSnapshotFeature(org.ovirt.engine.core.common.businessentities.VDSGroup cluster) { return (cluster.supportsGlusterService()) && (getGlusterUtil().isGlusterSnapshotSupported(cluster.getCompatibilityVersion(), cluster.getId())); }
protected boolean executeUpdateVmInSpmCommand(org.ovirt.engine.core.compat.Guid storagePoolId, java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.compat.KeyValuePairCompat<java.lang.String, java.util.List<org.ovirt.engine.core.compat.Guid>>> metaDictionary, org.ovirt.engine.core.compat.Guid storageDomainId) { org.ovirt.engine.core.common.vdscommands.UpdateVMVDSCommandParameters tempVar = new org.ovirt.engine.core.common.vdscommands.UpdateVMVDSCommandParameters(storagePoolId, metaDictionary); tempVar.setStorageDomainId(storageDomainId); return org.ovirt.engine.core.bll.Backend.getInstance().getResourceManager().RunVdsCommand(VDSCommandType.UpdateVM, tempVar).getSucceeded(); }
public java.util.Map<java.lang.String, java.lang.Object> glusterVolumeGeoRepSessionList(java.lang.String volumeName, java.lang.String slaveHost, java.lang.String slaveVolumeName);
@org.junit.Test public void shouldMigrateFromHostWithLessHosts() { org.ovirt.engine.core.common.scheduling.AffinityGroup positiveGroup = createAffinityGroup(vdsGroup, true, vm1, vm2, vm4); affinityGroups.add(positiveGroup); assertEquals(vm4, enforcer.chooseNextVmToMigrate(vdsGroup)); }
@java.lang.Override public int hashCode() { return java.util.Objects.hash(id, autoRecoverable, connection, name, storage, storageFormat, storagePoolType, storageType, description, sanState, wipeAfterDelete, discardAfterDelete, firstMetadataDevice, vgMetadataDevice, warningLowSpaceIndicator, criticalSpaceActionBlocker, backup); }
@java.lang.Override public org.ovirt.engine.core.common.action.VdcReturnValueBase Login(java.lang.String userName, java.lang.String password, java.lang.String profileName, org.ovirt.engine.core.common.action.VdcActionType loginType) { org.ovirt.engine.core.common.action.LoginUserParameters params = new org.ovirt.engine.core.common.action.LoginUserParameters(profileName, userName, password); params.setSessionId(getSessionId()); params.setActionType(loginType); org.ovirt.engine.core.common.action.VdcReturnValueBase returnValue = getBackend().login(params); return returnValue; }
private void clearConcurrentGroup() { concurrentPanel.clear(); }
protected java.lang.Object[] getEncodedParameters(java.lang.Object[] parameters, org.ovirt.engine.extensions.aaa.builtin.kerberosldap.LdapIdEncoder idEncoder) { if (parameters == null) { return null; } java.lang.Object[] retVal = parameters.clone(); int index = 0; for (java.lang.Object parameter : parameters) { if (parameter instanceof org.ovirt.engine.core.compat.Guid) { retVal[index] = idEncoder.encodedId(((org.ovirt.engine.core.compat.Guid) (parameter))); } index++; } return retVal; }
@java.lang.Override protected org.ovirt.engine.core.bll.interfaces.BackendInternal getBackend() { return super.getBackend(); }
private void addDnsData(org.ovirt.engine.core.common.businessentities.VmInit vmInit, java.util.Map<java.lang.String, java.lang.Object> network) { if (network == null) { return; } if (vmInit.hasDnsServers()) { network.put("dns_nameservers", java.util.Arrays.asList(vmInit.getDnsServers().split(" "))); } if (vmInit.hasDnsSearch()) { network.put("dns_search", java.util.Arrays.asList(vmInit.getDnsSearch().split(" "))); } }
public void updateDynamicData(org.ovirt.engine.core.common.businessentities.VdsDynamic dynamicData) { vdsDynamicDao.updateIfNeeded(dynamicData); cachedVds.setDynamicData(dynamicData); }
public void setVolumeType(org.ovirt.engine.core.common.businessentities.storage.VolumeType volumeType) { this.volumeType = volumeType; }
@org.junit.Test public void testLibvirtVersion() { org.ovirt.engine.core.common.businessentities.VDS vds = new org.ovirt.engine.core.common.businessentities.VDS(); vds.setId(Guid.Empty); vds.setlibvirt_version(new org.ovirt.engine.core.compat.RpmVersion("libvirt-0.9.10-21.el6_3.4", "libvirt-", true)); org.ovirt.engine.api.model.Host host = org.ovirt.engine.api.restapi.types.HostMapper.map(vds, ((org.ovirt.engine.api.model.Host) (null))); assertNotNull(host.getLibvirtVersion()); assertEquals(new java.lang.Long(host.getLibvirtVersion().getMajor()), new java.lang.Long(0)); assertEquals(new java.lang.Long(host.getLibvirtVersion().getMinor()), new java.lang.Long(9)); assertEquals(new java.lang.Long(host.getLibvirtVersion().getRevision()), new java.lang.Long(0)); assertEquals(new java.lang.Long(host.getLibvirtVersion().getBuild()), new java.lang.Long(10)); assertEquals(host.getLibvirtVersion().getFullVersion(), "libvirt-0.9.10-21.el6_3.4"); }
public static boolean hasCpuToRunVM(org.ovirt.engine.core.common.businessentities.VDS vds, org.ovirt.engine.core.common.businessentities.VM vm) { if (((vds.getUsageCpuPercent()) == null) || ((vm.getUsageCpuPercent()) == null)) { return false; } int predictedVmCpu = ((vm.getUsageCpuPercent()) * (vm.getNumOfCpus())) / (org.ovirt.engine.core.bll.VdsSelector.getEffectiveCpuCores(vds)); boolean result = ((vds.getUsageCpuPercent()) + predictedVmCpu) <= (vds.getHighUtilization()); if (org.ovirt.engine.core.bll.RunVmCommandBase.log.isDebugEnabled()) { org.ovirt.engine.core.bll.RunVmCommandBase.log.debugFormat(("Host {0} has {1}% CPU load; VM {2} is predicted to have {3}% CPU load; " + "High threshold is {4}%. Host is {5}suitable in terms of CPU."), vds.getVdsName(), vds.getUsageCpuPercent(), vm.getName(), predictedVmCpu, vds.getHighUtilization(), (result ? "" : "not ")); } return result; }
public org.ovirt.engine.ui.webadmin.section.main.view.popup.ErrataTableView getErrataTable() { return errataTableView; }
private org.ovirt.engine.core.common.vdscommands.VDSReturnValue runFencingAction(org.ovirt.engine.core.common.businessentities.FenceActionType actionType, org.ovirt.engine.core.common.businessentities.FenceAgentOrder order) { java.lang.String managementIp = getManagementIp(order); java.lang.String managementPort = getManagementPort(order); java.lang.String managementAgent = getManagementAgent(order); java.lang.String managementUser = getManagementUser(order); java.lang.String managementPassword = getManagementPassword(order); java.lang.String managementOptions = getManagementOptions(order); org.ovirt.engine.core.bll.FencingExecutor.log.infoFormat(("Executing <{0}> Power Management command, Proxy Host:{1}, " + "Agent:{2}, Target Host:{3}, Management IP:{4}, User:{5}, Options:{6}"), actionType, proxyHostName, managementAgent, _vds.getvds_name(), managementIp, managementUser, managementOptions); return org.ovirt.engine.core.bll.Backend.getInstance().getResourceManager().RunVdsCommand(VDSCommandType.FenceVds, new org.ovirt.engine.core.common.vdscommands.FenceVdsVDSCommandParameters(proxyHostId, _vds.getId(), managementIp, managementPort, managementAgent, managementUser, managementPassword, managementOptions, actionType)); }
@java.lang.Override protected void executeCommand() { org.ovirt.engine.core.common.action.HostSetupNetworksParameters params = new org.ovirt.engine.core.common.action.HostSetupNetworksParameters(org.ovirt.engine.core.bll.network.host.RemoveNetworkAttachmentCommand.getParameters().getVdsId()); params.getRemovedNetworkAttachments().add(org.ovirt.engine.core.bll.network.host.RemoveNetworkAttachmentCommand.getParameters().getNetworkAttachmentId()); org.ovirt.engine.core.common.action.VdcReturnValueBase returnValue = runInternalAction(VdcActionType.HostSetupNetworks, params); propagateFailure(returnValue); setSucceeded(returnValue.getSucceeded()); }
@java.lang.Override protected void initLoginModel() { super.initLoginModel(); final org.ovirt.engine.ui.uicommonweb.models.userportal.UserPortalLoginModel loginModel = getLoginModel(); loginModel.getIsENGINEUser().getPropertyChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener<org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs>() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs args) { java.lang.Boolean isEngineUser = loginModel.getIsENGINEUser().getEntity(); if (isEngineUser != null) { userRole.setEngineUser(isEngineUser); performLogin(loginModel); } } }); }
public void setBackup(boolean backup) { this.backup = backup; }
private javax.ws.rs.core.Response getFenceStatus(org.ovirt.engine.api.model.Action action) { org.ovirt.engine.core.common.vdscommands.VDSReturnValue result = getEntity(org.ovirt.engine.core.common.vdscommands.VDSReturnValue.class, VdcQueryType.GetVdsFenceStatus, new org.ovirt.engine.core.common.queries.VdsIdParametersBase(guid), guid.toString()); org.ovirt.engine.core.common.businessentities.pm.FenceOperationResult fenceResult = ((org.ovirt.engine.core.common.businessentities.pm.FenceOperationResult) (result.getReturnValue())); if ((fenceResult.getStatus()) == (org.ovirt.engine.core.common.businessentities.pm.FenceOperationResult.Status.SUCCESS)) { org.ovirt.engine.api.model.PowerManagement pm = new org.ovirt.engine.api.model.PowerManagement(); pm.setStatus(org.ovirt.engine.api.common.util.StatusUtils.create(convertPowerStatus(fenceResult.getPowerStatus()))); action.setPowerManagement(pm); return actionSuccess(action); } else { return handleFailure(action, fenceResult.getMessage()); } }
private boolean isPassDiscardSupported() { org.ovirt.engine.core.compat.Guid storageDomainId = ((getDisk().getDiskStorageType()) == (org.ovirt.engine.core.common.businessentities.storage.DiskStorageType.IMAGE)) ? ((org.ovirt.engine.core.common.businessentities.storage.DiskImage) (getDisk())).getStorageIds().get(0) : null; return validate(getDiskVmElementValidator(getDisk(), getDiskVmElement()).isPassDiscardSupported(storageDomainId)); }
@java.lang.Override protected void endWithFailure() { if ((org.ovirt.engine.core.bll.RemoveSnapshotSingleDiskLiveCommand.getParameters().getCommandStep()) == (org.ovirt.engine.core.common.action.RemoveSnapshotSingleDiskLiveStep.DESTROY_IMAGE)) { syncChildCommandList(); org.ovirt.engine.core.compat.Guid currentChildId = getCurrentChildId(); if (!(org.ovirt.engine.core.compat.Guid.isNullOrEmpty(currentChildId))) { org.ovirt.engine.core.bll.CommandBase<?> command = org.ovirt.engine.core.bll.tasks.CommandCoordinatorUtil.retrieveCommand(currentChildId); if (command != null) { command.getParameters().setTaskGroupSuccess(false); org.ovirt.engine.core.bll.Backend.getInstance().endAction(VdcActionType.DestroyImage, command.getParameters(), org.ovirt.engine.core.bll.RemoveSnapshotSingleDiskLiveCommand.cloneContextAndDetachFromParent()); } } } org.ovirt.engine.core.bll.RemoveSnapshotSingleDiskLiveCommand.setSucceeded(true); }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.VDS> getAllForStoragePoolAndStatus(org.ovirt.engine.core.compat.Guid storagePool, org.ovirt.engine.core.common.businessentities.VDSStatus status) { java.util.List<org.ovirt.engine.core.common.businessentities.VDS> vdsList = getCallsHandler().executeReadList("getVdsByStoragePoolIdWithStatus", org.ovirt.engine.core.dao.VdsDaoImpl.VdsRowMapper.instance, getCustomMapSqlParameterSource().addValue("storage_pool_id", storagePool).addValue("status", (status != null ? status.getValue() : null))); return uniteAgents(vdsList); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Allow to move VM image to another Storage Domain") java.lang.String allowToMoveVmImageToAnotherStorageDomainRoleTreeTooltip();
private void initExternalHostProviderWidgets(boolean isAvailable) { externalHostProviderEnabledEditor.setVisible(isAvailable); provisionedHostSection.setVisible(false); discoveredHostSection.setVisible(false); providersEditor.setVisible(false); discoveredHostsPanel.setVisible(false); searchProviderPanel.setVisible(false); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Remove Virtual Machine") java.lang.String removeVirtualMachineTitle();
public void setHighlyAvailableLocalMaintenance(boolean value) { highlyAvailableLocalMaintenance = value; }
@java.lang.Override public int hashCode() { return java.util.Objects.hash(id, compatVersion, compatibilityVersion, cpuName, description, maxVdsMemoryOverCommit, countThreadsAsCores, migrateOnError, name, storagePoolId, storagePoolName, requiredSwitchTypeForCluster, transparentHugepages, virtService, glusterService, glusterCliBasedSchedulingOn, tunnelMigration, emulatedMachine, trustedService, haReservation, clusterPolicyName, clusterPolicyProperties, requiredRngSources, enableKsm, enableBallooning, optimizationType, serialNumberPolicy, customSerialNumber, clusterHostsAndVms, fencingPolicy, autoConverge, migrateCompressed, glusterTunedProfile, addtionalFeaturesSupported, maintenanceReasonRequired, ksmMergeAcrossNumaNodes, customMigrationNetworkBandwidth, migrationBandwidthLimitType, migrationPolicyId, macPoolId); }
@java.lang.Override protected void setActionMessageParameters() { super.setActionMessageParameters(); addValidationMessage(EngineMessage.VAR__ACTION__RESUME); }
@java.lang.Override protected boolean validate() { if (!(super.validate())) { return false; } java.util.List<org.ovirt.engine.core.common.businessentities.storage.DiskImage> templateDiskImages = org.ovirt.engine.core.bll.storage.disk.image.ImagesHandler.filterImageDisks(org.ovirt.engine.core.bll.AddVmFromTemplateCommand.getVmTemplate().getDiskTemplateMap().values(), true, false, false); for (org.ovirt.engine.core.common.businessentities.storage.DiskImage dit : templateDiskImages) { org.ovirt.engine.core.common.businessentities.storage.DiskImage diskImage = diskInfoDestinationMap.get(dit.getId()); if (!(org.ovirt.engine.core.bll.storage.disk.image.ImagesHandler.checkImageConfiguration(destStorages.get(diskImage.getStorageIds().get(0)).getStorageStaticData(), diskImage, org.ovirt.engine.core.bll.AddVmFromTemplateCommand.getReturnValue().getValidationMessages()))) { return false; } } return true; }
@com.google.gwt.i18n.client.Constants.DefaultStringValue("Remove selected") java.lang.String cloudInitObjectRemoveLabel();
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Add System Permission to User") java.lang.String addSystemPermissionToUserTitle();
@org.junit.Test public void testGetNotFound() throws java.lang.Exception { setUriInfo(setUpBasicUriExpectations()); setUpEntityQueryExpectations(VdcQueryType.GetAllNetworks, org.ovirt.engine.core.common.queries.GetAllNetworkQueryParamenters.class, new java.lang.String[]{ "StoragePoolId" }, new java.lang.Object[]{ org.ovirt.engine.core.compat.Guid.Empty }, new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Network>()); control.replay(); try { resource.get(); fail("expected WebApplicationException"); } catch (javax.ws.rs.WebApplicationException wae) { verifyNotFoundException(wae); } }
public java.lang.String getSourceNetworkName() { return sourceNetworkName; }
public java.lang.String cannotConnectReason();
public static java.lang.String resource(org.ovirt.engine.sdk.generator.utils.Tree<org.ovirt.engine.sdk.generator.rsdl.Location> entityTree) { org.ovirt.engine.sdk.generator.utils.Tree<org.ovirt.engine.sdk.generator.rsdl.Location> grandparentTree = entityTree.getParent().getParent(); java.lang.String entityType = org.ovirt.engine.sdk.generator.rsdl.SchemaRules.getSchemaType(entityTree); java.lang.String grandparentType = org.ovirt.engine.sdk.generator.rsdl.SchemaRules.getSchemaType(grandparentTree); java.lang.String brokerType = org.ovirt.engine.sdk.generator.rsdl.BrokerRules.getBrokerType(entityTree); java.lang.String superClassParameterName = entityType.toLowerCase().replace("_", ""); java.lang.String parentClassParameterName = grandparentType.toLowerCase().replace("_", ""); org.ovirt.engine.sdk.generator.rsdl.templates.SubResourceTemplate template = new org.ovirt.engine.sdk.generator.rsdl.templates.SubResourceTemplate(); template.set("entity_type", entityType); template.set("broker_type", brokerType); template.set("superclass_parameter_name", superClassParameterName); template.set("parentclass_parameter_name", parentClassParameterName); return template.evaluate(); }
private static java.lang.Long AssignLongValue(java.util.Map<java.lang.String, java.lang.Object> input, java.lang.String name) { if (input.containsKey(name)) { if (((input.get(name)) instanceof java.lang.Long) || ((input.get(name)) instanceof java.lang.Integer)) { return java.lang.Long.parseLong(input.get(name).toString()); } java.lang.String stringValue = ((java.lang.String) (((input.get(name)) instanceof java.lang.String) ? input.get(name) : null)); if (!(org.apache.commons.lang.StringUtils.isEmpty(stringValue))) { stringValue = stringValue.split("[.]", (-1))[0]; } try { return java.lang.Long.parseLong(stringValue); } catch (java.lang.NumberFormatException e) { org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.log.errorFormat("Failed to parse {0} value {1} to long", name, stringValue); } } return null; }
@org.junit.Test public void testValidateFailReadOnlyOnInterface() { org.ovirt.engine.core.common.action.AddDiskParameters parameters = org.ovirt.engine.core.bll.storage.disk.AddDiskCommandTest.createParameters(); initializeCommand(org.ovirt.engine.core.compat.Guid.newGuid(), parameters); mockVm(); doReturn(true).when(command).isDiskPassPciAndIdeLimit(any(org.ovirt.engine.core.common.businessentities.storage.Disk.class)); doReturn(new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_INTERFACE_DOES_NOT_SUPPORT_READ_ONLY_ATTR)).when(diskValidator).isReadOnlyPropertyCompatibleWithInterface(); doReturn(diskValidator).when(command).getDiskValidator(any(org.ovirt.engine.core.common.businessentities.storage.Disk.class)); org.ovirt.engine.core.bll.ValidateTestUtils.runAndAssertValidateFailure(command, EngineMessage.ACTION_TYPE_FAILED_INTERFACE_DOES_NOT_SUPPORT_READ_ONLY_ATTR); }
@java.lang.Override protected boolean validate() { boolean retValue = true; if (org.apache.commons.lang.StringUtils.isBlank(org.ovirt.engine.core.bll.AddJobCommand.getParameters().getDescription())) { addValidationMessage(EngineMessage.ACTION_TYPE_EMPTY_DESCRIPTION); retValue = false; } return retValue; }
@java.lang.Override protected boolean canDoAction() { initVmTemplate(); if ((org.ovirt.engine.core.bll.ImportVmTemplateFromConfigurationCommand.isImagesAlreadyOnTarget()) && (!(validateUnregisteredEntity(vmTemplateFromConfiguration, ovfEntityData)))) { return false; } java.util.ArrayList<org.ovirt.engine.core.common.businessentities.DiskImage> disks = new java.util.ArrayList(org.ovirt.engine.core.bll.ImportVmTemplateFromConfigurationCommand.getVmTemplate().getDiskTemplateMap().values()); setImagesWithStoragePoolId(org.ovirt.engine.core.bll.ImportVmTemplateFromConfigurationCommand.getStorageDomain().getStoragePoolId(), disks); org.ovirt.engine.core.bll.ImportVmTemplateFromConfigurationCommand.getParameters().setImages(disks); org.ovirt.engine.core.bll.ImportVmTemplateFromConfigurationCommand.getVmTemplate().setImages(disks); return super.canDoAction(); }
@java.lang.Override public void onResult(java.sql.ResultSet rs) throws java.sql.SQLException { result.put(org.ovirt.engine.core.common.AuditLogSeverity.forValue(rs.getInt(org.ovirt.engine.ui.frontend.server.dashboard.dao.EventDao.SEVERITY)), rs.getInt(org.ovirt.engine.ui.frontend.server.dashboard.dao.EventDao.COUNT)); }
@java.lang.Override public org.ovirt.engine.core.bll.tasks.interfaces.CommandCallback getCallback() { return org.ovirt.engine.core.bll.RemoveVmCommand.getParameters().isUseCinderCommandCallback() ? new org.ovirt.engine.core.bll.ConcurrentChildCommandsExecutionCallback() : null; }
@org.ovirt.engine.ui.frontend.DefaultStringValue("Cannot update the name of Sub-Templates, Only the Version name can be updated.") java.lang.String VMT_CANNOT_UPDATE_VERSION_NAME();
@org.junit.Test public void testImportVMFromConfigurationWhenStorageDomainIsInactive() { initCommand(getOvfEntityData()); org.ovirt.engine.core.common.businessentities.StorageDomain storageDomain = createStorageDomain(); storageDomain.setStatus(StorageDomainStatus.Inactive); doReturn(storageDomain).when(cmd).getStorageDomain(); org.ovirt.engine.core.bll.CanDoActionTestUtils.runAndAssertCanDoActionFailure(cmd, VdcBllMessages.ACTION_TYPE_FAILED_STORAGE_DOMAIN_STATUS_ILLEGAL2); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Configure Host") java.lang.String configureHostRoleTree();
@java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { java.util.List<org.ovirt.engine.core.common.businessentities.VM> vms = ((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (returnValue)).getReturnValue(); java.util.Set<java.lang.String> existingNames = new java.util.HashSet<>(); for (org.ovirt.engine.core.common.businessentities.VM vm : vms) { existingNames.add(vm.getName()); } java.util.List<org.ovirt.engine.ui.uicommonweb.models.vms.ImportVmData> vmDataList = new java.util.ArrayList<>(); for (org.ovirt.engine.core.common.businessentities.VM vm : externalVms) { org.ovirt.engine.ui.uicommonweb.models.vms.ImportVmData vmData = new org.ovirt.engine.ui.uicommonweb.models.vms.ImportVmData(vm); if (vms.contains(vm)) { vmData.setExistsInSystem(true); vmData.getClone().setEntity(true); vmData.getClone().setChangeProhibitionReason(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().importVMThatExistsInSystemMustClone()); vmData.getClone().setIsChangable(false); } if ((!(vmData.getClone().getEntity())) && (existingNames.contains(vm.getName()))) { vmData.setError(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().nameMustBeUniqueInvalidReason()); } vmDataList.add(vmData); } org.ovirt.engine.ui.uicommonweb.models.vms.ImportVmFromExportDomainModel.super.setItems(vmDataList); doInit(storageDomainId); }
@java.lang.Override protected java.util.Map<java.lang.String, org.ovirt.engine.core.common.utils.Pair<java.lang.String, java.lang.String>> getExclusiveLocks() { if (!(org.apache.commons.lang.StringUtils.isBlank(getParameters().getVm().getName()))) { return java.util.Collections.singletonMap(getParameters().getVm().getName(), LockMessagesMatchUtil.VM_NAME); } return null; }
private void updateBricks(org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity existingVolume, org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity fetchedVolume) { java.util.List<org.ovirt.engine.core.common.businessentities.gluster.GlusterBrickEntity> fetchedBricks = fetchedVolume.getBricks(); if (fetchedBricks == null) { org.ovirt.engine.core.bll.gluster.GlusterManager.log.warnFormat(("Bricks of volume {0} were not fetched. " + "Hence will not try to update them in engine at this point."), fetchedVolume.getName()); return; } removeDeletedBricks(existingVolume, fetchedBricks); updateExistingAndNewBricks(existingVolume, fetchedBricks); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Allow import/export operations") java.lang.String allowImportExportOperationsRoleTreeTooltip();
@java.lang.Override protected void setActionMessageParameters() { addValidationMessage(EngineMessage.VAR__ACTION__RESET); addValidationMessage(EngineMessage.VAR__TYPE__GLUSTER_VOLUME_OPTION); }
@java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.EventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { if (getPassthrough().getEntity()) { getPortMirroring().setChangeProhibitionReason(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().portMirroringNotChangedIfPassthrough()); getPortMirroring().setIsChangeable(false); getPortMirroring().setEntity(false); getNetworkQoS().setChangeProhibitionReason(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().networkQosNotChangedIfPassthrough()); getNetworkQoS().setIsChangeable(false); getNetworkQoS().setSelectedItem(NetworkQoSModel.EMPTY_QOS); } else { getPortMirroring().setIsChangeable(true); getNetworkQoS().setIsChangeable(true); } }
protected void cancel() { }
@java.lang.Override protected void executeVdsBrokerCommand() { try { org.ovirt.engine.core.vdsbroker.vdsbroker.GetHardwareInfoAsyncVDSCommand.getBroker().getHardwareInfo(new GetHardwareInfoVDSCommandCallback()); } catch (java.lang.Throwable t) { org.ovirt.engine.core.vdsbroker.vdsbroker.GetHardwareInfoAsyncVDSCommand.getParameters().getCallback().onFailure(t); throw t; } }
@java.lang.Override protected void handleOkResponse() { byte[] data; try { data = org.ovirt.engine.core.vdsbroker.irsbroker.RetrieveImageDataVDSCommand.getMethod().getResponseBody(); } catch (java.lang.Exception e) { throw org.ovirt.engine.core.vdsbroker.irsbroker.RetrieveImageDataVDSCommand.createNetworkException(e); } org.ovirt.engine.core.vdsbroker.irsbroker.RetrieveImageDataVDSCommand.getVDSReturnValue().setReturnValue(data); }
@java.lang.Override public void render(org.ovirt.engine.ui.webadmin.widget.table.cell.Context context, org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity volume, com.google.gwt.safehtml.shared.SafeHtmlBuilder sb, java.lang.String id) { if (volume == null) { return; } int upBricks = 0; int downBricks = 0; for (org.ovirt.engine.core.common.businessentities.gluster.GlusterBrickEntity brick : volume.getBricks()) { if (brick.isOnline()) { upBricks++; } else { downBricks++; } } com.google.gwt.resources.client.ImageResource upImage = org.ovirt.engine.ui.webadmin.widget.table.cell.VolumeBrickStatusCell.resources.upImage(); com.google.gwt.resources.client.ImageResource downImage = org.ovirt.engine.ui.webadmin.widget.table.cell.VolumeBrickStatusCell.resources.downImage(); com.google.gwt.safehtml.shared.SafeHtml upImageHtml = com.google.gwt.safehtml.shared.SafeHtmlUtils.fromTrustedString(com.google.gwt.user.client.ui.AbstractImagePrototype.create(upImage).getHTML()); com.google.gwt.safehtml.shared.SafeHtml downImageHtml = com.google.gwt.safehtml.shared.SafeHtmlUtils.fromTrustedString(com.google.gwt.user.client.ui.AbstractImagePrototype.create(downImage).getHTML()); sb.append(org.ovirt.engine.ui.webadmin.widget.table.cell.VolumeBrickStatusCell.templates.volumeBrickStatusTemplate(upImageHtml, upBricks, downImageHtml, downBricks, id)); }
@java.lang.Override protected boolean vetoRemoveWidget(final org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.ui.uicommonweb.models.vms.InstanceImageLineModel, org.ovirt.engine.ui.common.widget.uicommon.instanceimages.InstanceImageLineEditor> item, final org.ovirt.engine.ui.uicommonweb.models.vms.InstanceImageLineModel value, final org.ovirt.engine.ui.common.widget.uicommon.instanceimages.InstanceImageLineEditor widget) { model.approveRemoveDisk(item.getFirst(), new org.ovirt.engine.ui.uicommonweb.models.vms.InstanceImagesModel.RemoveApprovedCallback() { @java.lang.Override public void removeApproved(boolean approved) { if (approved) { doRemoveItem(item, value, widget); } } }); return true; }
@java.lang.Override protected org.springframework.jdbc.core.RowMapper<org.ovirt.engine.core.common.businessentities.VmStatistics> createEntityRowMapper() { return org.ovirt.engine.core.dao.VmStatisticsDaoDbFacadeImpl.VmStatisticsRowMapper.instance; }
@java.lang.Override public org.ovirt.engine.core.common.businessentities.VmPool mapRow(final java.sql.ResultSet rs, final int rowNum) throws java.sql.SQLException { final org.ovirt.engine.core.common.businessentities.VmPool entity = new org.ovirt.engine.core.common.businessentities.VmPool(); entity.setVmPoolDescription(rs.getString("vm_pool_description")); entity.setVmPoolId(getGuidDefaultEmpty(rs, "vm_pool_id")); entity.setComment(rs.getString("vm_pool_comment")); entity.setName(rs.getString("vm_pool_name")); entity.setVmPoolType(org.ovirt.engine.core.common.businessentities.VmPoolType.forValue(rs.getInt("vm_pool_type"))); entity.setStateful(rs.getBoolean("stateful")); entity.setParameters(rs.getString("parameters")); entity.setPrestartedVms(rs.getInt("prestarted_vms")); entity.setClusterId(getGuidDefaultEmpty(rs, "cluster_id")); entity.setClusterName(rs.getString("cluster_name")); entity.setAssignedVmsCount(rs.getInt("assigned_vm_count")); entity.setRunningVmsCount(rs.getInt("vm_running_count")); entity.setMaxAssignedVmsPerUser(rs.getInt("max_assigned_vms_per_user")); entity.setSpiceProxy(rs.getString("spice_proxy")); entity.setBeingDestroyed(rs.getBoolean("is_being_destroyed")); entity.setAutoStorageSelect(rs.getBoolean("is_auto_storage_select")); return entity; }
@java.lang.Override public void onSuccess(final org.ovirt.engine.ui.frontend.communication.VdcOperation<org.ovirt.engine.core.common.queries.VdcQueryType, org.ovirt.engine.core.common.queries.VdcQueryParametersBase> operation, final org.ovirt.engine.core.common.queries.VdcQueryReturnValue result) { try { if (!(result.getSucceeded())) { org.ovirt.engine.ui.frontend.Frontend.logger.log(java.util.logging.Level.WARNING, (("Failure while invoking runQuery [" + (result.getExceptionString())) + "]")); if ((getEventsHandler()) != null) { java.util.ArrayList<org.ovirt.engine.core.common.queries.VdcQueryReturnValue> failedResult = new java.util.ArrayList<org.ovirt.engine.core.common.queries.VdcQueryReturnValue>(); failedResult.add(result); java.lang.String errorMessage = result.getExceptionString(); handleNotLoggedInEvent(errorMessage); } if (callback.isHandleFailure()) { callback.getDel().onSuccess(callback.getModel(), result); } } else { callback.setOriginalReturnValue(result); if ((callback.getConverter()) != null) { callback.getDel().onSuccess(callback.getModel(), callback.getConverter().Convert(result.getReturnValue(), callback)); } else { callback.getDel().onSuccess(callback.getModel(), result); } } } finally { fireAsyncOperationCompleteEvent(callback.getModel()); } }
@org.junit.Test public void testSave() { java.util.List<org.ovirt.engine.core.common.businessentities.network_cluster> clustersFromDB = dbFacade.getNetworkClusterDAO().getAllForCluster(cluster); org.ovirt.engine.core.common.businessentities.network_cluster clusterFromDB = clustersFromDB.get(0); assertNotNull(clusterFromDB); new_net.setCluster(clusterFromDB); new_net.setId(org.ovirt.engine.core.compat.Guid.NewGuid()); dao.save(new_net); org.ovirt.engine.core.common.businessentities.Network result = dao.getByName(new_net.getname()); assertNotNull(result); assertEquals(new_net, result); }
private boolean containsDeviceWithType(java.util.List<org.ovirt.engine.core.common.businessentities.VmDevice> devices, org.ovirt.engine.core.common.businessentities.VmDeviceGeneralType generalType, org.ovirt.engine.core.common.utils.VmDeviceType deviceType) { for (org.ovirt.engine.core.common.businessentities.VmDevice device : devices) { if ((device.getType()) == generalType) { if ((deviceType == null) || (deviceType.equals(device.getDevice()))) { return true; } } } return false; }
@org.junit.Test public void canAddVmWithVirtioScsiControllerNotSupportedOs() { org.ovirt.engine.core.common.businessentities.VM vm = org.ovirt.engine.core.bll.AddVmCommandTest.createVm(); org.ovirt.engine.core.bll.AddVmFromTemplateCommand<org.ovirt.engine.core.common.action.AddVmParameters> cmd = createVmFromTemplateCommand(vm); org.ovirt.engine.core.common.businessentities.VDSGroup vdsGroup = createVdsGroup(); mockStorageDomainDaoGetForStoragePool(); mockVmTemplateDaoReturnVmTemplate(); mockDiskImageDaoGetSnapshotById(); org.ovirt.engine.core.bll.AddVmCommandTest.mockVerifyAddVM(cmd); mockConfig(); mockMaxPciSlots(); mockStorageDomainDaoGetAllStoragesForPool(20); mockUninterestingMethods(cmd); mockDisplayTypes(vm.getOs(), vdsGroup.getCompatibilityVersion()); mockGraphicsDevices(vm.getId()); doReturn(true).when(cmd).checkCpuSockets(); doReturn(vdsGroup).when(cmd).getVdsGroup(); doReturn(createStoragePool()).when(cmd).getStoragePool(); cmd.getParameters().setVirtioScsiEnabled(true); when(osRepository.getArchitectureFromOS(any(java.lang.Integer.class))).thenReturn(ArchitectureType.x86_64); when(osRepository.getDiskInterfaces(any(java.lang.Integer.class), any(org.ovirt.engine.core.compat.Version.class))).thenReturn(new java.util.ArrayList(java.util.Arrays.asList("VirtIO"))); mockGetAllSnapshots(cmd); org.ovirt.engine.core.bll.CanDoActionTestUtils.runAndAssertCanDoActionFailure(cmd, EngineMessage.ACTION_TYPE_FAILED_ILLEGAL_OS_TYPE_DOES_NOT_SUPPORT_VIRTIO_SCSI); }
@java.lang.Override protected org.ovirt.engine.core.common.utils.ToStringBuilder appendAttributes(org.ovirt.engine.core.common.utils.ToStringBuilder tsb) { return super.appendAttributes(tsb).append("memoryDevice", getMemoryDevice()); }
@org.ovirt.engine.ui.frontend.DefaultStringValue("Cannot ${action} ${type}. Storage connection parameters are used by the following storage domains : ${domainNames}.") java.lang.String ACTION_TYPE_FAILED_STORAGE_CONNECTION_BELONGS_TO_SEVERAL_STORAGE_DOMAINS();
public void setNetworkUsageHistory(java.util.List<java.lang.Integer> networkUsageHistory) { this.vmStatistics.setNetworkUsageHistory(networkUsageHistory); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("MAC Pools") java.lang.String macPoolTree();
protected boolean validateDiskInterface(java.lang.Iterable<org.ovirt.engine.core.common.businessentities.storage.DiskImage> images) { for (org.ovirt.engine.core.common.businessentities.storage.DiskImage diskImage : images) { if (((diskImage.getDiskInterface()) == (org.ovirt.engine.core.common.businessentities.storage.DiskInterface.VirtIO_SCSI)) && (!(org.ovirt.engine.core.common.FeatureSupported.virtIoScsi(org.ovirt.engine.core.bll.ImportVmCommand.getEffectiveCompatibilityVersion())))) { return failValidation(EngineMessage.VIRTIO_SCSI_INTERFACE_IS_NOT_AVAILABLE_FOR_CLUSTER_LEVEL); } } return true; }
@java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.diskHotpluggableInterfacesMap = ((java.util.Map<org.ovirt.engine.core.common.utils.Pair<java.lang.Integer, org.ovirt.engine.core.compat.Version>, java.util.Set<java.lang.String>>) (((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (returnValue)).getReturnValue())); }
private void prepareMessageSubject(java.lang.String hostName, org.ovirt.engine.core.common.businessentities.AuditLogEvent event) { subject = org.ovirt.engine.core.notifier.transport.smtp.MessageHelper.prepareMessageSubject(event.getType(), hostName, event.getMessage()); }
@java.lang.Override protected void executeCommand() { if (!(org.ovirt.engine.core.compat.Guid.isNullOrEmpty(org.ovirt.engine.core.bll.storage.AddStorageServerConnectionCommand.getParameters().getVdsId()))) { org.ovirt.engine.core.common.utils.Pair<java.lang.Boolean, java.lang.Integer> result = org.ovirt.engine.core.bll.storage.AddStorageServerConnectionCommand.connectHostToStorage(); boolean isValidConnection = result.getFirst(); if (!isValidConnection) { throw new org.ovirt.engine.core.common.errors.VdcBLLException(org.ovirt.engine.core.common.errors.VdcBllErrors.forValue(result.getSecond())); } } org.ovirt.engine.core.common.businessentities.StorageServerConnections connection = org.ovirt.engine.core.bll.storage.AddStorageServerConnectionCommand.getConnection(); connection.setid(org.ovirt.engine.core.compat.Guid.newGuid().toString()); saveConnection(connection); org.ovirt.engine.core.bll.storage.AddStorageServerConnectionCommand.getReturnValue().setActionReturnValue(connection.getid()); org.ovirt.engine.core.bll.storage.AddStorageServerConnectionCommand.setSucceeded(true); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Incorrect bricks selected for removal in Distributed Stripe volume.\nSelected bricks should be from the same sub volume!") java.lang.String cannotRemoveBricksDistributedStripeVolume();
@org.ovirt.engine.ui.webadmin.DefaultStringValue("Virtual Machines") java.lang.String vmsCount();
protected void onAdGroupsLoaded(org.ovirt.engine.ui.uicommonweb.models.users.AdElementListModel adElementListModel) { onAdItemsLoaded(adElementListModel, getgroups()); }
@org.junit.Test public void testNicExistsWhenNicNameIsNotNull() throws java.lang.Exception { org.ovirt.engine.core.common.businessentities.network.NetworkAttachment attachment = new org.ovirt.engine.core.common.businessentities.network.NetworkAttachment(); attachment.setNicId(null); attachment.setNicName("whatever"); assertThat(createNetworkAttachmentValidator(attachment).nicExists(), org.ovirt.engine.core.bll.validator.ValidationResultMatchers.isValid()); }
private org.ovirt.engine.core.common.businessentities.DiskImage getActiveDiskImage() { org.ovirt.engine.core.compat.Guid snapshotId = org.ovirt.engine.core.bll.RemoveSnapshotSingleDiskLiveCommand.getSnapshotDao().getId(org.ovirt.engine.core.bll.RemoveSnapshotSingleDiskLiveCommand.getVmId(), Snapshot.SnapshotType.ACTIVE); return org.ovirt.engine.core.bll.RemoveSnapshotSingleDiskLiveCommand.getDiskImageDao().getDiskSnapshotForVmSnapshot(org.ovirt.engine.core.bll.RemoveSnapshotSingleDiskLiveCommand.getDiskImage().getId(), snapshotId); }
@java.lang.Override public void dataCenterWithClusterSelectedItemChanged() { super.dataCenterWithClusterSelectedItemChanged(); if ((getModel().getSelectedCluster()) != null) { updateCpuProfile(getModel().getSelectedCluster().getId(), getCompatibilityVersion(), vm.getCpuProfileId()); } }
private <T extends org.ovirt.engine.core.common.businessentities.BusinessEntity<org.ovirt.engine.core.compat.Guid> & org.ovirt.engine.core.common.businessentities.Nameable> boolean isNameAndIdIncoherent(org.ovirt.engine.core.compat.Guid id, java.lang.String name, org.ovirt.engine.core.common.businessentities.BusinessEntityMap<T> map) { T entityById = map.get(id); T entityByName = map.get(name); return !(java.util.Objects.equals(entityById, entityByName)); }
private void updateProperties() { org.ovirt.engine.core.common.businessentities.VDSGroup vdsGroup = getEntity(); setName(vdsGroup.getname()); setDescription(vdsGroup.getdescription()); setCpuName(vdsGroup.getcpu_name()); setDataCenterName(vdsGroup.getStoragePoolName()); setMemoryOverCommit(vdsGroup.getmax_vds_memory_over_commit()); setCpuThreads(vdsGroup.getCountThreadsAsCores()); setResiliencePolicy(vdsGroup.getMigrateOnError()); setCompatibilityVersion(vdsGroup.getcompatibility_version().getValue()); generateClusterType(vdsGroup.supportsGlusterService(), vdsGroup.supportsVirtService()); }
@java.lang.Override public org.ovirt.engine.core.vdsbroker.irsbroker.FileStatsReturnForXmlRpc getFloppyList(java.lang.String spUUID) { java.util.Map<java.lang.String, java.lang.Object> xmlRpcReturnValue = irsServer.getFloppyList(spUUID); org.ovirt.engine.core.vdsbroker.irsbroker.FileStatsReturnForXmlRpc wrapper = new org.ovirt.engine.core.vdsbroker.irsbroker.FileStatsReturnForXmlRpc(xmlRpcReturnValue); return wrapper; }
@org.junit.Test public void testGetByNameFilteredWithPermissions() { org.ovirt.engine.core.common.businessentities.VM result = dao.getByNameForDataCenter(null, existingVm.getName(), org.ovirt.engine.core.dao.PRIVILEGED_USER_ID, true); assertGetResult(result); }
private void host_SelectedItemChanged() { org.ovirt.engine.core.common.businessentities.VDS host = getHost().getSelectedItem(); if ((getCurrentStorageItem()) != null) { if ((getCurrentStorageItem()) instanceof org.ovirt.engine.ui.uicommonweb.models.storage.SanStorageModelBase) { org.ovirt.engine.ui.uicommonweb.models.storage.SanStorageModelBase sanStorageModel = ((org.ovirt.engine.ui.uicommonweb.models.storage.SanStorageModelBase) (getCurrentStorageItem())); if ((getStorage()) == null) { sanStorageModel.setItems(null); } } if (host != null) { getCurrentStorageItem().getUpdateCommand().execute(); java.lang.String prefix = (host.isOvirtNode()) ? localFSPath : ""; if (!(org.ovirt.engine.core.compat.StringHelper.isNullOrEmpty(prefix))) { for (java.lang.Object item : getItems()) { if (item instanceof org.ovirt.engine.ui.uicommonweb.models.storage.LocalStorageModel) { org.ovirt.engine.ui.uicommonweb.models.storage.LocalStorageModel model = ((org.ovirt.engine.ui.uicommonweb.models.storage.LocalStorageModel) (item)); model.getPath().setEntity(prefix); model.getPath().setIsChangeable(false); } } } } } }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("New") java.lang.String newVolume();
@java.lang.Override public org.jboss.resteasy.core.ServerResponse preProcess(org.jboss.resteasy.spi.HttpRequest request, org.jboss.resteasy.core.ResourceMethod method) throws javax.ws.rs.WebApplicationException, org.jboss.resteasy.spi.Failure { org.jboss.resteasy.core.ServerResponse response = null; boolean successful = false; javax.ws.rs.core.HttpHeaders headers = request.getHttpHeaders(); boolean preferPersistentAuth = checkPersistentAuthentication(headers); boolean hasAuthorizationHeader = checkAuthorizationHeader(headers); javax.servlet.http.HttpSession httpSession = getCurrentSession(true); if (((((validator) != null) && (httpSession != null)) && (!(httpSession.isNew()))) && (!hasAuthorizationHeader)) { successful = executeSessionValidation(httpSession, preferPersistentAuth); } else { if ((((validator) != null) && (httpSession != null)) && (!(httpSession.isNew()))) { httpSession.invalidate(); httpSession = getCurrentSession(true); } successful = executeBasicAuthentication(headers, httpSession, preferPersistentAuth); } if (!successful) { response = challenge(); if (httpSession != null) { httpSession.invalidate(); } } return response; }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Power Management Configuration") java.lang.String powerManagementConfigurationTitle();
@org.junit.Test public void testNotRemovingManagementNetwork() throws java.lang.Exception { org.ovirt.engine.core.bll.validator.NetworkAttachmentValidator networkAttachmentValidatorSpy = org.mockito.Mockito.spy(createNetworkAttachmentValidator(new org.ovirt.engine.core.common.businessentities.network.NetworkAttachment())); doReturn(networkValidatorMock).when(networkAttachmentValidatorSpy).getNetworkValidator(); org.ovirt.engine.core.bll.ValidationResult propagatedResult = new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.VdcBllMessages.NETWORK_CANNOT_REMOVE_MANAGEMENT_NETWORK, "a"); when(networkValidatorMock.notRemovingManagementNetwork()).thenReturn(propagatedResult); assertThat("ValidationResult is not correctly propagated", networkAttachmentValidatorSpy.notRemovingManagementNetwork(), org.ovirt.engine.core.bll.validator.ValidationResultMatchers.failsWith(VdcBllMessages.NETWORK_CANNOT_REMOVE_MANAGEMENT_NETWORK, "a")); }
public org.ovirt.engine.ui.uicommonweb.models.EntityModel<java.lang.Boolean> getEnforcing() { return enforcing; }
@java.lang.Override public java.lang.String getValue(org.ovirt.engine.core.common.businessentities.network.NetworkQoS object) { return (object.getOutboundPeak()) == null ? constants.UnlimitedNetworkQoS() : object.getOutboundPeak().toString(); }
private boolean executeWithoutTransaction() { boolean functionReturnValue = false; boolean exceptionOccurred = true; try { logRunningCommand(); if (hasTaskHandlers()) { getCurrentTaskHandler().execute(); } else { executeCommand(); } functionReturnValue = getSucceeded(); exceptionOccurred = false; } catch (org.ovirt.engine.core.dal.dbbroker.generic.RepositoryException e) { log.error(java.lang.String.format("Command %1$s throw Database exception", getClass().getName()), e); processExceptionToClient(new org.ovirt.engine.core.common.errors.VdcFault(e, org.ovirt.engine.core.common.errors.VdcBllErrors.DB)); } catch (org.ovirt.engine.core.common.errors.VdcBLLException e) { log.error(java.lang.String.format("Command %1$s throw Vdc Bll exception. With error message %2$s", getClass().getName(), e.getMessage())); if (log.isDebugEnabled()) { log.debug(java.lang.String.format("Command %1$s throw Vdc Bll exception", getClass().getName()), e); } processExceptionToClient(new org.ovirt.engine.core.common.errors.VdcFault(e, e.getVdsError().getCode())); } catch (java.lang.RuntimeException e) { processExceptionToClient(new org.ovirt.engine.core.common.errors.VdcFault(e, org.ovirt.engine.core.common.errors.VdcBllErrors.ENGINE)); log.error(java.lang.String.format("Command %1$s throw exception", getClass().getName()), e); } finally { if (exceptionOccurred || (!(getSucceeded()))) { compensate(); } else { cleanUpCompensationData(); } } return functionReturnValue; }
@java.lang.Override protected boolean isRoleSet(org.ovirt.engine.core.common.businessentities.network.NetworkCluster originalNetworkCluster) { return originalNetworkCluster.isGluster(); }
@java.lang.Override public org.ovirt.engine.ui.uicommonweb.validation.ValidationResult validate(java.lang.Object value) { assert (value == null) || (value instanceof java.lang.String); java.lang.String cidr = ((java.lang.String) (value)); org.ovirt.engine.ui.uicommonweb.validation.ValidationResult result = new org.ovirt.engine.ui.uicommonweb.validation.ValidationResult(); if (!(org.ovirt.engine.core.common.validation.CidrValidator.getInstance().isCidrFormatValid(cidr))) { failWith(result, getThisFieldMustContainCidrInFormatMsg()); } else if (!(org.ovirt.engine.core.common.validation.CidrValidator.getInstance().isCidrNetworkAddressValid(cidr))) { failWith(result, getCidrNotNetworkAddress()); } return result; }
@java.lang.Override public org.ovirt.engine.core.common.AuditLogType getAuditLogTypeValue() { if (!(org.ovirt.engine.core.bll.ApproveVdsCommand.getSucceeded())) { if ((_failureLogTypeValue) == (org.ovirt.engine.core.common.AuditLogType.VDS_INSTALL_FAILED)) { AddCustomValue("FailedInstallMessage", getErrorMessage(_failureMessage)); } return _failureLogTypeValue; } else { return org.ovirt.engine.core.common.AuditLogType.VDS_APPROVE; } }
@java.lang.Override public void setImageTemplateId(org.ovirt.engine.core.compat.Guid guid) { getImage().setTemplateImageId(guid); }
public final java.util.List<java.lang.String> ResolveMessages(java.util.List<java.lang.String> translatedMessages) { java.util.ArrayList<java.lang.String> translatedErrors = new java.util.ArrayList<java.lang.String>(); java.util.HashMap<java.lang.String, java.lang.String> variables = new java.util.HashMap<java.lang.String, java.lang.String>(); for (java.lang.String currentMessage : translatedMessages) { if (IsDynamicVariable(currentMessage)) { AddVariable(currentMessage, variables); } else { translatedErrors.add(currentMessage); } } java.util.ArrayList<java.lang.String> returnValue = new java.util.ArrayList<java.lang.String>(); for (java.lang.String error : translatedErrors) { returnValue.add(resolveMessage(error, variables)); } return returnValue; }
private org.ovirt.engine.core.common.businessentities.network.Network getNetworkByName(java.util.List<org.ovirt.engine.core.common.businessentities.network.Network> networks) { return org.ovirt.engine.core.utils.linq.LinqUtils.firstOrNull(networks, new org.ovirt.engine.core.utils.linq.Predicate<org.ovirt.engine.core.common.businessentities.network.Network>() { @java.lang.Override public boolean eval(org.ovirt.engine.core.common.businessentities.network.Network network) { return network.getName().equals(getNetworkName()); } }); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Configure Network") java.lang.String configureNetworkRoleTree();
private void addStyles() { overrideIpTablesEditor.addContentWidgetStyleName(style.overrideIpStyle()); externalHostProviderEnabledEditor.addContentWidgetStyleName(style.checkBox()); providerSearchFilterEditor.addContentWidgetStyleName(style.searchFilter()); providerSearchFilterEditor.setStyleName(style.searchFilterLabel()); providerSearchFilterEditor.setLabelStyleName(style.emptyEditor()); providerSearchFilterLabel.addContentWidgetStyleName(style.emptyEditor()); providerSearchFilterLabel.setStyleName(style.searchFilterLabel()); fetchSshFingerprint.addContentWidgetStyleName(style.fingerprintEditor()); publicKeyEditor.addContentWidgetStyleName(style.pkEditor()); expanderContent.setStyleName(style.expanderContent()); }
protected void setUpGetEntityExpectations(int index) throws java.lang.Exception { org.ovirt.engine.core.common.businessentities.LdapGroup user = org.ovirt.engine.api.restapi.resource.BackendGroupsResourceTest.setUpEntityExpectations(control.createMock(org.ovirt.engine.core.common.businessentities.LdapGroup.class), index); setUpGetEntityExpectations((("ADGROUP@" + (DOMAIN)) + ": name=*"), SearchType.AdGroup, user); }
@java.lang.Override public void save(org.ovirt.engine.core.common.businessentities.vds_spm_id_map vds_spm_id_map) { org.springframework.jdbc.core.namedparam.MapSqlParameterSource parameterSource = getCustomMapSqlParameterSource().addValue("storage_pool_id", vds_spm_id_map.getstorage_pool_id()).addValue("vds_id", vds_spm_id_map.getId()).addValue("vds_spm_id", vds_spm_id_map.getvds_spm_id()); getCallsHandler().executeModification("Insertvds_spm_id_map", parameterSource); }
@java.lang.Override protected boolean validate() { if (((org.ovirt.engine.core.bll.AbstractRngDeviceCommand.getParameters().getRngDevice().getVmId()) == null) || ((cachedEntity) == null)) { return failValidation((org.ovirt.engine.core.bll.AbstractRngDeviceCommand.getParameters().isVm() ? org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_VM_NOT_FOUND : org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_TEMPLATE_DOES_NOT_EXIST)); } if (((org.ovirt.engine.core.bll.AbstractRngDeviceCommand.getParameters().isVm()) && ((org.ovirt.engine.core.bll.AbstractRngDeviceCommand.getVm()) != null)) && (org.ovirt.engine.core.bll.AbstractRngDeviceCommand.getVm().isRunningOrPaused())) { return failValidation(EngineMessage.ACTION_TYPE_FAILED_VM_IS_RUNNING); } return true; }
public void setRole(java.lang.String value) { if (!(org.ovirt.engine.core.compat.StringHelper.stringsEqual(privateRole, value))) { privateRole = value; OnPropertyChanged(new org.ovirt.engine.core.compat.PropertyChangedEventArgs("Role")); } }
@org.junit.Test public void shouldOnlyTakeStartingDigits() { final org.ovirt.engine.core.bll.scheduling.OS invalidOs = org.ovirt.engine.core.bll.scheduling.OS.fromPackageVersionString("Centos - Server7 - release"); assertThat(invalidOs.isValid(), is(false)); }
@java.lang.Override public javax.ws.rs.core.Response add(org.ovirt.engine.api.model.ExternalHostProvider provider) { validateParameters(provider, "name"); return performCreate(VdcActionType.AddProvider, new org.ovirt.engine.core.common.action.ProviderParameters(map(provider)), new org.ovirt.engine.api.restapi.resource.externalhostproviders.QueryIdResolver<org.ovirt.engine.core.compat.Guid>(org.ovirt.engine.core.common.queries.VdcQueryType.GetProviderById, org.ovirt.engine.core.common.queries.IdQueryParameters.class)); }
@java.lang.Override protected org.springframework.jdbc.core.namedparam.MapSqlParameterSource createFullParametersMapper(org.ovirt.engine.core.common.businessentities.network.Network network) { return getCustomMapSqlParameterSource().addValue("addr", network.getAddr()).addValue("description", network.getDescription()).addValue("free_text_comment", network.getComment()).addValue("id", network.getId()).addValue("name", network.getName()).addValue("subnet", network.getSubnet()).addValue("gateway", network.getGateway()).addValue("type", network.getType()).addValue("vlan_id", network.getVlanId()).addValue("stp", network.getStp()).addValue("storage_pool_id", network.getDataCenterId()).addValue("mtu", network.getMtu()).addValue("vm_network", network.isVmNetwork()).addValue("provider_network_provider_id", ((network.getProvidedBy()) == null ? null : network.getProvidedBy().getProviderId())).addValue("provider_network_external_id", ((network.getProvidedBy()) == null ? null : network.getProvidedBy().getExternalId())); }
private org.ovirt.engine.core.compat.Guid getVmToAttach(org.ovirt.engine.core.compat.NGuid poolId) { if ((vmToAttach) == null) { org.ovirt.engine.core.compat.Guid vmGuid = org.ovirt.engine.core.bll.AttachUserToVmFromPoolAndRunCommand.getPrestartedVmToAttach(poolId); if ((vmGuid == null) || (Guid.Empty.equals(vmGuid))) { vmGuid = org.ovirt.engine.core.bll.AttachUserToVmFromPoolAndRunCommand.getNonPrestartedVmToAttach(poolId); } vmToAttach = vmGuid; } return vmToAttach; }
@org.ovirt.engine.ui.webadmin.DefaultMessage("For Desktop Load - Enable memory page sharing to {0}%") java.lang.String clusterPopupMemoryOptimizationForDesktopLabel(java.lang.String a);
protected boolean isImageNotLocked() { org.ovirt.engine.core.common.businessentities.storage.DiskImage diskImage = getImage(); if ((diskImage.getImageStatus()) == (org.ovirt.engine.core.common.businessentities.storage.ImageStatus.LOCKED)) { if (isMoveOperation()) { return failValidation(EngineMessage.ACTION_TYPE_FAILED_DISKS_LOCKED, java.lang.String.format("$%1$s %2$s", "diskAliases", diskImage.getDiskAlias())); } else { return failValidation(EngineMessage.VM_TEMPLATE_IMAGE_IS_LOCKED); } } return true; }
@java.lang.Override protected void onActionExecute() { for (org.ovirt.engine.core.common.businessentities.network.HostNicVfsConfig originalVfsConfig : originalVfsConfigs) { org.ovirt.engine.core.common.businessentities.network.HostNicVfsConfig updatedVfsConfig = updatedNicToVfsConfig.get(originalVfsConfig.getNicId()); initUpdateVfsConfigParams(originalVfsConfig, updatedVfsConfig); if (!(updatedVfsConfig.isAllNetworksAllowed())) { initAddedNetworksParams(originalVfsConfig, updatedVfsConfig); initRemovedNetworksParams(originalVfsConfig, updatedVfsConfig); initAddedLabelsParams(originalVfsConfig, updatedVfsConfig); initRemovedLabelsParams(originalVfsConfig, updatedVfsConfig); } } org.ovirt.engine.ui.uicommonweb.action.UiAction updateAction = new org.ovirt.engine.ui.uicommonweb.action.UiVdcMultipleAction(org.ovirt.engine.core.common.action.VdcActionType.UpdateHostNicVfsConfig, updatedVfsConfigsParams, getModel(), true, false); updateAction.then(new org.ovirt.engine.ui.uicommonweb.action.UiVdcMultipleAction(org.ovirt.engine.core.common.action.VdcActionType.AddVfsConfigNetwork, addedNetworksParams, getModel())).and(new org.ovirt.engine.ui.uicommonweb.action.UiVdcMultipleAction(org.ovirt.engine.core.common.action.VdcActionType.RemoveVfsConfigNetwork, removedNetworksParams, getModel())).and(new org.ovirt.engine.ui.uicommonweb.action.UiVdcMultipleAction(org.ovirt.engine.core.common.action.VdcActionType.AddVfsConfigLabel, addedLabelsParams, getModel())).and(new org.ovirt.engine.ui.uicommonweb.action.UiVdcMultipleAction(org.ovirt.engine.core.common.action.VdcActionType.RemoveVfsConfigLabel, removedLabelsParams, getModel())).then(getNextAction()); then(null); updateAction.runParallelAction(getActionFlowState()); }
private org.ovirt.engine.core.common.businessentities.GraphicsDevice getGraphicsDevOfType(org.ovirt.engine.core.common.businessentities.GraphicsType type) { java.util.List<org.ovirt.engine.core.common.businessentities.GraphicsDevice> graphicsDevices = getGraphicsDevices(); for (org.ovirt.engine.core.common.businessentities.GraphicsDevice dev : graphicsDevices) { if ((dev.getGraphicsType()) == type) { return dev; } } return null; }
@java.lang.Override protected void build(org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel model, T vm) { vm.setMemSizeMb(model.getMemSize().getEntity()); vm.setMaxMemorySizeMb(model.getMaxMemorySize().getEntity()); if (model.getIoThreadsEnabled().getEntity()) { vm.setNumOfIoThreads(org.ovirt.engine.ui.uicommonweb.builders.vm.HwOnlyCoreUnitToVmBaseBuilder.DEFAULT_NUM_OF_IOTHREADS); } else { vm.setNumOfIoThreads(0); } vm.setNumOfSockets(model.getNumOfSockets().getSelectedItem()); vm.setCpuPerSocket(model.getCoresPerSocket().getSelectedItem()); vm.setThreadsPerCpu(model.getThreadsPerCore().getSelectedItem()); vm.setDefaultDisplayType(model.getDisplayType().getSelectedItem()); vm.setNumOfMonitors(model.getNumOfMonitors().getSelectedItem()); vm.setSmartcardEnabled(model.getIsSmartcardEnabled().getEntity()); vm.setSsoMethod(model.extractSelectedSsoMethod()); vm.setMinAllocatedMem(model.getMinAllocatedMemory().getEntity()); vm.setDefaultBootSequence(model.getBootSequence()); vm.setSingleQxlPci(model.getIsSingleQxlEnabled().getEntity()); vm.setCustomEmulatedMachine(model.getEmulatedMachine().getSelectedItem()); vm.setCustomCpuName(model.getCustomCpu().getSelectedItem()); }
@org.junit.Test public void validateDiskIsLocked() throws java.lang.Exception { initializeCommand(ImageOperation.Move, new org.ovirt.engine.core.common.businessentities.storage.DiskImage()); initVmDiskImage(false); mockGetVmsListForDisk(); command.getImage().setImageStatus(ImageStatus.LOCKED); doReturn(vmDeviceDao).when(command).getVmDeviceDao(); assertFalse(command.validate()); assertTrue(command.getReturnValue().getValidationMessages().contains(EngineMessage.ACTION_TYPE_FAILED_DISKS_LOCKED.toString())); }
public org.ovirt.engine.core.bll.ValidationResult updatesAvailable() { return org.ovirt.engine.core.bll.ValidationResult.failWith(VdcBllMessages.NO_AVAILABLE_UPDATES_FOR_HOST).unless((((getHost().getVdsType()) == (org.ovirt.engine.core.common.businessentities.VDSType.oVirtNode)) || (getHost().isUpdateAvailable()))); }
@org.junit.Test public void internalActiveDisallowed() { testInternalExecution(StorageDomainStatus.Active); testActionDisallowed(); }
protected static java.lang.String getMessageOrNull(org.ovirt.engine.core.common.AuditLogType logType) { final java.lang.String key = logType.name(); try { return org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogDirector.resourceBundle.getString(key); } catch (java.lang.Exception e) { org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogDirector.log.error("Key '{}' is not translated in '{}'", key, org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogDirector.getResourceBundleName()); return null; } }
private void connect(boolean isPasswordDelegationPossible) { if (isPasswordDelegationPossible) { try { model.getAutoConnectableConsoles().get(0).connect(); alreadyOpened = true; } catch (org.ovirt.engine.ui.uicommonweb.models.VmConsoles e) { errorPopupManager.show(e.getLocalizedErrorMessage()); } } unregisterModels(); }
public void initialize(org.ovirt.engine.ui.uicommonweb.models.SystemTreeItemModel SystemTreeSelectedItem) { super.initialize(); getMemSize().setEntity(256); getMinAllocatedMemory().setEntity(256); getIsStateless().setEntity(false); getIsRunAndPause().setEntity(false); getIsSmartcardEnabled().setEntity(false); isConsoleDeviceEnabled.setEntity(false); getIsHighlyAvailable().setEntity(false); getIsAutoAssign().setEntity(true); getIsTemplatePublic().setEntity(true); getBehavior().enableSinglePCI(false); isRngEnabled.setEntity(false); rngSourceRandom.setEntity(true); getHostCpu().setEntity(false); getMigrationMode().setIsChangeable(true); getCdImage().setIsChangeable(false); initGraphicsAndDisplayListeners(); initFirstBootDevice(); initNumOfMonitors(); initAllowConsoleReconnect(); initMigrationMode(); initVncKeyboardLayout(); behavior.initialize(SystemTreeSelectedItem); }
@org.junit.Test public void onlyInboundPeakPresent() { qos.setInboundPeak(org.ovirt.engine.core.bll.validator.NetworkQosValidatorTest.BANDWIDTH_MEDIUM); valuesPresentTest(org.ovirt.engine.core.bll.validator.ValidationResultMatchers.failsWith(VdcBllMessages.ACTION_TYPE_FAILED_NETWORK_QOS_MISSING_VALUES)); }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("Select Brick") java.lang.String selectBrickToViewFopStats();
private org.ovirt.engine.core.bll.ValidationResult networksUniquelyConfiguredOnHost(java.util.Collection<org.ovirt.engine.core.common.businessentities.network.NetworkAttachment> attachmentsToConfigure) { java.util.Set<org.ovirt.engine.core.compat.Guid> networkIds = new java.util.HashSet(attachmentsToConfigure.size()); for (org.ovirt.engine.core.common.businessentities.network.NetworkAttachment attachment : attachmentsToConfigure) { if (networkIds.contains(attachment.getNetworkId())) { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.VdcBllMessages.NETWORKS_ALREADY_ATTACHED_TO_IFACES); } else { networkIds.add(attachment.getNetworkId()); } } return org.ovirt.engine.core.bll.ValidationResult.VALID; }
@java.lang.Override protected boolean canDoAction() { org.ovirt.engine.core.bll.VdsValidator vdsValidator = new org.ovirt.engine.core.bll.VdsValidator(getVds()); return ((validate(vdsValidator.exists())) && (validate(vdsValidator.isUp()))) && (validate(validateMinimumVersionSupport())); }
@java.lang.Override protected void verify(org.ovirt.engine.api.model.DiskSnapshot model, org.ovirt.engine.api.model.DiskSnapshot transform) { assertNotNull(transform); assertEquals(model.getId(), transform.getId()); assertEquals(model.getFormat(), transform.getFormat()); assertEquals(model.isReadOnly(), transform.isReadOnly()); assertEquals(model.getDescription(), transform.getDescription()); assertNotNull(model.getSnapshot()); assertEquals(model.getSnapshot().getId(), transform.getSnapshot().getId()); assertEquals("unexpected status", model.getStatus(), transform.getStatus()); assertEquals("unexpected sparse", model.isSparse(), transform.isSparse()); assertEquals("unexpected propagate errors", model.isPropagateErrors(), transform.isPropagateErrors()); assertEquals("unexpected wipe after delete", model.isWipeAfterDelete(), transform.isWipeAfterDelete()); assertEquals("unexpected shareable", model.isShareable(), transform.isShareable()); }
org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc glusterHookEnable(java.lang.String glusterCommand, java.lang.String stage, java.lang.String hookName);
@java.lang.Override protected org.springframework.jdbc.core.RowMapper<org.ovirt.engine.core.common.job.Job> createEntityRowMapper() { return org.ovirt.engine.core.dao.JobDaoImpl.jobRowMapper; }
public org.ovirt.engine.core.bll.ValidationResult isIsoDiskAttachedToAnyNonDownVm() { java.util.List<java.lang.String> vmNames = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVmDao().getAllRunningNamesWithSpecificIsoAttached(disk.getId()); if (!(vmNames.isEmpty())) { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ERROR_ISO_DISK_ATTACHED_TO_RUNNING_VMS, org.ovirt.engine.core.utils.ReplacementUtils.createSetVariableString(org.ovirt.engine.core.bll.validator.storage.DiskValidator.DISK_NAME_VARIABLE, disk.getDiskAlias()), org.ovirt.engine.core.utils.ReplacementUtils.createSetVariableString(org.ovirt.engine.core.bll.validator.storage.DiskValidator.VM_LIST, vmNames)); } return org.ovirt.engine.core.bll.ValidationResult.VALID; }
private void createVMFromTemplate() { org.ovirt.engine.core.common.businessentities.VmTemplate template = getSelectedItem(); final java.util.List<org.ovirt.engine.ui.uicommonweb.UICommand> commands = new java.util.ArrayList<>(); commands.add(org.ovirt.engine.ui.uicommonweb.UICommand.createDefaultOkUiCommand("OnSaveVm", this)); commands.add(org.ovirt.engine.ui.uicommonweb.UICommand.createCancelUiCommand("Cancel", this)); org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().getTemplateById(new org.ovirt.engine.ui.frontend.AsyncQuery(new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { org.ovirt.engine.core.common.businessentities.VmTemplate withVmInit = ((org.ovirt.engine.core.common.businessentities.VmTemplate) (returnValue)); setupNewVmModel(new org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel(new org.ovirt.engine.ui.uicommonweb.models.vms.NewVmFromTemplateModelBehavior(withVmInit), org.ovirt.engine.ui.uicommonweb.models.templates.TemplateListModel.this), withVmInit.getVmType(), getSystemTreeSelectedItem(), commands); } }), template.getId()); }
private boolean changesAreClusterCompatible() { if (!(org.ovirt.engine.core.bll.network.cluster.AttachNetworkToClusterInternalCommand.getParameters().getNetwork().isVmNetwork())) { if (!(org.ovirt.engine.core.common.FeatureSupported.nonVmNetwork(org.ovirt.engine.core.bll.network.cluster.AttachNetworkToClusterInternalCommand.getVdsGroup().getCompatibilityVersion()))) { addValidationMessage(EngineMessage.NON_VM_NETWORK_NOT_SUPPORTED_FOR_POOL_LEVEL); return false; } } return true; }
private java.lang.Boolean getAutoConverge() { if (org.ovirt.engine.core.common.FeatureSupported.autoConvergence(MigrateVmCommand.getVm().getVdsGroupCompatibilityVersion())) { if ((MigrateVmCommand.getVm().getAutoConverge()) != null) { return MigrateVmCommand.getVm().getAutoConverge(); } if ((MigrateVmCommand.getVdsGroup().getAutoConverge()) != null) { return MigrateVmCommand.getVdsGroup().getAutoConverge(); } return org.ovirt.engine.core.common.config.Config.getValue(ConfigValues.DefaultAutoConvergence); } return null; }
@org.junit.Test public void canDoActionFailsOnNullCluster() { cmd = spy(new org.ovirt.engine.core.bll.gluster.DisableGlusterHookCommand(new org.ovirt.engine.core.common.action.gluster.GlusterHookParameters(null, HOOK_ID))); setupMocks(cmd); assertFalse(cmd.canDoAction()); assertTrue(cmd.getReturnValue().getCanDoActionMessages().contains(VdcBllMessages.ACTION_TYPE_FAILED_CLUSTER_IS_NOT_VALID.toString())); }
@java.lang.Override public java.lang.String getGlusterHookContent(org.ovirt.engine.core.compat.Guid hookId) { java.lang.String content = getCallsHandler().executeRead("GetGlusterHookById", org.ovirt.engine.core.dao.gluster.GlusterHooksDaoDbFacadeImpl.GlusterHookContentRowMapper, createIdParameterMapper(hookId).addValue("includeContent", true)); return content; }
@java.lang.Override protected org.springframework.jdbc.core.RowMapper<org.ovirt.engine.core.common.businessentities.storage.DiskImageDynamic> createEntityRowMapper() { return org.ovirt.engine.core.dao.DiskImageDynamicDaoImpl.DiskImageDynamicRowMapper.instance; }
@java.lang.Override public void run() { resourceManagerProvider.get().GetVdsManager(vdsException.getVdsError().getVdsId()).handleNetworkException(vdsException); }
private void setRngDeviceToParams(org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel model, org.ovirt.engine.core.common.action.VmManagementParametersBase parameters) { parameters.setUpdateRngDevice(true); parameters.setRngDevice((((java.lang.Boolean) (model.getIsRngEnabled().getEntity())) ? model.generateRngDevice() : null)); }
@org.junit.Test public void testAddPassTemplateByName() throws java.lang.Exception { setUpEntityQueryExpectations(VdcQueryType.GetVmTemplate, org.ovirt.engine.core.common.queries.GetVmTemplateParameters.class, new java.lang.String[]{ "Name", "DataCenterId" }, new java.lang.Object[]{ NAMES[1], GUIDS[3] }, getTemplateEntity(1)); setupAddExpectations(); org.ovirt.engine.api.model.VM model = org.ovirt.engine.api.restapi.resource.BackendVmsResourceTest.getModel(2); model.setTemplate(new org.ovirt.engine.api.model.Template()); model.getTemplate().setName(NAMES[1].toString()); javax.ws.rs.core.Response response = collection.add(model); assertEquals(201, response.getStatus()); assertTrue(((response.getEntity()) instanceof org.ovirt.engine.api.model.VM)); verifyModel(((org.ovirt.engine.api.model.VM) (response.getEntity())), 2); }
private java.lang.String createVG() { org.ovirt.engine.core.common.vdscommands.VDSReturnValue returnValue = runVdsCommand(VDSCommandType.CreateVG, new org.ovirt.engine.core.common.vdscommands.CreateVGVDSCommandParameters(org.ovirt.engine.core.bll.storage.AddSANStorageDomainCommand.getVds().getId(), org.ovirt.engine.core.bll.storage.AddSANStorageDomainCommand.getStorageDomain().getId(), org.ovirt.engine.core.bll.storage.AddSANStorageDomainCommand.getParameters().getLunIds(), org.ovirt.engine.core.bll.storage.AddSANStorageDomainCommand.getParameters().isForce())); java.lang.String volumeGroupId = ((java.lang.String) (((returnValue.getReturnValue()) instanceof java.lang.String) ? returnValue.getReturnValue() : null)); return volumeGroupId; }
@java.lang.Override public void remove(java.lang.String id) { execute(getClient().networks().delete(id)); }
public void addColumn(com.google.gwt.user.cellview.client.Column column, com.google.gwt.safehtml.shared.SafeHtml headerHtml, java.lang.String width) { addColumnAndSetWidth(column, headerHtml, width); }
public static org.ovirt.engine.core.bll.storage.disk.image.MetadataDiskDescriptionHandler getInstance() { return org.ovirt.engine.core.bll.storage.disk.image.MetadataDiskDescriptionHandler.instance; }
@java.lang.Override public org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc desktopLogin(java.lang.String vmId, java.lang.String domain, java.lang.String user, java.lang.String password) { org.ovirt.vdsm.jsonrpc.client.JsonRpcRequest request = new org.ovirt.vdsm.jsonrpc.client.RequestBuilder("VM.desktopLogin").withParameter("vmID", vmId).withParameter("domain", domain).withParameter("username", user).withParameter("password", password).build(); java.util.Map<java.lang.String, java.lang.Object> response = new org.ovirt.engine.core.vdsbroker.jsonrpc.FutureMap(this.client, request); return new org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc(response); }
@org.ovirt.engine.ui.frontend.DefaultStringValue("Cannot ${action} ${type}. Host ${vdsName} cannot serve as proxy. Verify its cluster architecture and compatibility version are supported.") java.lang.String ACTION_TYPE_FAILED_HOST_CANNOT_BE_PROXY_FOR_IMPORT_VM();
@org.junit.Test public void testValidateAllClustersLevel() { storagePoolWithVersionHigherThanCluster(); java.util.List<org.ovirt.engine.core.common.businessentities.VDSGroup> clusterList = org.ovirt.engine.core.bll.storage.pool.UpdateStoragePoolCommandTest.createClusterList(); org.ovirt.engine.core.common.businessentities.VDSGroup secondCluster = new org.ovirt.engine.core.common.businessentities.VDSGroup(); secondCluster.setCompatibilityVersion(org.ovirt.engine.core.bll.storage.pool.UpdateStoragePoolCommandTest.VERSION_1_2); secondCluster.setName("secondCluster"); clusterList.add(secondCluster); org.ovirt.engine.core.common.businessentities.VDSGroup thirdCluster = new org.ovirt.engine.core.common.businessentities.VDSGroup(); thirdCluster.setCompatibilityVersion(org.ovirt.engine.core.bll.storage.pool.UpdateStoragePoolCommandTest.VERSION_1_1); thirdCluster.setName("thirdCluster"); clusterList.add(thirdCluster); when(vdsGroupDao.getAllForStoragePool(any(org.ovirt.engine.core.compat.Guid.class))).thenReturn(clusterList); assertFalse(cmd.checkAllClustersLevel()); java.util.List<java.lang.String> messages = cmd.getReturnValue().getValidationMessages(); assertTrue(messages.contains(EngineMessage.ERROR_CANNOT_UPDATE_STORAGE_POOL_COMPATIBILITY_VERSION_BIGGER_THAN_CLUSTERS.toString())); assertTrue(messages.get(0).contains("firstCluster")); assertFalse(messages.get(0).contains("secondCluster")); assertTrue(messages.get(0).contains("thirdCluster")); }
public void searchMyGroups() { getSearchInProgress().setEntity(true); org.ovirt.engine.ui.frontend.AsyncQuery asyncQuery = new org.ovirt.engine.ui.frontend.AsyncQuery(); asyncQuery.setModel(this); asyncQuery.setHandleFailure(true); asyncQuery.asyncCallback = new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object ReturnValue) { org.ovirt.engine.ui.uicommonweb.models.users.AdElementListModel adElementListModel = ((org.ovirt.engine.ui.uicommonweb.models.users.AdElementListModel) (model)); org.ovirt.engine.core.common.queries.VdcQueryReturnValue queryReturnValue = ((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (ReturnValue)); if (handleQueryError(queryReturnValue, adElementListModel)) { return; } java.util.HashSet<java.lang.String> excludeUsers = new java.util.HashSet<java.lang.String>(); if ((adElementListModel.getExcludeItems()) != null) { for (org.ovirt.engine.core.common.businessentities.aaa.DbUser item : adElementListModel.getExcludeItems()) { excludeUsers.add(item.getExternalId()); } } adElementListModel.setgroups(new java.util.ArrayList<org.ovirt.engine.ui.uicommonweb.models.EntityModel<org.ovirt.engine.core.common.businessentities.aaa.DbUser>>()); addGroupsToModel(queryReturnValue, excludeUsers); adElementListModel.setusers(new java.util.ArrayList<org.ovirt.engine.ui.uicommonweb.models.EntityModel<org.ovirt.engine.core.common.businessentities.aaa.DbUser>>()); onUserAndAdGroupsLoaded(adElementListModel); } }; org.ovirt.engine.ui.frontend.Frontend.getInstance().runQuery(VdcQueryType.GetDirectoryGroupsForUser, new org.ovirt.engine.core.common.queries.VdcQueryParametersBase(), asyncQuery); }
private static void mapBlockStats(org.ovirt.engine.api.model.ProfileDetail profileDetail, org.ovirt.engine.core.common.businessentities.gluster.StatsInfo statsInfo) { for (org.ovirt.engine.core.common.businessentities.gluster.BlockStats blockStat : statsInfo.getBlockStats()) { org.ovirt.engine.api.model.BlockStatistic bStat = new org.ovirt.engine.api.model.BlockStatistic(); bStat.setStatistics(new org.ovirt.engine.api.model.Statistics()); bStat.getStatistics().getStatistics().add(org.ovirt.engine.api.restapi.utils.StatisticResourceUtils.setDatum(org.ovirt.engine.api.restapi.types.GlusterVolumeProfileInfoMapper.clone(org.ovirt.engine.api.restapi.types.GlusterVolumeProfileInfoMapper.BLOCK_SIZE), blockStat.getSize())); bStat.getStatistics().getStatistics().add(org.ovirt.engine.api.restapi.utils.StatisticResourceUtils.setDatum(org.ovirt.engine.api.restapi.types.GlusterVolumeProfileInfoMapper.clone(org.ovirt.engine.api.restapi.types.GlusterVolumeProfileInfoMapper.BYTES_BLOCK_READ), blockStat.getBlockRead())); bStat.getStatistics().getStatistics().add(org.ovirt.engine.api.restapi.utils.StatisticResourceUtils.setDatum(org.ovirt.engine.api.restapi.types.GlusterVolumeProfileInfoMapper.clone(org.ovirt.engine.api.restapi.types.GlusterVolumeProfileInfoMapper.BYTES_BLOCK_WRITE), blockStat.getBlockWrite())); profileDetail.setBlockStatistics(new org.ovirt.engine.api.model.BlockStatistics()); profileDetail.getBlockStatistics().getBlockStatistics().add(bStat); } }
@java.lang.Override protected void readOsSection(XmlNode section) { _vmTemplate.setId(new org.ovirt.engine.core.compat.Guid(section.attributes.get("ovf:id").getValue())); XmlNode node = section.SelectSingleNode("Description"); if (node != null) { int osId = osRepository.getOsIdByUniqueName(node.innerText); _vmTemplate.setOsId(osId); _vmTemplate.setClusterArch(osRepository.getArchitectureFromOS(osId)); } else { _vmTemplate.setClusterArch(ArchitectureType.undefined); } }
protected abstract java.lang.String getNoActiveSourceDomainMessage();
@java.lang.Override protected boolean validate() { if (!(super.validate())) { return false; } if (((getParameters().getBricks()) == null) || ((getParameters().getBricks().size()) == 0)) { return failValidation(EngineMessage.ACTION_TYPE_FAILED_BRICKS_REQUIRED); } if (getGlusterVolume().getVolumeType().isReplicatedType()) { if ((getParameters().getReplicaCount()) > ((getGlusterVolume().getReplicaCount()) + 1)) { return failValidation(EngineMessage.ACTION_TYPE_FAILED_CAN_NOT_INCREASE_REPLICA_COUNT_MORE_THAN_ONE); } else if ((getParameters().getReplicaCount()) < (getGlusterVolume().getReplicaCount())) { return failValidation(EngineMessage.ACTION_TYPE_FAILED_CAN_NOT_REDUCE_REPLICA_COUNT); } } if (getGlusterVolume().getVolumeType().isStripedType()) { if ((getParameters().getStripeCount()) > ((getGlusterVolume().getStripeCount()) + 1)) { return failValidation(EngineMessage.ACTION_TYPE_FAILED_CAN_NOT_INCREASE_STRIPE_COUNT_MORE_THAN_ONE); } else if ((getParameters().getStripeCount()) < (getGlusterVolume().getStripeCount())) { return failValidation(EngineMessage.ACTION_TYPE_FAILED_CAN_NOT_REDUCE_STRIPE_COUNT); } } if (getGlusterVolume().getVolumeType().isDispersedType()) { return failValidation(EngineMessage.ACTION_TYPE_FAILED_ADD_BRICK_TO_DISPERSE_VOLUME_NOT_SUPPORTED); } boolean ret = (updateBrickServerAndInterfaceNames(getParameters().getBricks(), true)) && (validateDuplicateBricks(getParameters().getBricks())); if (((getCluster().supportsGlusterService()) && (getCluster().supportsVirtService())) && (getGlusterVolume().getVolumeType().isReplicatedType())) { ret = ret && (validateNotSameServer(getParameters().getBricks(), getGlusterVolume(), getParameters().getReplicaCount())); } return ret; }
@org.junit.Test public void validateChangeForbiddenField() { sd.setStorageType(StorageType.UNKNOWN); org.ovirt.engine.core.bll.ValidateTestUtils.runAndAssertValidateFailure(cmd, EngineMessage.ERROR_CANNOT_CHANGE_STORAGE_DOMAIN_FIELDS); }
public void setExportCommand(org.ovirt.engine.ui.uicommonweb.UICommand exportCommand) { this.exportCommand = exportCommand; }
@java.lang.Override protected void setActionMessageParameters() { addValidationMessage(EngineMessage.VAR__ACTION__UPDATE); addValidationMessage(EngineMessage.VAR__TYPE__VM_TEMPLATE); }
private static void initGuestContainers(java.util.Map<java.lang.String, java.lang.Object> vmStruct, org.ovirt.engine.core.common.businessentities.VmDynamic vm) { if (vmStruct.containsKey(VdsProperties.guest_containers)) { vm.setGuestContainers(new java.util.ArrayList()); java.lang.Object obj = vmStruct.get(VdsProperties.guest_containers); if (obj instanceof java.lang.Object[]) { java.lang.Object[] containers = ((java.lang.Object[]) (obj)); for (java.lang.Object containerObj : containers) { java.util.Map<java.lang.String, java.lang.Object> container = ((java.util.Map<java.lang.String, java.lang.Object>) (containerObj)); java.util.ArrayList<java.lang.String> names = new java.util.ArrayList<>(); for (java.lang.Object o : ((java.lang.Object[]) (container.get(VdsProperties.guest_container_names)))) { names.add(((java.lang.String) (o))); } vm.getGuestContainers().add(new org.ovirt.engine.core.common.businessentities.GuestContainer(((java.lang.String) (container.get(VdsProperties.guest_container_id))), names, ((java.lang.String) (container.get(VdsProperties.guest_container_image))), ((java.lang.String) (container.get(VdsProperties.guest_container_command))), ((java.lang.String) (container.get(VdsProperties.guest_container_status))))); } } } else { vm.setGuestContainers(java.util.Collections.emptyList()); } }
protected boolean migrationInterfaceUp(org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface nic, java.util.List<org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface> nics) { if ((nic.getVlanId()) != null) { java.lang.String physicalNic = org.ovirt.engine.core.utils.NetworkUtils.stripVlan(nic.getName()); for (org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface iface : nics) { if (iface.getName().equals(physicalNic)) { return (iface.getStatistics().getStatus()) == (org.ovirt.engine.core.common.businessentities.network.InterfaceStatus.UP); } } } return (nic.getStatistics().getStatus()) == (org.ovirt.engine.core.common.businessentities.network.InterfaceStatus.UP); }
protected boolean setAndValidateCpuProfile() { if ((org.ovirt.engine.core.bll.AddVmTemplateCommand.getParameters().getTemplateType()) == (org.ovirt.engine.core.common.businessentities.VmEntityType.INSTANCE_TYPE)) { return true; } return validate(org.ovirt.engine.core.bll.profiles.CpuProfileHelper.setAndValidateCpuProfile(org.ovirt.engine.core.bll.AddVmTemplateCommand.getParameters().getMasterVm(), org.ovirt.engine.core.bll.AddVmTemplateCommand.getVm().getCompatibilityVersion())); }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.VmTemplate> getAllForStorageDomain(org.ovirt.engine.core.compat.Guid storageDomain, org.ovirt.engine.core.compat.Guid userID, boolean isFiltered) { return getCallsHandler().executeReadList("GetVmTemplatesByStorageDomainId", org.ovirt.engine.core.dao.VmTemplateDaoImpl.VMTemplateRowMapper.instance, getCustomMapSqlParameterSource().addValue("storage_domain_id", storageDomain).addValue("user_id", userID).addValue("is_filtered", isFiltered)); }
@java.lang.Override protected boolean canDoAction() { org.ovirt.engine.core.compat.Guid userId = org.ovirt.engine.core.bll.UserProfilesOperationCommandBase.getParameters().getUserProfile().getUserId(); if (org.ovirt.engine.core.compat.Guid.isNullOrEmpty(userId)) { userId = org.ovirt.engine.core.bll.UserProfilesOperationCommandBase.getUserId(); org.ovirt.engine.core.bll.UserProfilesOperationCommandBase.getParameters().getUserProfile().setUserId(userId); } else if (!(userId.equals(org.ovirt.engine.core.bll.UserProfilesOperationCommandBase.getUserId()))) { return failCanDoAction(EngineMessage.USER_NOT_AUTHORIZED_TO_PERFORM_ACTION); } java.lang.String sshPublicKey = org.ovirt.engine.core.bll.UserProfilesOperationCommandBase.getParameters().getUserProfile().getSshPublicKey(); if ((sshPublicKey == null) || (sshPublicKey.isEmpty())) { return true; } if (!(org.ovirt.engine.core.uutils.ssh.OpenSSHUtils.arePublicKeysValid(sshPublicKey))) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_INVALID_PUBLIC_SSH_KEY); } return true; }
@org.junit.Test public void hasLocalDomain() { org.ovirt.engine.core.common.businessentities.StorageDomainStatic sdc = new org.ovirt.engine.core.common.businessentities.StorageDomainStatic(); sdc.setStorageType(StorageType.LOCALFS); when(spDao.get(any(org.ovirt.engine.core.compat.Guid.class))).thenReturn(org.ovirt.engine.core.bll.storage.pool.UpdateStoragePoolCommandTest.createDefaultStoragePool()); when(sdDao.getAllForStoragePool(any(org.ovirt.engine.core.compat.Guid.class))).thenReturn(java.util.Collections.singletonList(sdc)); org.ovirt.engine.core.bll.ValidateTestUtils.runAndAssertValidateFailure(cmd, EngineMessage.ERROR_CANNOT_CHANGE_STORAGE_POOL_TYPE_WITH_LOCAL); }
@java.lang.Override public java.lang.String getValue(java.lang.Object object) { return ((org.ovirt.engine.ui.uicommonweb.models.vms.ImportTemplateData) (object)).getTemplate().getName(); }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.VDS> getAllForNetwork(org.ovirt.engine.core.compat.Guid networkId) { org.springframework.jdbc.core.namedparam.MapSqlParameterSource parameterSource = getCustomMapSqlParameterSource().addValue("network_id", networkId); java.util.List<org.ovirt.engine.core.common.businessentities.VDS> vdsList = getCallsHandler().executeReadList("GetVdsByNetworkId", org.ovirt.engine.core.dao.VdsDaoImpl.VdsRowMapper.instance, parameterSource); return uniteAgents(vdsList); }
private void toggleVisibleWidgets(int currentWidth) { int widgetWidth = 0; boolean foundEdge = false; if ((contentPanel.getWidgetCount()) > 1) { for (int i = 0; i < ((contentPanel.getWidgetCount()) - 1); i++) { if (!(originallyVisible.get(i))) { continue; } com.google.gwt.user.client.ui.Widget widget = contentPanel.getWidget(i); widget.setVisible(true); if (foundEdge || ((widgetWidth + (widget.getOffsetWidth())) > currentWidth)) { widget.setVisible(false); toolbarOnlyActionButtonList.get(i).setCascaded(true); foundEdge = true; } else { toolbarOnlyActionButtonList.get(i).setCascaded(false); widgetWidth += widget.getOffsetWidth(); } } } }
public static void getoVirtISOsList(org.ovirt.engine.ui.frontend.AsyncQuery aQuery, org.ovirt.engine.core.compat.Guid id) { aQuery.converterCallback = new org.ovirt.engine.ui.frontend.IAsyncConverter() { @java.lang.Override public java.lang.Object Convert(java.lang.Object source, org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery) { return source != null ? new java.util.ArrayList<org.ovirt.engine.core.compat.RpmVersion>(((java.util.ArrayList<org.ovirt.engine.core.compat.RpmVersion>) (source))) : new java.util.ArrayList<org.ovirt.engine.core.compat.RpmVersion>(); } }; org.ovirt.engine.ui.frontend.Frontend.RunQuery(VdcQueryType.GetoVirtISOs, new org.ovirt.engine.core.common.queries.VdsIdParametersBase(id), aQuery); }
private void extractRemovedNetworks() { for (org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface iface : getExistingIfaces().values()) { java.lang.String net = iface.getNetworkName(); if ((org.apache.commons.lang.StringUtils.isNotBlank(net)) && (!(attachedNetworksNames.contains(net)))) { removedNetworks.add(net); } } java.util.List<java.lang.String> vmNames = getVmInterfaceManager().findActiveVmsUsingNetworks(params.getVdsId(), removedNetworks); for (java.lang.String vmName : vmNames) { addViolation(EngineMessage.NETWORK_CANNOT_DETACH_NETWORK_USED_BY_VMS, vmName); } }
private void endCommand() { java.util.List<org.ovirt.engine.core.common.businessentities.VM> listVms = getVmsForDiskId(); for (org.ovirt.engine.core.common.businessentities.VM vm : listVms) { org.ovirt.engine.core.bll.RemoveDiskCommand.getVmStaticDAO().incrementDbGeneration(vm.getId()); } getDisk(); org.ovirt.engine.core.bll.Backend.getInstance().EndAction(VdcActionType.RemoveImage, org.ovirt.engine.core.bll.RemoveDiskCommand.getParameters().getImagesParameters().get(0)); org.ovirt.engine.core.bll.RemoveDiskCommand.setSucceeded(true); }
private void createHostedEngineVm(org.ovirt.engine.core.compat.Guid id) { org.ovirt.engine.core.common.businessentities.VmStatic vmStatic = new org.ovirt.engine.core.common.businessentities.VmStatic(); vmStatic.setId(id); vmStatic.setClusterId(FixturesTool.CLUSTER_RHEL6_ISCSI); vmStatic.setName("HostedEngine"); vmStatic.setOrigin(OriginType.HOSTED_ENGINE); vmStatic.setCpuProfileId(FixturesTool.CPU_PROFILE_1); getDbFacade().getVmStaticDao().save(vmStatic); org.ovirt.engine.core.common.businessentities.VmDynamic vmDynamic = new org.ovirt.engine.core.common.businessentities.VmDynamic(); vmDynamic.setId(id); getDbFacade().getVmDynamicDao().save(vmDynamic); org.ovirt.engine.core.common.businessentities.VmStatistics vmStatistics = new org.ovirt.engine.core.common.businessentities.VmStatistics(); vmStatistics.setId(id); getDbFacade().getVmStatisticsDao().save(vmStatistics); }
@java.lang.Override protected void buildSysprepVmPayload(java.lang.String sysPrepContent) { org.ovirt.engine.core.common.businessentities.VmPayload vmPayload = new org.ovirt.engine.core.common.businessentities.VmPayload(); vmPayload.setDeviceType(VmDeviceType.FLOPPY); vmPayload.getFiles().put(org.ovirt.engine.core.vdsbroker.vdsbroker.VmInfoBuilder.SYSPREP_FILE_NAME, new java.lang.String(org.ovirt.engine.core.vdsbroker.vdsbroker.VmInfoBuilder.BASE_64.encode(sysPrepContent.getBytes()), java.nio.charset.Charset.forName(CharEncoding.UTF_8))); org.ovirt.engine.core.common.businessentities.VmDevice vmDevice = new org.ovirt.engine.core.common.businessentities.VmDevice(new org.ovirt.engine.core.common.businessentities.VmDeviceId(org.ovirt.engine.core.compat.Guid.newGuid(), vm.getId()), org.ovirt.engine.core.common.businessentities.VmDeviceGeneralType.DISK, VmDeviceType.FLOPPY.getName(), "", 0, vmPayload.getSpecParams(), true, true, true, "", null, null, null); java.util.Map<java.lang.String, java.lang.Object> struct = new java.util.HashMap<java.lang.String, java.lang.Object>(); org.ovirt.engine.core.vdsbroker.vdsbroker.VmInfoBuilder.addFloppyDetails(vmDevice, struct); addDevice(struct, vmDevice, vm.getFloppyPath()); }
private void recoverKdumpingHosts(java.util.List<org.ovirt.engine.core.common.businessentities.VDS> hosts) { final java.util.List<org.ovirt.engine.core.common.businessentities.VDS> kdumpingHosts = new java.util.ArrayList<>(); for (org.ovirt.engine.core.common.businessentities.VDS host : hosts) { if ((host.getStatus()) == (org.ovirt.engine.core.common.businessentities.VDSStatus.Kdumping)) { kdumpingHosts.add(host); } } if (!(kdumpingHosts.isEmpty())) { org.ovirt.engine.core.utils.threadpool.ThreadPoolUtil.execute(new java.lang.Runnable() { @java.lang.Override public void run() { waitUntilFencingAllowed(); executeNotRespondingTreatment(kdumpingHosts); } }); } }
private boolean updateIsoListFromVDSM(org.ovirt.engine.core.compat.Guid repoStoragePoolId, org.ovirt.engine.core.compat.Guid repoStorageDomainId, java.util.Map<java.lang.String, java.util.Map<java.lang.String, java.lang.Object>> fileStats) { org.ovirt.engine.core.bll.storage.domain.IsoDomainListSyncronizer.FileListRefreshed fileListRefreshed = new org.ovirt.engine.core.bll.storage.domain.IsoDomainListSyncronizer.FileListRefreshed() { @java.lang.Override public void onFileListRefreshed(org.ovirt.engine.core.compat.Guid poolId, java.util.Set<java.lang.String> isoList) { org.ovirt.engine.core.bll.VmHandler.refreshVmsToolsVersion(poolId, isoList); } }; return refreshVdsmFileList(repoStoragePoolId, repoStorageDomainId, ImageFileType.ISO, fileStats, fileListRefreshed); }
protected static void updateLocalDisksUsage(org.ovirt.engine.core.common.businessentities.VDS vds, java.util.Map<java.lang.String, java.lang.Object> xmlRpcStruct) { if (xmlRpcStruct.containsKey(VdsProperties.DISK_STATS)) { java.util.Map<java.lang.String, java.lang.Object> diskStatsStruct = ((java.util.Map<java.lang.String, java.lang.Object>) (xmlRpcStruct.get(VdsProperties.DISK_STATS))); java.util.Map<java.lang.String, java.lang.Long> diskStats = new java.util.HashMap<java.lang.String, java.lang.Long>(); vds.setLocalDisksUsage(diskStats); for (java.lang.String path : diskStatsStruct.keySet()) { java.util.Map<java.lang.String, java.lang.Object> pathStatsStruct = ((java.util.Map<java.lang.String, java.lang.Object>) (diskStatsStruct.get(path))); diskStats.put(path, org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.AssignLongValue(pathStatsStruct, VdsProperties.DISK_STATS_FREE)); } } }
private void initVmTemplate() { org.ovirt.engine.core.bll.OvfHelper ovfHelper = new org.ovirt.engine.core.bll.OvfHelper(); ovfEntityData = org.ovirt.engine.core.bll.ImportVmTemplateFromConfigurationCommand.getUnregisteredOVFDataDao().getByEntityIdAndStorageDomain(org.ovirt.engine.core.bll.ImportVmTemplateFromConfigurationCommand.getParameters().getContainerId(), org.ovirt.engine.core.bll.ImportVmTemplateFromConfigurationCommand.getParameters().getStorageDomainId()); if ((ovfEntityData) != null) { try { vmTemplateFromConfiguration = ovfHelper.readVmTemplateFromOvf(ovfEntityData.getOvfData()); vmTemplateFromConfiguration.setVdsGroupId(org.ovirt.engine.core.bll.ImportVmTemplateFromConfigurationCommand.getParameters().getVdsGroupId()); setVmTemplate(vmTemplateFromConfiguration); org.ovirt.engine.core.bll.ImportVmTemplateFromConfigurationCommand.getParameters().setVmTemplate(vmTemplateFromConfiguration); org.ovirt.engine.core.bll.ImportVmTemplateFromConfigurationCommand.getParameters().setDestDomainId(ovfEntityData.getStorageDomainId()); org.ovirt.engine.core.bll.ImportVmTemplateFromConfigurationCommand.getParameters().setSourceDomainId(ovfEntityData.getStorageDomainId()); } catch (org.ovirt.engine.core.utils.ovf.OvfReaderException e) { org.ovirt.engine.core.bll.ImportVmTemplateFromConfigurationCommand.log.errorFormat(("failed to parse a given ovf configuration: \n" + (ovfEntityData.getOvfData())), e); } } setVdsGroupId(org.ovirt.engine.core.bll.ImportVmTemplateFromConfigurationCommand.getParameters().getVdsGroupId()); setStoragePoolId(org.ovirt.engine.core.bll.ImportVmTemplateFromConfigurationCommand.getVdsGroup().getStoragePoolId()); }
java.lang.String type();
@java.lang.Override public void onRollback() { macPoolPerCluster.modifyPool(oldMacPool); }
@java.lang.Override public org.ovirt.engine.core.common.AuditLogType getAuditLogTypeValue() { return org.ovirt.engine.core.bll.storage.domain.AddStorageDomainCommand.getSucceeded() ? org.ovirt.engine.core.common.AuditLogType.USER_ADD_STORAGE_DOMAIN : org.ovirt.engine.core.common.AuditLogType.USER_ADD_STORAGE_DOMAIN_FAILED; }
@java.lang.Override public void edit(org.ovirt.engine.ui.uicommonweb.models.storage.ImportCloneModel object) { if ((((org.ovirt.engine.ui.uicommonweb.models.vms.ImportEntityData) (object.getEntity())).getEntity()) instanceof org.ovirt.engine.core.common.businessentities.VM) { dialogLabelEditor.setText(messages.sameVmNameExists(((org.ovirt.engine.ui.uicommonweb.models.vms.ImportVmData) (object.getEntity())).getVm().getName())); cloneEditor.asRadioButton().setHTML(templates.twoLinesRadioButtonLabel(constants.cloneImportVm(), constants.cloneImportVmDetails()).asString()); suffixEditor.setLabel(constants.cloneImportSuffixVm()); } else { dialogLabelEditor.setText(((((constants.sameTemplateNameExists()) + " (") + (((org.ovirt.engine.ui.uicommonweb.models.vms.ImportTemplateData) (object.getEntity())).getTemplate().getname())) + ")")); cloneEditor.setLabel(constants.cloneImportTemplate()); suffixEditor.setLabel(constants.cloneImportSuffixTemplate()); } org.ovirt.engine.ui.webadmin.section.main.view.popup.storage.backup.ImportCloneDialogPopupView.Driver.driver.edit(object); }
protected void executeImport(org.ovirt.engine.ui.uicommonweb.models.vms.ImportVmFromExportDomainModel importVmModel) { importVmModel.importVms(new org.ovirt.engine.ui.uicompat.IFrontendMultipleActionAsyncCallback() { @java.lang.Override public void executed(org.ovirt.engine.ui.uicompat.FrontendMultipleActionAsyncResult result) { setWindow(null); } }, cloneObjectMap); }
private void buildVmUsbControllers() { java.util.List<org.ovirt.engine.core.common.businessentities.VmDevice> vmDevices = vmDeviceDao.getVmDeviceByVmIdTypeAndDevice(vm.getId(), VmDeviceGeneralType.CONTROLLER, VmDeviceType.USB.getName()); for (org.ovirt.engine.core.common.businessentities.VmDevice vmDevice : vmDevices) { java.util.Map<java.lang.String, java.lang.Object> struct = new java.util.HashMap<>(); struct.put(VdsProperties.Type, vmDevice.getType().getValue()); struct.put(VdsProperties.Device, vmDevice.getDevice()); vmInfoBuildUtils.setVdsPropertiesFromSpecParams(vmDevice.getSpecParams(), struct); struct.put(VdsProperties.SpecParams, new java.util.HashMap<java.lang.String, java.lang.Object>()); struct.put(VdsProperties.DeviceId, java.lang.String.valueOf(vmDevice.getId().getDeviceId())); vmInfoBuildUtils.addAddress(vmDevice, struct); java.lang.String model = ((java.lang.String) (struct.get(VdsProperties.Model))); if ((model != null) && (vmInfoBuildUtils.isFirstMasterController(model))) { devices.add(0, struct); } else { devices.add(struct); } } }
private boolean validateAttachment() { final org.ovirt.engine.core.bll.network.cluster.UpdateNetworkClusterValidator networkClusterValidator = createNetworkClusterValidator(); return (validate(networkClusterValidator.managementNetworkUnset())) && (validateAttachment(networkClusterValidator)); }
@java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.frontend.FrontendFailureEventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.frontend.FrontendFailureEventArgs args) { errorPopupManager.show(messages.uiCommonRunActionFailed(org.ovirt.engine.ui.common.uicommon.ErrorMessageFormatter.formatMessages(args.getMessages()))); }
@java.lang.Override public org.ovirt.engine.core.common.AuditLogType getAuditLogTypeValue() { if (!(foundCPU)) { return org.ovirt.engine.core.common.AuditLogType.CPU_TYPE_UNSUPPORTED_IN_THIS_CLUSTER_VERSION; } else if (!(architectureMatch)) { return org.ovirt.engine.core.common.AuditLogType.VDS_ARCHITECTURE_NOT_SUPPORTED_FOR_CLUSTER; } else if (!(_hasFlags)) { return org.ovirt.engine.core.common.AuditLogType.VDS_CPU_RETRIEVE_FAILED; } else { return org.ovirt.engine.core.common.AuditLogType.VDS_CPU_LOWER_THAN_CLUSTER; } }
public static boolean isVmPriorityValueLegal(int value, java.util.List<java.lang.String> reasons) { boolean res = false; if ((value >= 0) && (value <= (org.ovirt.engine.core.common.config.Config.<java.lang.Integer>getValue(ConfigValues.VmPriorityMaxValue)))) { res = true; } else { reasons.add(EngineMessage.VM_OR_TEMPLATE_ILLEGAL_PRIORITY_VALUE.toString()); reasons.add(java.lang.String.format("$MaxValue %1$s", org.ovirt.engine.core.common.config.Config.<java.lang.Integer>getValue(ConfigValues.VmPriorityMaxValue))); } return res; }
private org.ovirt.engine.core.compat.Guid getVdsToRunOn(java.lang.Iterable<org.ovirt.engine.core.common.businessentities.VDS> vdss) { java.lang.StringBuilder sb = new java.lang.StringBuilder(); final java.util.List<org.ovirt.engine.core.common.businessentities.VDS> readyToRun = new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VDS>(); for (org.ovirt.engine.core.common.businessentities.VDS curVds : vdss) { if ((validateHostIsReadyToRun(curVds, sb)) == (ValidationResult.VALID)) { readyToRun.add(curVds); } } if (readyToRun.isEmpty()) { org.ovirt.engine.core.bll.VdsSelector.log.info(sb.toString()); return org.ovirt.engine.core.compat.Guid.Empty; } else { if (org.ovirt.engine.core.bll.VdsSelector.log.isDebugEnabled()) { org.ovirt.engine.core.bll.VdsSelector.log.debug(sb.toString()); } return getBestVdsToRun(readyToRun); } }
@javax.ws.rs.GET @org.jboss.resteasy.annotations.providers.jaxb.Formatted public org.ovirt.engine.api.model.Device get();
@java.lang.Override public void onMouseUp(com.google.gwt.event.dom.client.MouseUpEvent event) { focusHandler.setEnabled(true); }
types.StatisticUnit unit();
@java.lang.Override protected void executeCommand() { org.ovirt.engine.core.compat.Guid taskId = persistAsyncTaskPlaceHolder(VdcActionType.RemoveVmTemplate); org.ovirt.engine.core.common.vdscommands.VDSReturnValue vdsReturnValue = runVdsCommand(VDSCommandType.DeleteImageGroup, org.ovirt.engine.core.bll.storage.PostZeroHandler.fixParametersWithPostZero(new org.ovirt.engine.core.common.vdscommands.DeleteImageGroupVDSCommandParameters(org.ovirt.engine.core.bll.RemoveTemplateSnapshotCommand.getParameters().getStoragePoolId(), org.ovirt.engine.core.bll.RemoveTemplateSnapshotCommand.getParameters().getStorageDomainId(), org.ovirt.engine.core.bll.RemoveTemplateSnapshotCommand.getParameters().getImageGroupID(), org.ovirt.engine.core.bll.RemoveTemplateSnapshotCommand.getParameters().getWipeAfterDelete(), false))); if (vdsReturnValue.getSucceeded()) { org.ovirt.engine.core.bll.RemoveTemplateSnapshotCommand.getReturnValue().getInternalVdsmTaskIdList().add(createTask(taskId, vdsReturnValue.getCreationInfo(), VdcActionType.RemoveVmTemplate, VdcObjectType.Storage, org.ovirt.engine.core.bll.RemoveTemplateSnapshotCommand.getParameters().getStorageDomainId())); org.ovirt.engine.core.bll.RemoveTemplateSnapshotCommand.setSucceeded(true); } }
public void populateDwhOsInfo(java.util.Map<java.lang.Integer, java.lang.String> osIdToName) { new org.springframework.jdbc.core.simple.SimpleJdbcCall(jdbcTemplate).withProcedureName("clear_osinfo").execute(); java.util.List<org.springframework.jdbc.core.namedparam.MapSqlParameterSource> executions = new java.util.ArrayList<org.springframework.jdbc.core.namedparam.MapSqlParameterSource>(); for (java.util.Map.Entry<java.lang.Integer, java.lang.String> e : osIdToName.entrySet()) { executions.add(getCustomMapSqlParameterSource().addValue("os_id", e.getKey()).addValue("os_name", e.getValue())); } getCallsHandler().executeStoredProcAsBatch("insert_osinfo", executions); }
private java.util.function.Predicate<? super org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface> isVnicMigratable(org.ovirt.engine.core.common.businessentities.VM vm) { return ( vnic) -> ((!(vnic.isPassthrough())) || (!(vnic.isPlugged()))) || ((org.ovirt.engine.core.common.FeatureSupported.sriovHotPlugSupported(vm.getClusterCompatibilityVersion())) && (getVnicProfile(vnic).isMigratable())); }
protected void deactivateStorageDomainAfterTaskExecution() { final org.ovirt.engine.core.common.action.StorageDomainPoolParametersBase params = new org.ovirt.engine.core.common.action.StorageDomainPoolParametersBase(org.ovirt.engine.core.bll.storage.DeactivateStorageDomainWithOvfUpdateCommand.getStorageDomainId(), org.ovirt.engine.core.bll.storage.DeactivateStorageDomainWithOvfUpdateCommand.getStoragePoolId()); params.setSkipChecks(true); boolean newThread = ((org.ovirt.engine.core.bll.storage.DeactivateStorageDomainWithOvfUpdateCommand.getStorageDomain().getStorageDomainType()) == (org.ovirt.engine.core.common.businessentities.StorageDomainType.Master)) && ((org.ovirt.engine.core.bll.storage.DeactivateStorageDomainWithOvfUpdateCommand.getNewMaster(false)) == null); if (newThread) { org.ovirt.engine.core.common.businessentities.StoragePoolIsoMap map = loadStoragePoolIsoMap(); final org.ovirt.engine.core.bll.context.CompensationContext ctx = createDefaultCompensationContext(org.ovirt.engine.core.compat.Guid.newGuid()); changeDomainStatusWithCompensation(map, StorageDomainStatus.Unknown, StorageDomainStatus.Locked, ctx); org.ovirt.engine.core.utils.threadpool.ThreadPoolUtil.execute(new java.lang.Runnable() { @java.lang.Override public void run() { try { waitForTasksToBeCleared(); executeDeactivateCommnad(false); ctx.resetCompensation(); } catch (java.lang.Exception e) { setSucceeded(false); log.error("Error when attempting to deactivate storage domain {}", getStorageDomainId(), e); compensate(); } } }); } else { executeDeactivateCommnad(false); } }
@java.lang.Override protected void selectPhysicalDatacenterNetwork() { final org.ovirt.engine.core.common.businessentities.network.Network network = getNetwork(); if ((network.isExternal()) && (network.getProvidedBy().isSetPhysicalNetworkId())) { getDatacenterPhysicalNetwork().getItems().stream().filter(( net) -> java.util.Objects.equals(net.getId(), network.getProvidedBy().getPhysicalNetworkId())).findAny().ifPresent(this.getDatacenterPhysicalNetwork()::setSelectedItem); } }
@java.lang.Override public void validateEnums(org.ovirt.engine.api.model.Host host) { if (host.isSetPowerManagement()) { if (host.getPowerManagement().isSetPmProxies()) { for (org.ovirt.engine.api.model.PmProxy proxy : host.getPowerManagement().getPmProxies().getPmProxy()) { validateEnum(org.ovirt.engine.api.model.PmProxyType.class, proxy.getType(), true); } } } }
public void rollbackQuotaByVmId(org.ovirt.engine.core.compat.Guid vmId) { org.ovirt.engine.core.common.businessentities.VM vm = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVmDao().get(vmId); if (vm != null) { removeQuotaFromCache(vm.getStoragePoolId(), vm.getQuotaId()); } }
@java.lang.Override public void save(T entity) { getEntityManager().merge(entity); }
@java.lang.Override protected void executeCommand() { log.info("Creating ImageTransfer entity for command '{}'", org.ovirt.engine.core.bll.storage.disk.image.TransferImageCommand.getCommandId()); org.ovirt.engine.core.common.businessentities.storage.ImageTransfer entity = new org.ovirt.engine.core.common.businessentities.storage.ImageTransfer(org.ovirt.engine.core.bll.storage.disk.image.TransferImageCommand.getCommandId()); entity.setCommandType(org.ovirt.engine.core.bll.storage.disk.image.TransferImageCommand.getActionType()); entity.setPhase(ImageTransferPhase.INITIALIZING); entity.setLastUpdated(new java.util.Date()); entity.setBytesTotal(org.ovirt.engine.core.bll.storage.disk.image.TransferImageCommand.getParameters().getTransferSize()); imageTransferDao.save(entity); if (isImageProvided()) { handleImageIsReadyForTransfer(org.ovirt.engine.core.bll.storage.disk.image.TransferImageCommand.getParameters().getImageId()); } else { if ((org.ovirt.engine.core.bll.storage.disk.image.TransferImageCommand.getParameters().getTransferType()) == (org.ovirt.engine.core.common.businessentities.storage.TransferType.Download)) { failValidation(EngineMessage.ACTION_TYPE_FAILED_IMAGE_NOT_SPECIFIED_FOR_DOWNLOAD); org.ovirt.engine.core.bll.storage.disk.image.TransferImageCommand.setSucceeded(false); return; } log.info("Creating {} image", getImageType()); createImage(); } setActionReturnValue(org.ovirt.engine.core.bll.storage.disk.image.TransferImageCommand.getCommandId()); org.ovirt.engine.core.bll.storage.disk.image.TransferImageCommand.setSucceeded(true); }
protected void addMoveOrCopyParameters(java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase> parameters, org.ovirt.engine.core.compat.Guid sourceStorageDomainGuid, org.ovirt.engine.core.compat.Guid destStorageDomainGuid, org.ovirt.engine.core.common.businessentities.DiskImage disk) { org.ovirt.engine.core.common.action.MoveOrCopyImageGroupParameters params = createParameters(sourceStorageDomainGuid, destStorageDomainGuid, disk); params.setQuotaId(disk.getQuotaId()); parameters.add(params); }
@java.lang.Override public boolean isUpdateAvailable(final org.ovirt.engine.core.common.businessentities.VDS host) { final java.util.Collection<java.lang.String> packages = org.ovirt.engine.core.common.config.Config.getPackagesForCheckUpdate(); try (final org.ovirt.engine.core.bll.hostdeploy.VdsMgmtPackages hostPackagesManager = createPackagesManager(host, true)) { hostPackagesManager.setPackages(packages); hostPackagesManager.execute(); boolean updatesAvailable = !(hostPackagesManager.getUpdates().isEmpty()); if (updatesAvailable) { org.ovirt.engine.core.bll.host.HostUpgradeManager.log.info("There are available packages ({}) for host '{}'", org.apache.commons.lang.StringUtils.join(hostPackagesManager.getUpdates(), ", "), host.getName()); } return updatesAvailable; } catch (final java.lang.Exception e) { org.ovirt.engine.core.bll.host.HostUpgradeManager.log.error("Failed to refresh host '{}' packages '{}'.", host.getName(), org.apache.commons.lang.StringUtils.join(packages, ", ")); org.ovirt.engine.core.bll.host.HostUpgradeManager.log.error("Exception", e); throw new java.lang.RuntimeException(e.getMessage(), e); } }
private boolean executeSshSoftFencingCommand(java.lang.String version) { boolean result = false; org.ovirt.engine.core.bll.utils.EngineSSHClient sshClient = null; try { sshClient = new org.ovirt.engine.core.bll.utils.EngineSSHClient(); sshClient.setVds(org.ovirt.engine.core.bll.SshSoftFencingCommand.getVds()); sshClient.useDefaultKeyPair(); sshClient.connect(); sshClient.authenticate(); } catch (java.lang.Exception ex) { log.errorFormat("SSH connection to host {0} failed: {1}", org.ovirt.engine.core.bll.SshSoftFencingCommand.getVds().getHostName(), ex); closeSshConnection(sshClient); return result; } java.io.ByteArrayOutputStream cmdOut = new java.io.ByteArrayOutputStream(); java.io.ByteArrayOutputStream cmdErr = new java.io.ByteArrayOutputStream(); try { log.infoFormat("Executing SSH Soft Fencing command on host {0}", org.ovirt.engine.core.bll.SshSoftFencingCommand.getVds().getHostName()); sshClient.executeCommand(org.ovirt.engine.core.common.config.Config.<java.lang.String>GetValue(ConfigValues.SshSoftFencingCommand, version), null, cmdOut, cmdErr); result = true; } catch (java.lang.Exception ex) { log.errorFormat("SSH Soft Fencing command failed on host {0}: {1}\nStdout: {2}\nStderr: {3}\nStacktrace: {4}", org.ovirt.engine.core.bll.SshSoftFencingCommand.getVds().getHostName(), ex.getMessage(), cmdOut.toString(), cmdErr.toString(), ex); } finally { closeSshConnection(sshClient); } return result; }
org.ovirt.engine.core.bll.validator.HostNetworkQosValidator createHostNetworkQosValidator(org.ovirt.engine.core.common.businessentities.network.HostNetworkQos hostNetworkQos) { return new org.ovirt.engine.core.bll.validator.HostNetworkQosValidator(hostNetworkQos); }
private java.util.Set<java.lang.String> getRequiredArgs(java.lang.String action) { java.util.Set<java.lang.String> result = new java.util.LinkedHashSet<>(); if (org.ovirt.engine.core.domains.ManageDomainsArguments.ACTION_ADD.equals(action)) { result.add(org.ovirt.engine.core.domains.ManageDomainsArguments.ARG_DOMAIN); result.add(org.ovirt.engine.core.domains.ManageDomainsArguments.ARG_PROVIDER); result.add(org.ovirt.engine.core.domains.ManageDomainsArguments.ARG_USER); } else if (org.ovirt.engine.core.domains.ManageDomainsArguments.ACTION_EDIT.equals(action)) { result.add(org.ovirt.engine.core.domains.ManageDomainsArguments.ARG_DOMAIN); } else if (org.ovirt.engine.core.domains.ManageDomainsArguments.ACTION_DELETE.equals(action)) { result.add(org.ovirt.engine.core.domains.ManageDomainsArguments.ARG_DOMAIN); } return result; }
org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc glusterVolumeGeoRepResume(java.lang.String volumeName, java.lang.String slaveHostName, java.lang.String slaveVolumeName, boolean force);
protected org.ovirt.engine.core.common.action.CreateAllSnapshotsFromVmParameters getCreateSnapshotParameters() { org.ovirt.engine.core.common.action.CreateAllSnapshotsFromVmParameters params = new org.ovirt.engine.core.common.action.CreateAllSnapshotsFromVmParameters(org.ovirt.engine.core.bll.storage.lsm.LiveMigrateVmDisksCommand.getParameters().getVmId(), "Auto-generated for Live Storage Migration"); params.setParentCommand(VdcActionType.LiveMigrateVmDisks); params.setSnapshotType(SnapshotType.REGULAR); params.setParentParameters(org.ovirt.engine.core.bll.storage.lsm.LiveMigrateVmDisksCommand.getParameters()); params.setImagesParameters(org.ovirt.engine.core.bll.storage.lsm.LiveMigrateVmDisksCommand.getParameters().getImagesParameters()); params.setTaskGroupSuccess(org.ovirt.engine.core.bll.storage.lsm.LiveMigrateVmDisksCommand.getParameters().getTaskGroupSuccess()); params.setDisks(getMovedDisks()); params.setDiskIdsToIgnoreInChecks(getMovedDiskIds()); params.setNeedsLocking(false); params.setEndProcedure(EndProcedure.COMMAND_MANAGED); return params; }
@java.lang.Override protected void executeVdsBrokerCommand() { org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity volume = CreateGlusterVolumeVDSCommand.getParameters().getVolume(); boolean isForce = CreateGlusterVolumeVDSCommand.getParameters().isForce(); boolean supportForceCreateVolume = org.ovirt.engine.core.common.gluster.GlusterFeatureSupported.glusterForceCreateVolumeSupported(CreateGlusterVolumeVDSCommand.getParameters().getClusterVersion()); uuidReturn = (supportForceCreateVolume) ? CreateGlusterVolumeVDSCommand.getBroker().glusterVolumeCreate(volume.getName(), volume.getBrickDirectories().toArray(new java.lang.String[0]), volume.getReplicaCount(), volume.getStripeCount(), getTransportTypeArr(volume), isForce) : CreateGlusterVolumeVDSCommand.getBroker().glusterVolumeCreate(volume.getName(), volume.getBrickDirectories().toArray(new java.lang.String[0]), volume.getReplicaCount(), volume.getStripeCount(), getTransportTypeArr(volume)); CreateGlusterVolumeVDSCommand.proceedProxyReturnValue(); if (CreateGlusterVolumeVDSCommand.getVDSReturnValue().getSucceeded()) { volume.setId(org.ovirt.engine.core.compat.Guid.createGuidFromStringDefaultEmpty(uuidReturn.mUuid)); setReturnValue(volume); } }
private java.util.List<org.ovirt.engine.core.common.businessentities.VDS> searchVDSsByDb() { return genericSearch(org.ovirt.engine.core.bll.SearchQuery.getDbFacade().getVdsDao(), true, new org.ovirt.engine.core.common.utils.ListUtils.Filter<org.ovirt.engine.core.common.businessentities.VDS>() { @java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.VDS> filter(java.util.List<org.ovirt.engine.core.common.businessentities.VDS> data) { for (org.ovirt.engine.core.common.businessentities.VDS vds : data) { vds.setCpuName(getCpuFlagsManagerHandler().findMaxServerCpuByFlags(vds.getCpuFlags(), vds.getVdsGroupCompatibilityVersion())); } return data; } }); }
@java.lang.Override public void eventRaised(org.ovirt.engine.core.compat.Event ev, java.lang.Object sender, org.ovirt.engine.core.compat.EventArgs args) { if ((args instanceof org.ovirt.engine.core.compat.PropertyChangedEventArgs) && (((org.ovirt.engine.core.compat.PropertyChangedEventArgs) (args)).PropertyName.equals(object.ON_DISK_LOAD))) { addStorageQuotaColumn(); diskTable.edit(object.getImportDiskListModel()); if ((customSelectionCellFormatType) != null) { customSelectionCellFormatType.setEnabledWithToolTip(((java.lang.Boolean) (object.getCollapseSnapshots().getEntity())), constants.importAllocationModifiedCollapse()); } if (((object.getDisksToConvert()) != null) && ((object.getDisksToConvert().size()) > 0)) { image.setVisible(true); } } else if ((args instanceof org.ovirt.engine.core.compat.PropertyChangedEventArgs) && (((org.ovirt.engine.core.compat.PropertyChangedEventArgs) (args)).PropertyName.equals("Message"))) { message.setText(object.getMessage()); } }
@java.lang.Override public java.lang.String getMessage() { return java.lang.String.format("%1$s (Failed with error %2$s and code %3$s)", super.getMessage(), privateVdsError.getCode(), privateVdsError.getCode().getValue()); }
org.ovirt.engine.core.vdsbroker.vdsbroker.VolumeInfoReturnForXmlRpc getVolumeInfo(java.lang.String sdUUID, java.lang.String spUUID, java.lang.String imgUUID, java.lang.String volUUID);
@java.lang.Override public org.ovirt.engine.core.vdsbroker.irsbroker.FileStatsReturnForXmlRpc getIsoList(java.lang.String spUUID) { org.ovirt.vdsm.jsonrpc.client.JsonRpcRequest request = new org.ovirt.vdsm.jsonrpc.client.RequestBuilder("StoragePool.getIsoList").withParameter("storagepoolID", spUUID).build(); java.util.Map<java.lang.String, java.lang.Object> response = new org.ovirt.engine.core.vdsbroker.jsonrpc.FutureMap(this.client, request).withResponseKey("isolist").withResponseType(java.lang.Object[].class); return new org.ovirt.engine.core.vdsbroker.irsbroker.FileStatsReturnForXmlRpc(response); }
public org.ovirt.engine.core.common.businessentities.gluster.StorageDevice getCacheDevice() { return cacheDevice; }
@org.junit.Test public void testSeverity() throws java.lang.Exception { java.lang.String expected1 = "test1@example.com"; java.lang.String expected2 = "test2@example.com"; filter.clearFilterEntries(); filter.addFilterEntries(org.ovirt.engine.core.notifier.filter.FirstMatchSimpleFilter.parse(((((((((((("include:*:WARNING(smtp:" + expected1) + ") ") + "exclude:*(smtp:") + expected1) + ")") + "exclude:*:WARNING(smtp:") + expected2) + ") ") + "include:*(smtp:") + expected2) + ")"))); filter.processEvent(new org.ovirt.engine.core.notifier.filter.FirstMatchSimpleFilterTest.E("message1", org.ovirt.engine.core.common.AuditLogSeverity.NORMAL)); filter.processEvent(new org.ovirt.engine.core.notifier.filter.FirstMatchSimpleFilterTest.E("message2", org.ovirt.engine.core.common.AuditLogSeverity.WARNING)); filter.processEvent(new org.ovirt.engine.core.notifier.filter.FirstMatchSimpleFilterTest.E("message3", org.ovirt.engine.core.common.AuditLogSeverity.ERROR)); filter.processEvent(new org.ovirt.engine.core.notifier.filter.FirstMatchSimpleFilterTest.E("message4", org.ovirt.engine.core.common.AuditLogSeverity.ALERT)); org.junit.Assert.assertTrue(smtp.getEvents().contains(("message2-->" + expected1))); org.junit.Assert.assertTrue(smtp.getEvents().contains(("message3-->" + expected1))); org.junit.Assert.assertTrue(smtp.getEvents().contains(("message3-->" + expected2))); org.junit.Assert.assertTrue(smtp.getEvents().contains(("message4-->" + expected1))); org.junit.Assert.assertTrue(smtp.getEvents().contains(("message4-->" + expected2))); org.junit.Assert.assertEquals(5, smtp.getEvents().size()); }
@java.lang.Override public org.ovirt.engine.core.common.businessentities.aaa.DbGroup getByExternalId(java.lang.String domain, java.lang.String externalId) { return getCallsHandler().executeRead("GetGroupByExternalId", org.ovirt.engine.core.dao.DbGroupDaoImpl.DbGroupRowMapper.instance, getCustomMapSqlParameterSource().addValue("domain", domain).addValue("external_id", externalId)); }
private void vmBalloonDriverIsRequestedAndUnavailable(org.ovirt.engine.core.compat.Guid vmId) { java.lang.Integer currentVal = org.ovirt.engine.core.vdsbroker.VdsUpdateRunTimeInfo.vmsWithBalloonDriverProblem.get(vmId); if (currentVal == null) { org.ovirt.engine.core.vdsbroker.VdsUpdateRunTimeInfo.vmsWithBalloonDriverProblem.put(vmId, 1); } else { org.ovirt.engine.core.vdsbroker.VdsUpdateRunTimeInfo.vmsWithBalloonDriverProblem.put(vmId, (currentVal + 1)); if (currentVal >= (org.ovirt.engine.core.common.config.Config.<java.lang.Integer>GetValue(ConfigValues.IterationsWithBalloonProblem))) { org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase auditLogable = new org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase(); auditLogable.setVmId(vmId); org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogDirector.log(auditLogable, AuditLogType.VM_BALLOON_DRIVER_ERROR); org.ovirt.engine.core.vdsbroker.VdsUpdateRunTimeInfo.vmsWithBalloonDriverProblem.put(vmId, 0); } } }
@java.lang.Override protected void executeQueryCommand() { java.util.List<? extends org.ovirt.engine.core.common.businessentities.IVdcQueryable> returnValue = new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.IVdcQueryable>(); switch (org.ovirt.engine.core.bll.SearchQuery.getParameters().getSearchTypeValue()) { case VM : { returnValue = searchVmsFromDb(); break; } case AdGroup : { returnValue = searchAdGroups(); break; } case AdUser : { returnValue = searchAdUsers(); break; } case AuditLog : { returnValue = searchAuditLogEvents(); break; } case DBUser : { returnValue = searchDbUsers(); break; } case VDS : { returnValue = searchVDSsByDb(); break; } case VmTemplate : { returnValue = searchVMTemplates(); break; } case VmPools : { returnValue = searchVmPools(); break; } case Cluster : { returnValue = searchClusters(); break; } case StoragePool : { returnValue = searchStoragePool(); break; } case StorageDomain : { returnValue = searchStorageDomain(); break; } case Quota : { returnValue = searchQuota(); break; } case Disk : { returnValue = searchDisk(); break; } case GlusterVolume : { returnValue = searchGlusterVolumes(); break; } case Network : { returnValue = searchNetworks(); break; } case Provider : { returnValue = searchProviders(); break; } case InstanceType : { returnValue = searchInstanceTypes(); break; } case ImageType : { returnValue = searchVMTemplates(); break; } default : { log.errorFormat("Search object type not handled: {0}", org.ovirt.engine.core.bll.SearchQuery.getParameters().getSearchTypeValue()); break; } } org.ovirt.engine.core.bll.SearchQuery.getQueryReturnValue().setReturnValue(returnValue); }
@java.lang.Override protected void Connect() { if ((getEntity()) != null) { getLogger().Debug("Connecting to Spice console..."); if (!(getspice().getIsInstalled())) { getLogger().Info("Spice client is not installed."); getspice().Install(); return; } if ((getConfigurator().getIsAdmin()) && ((getspice().getCurrentVersion().compareTo(getspice().getDesiredVersion())) < 0)) { getLogger().Info((("Spice client version is not as desired (" + (getspice().getDesiredVersion())) + ")")); getspice().Install(); return; } if ((getEntity().getrun_on_vds()) == null) { return; } if ((!(getEntity().getvm_os().isWindows())) || ((getEntity().getSpiceDriverVersion()) == null)) { getspice().setIsWanOptionsEnabled(false); } SendVmTicket(); } }
public org.ovirt.engine.core.common.businessentities.network.Network getDisplayNetwork(org.ovirt.engine.core.common.businessentities.VM vm) { java.util.List<org.ovirt.engine.core.common.businessentities.network.NetworkCluster> all = networkClusterDao.getAllForCluster(vm.getClusterId()); org.ovirt.engine.core.common.businessentities.network.NetworkCluster networkCluster = null; for (org.ovirt.engine.core.common.businessentities.network.NetworkCluster tempNetworkCluster : all) { if (tempNetworkCluster.isDisplay()) { networkCluster = tempNetworkCluster; break; } } if (networkCluster != null) { java.util.List<org.ovirt.engine.core.common.businessentities.network.Network> allNetworks = networkDao.getAll(); for (org.ovirt.engine.core.common.businessentities.network.Network tempNetwork : allNetworks) { if (tempNetwork.getId().equals(networkCluster.getNetworkId())) { return tempNetwork; } } } return null; }
@java.lang.Override protected void executeCommand() { java.util.List<org.ovirt.engine.core.common.businessentities.VmNumaNode> vmNumaNodes = org.ovirt.engine.core.bll.numa.vm.AddVmNumaNodesCommand.getParameters().getVmNumaNodeList(); vmNumaNodes.stream().forEach(( node) -> node.setId(org.ovirt.engine.core.compat.Guid.newGuid())); vmNumaNodeDao.massSaveNumaNode(vmNumaNodes, org.ovirt.engine.core.bll.numa.vm.AddVmNumaNodesCommand.getVm().getId()); setActionReturnValue(vmNumaNodes.get(0).getId()); org.ovirt.engine.core.bll.numa.vm.AddVmNumaNodesCommand.setSucceeded(true); }
public org.ovirt.engine.core.bll.ValidationResult notIscsiBondNetwork() { java.util.List<org.ovirt.engine.core.common.businessentities.IscsiBond> iscsiBonds = getDbFacade().getIscsiBondDao().getIscsiBondsByNetworkId(network.getId()); if (!(iscsiBonds.isEmpty())) { java.util.Collection<java.lang.String> replaceNameables = org.ovirt.engine.core.utils.ReplacementUtils.replaceWithNameable("IscsiBonds", iscsiBonds); replaceNameables.add(getNetworkNameReplacement()); return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.NETWORK_CANNOT_REMOVE_ISCSI_BOND_NETWORK, replaceNameables); } return org.ovirt.engine.core.bll.ValidationResult.VALID; }
public java.util.Map spmStart(java.lang.String spUUID, java.lang.String prevID, java.lang.String prevLVER, java.lang.String recoveryMode, java.lang.String scsiFencing) { final org.ovirt.vdsmfake.domain.Host host = getActiveHost(); java.util.Map resultMap = getOKStatus(); org.ovirt.vdsmfake.domain.Task task = new org.ovirt.vdsmfake.domain.Task(getUuid()); resultMap.put("uuid", task.getId()); task.setTarget(host); getActiveHost().getRunningTasks().put(task.getId(), task); org.ovirt.vdsmfake.task.TaskProcessor.setTasksMap(host.getName(), task.getId()); org.ovirt.vdsmfake.task.TaskProcessor.getInstance().addTask(new org.ovirt.vdsmfake.task.TaskRequest(org.ovirt.vdsmfake.task.TaskType.FINISH_START_SPM, 10000L, task)); org.ovirt.vdsmfake.domain.VdsmManager.getInstance().setSpmMap(spUUID, host); return resultMap; }
private void onEditSnapshotScheduleInternal() { final org.ovirt.engine.ui.uicommonweb.models.gluster.GlusterVolumeSnapshotModel snapshotModel = ((org.ovirt.engine.ui.uicommonweb.models.gluster.GlusterVolumeSnapshotModel) (getWindow())); if (!(snapshotModel.validate(false))) { return; } setConfirmWindow(null); scheduleSnapshot(snapshotModel, true); }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("For allowing PK authentication, copy the following PK to host under /root/.ssh/authorized_keys") java.lang.String publicKeyUsage();
private void addAffinityLabels() { java.util.List<org.ovirt.engine.core.common.businessentities.Label> affinityLabels = org.ovirt.engine.core.bll.hostdeploy.AddVdsCommand.getParameters().getAffinityLabels(); if (affinityLabels.isEmpty()) { return; } java.util.List<org.ovirt.engine.core.compat.Guid> labelIds = affinityLabels.stream().map(Label::getId).collect(java.util.stream.Collectors.toList()); labelDao.addHostToLabels(org.ovirt.engine.core.bll.hostdeploy.AddVdsCommand.getVdsId(), labelIds); }
@java.lang.Override protected boolean canDoAction() { if ((org.ovirt.engine.core.bll.AddVmToPoolCommand.getVm()) == null) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_VM_NOT_FOUND); } if ((org.ovirt.engine.core.bll.AddVmToPoolCommand.getVm().isRunningOrPaused()) || ((org.ovirt.engine.core.bll.AddVmToPoolCommand.getVm().getStatus()) == (org.ovirt.engine.core.common.businessentities.VMStatus.Unknown))) { return failCanDoAction(EngineMessage.VM_POOL_CANNOT_ADD_RUNNING_VM_TO_POOL); } if ((org.ovirt.engine.core.bll.AddVmToPoolCommand.getVm().getVmPoolId()) != null) { return failCanDoAction(EngineMessage.VM_POOL_CANNOT_ADD_VM_ATTACHED_TO_POOL); } if ((org.ovirt.engine.core.bll.AddVmToPoolCommand.getParameters().getVmPoolId()) != null) { org.ovirt.engine.core.common.businessentities.VmPool pool = org.ovirt.engine.core.bll.AddVmToPoolCommand.getVmPoolDao().get(org.ovirt.engine.core.bll.AddVmToPoolCommand.getParameters().getVmPoolId()); if ((pool != null) && (!(pool.getVdsGroupId().equals(org.ovirt.engine.core.bll.AddVmToPoolCommand.getVm().getVdsGroupId())))) { return failCanDoAction(EngineMessage.VM_POOL_CANNOT_ADD_VM_DIFFERENT_CLUSTER); } } return true; }
private void issueTokenForLoginOnBehalf(javax.servlet.http.HttpServletRequest request, javax.servlet.http.HttpServletResponse response, java.lang.String scope) throws java.lang.Exception { org.ovirt.engine.core.sso.servlets.OAuthTokenServlet.log.debug("Entered issueTokenForLoginOnBehalf"); java.lang.String[] clientIdAndSecret = org.ovirt.engine.core.sso.utils.SSOUtils.getClientIdClientSecret(request); java.lang.String username = org.ovirt.engine.core.sso.utils.SSOUtils.getRequestParameter(request, "username", null); org.ovirt.engine.core.sso.servlets.OAuthTokenServlet.log.debug("Attempting to issueTokenForLoginOnBehalf for client: {}, user: {}", clientIdAndSecret[0], username); org.ovirt.engine.core.sso.utils.AuthenticationUtils.loginOnBehalf(ssoContext, request, username); java.lang.String token = ((java.lang.String) (request.getAttribute(SSOConstants.HTTP_REQ_ATTR_ACCESS_TOKEN))); org.ovirt.engine.core.sso.utils.SSOUtils.validateRequestScope(request, token, scope); org.ovirt.engine.core.sso.utils.SSOSession ssoSession = org.ovirt.engine.core.sso.utils.SSOUtils.getSsoSession(request, token, true); if (ssoSession == null) { throw new org.ovirt.engine.core.sso.utils.OAuthException(org.ovirt.engine.core.sso.utils.SSOConstants.ERR_CODE_INVALID_GRANT, ssoContext.getLocalizationUtils().localize(SSOConstants.APP_ERROR_AUTHORIZATION_GRANT_EXPIRED_FOR_USERNAME_PASSWORD, ((java.util.Locale) (request.getAttribute(SSOConstants.LOCALE))))); } org.ovirt.engine.core.sso.servlets.OAuthTokenServlet.log.debug("Sending json response"); org.ovirt.engine.core.sso.utils.SSOUtils.sendJsonData(response, buildResponse(ssoSession)); }
private void importImages() { @java.lang.SuppressWarnings("unchecked") java.util.ArrayList<org.ovirt.engine.core.common.businessentities.RepoImage> repoImages = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.RepoImage>) (getSelectedItems())); if ((repoImages == null) || ((getWindow()) != null)) { return; } org.ovirt.engine.ui.uicommonweb.models.storage.ImportRepoImageModel model = new org.ovirt.engine.ui.uicommonweb.models.storage.ImportRepoImageModel(); setWindow(model); model.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().importImagesTitle()); model.setHelpTag(HelpTag.import_images); model.setHashName("import_images"); model.setEntity(this); model.init(((org.ovirt.engine.core.common.businessentities.StorageDomain) (getEntity())), repoImages); org.ovirt.engine.ui.uicommonweb.UICommand cancelCommand = new org.ovirt.engine.ui.uicommonweb.UICommand("Cancel", this); cancelCommand.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().cancel()); cancelCommand.setIsCancel(true); model.setCancelCommand(cancelCommand); model.getCommands().add(cancelCommand); }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.VM> getAllForCpuProfiles(java.util.Collection<org.ovirt.engine.core.compat.Guid> cpuProfileIds) { return getCallsHandler().executeReadList("GetVmsByCpuProfileIds", org.ovirt.engine.core.dao.VmDaoImpl.VMRowMapper.instance, getCustomMapSqlParameterSource().addValue("cpu_profile_ids", createArrayOfUUIDs(cpuProfileIds))); }
private boolean validateDevices() { java.util.Set<java.lang.String> devices = org.ovirt.engine.core.bll.storage.domain.ReduceSANStorageDomainDevicesCommand.getParameters().getDevicesToReduce().stream().collect(java.util.stream.Collectors.toSet()); if ((devices.size()) != (org.ovirt.engine.core.bll.storage.domain.ReduceSANStorageDomainDevicesCommand.getParameters().getDevicesToReduce().size())) { return validate(new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_DUPLICATE_DEVICE)); } return (validate(blockSDValidator.lunsInDomain(org.ovirt.engine.core.bll.storage.domain.ReduceSANStorageDomainDevicesCommand.getStorageDomain(), devices))) && (validate(blockSDValidator.lunsEligibleForOperation(org.ovirt.engine.core.bll.storage.domain.ReduceSANStorageDomainDevicesCommand.getStorageDomain(), devices))); }
private static <T extends org.ovirt.engine.core.common.businessentities.Nameable> java.util.List<org.ovirt.engine.core.common.businessentities.ClusterEditWarnings.Warning> getProblematicEntities(org.ovirt.engine.core.common.businessentities.VDSGroup oldCluster, org.ovirt.engine.core.common.businessentities.VDSGroup newCluster, java.lang.Iterable<org.ovirt.engine.core.bll.ClusterEditChecker<T>> checkers, org.ovirt.engine.core.bll.GetClusterEditWarningsQuery.ClusterEntityResolver<T> entityResolver) { java.util.List<org.ovirt.engine.core.common.businessentities.ClusterEditWarnings.Warning> warnings = new java.util.ArrayList<>(); java.util.List<org.ovirt.engine.core.bll.ClusterEditChecker<T>> checks = org.ovirt.engine.core.bll.GetClusterEditWarningsQuery.getApplicableChecks(oldCluster, newCluster, checkers); if (!(checks.isEmpty())) { java.util.List<T> entities = entityResolver.getClusterEntities(oldCluster); for (org.ovirt.engine.core.bll.ClusterEditChecker<T> checker : checks) { org.ovirt.engine.core.common.businessentities.ClusterEditWarnings.Warning warning = new org.ovirt.engine.core.common.businessentities.ClusterEditWarnings.Warning(checker.getMainMessage()); for (T entity : entities) { if (!(checker.check(entity))) { warning.getDetailsByName().put(entity.getName(), checker.getDetailMessage(entity)); } } if (!(warning.isEmpty())) { warnings.add(warning); } } } return warnings; }
public java.util.Map<java.lang.String, java.lang.Object> glusterSnapshotActivate(java.lang.String snapshotName, boolean force);
private org.ovirt.engine.core.bll.ValidationResult vmNotInStatus(org.ovirt.engine.core.compat.Guid vmId, org.ovirt.engine.core.common.businessentities.Snapshot.SnapshotStatus status, org.ovirt.engine.core.common.errors.EngineMessage msg) { if (getSnapshotDao().exists(vmId, status)) { return new org.ovirt.engine.core.bll.ValidationResult(msg); } return org.ovirt.engine.core.bll.ValidationResult.VALID; }
@java.lang.Override public org.ovirt.engine.api.model.Networks list() { org.ovirt.engine.api.model.Networks networks; if (isFiltered()) { networks = mapCollection(getBackendCollection(queryType, getQueryParameters())); } else { networks = mapCollection(getBackendCollection(SearchType.Network)); } for (org.ovirt.engine.api.model.Network network : networks.getNetworks()) { network.setDisplay(null); } return networks; }
@java.lang.Override protected boolean canDoAction() { return ((((validate(networkExists(getRemovedNetwork()))) && (validate(notManagementNetwork()))) && (validate(org.ovirt.engine.core.bll.network.dc.RemoveNetworkCommand.networkNotUsedByVms()))) && (validate(networkNotUsedByTemplates(getRemovedNetwork())))) && (validate(networkNotUsedByHosts(getRemovedNetwork()))); }
@java.lang.Override public int hashCode() { final int prime = 31; int result = 1; result = (prime * result) + ((id) == null ? 0 : id.hashCode()); result = (prime * result) + ((_children) == null ? 0 : _children.hashCode()); result = (prime * result) + ((description) == null ? 0 : description.hashCode()); result = (prime * result) + ((parent) == null ? 0 : parent.hashCode()); result = (prime * result) + ((readonly) == null ? 0 : readonly.hashCode()); result = (prime * result) + ((name) == null ? 0 : name.hashCode()); result = (prime * result) + ((type) == null ? 0 : type.hashCode()); return result; }
@org.junit.Test public void testPersistNetworkAttachmentsCreateNetworkAttachmentWhichWasntYetCreatedForEachNetworkOnReportedNic() { when(networkAttachmentDao.getAllForHost(eq(hostId))).thenReturn(new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.network.NetworkAttachment>()); createPersister(java.util.Collections.<org.ovirt.engine.core.common.businessentities.network.NetworkAttachment>emptyList(), interfaceWithAttachedClusterNetworkA).persistNetworkAttachments(); verify(networkAttachmentDao).getAllForHost(any(org.ovirt.engine.core.compat.Guid.class)); org.mockito.ArgumentCaptor<org.ovirt.engine.core.common.businessentities.network.NetworkAttachment> networkAttachmentCaptor = org.mockito.ArgumentCaptor.forClass(org.ovirt.engine.core.common.businessentities.network.NetworkAttachment.class); verify(networkAttachmentDao).save(networkAttachmentCaptor.capture()); org.ovirt.engine.core.common.businessentities.network.NetworkAttachment attachmentBeingPersisted = networkAttachmentCaptor.getValue(); assertThat(attachmentBeingPersisted.getNetworkId(), is(clusterNetworkA.getId())); assertThat(attachmentBeingPersisted.getNicId(), is(interfaceWithAttachedClusterNetworkA.getId())); assertThat(attachmentBeingPersisted.getId(), notNullValue()); java.util.Map<java.lang.String, java.lang.String> propertiesBeingPersisted = attachmentBeingPersisted.getProperties(); java.util.Map<java.lang.String, java.lang.String> interfaceCustomProperties = interfaceWithAttachedClusterNetworkA.getCustomProperties(); assertCustomProperties(propertiesBeingPersisted, interfaceCustomProperties); assertIpConfiguration(attachmentBeingPersisted.getIpConfiguration()); verifyNoMoreInteractions(networkAttachmentDao); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Number of bricks should be equal to Stripe Count") java.lang.String stripeVolumeAddBricksMsg();
@java.lang.Override public void executeCommand(org.ovirt.engine.ui.uicommonweb.UICommand command) { super.executeCommand(command); if (command == (getNewVmCommand())) { newInternal(); } else if (command == (getCloneVmCommand())) { cloneVm(); } else if (command == (getEditCommand())) { edit(); } else if (command == (getRemoveCommand())) { remove(); } else if (command == (getSaveCommand())) { onSave(); } else if (command == (getRunOnceCommand())) { runOnce(); } else if (command == (getChangeCdCommand())) { changeCD(); } else if (command == (getNewTemplateCommand())) { newTemplate(); } else if ("OnRemove".equals(command.getName())) { onRemove(); } else if ("OnRunOnce".equals(command.getName())) { cancel(); } else if ("OnChangeCD".equals(command.getName())) { onChangeCD(); } else if ("OnNewTemplate".equals(command.getName())) { onNewTemplate(); } else if ("OnSave".equals(command.getName())) { onSave(); } else if (command.getName().equals("closeVncInfo")) { setWindow(null); } else if ("OnClone".equals(command.getName())) { onClone(); } }
public void executeCommand() { if ((org.ovirt.engine.core.bll.MergeExtendCommand.getParameters().getTopImage().getSize()) == (org.ovirt.engine.core.bll.MergeExtendCommand.getParameters().getBaseImage().getSize())) { org.ovirt.engine.core.bll.MergeExtendCommand.log.debug("No image size update required"); org.ovirt.engine.core.bll.MergeExtendCommand.setSucceeded(true); setCommandStatus(CommandStatus.SUCCEEDED); return; } if (isBaseRawBlock()) { extendImageSize(); } else { updateSizeInDb(); setCommandStatus(CommandStatus.SUCCEEDED); } org.ovirt.engine.core.bll.MergeExtendCommand.setSucceeded(true); }
@org.junit.Test public void testUpdateQuota() throws java.lang.Exception { org.ovirt.engine.core.common.businessentities.Quota quotaGeneralToSpecific = dao.getById(FixturesTool.QUOTA_GENERAL); java.lang.String quotaName = "New Temporary name"; java.util.List<org.ovirt.engine.core.common.businessentities.QuotaCluster> quotaClusterList = org.ovirt.engine.core.dao.QuotaDaoTest.getQuotaCluster(org.ovirt.engine.core.dao.QuotaDaoTest.getSpecificQuotaCluster(quotaGeneralToSpecific.getId())); java.lang.Long newStorageLimit = 2345L; assertFalse(quotaName.equals(quotaGeneralToSpecific.getQuotaName())); assertNotEquals(quotaClusterList.size(), quotaGeneralToSpecific.getQuotaClusters().size()); assertFalse(quotaGeneralToSpecific.getGlobalQuotaStorage().getStorageSizeGB().equals(newStorageLimit)); quotaGeneralToSpecific.setQuotaName(quotaName); quotaGeneralToSpecific.getGlobalQuotaStorage().setStorageSizeGB(newStorageLimit); quotaGeneralToSpecific.setQuotaClusters(quotaClusterList); dao.update(quotaGeneralToSpecific); quotaGeneralToSpecific = dao.getById(FixturesTool.QUOTA_GENERAL); assertEquals(quotaName, quotaGeneralToSpecific.getQuotaName()); assertEquals(quotaClusterList.size(), quotaGeneralToSpecific.getQuotaClusters().size()); assertEquals(newStorageLimit, quotaGeneralToSpecific.getGlobalQuotaStorage().getStorageSizeGB()); }
public java.lang.String getIpv6Address() { if (primaryIpv6AddressNotSet()) { return null; } return getIpConfiguration().getIpv6PrimaryAddress().getAddress(); }
@java.lang.Override public void onClick(com.google.gwt.event.dom.client.ClickEvent event) { model.getRemoveNetworkCommand().execute(); }
public void setVds(org.ovirt.engine.core.common.businessentities.VDS value) { vds = value; }
protected java.util.List<org.ovirt.engine.core.common.businessentities.StorageDomain> filterStorageDomains(java.util.List<org.ovirt.engine.core.common.businessentities.StorageDomain> domainsInPool, java.util.List<org.ovirt.engine.core.common.businessentities.storage.DiskImage> disksList) { for (org.ovirt.engine.core.bll.memory.sdfilters.StorageDomainFilter storageDomainFilter : getStorageDomainFilters()) { domainsInPool = storageDomainFilter.filterStorageDomains(domainsInPool, disksList); } return domainsInPool; }
@java.lang.Override public boolean equals(java.lang.Object obj) { if ((this) == obj) { return true; } if (obj == null) { return false; } if ((getClass()) != (obj.getClass())) { return false; } org.ovirt.engine.core.common.businessentities.network.NetworkCluster other = ((org.ovirt.engine.core.common.businessentities.network.NetworkCluster) (obj)); if ((display) != (other.display)) { return false; } if ((status) == null) { if ((other.status) != null) { return false; } } else if (!(status.equals(other.status))) { return false; } if ((id) == null) { if ((other.id) != null) { return false; } } else if (!(id.equals(other.id))) { return false; } if ((required) != (other.required)) { return false; } if ((migration) != (other.migration)) { return false; } if ((management) != (other.management)) { return false; } if ((gluster) != (other.gluster)) { return false; } return true; }
@org.junit.Before public void setUp() throws java.lang.Exception { mockService = mock(org.ovirt.engine.ui.frontend.gwtservices.GenericApiGWTServiceAsync.class, withSettings().extraInterfaces(com.google.gwt.user.client.rpc.ServiceDefTarget.class)); fakeScheduler = new org.ovirt.engine.ui.frontend.FakeGWTScheduler(); org.ovirt.engine.ui.frontend.communication.XsrfRpcRequestBuilder mockXsrfRpcRequestBuilder = new org.ovirt.engine.ui.frontend.communication.XsrfRpcRequestBuilder(); org.ovirt.engine.ui.frontend.communication.CommunicationProvider communicationsProvider = new org.ovirt.engine.ui.frontend.communication.GWTRPCCommunicationProvider(mockService, mockXsrfService, mockXsrfRpcRequestBuilder); mockXsrfRpcRequestBuilder.setXsrfToken(new com.google.gwt.user.client.rpc.XsrfToken("Something")); org.ovirt.engine.ui.frontend.communication.OperationProcessor operationProcessor = new org.ovirt.engine.ui.frontend.communication.OperationProcessor(communicationsProvider); operationProcessor.setScheduler(fakeScheduler); org.ovirt.engine.ui.frontend.communication.VdcOperationManager operationsManager = new org.ovirt.engine.ui.frontend.communication.VdcOperationManager(operationProcessor); operationsManager.setLoggedIn(true); frontend = new org.ovirt.engine.ui.frontend.Frontend(operationsManager, mockCanDoActionErrorsTranslator, mockVdsmErrorsTranslator, mockEventBus); frontend.setEventsHandler(mockEventsHandler); frontend.setConstants(mockConstants); frontend.frontendFailureEvent = mockFrontendFailureEvent; frontend.setLoginHandler(mockLoginHandler); when(mockAsyncQuery.getDel()).thenReturn(mockAsyncCallback); when(mockConstants.noCanDoActionMessage()).thenReturn(org.ovirt.engine.ui.frontend.FrontendActionTest.NO_MESSAGE); }
@java.lang.Override protected void executeCommand() { if ((org.ovirt.engine.core.bll.UpdateVmTemplateCommand.getVmTemplate().getTemplateType()) != (org.ovirt.engine.core.common.businessentities.VmEntityType.INSTANCE_TYPE)) { org.ovirt.engine.core.bll.VmHandler.warnMemorySizeLegal(org.ovirt.engine.core.bll.UpdateVmTemplateCommand.getParameters().getVmTemplateData(), org.ovirt.engine.core.bll.UpdateVmTemplateCommand.getVdsGroup().getcompatibility_version()); } org.ovirt.engine.core.bll.UpdateVmTemplateCommand.getVmStaticDAO().incrementDbGeneration(org.ovirt.engine.core.bll.UpdateVmTemplateCommand.getVmTemplate().getId()); updateOriginalTemplateNameOnDerivedVms(); UpdateVmTemplate(); updateWatchdog(org.ovirt.engine.core.bll.UpdateVmTemplateCommand.getParameters().getVmTemplateData().getId()); updateRngDevice(org.ovirt.engine.core.bll.UpdateVmTemplateCommand.getParameters().getVmTemplateData().getId()); updateGraphicsDevice(); checkTrustedService(); updateVmsOfInstanceType(); org.ovirt.engine.core.bll.UpdateVmTemplateCommand.setSucceeded(true); }
@org.ovirt.engine.api.restapi.types.Mapping(from = org.ovirt.engine.api.model.Snapshot.class, to = org.ovirt.engine.api.model.Snapshot.class) public static org.ovirt.engine.api.model.Snapshot map(org.ovirt.engine.core.common.businessentities.Snapshot entity, org.ovirt.engine.api.model.Snapshot template) { org.ovirt.engine.api.model.Snapshot model = (template != null) ? template : new org.ovirt.engine.api.model.Snapshot(); model.setId(entity.getId().toString()); if ((entity.getDescription()) != null) { model.setDescription(entity.getDescription()); } if ((entity.getCreationDate()) != null) { model.setDate(org.ovirt.engine.api.restapi.types.DateMapper.map(entity.getCreationDate(), null)); } if ((entity.getStatus()) != null) { model.setSnapshotStatus(org.ovirt.engine.api.restapi.types.SnapshotMapper.map(entity.getStatus(), null)); } if ((entity.getType()) != null) { model.setSnapshotType(org.ovirt.engine.api.restapi.types.SnapshotMapper.map(entity.getType(), null)); } model.setPersistMemorystate(entity.containsMemory()); return model; }
public java.lang.Integer getVmMigrating() { return vdsDynamic.getVmMigrating(); }
<T extends org.ovirt.engine.core.common.businessentities.BusinessEntity<org.ovirt.engine.core.compat.Guid>> java.util.Map<org.ovirt.engine.core.compat.Guid, T> loadEntities(java.lang.Class<T> type, java.lang.String fixtureName, java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.businessentities.BusinessEntity<org.ovirt.engine.core.compat.Guid>> cache) throws java.io.IOException, java.lang.IllegalAccessException, java.lang.InstantiationException, java.lang.NoSuchFieldException, java.lang.NoSuchMethodException, java.lang.reflect.InvocationTargetException, java.text.ParseException { java.util.Map<org.ovirt.engine.core.compat.Guid, T> entities = new java.util.HashMap<>(); java.io.InputStream inputStream = getClass().getResourceAsStream(("/scheduling/" + fixtureName)); try (java.io.BufferedReader bufferedReader = new java.io.BufferedReader(new java.io.InputStreamReader(inputStream))) { java.lang.String header = bufferedReader.readLine(); java.lang.String[] fields = header.split(","); java.lang.String line = bufferedReader.readLine(); while (line != null) { T entity = type.newInstance(); java.lang.String[] values = line.split(","); for (int i = 0; i < (java.lang.Math.min(values.length, fields.length)); i++) { java.lang.String value = values[i].trim(); if (value.isEmpty()) { continue; } setField(entity, fields[i], value, cache); } entities.put(entity.getId(), entity); cache.put(entity.getId(), entity); line = bufferedReader.readLine(); } return entities; } }
@java.lang.Override public java.util.List<org.ovirt.engine.core.bll.utils.PermissionSubject> getPermissionCheckSubjects() { java.util.List<org.ovirt.engine.core.bll.utils.PermissionSubject> listPermissionSubjects = new java.util.ArrayList<>(); if (org.ovirt.engine.core.bll.storage.disk.image.TransferDiskImageCommand.isImageProvided()) { listPermissionSubjects.add(new org.ovirt.engine.core.bll.utils.PermissionSubject(org.ovirt.engine.core.bll.storage.disk.image.TransferDiskImageCommand.getParameters().getImageGroupID(), org.ovirt.engine.core.common.VdcObjectType.Disk, org.ovirt.engine.core.common.businessentities.ActionGroup.EDIT_DISK_PROPERTIES)); } else { listPermissionSubjects.add(new org.ovirt.engine.core.bll.utils.PermissionSubject(org.ovirt.engine.core.bll.storage.disk.image.TransferDiskImageCommand.getParameters().getStorageDomainId(), org.ovirt.engine.core.common.VdcObjectType.Storage, org.ovirt.engine.core.common.businessentities.ActionGroup.CREATE_DISK)); } return listPermissionSubjects; }
private org.ovirt.engine.core.common.businessentities.StoragePool fetchStoragePool(org.ovirt.engine.core.compat.Guid storagePoolId) { return storagePoolDao.get(storagePoolId); }
@java.lang.Override protected boolean canDoAction() { boolean autheticated = super.canDoAction(); if (autheticated) { autheticated = org.ovirt.engine.core.bll.aaa.LoginAdminUserCommand.getCurrentUser().isAdmin(); if (!autheticated) { addCanDoActionMessage(VdcBllMessages.USER_NOT_AUTHORIZED_TO_PERFORM_ACTION); org.ovirt.engine.core.bll.aaa.LoginAdminUserCommand.logAutheticationFailure(); } } return autheticated; }
private java.util.List<org.ovirt.engine.core.common.businessentities.network.ExternalSubnet> getSubnets() { return subnets; }
private org.springframework.jdbc.core.namedparam.MapSqlParameterSource getInsertOrUpdateParams(final org.ovirt.engine.core.common.businessentities.VdsStatic vds) { return getCustomMapSqlParameterSource().addValue("host_name", vds.gethost_name()).addValue("ip", vds.getManagmentIp()).addValue("vds_unique_id", vds.getUniqueID()).addValue("port", vds.getport()).addValue("vds_group_id", vds.getvds_group_id()).addValue("vds_id", vds.getId()).addValue("vds_name", vds.getvds_name()).addValue("server_SSL_enabled", vds.getserver_SSL_enabled()).addValue("vds_type", vds.getvds_type()).addValue("vds_strength", vds.getvds_strength()).addValue("pm_type", vds.getpm_type()).addValue("pm_user", vds.getpm_user()).addValue("pm_password", org.ovirt.engine.core.dao.VdsStaticDAODbFacadeImpl.encryptPassword(vds.getpm_password())).addValue("pm_port", vds.getpm_port()).addValue("pm_options", vds.getpm_options()).addValue("pm_enabled", vds.getpm_enabled()).addValue("otp_validity", vds.getOtpValidity()).addValue("vds_spm_priority", vds.getVdsSpmPriority()).addValue("sshKeyFingerprint", vds.getSSHKeyFingerprint()); }
@java.lang.Override protected void executeQueryCommand() { java.util.List<org.ovirt.engine.core.common.businessentities.OvfEntityData> entityList = getOvfEntityList(VmEntityType.VM); java.util.List<org.ovirt.engine.core.common.businessentities.VM> vmList = new java.util.ArrayList<>(); org.ovirt.engine.core.bll.OvfHelper ovfHelper = org.ovirt.engine.core.bll.GetUnregisteredVmsQuery.getOvfHelper(); for (org.ovirt.engine.core.common.businessentities.OvfEntityData ovf : entityList) { try { org.ovirt.engine.core.common.businessentities.VM vm = ovfHelper.readVmFromOvf(ovf.getOvfData()); vm.setVdsGroupCompatibilityVersion(ovf.getLowestCompVersion()); vm.setClusterArch(ovf.getArchitecture()); vmList.add(vm); } catch (org.ovirt.engine.core.utils.ovf.OvfReaderException e) { log.debug(("failed to parse a given ovf configuration: \n" + (ovf.getOvfData())), e); org.ovirt.engine.core.bll.GetUnregisteredVmsQuery.getQueryReturnValue().setExceptionString(("failed to parse a given ovf configuration " + (e.getMessage()))); } } org.ovirt.engine.core.bll.GetUnregisteredVmsQuery.getQueryReturnValue().setSucceeded(true); org.ovirt.engine.core.bll.GetUnregisteredVmsQuery.getQueryReturnValue().setReturnValue(vmList); }
private org.ovirt.engine.core.common.businessentities.VmTemplate createLatestTemplate(org.ovirt.engine.core.common.businessentities.VmTemplate template) { org.ovirt.engine.core.common.businessentities.VmTemplate latestTemplate = new org.ovirt.engine.core.common.businessentities.VmTemplate(template); latestTemplate.setTemplateVersionName(constants.latestTemplateVersionName()); latestTemplate.setDescription(constants.latestTemplateVersionDescription()); return latestTemplate; }
private java.lang.String generateDomainXml() { org.ovirt.engine.core.common.businessentities.network.VmNic nic = org.ovirt.engine.core.vdsbroker.vdsbroker.HotPlugOrUnplugNicVDSCommand.getParameters().getNic(); org.ovirt.engine.core.common.businessentities.VmDevice vmDevice = org.ovirt.engine.core.vdsbroker.vdsbroker.HotPlugOrUnplugNicVDSCommand.getParameters().getVmDevice(); org.ovirt.engine.core.vdsbroker.builder.vminfo.LibvirtVmXmlBuilder builder = new org.ovirt.engine.core.vdsbroker.builder.vminfo.LibvirtVmXmlBuilder(org.ovirt.engine.core.vdsbroker.vdsbroker.HotPlugOrUnplugNicVDSCommand.getParameters().getVm(), org.ovirt.engine.core.vdsbroker.vdsbroker.HotPlugOrUnplugNicVDSCommand.getVds().getId(), nic, vmDevice, vmInfoBuildUtils, (nic.isPassthrough() ? java.util.Collections.singletonMap(nic.getId(), vmDevice.getHostDevice()) : java.util.Collections.emptyMap())); java.lang.String libvirtXml = builder.buildHotplugNic(); java.lang.String prettyLibvirtXml = org.ovirt.engine.core.utils.XmlUtils.prettify(libvirtXml); if (prettyLibvirtXml != null) { log.info("NIC hot-set: {}", prettyLibvirtXml); } return libvirtXml; }
@org.junit.Test public void shouldDetectNonMigratableVMs() { invalidVM.setMigrationSupport(org.ovirt.engine.core.bll.validator.PINNED_TO_HOST); assertThat(validator.checkVmReadyForUpgrade(invalidVM), hasItem(UPGRADE_ERROR.VM_NOT_MIGRATABLE)); }
@java.lang.Override public void massRemoveNumaNodeByNumaNodeId(java.util.List<org.ovirt.engine.core.compat.Guid> numaNodeIds) { java.util.List<org.springframework.jdbc.core.namedparam.MapSqlParameterSource> executions = new java.util.ArrayList(numaNodeIds.size()); for (org.ovirt.engine.core.compat.Guid id : numaNodeIds) { executions.add(getCustomMapSqlParameterSource().addValue("numa_node_id", id)); } getCallsHandler().executeStoredProcAsBatch("DeleteNumaNode", executions); }
public boolean add(org.ovirt.engine.core.common.businessentities.VmNetworkInterface iface, org.ovirt.engine.core.bll.context.CompensationContext compensationContext, boolean allocateMac) { boolean macAdded = false; if (allocateMac) { iface.setMacAddress(getMacPoolManager().allocateNewMac()); macAdded = true; } else if (getMacPoolManager().IsMacInUse(iface.getMacAddress())) { org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase logable = new org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase(); logable.AddCustomValue("MACAddr", iface.getMacAddress()); logable.AddCustomValue("VmName", iface.getVmName()); log(logable, AuditLogType.MAC_ADDRESS_IS_IN_USE); } else { macAdded = getMacPoolManager().AddMac(iface.getMacAddress()); } getVmNetworkInterfaceDAO().save(iface); getVmNetworkStatisticsDAO().save(iface.getStatistics()); compensationContext.snapshotNewEntity(iface); compensationContext.snapshotNewEntity(iface.getStatistics()); return macAdded; }
@java.lang.Override public boolean match(org.ovirt.engine.core.common.action.VdcReturnValueBase source) { return source.isValid(); }
@java.lang.Override protected void setActionMessageParameters() { addCanDoActionMessage(EngineMessage.VAR__ACTION__ATTACH_ACTION_TO); addCanDoActionMessage(EngineMessage.VAR__TYPE__VM_DISK); }
private void refreshServerData(org.ovirt.engine.core.common.businessentities.VDSGroup cluster, org.ovirt.engine.core.common.businessentities.VDS upServer, java.util.List<org.ovirt.engine.core.common.businessentities.VDS> existingServers) { if (cluster.supportsVirtService()) { log.debugFormat("As cluster {0} supports virt service as well, it's servers will not be synced with glusterfs", cluster.getName()); return; } acquireLock(cluster.getId()); try { java.util.List<org.ovirt.engine.core.common.businessentities.gluster.GlusterServerInfo> fetchedServers = fetchServers(cluster, upServer, existingServers); if (fetchedServers != null) { removeDetachedServers(existingServers, fetchedServers); } } catch (java.lang.Exception e) { log.errorFormat("Error while refreshing server data for cluster {0} from database!", cluster.getName(), e); } finally { releaseLock(cluster.getId()); } }
protected void updateIteration() { refreshIteration = (++(refreshIteration)) % (org.ovirt.engine.core.vdsbroker.PollVMStatsRefresher.NUMBER_VMS_REFRESHES_BEFORE_SAVE); }
@java.lang.Override public org.ovirt.engine.core.authentication.DirectoryUser findUser(java.lang.String name) { org.ovirt.engine.core.common.utils.ExternalId id = null; try { id = new org.ovirt.engine.core.common.utils.ExternalId(name.getBytes("UTF-8")); } catch (java.io.UnsupportedEncodingException e) { return null; } return new org.ovirt.engine.core.authentication.DirectoryUser(this, id, name); }
@org.junit.Test public void onlyOutboundPeakPresent() { qos.setOutboundPeak(org.ovirt.engine.core.bll.validator.NetworkQosValidatorTest.BANDWIDTH_MEDIUM); valuesPresentTest(org.ovirt.engine.core.bll.validator.ValidationResultMatchers.failsWith(EngineMessage.ACTION_TYPE_FAILED_NETWORK_QOS_MISSING_VALUES)); }
private org.ovirt.engine.core.common.businessentities.CommandEntity buildCommandEntity(org.ovirt.engine.core.compat.Guid rootCommandId, boolean enableCallback) { return org.ovirt.engine.core.common.businessentities.CommandEntity.buildCommandEntity(org.ovirt.engine.core.bll.CommandBase.getUserId(), getSessionSeqId(), getCommandId(), ((getParameters().getParentParameters()) == null ? org.ovirt.engine.core.compat.Guid.Empty : getParameters().getParentParameters().getCommandId()), rootCommandId, (((getExecutionContext()) == null) || ((getExecutionContext().getJob()) == null) ? org.ovirt.engine.core.compat.Guid.Empty : getExecutionContext().getJob().getId()), (((getExecutionContext()) == null) || ((getExecutionContext().getStep()) == null) ? org.ovirt.engine.core.compat.Guid.Empty : getExecutionContext().getStep().getId()), getActionType(), getParameters(), commandStatus, enableCallback, getReturnValue(), getCommandData()); }
@java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { java.lang.String selectedCluster = getSlaveClusters().getSelectedItem(); java.util.List<org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity> volumesInCurrentCluster = new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity>(); if (selectedCluster != null) { volumesInCurrentCluster = getVolumesInCluster(selectedCluster, getVolumeList()); } if ((volumesInCurrentCluster.size()) > 0) { getSlaveVolumes().setItems(volumesInCurrentCluster, volumesInCurrentCluster.get(0)); } else { getSlaveVolumes().setItems(volumesInCurrentCluster); } }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.Permissions> getAllForEntity(org.ovirt.engine.core.compat.Guid id, long engineSessionId, boolean isFiltered) { return getAllForEntity(id, engineSessionId, isFiltered, false); }
public static void initOsNames() { org.ovirt.engine.ui.frontend.AsyncQuery callback = new org.ovirt.engine.ui.frontend.AsyncQuery(); callback.asyncCallback = new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.osNames = ((java.util.HashMap<java.lang.Integer, java.lang.String>) (((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (returnValue)).getReturnValue())); org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.initOsIds(); } }; org.ovirt.engine.ui.frontend.Frontend.RunQuery(VdcQueryType.OsRepository, new org.ovirt.engine.core.common.queries.OsQueryParameters(OsRepositoryVerb.GetOsNames), callback); }
@javax.ws.rs.Path("{action: (?:resetemulatedmachine)}/{oid}") public org.ovirt.engine.api.v3.servers.V3ActionServer getActionResource(@javax.ws.rs.PathParam("action") java.lang.String action, @javax.ws.rs.PathParam("oid") java.lang.String oid) { return new org.ovirt.engine.api.v3.servers.V3ActionServer(getDelegate().getActionResource(action, oid)); }
@java.lang.Override protected boolean canDoAction() { return validate(org.ovirt.engine.core.bll.validator.storage.StorageServerConnectionExtensionValidator.isConnectionExtensionExists(org.ovirt.engine.core.bll.storage.UpdateStorageServerConnectionExtensionCommand.getParameters().getStorageServerConnectionExtension().getId())); }
public boolean isActionSignature(org.ovirt.api.metamodel.concepts.Method method) { return (((method.getBase()) != null) && (!(method.getBase().getName().equals(org.ovirt.api.metamodel.tool.util.JaxrsGeneratorUtils.ADD)))) && (!(method.getBase().getName().equals(org.ovirt.api.metamodel.tool.util.JaxrsGeneratorUtils.UPDATE))); }
@org.junit.Test public void testIsDomainExistAndActiveDomainNotUp() { domain.setStatus(StorageDomainStatus.Inactive); assertEquals("Wrong failure for inactive domain", EngineMessage.ACTION_TYPE_FAILED_STORAGE_DOMAIN_STATUS_ILLEGAL2, validator.isDomainExistAndActive().getMessage()); }
@java.lang.Override public void OnSuccess(java.lang.Object target, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.models.pools.PoolListModel model = ((org.ovirt.engine.ui.uicommonweb.models.pools.PoolListModel) (target)); if (returnValue != null) { model.setCustomPropertiesKeysList(((java.util.HashMap<org.ovirt.engine.core.compat.Version, java.util.ArrayList<java.lang.String>>) (returnValue))); } }
protected void setDefaultSelectedProtocol() { java.util.List<org.ovirt.engine.ui.uicommonweb.models.ConsoleProtocol> allProtocols = org.ovirt.engine.ui.uicommonweb.models.ConsoleProtocol.getProtocolsByPriority(); java.util.Collections.reverse(allProtocols); if ((selectedProtocol) != null) { allProtocols.remove(selectedProtocol); allProtocols.add(0, selectedProtocol); } for (org.ovirt.engine.ui.uicommonweb.models.ConsoleProtocol protocol : allProtocols) { if (canSelectProtocol(protocol)) { selectProtocol(protocol); break; } } }
@java.lang.Override public org.ovirt.engine.api.resource.externalhostproviders.KatelloErrataResource getKatelloErrataResource() { return inject(new org.ovirt.engine.api.restapi.resource.externalhostproviders.BackendVmKatelloErrataResource(id)); }
protected java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StorageDomain> filterValidStoragesForDisk(java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StorageDomain> storageDomains, org.ovirt.engine.core.common.businessentities.DiskImage diskImage) { java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StorageDomain> storages = new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StorageDomain>(); for (org.ovirt.engine.core.common.businessentities.StorageDomain storage : storageDomains) { if (isDiskValidForStorage(diskImage, storage)) { storages.add(storage); } } return storages; }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("Providers") java.lang.String providerMainTabLabel();
@java.lang.Override protected boolean isGhost(org.ovirt.engine.ui.uicommonweb.models.macpool.MacRangeModel value) { return (org.ovirt.engine.core.compat.StringHelper.isNullOrEmpty(value.getLeftBound().getEntity())) || (org.ovirt.engine.core.compat.StringHelper.isNullOrEmpty(value.getRightBound().getEntity())); }
@java.lang.Override public org.ovirt.engine.core.common.businessentities.network.NetworkCluster mapRow(java.sql.ResultSet rs, int rowNum) throws java.sql.SQLException { org.ovirt.engine.core.common.businessentities.network.NetworkCluster entity = new org.ovirt.engine.core.common.businessentities.network.NetworkCluster(); entity.setClusterId(getGuidDefaultEmpty(rs, "cluster_id")); entity.setNetworkId(getGuidDefaultEmpty(rs, "network_id")); entity.setStatus(org.ovirt.engine.core.common.businessentities.network.NetworkStatus.forValue(rs.getInt("status"))); entity.setDisplay(rs.getBoolean("is_display")); entity.setRequired(rs.getBoolean("required")); entity.setMigration(rs.getBoolean("migration")); entity.setManagement(rs.getBoolean("management")); entity.setGluster(rs.getBoolean("is_gluster")); return entity; }
@java.lang.Override protected void executeQueryCommand() { java.util.List<org.ovirt.engine.core.common.businessentities.VmTemplate> returnValue = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVmTemplateDao().getAllForStorageDomain(org.ovirt.engine.core.bll.GetVmTemplatesFromStorageDomainQuery.getParameters().getStorageDomainId(), org.ovirt.engine.core.bll.GetVmTemplatesFromStorageDomainQuery.getUserID(), org.ovirt.engine.core.bll.GetVmTemplatesFromStorageDomainQuery.getParameters().isFiltered()); for (org.ovirt.engine.core.common.businessentities.VmTemplate template : returnValue) { org.ovirt.engine.core.bll.VmTemplateHandler.UpdateDisksFromDb(template); java.util.Collections.sort(template.getDiskList(), new org.ovirt.engine.core.common.businessentities.comparators.ImagesComparerByName()); } java.util.Collections.sort(returnValue, java.util.Collections.reverseOrder(new org.ovirt.engine.core.common.businessentities.comparators.VmTemplateComparerByDiskSize())); org.ovirt.engine.core.bll.GetVmTemplatesFromStorageDomainQuery.getQueryReturnValue().setReturnValue(returnValue); }
private void updateAllClustersMacPool() { final org.ovirt.engine.core.compat.Guid newMacPoolId = org.ovirt.engine.core.bll.storage.pool.UpdateStoragePoolCommand.getParameters().getStoragePool().getMacPoolId(); final boolean shouldSetNewMacPoolOnAllClusters = newMacPoolId != null; if (shouldSetNewMacPoolOnAllClusters) { java.util.List<org.ovirt.engine.core.common.businessentities.Cluster> clusters = clusterDao.getAllForStoragePool(org.ovirt.engine.core.bll.storage.pool.UpdateStoragePoolCommand.getStoragePoolId()); for (org.ovirt.engine.core.common.businessentities.Cluster cluster : clusters) { moveMacs.updateClusterAndMoveMacs(cluster, newMacPoolId, org.ovirt.engine.core.bll.storage.pool.UpdateStoragePoolCommand.getContext()); } } }
private boolean connectStorageServer(org.ovirt.engine.core.common.businessentities.StorageType type, java.util.List<org.ovirt.engine.core.common.businessentities.StorageServerConnections> connections) { boolean connectSucceeded = true; if ((connections != null) && ((connections.size()) > 0)) { java.util.Map<java.lang.String, java.lang.String> retValues = ((java.util.HashMap<java.lang.String, java.lang.String>) (org.ovirt.engine.core.bll.Backend.getInstance().getResourceManager().RunVdsCommand(VDSCommandType.ConnectStorageServer, new org.ovirt.engine.core.common.vdscommands.ConnectStorageServerVDSCommandParameters(getVds().getId(), getStoragePool().getId(), type, connections)).getReturnValue())); connectSucceeded = org.ovirt.engine.core.bll.storage.StorageHelperDirector.getInstance().getItem(type).isConnectSucceeded(retValues, connections); log.infoFormat("Host {0} storage connection was {1} ", getVds().getName(), (connectSucceeded ? "succeeded" : "failed")); } return connectSucceeded; }
private org.ovirt.engine.core.common.vdscommands.VDSFenceReturnValue fence(org.ovirt.engine.core.common.businessentities.FenceAgent fenceAgent, int retries) { org.ovirt.engine.core.common.vdscommands.VDSFenceReturnValue fenceExecutionResult = fenceExecutor.fence(getAction(), fenceAgent); if (wasSkippedDueToStatus(fenceExecutionResult)) { log.info("Attemp to {} host using fence agent '{}' skipped, host is already at the requested state.", getAction().name().toLowerCase(), fenceAgent.getId()); } else if (wasSkippedDueToPolicy(fenceExecutionResult)) { return fenceExecutionResult; } else { if (fenceExecutionResult.getSucceeded()) { boolean requiredStatusAchieved = waitForStatus(); int i = 0; while ((!requiredStatusAchieved) && (i < retries)) { fenceExecutionResult = fenceExecutor.fence(getAction(), fenceAgent); requiredStatusAchieved = waitForStatus(); i++; } if (requiredStatusAchieved) { handleSpecificCommandActions(); } else { auditFailure(); } fenceExecutionResult.setSucceeded(requiredStatusAchieved); } else { logAgentFailure(fenceExecutionResult); } } return fenceExecutionResult; }
public boolean validate() { if (getIsAvailable()) { getPluginType().validateSelectedItem(new org.ovirt.engine.ui.uicommonweb.validation.IValidation[]{ new org.ovirt.engine.ui.uicommonweb.validation.NotEmptyValidation() }); getInterfaceMappings().validateEntity(new org.ovirt.engine.ui.uicommonweb.validation.IValidation[]{ new org.ovirt.engine.ui.uicommonweb.validation.InterfaceMappingsValidation() }); getQpidHost().validateEntity(new org.ovirt.engine.ui.uicommonweb.validation.IValidation[]{ new org.ovirt.engine.ui.uicommonweb.validation.HostAddressValidation(true) }); getQpidPort().validateEntity(new org.ovirt.engine.ui.uicommonweb.validation.IValidation[]{ new org.ovirt.engine.ui.uicommonweb.validation.IntegerValidation(org.ovirt.engine.core.common.businessentities.BusinessEntitiesDefinitions.NETWORK_MIN_LEGAL_PORT, org.ovirt.engine.core.common.businessentities.BusinessEntitiesDefinitions.NETWORK_MAX_LEGAL_PORT) }); setIsValid(((((getPluginType().getIsValid()) && (getInterfaceMappings().getIsValid())) && (getQpidHost().getIsValid())) && (getQpidPort().getIsValid()))); } return getIsValid(); }
public boolean isEmpty() { return hostNetworkQosProperties.isEmpty(); }
private java.lang.String showSpiceConsole(org.ovirt.engine.ui.uicommonweb.models.HasConsoleModel model) { if (consoleUtils.canOpenSpiceConsole(model)) { model.getDefaultConsoleModel().getConnectCommand().Execute(); } else if (!(consoleUtils.isSpiceAvailable())) { return createErrorMessage(model, "SPICE"); } return null; }
private void addQuotaToMemoryQuotaList(org.ovirt.engine.core.common.businessentities.QuotaUsagePerUser quotaPerUserUsageEntity) { org.ovirt.engine.ui.userportal.widget.QuotaProgressBar memoryQuotaProgressBar = new org.ovirt.engine.ui.userportal.widget.QuotaMemoryProgressBar(quotaPerUserUsageEntity); addQuotaRow(memoryQuotasList, quotaPerUserUsageEntity.getQuotaName(), memoryQuotaProgressBar); }
public void updateRunTimeDynamicData(org.ovirt.engine.core.common.businessentities.VmDynamic vm, org.ovirt.engine.core.compat.Guid vdsId, java.lang.String vdsName) { setStatus(vm.getStatus()); setRunOnVds(vdsId); setRunOnVdsName(vdsName); setVmHost(vm.getVmHost()); setVmIp(vm.getVmIp()); setVmFQDN(vm.getVmFQDN()); if ((vm.getCurrentCd()) != null) { setCurrentCd(vm.getCurrentCd()); } setAppList(vm.getAppList()); setGuestOs(vm.getGuestOs()); getDynamicData().setVncKeyboardLayout(vm.getVncKeyboardLayout()); setKvmEnable(vm.getKvmEnable()); setAcpiEnable(vm.getAcpiEnable()); setGuestCurrentUserName(vm.getGuestCurrentUserName()); setWin2kHackEnable(vm.getWin2kHackEnable()); setUtcDiff(vm.getUtcDiff()); setExitStatus(vm.getExitStatus()); setExitMessage(vm.getExitMessage()); setExitReason(vm.getExitReason()); setClientIp(vm.getClientIp()); setVmPauseStatus(vm.getPauseStatus()); setLastWatchdogEvent(vm.getLastWatchdogEvent()); setGuestCpuCount(vm.getGuestCpuCount()); getGraphicsInfos().putAll(vm.getGraphicsInfos()); }
private void execute(org.ovirt.engine.core.ldap.LdapProviderType ldapProviderType, java.lang.String domain) { java.util.Hashtable<java.lang.String, java.lang.String> env = new java.util.Hashtable<java.lang.String, java.lang.String>(); org.ovirt.engine.core.bll.adbroker.LdapBrokerUtils.addLdapConfigValues(env); initContextVariables(env); javax.naming.directory.Attributes results = null; javax.naming.directory.DirContext ctx = null; try { ctx = createContext(env); org.ovirt.engine.core.bll.adbroker.LdapQueryData ldapQueryData = new org.ovirt.engine.core.bll.adbroker.LdapQueryDataImpl(); ldapQueryData.setLdapQueryType(LdapQueryType.rootDSE); ldapQueryData.setDomain(domain); org.ovirt.engine.core.bll.adbroker.LdapQueryExecution queryExecution = org.ovirt.engine.core.bll.adbroker.LdapQueryExecutionBuilderImpl.getInstance().build(ldapProviderType, ldapQueryData); javax.naming.directory.SearchControls searchControls = new javax.naming.directory.SearchControls(); searchControls.setReturningAttributes(queryExecution.getReturningAttributes()); searchControls.setSearchScope(queryExecution.getSearchScope()); searchControls.setReturningObjFlag(true); searchControls.setTimeLimit(((org.ovirt.engine.core.common.config.Config.<java.lang.Integer>GetValue(ConfigValues.LDAPOperationTimeout)) * 1000)); javax.naming.NamingEnumeration<javax.naming.directory.SearchResult> search = ctx.search(queryExecution.getBaseDN(), queryExecution.getFilter(), searchControls); try { results = search.next().getAttributes(); } finally { search.close(); } } catch (javax.naming.NamingException e) { org.ovirt.engine.core.bll.adbroker.GetRootDSE.log.errorFormat("Failed to query rootDSE for LDAP server {0} due to {1}", ldapURI, e.getMessage()); } finally { closeContext(ctx); } attributes = results; }
protected void validateDiskForCreation(org.ovirt.engine.api.model.Disk disk) { validateParameters(disk, 2, "interface"); if (org.ovirt.engine.api.restapi.resource.utils.DiskResourceUtils.isLunDisk(disk)) { validateParameters(disk.getLunStorage(), 2, "type"); org.ovirt.engine.api.model.StorageType storageType = org.ovirt.engine.api.model.StorageType.fromValue(disk.getLunStorage().getType()); if ((storageType != null) && (storageType == (org.ovirt.engine.api.model.StorageType.ISCSI))) { validateParameters(disk.getLunStorage().getLogicalUnits().getLogicalUnits().get(0), 3, "address", "target", "port", "id"); } } else if ((disk.isSetLunStorage()) && ((!(disk.getLunStorage().isSetLogicalUnits())) || (!(disk.getLunStorage().getLogicalUnits().isSetLogicalUnits())))) { throw new org.ovirt.engine.api.restapi.resource.WebFaultException(null, localize(Messages.INCOMPLETE_PARAMS_REASON), localize(Messages.INCOMPLETE_PARAMS_DETAIL_TEMPLATE, "LogicalUnit", "", "add"), Response.Status.BAD_REQUEST); } else { validateParameters(disk, 2, "provisionedSize|size", "format"); } validateEnums(org.ovirt.engine.api.model.Disk.class, disk); }
public static void addInit(org.ovirt.engine.core.common.migration.ConvergenceConfig config, org.ovirt.engine.core.bll.migration.ConvergenceSchedule schedule) { if ((config.getInitialItems()) == null) { return; } config.getInitialItems().stream().forEachOrdered(schedule::addInitStep); }
@java.lang.Override public void edit(final org.ovirt.engine.ui.uicommonweb.models.gluster.GlusterVolumeGeoRepCreateModel object) { driver.edit(object); }
@java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object ReturnValue) { java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StorageDomain> domains = ((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (ReturnValue)).getReturnValue(); for (org.ovirt.engine.core.common.businessentities.StorageDomain domain : domains) { domain.setId(domain.getStoragePoolId()); } java.util.Collections.sort(domains, new org.ovirt.engine.ui.uicommonweb.Linq.StorageDomainByPoolNameComparator()); setItems(domains); setIsEmpty(((getItems().size()) == 0)); }
private boolean findDefaultManagementNetwork() { managementNetwork = defaultManagementNetworkFinder.findDefaultManagementNetwork(org.ovirt.engine.core.bll.AddVdsGroupCommand.getVdsGroup().getStoragePoolId()); if ((managementNetwork) == null) { addValidationMessage(EngineMessage.ACTION_TYPE_FAILED_DEFAULT_MANAGEMENT_NETWORK_NOT_FOUND); return false; } return true; }
private void spyValidator() { validator = spy(new org.ovirt.engine.core.bll.validator.storage.StorageDomainToPoolRelationValidator(storageDomain.getStorageStaticData(), storagePool)); doReturn(storagePoolIsoMapDAO).when(validator).getStoragePoolIsoMapDao(); doReturn(storagePoolDAO).when(validator).getStoragePoolDao(); doReturn(storageDomainDAO).when(validator).getStorageDomainDao(); }
protected boolean proceedStorageDomainTreatmentByDomainType(final org.ovirt.engine.core.common.businessentities.StorageDomain newMaster, final boolean lockNewMaster) { if (newMaster == null) { return true; } newMaster.getStorageStaticData().setLastTimeUsedAsMaster(java.lang.System.currentTimeMillis()); if ((newMaster.getStorageDomainType()) != (org.ovirt.engine.core.common.businessentities.StorageDomainType.Master)) { org.ovirt.engine.core.bll.storage.domain.DeactivateStorageDomainCommand.executeInNewTransaction(new org.ovirt.engine.core.utils.transaction.TransactionMethod<java.lang.Object>() { @java.lang.Override public java.lang.Object runInTransaction() { org.ovirt.engine.core.common.businessentities.StoragePoolIsoMap newMasterMap = newMaster.getStoragePoolIsoMapData(); getCompensationContext().snapshotEntityUpdated(newMaster.getStorageStaticData()); newMaster.setStorageDomainType(StorageDomainType.Master); if (lockNewMaster) { newMasterMap.setStatus(StorageDomainStatus.Unknown); getCompensationContext().snapshotEntityStatus(newMasterMap); newMaster.setStatus(StorageDomainStatus.Locked); getStoragePoolIsoMapDao().updateStatus(newMasterMap.getId(), newMasterMap.getStatus()); } updateStorageDomainStaticData(newMaster.getStorageStaticData()); getCompensationContext().snapshotEntityUpdated(getStorageDomain().getStorageStaticData()); getStorageDomain().setStorageDomainType(StorageDomainType.Data); updateStorageDomainStaticData(getStorageDomain().getStorageStaticData()); getCompensationContext().stateChanged(); return null; } }); } else { updateStorageDomainStaticData(newMaster.getStorageStaticData()); } org.ovirt.engine.core.bll.storage.domain.DeactivateStorageDomainCommand.updateStoragePoolMasterDomainVersionInDiffTransaction(); return false; }
private void flush() { provider.setName(((java.lang.String) (name.getEntity()))); provider.setType(((org.ovirt.engine.core.common.businessentities.ProviderType) (type.getSelectedItem()))); provider.setDescription(((java.lang.String) (description.getEntity()))); provider.setUrl(((java.lang.String) (url.getEntity()))); if (isTypeOpenStackNetwork()) { org.ovirt.engine.core.common.businessentities.OpenstackNetworkProviderProperties properties = new org.ovirt.engine.core.common.businessentities.OpenstackNetworkProviderProperties(); properties.setPluginType(org.ovirt.engine.ui.uicommonweb.models.providers.NeutronPluginTranslator.getPluginNameForDisplayString(((java.lang.String) (getPluginType().getSelectedItem())))); properties.setAgentConfiguration(getNeutronAgentModel().flush()); provider.setAdditionalProperties(properties); } else if (isTypeOpenStackImage()) { provider.setAdditionalProperties(new org.ovirt.engine.core.common.businessentities.OpenstackImageProviderProperties()); } boolean authenticationRequired = ((java.lang.Boolean) (requiresAuthentication.getEntity())); provider.setRequiringAuthentication(authenticationRequired); if (authenticationRequired) { provider.setUsername(((java.lang.String) (getUsername().getEntity()))); provider.setPassword(((java.lang.String) (getPassword().getEntity()))); if (getTenantName().getIsAvailable()) { org.ovirt.engine.core.common.businessentities.TenantProviderProperties properties = ((org.ovirt.engine.core.common.businessentities.TenantProviderProperties) (provider.getAdditionalProperties())); if (properties == null) { properties = new org.ovirt.engine.core.common.businessentities.TenantProviderProperties(); provider.setAdditionalProperties(properties); } properties.setTenantName(((java.lang.String) (getTenantName().getEntity()))); } } else { provider.setUsername(null); provider.setPassword(null); if (getTenantName().getIsAvailable()) { org.ovirt.engine.core.common.businessentities.TenantProviderProperties properties = ((org.ovirt.engine.core.common.businessentities.TenantProviderProperties) (provider.getAdditionalProperties())); if (properties != null) { properties.setTenantName(null); } } } }
private static void assertDiskDescriptionDecoding(org.ovirt.engine.core.common.businessentities.storage.Disk disk) throws java.lang.Exception { org.ovirt.engine.core.common.businessentities.storage.Disk diskToEnrich = new org.ovirt.engine.core.common.businessentities.storage.DiskImage(); org.ovirt.engine.core.bll.storage.disk.image.MetadataDiskDescriptionHandler.getInstance().enrichDiskByJsonDescription(org.ovirt.engine.core.bll.storage.disk.image.MetadataDiskDescriptionHandler.getInstance().generateJsonDiskDescription(disk), diskToEnrich); assertEquals(disk, diskToEnrich); }
@javax.validation.constraints.NotNull private org.ovirt.engine.core.common.scheduling.PolicyUnit sendToDb(org.ovirt.engine.core.bll.scheduling.external.ExternalSchedulerDiscoveryUnit discovery, org.ovirt.engine.core.common.scheduling.PolicyUnit policyUnit, org.ovirt.engine.core.common.scheduling.PolicyUnitType type) { org.ovirt.engine.core.common.scheduling.PolicyUnit policy = createFromDiscoveryUnit(discovery, type); if (policyUnit != null) { org.ovirt.engine.core.bll.scheduling.external.ExternalSchedulerDiscovery.log.warn("Policy unit {} already reported by broker.", policyUnit.getName()); } if ((policyUnit != null) && ((policyUnit.getId()) != null)) { policy.setId(policyUnit.getId()); policyUnitDao.update(policy); } else { policy.setId(org.ovirt.engine.core.compat.Guid.newGuid()); policyUnitDao.save(policy); } return policy; }
@java.lang.Override protected void syncSearch() { super.syncSearch(); org.ovirt.engine.core.common.queries.IdQueryParameters params = new org.ovirt.engine.core.common.queries.IdQueryParameters(getEntity().getId()); params.setRefresh(getIsQueryFirstTime()); org.ovirt.engine.ui.frontend.Frontend.getInstance().runQuery(VdcQueryType.GetAttachedClustersByClusterPolicyId, params, new org.ovirt.engine.ui.uicommonweb.models.configure.scheduling.SetItemsAsyncQuery()); setIsQueryFirstTime(false); }
private void revertPreviousHandlers() { getParameters().decrementExecutionIndex(); if (hasStepsToRevert()) { logRollbackedTask(); getParameters().setExecutionReason(CommandExecutionReason.ROLLBACK_FLOW); getCurrentTaskHandler().compensate(); if (!(hasRevertTask())) { revertPreviousHandlers(); } } else { setSucceeded(true); } }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.VmStatic> getAllByStoragePoolId(org.ovirt.engine.core.compat.Guid spId) { return getCallsHandler().executeReadList("GetAllFromVmStaticByStoragePoolId", org.ovirt.engine.core.dao.VmStaticDaoImpl.VMStaticRowMapper.instance, getCustomMapSqlParameterSource().addValue("sp_id", spId)); }
public boolean containsAction(java.lang.String actionName) { if ((actions) != null) { for (java.lang.String action : actions) { if (action.toLowerCase().equals(actionName.toLowerCase())) { return true; } } } return false; }
private void clearVm(org.ovirt.engine.core.common.businessentities.VM vm, org.ovirt.engine.core.common.businessentities.VmExitStatus exitStatus, java.lang.String exitMessage) { if ((vm.getStatus()) != (org.ovirt.engine.core.common.businessentities.VMStatus.MigratingFrom)) { if (((vm.getStatus()) != (org.ovirt.engine.core.common.businessentities.VMStatus.Suspended)) && ((vm.getStatus()) != (org.ovirt.engine.core.common.businessentities.VMStatus.Down))) { org.ovirt.engine.core.vdsbroker.ResourceManager.getInstance().InternalSetVmStatus(vm, VMStatus.Down, exitStatus, exitMessage); } addVmDynamicToList(vm.getDynamicData()); addVmStatisticsToList(vm.getStatisticsData()); addVmInterfaceStatisticsToList(vm.getInterfaces()); if (!(org.ovirt.engine.core.vdsbroker.ResourceManager.getInstance().IsVmInAsyncRunningList(vm.getId()))) { _vmsMovedToDown.add(vm.getId()); } } }
@org.junit.Test public void testNonSecuredEventMailSender() { org.ovirt.engine.core.common.businessentities.EventAuditLogSubscriber eventData = new org.ovirt.engine.core.common.businessentities.EventAuditLogSubscriber(); eventData.setlog_time(new java.util.Date()); eventData.setevent_type(0); eventData.setuser_name("a test user name"); eventData.setvm_name("a fine test VM"); eventData.setvds_name("a fine test host"); eventData.setmethod_address("mailtest.redhat@gmail.com"); eventData.setvm_template_name("a test template"); eventData.setstorage_pool_name("a test storage pool name"); eventData.setstorage_domain_name("a test storage pool domain"); eventData.setseverity(3); org.ovirt.engine.core.notifier.utils.NotificationProperties.setDefaults("src/test/resources/conf/notifier-mail-test-plain.conf", "src/test/resources/conf/missing.conf"); org.ovirt.engine.core.notifier.utils.sender.mail.EventSenderMailImpl mailSender = new org.ovirt.engine.core.notifier.utils.sender.mail.EventSenderMailImpl(org.ovirt.engine.core.notifier.utils.NotificationProperties.getInstance()); eventData.setmessage("a test message to be sent via non-secured mode"); org.ovirt.engine.core.notifier.utils.sender.EventSenderResult sentResult = null; try { sentResult = mailSender.send(eventData, null); } catch (java.lang.Exception e) { sentResult = new org.ovirt.engine.core.notifier.utils.sender.EventSenderResult(); sentResult.setSent(false); } assertTrue(sentResult.isSent()); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("'Port Mirroring' cannot be changed if the vNIC Profile is used by a VM") java.lang.String portMirroringNotChangedIfUsedByVms();
protected void updateCompatibilityVersion() { org.ovirt.engine.ui.uicommonweb.models.vms.DataCenterWithCluster dataCenterWithCluster = getModel().getDataCenterWithClustersList().getSelectedItem(); if (dataCenterWithCluster == null) { return; } final org.ovirt.engine.core.common.businessentities.StoragePool dataCenter = dataCenterWithCluster.getDataCenter(); if (dataCenter == null) { return; } org.ovirt.engine.ui.frontend.AsyncQuery asyncQuery = new org.ovirt.engine.ui.frontend.AsyncQuery(new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object result) { java.util.List<org.ovirt.engine.core.compat.Version> versions = ((java.util.List<org.ovirt.engine.core.compat.Version>) (result)); versions.add(0, null); org.ovirt.engine.core.compat.Version selectedVersion; selectedVersion = getModel().getCustomCompatibilityVersion().getSelectedItem(); if ((selectedVersion != null) && (versions.contains(selectedVersion))) { getModel().getCustomCompatibilityVersion().setItems(versions, selectedVersion); } else { getModel().getCustomCompatibilityVersion().setItems(versions); } } }); org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().getDataCenterVersions(asyncQuery, dataCenter.getId()); }
private static void loadExtensions(org.ovirt.engine.exttool.core.ModuleService moduleService, java.util.Map<java.lang.String, java.lang.Object> argMap) { org.ovirt.engine.core.extensions.mgr.ExtensionsManager extensionsManager = new org.ovirt.engine.core.extensions.mgr.ExtensionsManager(); moduleService.getContext().put(ModuleService.EXTENSION_MANAGER, extensionsManager); java.util.Map<java.lang.String, org.ovirt.engine.core.extensions.mgr.ExtensionProxy> proxies = moduleService.getContext().get(ModuleService.EXTENSIONS_MAP); java.util.List<java.io.File> files = ((java.util.List<java.io.File>) (argMap.get("extension-file"))); if (files == null) { files = org.ovirt.engine.exttool.core.ExtensionsToolExecutor.listFiles(((java.lang.String) (argMap.get("extensions-dir"))), "properties"); } for (java.io.File f : files) { org.ovirt.engine.exttool.core.ExtensionsToolExecutor.logger.debug("Loading extension file '{}'", f.getName()); try { proxies.put(extensionsManager.load(f), null); } catch (java.lang.Exception ex) { org.ovirt.engine.exttool.core.ExtensionsToolExecutor.logger.error("Can't load extension '{}', ignoring.", f.getName()); org.ovirt.engine.exttool.core.ExtensionsToolExecutor.logger.debug("Exception:", ex); } } for (java.util.Map.Entry<java.lang.String, org.ovirt.engine.core.extensions.mgr.ExtensionProxy> entry : proxies.entrySet()) { extensionsManager.initialize(entry.getKey()); entry.setValue(extensionsManager.getExtensionByName(entry.getKey())); org.ovirt.engine.exttool.core.ExtensionsToolExecutor.logger.debug("Extension '{}' initialized", entry.getKey()); } }
private org.ovirt.engine.core.dao.network.VnicProfileViewDao getVnicProfileViewDao() { return org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVnicProfileViewDao(); }
public static void sendJsonData(javax.servlet.http.HttpServletResponse response, java.lang.String jsonPayload, java.lang.String contentType) throws java.io.IOException { try (java.io.OutputStream os = response.getOutputStream()) { response.setContentType(contentType); byte[] jsonPayloadBytes = jsonPayload.getBytes(java.nio.charset.StandardCharsets.UTF_8.name()); response.setContentLength(jsonPayloadBytes.length); os.write(jsonPayloadBytes); org.ovirt.engine.core.sso.utils.SsoUtils.log.trace("Sending json data {}", jsonPayload); } }
@java.lang.Override public void edit(final org.ovirt.engine.ui.uicommonweb.models.profiles.NetworkProfilesModel model) { defaultProfile = model.getDefaultProfile(); super.edit(model); model.getDcId().getEntityChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { dcId = model.getDcId().getEntity(); } }); }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("Boot Time") java.lang.String bootTimeHostGeneral();
private void extractRemovedNetworks() { for (org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface iface : getExistingIfaces().values()) { java.lang.String networkName = iface.getNetworkName(); if ((org.apache.commons.lang.StringUtils.isNotBlank(networkName)) && (!(attachedNetworksNames.contains(networkName)))) { removedNetworks.add(networkName); final java.util.List<java.lang.String> vmNames = getVmInterfaceManager().findActiveVmsUsingNetworks(params.getVdsId(), java.util.Collections.singleton(networkName)); for (java.lang.String vmName : vmNames) { addDetailedViolation(EngineMessage.NETWORK_CANNOT_DETACH_NETWORK_USED_BY_VMS, vmName, java.util.Collections.singletonMap("networkNames", networkName)); } } } }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Configure Data Center") java.lang.String configureDataCenterRoleTree();
@java.lang.Override public void edit(final org.ovirt.engine.ui.uicommonweb.models.storage.ImportIscsiStorageModel object) { driver.edit(object); iscsiDiscoverTargetsView.edit(object); targetsTable.asEditor().edit(object.getTargets()); storageDomainsTable.asEditor().edit(object.getStorageDomains()); addEventsHandlers(object); }
public boolean validate() { if (!(getEnabled().getEntity())) { return true; } getAverage().validateEntity(new org.ovirt.engine.ui.uicommonweb.validation.IValidation[]{ new org.ovirt.engine.ui.uicommonweb.validation.NotEmptyValidation(), new org.ovirt.engine.ui.uicommonweb.validation.IntegerValidation(0, ((java.lang.Integer) (org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getConfigValuePreConverted(ConfigurationValues.MaxAverageNetworkQoSValue)))) }); getPeak().validateEntity(new org.ovirt.engine.ui.uicommonweb.validation.IValidation[]{ new org.ovirt.engine.ui.uicommonweb.validation.NotEmptyValidation(), new org.ovirt.engine.ui.uicommonweb.validation.IntegerValidation(0, ((java.lang.Integer) (org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getConfigValuePreConverted(ConfigurationValues.MaxPeakNetworkQoSValue)))) }); getBurst().validateEntity(new org.ovirt.engine.ui.uicommonweb.validation.IValidation[]{ new org.ovirt.engine.ui.uicommonweb.validation.NotEmptyValidation(), new org.ovirt.engine.ui.uicommonweb.validation.IntegerValidation(0, ((java.lang.Integer) (org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getConfigValuePreConverted(ConfigurationValues.MaxBurstNetworkQoSValue)))) }); setIsValid((((getAverage().getIsValid()) && (getPeak().getIsValid())) && (getBurst().getIsValid()))); return getIsValid(); }
private java.util.List<org.ovirt.engine.core.common.businessentities.network.Network> getNetworks() { org.ovirt.engine.core.compat.NGuid dataCenterId = org.ovirt.engine.core.bll.network.dc.AddNetworkCommand.getNetwork().getDataCenterId(); if ((dataCenterId != null) && (!(dataCenterId.getValue().equals(Guid.Empty)))) { return org.ovirt.engine.core.bll.network.dc.AddNetworkCommand.getNetworkDAO().getAllForDataCenter(dataCenterId.getValue()); } else { return org.ovirt.engine.core.bll.network.dc.AddNetworkCommand.getNetworkDAO().getAll(); } }
public org.ovirt.engine.core.bll.ValidationResult externalNetworkNotDisplay(java.lang.String networkName) { return networkCluster.isDisplay() ? new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_EXTERNAL_NETWORK_CANNOT_BE_DISPLAY, java.lang.String.format(org.ovirt.engine.core.bll.network.cluster.NetworkClusterValidatorBase.NETWORK_NAME_REPLACEMENT, networkName)) : org.ovirt.engine.core.bll.ValidationResult.VALID; }
private void DomainRecoveredFromProblem(org.ovirt.engine.core.compat.Guid domainId, org.ovirt.engine.core.compat.Guid vdsId, java.lang.String vdsName) { java.lang.String domainIdTuple = org.ovirt.engine.core.vdsbroker.irsbroker.IrsBrokerCommand.IrsProxyData.getDomainIdTuple(domainId); org.ovirt.engine.core.vdsbroker.irsbroker.IrsBrokerCommand.log.infoFormat("Domain {0} recovered from problem. vds: {1}", domainIdTuple, vdsName); ClearVds(vdsId, domainId); _domainsInProblem.get(domainId).remove(vdsId); if ((_domainsInProblem.get(domainId).size()) == 0) { org.ovirt.engine.core.vdsbroker.irsbroker.IrsBrokerCommand.log.infoFormat(("Domain {0} has recovered from problem. No active host in the DC is reporting it as" + " problematic, so clearing the domain recovery timer."), domainIdTuple); _domainsInProblem.remove(domainId); ClearTimer(domainId); } }
@java.lang.Override public void edit(final org.ovirt.engine.ui.uicommonweb.models.storage.ImportExportRepoImageBaseModel model) { driver.edit(model); model.getPropertyChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { if (!(args instanceof org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs)) { return; } org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs changedArgs = ((org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs) (args)); if (("ImportExportEntities".equals(changedArgs.PropertyName)) && ((model.getEntities()) != null)) { imageList.setRowData(model.getEntities()); } } }); }
@java.lang.Override public com.google.gwt.user.client.ui.Label getFeedbackLabel() { return feedbackImageLabel; }
private void saveNewVm(final org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel model) { if ((model.getProgress()) != null) { return; } model.startProgress(null); org.ovirt.engine.core.common.businessentities.VM vm = getcurrentVm(); if (!(org.ovirt.engine.core.compat.StringHelper.isNullOrEmpty(model.getVmId().getEntity()))) { vm.setId(new org.ovirt.engine.core.compat.Guid(model.getVmId().getEntity())); } vm.setUseLatestVersion(model.getTemplateWithVersion().getSelectedItem().isLatest()); org.ovirt.engine.core.common.action.AddVmParameters parameters = new org.ovirt.engine.core.common.action.AddVmParameters(vm); parameters.setDiskInfoDestinationMap(model.getDisksAllocationModel().getImageToDestinationDomainMap()); parameters.setConsoleEnabled(model.getIsConsoleDeviceEnabled().getEntity()); parameters.setBalloonEnabled(balloonEnabled(model)); parameters.setCopyTemplatePermissions(model.getCopyPermissions().getEntity()); parameters.setSoundDeviceEnabled(model.getIsSoundcardEnabled().getEntity()); parameters.setVirtioScsiEnabled(model.getIsVirtioScsiEnabled().getEntity()); setVmWatchdogToParams(model, parameters); setRngDeviceToParams(model, parameters); setGraphicsDevicesToParams(model, parameters); if (!(org.ovirt.engine.core.compat.StringHelper.isNullOrEmpty(model.getVmId().getEntity()))) { parameters.setVmId(new org.ovirt.engine.core.compat.Guid(model.getVmId().getEntity())); } org.ovirt.engine.ui.frontend.Frontend.getInstance().runAction((model.getProvisioning().getEntity() ? org.ovirt.engine.core.common.action.VdcActionType.AddVmFromTemplate : org.ovirt.engine.core.common.action.VdcActionType.AddVm), parameters, createUnitVmModelNetworkAsyncCallback(vm, model), this); }
@org.junit.Test public void encodeWhenAliasIsTruncated() throws java.io.IOException { java.lang.String alias = org.ovirt.engine.core.bll.storage.disk.image.MetadataDiskDescriptionHandlerTest.generateRandomString(200); disk.setDiskAlias(alias); disk.setDiskDescription("DiskDescription"); assertDiskDescriptionMap(disk, org.ovirt.engine.core.bll.storage.disk.image.MetadataDiskDescriptionHandlerTest.generateDiskAliasJsonEntry(alias.substring(0, org.ovirt.engine.core.bll.storage.disk.image.MetadataDiskDescriptionHandlerTest.DISK_ALIAS_MAX_LENGTH))); }
protected java.lang.String addToAuditLogErrorMessage(java.lang.String connection, java.lang.String errorCode, java.util.List<org.ovirt.engine.core.common.businessentities.storage_server_connections> connections, org.ovirt.engine.core.common.businessentities.LUNs lun) { org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase logable = new org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase(); java.lang.String connectionField = (getConnectionDescription(connections, connection)) + (lun == null ? "" : (" (LUN " + (lun.getLUN_id())) + ")"); logable.AddCustomValue("Connection", connectionField); java.lang.String translatedError = getTranslatedStorageError(errorCode); logable.AddCustomValue("ErrorMessage", translatedError); org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogDirector.log(logable, AuditLogType.STORAGE_DOMAIN_ERROR); return connectionField; }
@java.lang.Override public void onBrowserEvent(com.google.gwt.cell.client.Cell.Context context, com.google.gwt.dom.client.Element parent, java.lang.Boolean value, com.google.gwt.safehtml.shared.SafeHtml tooltipContent, com.google.gwt.dom.client.NativeEvent event, com.google.gwt.cell.client.ValueUpdater<java.lang.Boolean> valueUpdater) { java.lang.String type = event.getType(); boolean enterPressed = (BrowserEvents.KEYDOWN.equals(type)) && ((event.getKeyCode()) == (com.google.gwt.event.dom.client.KeyCodes.KEY_ENTER)); if ((BrowserEvents.CHANGE.equals(type)) || enterPressed) { com.google.gwt.dom.client.InputElement input = parent.getFirstChild().cast(); java.lang.Boolean isChecked = input.isChecked(); if (enterPressed && ((handlesSelection()) || (!(dependsOnSelection())))) { isChecked = !isChecked; input.setChecked(isChecked); } if (((value == null ? false : value.booleanValue()) != (isChecked == null ? false : isChecked.booleanValue())) && (!(dependsOnSelection()))) { setViewData(context.getKey(), isChecked); } else { clearViewData(context.getKey()); } if (valueUpdater != null) { valueUpdater.update(isChecked); } } }
@java.lang.Override protected org.ovirt.engine.api.model.VM doPopulate(org.ovirt.engine.api.model.VM model, org.ovirt.engine.core.common.businessentities.VM entity) { setPayload(model); setBallooning(model); setCertificateInfo(model); return model; }
@org.junit.Test public void testUpdateRole() { existingRole.setdescription("This is an updated description"); dao.update(existingRole); org.ovirt.engine.core.common.businessentities.Role result = dao.get(existingRole.getId()); assertNotNull(result); assertEquals(existingRole, result); }
private void createProfiles() throws org.ovirt.engine.core.extensions.mgr.ConfigurationException { for (org.ovirt.engine.core.extensions.mgr.ExtensionManager.ExtensionEntry authnExtension : org.ovirt.engine.core.extensions.mgr.ExtensionManager.getInstance().getProvidedExtensions(org.ovirt.engine.core.aaa.AuthenticationProfileRepository.AUTHN_SERVICE)) { registerProfile(new org.ovirt.engine.core.aaa.AuthenticationProfile(((org.ovirt.engine.core.aaa.Authenticator) (authnExtension.getExtension())), ((org.ovirt.engine.core.aaa.Directory) (org.ovirt.engine.core.extensions.mgr.ExtensionManager.getInstance().getExtensionByName(authnExtension.getConfig().getProperty(org.ovirt.engine.core.aaa.AuthenticationProfileRepository.AUTHN_AUTHZ_PLUGIN)).getExtension())))); } }
@java.lang.Override public org.ovirt.engine.core.common.businessentities.VM getVm() { org.ovirt.engine.core.common.businessentities.VM vm = super.getVm(); if (vm != null) { setVm(vm); } return vm; }
public org.ovirt.engine.core.common.businessentities.ArchitectureType getClusterArch() { return this.clusterArch; }
protected void setupExportOvaModel(org.ovirt.engine.ui.uicommonweb.models.vms.ExportOvaModel model) { }
public java.util.List<org.ovirt.engine.core.common.scheduling.AffinityGroup> getAllHardAffinityGroups(org.ovirt.engine.core.common.businessentities.VDSGroup vdsGroup) { return org.ovirt.engine.core.utils.linq.LinqUtils.filter(affinityGroupDao.getAllAffinityGroupsByClusterId(vdsGroup.getId()), new org.ovirt.engine.core.utils.linq.Predicate<org.ovirt.engine.core.common.scheduling.AffinityGroup>() { @java.lang.Override public boolean eval(org.ovirt.engine.core.common.scheduling.AffinityGroup affinityGroup) { return affinityGroup.isEnforcing(); } }); }
@org.ovirt.engine.ui.frontend.DefaultStringValue("Cannot ${action} ${type}. The host network interface (id ${nicId}, name ${nicName}) does not exist.") java.lang.String HOST_NETWORK_INTERFACE_HAVING_ID_OR_NAME_DOES_NOT_EXIST();
@java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VM> vms = new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VM>(); java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VmPool> pools = new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VmPool>(); org.ovirt.engine.core.common.queries.VdcQueryReturnValue retValue = ((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (returnValue)); if ((retValue != null) && (retValue.getSucceeded())) { java.util.List<java.lang.Object> list = ((java.util.ArrayList<java.lang.Object>) (retValue.getReturnValue())); if (list != null) { for (java.lang.Object object : list) { if (object instanceof org.ovirt.engine.core.common.businessentities.VM) { vms.add(((org.ovirt.engine.core.common.businessentities.VM) (object))); } else if (object instanceof org.ovirt.engine.core.common.businessentities.VmPool) { pools.add(((org.ovirt.engine.core.common.businessentities.VmPool) (object))); } } } } onVmAndPoolLoad(vms, pools); }
protected void updateMemoryBalloon() { if ((getModel().getSelectedCluster()) != null) { org.ovirt.engine.core.common.businessentities.VDSGroup cluster = getModel().getSelectedCluster(); boolean hasMemoryBalloon = (cluster.getcompatibility_version().compareTo(VmListModel.BALLOON_DEVICE_MIN_VERSION)) >= 0; getModel().getMemoryBalloonDeviceEnabled().setIsAvailable(hasMemoryBalloon); } }
@java.lang.Override public java.lang.String getValue(org.ovirt.engine.core.common.businessentities.Label label) { java.lang.String hostNames = org.ovirt.engine.ui.uicompat.external.StringUtils.join(getHostNames(label), ", "); if (hostNames.isEmpty()) { return org.ovirt.engine.ui.webadmin.section.main.view.tab.AbstractSubTabAffinityLabelsView.constants.affinityLabelsNoMembers(); } return hostNames; }
private void processStoragePoolStatus() { if ((getVds().getSpmStatus()) != (org.ovirt.engine.core.common.businessentities.VdsSpmStatus.None)) { org.ovirt.engine.core.common.businessentities.StoragePool pool = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getStoragePoolDao().get(getVds().getStoragePoolId()); if ((pool != null) && ((pool.getStatus()) == (org.ovirt.engine.core.common.businessentities.StoragePoolStatus.NotOperational))) { pool.setStatus(StoragePoolStatus.NonResponsive); org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getStoragePoolDao().updateStatus(pool.getId(), pool.getStatus()); org.ovirt.engine.core.bll.storage.StoragePoolStatusHandler.poolStatusChanged(pool.getId(), pool.getStatus()); } } }
@java.lang.Override protected void InitDetailModels() { super.InitDetailModels(); setClusterVmListModel(new org.ovirt.engine.ui.uicommonweb.models.clusters.ClusterVmListModel()); setClusterServiceModel(new org.ovirt.engine.ui.uicommonweb.models.clusters.ClusterServiceModel()); setClusterGlusterHookListModel(new org.ovirt.engine.ui.uicommonweb.models.clusters.ClusterGlusterHookListModel()); org.ovirt.engine.ui.uicompat.ObservableCollection<org.ovirt.engine.ui.uicommonweb.models.EntityModel> list = new org.ovirt.engine.ui.uicompat.ObservableCollection<org.ovirt.engine.ui.uicommonweb.models.EntityModel>(); clusterGeneralModel = new org.ovirt.engine.ui.uicommonweb.models.clusters.ClusterGeneralModel(); list.add(clusterGeneralModel); list.add(new org.ovirt.engine.ui.uicommonweb.models.clusters.ClusterNetworkListModel()); list.add(new org.ovirt.engine.ui.uicommonweb.models.clusters.ClusterHostListModel()); list.add(getClusterVmListModel()); list.add(getClusterServiceModel()); list.add(getClusterGlusterHookListModel()); list.add(new org.ovirt.engine.ui.uicommonweb.models.configure.PermissionListModel()); setDetailModels(list); }
@java.lang.Override protected void executeVmCommand() { getParameters().setSnapshotType(determineSnapshotType()); org.ovirt.engine.core.compat.Guid createdSnapshotId = updateActiveSnapshotId(); setActionReturnValue(createdSnapshotId); org.ovirt.engine.core.bll.memory.MemoryImageBuilder memoryImageBuilder = getMemoryImageBuilder(); freezeVm(); createSnapshotsForDisks(); addSnapshotToDB(createdSnapshotId, memoryImageBuilder); fastForwardDisksToActiveSnapshot(); memoryImageBuilder.build(); boolean pendingAsyncTasks = (!(getTaskIdList().isEmpty())) || (!(org.ovirt.engine.core.bll.tasks.CommandCoordinatorUtil.getChildCommandIds(org.ovirt.engine.core.bll.CreateAllSnapshotsFromVmCommand.getCommandId()).isEmpty())); if (!pendingAsyncTasks) { getParameters().setTaskGroupSuccess(true); incrementVmGeneration(); } org.ovirt.engine.core.bll.CreateAllSnapshotsFromVmCommand.setSucceeded(true); }
private void updatePanelsVisibility(org.ovirt.engine.ui.uicommonweb.models.vms.ImportVmsModel model) { exportPanel.setVisible(((model.getImportSources().getSelectedItem()) == (org.ovirt.engine.ui.uicommonweb.models.vms.ImportSource.EXPORT_DOMAIN))); vmwarePanel.setVisible(((model.getImportSources().getSelectedItem()) == (org.ovirt.engine.ui.uicommonweb.models.vms.ImportSource.VMWARE))); vmwareProvidersEditor.setVisible(((model.getImportSources().getSelectedItem()) == (org.ovirt.engine.ui.uicommonweb.models.vms.ImportSource.VMWARE))); }
public synchronized org.ovirt.engine.api.model.RSDL getRSDL() throws java.io.IOException, java.lang.ClassNotFoundException { if ((org.ovirt.engine.api.restapi.resource.BackendApiResource.rsdl) == null) { org.ovirt.engine.api.rsdl.RsdlManager rsdlManager = new org.ovirt.engine.api.rsdl.RsdlManager(); org.ovirt.engine.api.restapi.resource.BackendApiResource.rsdl = rsdlManager.loadRsdl(getCurrent().get(org.ovirt.engine.core.common.mode.ApplicationMode.class)); } return org.ovirt.engine.api.restapi.resource.BackendApiResource.rsdl; }
private void saveDataToDb() { if (saveVdsDynamic) { vdsManager.updateDynamicData(vds.getDynamicData()); if (refreshedCapabilities) { vdsManager.updateNumaData(vds); } } if (saveVdsStatistics) { org.ovirt.engine.core.common.businessentities.VdsStatistics stat = vds.getStatisticsData(); vdsManager.updateStatisticsData(stat); checkVdsMemoryThreshold(stat); checkVdsCpuThreshold(stat); checkVdsNetworkThreshold(stat); checkVdsSwapThreshold(stat); final java.util.List<org.ovirt.engine.core.common.businessentities.network.VdsNetworkStatistics> statistics = new java.util.LinkedList<>(); for (org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface iface : vds.getInterfaces()) { statistics.add(iface.getStatistics()); } if (!(statistics.isEmpty())) { org.ovirt.engine.core.utils.transaction.TransactionSupport.executeInScope(TransactionScopeOption.Required, () -> { getDbFacade().getInterfaceDao().massUpdateStatisticsForVds(statistics); return null; }); } saveNumaStatisticsDataToDb(); } }
protected boolean checkRemoveEditValidations() { org.ovirt.engine.core.compat.Guid clusterPolicyId = getParameters().getClusterPolicyId(); if (clusterPolicyId == null) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_CLUSTER_POLICY_PARAMETERS_INVALID); } org.ovirt.engine.core.common.scheduling.ClusterPolicy clusterPolicy = schedulingManager.getClusterPolicy(clusterPolicyId); if (clusterPolicy == null) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_CLUSTER_POLICY_PARAMETERS_INVALID); } if (clusterPolicy.isLocked()) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_CLUSTER_POLICY_PARAMETERS_INVALID); } return true; }
private void initCustomPropertySheet(final org.ovirt.engine.ui.uicommonweb.models.vms.VmInterfaceModel iface) { iface.getCustomPropertySheet().getKeyValueLines().getItemsChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { customPropertiesSheetEditor.edit(iface.getCustomPropertySheet()); } }); iface.getCustomPropertySheet().getPropertyChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { java.lang.String propName = ((org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs) (args)).PropertyName; if ("IsChangable".equals(propName)) { customPropertiesSheetEditor.setEnabled(false); } } }); }
private java.lang.String getClientUrl() { return ((((((com.google.gwt.user.client.Window.Location.getProtocol()) + "//") + (com.google.gwt.user.client.Window.Location.getHost())) + "/ovirt-engine-novnc-main.html?host=") + (config.getProxyHost())) + "&port=") + (config.getProxyPort()); }
@org.junit.Test public void areAllVfsFreeTrue() { freeVfCommon(5, 0, 0, 0, 0); assertTrue(hostNicVfsConfigHelper.areAllVfsFree(nic)); }
public void runQuery(org.ovirt.engine.core.compat.Guid guid) { startProgress("getCount"); org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery = new org.ovirt.engine.ui.frontend.AsyncQuery(); _asyncQuery.setModel(this); _asyncQuery.setHandleFailure(true); _asyncQuery.asyncCallback = new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { stopProgress(); org.ovirt.engine.ui.uicommonweb.models.AbstractErrataCountModel errataCountModel = ((org.ovirt.engine.ui.uicommonweb.models.AbstractErrataCountModel) (model)); org.ovirt.engine.core.common.queries.VdcQueryReturnValue returnValueObject = ((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (returnValue)); org.ovirt.engine.core.common.businessentities.ErrataCounts resultEntity = returnValueObject.getReturnValue(); errataCountModel.setMessage(null); if ((resultEntity != null) && (returnValueObject.getSucceeded())) { errataCountModel.setErrataCounts(resultEntity); } else { errataCountModel.setMessage((((org.ovirt.engine.ui.uicommonweb.models.AbstractErrataCountModel.constants.katelloProblemRetrievingErrata()) + " ") + (returnValueObject.getExceptionMessage()))); } } }; org.ovirt.engine.ui.frontend.Frontend.getInstance().runQuery(getQueryType(), new org.ovirt.engine.core.common.queries.IdQueryParameters(guid), _asyncQuery); }
@java.lang.Override public java.lang.String getVerb(org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkItemModel<?> op1) { return org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getMessages().attachTo(op1.getName()); }
@java.lang.Override public com.google.gwt.resources.client.ImageResource getValue(org.ovirt.engine.core.common.businessentities.VM vm) { if ((vm.getVmPoolId()) == null) { org.ovirt.engine.ui.webadmin.widget.table.column.VmTypeConfig config = org.ovirt.engine.ui.webadmin.widget.table.column.VmTypeConfig.from(vm.getVmType(), vm.isStateless(), vm.isNextRunConfigurationExists()); return config.getImageResource(); } else { if (!(vm.isNextRunConfigurationExists())) { return org.ovirt.engine.ui.webadmin.widget.table.column.VmTypeColumn.resources.manyDesktopsImage(); } else { return org.ovirt.engine.ui.webadmin.widget.table.column.VmTypeColumn.resources.manyDesktopsChangesImage(); } } }
@java.lang.Override protected void executeVdsBrokerCommand() { _result = org.ovirt.engine.core.vdsbroker.vdsbroker.HSMGetStorageDomainsListVDSCommand.getBroker().getStorageDomainsList(org.ovirt.engine.core.vdsbroker.vdsbroker.HSMGetStorageDomainsListVDSCommand.getParameters().getStoragePoolId().toString(), org.ovirt.engine.core.vdsbroker.vdsbroker.HSMGetStorageDomainsListVDSCommand.getParameters().getStorageDomainType().getValue(), ((org.ovirt.engine.core.vdsbroker.vdsbroker.HSMGetStorageDomainsListVDSCommand.getParameters().getStorageType()) != null ? java.lang.Integer.valueOf(org.ovirt.engine.core.vdsbroker.vdsbroker.HSMGetStorageDomainsListVDSCommand.getParameters().getStorageType().getValue()).toString() : ""), ((org.ovirt.engine.core.vdsbroker.vdsbroker.HSMGetStorageDomainsListVDSCommand.getParameters().getPath()) != null ? org.ovirt.engine.core.vdsbroker.vdsbroker.HSMGetStorageDomainsListVDSCommand.getParameters().getPath() : "")); org.ovirt.engine.core.vdsbroker.vdsbroker.HSMGetStorageDomainsListVDSCommand.proceedProxyReturnValue(); java.util.ArrayList<org.ovirt.engine.core.compat.Guid> domains = new java.util.ArrayList<org.ovirt.engine.core.compat.Guid>(); for (java.lang.String domain : _result.mStorageDomainList) { domains.add(new org.ovirt.engine.core.compat.Guid(domain)); } setReturnValue(domains); }
public static java.lang.String getTokenContent(java.lang.String token) { java.lang.String[] s = token.split("\\|", 2); if ((s.length) != 2) { throw new java.lang.IllegalArgumentException("Invalid session token format"); } if (!("0".equals(s[0]))) { throw new java.lang.IllegalArgumentException("Invalid session token version"); } if (s[1].isEmpty()) { throw new java.lang.IllegalArgumentException("Invalid session token format"); } return s[1]; }
@org.ovirt.engine.ui.frontend.DefaultStringValue("Cannot ${action} ${type}. Overriding MTU is not supported for this Data Center's compatibility version.") java.lang.String NETWORK_MTU_OVERRIDE_NOT_SUPPORTED();
private org.ovirt.engine.core.common.businessentities.gluster.GlusterServerHook getGlusterServerHook(int index) { org.ovirt.engine.core.common.businessentities.gluster.GlusterServerHook serverHook = new org.ovirt.engine.core.common.businessentities.gluster.GlusterServerHook(); serverHook.setServerId(org.ovirt.engine.core.bll.gluster.EnableGlusterHookCommandTest.GUIDS[index]); return serverHook; }
private java.util.Map<java.lang.String, org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface> getExistingIfaces() { if ((existingIfaces) == null) { java.util.List<org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface> ifaces = getDbFacade().getInterfaceDao().getAllInterfacesForVds(params.getVdsId()); org.ovirt.engine.core.dao.network.NetworkQoSDao qosDao = getDbFacade().getQosDao(); for (org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface iface : ifaces) { org.ovirt.engine.core.common.businessentities.network.Network network = getExistingClusterNetworks().get(iface.getNetworkName()); iface.setNetworkImplementationDetails(org.ovirt.engine.core.utils.NetworkUtils.calculateNetworkImplementationDetails(network, (network == null ? null : qosDao.get(network.getQosId())), iface)); } existingIfaces = org.ovirt.engine.core.common.businessentities.Entities.entitiesByName(ifaces); } return existingIfaces; }
public org.ovirt.engine.ui.uicommonweb.models.hosts.FenceAgentListModel getFenceAgentListModel() { return fenceAgents; }
@java.lang.Override protected java.lang.String getText(org.ovirt.engine.core.common.businessentities.gluster.GlusterGeoRepSessionDetails entity) { return (entity == null) || ((entity.getStatus()) == null) ? constants.notAvailableLabel() : entity.getStatus().toString(); }
public static void getPmTypeList(org.ovirt.engine.ui.frontend.AsyncQuery aQuery, org.ovirt.engine.core.compat.Version version) { aQuery.converterCallback = new org.ovirt.engine.ui.frontend.IAsyncConverter() { @java.lang.Override public java.lang.Object Convert(java.lang.Object source, org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery) { java.util.ArrayList<java.lang.String> list = new java.util.ArrayList<java.lang.String>(); if (source != null) { java.lang.String[] array = ((java.lang.String) (source)).split("[,]", (-1)); for (java.lang.String item : array) { list.add(item); } } return list; } }; org.ovirt.engine.core.common.queries.GetConfigurationValueParameters tempVar = new org.ovirt.engine.core.common.queries.GetConfigurationValueParameters(org.ovirt.engine.core.common.queries.ConfigurationValues.VdsFenceType); tempVar.setVersion((version != null ? version.toString() : org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getDefaultConfigurationVersion())); org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getConfigFromCache(tempVar, aQuery); }
public java.util.ArrayList<java.lang.String> getUsedLunsMessages() { java.util.ArrayList<java.lang.String> usedLunsMessages = new java.util.ArrayList<java.lang.String>(); org.ovirt.engine.ui.uicompat.Messages messages = org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getMessages(); for (org.ovirt.engine.ui.uicommonweb.models.storage.LunModel lunModel : getAddedLuns()) { if ((lunModel.getStatus()) == (org.ovirt.engine.core.common.businessentities.LunStatus.Used)) { java.lang.String reason = null; org.ovirt.engine.core.common.businessentities.LUNs lun = ((org.ovirt.engine.core.common.businessentities.LUNs) (lunModel.getEntity())); if (((lun.getvolume_group_id()) != null) && (!(lun.getvolume_group_id().isEmpty()))) { reason = messages.lunUsedByVG(lun.getvolume_group_id()); } usedLunsMessages.add((reason == null ? lunModel.getLunId() : (((lunModel.getLunId()) + " (") + reason) + ")")); } } return usedLunsMessages; }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("You are about to change the Data Center Compatibility Version. This will upgrade all the Storage Domains belonging to the Data Center. Are you sure you want to continue?") java.lang.String youAreAboutChangeDcCompatibilityVersionWithUpgradeMsg();
private void readUsbItem(org.ovirt.engine.core.utils.ovf.xml.XmlNode node) { vmBase.setUsbPolicy(org.ovirt.engine.core.common.businessentities.UsbPolicy.forStringValue(selectSingleNode(node, "rasd:UsbPolicy", _xmlNS).innerText)); }
@java.lang.Override public void OnSuccess(java.lang.Object model1, java.lang.Object ReturnValue1) { org.ovirt.engine.ui.uicommonweb.models.hosts.HostInterfaceListModel innerHostInterfaceListModel = ((org.ovirt.engine.ui.uicommonweb.models.hosts.HostInterfaceListModel) (model1)); org.ovirt.engine.ui.uicommonweb.models.hosts.HostBondInterfaceModel bModel = ((org.ovirt.engine.ui.uicommonweb.models.hosts.HostBondInterfaceModel) (innerHostInterfaceListModel.getWindow())); java.util.List<org.ovirt.engine.core.common.businessentities.VdsNetworkInterface> bonds = ((java.util.List<org.ovirt.engine.core.common.businessentities.VdsNetworkInterface>) (((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (ReturnValue1)).getReturnValue())); bModel.getBond().setItems(bonds); bModel.getBond().setSelectedItem(org.ovirt.engine.ui.uicommonweb.Linq.FirstOrDefault(bonds)); boolean hasManagement = false; for (org.ovirt.engine.core.common.businessentities.VdsNetworkInterface innerItem : innerHostInterfaceListModel.getSelectedItemsWithVlans()) { if (innerItem.getIsManagement()) { hasManagement = true; break; } } innerHostInterfaceListModel.PostBond(innerHostInterfaceListModel, bModel, ((bModel.getNetwork().getItems()) != null ? ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Network>) (bModel.getNetwork().getItems())) : new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Network>()), hasManagement); }
private void updateDefaultSelectedConsoleProtocol(final org.ovirt.engine.core.common.businessentities.VM vm) { if ((vm.getId()) == null) { return; } final java.util.ArrayList<org.ovirt.engine.ui.uicommonweb.models.vms.ConsoleModel> cachedModels = cachedConsoleModels.get(vm.getId()); if (cachedModels == null) { return; } deselectUserSelectedProtocol(vm.getId()); final boolean isWindowsExplorer = parentModel.getConfigurator().isClientWindowsExplorer(); java.lang.Boolean hasSpiceSupport = org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.hasSpiceSupport(vm.getOs(), vm.getVdsGroupCompatibilityVersion()); if ((isWindowsExplorer && (hasSpiceSupport != null)) && (!hasSpiceSupport)) { cachedModels.get(org.ovirt.engine.ui.uicommonweb.models.ConsoleModelsCache.RDP_INDEX).setUserSelected(true); } else { determineConsoleModelFromVm(vm, cachedModels).setUserSelected(true); } setupSelectionContext(vm); }
public static boolean isPublicKeyValid(java.lang.String publicKey) { int i = publicKey.indexOf("\n"); if ((i != (-1)) && (i != ((publicKey.length()) - 1))) { return false; } java.lang.String[] words = publicKey.split("\\s+", 3); if ((words.length) < 2) { return false; } if (!(words[0].matches("^[\\p{Alpha}\\p{Digit}-]*$"))) { return false; } if (!(org.ovirt.engine.core.uutils.ssh.OpenSSHUtils.isBase64(words[1].getBytes(java.nio.charset.Charset.forName("UTF-8"))))) { return false; } return true; }
@org.junit.Test public void networkInVfsConfigNotValid() { networkInVfsConfigCommonTest(false); assertThat(validator.networkInVfsConfig(org.ovirt.engine.core.bll.validator.VfsConfigValidatorTest.NETWORK_ID), org.ovirt.engine.core.bll.validator.ValidationResultMatchers.failsWith(EngineMessage.ACTION_TYPE_FAILED_NETWORK_NOT_IN_VFS_CONFIG, java.lang.String.format(VfsConfigValidator.NIC_NAME_REPLACEMENT, nic.getName()), java.lang.String.format(VfsConfigValidator.NETWORK_NAME_REPLACEMENT, network.getName()))); }
private void updateSnapshotInfo() { final org.ovirt.engine.core.common.businessentities.Snapshot snapshot = ((org.ovirt.engine.core.common.businessentities.Snapshot) (org.ovirt.engine.ui.common.widget.uicommon.vm.VmSnapshotListModelTable.getModel().getSelectedItem())); if (snapshot == null) { return; } java.util.HashMap<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.ui.uicommonweb.models.vms.SnapshotModel> snapshotsMap = org.ovirt.engine.ui.common.widget.uicommon.vm.VmSnapshotListModelTable.getModel().getSnapshotsMap(); org.ovirt.engine.ui.uicommonweb.models.vms.SnapshotModel snapshotModel = snapshotsMap.get(snapshot.getId()); vmSnapshotInfoPanel.updatePanel((snapshotModel != null ? snapshotModel : new org.ovirt.engine.ui.uicommonweb.models.vms.SnapshotModel())); if (!(org.ovirt.engine.ui.common.widget.uicommon.vm.VmSnapshotListModelTable.getTable().getSelectionModel().isSelected(snapshot))) { com.google.gwt.core.client.Scheduler.get().scheduleDeferred(new com.google.gwt.core.client.Scheduler.ScheduledCommand() { @java.lang.Override public void execute() { getTable().getSelectionModel().setSelected(snapshot, true); } }); } }
@org.junit.Test public void testGetLocaleFromRequest_Brazilian() { java.util.Locale result = testServlet.getLocaleFromRequest(mockRequest); assertEquals("The locale should be en-US", java.util.Locale.US, result); when(mockRequest.getHeader(DocsServlet.REFERER)).thenReturn("http://127.0.0.1:8700/webadmin/webadmin/WebAdmin.html?locale=pt_BR"); result = testServlet.getLocaleFromRequest(mockRequest); assertEquals("The locale should be pt_BR", new java.util.Locale("pt", "BR"), result); }
@org.ovirt.engine.ui.uicompat.DefaultMessage("Add {0} to Bond") java.lang.String addToBond(java.lang.String name);
public org.ovirt.engine.core.bll.ValidationResult glusterServiceSupported() { return org.ovirt.engine.core.bll.ValidationResult.failWith(EngineMessage.GLUSTER_NOT_SUPPORTED, "compatibilityVersion", cluster.getCompatibilityVersion().getValue()).when(((cluster.supportsGlusterService()) && (!(glusterFeatureEnabled())))); }
public void setHighlyAvailableScore(java.lang.Integer value) { this.mVdsStatistics.setHighlyAvailableScore(value); }
protected void doLoadAttachableDisks(org.ovirt.engine.ui.uicommonweb.models.vms.AttachDiskModel.GetDisksCallback imageCallback, org.ovirt.engine.ui.uicommonweb.models.vms.AttachDiskModel.GetDisksCallback lunCallback) { org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().getAllAttachableDisks(new org.ovirt.engine.ui.frontend.AsyncQuery(this, imageCallback), getVm().getStoragePoolId(), getVm().getId()); org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().getAllAttachableDisks(new org.ovirt.engine.ui.frontend.AsyncQuery(this, lunCallback), null, getVm().getId()); }
@java.lang.Override public java.lang.String getHashName() { return "errata"; }
@java.lang.Override @org.junit.Before public void setUp() throws java.lang.Exception { super.setUp(); dao = dbFacade.getUserProfileDao(); existingProfile = dao.get(new org.ovirt.engine.core.compat.Guid("38cb5663-96bc-485c-834a-cbbc03acc820")); deletableProfile = dao.get(new org.ovirt.engine.core.compat.Guid("38cb5663-96bc-485c-834a-cbbc03acc821")); newProfile = new org.ovirt.engine.core.common.businessentities.UserProfile(); newProfile.setId(org.ovirt.engine.core.compat.Guid.newGuid()); newProfile.setUserId(new org.ovirt.engine.core.compat.Guid("81940459-2ec4-4afa-bbaa-22549555293c")); newProfile.setSshPublicKeyId(new org.ovirt.engine.core.compat.Guid("67bc5484-d4eb-47ce-8b6a-e9624b70b676")); newProfile.setSshPublicKey("key3"); newProfile.setLoginName("userportal4@testportal.redhat.com@testportal.redhat.com"); }
@java.lang.Override public java.util.Map<java.lang.Integer, java.util.Map<org.ovirt.engine.core.compat.Version, java.lang.Boolean>> getSoundDeviceSupportMap() { java.util.Map<java.lang.Integer, java.util.Map<org.ovirt.engine.core.compat.Version, java.lang.Boolean>> soundDeviceSupportMap = new java.util.HashMap<>(); java.util.Set<org.ovirt.engine.core.compat.Version> versionsWithNull = new java.util.HashSet(org.ovirt.engine.core.compat.Version.ALL); versionsWithNull.add(null); for (java.lang.Integer osId : getOsIds()) { soundDeviceSupportMap.put(osId, new java.util.HashMap<org.ovirt.engine.core.compat.Version, java.lang.Boolean>()); for (org.ovirt.engine.core.compat.Version ver : versionsWithNull) { soundDeviceSupportMap.get(osId).put(ver, isSoundDeviceEnabled(osId, ver)); } } return soundDeviceSupportMap; }
private org.ovirt.engine.api.model.RSDL addSystemVersion(org.ovirt.engine.api.model.RSDL rsdl) { rsdl.setVersion(org.ovirt.engine.api.restapi.util.VersionHelper.parseVersion(getConfigurationValueDefault(java.lang.String.class, ConfigurationValues.VdcVersion))); return rsdl; }
@java.lang.Override protected void hideAllDetails() { logicalNetworkExpand.toggleExpanded(false); }
private void handleRemovedDevices(org.ovirt.engine.core.compat.Guid vmId, java.util.Set<org.ovirt.engine.core.compat.Guid> processedDevices, java.util.List<org.ovirt.engine.core.common.businessentities.VmDevice> devices) { for (org.ovirt.engine.core.common.businessentities.VmDevice device : devices) { if (processedDevices.contains(device.getDeviceId())) { continue; } if (device.getIsManaged()) { if (device.getIsPlugged()) { device.setAddress(""); addVmDeviceToList(device); org.ovirt.engine.core.vdsbroker.VmsMonitoring.log.debug("VM '{}' managed pluggable device was unplugged : '{}'", vmId, device); } else if (!(devicePluggable(device))) { org.ovirt.engine.core.vdsbroker.VmsMonitoring.log.error("VM '{}' managed non pluggable device was removed unexpectedly from libvirt: '{}'", vmId, device); } } else { removedDeviceIds.add(device.getId()); org.ovirt.engine.core.vdsbroker.VmsMonitoring.log.debug("VM '{}' unmanaged device was marked for remove : {1}", vmId, device); } } }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.VmTemplate> getAllForNetwork(org.ovirt.engine.core.compat.Guid id) { return getCallsHandler().executeReadList("GetVmTemplatesByNetworkId", org.ovirt.engine.core.dao.VmTemplateDaoImpl.VMTemplateRowMapper.instance, getCustomMapSqlParameterSource().addValue("network_id", id)); }
@java.lang.Override protected java.util.Map<java.lang.String, java.lang.Object> constructStringAttributes() { java.util.Map<java.lang.String, java.lang.Object> attributes = super.constructStringAttributes(); attributes.put("macAddress", getMacAddress()); attributes.put("bondName", getBondName()); attributes.put("speed", getSpeed()); attributes.put("labels", getLabels()); return attributes; }
private void InitTemplate() { getModel().getMemSize().setEntity(this.vm.getvm_mem_size_mb()); getModel().getOSType().setSelectedItem(this.vm.getvm_os()); getModel().getDomain().setSelectedItem(this.vm.getvm_domain()); getModel().getUsbPolicy().setSelectedItem(this.vm.getusb_policy()); getModel().getNumOfMonitors().setSelectedItem(this.vm.getnum_of_monitors()); getModel().getAllowConsoleReconnect().setEntity(this.vm.getAllowConsoleReconnect()); getModel().setBootSequence(this.vm.getdefault_boot_sequence()); getModel().getTotalCPUCores().setEntity(java.lang.Integer.toString(this.vm.getnum_of_cpus())); getModel().getNumOfSockets().setSelectedItem(this.vm.getnum_of_sockets()); getModel().getIsStateless().setEntity(this.vm.getis_stateless()); getModel().getIsDeleteProtected().setEntity(this.vm.isDeleteProtected()); getModel().getIsSmartcardEnabled().setEntity(this.vm.isSmartcardEnabled()); if (!(org.ovirt.engine.core.compat.StringHelper.isNullOrEmpty(this.vm.gettime_zone()))) { updateTimeZone(this.vm.gettime_zone()); } else { UpdateDefaultTimeZone(); } UpdateDomain(); getModel().getStorageDomain().setIsChangable(true); getModel().getProvisioning().setIsAvailable(false); for (java.lang.Object item : getModel().getDisplayProtocol().getItems()) { org.ovirt.engine.ui.uicommonweb.models.EntityModel model = ((org.ovirt.engine.ui.uicommonweb.models.EntityModel) (item)); org.ovirt.engine.core.common.businessentities.DisplayType displayType = ((org.ovirt.engine.core.common.businessentities.DisplayType) (model.getEntity())); if (displayType == (this.vm.getdefault_display_type())) { getModel().getDisplayProtocol().setSelectedItem(item); break; } } InitPriority(this.vm.getpriority()); }
private void loadVmwareProviders() { org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().getAllProvidersByType(new org.ovirt.engine.ui.frontend.AsyncQuery(new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { java.util.List<org.ovirt.engine.core.common.businessentities.Provider<org.ovirt.engine.core.common.businessentities.VmwareVmProviderProperties>> providers = new java.util.ArrayList<>(); for (org.ovirt.engine.core.common.businessentities.Provider<org.ovirt.engine.core.common.businessentities.VmwareVmProviderProperties> provider : ((java.util.List<org.ovirt.engine.core.common.businessentities.Provider<org.ovirt.engine.core.common.businessentities.VmwareVmProviderProperties>>) (returnValue))) { if (getDataCenters().getSelectedItem().getId().equals(provider.getAdditionalProperties().getStoragePoolId())) { providers.add(provider); } } providers.add(0, null); getVmwareProviders().setItems(providers); } }), ProviderType.VMWARE); }
@java.lang.Override protected void setActionMessageParameters() { addCanDoActionMessage(EngineMessage.VAR__ACTION__REMOVE); addCanDoActionMessage(EngineMessage.VAR__TYPE__POLICY_UNIT); }
protected java.lang.String join(java.util.List<java.lang.String> strings, java.lang.String separator) { java.lang.StringBuffer result = new java.lang.StringBuffer(); if (strings == null) { return result.toString(); } for (java.lang.String s : strings) { if ((result.length()) != 0) { result.append(separator); } result.append(s); } return result.toString(); }
@java.lang.Override public int hashCode() { final int prime = 31; int result = 1; result = (prime * result) + ((operationType) == null ? 0 : operationType.hashCode()); result = (prime * result) + ((parameter) == null ? 0 : parameter.hashCode()); result = (prime * result) + ((source) == null ? 0 : source.hashCode()); return result; }
@java.lang.Override public java.lang.Integer parse(java.lang.CharSequence text) throws java.text.ParseException { com.google.gwt.regexp.shared.MatchResult match = com.google.gwt.regexp.shared.RegExp.compile("^(\\d*)\\s*(\\w*)$").exec(text.toString()); if (match == null) { return 0; } java.lang.String prefix = match.getGroup(1); java.lang.String suffix = match.getGroup(2); java.lang.Integer size = null; try { size = java.lang.Integer.parseInt(prefix); } catch (java.lang.NumberFormatException e) { return 0; } if ((suffix.equalsIgnoreCase("TB")) || (suffix.equalsIgnoreCase("T"))) { return (size * 1024) * 1024; } else if ((suffix.equalsIgnoreCase("GB")) || (suffix.equalsIgnoreCase("G"))) { return size * 1024; } else if ((suffix.equalsIgnoreCase("MB")) || (suffix.equalsIgnoreCase("M"))) { return size; } else if (org.ovirt.engine.core.compat.StringHelper.isNullOrEmpty(suffix)) { return size; } else { return 0; } }
@org.junit.Test public void statusNotSupportedForHostInstallation() { when(oldHost.getStatus()).thenReturn(VDSStatus.Up); validator = createValidatorForHostInstallation(); assertThat(validator.statusSupportedForHostInstallation(), org.ovirt.engine.core.bll.validator.ValidationResultMatchers.failsWith(EngineMessage.VDS_CANNOT_INSTALL_STATUS_ILLEGAL)); }
@java.lang.Override protected void ProceedProxyReturnValue() { org.ovirt.engine.core.common.errors.VdcBllErrors returnStatus = GetReturnValueFromStatus(org.ovirt.engine.core.vdsbroker.gluster.AbstractGlusterBrokerCommand.getReturnStatus()); switch (returnStatus) { case GlusterGeneralException : case GlusterPermissionDeniedException : case GlusterSyntaxErrorException : case GlusterMissingArgumentException : case GlusterCmdExecFailedException : case GlusterXmlErrorException : case GlusterVolumeCreateFailed : case GlusterVolumeStartFailed : case GlusterVolumeStopFailed : case AddBricksToGlusterVolumeFailed : case GlusterVolumeSetOptionFailed : case GlusterVolumeRebalanceStartFailed : case GlusterVolumeDeleteFailed : case GlusterVolumeReplaceBrickStartFailed : case GlusterVolumeListFailed : case GlusterVolumeOptionInfoFailed : case GlusterVolumeResetOptionsFailed : case GlusterVolumeRemoveBricksFailed : case GlusterVolumeProfileStartFailed : case GlusterVolumeProfileStopFailed : case GlusterAddHostFailed : case RemoveGlusterServerFailed : case GlusterPeerListFailed : case GlusterVolumeStatusFailed : case GlusterVolumeProfileInfoFailed : case GlusterHookFailed : case GlusterHookEnableFailed : case GlusterHookAlreadyEnabled : case GlusterHookNotFound : org.ovirt.engine.core.vdsbroker.gluster.AbstractGlusterBrokerCommand.getVDSReturnValue().setVdsError(new org.ovirt.engine.core.common.errors.VDSError(returnStatus, org.ovirt.engine.core.vdsbroker.gluster.AbstractGlusterBrokerCommand.getReturnStatus().mMessage)); org.ovirt.engine.core.vdsbroker.gluster.AbstractGlusterBrokerCommand.getVDSReturnValue().setSucceeded(false); break; default : super.ProceedProxyReturnValue(); break; } }
public org.ovirt.engine.core.bll.ValidationResult hotUpdatePossible() { if ((getRequiredAction()) == (org.ovirt.engine.core.bll.network.vm.UpdateVmInterfaceCommand.RequiredAction.UPDATE_VM_DEVICE)) { if (!(org.ovirt.engine.core.common.FeatureSupported.networkLinking(version))) { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.dal.VdcBllMessages.HOT_VM_INTERFACE_UPDATE_IS_NOT_SUPPORTED, org.ovirt.engine.core.bll.network.vm.UpdateVmInterfaceCommand.UpdateVmNicValidator.clusterVersion()); } else if (nic.isPortMirroring()) { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.dal.VdcBllMessages.CANNOT_PERFOM_HOT_UPDATE_WITH_PORT_MIRRORING); } } return org.ovirt.engine.core.bll.ValidationResult.VALID; }
public void startNextLiveMerge(int completedChildren) { if (completedChildren == 0) { org.ovirt.engine.core.bll.storage.disk.image.ImagesHandler.updateAllDiskImageSnapshotsStatus(getImageGroupId(), ImageStatus.LOCKED); } else { checkImageIdConsistency((completedChildren - 1)); } org.ovirt.engine.core.compat.Guid imageId = org.ovirt.engine.core.bll.snapshots.RemoveDiskSnapshotsCommand.getParameters().getImageIds().get(completedChildren); org.ovirt.engine.core.bll.snapshots.RemoveDiskSnapshotsCommand.log.info("Starting child command {} of {}, image '{}'", (completedChildren + 1), org.ovirt.engine.core.bll.snapshots.RemoveDiskSnapshotsCommand.getParameters().getImageIds().size(), imageId); org.ovirt.engine.core.common.action.RemoveSnapshotSingleDiskParameters parameters = buildRemoveSnapshotSingleDiskLiveParameters(imageId); parameters.setEndProcedure(EndProcedure.COMMAND_MANAGED); if ((org.ovirt.engine.core.bll.snapshots.RemoveDiskSnapshotsCommand.getParameters().getChildImageIds()) == null) { org.ovirt.engine.core.bll.snapshots.RemoveDiskSnapshotsCommand.getParameters().setChildImageIds(java.util.Arrays.asList(new org.ovirt.engine.core.compat.Guid[org.ovirt.engine.core.bll.snapshots.RemoveDiskSnapshotsCommand.getParameters().getImageIds().size()])); } org.ovirt.engine.core.bll.snapshots.RemoveDiskSnapshotsCommand.getParameters().getChildImageIds().set(completedChildren, parameters.getDestinationImageId()); persistCommand(org.ovirt.engine.core.bll.snapshots.RemoveDiskSnapshotsCommand.getParameters().getParentCommand(), true); org.ovirt.engine.core.bll.tasks.CommandCoordinatorUtil.executeAsyncCommand(VdcActionType.RemoveSnapshotSingleDiskLive, parameters, org.ovirt.engine.core.bll.snapshots.RemoveDiskSnapshotsCommand.cloneContextAndDetachFromParent()); }
@com.gwtplatform.mvp.client.annotations.ProxyEvent public void onErrataSelectionChange(org.ovirt.engine.ui.webadmin.section.main.presenter.tab.ErrataSelectionChangeEvent event) { updateMainTabSelection(event.getSelectedItems()); }
@java.lang.Override public void OnSuccess(java.lang.Object model, java.lang.Object result) { boolean returnValue = ((java.lang.Boolean) (((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (result)).getReturnValue())); if (returnValue) { command.Execute(); } else { displayConsoleConnectConfirmPopup(command); } }
@java.lang.Override protected boolean validate() { if (!(super.validate())) { return false; } if ((getParameters().getClusterId()) == null) { addValidationMessage(EngineMessage.ACTION_TYPE_FAILED_CLUSTER_IS_NOT_VALID); return false; } if (!(getGlusterUtil().isGlusterSnapshotSupported(getVdsGroup().getCompatibilityVersion(), getVdsGroup().getId()))) { failValidation(EngineMessage.ACTION_TYPE_FAILED_VOLUME_SNAPSHOT_NOT_SUPPORTED); } if ((getParameters().getConfigParams()) == null) { addValidationMessage(EngineMessage.ACTION_TYPE_FAILED_GLUSTER_VOLUME_SNAPSHOT_CONFIG_PARAMS_IS_EMPTY); return false; } for (org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeSnapshotConfig param : getParameters().getConfigParams()) { if (org.apache.commons.lang.StringUtils.isEmpty(param.getParamValue())) { addCustomValue("snapshotConfigParam", param.getParamName()); addValidationMessage(EngineMessage.ACTION_TYPE_FAILED_GLUSTER_VOLUME_SNAPSHOT_CONFIG_PARAM_VALUE_IS_EMPTY); return false; } } return true; }
public static boolean canRemoveVmPool(org.ovirt.engine.core.compat.Guid vmPoolId, java.util.ArrayList<java.lang.String> reasons) { boolean returnValue = true; if ((org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVmPoolDao().getVmPoolsMapByVmPoolId(vmPoolId).size()) != 0) { returnValue = false; reasons.add(EngineMessage.VM_POOL_CANNOT_REMOVE_VM_POOL_WITH_VMS.toString()); } return returnValue; }
@java.lang.Override public void render(com.google.gwt.cell.client.Cell.Context context, com.google.gwt.safehtml.shared.SafeHtml data, com.google.gwt.safehtml.shared.SafeHtmlBuilder sb) { if (data != null) { sb.appendHtmlConstant("<button type=\"button\" style=\"height:24px;\" tabindex=\"-1\">"); sb.append(data); sb.appendHtmlConstant("</button>"); } }
@java.lang.Override public void run() { org.ovirt.engine.core.bll.Backend.getInstance().runInternalAction(VdcActionType.ProcessDownVm, new org.ovirt.engine.core.common.action.IdParameters(getVm().getId()), org.ovirt.engine.core.bll.job.ExecutionHandler.createDefaultContexForTasks(getExecutionContext())); }
private void setChangeQuotaCommand(org.ovirt.engine.ui.uicommonweb.UICommand value) { privateChangeQuotaCommand = value; }
private void onRemove() { org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel model = ((org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel) (getWindow())); java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase> params = new java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase>(); for (java.lang.Object item : getSelectedItems()) { params.add(new org.ovirt.engine.core.common.action.RemoveIscsiBondParameters(((org.ovirt.engine.core.common.businessentities.IscsiBond) (item)).getId())); } model.startProgress(null); org.ovirt.engine.ui.frontend.Frontend.getInstance().runMultipleAction(VdcActionType.RemoveIscsiBond, params, new org.ovirt.engine.ui.uicompat.IFrontendMultipleActionAsyncCallback() { @java.lang.Override public void executed(org.ovirt.engine.ui.uicompat.FrontendMultipleActionAsyncResult result) { org.ovirt.engine.ui.uicommonweb.models.datacenters.DataCenterIscsiBondListModel localModel = ((org.ovirt.engine.ui.uicommonweb.models.datacenters.DataCenterIscsiBondListModel) (result.getState())); localModel.stopProgress(); cancel(); } }, this); }
@org.junit.Test public void testRunQuery_success_not_succeeded_eventshandler_nocallbackhandler() { org.ovirt.engine.core.common.queries.VdcQueryParametersBase testParameters = new org.ovirt.engine.core.common.queries.SearchParameters("*win*", org.ovirt.engine.core.common.interfaces.SearchType.VM); org.ovirt.engine.ui.frontend.Frontend.RunQuery(VdcQueryType.Search, testParameters, mockService, mockAsyncQuery); verify(mockService).RunQuery(eq(VdcQueryType.Search), eq(testParameters), callback.capture()); org.ovirt.engine.core.common.queries.VdcQueryReturnValue mockReturnValue = new org.ovirt.engine.core.common.queries.VdcQueryReturnValue(); mockReturnValue.setExceptionString("USER_IS_NOT_LOGGED_IN"); mockReturnValue.setSucceeded(false); callback.getValue().onSuccess(mockReturnValue); verify(mockFrontendNotLoggedInEvent).raise(org.ovirt.engine.ui.frontend.Frontend.class, EventArgs.Empty); }
@java.lang.Override public boolean getIsAvailable() { org.ovirt.engine.core.common.businessentities.StorageDomain entity = ((org.ovirt.engine.core.common.businessentities.StorageDomain) (getDetailModel().getEntity())); org.ovirt.engine.core.common.businessentities.StorageDomainType storageDomainType = (entity != null) ? entity.getStorageDomainType() : null; return (!(StorageDomainType.ISO.equals(storageDomainType))) && (!(StorageDomainType.ImportExport.equals(storageDomainType))); }
private static void runActionExecutionFailed(org.ovirt.engine.core.common.action.VdcActionType actionType, org.ovirt.engine.core.common.errors.VdcFault fault) { if ((org.ovirt.engine.ui.frontend.Frontend.getEventsHandler()) != null) { java.lang.String translatedMessage = org.ovirt.engine.ui.frontend.Frontend.translateVdcFault(fault); fault.setMessage(translatedMessage); org.ovirt.engine.ui.frontend.Frontend.getEventsHandler().runActionExecutionFailed(actionType, fault); } }
org.ovirt.engine.core.bll.tasks.interfaces.SPMTask construct(org.ovirt.engine.core.common.asynctasks.AsyncTaskCreationInfo creationInfo, org.ovirt.engine.core.common.businessentities.AsyncTasks asyncTask);
public java.util.List<java.lang.String> findActiveVmsUsingNetworks(org.ovirt.engine.core.compat.Guid vdsId, java.util.List<java.lang.String> networks) { if (networks.isEmpty()) { return java.util.Collections.emptyList(); } java.util.List<org.ovirt.engine.core.common.businessentities.VM> runningVms = getVmDAO().getAllRunningForVds(vdsId); java.util.List<java.lang.String> vmNames = new java.util.ArrayList<java.lang.String>(); for (org.ovirt.engine.core.common.businessentities.VM vm : runningVms) { java.util.List<org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface> vmInterfaces = getVmNetworkInterfaceDao().getAllForVm(vm.getId()); for (org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface vmNic : vmInterfaces) { if (((org.ovirt.engine.core.bll.common.predicates.VmNetworkCanBeUpdatedPredicate.getInstance().eval(vmNic)) && ((vmNic.getNetworkName()) != null)) && (networks.contains(vmNic.getNetworkName()))) { vmNames.add(vm.getName()); break; } } } return vmNames; }
@org.junit.Test public void outboundAverageMissing() { qos.setOutboundPeak(org.ovirt.engine.core.bll.validator.NetworkQosValidatorTest.BANDWIDTH_MEDIUM); qos.setOutboundBurst(org.ovirt.engine.core.bll.validator.NetworkQosValidatorTest.BANDWIDTH_MEDIUM); valuesPresentTest(org.ovirt.engine.core.bll.validator.ValidationResultMatchers.failsWith(VdcBllMessages.ACTION_TYPE_FAILED_NETWORK_QOS_MISSING_VALUES)); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Attach Storage") java.lang.String dataCenterAttachStorageAction();
@java.lang.Override protected org.ovirt.engine.api.model.Application addParents(org.ovirt.engine.api.model.Application model) { model.setVm(new org.ovirt.engine.api.model.VM()); model.getVm().setId(vmId.toString()); return model; }
protected org.ovirt.engine.api.model.Group mapAdGroup(org.ovirt.engine.core.common.businessentities.LdapGroup entity) { return getMapper(org.ovirt.engine.core.common.businessentities.LdapGroup.class, org.ovirt.engine.api.model.Group.class).map(entity, null); }
public org.ovirt.api.metamodel.concepts.Parameter getMainAddParameter(org.ovirt.api.metamodel.concepts.Method method) { org.ovirt.api.metamodel.concepts.Parameter mainParameter = method.getParameters().stream().filter(( x) -> ((x.getType()) instanceof org.ovirt.api.metamodel.concepts.StructType) || ((x.getType()) instanceof org.ovirt.api.metamodel.concepts.ListType)).findFirst().orElse(null); return mainParameter; }
@java.lang.Override public java.util.List<java.lang.String> allocateMacAddresses(int numberOfAddresses) { org.ovirt.engine.core.bll.network.macpool.MacPoolUsingRanges.log.debug("Allocating {} mac addresses from {}.", numberOfAddresses, this); java.util.List<java.lang.Long> macs = macsStorage.allocateAvailableMacs(numberOfAddresses); java.util.List<java.lang.String> result = org.ovirt.engine.core.utils.MacAddressRangeUtils.macAddressesToStrings(macs); org.ovirt.engine.core.bll.network.macpool.MacPoolUsingRanges.log.debug("Allocated mac addresses: {} from {}.", result, this); java.util.Collections.sort(result); logWhenMacPoolIsEmpty(); return result; }
public void setResolveContentConflict(org.ovirt.engine.ui.uicommonweb.models.EntityModel resolveContentConflict) { this.resolveContentConflict = resolveContentConflict; }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Retain") java.lang.String retainBricksButton();
protected void runVm() { setActionReturnValue(VMStatus.Down); if (getVdsToRunOn()) { org.ovirt.engine.core.common.businessentities.VMStatus status = null; try { if (connectLunDisks(org.ovirt.engine.core.bll.RunVmCommand.getVdsId())) { status = createVm(); org.ovirt.engine.core.bll.job.ExecutionHandler.setAsyncJob(org.ovirt.engine.core.bll.RunVmCommand.getExecutionContext(), true); } } catch (org.ovirt.engine.core.common.errors.VdcBLLException e) { switch (e.getErrorCode()) { case Done : case exist : org.ovirt.engine.core.bll.RunVmCommand.reportCompleted(); throw e; case VDS_NETWORK_ERROR : case PROVIDER_FAILURE : runningFailed(); throw e; default : org.ovirt.engine.core.bll.RunVmCommand.log.warn("Failed to run VM '{}': {}", org.ovirt.engine.core.bll.RunVmCommand.getVmName(), e.getMessage()); } } finally { org.ovirt.engine.core.bll.RunVmCommand.freeLock(); } setActionReturnValue(status); if ((status != null) && ((status.isRunning()) || (status == (org.ovirt.engine.core.common.businessentities.VMStatus.RestoringState)))) { org.ovirt.engine.core.bll.RunVmCommand.setSucceeded(true); } else { org.ovirt.engine.core.bll.RunVmCommand.log.info("Trying to rerun VM '{}'", org.ovirt.engine.core.bll.RunVmCommand.getVm().getName()); org.ovirt.engine.core.bll.RunVmCommand.setCommandShouldBeLogged(false); org.ovirt.engine.core.bll.RunVmCommand.setSucceeded(true); rerun(); } } else { runningFailed(); } }
@org.junit.Test public void networkNameTakenBySameNetwork() throws java.lang.Exception { networkNameAvailableTest(ValidationResult.VALID, getSingletonNamedNetworkList(DEFAULT_NETWORK_NAME, DEFAULT_GUID)); }
@java.lang.Override public org.ovirt.engine.core.vdsbroker.vdsbroker.FenceStatusReturnForXmlRpc fenceNode(java.lang.String ip, java.lang.String port, java.lang.String type, java.lang.String user, java.lang.String password, java.lang.String action, java.lang.String secured, java.lang.String options, java.util.Map<java.lang.String, java.lang.Object> fencingPolicy) { try { java.util.Map<java.lang.String, java.lang.Object> xmlRpcReturnValue; if (fencingPolicy == null) { xmlRpcReturnValue = vdsServer.fenceNode(ip, port, type, user, password, action, secured, options); } else { xmlRpcReturnValue = vdsServer.fenceNode(ip, port, type, user, password, action, secured, options, fencingPolicy); } org.ovirt.engine.core.vdsbroker.vdsbroker.FenceStatusReturnForXmlRpc wrapper = new org.ovirt.engine.core.vdsbroker.vdsbroker.FenceStatusReturnForXmlRpc(xmlRpcReturnValue); return wrapper; } catch (java.lang.reflect.UndeclaredThrowableException ute) { throw new org.ovirt.engine.core.vdsbroker.xmlrpc.XmlRpcRunTimeException(ute); } }
public void setUserProfile(org.ovirt.engine.core.common.businessentities.UserProfile userProfile) { this.userProfile = userProfile; }
protected boolean isCinderStorageHasNoDisks() { if ((org.ovirt.engine.core.bll.storage.domain.StorageDomainCommandBase.getStorageDomain().getStorageType()) == (org.ovirt.engine.core.common.businessentities.storage.StorageType.CINDER)) { return validate(org.ovirt.engine.core.bll.storage.CINDERStorageHelper.isCinderHasNoImages(getStorageDomainId())); } return true; }
@java.lang.Override protected org.ovirt.engine.core.bll.snapshots.SnapshotsValidator getSnapshotValidator() { return new org.ovirt.engine.core.bll.snapshots.SnapshotsValidator() { @java.lang.Override public org.ovirt.engine.core.bll.ValidationResult vmNotInPreview(org.ovirt.engine.core.compat.Guid vmId) { if (vmInPreview) { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_VM_IN_PREVIEW); } return org.ovirt.engine.core.bll.ValidationResult.VALID; } }; }
@java.lang.Override protected void executeVdsBrokerCommand() { vmListReturn = org.ovirt.engine.core.vdsbroker.vdsbroker.ListVDSCommand.getBroker().list(); org.ovirt.engine.core.vdsbroker.vdsbroker.ListVDSCommand.proceedProxyReturnValue(); java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.vdsbroker.monitoring.VdsmVm> returnVMs = new java.util.HashMap<>(); for (int idx = 0; idx < (vmListReturn.vmList.length); ++idx) { java.util.Map<java.lang.String, java.lang.Object> vm = vmListReturn.vmList[idx]; org.ovirt.engine.core.common.businessentities.VmDynamic dynamicData = org.ovirt.engine.core.vdsbroker.vdsbroker.ListVDSCommand.buildVMDynamicDataFromList(vm); org.ovirt.engine.core.vdsbroker.monitoring.VdsmVm vdsmVm = new org.ovirt.engine.core.vdsbroker.monitoring.VdsmVm(org.ovirt.engine.core.vdsbroker.vdsbroker.ListVDSCommand.getVdsmCallTimestamp(vm)).setVmDynamic(dynamicData).setDevicesHash(org.ovirt.engine.core.vdsbroker.vdsbroker.ListVDSCommand.getVmDevicesHash(vm)); returnVMs.put(dynamicData.getId(), vdsmVm); } setReturnValue(returnVMs); }
private boolean validatePciAndIdeLimit(java.util.List<org.ovirt.engine.core.common.businessentities.VM> vmsDiskPluggedTo) { for (org.ovirt.engine.core.common.businessentities.VM vm : vmsDiskPluggedTo) { java.util.List<org.ovirt.engine.core.common.businessentities.network.VmNic> allVmInterfaces = org.ovirt.engine.core.bll.UpdateVmDiskCommand.getVmNicDao().getAllForVm(vm.getId()); java.util.List<org.ovirt.engine.core.common.businessentities.Disk> allVmDisks = new java.util.LinkedList<org.ovirt.engine.core.common.businessentities.Disk>(getOtherVmDisks(vm.getId())); allVmDisks.add(getNewDisk()); if (!(checkPciAndIdeLimit(vm.getNumOfMonitors(), allVmInterfaces, allVmDisks, org.ovirt.engine.core.bll.utils.VmDeviceUtils.isVirtioScsiControllerAttached(vm.getId()), org.ovirt.engine.core.bll.utils.VmDeviceUtils.hasWatchdog(vm.getId()), org.ovirt.engine.core.bll.UpdateVmDiskCommand.getReturnValue().getCanDoActionMessages()))) { return false; } } return true; }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("Enforcing") java.lang.String enforceAffinityGroup();
private boolean isVmInterfacesAttachedToClusterNetworks(final java.util.Set<java.lang.String> clusterNetworkNames, final java.util.Set<java.lang.String> interfaceNetworkNames) { java.util.Set<java.lang.String> result = new java.util.HashSet<java.lang.String>(interfaceNetworkNames); result.removeAll(clusterNetworkNames); if ((result.size()) > 0) { addCanDoActionMessage(VdcBllMessages.ACTION_TYPE_FAILED_NETWORK_NOT_IN_CLUSTER); addCanDoActionMessage(java.lang.String.format("$networks %1$s", org.apache.commons.lang.StringUtils.join(result, ","))); return false; } return true; }
private java.util.Collection<org.ovirt.engine.core.common.businessentities.network.ExternalVnicProfileMapping> getVnicProfileMappings(org.ovirt.engine.api.model.Action action) { return org.ovirt.engine.api.restapi.types.ExternalVnicProfileMappingMapper.mapFromModel(action.getVnicProfileMappings()); }
public void update(org.ovirt.engine.core.common.businessentities.VM vm) { setVisible((vm != null)); if (vm == null) { return; } definedMemory.setValue(((vm.getVmMemSizeMb()) + (constants.mb()))); minAllocatedMemory.setValue(((vm.getMinAllocatedMem()) + (constants.mb()))); cpuInfo.setValue(messages.cpuInfoLabel(vm.getNumOfCpus(), vm.getNumOfSockets(), vm.getCpuPerSocket())); }
@java.lang.Override public void onDoubleClick(com.google.gwt.event.dom.client.DoubleClickEvent event) { try { if (!(model.isPool())) { model.getVmConsoles().connect(); } } catch (org.ovirt.engine.ui.uicommonweb.models.VmConsoles e) { getView().showErrorDialog(e.getLocalizedErrorMessage()); } }
public static void updateNetworkData(org.ovirt.engine.core.common.businessentities.VDS vds, java.util.Map<java.lang.String, java.lang.Object> xmlRpcStruct) { vds.setActiveNic(org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.AssignStringValue(xmlRpcStruct, VdsProperties.NETWORK_LAST_CLIENT_INTERFACE)); java.util.List<org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface> oldInterfaces = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getInterfaceDao().getAllInterfacesForVds(vds.getId()); vds.getInterfaces().clear(); org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.addHostNetworkInterfaces(vds, xmlRpcStruct); java.util.Map<java.lang.String, java.lang.Integer> currVlans = org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.addHostVlanDevices(vds, xmlRpcStruct); org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.addHostBondDevices(vds, xmlRpcStruct); org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.addHostNetworksAndUpdateInterfaces(vds, xmlRpcStruct, currVlans); org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.setBondingOptions(vds, oldInterfaces); if (xmlRpcStruct.containsKey(VdsProperties.netConfigDirty)) { vds.setNetConfigDirty(org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.AssignBoolValue(xmlRpcStruct, VdsProperties.netConfigDirty)); } }
@java.lang.Override protected void executeCommand() { org.ovirt.engine.core.common.vdscommands.VDSReturnValue returnValue = runVdsCommand(VDSCommandType.GetStorageDeviceList, new org.ovirt.engine.core.common.vdscommands.VdsIdVDSCommandParametersBase(org.ovirt.engine.core.bll.gluster.SyncStorageDevicesCommand.getVds().getId())); if (returnValue.getSucceeded()) { java.util.List<org.ovirt.engine.core.common.businessentities.gluster.StorageDevice> storageDevices = ((java.util.List<org.ovirt.engine.core.common.businessentities.gluster.StorageDevice>) (returnValue.getReturnValue())); getStorageDeviceSyncJobInstance().updateStorageDevices(org.ovirt.engine.core.bll.gluster.SyncStorageDevicesCommand.getVds(), storageDevices); org.ovirt.engine.core.bll.gluster.SyncStorageDevicesCommand.setSucceeded(true); } else { handleVdsError(returnValue); org.ovirt.engine.core.bll.gluster.SyncStorageDevicesCommand.setSucceeded(false); } }
@javax.ws.rs.Path("{action: (?:copy|export)}/{oid}") public org.ovirt.engine.api.v3.servers.V3ActionServer getActionResource(@javax.ws.rs.PathParam("action") java.lang.String action, @javax.ws.rs.PathParam("oid") java.lang.String oid) { return new org.ovirt.engine.api.v3.servers.V3ActionServer(getDelegate().getActionResource(action, oid)); }
@java.lang.Override public void onLogout() { org.ovirt.engine.ui.frontend.AsyncQuery query = new org.ovirt.engine.ui.frontend.AsyncQuery(); query.setHandleFailure(true); query.setModel(this); query.asyncCallback = new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object ReturnValue) { if (clientAgentType.isIE8OrBelow()) { Window.Location.reload(); } org.ovirt.engine.ui.frontend.Frontend.clearLoggedInUser(); getLoginModel().resetAfterLogout(); org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.clearCache(); connectAutomaticallyManager.resetAlreadyOpened(); org.ovirt.engine.ui.userportal.system.ApplicationInit.super.onLogout(); } }; org.ovirt.engine.ui.frontend.Frontend.LogoffAsync(org.ovirt.engine.ui.frontend.Frontend.getLoggedInUser(), query); }
public void setRuntimeDeviceCustomProperties(java.util.Map<org.ovirt.engine.core.common.businessentities.VmDevice, java.util.Map<java.lang.String, java.lang.String>> runtimeDeviceCustomProperties) { this.runtimeDeviceCustomProperties = runtimeDeviceCustomProperties; }
private static void addNetworkInterfaceProperties(org.ovirt.engine.core.vdsbroker.xmlrpc.XmlRpcStruct struct, org.ovirt.engine.core.common.businessentities.VmNetworkInterface vmInterface, org.ovirt.engine.core.common.businessentities.VmDevice vmDevice, java.lang.String nicModel, org.ovirt.engine.core.compat.Version clusterVersion) { struct.add(VdsProperties.Type, vmDevice.getType()); struct.add(VdsProperties.Device, vmDevice.getDevice()); struct.add(VdsProperties.network, org.apache.commons.lang.StringUtils.defaultString(vmInterface.getNetworkName())); boolean linkingSupported = org.ovirt.engine.core.common.config.Config.<java.lang.Boolean>GetValue(ConfigValues.NetworkLinkingSupported, clusterVersion.getValue()); if (linkingSupported) { struct.add(VdsProperties.linkActive, java.lang.String.valueOf(vmInterface.isLinked())); } org.ovirt.engine.core.vdsbroker.vdsbroker.VmInfoBuilder.addAddress(vmDevice, struct); struct.add(VdsProperties.mac_addr, vmInterface.getMacAddress()); org.ovirt.engine.core.vdsbroker.vdsbroker.VmInfoBuilder.addBootOrder(vmDevice, struct); struct.add(VdsProperties.SpecParams, vmDevice.getSpecParams()); struct.add(VdsProperties.DeviceId, java.lang.String.valueOf(vmDevice.getId().getDeviceId())); struct.add(VdsProperties.nic_type, nicModel); if (vmInterface.isPortMirroring()) { java.util.List<java.lang.String> networks = new java.util.ArrayList<java.lang.String>(); if ((vmInterface.getNetworkName()) != null) { networks.add(vmInterface.getNetworkName()); } struct.add(VdsProperties.portMirroring, networks); } org.ovirt.engine.core.vdsbroker.vdsbroker.VmInfoBuilder.addNetworkFiltersToNic(struct, clusterVersion); }
private java.util.ArrayList<java.lang.String> getLunIds(org.ovirt.engine.api.model.Storage storage, org.ovirt.engine.core.common.businessentities.storage.StorageType storageType, org.ovirt.engine.core.compat.Guid hostId) { java.util.List<org.ovirt.engine.api.model.LogicalUnit> logicalUnits = new java.util.ArrayList<org.ovirt.engine.api.model.LogicalUnit>(); if ((storage.isSetLogicalUnits()) && (storage.getLogicalUnits().isSetLogicalUnits())) { logicalUnits = storage.getLogicalUnits().getLogicalUnits(); } else if (((storage.isSetVolumeGroup()) && (storage.getVolumeGroup().isSetLogicalUnits())) && (storage.getVolumeGroup().getLogicalUnits().isSetLogicalUnits())) { logicalUnits = storage.getVolumeGroup().getLogicalUnits().getLogicalUnits(); } java.util.ArrayList<java.lang.String> lunIds = new java.util.ArrayList<java.lang.String>(); for (org.ovirt.engine.api.model.LogicalUnit unit : logicalUnits) { validateParameters(unit, 4, "id"); if ((storageType == (org.ovirt.engine.core.common.businessentities.storage.StorageType.ISCSI)) && (!(isConnectionAssumed(unit)))) { connectStorageToHost(hostId, storageType, unit); } lunIds.add(unit.getId()); } refreshHostStorage(hostId); return !(lunIds.isEmpty()) ? lunIds : null; }
@java.lang.Override public void edit(final org.ovirt.engine.ui.uicommonweb.models.hosts.InstallModel model) { driver.edit(model); rbPublicKey.setValue(true); model.setAuthenticationMethod(AuthenticationMethod.PublicKey); displayPassPkWindow(false); rbPassword.addValueChangeHandler(new com.google.gwt.event.logical.shared.ValueChangeHandler<java.lang.Boolean>() { @java.lang.Override public void onValueChange(com.google.gwt.event.logical.shared.ValueChangeEvent<java.lang.Boolean> event) { model.setAuthenticationMethod(AuthenticationMethod.Password); displayPassPkWindow(true); } }); rbPublicKey.addValueChangeHandler(new com.google.gwt.event.logical.shared.ValueChangeHandler<java.lang.Boolean>() { @java.lang.Override public void onValueChange(com.google.gwt.event.logical.shared.ValueChangeEvent<java.lang.Boolean> event) { model.setAuthenticationMethod(AuthenticationMethod.PublicKey); displayPassPkWindow(false); } }); }
protected java.lang.String getJsonDiskDescription(org.ovirt.engine.core.common.businessentities.storage.Disk disk) { try { return org.ovirt.engine.core.bll.MetadataDiskDescriptionHandler.getInstance().generateJsonDiskDescription(disk); } catch (java.io.IOException e) { log.error("Exception while generating json for disk. ERROR: '{}'", e); return org.apache.commons.lang.StringUtils.EMPTY; } }
@java.lang.Override protected org.ovirt.engine.ui.common.widget.uicommon.popup.vm.PopupWidgetConfigMap createWidgetConfiguration() { return super.createWidgetConfiguration().update(highAvailabilityTab, hiddenField()).update(spiceProxyEditor, simpleField().visibleInAdvancedModeOnly()).update(spiceProxyEnabledCheckboxWithInfoIcon, simpleField().visibleInAdvancedModeOnly()).update(spiceProxyOverrideEnabledEditor, simpleField().visibleInAdvancedModeOnly()).putOne(isStatelessEditor, hiddenField()).putOne(isRunAndPauseEditor, hiddenField()).putOne(editPoolEditVmsPanel, hiddenField()).putOne(editPoolIncraseNumOfVmsPanel, hiddenField()).putOne(logicalNetworksEditorPanel, hiddenField()).putOne(editPoolEditMaxAssignedVmsPerUserPanel, hiddenField()).update(templateVersionNameEditor, hiddenField()).putAll(detachableWidgets(), simpleField().detachable().visibleInAdvancedModeOnly()); }
public org.ovirt.engine.ui.uicommonweb.models.EntityModel getGateway() { return gateway; }
private boolean containsVmCluster(java.util.List<org.ovirt.engine.core.common.businessentities.VDSGroup> clusters) { for (org.ovirt.engine.core.common.businessentities.VDSGroup cluster : clusters) { if ((cluster.getStoragePoolId()) != null) { if (vm.getVdsGroupId().equals(cluster.getId())) { return true; } } } return false; }
@java.lang.Override public java.lang.String toString() { java.lang.StringBuilder builder = new java.lang.StringBuilder(); builder.append(getName()).append(" {id=").append(getId()).append(", vdsId=").append(getVdsId()).append(", macAddress=").append(getMacAddress()).append(", networkName=").append(getNetworkName()).append(", vlanId=").append(getVlanId()).append(", bonded=").append(getBonded()).append(", bondName=").append(getBondName()).append(", bondOptions=").append(getBondOptions()).append(", bootProtocol=").append(getBootProtocol()).append(", address=").append(getAddress()).append(", subnet=").append(getSubnet()).append(", gateway=").append(getGateway()).append(", mtu=").append(getMtu()).append(", bridged=").append(isBridged()).append(", speed=").append(getSpeed()).append(", type=").append(getType()).append(", networkImplementationDetails=").append(getNetworkImplementationDetails()).append(", labels=").append(getLabels()).append("}"); return builder.toString(); }
@org.ovirt.engine.ui.common.DefaultStringValue("&nbsp;") java.lang.String htmlNonBreakingSpace();
private void validateDomainMappings(org.ovirt.engine.api.model.Action action) { if ((action.getRegistrationConfiguration().isSetDomainMappings()) && (action.getRegistrationConfiguration().getDomainMappings().isSetRegistrationDomainMappings())) { action.getRegistrationConfiguration().getDomainMappings().getRegistrationDomainMappings().forEach(this::validateDomainMapping); } }
private void updateIsLiveMergeSupported(java.lang.Object entity) { if (entity == null) { return; } org.ovirt.engine.core.common.businessentities.VM vm = ((org.ovirt.engine.core.common.businessentities.VM) (entity)); if (((vm.getRunOnVds()) == null) || (!(org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().isLiveMergeSupported(vm)))) { setLiveMergeSupported(false); return; } org.ovirt.engine.ui.frontend.AsyncQuery query = new org.ovirt.engine.ui.frontend.AsyncQuery(this, new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.models.vms.VmSnapshotListModel vmSnapshotListModel = ((org.ovirt.engine.ui.uicommonweb.models.vms.VmSnapshotListModel) (model)); org.ovirt.engine.core.common.businessentities.VDS vds = ((org.ovirt.engine.core.common.businessentities.VDS) (returnValue)); vmSnapshotListModel.setLiveMergeSupported(vds.getLiveMergeSupport()); } }); org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().getHostById(query, vm.getRunOnVds()); }
@java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { defaultType = org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().getDefaultNicType(((java.util.Collection<org.ovirt.engine.core.common.businessentities.network.VmInterfaceType>) (returnValue))); supportedInterfaceTypes = ((java.util.Collection<org.ovirt.engine.core.common.businessentities.network.VmInterfaceType>) (returnValue)); org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().getVmNicList(getNicsQuery, vmId); }
private void populate(java.util.Map<java.lang.String, java.lang.Boolean> bondsWithStatus, java.util.List<org.ovirt.engine.core.common.businessentities.Network> clusterNetworks, java.util.List<java.lang.String> networks, java.util.Map<java.lang.String, java.util.List<java.lang.String>> bondsWithListOfNics, org.ovirt.engine.core.common.businessentities.VdsNetworkInterface iface) { org.ovirt.engine.core.utils.Pair<java.lang.Boolean, java.lang.String> retVal = isRequiredNetworkInCluster(iface.getBondName(), clusterNetworks); java.lang.String networkName = retVal.getSecond(); if (retVal.getFirst()) { if (!(bondsWithStatus.containsKey(iface.getBondName()))) { bondsWithStatus.put(iface.getBondName(), false); } bondsWithStatus.put(iface.getBondName(), ((bondsWithStatus.get(iface.getBondName())) || ((iface.getStatistics().getStatus()) == (org.ovirt.engine.core.common.businessentities.InterfaceStatus.Up)))); if ((!(networks.contains(networkName))) && (!(bondsWithStatus.containsKey(iface.getName())))) { networks.add(networkName); } else if ((networks.contains(networkName)) && (bondsWithStatus.get(iface.getBondName()))) { networks.remove(networkName); } if (!(bondsWithListOfNics.containsKey(iface.getBondName()))) { bondsWithListOfNics.put(iface.getBondName(), new java.util.ArrayList<java.lang.String>()); } bondsWithListOfNics.get(iface.getBondName()).add(iface.getName()); } }
@java.lang.Override protected org.ovirt.engine.api.model.VM doPopulate(org.ovirt.engine.api.model.VM model, org.ovirt.engine.core.common.businessentities.VM entity) { setPayload(model); setBallooning(model); setConsoleDevice(model); setVirtioScsiController(model); setCertificateInfo(model); setVmOvfConfiguration(model, entity); return model; }
@java.lang.Override @org.ovirt.engine.core.utils.timer.OnTimerMethodAnnotation("perform") public void perform() { if ((this.manager.isMonitoringNeeded()) && (getRefreshStatistics())) { org.ovirt.engine.core.vdsbroker.VmsListFetcher fetcher = new org.ovirt.engine.core.vdsbroker.VmsStatisticsFetcher(this.manager); fetcher.fetch(); new org.ovirt.engine.core.vdsbroker.VmsMonitoring(this.manager, fetcher.getChangedVms(), fetcher.getVmsWithChangedDevices(), this.auditLogDirector).perform(); } }
@org.junit.Test public void testUpdateMovingCluster() throws java.lang.Exception { setUpGetEntityExpectations(3); setUpEntityQueryExpectations(VdcQueryType.GetVdsGroupByVdsGroupId, org.ovirt.engine.core.common.queries.IdQueryParameters.class, new java.lang.String[]{ "Id" }, new java.lang.Object[]{ GUIDS[1] }, getVdsGroupEntity()); setUpGetPayloadExpectations(0, 2); setUpGetBallooningExpectations(); setUpGetBallooningExpectations(); setUpGetConsoleExpectations(0); setUpGetVmOvfExpectations(0); setUpGetVirtioScsiExpectations(0); setUpGetSoundcardExpectations(0); setUpGetRngDeviceExpectations(0); setUriInfo(setUpActionExpectations(VdcActionType.ChangeVMCluster, org.ovirt.engine.core.common.action.ChangeVMClusterParameters.class, new java.lang.String[]{ "ClusterId", "VmId" }, new java.lang.Object[]{ GUIDS[1], GUIDS[0] }, true, true, false)); setUpActionExpectations(VdcActionType.UpdateVm, org.ovirt.engine.core.common.action.VmManagementParametersBase.class, new java.lang.String[]{ }, new java.lang.Object[]{ }, true, true); org.ovirt.engine.api.model.VM model = org.ovirt.engine.api.restapi.resource.BackendVmsResourceTest.getModel(0); model.setId(GUIDS[0].toString()); model.setCluster(new org.ovirt.engine.api.model.Cluster()); model.getCluster().setId(GUIDS[1].toString()); verifyModelOnNewCluster(resource.update(model), 0); }
@org.codehaus.jackson.annotate.JsonIgnore public double getActualDiskWithSnapshotsSizeInBytes() { return (getActualDiskWithSnapshotsSize()) * (org.ovirt.engine.core.common.utils.SizeConverter.BYTES_IN_GB); }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.scheduling.ClusterPolicy> getAll() { java.util.List<org.ovirt.engine.core.common.scheduling.ClusterPolicy> clusterPolicies = super.getAll(); java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.scheduling.ClusterPolicy> map = new java.util.HashMap<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.scheduling.ClusterPolicy>(); for (org.ovirt.engine.core.common.scheduling.ClusterPolicy clusterPolicy : clusterPolicies) { map.put(clusterPolicy.getId(), clusterPolicy); } java.util.List<org.ovirt.engine.core.dao.scheduling.ClusterPolicyDaoImpl.ClusterPolicyUnit> clusterPolicyUnits = getCallsHandler().executeReadList("GetAllFromClusterPolicyUnits", createClusterPolicyUnitRowMapper(), getCustomMapSqlParameterSource()); fillClusterPolicy(map, clusterPolicyUnits); return clusterPolicies; }
public void setVm(boolean vm) { this.vm = vm; }
public java.lang.Long getBootTime() { return this.mVdsStatistics.getboot_time(); }
@java.lang.Override public com.google.gwt.safehtml.shared.SafeHtml getTooltip(org.ovirt.engine.ui.uicommonweb.models.vms.register.RegisterVmData registerVmData) { java.lang.String problem; if ((registerVmData.getError()) != null) { problem = registerVmData.getError(); } else { problem = registerVmData.getWarning(); } return problem == null ? null : new com.google.gwt.safehtml.shared.SafeHtmlBuilder().appendEscapedLines(problem).toSafeHtml(); }
@java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { clusterSelectedItemChanged(); }
@java.lang.Override public java.lang.String getVerb(org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkItemModel<?> op1) { return org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getMessages().detachNetwork(op1.getName()); }
public void testOvfDataUpdaterRunWithUpdateAndRemoveLowerThanCount(boolean ovfOnAnyDomainSupported) { int size = (org.ovirt.engine.core.bll.ProcessOvfUpdateForStoragePoolCommandTest.ITEMS_COUNT_PER_UPDATE) - 1; doReturn(ovfOnAnyDomainSupported).when(command).ovfOnAnyDomainSupported(any(org.ovirt.engine.core.common.businessentities.StoragePool.class)); java.util.List<org.ovirt.engine.core.compat.Guid> vmGuids = generateGuidList(size); addVms(vmGuids, 2, VMStatus.Down, ImageStatus.OK, pool1.getId()); java.util.List<org.ovirt.engine.core.compat.Guid> templatesGuids = generateGuidList(size); addTemplates(templatesGuids, 2, VmTemplateStatus.OK, ImageStatus.OK, pool1.getId()); java.util.List<org.ovirt.engine.core.compat.Guid> removedGuids = generateGuidList(size); initTestForPool(pool1, vmGuids, templatesGuids, removedGuids); executeCommand(); verify(command, times(numberOfTimesToBeCalled(size, true))).performOvfUpdate(any(org.ovirt.engine.core.common.businessentities.StoragePool.class), anyMap()); if (!ovfOnAnyDomainSupported) { verify(ovfUpdateProcessHelper, times(size)).executeRemoveVmInSpm(any(org.ovirt.engine.core.compat.Guid.class), any(org.ovirt.engine.core.compat.Guid.class), any(org.ovirt.engine.core.compat.Guid.class)); } java.util.List<org.ovirt.engine.core.compat.Guid> needToBeUpdated = new java.util.LinkedList<org.ovirt.engine.core.compat.Guid>(vmGuids); needToBeUpdated.addAll(templatesGuids); verifyCorrectOvfDataUpdaterRun(pool1, needToBeUpdated, removedGuids); }
private void onSavePostNameValidation() { org.ovirt.engine.ui.uicommonweb.models.storage.StorageModel model = ((org.ovirt.engine.ui.uicommonweb.models.storage.StorageModel) (getWindow())); if (!(model.validate())) { return; } if ((model.getCurrentStorageItem()) instanceof org.ovirt.engine.ui.uicommonweb.models.storage.NfsStorageModel) { saveNfsStorage(); } else if ((model.getCurrentStorageItem()) instanceof org.ovirt.engine.ui.uicommonweb.models.storage.LocalStorageModel) { saveLocalStorage(); } else if ((model.getCurrentStorageItem()) instanceof org.ovirt.engine.ui.uicommonweb.models.storage.PosixStorageModel) { savePosixStorage(); } else { saveSanStorage(); } }
public void restartGluster() { org.ovirt.engine.core.common.action.gluster.GlusterServiceParameters parameters = new org.ovirt.engine.core.common.action.gluster.GlusterServiceParameters(getEntity().getClusterId(), getEntity().getId(), org.ovirt.engine.core.common.businessentities.gluster.ServiceType.GLUSTER, "restart"); org.ovirt.engine.ui.frontend.Frontend.getInstance().runAction(VdcActionType.ManageGlusterService, parameters); }
public static void initLinuxOsTypes() { org.ovirt.engine.ui.frontend.AsyncQuery callback = new org.ovirt.engine.ui.frontend.AsyncQuery(); callback.asyncCallback = new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.linuxOsIds = ((java.util.ArrayList<java.lang.Integer>) (((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (returnValue)).getReturnValue())); } }; org.ovirt.engine.ui.frontend.Frontend.RunQuery(VdcQueryType.OsRepository, new org.ovirt.engine.core.common.queries.OsQueryParameters(OsRepositoryVerb.GetLinuxOss), callback); }
private void updateActionAvailability() { boolean allowRestore = false; boolean allowDelete = true; boolean allowDeleteAll = true; boolean allowActivate = false; boolean allowDeactivate = false; if (((getSelectedItems()) == null) || ((getSelectedItems().size()) == 0)) { allowDelete = false; } else { java.util.List<org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeSnapshotEntity> snapshots = org.ovirt.engine.ui.uicommonweb.Linq.<org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeSnapshotEntity>cast(getSelectedItems()); if ((snapshots.size()) == 1) { allowRestore = true; allowActivate = (snapshots.get(0).getStatus()) == (org.ovirt.engine.core.common.businessentities.gluster.GlusterSnapshotStatus.DEACTIVATED); allowDeactivate = (snapshots.get(0).getStatus()) == (org.ovirt.engine.core.common.businessentities.gluster.GlusterSnapshotStatus.ACTIVATED); } } getRestoreSnapshotCommand().setIsExecutionAllowed(allowRestore); getDeleteSnapshotCommand().setIsExecutionAllowed(allowDelete); getDeleteAllSnapshotsCommand().setIsExecutionAllowed(allowDeleteAll); getActivateSnapshotCommand().setIsExecutionAllowed(allowActivate); getDeactivateSnapshotCommand().setIsExecutionAllowed(allowDeactivate); }
@java.lang.Override protected void setActionMessageParameters() { addValidationMessage(EngineMessage.VAR__TYPE__CLUSTER); addValidationMessage(EngineMessage.VAR__ACTION__REMOVE); }
public static void getNetworkList(org.ovirt.engine.ui.frontend.AsyncQuery aQuery, org.ovirt.engine.core.compat.Guid dataCenterId) { aQuery.converterCallback = new org.ovirt.engine.ui.frontend.IAsyncConverter() { @java.lang.Override public java.lang.Object Convert(java.lang.Object source, org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery) { return source != null ? ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.network.Network>) (source)) : new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.network.Network>(); } }; org.ovirt.engine.ui.frontend.Frontend.RunQuery(VdcQueryType.GetAllNetworks, new org.ovirt.engine.core.common.queries.IdQueryParameters(dataCenterId), aQuery); }
@org.ovirt.engine.ui.webadmin.Source("images/glusterAsyncTasks/remove_brick_failed.png") com.google.gwt.resources.client.ImageResource removeBrickFailed();
public boolean canRunVm(java.util.List<java.lang.String> messages, org.ovirt.engine.core.common.businessentities.StoragePool storagePool, java.util.List<org.ovirt.engine.core.compat.Guid> vdsBlackList, java.util.List<org.ovirt.engine.core.compat.Guid> vdsWhiteList, org.ovirt.engine.core.compat.Guid destVds, org.ovirt.engine.core.common.businessentities.VDSGroup vdsGroup) { if (((((((((!(validateVmProperties(vm, messages))) || (!(validate(validateBootSequence(vm, runVmParam.getBootSequence(), getVmDisks()), messages)))) || (!(validate(new org.ovirt.engine.core.bll.validator.VmValidator(vm).vmNotLocked(), messages)))) || (!(validate(getSnapshotValidator().vmNotDuringSnapshot(vm.getId()), messages)))) || (!(validate(validateVmStatusUsingMatrix(vm), messages)))) || (!(validate(validateIsoPath(vm, runVmParam.getDiskPath(), runVmParam.getFloppyPath()), messages)))) || (!(validate(vmDuringInitialization(vm), messages)))) || (!(validate(validateVdsStatus(vm), messages)))) || (!(validate(validateStatelessVm(vm, getVmDisks(), runVmParam.getRunAsStateless()), messages)))) { return false; } java.util.List<org.ovirt.engine.core.common.businessentities.DiskImage> images = org.ovirt.engine.core.bll.ImagesHandler.filterImageDisks(getVmDisks(), true, false, false); if ((!(images.isEmpty())) && (((!(validate(validateStoragePoolUp(vm, storagePool), messages))) || (!(validate(validateStorageDomains(vm, isInternalExecution, images), messages)))) || (!(validate(validateImagesForRunVm(vm, images), messages))))) { return false; } if (!(org.ovirt.engine.core.bll.scheduling.SchedulingManager.getInstance().canSchedule(vdsGroup, vm, vdsBlackList, vdsWhiteList, destVds, messages))) { return false; } return true; }
private static boolean isQosInSync(org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface iface, org.ovirt.engine.core.common.businessentities.network.NetworkQoS networkQos) { org.ovirt.engine.core.common.businessentities.network.NetworkQoS ifaceQos = iface.getQos(); if (ifaceQos == networkQos) { return true; } else if ((ifaceQos == null) || (networkQos == null)) { return false; } else { return ifaceQos.equalValues(networkQos); } }
@java.lang.Override public org.ovirt.engine.api.model.DataCenter update(org.ovirt.engine.api.model.DataCenter incoming) { validateEnums(org.ovirt.engine.api.model.DataCenter.class, incoming); return performUpdate(incoming, new org.ovirt.engine.api.restapi.resource.QueryIdResolver(org.ovirt.engine.core.common.queries.VdcQueryType.GetStoragePoolById, org.ovirt.engine.core.common.queries.StoragePoolQueryParametersBase.class), VdcActionType.UpdateStoragePool, new org.ovirt.engine.api.restapi.resource.BackendDataCenterResource.UpdateParametersProvider()); }
public void setRdpImplementation(org.ovirt.engine.ui.uicommonweb.models.vms.RdpConsoleModel.ClientConsoleMode consoleMode) { this.clientConsoleMode = consoleMode; switch (consoleMode) { case Native : setrdp(((org.ovirt.engine.ui.uicommonweb.models.vms.IRdp) (org.ovirt.engine.ui.uicommonweb.TypeResolver.getInstance().resolve(org.ovirt.engine.ui.uicommonweb.models.vms.IRdpNative.class)))); break; case Plugin : setrdp(((org.ovirt.engine.ui.uicommonweb.models.vms.IRdp) (org.ovirt.engine.ui.uicommonweb.TypeResolver.getInstance().resolve(org.ovirt.engine.ui.uicommonweb.models.vms.IRdpPlugin.class)))); break; default : org.ovirt.engine.ui.uicommonweb.models.vms.IRdpPlugin impl = ((org.ovirt.engine.ui.uicommonweb.models.vms.IRdpPlugin) (org.ovirt.engine.ui.uicommonweb.TypeResolver.getInstance().resolve(org.ovirt.engine.ui.uicommonweb.models.vms.IRdpPlugin.class))); setrdp((consoleUtils.isBrowserPluginSupported(ConsoleProtocol.RDP) ? impl : ((org.ovirt.engine.ui.uicommonweb.models.vms.IRdp) (org.ovirt.engine.ui.uicommonweb.TypeResolver.getInstance().resolve(org.ovirt.engine.ui.uicommonweb.models.vms.IRdpNative.class))))); break; } }
public void setName(java.lang.String value) { if (!(org.ovirt.engine.core.compat.StringHelper.stringsEqual(name, value))) { name = value; onPropertyChanged(new org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs(org.ovirt.engine.ui.uicommonweb.models.providers.ProviderGeneralModel.PROPERTY_NAME)); } }
public void setTasksMonitored(boolean tasksMonitored) { this.tasksMonitored = tasksMonitored; }
@java.lang.Override public javax.ws.rs.core.Response add(org.ovirt.engine.api.model.StorageConnection storageConnection) { validateParameters(storageConnection, "id"); return performAction(VdcActionType.AttachStorageConnectionToStorageDomain, new org.ovirt.engine.core.common.action.AttachDetachStorageConnectionParameters(storageDomainId, storageConnection.getId())); }
private void applyNextRunConfiguration() { org.ovirt.engine.core.common.businessentities.Snapshot runSnap = getSnapshotDAO().get(org.ovirt.engine.core.bll.ProcessDownVmCommand.getVmId(), SnapshotType.NEXT_RUN); if (runSnap != null) { getSnapshotDAO().remove(runSnap.getId()); java.util.Date originalCreationDate = org.ovirt.engine.core.bll.ProcessDownVmCommand.getVm().getVmCreationDate(); new org.ovirt.engine.core.bll.snapshots.SnapshotsManager().updateVmFromConfiguration(org.ovirt.engine.core.bll.ProcessDownVmCommand.getVm(), runSnap.getVmConfiguration()); org.ovirt.engine.core.bll.ProcessDownVmCommand.getVm().setVmCreationDate(originalCreationDate); org.ovirt.engine.core.bll.Backend.getInstance().runInternalAction(VdcActionType.UpdateVm, createUpdateVmParameters()); } }
private void edit(org.ovirt.engine.ui.uicommonweb.models.ListModel model, final boolean topTableIsEdited) { org.ovirt.engine.ui.common.widget.editor.EntityModelCellTable<org.ovirt.engine.ui.uicommonweb.models.ListModel> table = getTable(topTableIsEdited); org.ovirt.engine.ui.uicommonweb.models.ListModel oldModel = table.asEditor().flush(); org.ovirt.engine.ui.uicompat.IEventListener listener = (topTableIsEdited) ? topItemsChangedListener : bottomItemsChangedListener; if (oldModel != null) { oldModel.getItemsChangedEvent().removeListener(listener); } model.getItemsChangedEvent().addListener(listener); table.asEditor().edit(model); }
private java.lang.String getDiskIsBeingMigratedMessage() { if ((cachedDiskIsBeingMigratedMessage) == null) { cachedDiskIsBeingMigratedMessage = new org.ovirt.engine.core.bll.LockMessage(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_DISK_IS_BEING_MIGRATED).withOptional("DiskName", ((getImage()) != null ? getDiskAlias() : null)).toString(); } return cachedDiskIsBeingMigratedMessage; }
@java.lang.Override public java.lang.Object Convert(java.lang.Object source, org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery) { if (source != null) { return source; } return new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.DiskImage>(); }
@org.ovirt.engine.ui.frontend.DefaultStringValue("Cannot ${action} ${type}. Values are out of range\n(Legal range is: ${range}).") java.lang.String ACTION_TYPE_FAILED_QOS_OUT_OF_RANGE_VALUES();
@java.lang.Override public void edit(final org.ovirt.engine.ui.uicommonweb.models.vms.VnicInstanceType model) { driver.edit(model); profileEditor.addLabelStyleName(style.noDisplay()); profileEditor.addContentWidgetStyleName(style.contentStyle()); profileEditor.setElementId(org.ovirt.engine.ui.common.utils.ElementIdUtils.createElementId(elementId, model.getNetworkInterface().getName())); syncSelectedItemWithNetworkInterface(model); model.getSelectedItemChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener<org.ovirt.engine.ui.uicompat.EventArgs>() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.EventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { syncSelectedItemWithNetworkInterface(model); com.google.gwt.event.logical.shared.ValueChangeEvent.fire(org.ovirt.engine.ui.common.widget.profile.ProfileInstanceTypeEditor.this, model); } }); }
@java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.EventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { clearVms(); exportDomain.setEntity(null); org.ovirt.engine.core.common.businessentities.StoragePool dataCenter = dataCenters.getSelectedItem(); org.ovirt.engine.ui.frontend.Frontend.getInstance().runQuery(VdcQueryType.GetStorageDomainsByStoragePoolId, new org.ovirt.engine.core.common.queries.IdQueryParameters(dataCenter.getId()), new org.ovirt.engine.ui.frontend.AsyncQuery(this, createGetStorageDomainsByStoragePoolIdCallback(dataCenter))); }
@java.lang.Override public int hashCode() { return java.util.Objects.hash(getId(), parentDeviceName, capability, iommuGroup, productName, productId, vendorName, vendorId, parentPhysicalFunction, totalVirtualFunctions, networkInterfaceName, driver, assignable, vmId); }
@java.lang.Override public void flush(org.ovirt.engine.core.common.businessentities.qos.StorageQos storageQos) { storageQos.setMaxThroughput(null); storageQos.setMaxReadThroughput(null); storageQos.setMaxWriteThroughput(null); if (getThroughput().getChoiceGroupTotal().getEntity()) { storageQos.setMaxThroughput(getThroughput().getTotal().getEntity()); } else if (getThroughput().getChoiceGroupReadWrite().getEntity()) { storageQos.setMaxReadThroughput(getThroughput().getRead().getEntity()); storageQos.setMaxWriteThroughput(getThroughput().getWrite().getEntity()); } storageQos.setMaxIops(null); storageQos.setMaxReadIops(null); storageQos.setMaxWriteIops(null); if (getIops().getChoiceGroupTotal().getEntity()) { storageQos.setMaxIops(getIops().getTotal().getEntity()); } else if (getIops().getChoiceGroupReadWrite().getEntity()) { storageQos.setMaxReadIops(getIops().getRead().getEntity()); storageQos.setMaxWriteIops(getIops().getWrite().getEntity()); } }
@java.lang.Override public void render(org.ovirt.engine.ui.webadmin.widget.table.column.Context context, org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity volume, com.google.gwt.safehtml.shared.SafeHtmlBuilder sb) { if (volume == null) { return; } org.ovirt.engine.ui.frontend.utils.GlusterVolumeUtils.VolumeStatus status = org.ovirt.engine.ui.frontend.utils.GlusterVolumeUtils.getVolumeStatus(volume); com.google.gwt.resources.client.ImageResource statusImage = getStatusImage(status); java.lang.String tooltip = getToolTip(status); com.google.gwt.safehtml.shared.SafeHtml statusImageHtml = com.google.gwt.safehtml.shared.SafeHtmlUtils.fromTrustedString(com.google.gwt.user.client.ui.AbstractImagePrototype.create(statusImage).getHTML()); sb.append(applicationTemplates.statusTemplate(statusImageHtml, tooltip)); }
private void run() { org.ovirt.engine.core.common.businessentities.VM entity = ((org.ovirt.engine.core.common.businessentities.VM) (getItem().getEntity())); org.ovirt.engine.core.common.action.RunVmParams tempVar = new org.ovirt.engine.core.common.action.RunVmParams(entity.getId()); if ((!(entity.isInitialized())) && (org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.isWindowsOsType(entity.getVmOsId()))) { tempVar.setInitializationType(InitializationType.Sysprep); } else if ((!(entity.isInitialized())) && (org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.isLinuxOsType(entity.getVmOsId()))) { tempVar.setInitializationType(InitializationType.CloudInit); } else { tempVar.setInitializationType(InitializationType.None); } org.ovirt.engine.ui.frontend.Frontend.RunAction(VdcActionType.RunVm, tempVar); }
private boolean refreshVdsmFileList(org.ovirt.engine.core.compat.Guid repoStoragePoolId, org.ovirt.engine.core.compat.Guid repoStorageDomainId, org.ovirt.engine.core.bll.IsoDomainListSyncronizer.FileListRefreshed fileListRefreshed, org.ovirt.engine.core.common.businessentities.storage.ImageFileType imageFileType, org.ovirt.engine.core.common.vdscommands.VDSReturnValue fileStats) { if ((repoStorageDomainId == null) || (fileStats == null)) { return false; } @java.lang.SuppressWarnings("unchecked") java.util.Map<java.lang.String, java.util.Map<java.lang.String, java.lang.Object>> fileStatsReturnValue = ((java.util.Map<java.lang.String, java.util.Map<java.lang.String, java.lang.Object>>) (fileStats.getReturnValue())); boolean vdsmRefreshOk = (fileStats.getSucceeded()) && (fileStatsReturnValue != null); org.ovirt.engine.core.bll.IsoDomainListSyncronizer.log.debug("The refresh process from VDSM, for {}, {}.", imageFileType, succeededOrFailed(vdsmRefreshOk)); if (!vdsmRefreshOk) { return false; } boolean refreshSucceeded = org.ovirt.engine.core.bll.IsoDomainListSyncronizer.refreshIsoFileListMetaData(repoStorageDomainId, repoStorageDom, fileStatsReturnValue, imageFileType); if (refreshSucceeded && (fileListRefreshed != null)) { fileListRefreshed.onFileListRefreshed(repoStoragePoolId, fileStatsReturnValue.keySet()); } return refreshSucceeded; }
@java.lang.Override protected void AsyncSearch() { super.AsyncSearch(); org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery = new org.ovirt.engine.ui.frontend.AsyncQuery(); _asyncQuery.setModel(this); _asyncQuery.asyncCallback = new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void OnSuccess(java.lang.Object model, java.lang.Object ReturnValue) { org.ovirt.engine.ui.uicommonweb.models.configure.roles_ui.RoleListModel roleListModel = ((org.ovirt.engine.ui.uicommonweb.models.configure.roles_ui.RoleListModel) (model)); java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Role> filteredList = new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Role>(); for (org.ovirt.engine.core.common.businessentities.Role item : ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.Role>) (((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (ReturnValue)).getReturnValue()))) { if (((roleListModel.getItemsFilter()) == null) || ((roleListModel.getItemsFilter()) == (item.getType()))) { filteredList.add(item); } } roleListModel.setItems(filteredList); } }; org.ovirt.engine.ui.frontend.Frontend.RunQuery(VdcQueryType.GetAllRoles, new org.ovirt.engine.core.common.queries.MultilevelAdministrationsQueriesParameters(), _asyncQuery); }
private void newSecret() { if ((getWindow()) != null) { return; } final org.ovirt.engine.ui.uicommonweb.models.storage.LibvirtSecretModel secretModel = createSecretModel(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().createSecretTitle(), HelpTag.create_secret, "create_secret"); setWindow(secretModel); secretModel.getUuid().setEntity(org.ovirt.engine.core.compat.Guid.newGuid().toString()); }
protected boolean disconnectStorageDomain(org.ovirt.engine.core.common.businessentities.StorageDomain storageDomain) { try { return org.ovirt.engine.core.bll.storage.StorageHelperDirector.getInstance().getItem(storageDomain.getStorageType()).disconnectStorageFromDomainByVdsId(storageDomain, getVdsId()); } catch (java.lang.RuntimeException e) { log.error("Exception while disconnecting a storage domain", e); return false; } }
public boolean IsFieldUpdatable(java.lang.Enum<?> status, java.lang.String name, java.lang.Object fieldContainer, boolean hotsetEnabled) { boolean returnValue = true; if (!(IsFieldUpdatable(name))) { if (((fieldContainer != null) && ((container) != null)) && (!(container.canUpdateField(fieldContainer, name, status)))) { returnValue = false; } else { java.util.Set<java.lang.String> values = dictionary.get(status); returnValue = (values != null) ? values.contains(name) : false; if ((!returnValue) && hotsetEnabled) { returnValue = isHotSetField(name); } } if (!returnValue) { org.ovirt.engine.core.utils.ObjectIdentityChecker.log.warn("Field '{}' can not be updated when status is '{}'", name, status); } } return returnValue; }
private void setType(org.ovirt.engine.ui.uicommonweb.models.ListModel value) { privateType = value; }
private void getMenuLayout(org.ovirt.engine.ui.webadmin.widget.tab.PrimaryMenuItem[] items, org.ovirt.engine.ui.webadmin.widget.tab.SecondaryMenuItem[] secondaryItems) { for (org.ovirt.engine.ui.webadmin.widget.tab.PrimaryMenuItem layout : items) { if ((layout.getHref()) != null) { org.ovirt.engine.ui.webadmin.widget.tab.MenuLayoutMenuDetails details = new org.ovirt.engine.ui.webadmin.widget.tab.MenuLayoutMenuDetails(); details.setPrimaryPriority(layout.getIndex()); details.setSecondaryTitle(layout.getTitle()); details.setIcon(layout.getIcon()); layoutMap.put(layout.getHref(), details); } } for (org.ovirt.engine.ui.webadmin.widget.tab.SecondaryMenuItem subMenu : secondaryItems) { org.ovirt.engine.ui.webadmin.widget.tab.MenuLayoutMenuDetails details = new org.ovirt.engine.ui.webadmin.widget.tab.MenuLayoutMenuDetails(); details.setPrimaryPriority(subMenu.getPrimaryMenu().getIndex()); details.setPrimaryTitle(subMenu.getPrimaryMenu().getTitle()); details.setSecondaryPriority(subMenu.getIndex()); details.setSecondaryTitle(subMenu.getTitle()); details.setIcon(subMenu.getIcon()); layoutMap.put(subMenu.getHref(), details); } }
private void logDeviceInformation(org.ovirt.engine.core.compat.Guid vmId, java.util.Map device) { java.lang.String message = "Received a {} Device without an address when processing VM {} devices, skipping device"; java.lang.String deviceType = ((java.lang.String) (device.get(VdsProperties.Device))); if (shouldLogDeviceDetails(deviceType)) { java.util.Map<java.lang.String, java.lang.Object> deviceInfo = device; org.ovirt.engine.core.vdsbroker.VmsMonitoring.log.info((message + ": {}"), org.apache.commons.lang.StringUtils.defaultString(deviceType), vmId, deviceInfo); } else { org.ovirt.engine.core.vdsbroker.VmsMonitoring.log.info(message, org.apache.commons.lang.StringUtils.defaultString(deviceType), vmId); } }
@org.junit.Test public void test0() { org.ovirt.engine.api.types.V4Vm object = vm().memory(0).build(); assertEquals("{'memory':0}", objectToJson(object)); }
@java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { getProviders().setIsChangable(false); providers_SelectedItemChanged(); updateHostList(); }
private void newVm() { if ((org.ovirt.engine.ui.uicommonweb.models.vms.VmListModel.getWindow()) != null) { return; } org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel model = new org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel(new org.ovirt.engine.ui.uicommonweb.models.vms.NewVmModelBehavior()); model.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().newVmTitle()); model.setHelpTag(HelpTag.new_vm); model.setHashName("new_vm"); model.setIsNew(true); model.getVmType().setSelectedItem(VmType.Server); model.setCustomPropertiesKeysList(org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().getCustomPropertiesList()); model.setIsAdvancedModeLocalStorageKey("wa_vm_dialog"); setWindow(model); model.initialize(getSystemTreeSelectedItem()); org.ovirt.engine.ui.uicommonweb.models.vms.VmBasedWidgetSwitchModeCommand switchModeCommand = new org.ovirt.engine.ui.uicommonweb.models.vms.VmBasedWidgetSwitchModeCommand(); switchModeCommand.init(model); model.getCommands().add(switchModeCommand); model.getProvisioning().setEntity(true); org.ovirt.engine.ui.uicommonweb.UICommand tempVar = org.ovirt.engine.ui.uicommonweb.UICommand.createDefaultOkUiCommand("OnSave", this); model.getCommands().add(tempVar); org.ovirt.engine.ui.uicommonweb.UICommand tempVar2 = org.ovirt.engine.ui.uicommonweb.UICommand.createCancelUiCommand("Cancel", this); model.getCommands().add(tempVar2); }
@java.lang.Override protected void setActionMessageParameters() { super.setActionMessageParameters(); addCanDoActionMessage(EngineMessage.VAR__TYPE__MAC__POOL); }
public void setHelpTag(org.ovirt.engine.ui.uicommonweb.help.HelpTag helpTag) { this.helpTag = helpTag; }
private void expandTree(com.google.gwt.user.cellview.client.TreeNode node, boolean expand, int expandFromLevel) { if (node == null) { return; } if ((node.getChildCount()) > 0) { for (int i = 0; i < (node.getChildCount()); i++) { boolean expandNode = (0 < expandFromLevel) ? !expand : expand; expandTree(node.setChildOpen(i, expandNode), expand, (expandFromLevel - 1)); } } }
protected void setResourceManager(org.ovirt.engine.core.vdsbroker.ResourceManager resourceManager) { this.resourceManager = resourceManager; }
@java.lang.Override public void execute() { if ((connected.getCount()) == 0) { connected = new java.util.concurrent.CountDownLatch(1); } if ((subscribed.getCount()) == 0) { subscribed = new java.util.concurrent.CountDownLatch(1); } org.ovirt.vdsm.jsonrpc.client.reactors.stomp.impl.Message message = new org.ovirt.vdsm.jsonrpc.client.reactors.stomp.impl.Message().connect().withHeader(org.ovirt.vdsm.jsonrpc.client.reactors.stomp.HEADER_ACCEPT, "1.2"); int outgoing = 0; int incoming = 0; if (policy.isIncomingHeartbeat()) { incoming = policy.getIncomingHeartbeat(); } if (policy.isOutgoingHeartbeat()) { outgoing = policy.getOutgoingHeartbeat(); } if ((incoming != 0) || (outgoing != 0)) { message.withHeader(org.ovirt.vdsm.jsonrpc.client.reactors.stomp.HEADER_HEART_BEAT, ((outgoing + ",") + (reduceGracePeriod(incoming)))); } send(message.build()); subscribtionId = java.util.UUID.randomUUID().toString(); send(new org.ovirt.vdsm.jsonrpc.client.reactors.stomp.impl.Message().subscribe().withHeader(org.ovirt.vdsm.jsonrpc.client.reactors.stomp.HEADER_DESTINATION, getResponseQueue()).withHeader(org.ovirt.vdsm.jsonrpc.client.reactors.stomp.HEADER_ID, subscribtionId).withHeader(org.ovirt.vdsm.jsonrpc.client.reactors.stomp.HEADER_ACK, "auto").build()); }
@java.lang.Override protected void executeQueryCommand() { clusterId = org.ovirt.engine.core.bll.gluster.GetGlusterVolumeRebalanceStatusQuery.getParameters().getClusterId(); org.ovirt.engine.core.compat.Guid volumeId = org.ovirt.engine.core.bll.gluster.GetGlusterVolumeRebalanceStatusQuery.getParameters().getVolumeId(); if (volumeId != null) { volume = org.ovirt.engine.core.bll.gluster.GetGlusterVolumeRebalanceStatusQuery.getGlusterVolumeDao().getById(volumeId); if ((volume) == null) { throw new java.lang.RuntimeException(VdcBllMessages.ACTION_TYPE_FAILED_GLUSTER_VOLUME_INVALID.toString()); } if ((clusterId) == null) { clusterId = volume.getClusterId(); } org.ovirt.engine.core.bll.gluster.GetGlusterVolumeRebalanceStatusQuery.getQueryReturnValue().setReturnValue(fetchTaskStatusDetails()); } }
private void validateQosNotPartiallyConfigured() { java.util.Set<java.lang.String> someSubInterfacesHaveQos = new java.util.HashSet<>(); java.util.Set<java.lang.String> notAllSubInterfacesHaveQos = new java.util.HashSet<>(); for (org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface iface : params.getInterfaces()) { org.ovirt.engine.core.common.businessentities.network.Network network = getExistingClusterNetworks().get(iface.getNetworkName()); java.lang.String baseIfaceName = org.ovirt.engine.core.utils.NetworkUtils.stripVlan(iface); if (org.ovirt.engine.core.utils.NetworkUtils.qosConfiguredOnInterface(iface, network)) { someSubInterfacesHaveQos.add(baseIfaceName); } else { notAllSubInterfacesHaveQos.add(baseIfaceName); } } for (java.lang.String ifaceName : someSubInterfacesHaveQos) { if (notAllSubInterfacesHaveQos.contains(ifaceName)) { addViolation(EngineMessage.ACTION_TYPE_FAILED_HOST_NETWORK_QOS_INTERFACES_WITHOUT_QOS, ifaceName); } } }
@org.ovirt.engine.ui.common.widget.table.cell.Template("<span class=\"fa {0} inline-icon\" style=\"{1}\"/>") com.google.gwt.safehtml.shared.SafeHtml icon(java.lang.String className, com.google.gwt.safecss.shared.SafeStyles styles);
@java.lang.Override public void edit(org.ovirt.engine.ui.uicommonweb.models.storage.StorageModel object) { driver.edit(object); final org.ovirt.engine.ui.uicommonweb.models.storage.StorageModel storageModel = object; storageModel.getSelectedItemChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener<org.ovirt.engine.ui.uicompat.EventArgs>() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.EventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { revealStorageView(storageModel); } }); storageModel.getDataCenterAlert().getEntityChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener<org.ovirt.engine.ui.uicompat.EventArgs>() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.EventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { datacenterAlertIcon.setVisible(storageModel.getDataCenterAlert().getIsAvailable()); datacenterAlertIcon.setTitle(storageModel.getDataCenterAlert().getEntity()); } }); }
public static org.ovirt.engine.core.bll.ValidationResult canRunActionOnNonManagedVm(org.ovirt.engine.core.common.businessentities.VM vm, org.ovirt.engine.core.common.action.VdcActionType actionType) { org.ovirt.engine.core.bll.ValidationResult validationResult = ValidationResult.VALID; if (((vm.isHostedEngine()) && (!(org.ovirt.engine.core.bll.VmHandler.COMMANDS_ALLOWED_ON_HOSTED_ENGINE.contains(actionType)))) || ((vm.isExternalVm()) && (!(org.ovirt.engine.core.bll.VmHandler.COMMANDS_ALLOWED_ON_EXTERNAL_VMS.contains(actionType))))) { validationResult = new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_CANNOT_RUN_ACTION_ON_NON_MANAGED_VM); } return validationResult; }
private void fastForwardDisksToActiveSnapshot() { if ((getParameters().getDisks()) != null) { java.util.List<org.ovirt.engine.core.common.businessentities.DiskImage> diskImagesToUpdate = org.ovirt.engine.core.bll.ImagesHandler.imagesSubtract(getDiskImagesForVm(), getParameters().getDisks()); for (org.ovirt.engine.core.common.businessentities.DiskImage diskImage : diskImagesToUpdate) { org.ovirt.engine.core.bll.CreateAllSnapshotsFromVmCommand.getImageDao().updateImageVmSnapshotId(diskImage.getImageId(), newActiveSnapshotId); } } }
private org.ovirt.engine.ui.uicommonweb.validation.ValidationResult failWith(java.lang.String errorMessage) { return new org.ovirt.engine.ui.uicommonweb.validation.ValidationResult(false, java.util.Arrays.asList(errorMessage)); }
protected void initTableColumns(org.ovirt.engine.ui.webadmin.ApplicationConstants constants) { deviceTable.addColumn(new org.ovirt.engine.ui.common.widget.table.column.AbstractTextColumn<org.ovirt.engine.core.common.businessentities.gluster.StorageDevice>() { @java.lang.Override public java.lang.String getValue(org.ovirt.engine.core.common.businessentities.gluster.StorageDevice entity) { return entity.getName(); } }, constants.deviceName()); deviceTable.addColumnAndSetWidth(new org.ovirt.engine.ui.common.widget.table.column.AbstractTextColumn<org.ovirt.engine.core.common.businessentities.gluster.StorageDevice>() { @java.lang.Override public java.lang.String getValue(org.ovirt.engine.core.common.businessentities.gluster.StorageDevice entity) { return entity.getDevType(); } }, constants.deviceType(), "100px"); deviceTable.addColumnAndSetWidth(new org.ovirt.engine.ui.common.widget.table.column.AbstractTextColumn<org.ovirt.engine.core.common.businessentities.gluster.StorageDevice>() { @java.lang.Override public java.lang.String getValue(org.ovirt.engine.core.common.businessentities.gluster.StorageDevice entity) { org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.common.utils.SizeConverter.SizeUnit, java.lang.Double> convertedSize = org.ovirt.engine.core.common.utils.SizeConverter.autoConvert(entity.getSize(), SizeUnit.MB); return ((formatSize(convertedSize.getSecond())) + " ") + (convertedSize.getFirst().toString()); } }, constants.size(), "100px"); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Templates already exist") java.lang.String templateAlreadyExistsMsg();
@java.lang.Override protected boolean canDoAction() { org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity volume = getGlusterVolume(); if (!(super.canDoAction())) { return false; } if (!(validate(getBrickValidator().canStopOrCommitRemoveBrick(volume, getParameters().getBricks())))) { return false; } if ((!(getGlusterTaskUtils().isTaskOfType(volume, GlusterTaskType.REMOVE_BRICK))) || (!((getGlusterTaskUtils().isTaskStatus(volume, JobExecutionStatus.STARTED)) || (getGlusterTaskUtils().isTaskStatus(volume, JobExecutionStatus.FINISHED))))) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_GLUSTER_VOLUME_REMOVE_BRICKS_NOT_STARTED); } return true; }
@java.lang.Override protected void executeQueryCommand() { java.util.List<org.ovirt.engine.core.common.businessentities.OvfEntityData> entityList = getOvfEntityList(VmEntityType.TEMPLATE); java.util.List<org.ovirt.engine.core.common.businessentities.VmTemplate> vmTemplates = new java.util.ArrayList<>(); for (org.ovirt.engine.core.common.businessentities.OvfEntityData ovf : entityList) { try { vmTemplates.add(ovfHelper.readVmTemplateFromOvf(ovf.getOvfData()).getVmTemplate()); } catch (org.ovirt.engine.core.utils.ovf.OvfReaderException e) { log.debug(("failed to parse a given ovf configuration: \n" + (ovf.getOvfData())), e); org.ovirt.engine.core.bll.GetUnregisteredVmTemplatesQuery.getQueryReturnValue().setExceptionString(("failed to parse a given ovf configuration " + (e.getMessage()))); } } org.ovirt.engine.core.bll.GetUnregisteredVmTemplatesQuery.getQueryReturnValue().setSucceeded(true); org.ovirt.engine.core.bll.GetUnregisteredVmTemplatesQuery.getQueryReturnValue().setReturnValue(vmTemplates); }
@java.lang.Override protected void setActionMessageParameters() { addValidationMessage(EngineMessage.VAR__ACTION__HOT_SET_MEMORY); addValidationMessage(EngineMessage.VAR__TYPE__VM); addValidationMessageVariable("clusterVersion", org.ovirt.engine.core.bll.HotSetAmountOfMemoryCommand.getVm().getVdsGroupCompatibilityVersion()); addValidationMessageVariable("architecture", org.ovirt.engine.core.bll.HotSetAmountOfMemoryCommand.getVm().getClusterArch()); }
private void validateSource() { clearProblem(); if (((importSources.getSelectedItem()) == (ImportSource.EXPORT_DOMAIN)) && ((exportDomain) == null)) { setError(constants.notAvailableWithNoActiveExportDomain()); } }
@java.lang.Override protected void setActionMessageParameters() { super.setActionMessageParameters(); addValidationMessage(EngineMessage.VAR__ACTION__EXTEND); }
@java.lang.Override protected void executeCommand() { org.ovirt.engine.core.common.vdscommands.VDSReturnValue vdsReturnValue = extendUnderlyingVolumeSize(org.ovirt.engine.core.bll.ExtendImageSizeCommand.getImage()); setSucceeded(vdsReturnValue.getSucceeded()); if (vdsReturnValue.getSucceeded()) { org.ovirt.engine.core.compat.Guid taskId = createTask(org.ovirt.engine.core.bll.ExtendImageSizeCommand.getAsyncTaskId(), vdsReturnValue.getCreationInfo(), org.ovirt.engine.core.bll.ExtendImageSizeCommand.getParameters().getParentCommand()); org.ovirt.engine.core.bll.ExtendImageSizeCommand.getReturnValue().getInternalVdsmTaskIdList().add(taskId); } else { updateAuditLog(AuditLogType.USER_EXTEND_DISK_SIZE_FAILURE, org.ovirt.engine.core.bll.ExtendImageSizeCommand.getParameters().getNewSizeInGB()); } }
@java.lang.Override public void setEntity(E value) { if ((getEntity()) == null) { entityModel.setEntity(value); return; } if (value != null) { if (!(((org.ovirt.engine.core.common.businessentities.IVdcQueryable) (value)).getQueryableId().equals(((org.ovirt.engine.core.common.businessentities.IVdcQueryable) (getEntity())).getQueryableId()))) { entityModel.setEntity(value); return; } } if (!(getEntity().equals(value))) { entityModel.setEntity(value); return; } setEntity(value, false); }
@org.junit.Test public void canDoActionFailsOnNoConflictServers() { cmd = spy(new org.ovirt.engine.core.bll.gluster.UpdateGlusterHookCommand(new org.ovirt.engine.core.common.action.gluster.GlusterHookManageParameters(HOOK_ID))); org.ovirt.engine.core.common.businessentities.gluster.GlusterHookEntity hook = getHookEntity(); hook.setServerHooks(java.util.Collections.singletonList(getGlusterServerHook(0, GlusterHookStatus.MISSING))); setUpMocksForUpdate(true, hook); assertFalse(cmd.canDoAction()); assertTrue(cmd.getReturnValue().getCanDoActionMessages().contains(VdcBllMessages.ACTION_TYPE_FAILED_GLUSTER_HOOK_NO_CONFLICT_SERVERS.toString())); }
@java.lang.Override protected boolean canDoAction() { if (!(super.canDoAction())) { return false; } if ((userProfileDao.getByUserId(org.ovirt.engine.core.bll.UpdateUserProfileCommand.getUserId())) == null) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_PROFILE_NOT_EXIST); } return true; }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("Mbps") java.lang.String mbpsLabelStorageQosPopup();
public org.ovirt.engine.core.bll.ValidationResult externalNetworkIsVmNetwork() { return network.isVmNetwork() ? org.ovirt.engine.core.bll.ValidationResult.VALID : new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_EXTERNAL_NETWORK_MUST_BE_VM_NETWORK); }
private org.ovirt.engine.ui.webadmin.widget.table.column.MenuCell<org.ovirt.engine.core.common.businessentities.gluster.GlusterTaskSupport> getRemoveBrickActivityMenu(org.ovirt.engine.ui.webadmin.ApplicationConstants constants) { org.ovirt.engine.ui.webadmin.widget.table.column.MenuCell<org.ovirt.engine.core.common.businessentities.gluster.GlusterTaskSupport> menuCell = new org.ovirt.engine.ui.webadmin.widget.table.column.MenuCell<org.ovirt.engine.core.common.businessentities.gluster.GlusterTaskSupport>() { @java.lang.Override protected boolean isVisible(org.ovirt.engine.core.common.businessentities.gluster.GlusterTaskSupport value) { return ((value.getAsyncTask()) != null) && ((value.getAsyncTask().getType()) == (org.ovirt.engine.core.common.asynctasks.gluster.GlusterTaskType.REMOVE_BRICK)); } }; menuCell.addMenuItem(constants.removeBricksStop(), getMainModel().getBrickListModel().getStopRemoveBricksCommand()); menuCell.addMenuItem(constants.removeBricksCommit(), getMainModel().getBrickListModel().getCommitRemoveBricksCommand()); return menuCell; }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.compat.Guid, java.lang.Integer>> runScores(java.util.List<org.ovirt.engine.core.common.utils.Pair<java.lang.String, java.lang.Integer>> scoreNameAndWeight, java.util.List<org.ovirt.engine.core.compat.Guid> hostIDs, org.ovirt.engine.core.compat.Guid vmID, java.util.Map<java.lang.String, java.lang.String> propertiesMap) { try { if (scoreNameAndWeight.isEmpty()) { return null; } org.apache.xmlrpc.client.XmlRpcClient client = new org.apache.xmlrpc.client.XmlRpcClient(); client.setConfig(config); java.lang.Object result = client.execute(org.ovirt.engine.core.bll.scheduling.external.ExternalSchedulerBrokerImpl.SCORE, createScoreArgs(scoreNameAndWeight, hostIDs, vmID, propertiesMap)); return parseScoreResults(result); } catch (org.apache.xmlrpc.XmlRpcException e) { org.ovirt.engine.core.bll.scheduling.external.ExternalSchedulerBrokerImpl.log.error("Could not communicate with the external scheduler while running weight modules", e); auditLogFailedToConnect(); return null; } }
@org.junit.Test public void testNetworkAttachedToClusterWhenNotAttached() { org.ovirt.engine.core.common.businessentities.network.Network network = new org.ovirt.engine.core.common.businessentities.network.Network(); network.setId(org.ovirt.engine.core.compat.Guid.newGuid()); network.setName("networkName"); org.ovirt.engine.core.common.businessentities.network.NetworkAttachment attachment = new org.ovirt.engine.core.common.businessentities.network.NetworkAttachment(); attachment.setNetworkId(network.getId()); attachment.setNetworkName(network.getName()); org.ovirt.engine.core.common.businessentities.network.NetworkClusterId networkClusterId = new org.ovirt.engine.core.common.businessentities.network.NetworkClusterId(host.getClusterId(), network.getId()); when(networkClusterDaoMock.get(eq(networkClusterId))).thenReturn(null); when(networkDaoMock.get(eq(network.getId()))).thenReturn(network); org.ovirt.engine.core.common.errors.EngineMessage engineMessage = org.ovirt.engine.core.common.errors.EngineMessage.NETWORK_OF_GIVEN_NAME_NOT_EXISTS_IN_CLUSTER; assertThat(createNetworkAttachmentValidator(attachment).networkAttachedToCluster(), org.ovirt.engine.core.bll.validator.ValidationResultMatchers.failsWith(engineMessage, org.ovirt.engine.core.utils.ReplacementUtils.getVariableAssignmentString(engineMessage, network.getName()))); }
protected void listenOnRadioButtons(final org.ovirt.engine.ui.uicommonweb.models.userportal.IUserPortalListModel model) { registerHandler(getView().getRdpRadioButton().addValueChangeHandler(new com.google.gwt.event.logical.shared.ValueChangeHandler<java.lang.Boolean>() { @java.lang.Override public void onValueChange(com.google.gwt.event.logical.shared.ValueChangeEvent<java.lang.Boolean> event) { getView().rdpSelected(event.getValue()); getView().spiceSelected((!(event.getValue()))); getView().setWanOptionsVisible(((wanOptionsAvailable) && (!(event.getValue())))); } })); registerHandler(getView().getSpiceRadioButton().addValueChangeHandler(new com.google.gwt.event.logical.shared.ValueChangeHandler<java.lang.Boolean>() { @java.lang.Override public void onValueChange(com.google.gwt.event.logical.shared.ValueChangeEvent<java.lang.Boolean> event) { getView().spiceSelected(event.getValue()); getView().setWanOptionsVisible(((wanOptionsAvailable) && (event.getValue()))); getView().rdpSelected((!(event.getValue()))); } })); }
public org.ovirt.engine.ui.uicommonweb.models.gluster.HostGlusterStorageDevicesListModel getGlusterStorageDeviceListModel() { return glusterStorageDeviceListModel; }
@java.lang.Override public void OnSuccess(java.lang.Object model, java.lang.Object result) { getWindow().StopProgress(); org.ovirt.engine.core.common.queries.VdcQueryReturnValue returnValue = ((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (result)); if (returnValue == null) { onEmptyGlusterHosts(clusterModel); return; } else if (!(returnValue.getSucceeded())) { clusterModel.setMessage(returnValue.getExceptionString()); return; } java.util.Map<java.lang.String, java.lang.String> hostMap = ((java.util.Map<java.lang.String, java.lang.String>) (returnValue.getReturnValue())); if (hostMap == null) { onEmptyGlusterHosts(clusterModel); return; } if ((hostMap.containsValue(null)) || (hostMap.containsValue(""))) { onGlusterHostsWithoutFingerprint(hostMap, clusterModel); return; } java.util.ArrayList<org.ovirt.engine.ui.uicommonweb.models.EntityModel> list = new java.util.ArrayList<org.ovirt.engine.ui.uicommonweb.models.EntityModel>(); for (java.util.Map.Entry<java.lang.String, java.lang.String> host : hostMap.entrySet()) { org.ovirt.engine.ui.uicommonweb.models.hosts.HostDetailModel hostModel = new org.ovirt.engine.ui.uicommonweb.models.hosts.HostDetailModel(host.getKey(), host.getValue()); hostModel.setName(host.getKey()); hostModel.setPassword(""); org.ovirt.engine.ui.uicommonweb.models.EntityModel entityModel = new org.ovirt.engine.ui.uicommonweb.models.EntityModel(hostModel); list.add(entityModel); } importClusterHosts(clusterModel, list); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Allow to create vNIC Profile") java.lang.String allowToCreateVnicProfileRoleTreeTooltip();
private void handleAnyChildSPMTaskCompletion(boolean succeeded) { java.util.List<org.ovirt.engine.core.compat.Guid> childCommandIds = org.ovirt.engine.core.bll.tasks.CommandCoordinatorUtil.getChildCommandIds(org.ovirt.engine.core.bll.MergeExtendCommand.getCommandId()); if (childCommandIds.isEmpty()) { return; } org.ovirt.engine.core.compat.Guid currentChildId = childCommandIds.get(0); org.ovirt.engine.core.bll.MergeExtendCommand.log.info("Handling child command {} completion", currentChildId); if (!(org.ovirt.engine.core.compat.Guid.isNullOrEmpty(currentChildId))) { org.ovirt.engine.core.bll.CommandBase<?> command = org.ovirt.engine.core.bll.tasks.CommandCoordinatorUtil.retrieveCommand(currentChildId); org.ovirt.engine.core.common.businessentities.CommandEntity cmdEntity = org.ovirt.engine.core.bll.tasks.CommandCoordinatorUtil.getCommandEntity(currentChildId); if (((command != null) && (cmdEntity != null)) && (!(cmdEntity.isCallbackNotified()))) { if (!succeeded) { command.getParameters().setTaskGroupSuccess(false); } org.ovirt.engine.core.bll.Backend.getInstance().endAction(VdcActionType.ExtendImageSize, command.getParameters(), org.ovirt.engine.core.bll.MergeExtendCommand.cloneContextAndDetachFromParent()); if (succeeded && (cmdEntity != null)) { cmdEntity.setCallbackNotified(true); } } } }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.Network> getAllForCluster(org.ovirt.engine.core.compat.Guid id) { return getAllForCluster(id, null, false); }
public java.lang.Integer calcMaxVCpu() { return org.ovirt.engine.core.common.utils.VmCpuCountHelper.calcMaxVCpu(vm.getStaticData(), vm.getClusterCompatibilityVersion()); }
private boolean canRemoveVmPool(org.ovirt.engine.core.compat.Guid vmPoolId) { return org.ovirt.engine.core.bll.RemoveVmPoolCommand.getVmPoolDao().getVmPoolsMapByVmPoolId(vmPoolId).isEmpty(); }
private void validateRemove() { if (((org.ovirt.engine.core.bll.storage.domain.ReduceSANStorageDomainDevicesCommand.getStorageDomain().getVgMetadataDevice()) == null) || ((org.ovirt.engine.core.bll.storage.domain.ReduceSANStorageDomainDevicesCommand.getStorageDomain().getFirstMetadataDevice()) == null)) { blockStorageDomainHelper.fillMetadataDevicesInfo(org.ovirt.engine.core.bll.storage.domain.ReduceSANStorageDomainDevicesCommand.getStorageDomain().getStorageStaticData(), org.ovirt.engine.core.bll.storage.domain.ReduceSANStorageDomainDevicesCommand.getParameters().getVdsId()); validateRetrievedMetadataDevices(); storageDomainStaticDao.update(org.ovirt.engine.core.bll.storage.domain.ReduceSANStorageDomainDevicesCommand.getStorageDomain().getStorageStaticData()); java.util.List<java.lang.String> metadataDevices = blockStorageDomainHelper.findMetadataDevices(org.ovirt.engine.core.bll.storage.domain.ReduceSANStorageDomainDevicesCommand.getStorageDomain(), org.ovirt.engine.core.bll.storage.domain.ReduceSANStorageDomainDevicesCommand.getParameters().getDevicesToReduce()); if (!(metadataDevices.isEmpty())) { org.ovirt.engine.core.bll.storage.domain.ReduceSANStorageDomainDevicesCommand.setCustomCommaSeparatedValues("deviceIds", metadataDevices); auditLogDirector.log(this, AuditLogType.USER_REDUCE_DOMAIN_DEVICES_FAILED_METADATA_DEVICES); throw new org.ovirt.engine.core.common.errors.EngineException(org.ovirt.engine.core.common.errors.EngineError.GeneralException, "Cannot perform on metadata devices"); } } validateFreeSpace(); }
public void getAllNetworkQos(org.ovirt.engine.core.compat.Guid dcId, org.ovirt.engine.ui.frontend.AsyncQuery query) { query.converterCallback = new org.ovirt.engine.ui.frontend.IAsyncConverter<java.util.List<org.ovirt.engine.core.common.businessentities.network.NetworkQoS>>() { @java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.network.NetworkQoS> Convert(java.lang.Object returnValue, org.ovirt.engine.ui.frontend.AsyncQuery asyncQuery) { java.util.List<org.ovirt.engine.core.common.businessentities.network.NetworkQoS> qosList = (returnValue == null) ? new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.network.NetworkQoS>() : ((java.util.List<org.ovirt.engine.core.common.businessentities.network.NetworkQoS>) (returnValue)); qosList.add(0, NetworkQoSModel.EMPTY_QOS); return qosList; } }; org.ovirt.engine.ui.frontend.Frontend.getInstance().runQuery(VdcQueryType.GetAllNetworkQosByStoragePoolId, new org.ovirt.engine.core.common.queries.IdQueryParameters(dcId), query); }
@java.lang.Override public java.lang.String getValue(org.ovirt.engine.core.common.businessentities.storage.Disk disk) { return (disk.getDiskStorageType()) == (org.ovirt.engine.core.common.businessentities.storage.DiskStorageType.IMAGE) ? ((org.ovirt.engine.core.common.businessentities.storage.DiskImage) (disk)).getImageId().toString() : null; }
public void setSpmPriority(java.lang.String spmPriority) { if (((this.spmPriority) == null) || (!(this.spmPriority.equals(spmPriority)))) { this.spmPriority = spmPriority; OnPropertyChanged(new org.ovirt.engine.core.compat.PropertyChangedEventArgs("SpmPriority")); } }
private void setConfigurationEntries(org.ovirt.engine.core.domains.DomainsConfigurationEntry domainNameEntry, org.ovirt.engine.core.domains.DomainsConfigurationEntry adUserNameEntry, org.ovirt.engine.core.domains.DomainsConfigurationEntry adPasswordEntry, org.ovirt.engine.core.domains.DomainsConfigurationEntry authModeEntry, org.ovirt.engine.core.domains.DomainsConfigurationEntry ldapServersEntry, org.ovirt.engine.core.domains.DomainsConfigurationEntry adUserIdEntry, org.ovirt.engine.core.domains.DomainsConfigurationEntry ldapProviderTypeEntry, org.ovirt.engine.core.domains.DomainsConfigurationEntry changePasswordUrlEntry) throws org.ovirt.engine.core.domains.ManageDomainsResult { configurationProvider.setConfigValue(ConfigValues.AdUserName, adUserNameEntry); configurationProvider.setConfigValue(ConfigValues.AdUserPassword, adPasswordEntry, false); configurationProvider.setConfigValue(ConfigValues.LdapServers, ldapServersEntry); configurationProvider.setConfigValue(ConfigValues.AdUserId, adUserIdEntry); configurationProvider.setConfigValue(ConfigValues.LDAPSecurityAuthentication, authModeEntry); configurationProvider.setConfigValue(ConfigValues.DomainName, domainNameEntry); configurationProvider.setConfigValue(ConfigValues.LDAPProviderTypes, ldapProviderTypeEntry); if (changePasswordMsg) { configurationProvider.setConfigValue(ConfigValues.ChangePasswordMsg, changePasswordUrlEntry); } }
private void onSaveHosts() { org.ovirt.engine.ui.uicommonweb.models.hosts.MultipleHostsModel hostsModel = ((org.ovirt.engine.ui.uicommonweb.models.hosts.MultipleHostsModel) (getWindow())); if (hostsModel == null) { return; } if (!(hostsModel.validate())) { return; } if ((hostsModel.getClusterModel().getClusterId()) != null) { addHosts(hostsModel); } else { OnSaveInternalWithModel(hostsModel.getClusterModel()); } }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Are you sure you want to Shut down the following Virtual Machines?") java.lang.String areYouSureYouWantToShutDownTheFollowingVirtualMachinesMsg();
@org.junit.Test public void validateFailsOnNoHook() { cmd = spy(new org.ovirt.engine.core.bll.gluster.AddGlusterHookCommand(new org.ovirt.engine.core.common.action.gluster.GlusterHookManageParameters(HOOK_ID))); setUpMocksForAdd(false); assertFalse(cmd.validate()); assertTrue(cmd.getReturnValue().getValidationMessages().contains(EngineMessage.ACTION_TYPE_FAILED_GLUSTER_HOOK_DOES_NOT_EXIST.toString())); }
@java.lang.Override protected void perform() { final org.ovirt.engine.core.common.vdscommands.VDSReturnValue returnValue = runVdsCommand(VDSCommandType.RebootVm, new org.ovirt.engine.core.common.vdscommands.VdsAndVmIDVDSParametersBase(org.ovirt.engine.core.bll.RebootVmCommand.getVdsId(), org.ovirt.engine.core.bll.RebootVmCommand.getVmId())); setActionReturnValue(returnValue.getReturnValue()); setSucceeded(returnValue.getSucceeded()); }
protected int getMaxVolumeChain() { return org.ovirt.engine.core.common.config.Config.getValue(ConfigValues.MaxImagesInChain); }
@java.lang.Override public void releaseMacsOnCommit(java.util.List<java.lang.String> macs) { macPool.freeMacs(macs); }
public java.lang.String getHelpNote() { return java.lang.String.format(("%n%n%n" + (((((((("### Notes:%n" + "### 1. Passwords: password can be set in interactive mode ie:%n") + "### engine-config -s PasswordEntry=interactive%n") + "### or via file with one of the following options:%n") + "### engine-config -s PasswordEntry --admin-pass-file=/tmp/mypass%n") + "### engine-config -s PasswordEntry=/tmp/mypass%n") + "### 2. In order for your change(s) to take effect,%n") + "### restart the oVirt engine service (using: 'service ovirt-engine restart').%n") + "################################################################################%n%n"))); }
private java.lang.String getProxyUri() { java.lang.String scheme = (org.ovirt.engine.core.common.config.Config.<java.lang.Boolean>getValue(ConfigValues.ImageProxySSLEnabled)) ? org.ovirt.engine.core.bll.storage.disk.image.UploadImageCommand.HTTPS_SCHEME : org.ovirt.engine.core.bll.storage.disk.image.UploadImageCommand.HTTP_SCHEME; java.lang.String address = org.ovirt.engine.core.common.config.Config.getValue(ConfigValues.ImageProxyAddress); return (scheme + address) + (org.ovirt.engine.core.bll.storage.disk.image.UploadImageCommand.IMAGES_PATH); }
java.lang.String GlusterWebhookAddException();
@java.lang.Override protected void addPermissions() { org.ovirt.engine.core.common.action.PermissionsOperationsParameters permissionsOperationsParameters = createPermissionParameters(MultiLevelAdministrationHandler.EVERYONE_OBJECT_ID, PredefinedRoles.CPU_PROFILE_OPERATOR.getId()); getBackend().runAction(VdcActionType.AddPermission, permissionsOperationsParameters); permissionsOperationsParameters = createPermissionParameters(getUserId(), PredefinedRoles.CPU_PROFILE_CREATOR.getId()); getBackend().runAction(VdcActionType.AddPermission, permissionsOperationsParameters); }
@java.lang.Override protected org.ovirt.engine.core.common.action.LockProperties applyLockProperties(org.ovirt.engine.core.common.action.LockProperties lockProperties) { return lockProperties.withScope(LockProperties.Scope.Command); }
protected void addVmPermission() { org.ovirt.engine.core.bll.UniquePermissionsSet permissionsToAdd = new org.ovirt.engine.core.bll.UniquePermissionsSet(); if (org.ovirt.engine.core.bll.AddVmCommand.getParameters().isMakeCreatorExplicitOwner()) { permissionsToAdd.addPermission(org.ovirt.engine.core.bll.AddVmCommand.getCurrentUser().getId(), PredefinedRoles.VM_OPERATOR.getId(), org.ovirt.engine.core.bll.AddVmCommand.getVmId(), VdcObjectType.VM); } if ((org.ovirt.engine.core.bll.AddVmCommand.getParameters().isCopyTemplatePermissions()) && (!(org.ovirt.engine.core.bll.AddVmCommand.getVmTemplateId().equals(VmTemplateHandler.BlankVmTemplateId)))) { copyTemplatePermissions(permissionsToAdd); } if (!(permissionsToAdd.isEmpty())) { java.util.List<org.ovirt.engine.core.common.businessentities.permissions> permissionsList = permissionsToAdd.asPermissionList(); org.ovirt.engine.core.bll.MultiLevelAdministrationHandler.addPermission(permissionsList.toArray(new org.ovirt.engine.core.common.businessentities.permissions[permissionsList.size()])); org.ovirt.engine.core.bll.AddVmCommand.getCompensationContext().snapshotNewEntities(permissionsList); } }
@java.lang.Override protected boolean canDoAction() { if (!(super.canDoAction())) { return false; } org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity volume = getGlusterVolume(); if (!(volume.isOnline())) { addCanDoActionMessage(VdcBllMessages.ACTION_TYPE_FAILED_GLUSTER_VOLUME_ALREADY_STOPPED); addCanDoActionMessage(java.lang.String.format("$volumeName %1$s", volume.getName())); return false; } if ((org.ovirt.engine.core.bll.gluster.tasks.GlusterTaskUtils.isTaskOfType(volume, GlusterTaskType.REBALANCE)) && (org.ovirt.engine.core.bll.gluster.tasks.GlusterTaskUtils.isTaskStatus(volume, JobExecutionStatus.STARTED))) { return failCanDoAction(VdcBllMessages.ACTION_TYPE_FAILED_GLUSTER_VOLUME_CANNOT_STOP_REBALANCE_IN_PROGRESS); } return true; }
protected void ProceedVGLunsInDb() { final java.util.ArrayList<org.ovirt.engine.core.common.businessentities.LUNs> luns = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.LUNs>) (org.ovirt.engine.core.bll.Backend.getInstance().getResourceManager().RunVdsCommand(VDSCommandType.GetVGInfo, new org.ovirt.engine.core.common.vdscommands.GetVGInfoVDSCommandParameters(org.ovirt.engine.core.bll.storage.AddSANStorageDomainCommand.getVds().getId(), org.ovirt.engine.core.bll.storage.AddSANStorageDomainCommand.getStorageDomain().getstorage())).getReturnValue())); org.ovirt.engine.core.utils.transaction.TransactionSupport.executeInNewTransaction(new org.ovirt.engine.core.utils.transaction.TransactionMethod<java.lang.Void>() { @java.lang.Override public java.lang.Void runInTransaction() { for (org.ovirt.engine.core.common.businessentities.LUNs lun : luns) { proceedLUNInDb(lun, getStorageDomain().getstorage_type()); } return null; } }); }
public void setCpuProfileId(org.ovirt.engine.core.compat.Guid cpuProfileId) { this.cpuProfileId = cpuProfileId; }
void registerModelEventListeners(final org.ovirt.engine.ui.common.uicommon.model.ModelProvider<? extends org.ovirt.engine.ui.uicommonweb.models.EntityModel> modelProvider) { modelProvider.getModel().getPropertyChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs pcArgs = ((org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs) (args)); if ("IsAvailable".equals(pcArgs.propertyName)) { boolean isAvailable = modelProvider.getModel().getIsAvailable(); setAccessible(isAvailable); } org.ovirt.engine.ui.common.widget.tab.TabAccessibleChangeEvent.fire(org.ovirt.engine.ui.common.widget.tab.ModelBoundTab.this, org.ovirt.engine.ui.common.widget.tab.ModelBoundTab.this); } }); }
private org.ovirt.engine.core.bll.ValidationResult validateCoherentNicIdentification(org.ovirt.engine.core.common.businessentities.network.NetworkAttachment attachment) { return hostSetupNetworksValidatorHelper.validateCoherentIdentification(java.lang.String.valueOf(attachment.getId()), attachment.getNicId(), attachment.getNicName(), EngineMessage.NETWORK_ATTACHMENT_REFERENCES_NICS_INCOHERENTLY, existingInterfacesMap); }
private void setNetworkBootProtocolList(org.ovirt.engine.ui.uicommonweb.models.ListModel<org.ovirt.engine.core.common.businessentities.network.NetworkBootProtocol> value) { networkBootProtocolList = value; }
public int getBytesWritten() { return bytesWritten; }
@org.ovirt.engine.ui.frontend.DefaultStringValue("Cannot ${action} ${type}. The following bonds consist of less than two Network Interfaces: ${NETWORK_BONDS_INVALID_SLAVE_COUNT_LIST}.") java.lang.String NETWORK_BONDS_INVALID_SLAVE_COUNT();
@org.junit.Test public void testValidRemovedBondsWhenBondIsRequired() throws java.lang.Exception { java.lang.String nicName = "nicName"; bond.setName(nicName); org.ovirt.engine.core.common.action.HostSetupNetworksParameters params = new org.ovirt.engine.core.common.action.HostSetupNetworksParameters(host.getId()); params.setRemovedBonds(java.util.Collections.singleton(bond.getId())); org.ovirt.engine.core.bll.network.host.HostSetupNetworksValidator validator = createHostSetupNetworksValidator(params, java.util.Collections.<org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface>singletonList(bond)); org.ovirt.engine.core.common.businessentities.network.NetworkAttachment requiredNetworkAttachment = new org.ovirt.engine.core.common.businessentities.network.NetworkAttachment(); requiredNetworkAttachment.setNicName(nicName); assertThat(validator.validRemovedBonds(java.util.Collections.singletonList(requiredNetworkAttachment)), failsWith(EngineMessage.BOND_USED_BY_NETWORK_ATTACHMENTS)); }
@java.lang.Override public void executeCommand(org.ovirt.engine.ui.uicommonweb.UICommand command) { super.executeCommand(command); if (command == (getNewCommand())) { newEntity(); } else if (command == (getEditCommand())) { edit(); } else if (command == (getRemoveCommand())) { remove(); } else if (command == (getMoveCommand())) { move(); } else if (command == (getCopyCommand())) { copy(); } else if (org.ovirt.engine.core.compat.StringHelper.stringsEqual(command.getName(), "Cancel")) { cancel(); } else if (org.ovirt.engine.core.compat.StringHelper.stringsEqual(command.getName(), "CancelConfirm")) { cancelConfirm(); } else if (org.ovirt.engine.core.compat.StringHelper.stringsEqual(command.getName(), "OnRemove")) { onRemove(); } else if (command == (getChangeQuotaCommand())) { changeQuota(); } else if (command.getName().equals("onChangeQuota")) { onChangeQuota(); } }
public static void removeVmStatelessImages(org.ovirt.engine.core.compat.Guid vmId, org.ovirt.engine.core.bll.context.CommandContext context) { if (org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getSnapshotDao().exists(vmId, SnapshotType.STATELESS)) { org.ovirt.engine.core.bll.ProcessDownVmCommand.log.infoFormat("Deleting snapshot for stateless vm {0}", vmId); org.ovirt.engine.core.bll.Backend.getInstance().runInternalAction(VdcActionType.RestoreStatelessVm, new org.ovirt.engine.core.common.action.VmOperationParameterBase(vmId), context); } }
private void updateMigrateOnError(org.ovirt.engine.core.common.businessentities.VDSGroup group) { org.ovirt.engine.core.common.businessentities.ArchitectureType arch = getArchitecture(group); boolean isMigrationSupported = org.ovirt.engine.core.common.FeatureSupported.isMigrationSupported(arch, group.getcompatibility_version()); if (!isMigrationSupported) { group.setMigrateOnError(MigrateOnErrorOptions.NO); } }
private void moveMacsOfUpdatedDataCenter(org.ovirt.engine.core.compat.Guid oldMacPoolId, org.ovirt.engine.core.compat.Guid newMacPoolId, java.util.List<java.lang.String> vmInterfaceMacs) { java.util.Objects.requireNonNull(vmInterfaceMacs); org.ovirt.engine.core.bll.network.macpoolmanager.MacPoolPerDc poolPerDc = org.ovirt.engine.core.bll.network.macpoolmanager.MacPoolPerDcSingleton.getInstance(); org.ovirt.engine.core.bll.network.macpoolmanager.MacPoolManagerStrategy sourcePool = poolPerDc.getPoolById(oldMacPoolId); org.ovirt.engine.core.bll.network.macpoolmanager.MacPoolManagerStrategy targetPool = poolPerDc.getPoolById(newMacPoolId); for (java.lang.String mac : vmInterfaceMacs) { sourcePool.freeMac(mac); targetPool.forceAddMac(mac); } }
public void updateWatchdogItems(java.util.Set<org.ovirt.engine.core.common.businessentities.VmWatchdogType> vmWatchdogTypes) { java.util.List<java.lang.String> watchDogModels = new java.util.ArrayList<java.lang.String>(); for (org.ovirt.engine.core.common.businessentities.VmWatchdogType vmWatchdogType : vmWatchdogTypes) { watchDogModels.add(org.ovirt.engine.ui.uicompat.EnumTranslator.getInstance().get(vmWatchdogType)); } watchDogModels.add(0, null); java.lang.String oldWatchdogSelected = ((java.lang.String) (getWatchdogModel().getSelectedItem())); getWatchdogModel().setItems(watchDogModels); if (watchDogModels.contains(oldWatchdogSelected)) { getWatchdogModel().setSelectedItem(oldWatchdogSelected); } }
public void appendCustomValue(final java.lang.String name, final java.lang.String value, final java.lang.String separator) { final java.lang.String key = name.toLowerCase(); java.lang.String newValue = value; allocateCustomValues(); if (customValues.containsKey(key)) { newValue = java.lang.String.format("%1$s%2$s%3$s", customValues.get(key), separator, value); } customValues.put(name.toLowerCase(), newValue); }
public boolean isActionName(org.ovirt.api.metamodel.concepts.Name name) { switch (name.toString()) { case "add" : case "get" : case "list" : case "remove" : case "update" : return false; default : return true; } }
@org.junit.Test public void testDeallocateIfExternalThrowException() { nic.setName(org.ovirt.engine.core.bll.network.ExternalNetworkManagerTest.NIC_NAME); nic.setId(org.ovirt.engine.core.bll.network.ExternalNetworkManagerTest.NIC_ID); provider.setName(org.ovirt.engine.core.bll.network.ExternalNetworkManagerTest.PROVIDER_NAME); doThrow(new org.ovirt.engine.core.common.errors.EngineException()).when(networkProviderProxy).deallocate(nic); underTest.deallocateIfExternal(); verify(auditLogDirector).log(auditLogableBaseCaptor.capture(), same(AuditLogType.REMOVE_PORT_FROM_EXTERNAL_PROVIDER_FAILED)); final java.util.Map<java.lang.String, java.lang.String> capturedCustomValues = auditLogableBaseCaptor.getValue().getCustomValues(); assertThat(capturedCustomValues, hasEntry("nicname", org.ovirt.engine.core.bll.network.ExternalNetworkManagerTest.NIC_NAME)); assertThat(capturedCustomValues, hasEntry("nicid", org.ovirt.engine.core.bll.network.ExternalNetworkManagerTest.NIC_ID.toString())); assertThat(capturedCustomValues, hasEntry("providername", org.ovirt.engine.core.bll.network.ExternalNetworkManagerTest.PROVIDER_NAME)); }
private void showConcurrentGroup(org.ovirt.engine.ui.uicommonweb.models.hosts.FenceAgentModel model) { editFenceAgent.setVisible(false); org.ovirt.engine.ui.webadmin.widget.host.FenceAgentConcurrentWidget concurrentWidget = new org.ovirt.engine.ui.webadmin.widget.host.FenceAgentConcurrentWidget(); concurrentWidget.addRemoveConcurrentGroupClickHandler(removeConcurrentGroupClickHandlerMap.get(model)); concurrentWidget.edit(model); concurrentPanel.add(concurrentWidget); for (org.ovirt.engine.ui.uicommonweb.models.hosts.FenceAgentModel concurrentModel : model.getConcurrentList()) { concurrentWidget = new org.ovirt.engine.ui.webadmin.widget.host.FenceAgentConcurrentWidget(); concurrentWidget.addRemoveConcurrentGroupClickHandler(removeConcurrentGroupClickHandlerMap.get(concurrentModel)); concurrentWidget.edit(concurrentModel); concurrentPanel.add(concurrentWidget); } }
org.ovirt.engine.ui.common.widget.HasUiCommandClickHandlers getMacPoolButton();
@java.lang.Override public boolean storageDomainRemoved(org.ovirt.engine.core.common.businessentities.StorageDomainStatic storageDomain) { java.util.List<org.ovirt.engine.core.common.businessentities.StorageServerConnections> list = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getStorageServerConnectionDao().getAllForVolumeGroup(storageDomain.getStorage()); for (org.ovirt.engine.core.common.businessentities.StorageServerConnections connection : filterConnectionsUsedByOthers(list, storageDomain.getStorage(), "")) { org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getStorageServerConnectionDao().remove(connection.getId()); } removeStorageDomainLuns(storageDomain); return true; }
protected boolean isBalloonEnabled() { java.lang.Boolean balloonEnabled = UpdateVmCommand.getParameters().isBalloonEnabled(); return balloonEnabled != null ? balloonEnabled : org.ovirt.engine.core.bll.utils.VmDeviceUtils.isBalloonEnabled(getVmId()); }
@java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs args) { java.lang.String propName = args.propertyName; if (propName.equals("ProposeDiscoverTargets")) { setProposeDiscover(object.getProposeDiscoverTargets()); } }
@java.lang.Override public void executeCommand() { boolean mergeRunning = false; try { org.ovirt.engine.core.common.vdscommands.VDSReturnValue vdsReturnValue = runVdsCommand(VDSCommandType.Merge, createVDSParameters()); if (vdsReturnValue.getSucceeded()) { org.ovirt.engine.core.compat.Guid jobId = ((org.ovirt.engine.core.compat.Guid) (vdsReturnValue.getReturnValue())); persistBlockJobPlaceholder(jobId); org.ovirt.engine.core.bll.MergeCommand.getParameters().setVmJobId(jobId); persistCommand(org.ovirt.engine.core.bll.MergeCommand.getParameters().getParentCommand(), true); org.ovirt.engine.core.bll.MergeCommand.log.debug("Merge started successfully"); mergeRunning = true; } else { org.ovirt.engine.core.bll.MergeCommand.log.error("Failed to start Merge on VDS"); } } catch (org.ovirt.engine.core.common.errors.EngineException e) { org.ovirt.engine.core.bll.MergeCommand.log.error("Engine exception thrown while sending merge command", e); if (((e.getErrorCode()) == (org.ovirt.engine.core.common.errors.EngineError.imageErr)) || ((e.getErrorCode()) == (org.ovirt.engine.core.common.errors.EngineError.mergeErr))) { mergeRunning = true; } } finally { if (mergeRunning) { org.ovirt.engine.core.bll.MergeCommand.setSucceeded(true); } else { setCommandStatus(CommandStatus.FAILED); } } }
public void addQuotaPermissionSubject(java.util.List<org.ovirt.engine.core.bll.utils.PermissionSubject> quotaPermissionList) { if ((((!(org.ovirt.engine.core.bll.CommandBase.isInternalExecution())) && ((org.ovirt.engine.core.bll.CommandBase.getStoragePool()) != null)) && ((org.ovirt.engine.core.bll.CommandBase.getStoragePool().getQuotaEnforcementType()) != (org.ovirt.engine.core.common.businessentities.QuotaEnforcementTypeEnum.DISABLED))) && ((org.ovirt.engine.core.bll.CommandBase.getStoragePool().getQuotaEnforcementType()) != (org.ovirt.engine.core.common.businessentities.QuotaEnforcementTypeEnum.SOFT_ENFORCEMENT))) { java.util.List<org.ovirt.engine.core.bll.quota.QuotaConsumptionParameter> consumptionParameters = getQuotaConsumptionParameters(); if (consumptionParameters != null) { for (org.ovirt.engine.core.bll.quota.QuotaConsumptionParameter parameter : getQuotaConsumptionParameters()) { if ((((parameter.getQuotaGuid()) != null) && (!(Guid.Empty.equals(parameter.getQuotaGuid())))) && (QuotaConsumptionParameter.QuotaAction.CONSUME.equals(parameter.getQuotaAction()))) { quotaPermissionList.add(new org.ovirt.engine.core.bll.utils.PermissionSubject(parameter.getQuotaGuid(), org.ovirt.engine.core.common.VdcObjectType.Quota, org.ovirt.engine.core.common.businessentities.ActionGroup.CONSUME_QUOTA)); } } } } }
public void syncAllHostNetworks() { org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel model = new org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel(); setWindow(model); model.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().syncAllHostNetworkConfirmationDialogTitle()); model.setHelpTag(HelpTag.sync_all_host_networks); model.setHashName("sync_all_host_networks"); model.setMessage(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().areYouSureYouWantToSyncAllHostNetworksMsg()); org.ovirt.engine.ui.uicommonweb.UICommand tempVar = org.ovirt.engine.ui.uicommonweb.UICommand.createDefaultOkUiCommand("OnSyncAllHostNetworkConfirm", this); model.getCommands().add(tempVar); org.ovirt.engine.ui.uicommonweb.UICommand tempVar2 = org.ovirt.engine.ui.uicommonweb.UICommand.createCancelUiCommand("Cancel", this); model.getCommands().add(tempVar2); }
@java.lang.Override public org.ovirt.engine.core.common.businessentities.VmPool mapRow(final java.sql.ResultSet rs, final int rowNum) throws java.sql.SQLException { final org.ovirt.engine.core.common.businessentities.VmPool entity = new org.ovirt.engine.core.common.businessentities.VmPool(); entity.setVmPoolDescription(rs.getString("vm_pool_description")); entity.setVmPoolId(getGuidDefaultEmpty(rs, "vm_pool_id")); entity.setComment(rs.getString("vm_pool_comment")); entity.setName(rs.getString("vm_pool_name")); entity.setVmPoolType(org.ovirt.engine.core.common.businessentities.VmPoolType.forValue(rs.getInt("vm_pool_type"))); entity.setParameters(rs.getString("parameters")); entity.setPrestartedVms(rs.getInt("prestarted_vms")); entity.setVdsGroupId(getGuidDefaultEmpty(rs, "vds_group_id")); entity.setVdsGroupName(rs.getString("vds_group_name")); entity.setAssignedVmsCount(rs.getInt("assigned_vm_count")); entity.setRunningVmsCount(rs.getInt("vm_running_count")); entity.setMaxAssignedVmsPerUser(rs.getInt("max_assigned_vms_per_user")); return entity; }
public org.ovirt.engine.core.bll.host.provider.foreman.ForemanHostGroup[] getResults() { return results; }
@java.lang.Override protected void executeSave() { final org.ovirt.engine.core.common.action.AddNetworkWithSubnetParameters parameters = new org.ovirt.engine.core.common.action.AddNetworkWithSubnetParameters(getSelectedDc().getId(), getNetwork()); parameters.setVnicProfileRequired(false); if (getExternal().getEntity()) { org.ovirt.engine.core.common.businessentities.Provider<?> externalProvider = getExternalProviders().getSelectedItem(); org.ovirt.engine.core.common.businessentities.network.ProviderNetwork providerNetwork = new org.ovirt.engine.core.common.businessentities.network.ProviderNetwork(); providerNetwork.setProviderId(externalProvider.getId()); getNetwork().setProvidedBy(providerNetwork); if (hasDefinedSubnet()) { getSubnetModel().flush(); parameters.setExternalSubnet(getSubnetModel().getSubnet()); } org.ovirt.engine.ui.frontend.Frontend.getInstance().runAction((hasDefinedSubnet() ? org.ovirt.engine.core.common.action.ActionType.AddNetworkWithSubnetOnProvider : org.ovirt.engine.core.common.action.ActionType.AddNetworkOnProvider), parameters, addNetworkCallback(), null); } else { org.ovirt.engine.ui.frontend.Frontend.getInstance().runAction(ActionType.AddNetwork, parameters, addNetworkCallback(), null); } }
private void setNonOperational(org.ovirt.engine.core.common.businessentities.NonOperationalReason reason) { runInternalAction(VdcActionType.SetNonOperationalVds, new org.ovirt.engine.core.common.action.SetNonOperationalVdsParameters(getVds().getId(), reason), org.ovirt.engine.core.bll.job.ExecutionHandler.createInternalJobContext(getContext())); }
private void validateQosOverriddenInterfaces() { for (org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface iface : params.getInterfaces()) { java.lang.String networkName = iface.getNetworkName(); if ((networkName == null) || (!(iface.isQosOverridden()))) { continue; } if (!(hostNetworkQosSupported)) { addViolation(VdcBllMessages.ACTION_TYPE_FAILED_HOST_NETWORK_QOS_NOT_SUPPORTED, networkName); } if (((iface.getQos()) != null) && (!(iface.getQos().isEmpty()))) { org.ovirt.engine.core.bll.validator.HostNetworkQosValidator qosValidator = new org.ovirt.engine.core.bll.validator.HostNetworkQosValidator(iface.getQos()); if ((qosValidator.requiredValuesPresent()) != (org.ovirt.engine.core.bll.ValidationResult.VALID)) { addViolation(VdcBllMessages.ACTION_TYPE_FAILED_HOST_NETWORK_QOS_SETUP_NETWORKS_MISSING_VALUES, networkName); } if ((qosValidator.valuesConsistent()) != (org.ovirt.engine.core.bll.ValidationResult.VALID)) { addViolation(VdcBllMessages.ACTION_TYPE_FAILED_HOST_NETWORK_QOS_SETUP_NETWORKS_INCONSISTENT_VALUES, networkName); } } } }
private int getAdditionalAvailableSize(org.ovirt.engine.core.common.businessentities.storage.LUNs lun) { int additionalAvailableSize = ((lun.getDeviceSize()) - (lun.getPvSize())) - 1; if (additionalAvailableSize < 0) { additionalAvailableSize = 0; } return additionalAvailableSize; }
private org.ovirt.engine.core.bll.ValidationResult validateNetworkExclusiveOnNics(java.util.Collection<org.ovirt.engine.core.common.businessentities.network.NetworkAttachment> attachmentsToConfigure) { org.ovirt.engine.core.bll.validator.NetworkAttachmentsValidator validator = new org.ovirt.engine.core.bll.validator.NetworkAttachmentsValidator(attachmentsToConfigure, clusterNetworks); return validator.validateNetworkExclusiveOnNics(); }
public org.ovirt.engine.core.vdsbroker.vdsbroker.StatusForXmlRpc getStatus() { return status; }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.VmTemplate> getAllWithQuery(java.lang.String query) { return getJdbcTemplate().query(query, org.ovirt.engine.core.dao.VmTemplateDaoImpl.VMTemplateRowMapper.instance); }
@java.lang.Override public javax.ws.rs.core.Response add(org.ovirt.engine.api.model.Role role) { validateParameters(role, "id|name"); validateEnums(org.ovirt.engine.api.model.Role.class, role); if (!(role.isSetId())) { org.ovirt.engine.core.common.businessentities.roles entity = getEntity(org.ovirt.engine.core.common.businessentities.roles.class, VdcQueryType.GetRoleByName, new org.ovirt.engine.core.common.queries.MultilevelAdministrationByRoleNameParameters(role.getName()), role.getName()); role.setId(entity.getId().toString()); } return performCreation(VdcActionType.AddSystemPermission, new org.ovirt.engine.core.common.action.PermissionsOperationsParametes(newPermission(role.getId())), new org.ovirt.engine.api.restapi.resource.QueryIdResolver(org.ovirt.engine.core.common.queries.VdcQueryType.GetPermissionById, org.ovirt.engine.core.common.queries.MultilevelAdministrationByPermissionIdParameters.class)); }
@java.lang.Override public void render(org.ovirt.engine.ui.webadmin.widget.table.cell.Context context, org.ovirt.engine.core.common.businessentities.VDS host, com.google.gwt.safehtml.shared.SafeHtmlBuilder sb, java.lang.String id) { if ((host == null) || (!(host.isUpdateAvailable()))) { return; } com.google.gwt.resources.client.ImageResource statusImage = org.ovirt.engine.ui.webadmin.widget.table.cell.HostAdditionalStatusCell.resources.updateAvailableImage(); com.google.gwt.safehtml.shared.SafeHtml statusImageHtml = com.google.gwt.safehtml.shared.SafeHtmlUtils.fromTrustedString(com.google.gwt.user.client.ui.AbstractImagePrototype.create(statusImage).getHTML()); sb.append(org.ovirt.engine.ui.webadmin.widget.table.cell.HostAdditionalStatusCell.templates.hostAdditionalStatusIcon(id, statusImageHtml)); }
public java.lang.String getVirtioIsoName() { return virtioIsoName; }
protected static org.ovirt.engine.core.bll.scheduling.InternalClusterPolicies.PolicyBuilder createBuilder(java.lang.String guid) { final org.ovirt.engine.core.compat.Guid realGuid = org.ovirt.engine.core.compat.Guid.createGuidFromString(guid); final org.ovirt.engine.core.bll.scheduling.InternalClusterPolicies.PolicyBuilder builder = new org.ovirt.engine.core.bll.scheduling.InternalClusterPolicies.PolicyBuilder(realGuid); return builder; }
@java.lang.Override protected org.ovirt.engine.core.vdsbroker.vdsbroker.StatusForXmlRpc getReturnStatus() { return result.mStatus; }
private void extractModifiedInterfaces() { for (org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface nic : params.getInterfaces()) { org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface existingNic = getExistingIfaces().get(nic.getName()); if (existingNic != null) { java.util.Set<java.lang.String> newLabels = (org.ovirt.engine.core.utils.NetworkUtils.isLabeled(nic)) ? nic.getLabels() : java.util.Collections.<java.lang.String>emptySet(); java.util.Set<java.lang.String> existingLabels = (org.ovirt.engine.core.utils.NetworkUtils.isLabeled(existingNic)) ? existingNic.getLabels() : java.util.Collections.<java.lang.String>emptySet(); if (((!(org.apache.commons.collections.CollectionUtils.isEqualCollection(newLabels, existingLabels))) || ((nic.isQosOverridden()) != (existingNic.isQosOverridden()))) || (customPropertiesChanged(nic, existingNic))) { existingNic.setLabels(newLabels); existingNic.setQosOverridden(nic.isQosOverridden()); existingNic.setCustomProperties(nic.getCustomProperties()); modifiedInterfaces.add(existingNic); } } } }
@java.lang.Override public void handleFailure() { updateDiskStatus(ImageStatus.ILLEGAL); removeDisk(); }
private void restoreSnapshot() { if ((getSelectedItem()) == null) { return; } org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel model = new org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel(); org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeSnapshotEntity snapshot = ((org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeSnapshotEntity) (getSelectedItem())); setConfirmWindow(model); model.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getMessages().confirmRestoreSnapshot(getEntity().getName())); model.setHelpTag(HelpTag.volume_restore_snapshot_confirmation); model.setHashName("volume_restore_snapshot_confirmation"); if ((snapshot.getStatus()) == (org.ovirt.engine.core.common.businessentities.gluster.GlusterSnapshotStatus.ACTIVATED)) { model.setMessage(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().confirmVolumeSnapshotRestoreWithStopMessage()); } else { model.setMessage(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().confirmVolumeSnapshotRestoreMesage()); } org.ovirt.engine.ui.uicommonweb.UICommand okCommand = new org.ovirt.engine.ui.uicommonweb.UICommand("onRestoreSnapshot", this); okCommand.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().ok()); okCommand.setIsDefault(true); getConfirmWindow().getCommands().add(okCommand); model.getCommands().add(okCommand); org.ovirt.engine.ui.uicommonweb.UICommand cancelCommand = new org.ovirt.engine.ui.uicommonweb.UICommand("cancelConfirmation", this); cancelCommand.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().cancel()); cancelCommand.setIsCancel(true); model.getCommands().add(cancelCommand); }
public void removeNetworkFromParameters(org.ovirt.engine.core.common.action.SetupNetworksParameters params, org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface nic, org.ovirt.engine.core.common.businessentities.network.Network net) { if (org.ovirt.engine.core.utils.NetworkUtils.isVlan(net)) { org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface vlan = getVlanDevice(params.getInterfaces(), nic, net); if (vlan == null) { throw new org.ovirt.engine.core.common.errors.VdcBLLException(org.ovirt.engine.core.common.errors.VdcBllErrors.NETWORK_LABEL_CONFLICT); } else { params.getInterfaces().remove(vlan); } } else if (org.apache.commons.lang.StringUtils.equals(net.getName(), nic.getNetworkName())) { nic.setNetworkName(null); } }
@com.google.gwt.i18n.client.Messages.DefaultMessage("LUN is already part of storage domain: {0}") java.lang.String lunAlreadyPartOfStorageDomainWarning(java.lang.String storageDomainName);
private void copyQuotaPermissions() { org.ovirt.engine.core.bll.UniquePermissionsSet permissionsToAdd = new org.ovirt.engine.core.bll.UniquePermissionsSet(); java.util.List<org.ovirt.engine.core.common.businessentities.Permissions> vmPermissions = getDbFacade().getPermissionDao().getAllForEntity(getParameters().getQuotaId(), getEngineSessionSeqId(), false); for (org.ovirt.engine.core.common.businessentities.Permissions vmPermission : vmPermissions) { permissionsToAdd.addPermission(vmPermission.getad_element_id(), vmPermission.getrole_id(), getQuotaId(), vmPermission.getObjectType()); } if (!(permissionsToAdd.isEmpty())) { java.util.List<org.ovirt.engine.core.common.businessentities.Permissions> permissionsList = permissionsToAdd.asPermissionList(); org.ovirt.engine.core.bll.MultiLevelAdministrationHandler.addPermission(permissionsList.toArray(new org.ovirt.engine.core.common.businessentities.Permissions[permissionsList.size()])); } }
public org.ovirt.engine.core.bll.ValidationResult statusSupportedForHostUpgrade() { return org.ovirt.engine.core.bll.ValidationResult.failWith(EngineMessage.VDS_CANNOT_INSTALL_STATUS_ILLEGAL).unless(org.ovirt.engine.core.common.VdcActionUtils.canExecute(java.util.Arrays.asList(host), org.ovirt.engine.core.common.businessentities.VDS.class, VdcActionType.UpgradeHost)); }
@java.lang.Override public void onSuccess(java.lang.Object target, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.models.vms.VmSnapshotListModel model = ((org.ovirt.engine.ui.uicommonweb.models.vms.VmSnapshotListModel) (target)); org.ovirt.engine.core.common.businessentities.StoragePool dataCenter = ((org.ovirt.engine.core.common.businessentities.StoragePool) (returnValue)); if (dataCenter == null) { return; } org.ovirt.engine.core.compat.Version minVmVersion = vm.getCompatibilityVersion(); org.ovirt.engine.core.compat.Version minDcVersion = dataCenter.getCompatibilityVersion(); org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().isCommandCompatible(new org.ovirt.engine.ui.frontend.AsyncQuery(model, new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object target, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.models.vms.VmSnapshotListModel model = ((org.ovirt.engine.ui.uicommonweb.models.vms.VmSnapshotListModel) (target)); model.setIsCloneVmSupported(((java.lang.Boolean) (returnValue))); } }), VdcActionType.AddVmFromSnapshot, minVmVersion, minDcVersion); }
private org.ovirt.engine.core.common.businessentities.storage.ImageStatus checkImageStatus(org.ovirt.engine.core.common.businessentities.storage.CinderDisk removedVolume) { try { return getCinderBroker().getImageStatusByClassificationType(removedVolume); } catch (com.woorea.openstack.base.client.OpenStackResponseException ex) { if ((ex.getStatus()) == (org.apache.commons.httpclient.HttpStatus.SC_NOT_FOUND)) { log.info("Image status could not be provided since the cinder image might have already been removed from Cinder."); return org.ovirt.engine.core.common.businessentities.storage.ImageStatus.OK; } logError(removedVolume, ex); } catch (java.lang.Exception e) { logError(removedVolume, e); } return org.ovirt.engine.core.common.businessentities.storage.ImageStatus.ILLEGAL; }
private void buildImageReference() { org.ovirt.engine.core.utils.ovf.xml.XmlNodeList list = selectNodes(_document, "//*/File", _xmlNS); for (XmlNode node : list) { org.ovirt.engine.core.common.businessentities.storage.DiskImage disk = new org.ovirt.engine.core.common.businessentities.storage.DiskImage(); if ((node.attributes.get("ovf:disk_storage_type")) != null) { java.lang.String diskStorageType = node.attributes.get("ovf:disk_storage_type").getValue(); if ((diskStorageType != null) && (diskStorageType.equals(DiskStorageType.CINDER.name()))) { disk = new org.ovirt.engine.core.common.businessentities.storage.CinderDisk(); } } disk.setImageId(new org.ovirt.engine.core.compat.Guid(node.attributes.get("ovf:id").getValue())); disk.setId(org.ovirt.engine.core.utils.ovf.OvfParser.GetImageGrupIdFromImageFile(node.attributes.get("ovf:href").getValue())); disk.setActive(true); disk.setImageStatus(ImageStatus.OK); disk.setDescription(node.attributes.get("ovf:description").getValue()); _images.add(disk); } }
private boolean initGlusterHost() { glusterHostUuidFound = true; if (org.ovirt.engine.core.common.gluster.GlusterFeatureSupported.glusterHostUuidSupported(getVdsGroup().getcompatibility_version())) { org.ovirt.engine.core.common.vdscommands.VDSReturnValue returnValue = runVdsCommand(VDSCommandType.GetGlusterHostUUID, new org.ovirt.engine.core.common.vdscommands.VdsIdVDSCommandParametersBase(getVds().getId())); if ((returnValue.getSucceeded()) && ((returnValue.getReturnValue()) != null)) { org.ovirt.engine.core.compat.Guid addedServerUuid = org.ovirt.engine.core.compat.Guid.createGuidFromString(((java.lang.String) (returnValue.getReturnValue()))); if (hostUuidExists(addedServerUuid)) { setNonOperational(NonOperationalReason.GLUSTER_HOST_UUID_ALREADY_EXISTS, null); return false; } saveGlusterHostUuid(addedServerUuid); } else { glusterHostUuidFound = false; setNonOperational(NonOperationalReason.GLUSTER_HOST_UUID_NOT_FOUND, null); } } return (glusterHostUuidFound) && (initGlusterPeerProcess()); }
public void getClusterList(org.ovirt.engine.ui.frontend.AsyncQuery aQuery, boolean doRefresh) { aQuery.converterCallback = new org.ovirt.engine.ui.frontend.IAsyncConverter() { @java.lang.Override public java.lang.Object Convert(java.lang.Object source, org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery) { if (source != null) { java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VDSGroup> list = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VDSGroup>) (source)); java.util.Collections.sort(list, new org.ovirt.engine.core.common.businessentities.comparators.NameableComparator()); return list; } return new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VDSGroup>(); } }; org.ovirt.engine.ui.frontend.Frontend.getInstance().runQuery(VdcQueryType.GetAllVdsGroups, (doRefresh ? new org.ovirt.engine.core.common.queries.VdcQueryParametersBase() : new org.ovirt.engine.core.common.queries.VdcQueryParametersBase().withoutRefresh()), aQuery); }
@org.junit.Test public void validateWithDirectLunIdAndInvalidVds() { command.getParameters().setDirectLunId(org.ovirt.engine.core.compat.Guid.newGuid()); doReturn(false).when(command).validateVds(); assertFalse(command.validate()); }
public void OnSetupNetworks() { org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.GetNetworkConnectivityCheckTimeoutInSeconds(new org.ovirt.engine.ui.frontend.AsyncQuery(this, new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void OnSuccess(java.lang.Object target, java.lang.Object returnValue) { org.ovirt.engine.ui.uicommonweb.models.hosts.HostInterfaceListModel listModel = ((org.ovirt.engine.ui.uicommonweb.models.hosts.HostInterfaceListModel) (target)); org.ovirt.engine.ui.uicommonweb.models.hosts.HostSetupNetworksModel model = ((org.ovirt.engine.ui.uicommonweb.models.hosts.HostSetupNetworksModel) (listModel.getWindow())); model.getConnectivityTimeout().setEntity(returnValue); listModel.PostOnSetupNetworks(); } })); }
public void updateSuggestedLabels() { suggestedLabels = new java.util.TreeSet<>(suggestedLabelsCache); suggestedLabels.removeAll(computeSelectedLabels()); for (org.ovirt.engine.ui.uicommonweb.models.ListModel<java.lang.String> labelModel : getItems()) { labelModel.setItems(suggestedLabels, labelModel.getSelectedItem()); } }
@java.lang.Override public void addColumn(com.google.gwt.user.cellview.client.Column<T, ?> column, com.google.gwt.user.cellview.client.Header<?> header) { if ((columnResizingEnabled) && (header instanceof org.ovirt.engine.ui.common.widget.table.header.AbstractCheckboxHeader)) { header = createResizableCheckboxHeader(header, column); } else if (columnResizingEnabled) { header = createResizableHeader(column, header); } else if ((applyHeaderStyle) && (header instanceof org.ovirt.engine.ui.common.widget.table.header.SafeHtmlHeader)) { org.ovirt.engine.ui.common.widget.table.header.SafeHtmlHeader safeHtmlHeader = ((org.ovirt.engine.ui.common.widget.table.header.SafeHtmlHeader) (header)); com.google.gwt.safehtml.shared.SafeHtml newValue = org.ovirt.engine.ui.common.widget.table.ColumnResizeCellTable.templates.nonResizeableColumnHeader(safeHtmlHeader.getValue()); header = new org.ovirt.engine.ui.common.widget.table.header.SafeHtmlHeader(newValue, safeHtmlHeader.getTooltip()); } super.addColumn(column, header); if (columnResizingEnabled) { if (isColumnPresent(emptyNoWidthColumn)) { removeColumn(emptyNoWidthColumn); } super.addColumn(emptyNoWidthColumn, emptyNoWidthColumnHeader); } if (header instanceof org.ovirt.engine.ui.common.widget.table.header.AbstractHeader) { ((org.ovirt.engine.ui.common.widget.table.header.AbstractHeader) (header)).setContextMenuHandler(ensureContextMenuHandler()); contextPopup.getContextMenu().addItem(column); } }
@java.lang.Override protected void updateSingleNic(org.ovirt.engine.core.utils.ovf.xml.XmlNode node, org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface iface) { super.updateSingleNic(node, iface); iface.setMacAddress(((selectSingleNode(node, "rasd:MACAddress", _xmlNS)) != null ? selectSingleNode(node, "rasd:MACAddress", _xmlNS).innerText : "")); }
@java.lang.Override protected boolean validate() { boolean returnValue = true; synchronized(org.ovirt.engine.core.bll.AttachUserToVmFromPoolAndRunCommand._lockObject) { if (Guid.Empty.equals(getVmToAttach(org.ovirt.engine.core.bll.AttachUserToVmFromPoolAndRunCommand.getParameters().getVmPoolId()))) { addValidationMessage(EngineMessage.ACTION_TYPE_FAILED_NO_AVAILABLE_POOL_VMS); returnValue = false; } } if (returnValue) { java.util.List<org.ovirt.engine.core.common.businessentities.VM> vmsForUser = org.ovirt.engine.core.bll.AttachUserToVmFromPoolAndRunCommand.getVmDao().getAllForUser(getAdUserId()); int vmCount = 0; for (org.ovirt.engine.core.common.businessentities.VM vm : vmsForUser) { if (((vm.getVmPoolId()) != null) && (getVmPoolId().equals(vm.getVmPoolId()))) { vmCount++; } } int limit = org.ovirt.engine.core.bll.AttachUserToVmFromPoolAndRunCommand.getVmPool().getMaxAssignedVmsPerUser(); if (vmCount >= limit) { addValidationMessage(EngineMessage.VM_POOL_CANNOT_ATTACH_TO_MORE_VMS_FROM_POOL); returnValue = false; } } if (!returnValue) { setActionMessageParameters(); } return returnValue; }
@java.lang.Override protected void buildVmSoundDevices() { java.util.List<org.ovirt.engine.core.common.businessentities.VmDevice> vmSoundDevices = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVmDeviceDao().getVmDeviceByVmIdAndType(vm.getId(), VmDeviceGeneralType.SOUND); if (!(vmSoundDevices.isEmpty())) { createInfo.put(VdsProperties.soundDevice, osRepository.getSoundDevice(vm.getStaticData().getOsId(), vm.getCompatibilityVersion())); } }
private void validateAndAssertNetworkModified(org.ovirt.engine.core.bll.SetupNetworksHelper helper, org.ovirt.engine.core.common.businessentities.network net) { validateAndExpectNoViolations(helper); assertNoBondsModified(helper); assertNetworkModified(helper, net); assertNoNetworksRemoved(helper); assertNoBondsRemoved(helper); }
@org.ovirt.engine.api.restapi.types.Mapping(from = org.ovirt.engine.api.model.Host.class, to = org.ovirt.engine.core.common.businessentities.VdsStatic.class) public static org.ovirt.engine.core.common.businessentities.VdsStatic map(org.ovirt.engine.api.model.Host model, org.ovirt.engine.core.common.businessentities.VdsStatic template) { org.ovirt.engine.core.common.businessentities.VdsStatic entity = (template != null) ? template : new org.ovirt.engine.core.common.businessentities.VdsStatic(); if (model.isSetId()) { entity.setId(org.ovirt.engine.api.restapi.utils.GuidUtils.asGuid(model.getId())); } if (model.isSetName()) { entity.setVdsName(model.getName()); } if ((model.isSetCluster()) && (model.getCluster().isSetId())) { entity.setVdsGroupId(org.ovirt.engine.api.restapi.utils.GuidUtils.asGuid(model.getCluster().getId())); } if (model.isSetAddress()) { entity.setHostName(model.getAddress()); } if ((model.isSetPort()) && ((model.getPort()) > 0)) { entity.setPort(model.getPort()); } else { entity.setPort(org.ovirt.engine.api.restapi.types.HostMapper.DEFAULT_VDSM_PORT); } if (model.isSetPowerManagement()) { entity = org.ovirt.engine.api.restapi.types.HostMapper.map(model.getPowerManagement(), entity); } if (model.isSetStorageManager()) { if ((model.getStorageManager().getPriority()) != null) { entity.setVdsSpmPriority(model.getStorageManager().getPriority()); } } if ((model.isSetDisplay()) && (model.getDisplay().isSetAddress())) { entity.setConsoleAddress(("".equals(model.getDisplay().getAddress()) ? null : model.getDisplay().getAddress())); } return entity; }
@org.junit.Test public void checkRemoveIscsiConnectionDomainsAndDisksExist() { parameters.setStorageServerConnection(iSCSIConnection); when(storageServerConnectionDao.get(iSCSIConnection.getId())).thenReturn(iSCSIConnection); java.util.List<org.ovirt.engine.core.common.businessentities.storage.LUNs> luns = new java.util.ArrayList<>(); org.ovirt.engine.core.common.businessentities.storage.LUNs lun1 = new org.ovirt.engine.core.common.businessentities.storage.LUNs(); lun1.setLUN_id("3600144f09dbd05000000517e730b1212"); lun1.setStorageDomainName("storagedomain1"); lun1.setvolume_group_id("G95OWd-Wvck-vftu-pMq9-9SAC-NF3E-ulDPsQ"); luns.add(lun1); org.ovirt.engine.core.common.businessentities.storage.LUNs lun2 = new org.ovirt.engine.core.common.businessentities.storage.LUNs(); lun2.setLUN_id("3600144f09dbd05000000517e730b1212"); lun2.setStorageDomainName(""); lun2.setvolume_group_id(""); lun2.setDiskAlias("disk2"); luns.add(lun2); when(lunDao.getAllForStorageServerConnection(iSCSIConnection.getId())).thenReturn(luns); org.ovirt.engine.core.bll.CanDoActionTestUtils.runAndAssertCanDoActionFailure(command, EngineMessage.ACTION_TYPE_FAILED_STORAGE_CONNECTION_BELONGS_TO_SEVERAL_STORAGE_DOMAINS_AND_DISKS); }
@java.lang.Override public void massUpdateNumaNodeStatistics(java.util.List<org.ovirt.engine.core.common.businessentities.VdsNumaNode> numaNodes) { java.util.List<org.springframework.jdbc.core.namedparam.MapSqlParameterSource> executions = new java.util.ArrayList(numaNodes.size()); for (org.ovirt.engine.core.common.businessentities.VdsNumaNode node : numaNodes) { executions.add(createNumaNodeStatisticsParametersMapper(node)); } getCallsHandler().executeStoredProcAsBatch("UpdateNumaNodeStatistics", executions); }
@java.lang.Override public void onValueChange(com.google.gwt.event.logical.shared.ValueChangeEvent<java.lang.Boolean> event) { boolean previousSpicePreference = getView().getSpiceProxy(); selectSpiceImplementation(SpiceConsoleModel.ClientConsoleMode.Html5); spiceProxyUserPreference = previousSpicePreference; }
public void prepare1() { org.ovirt.engine.ui.uicompat.PreparingEnlistment enlistment = ((org.ovirt.engine.ui.uicompat.PreparingEnlistment) (context.enlistment)); org.ovirt.engine.ui.uicommonweb.models.hosts.EnlistmentContext enlistmentContext = ((org.ovirt.engine.ui.uicommonweb.models.hosts.EnlistmentContext) (context.enlistment.getContext())); org.ovirt.engine.ui.uicommonweb.models.hosts.HostListModel model = enlistmentContext.getModel(); org.ovirt.engine.core.common.businessentities.VDS host = ((org.ovirt.engine.core.common.businessentities.VDS) (model.getSelectedItem())); if (!(enlistmentContext.getClusterId().equals(host.getVdsGroupId()))) { enlistmentContext.setOldClusterId(host.getVdsGroupId()); org.ovirt.engine.core.common.action.ChangeVDSClusterParameters parameters = new org.ovirt.engine.core.common.action.ChangeVDSClusterParameters(enlistmentContext.getClusterId(), host.getId()); parameters.setCorrelationId(getCorrelationId()); org.ovirt.engine.ui.frontend.Frontend.getInstance().runAction(VdcActionType.ChangeVDSCluster, parameters, new org.ovirt.engine.ui.uicompat.IFrontendActionAsyncCallback() { @java.lang.Override public void executed(org.ovirt.engine.ui.uicompat.FrontendActionAsyncResult result) { org.ovirt.engine.core.common.action.VdcReturnValueBase returnValue = result.getReturnValue(); context.changeVDSClusterReturnValue = returnValue; prepare2(); } }); } else { context.enlistment = null; enlistment.prepared(); } }
@java.lang.Override public void attemptToFenceJob() { if (isDstVdsmImage()) { log.info("Command {} id: '{}': attempting to fence job {}", org.ovirt.engine.core.bll.storage.disk.image.CopyDataCommand.getActionType(), org.ovirt.engine.core.bll.storage.disk.image.CopyDataCommand.getCommandId(), org.ovirt.engine.core.bll.storage.disk.image.CopyDataCommand.getJobId()); org.ovirt.engine.core.common.businessentities.VdsmImageLocationInfo info = ((org.ovirt.engine.core.common.businessentities.VdsmImageLocationInfo) (org.ovirt.engine.core.bll.storage.disk.image.CopyDataCommand.getParameters().getDstInfo())); org.ovirt.engine.core.common.action.FenceVolumeJobCommandParameters p = new org.ovirt.engine.core.common.action.FenceVolumeJobCommandParameters(info); p.setParentCommand(org.ovirt.engine.core.bll.storage.disk.image.CopyDataCommand.getActionType()); p.setParentParameters(org.ovirt.engine.core.bll.storage.disk.image.CopyDataCommand.getParameters()); p.setStoragePoolId(org.ovirt.engine.core.bll.storage.disk.image.CopyDataCommand.getParameters().getStoragePoolId()); p.setEndProcedure(EndProcedure.COMMAND_MANAGED); runInternalActionWithTasksContext(VdcActionType.FenceVolumeJob, p); } }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Clone") java.lang.String cloneTitle();
private static void getTotalCpuMemCount(org.ovirt.engine.ui.frontend.server.dashboard.GlobalUtilizationResourceSummary cpuSummary, org.ovirt.engine.ui.frontend.server.dashboard.GlobalUtilizationResourceSummary memSummary, javax.sql.DataSource dwhDataSource) throws org.ovirt.engine.ui.frontend.server.dashboard.DashboardDataException { org.ovirt.engine.ui.frontend.server.dashboard.dao.HostDwhDao dao = new org.ovirt.engine.ui.frontend.server.dashboard.dao.HostDwhDao(dwhDataSource); org.ovirt.engine.ui.frontend.server.dashboard.models.ResourcesTotal total = dao.getTotalCpuMemCount(); cpuSummary.setPhysicalTotal(total.getCpuTotal()); memSummary.setPhysicalTotal(((total.getMemTotal()) / 1024)); }
private boolean validateNetworkInterfaces() { java.util.Map<java.lang.String, org.ovirt.engine.core.common.businessentities.VmNetworkInterface> interfaceNetworkMap = org.ovirt.engine.core.common.businessentities.Entities.interfacesByNetworkName(org.ovirt.engine.core.bll.RunVmCommand.getVm().getInterfaces()); java.util.Set<java.lang.String> interfaceNetworkNames = interfaceNetworkMap.keySet(); java.util.List<org.ovirt.engine.core.common.businessentities.network> clusterNetworks = org.ovirt.engine.core.bll.RunVmCommand.getNetworkDAO().getAllForCluster(org.ovirt.engine.core.bll.RunVmCommand.getVm().getvds_group_id()); java.util.Set<java.lang.String> clusterNetworksNames = org.ovirt.engine.core.common.businessentities.Entities.objectNames(clusterNetworks); return ((isVmInterfacesConfigured(interfaceNetworkMap)) && (isVmInterfacesAttachedToClusterNetworks(clusterNetworksNames, interfaceNetworkNames))) && (isVmInterfacesAttachedToVmNetworks(clusterNetworks, interfaceNetworkNames)); }
@org.ovirt.engine.ui.frontend.DefaultStringValue("Cannot destroy the master Storage Domain from the Data Center without another active Storage Domain to take its place.\n-Either activate another Storage Domain in the Data Center, or remove the Data Center.\n-If you have problems with the master Data Domain, consider following the recovery process described in the documentation, or contact your system administrator.") java.lang.String ERROR_CANNOT_DESTROY_LAST_STORAGE_DOMAIN();
public void setDiskOperatorAuthzPrincipalDbId(org.ovirt.engine.core.compat.Guid diskOperatorAuthzPrincipalDbId) { this.diskOperatorAuthzPrincipalDbId = diskOperatorAuthzPrincipalDbId; }
public org.ovirt.engine.core.bll.ValidationResult disksInStatus(org.ovirt.engine.core.common.businessentities.storage.ImageStatus applicableStatus, org.ovirt.engine.core.common.errors.EngineMessage message) { for (org.ovirt.engine.core.common.businessentities.storage.DiskImage diskImage : diskImages) { if ((diskImage.getImageStatus()) != applicableStatus) { return new org.ovirt.engine.core.bll.ValidationResult(message, java.lang.String.format("$status %s", applicableStatus.name())); } } return org.ovirt.engine.core.bll.ValidationResult.VALID; }
private void Edit() { if ((getWindow()) != null) { return; } org.ovirt.engine.ui.uicommonweb.models.vms.VmInterfaceModel model = org.ovirt.engine.ui.uicommonweb.models.vms.EditTemplateInterfaceModel.createInstance(getEntityStronglyTyped(), cluster.getcompatibility_version(), ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface>) (getItems())), ((org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface) (getSelectedItem())), this); setWindow(model); }
@java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object result) { org.ovirt.engine.ui.uicommonweb.models.userportal.UserPortalListModel userPortalListModel1 = ((org.ovirt.engine.ui.uicommonweb.models.userportal.UserPortalListModel) (model)); final org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel unitVmModel = ((org.ovirt.engine.ui.uicommonweb.models.vms.UnitVmModel) (userPortalListModel1.getWindow())); org.ovirt.engine.core.common.action.AddVmFromTemplateParameters param = new org.ovirt.engine.core.common.action.AddVmFromTemplateParameters(gettempVm(), unitVmModel.getDisksAllocationModel().getImageToDestinationDomainMap(), org.ovirt.engine.core.compat.Guid.Empty); param.setMakeCreatorExplicitOwner(true); param.setCopyTemplatePermissions(((java.lang.Boolean) (unitVmModel.getCopyPermissions().getEntity()))); param.setSoundDeviceEnabled(((java.lang.Boolean) (unitVmModel.getIsSoundcardEnabled().getEntity()))); param.setConsoleEnabled(((java.lang.Boolean) (unitVmModel.getIsConsoleDeviceEnabled().getEntity()))); org.ovirt.engine.ui.frontend.Frontend.RunAction(VdcActionType.AddVmFromTemplate, param, new org.ovirt.engine.ui.uicommonweb.models.userportal.NetworkCreateOrUpdateFrontendActionAsyncCallback(unitVmModel, defaultNetworkCreatingManager), this); }
private static void setGatewayIfManagementNetwork(org.ovirt.engine.core.common.businessentities.VdsNetworkInterface iface, java.lang.String gateway) { if (org.ovirt.engine.core.utils.NetworkUtils.getEngineNetwork().equals(iface.getNetworkName())) { iface.setGateway(gateway); } }
@java.lang.Override protected void onBind() { super.onBind(); registerHandler(getTable().getSelectionModel().addSelectionChangeHandler(( event) -> { org.ovirt.engine.ui.webadmin.section.main.presenter.modelProvider.setSelectedItems(getSelectedItems()); fireTableSelectionChangeEvent(); if (!(isVisible())) { handlePlaceTransition(); } })); registerHandler(org.ovirt.engine.ui.webadmin.section.main.presenter.AbstractMainTabWithDetailsPresenter.getEventBus().addHandler(org.ovirt.engine.ui.uicommonweb.models.ApplySearchStringEvent.getType(), ( event) -> { applySearchString(event.getSearchString()); })); org.ovirt.engine.ui.webadmin.section.main.presenter.AbstractMainTabWithDetailsPresenter.getView().setDetailPlaceTransitionHandler(this); java.lang.String searchString = searchStringCollector.getSearchStringPrefix(modelProvider.getModel().getSearchString()); if (searchString != null) { applySearchString(searchString); } }
@org.junit.Test public void testEmptyId() { org.ovirt.engine.api.types.V4Vm object = vm().id("").build(); assertEquals("{'id':''}", objectToJson(object)); }
types.Boot boot();
@java.lang.Override public org.ovirt.engine.ui.uicommonweb.models.EntityModel setIsChangable(boolean value) { super.setIsChangable(value); return this; }
private boolean isManagementNetworkChanged() { java.lang.String mgmtNetworkName = managementNetworkUtil.getManagementNetwork(org.ovirt.engine.core.bll.network.host.HostSetupNetworksCommand.getVds().getVdsGroupId()).getName(); for (org.ovirt.engine.core.common.vdscommands.HostNetwork network : getNetworksToConfigure()) { if (mgmtNetworkName.equals(network.getNetworkName())) { return true; } } for (org.ovirt.engine.core.common.businessentities.network.Bond bond : org.ovirt.engine.core.bll.network.host.HostSetupNetworksCommand.getParameters().getBonds()) { org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface bondNic = getExistingNicsBusinessEntityMap().get(bond.getId()); if ((bondNic != null) && (mgmtNetworkName.equals(bondNic.getNetworkName()))) { return true; } } return false; }
@com.google.gwt.i18n.client.Constants.DefaultStringValue("Import") java.lang.String importImage();
public java.util.List<java.lang.String> getClusterPoliciesNamesByPolicyUnitId(org.ovirt.engine.core.compat.Guid policyUnitId) { java.util.List<java.lang.String> list = new java.util.ArrayList<java.lang.String>(); final org.ovirt.engine.core.bll.scheduling.PolicyUnitImpl policyUnitImpl = policyUnits.get(policyUnitId); if (policyUnitImpl == null) { org.ovirt.engine.core.bll.scheduling.SchedulingManager.log.warnFormat("Trying to find usages of non-existing policy unit %s", policyUnitId.toString()); return null; } org.ovirt.engine.core.common.scheduling.PolicyUnit policyUnit = policyUnitImpl.getPolicyUnit(); if (policyUnit != null) { for (org.ovirt.engine.core.common.scheduling.ClusterPolicy clusterPolicy : policyMap.values()) { switch (policyUnit.getPolicyUnitType()) { case Filter : java.util.Collection<org.ovirt.engine.core.compat.Guid> filters = clusterPolicy.getFilters(); if ((filters != null) && (filters.contains(policyUnitId))) { list.add(clusterPolicy.getName()); } break; case Weight : java.util.Collection<org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.compat.Guid, java.lang.Integer>> functions = clusterPolicy.getFunctions(); if (functions == null) { break; } for (org.ovirt.engine.core.common.utils.Pair<org.ovirt.engine.core.compat.Guid, java.lang.Integer> pair : functions) { if (pair.getFirst().equals(policyUnitId)) { list.add(clusterPolicy.getName()); break; } } break; case LoadBalancing : if (policyUnitId.equals(clusterPolicy.getBalance())) { list.add(clusterPolicy.getName()); } break; default : break; } } } return list; }
public org.ovirt.engine.core.bll.ValidationResult validate() { java.util.Collection<org.ovirt.engine.core.common.businessentities.network.NetworkAttachment> attachmentsToConfigure = getAttachmentsToConfigure(); org.ovirt.engine.core.bll.ValidationResult vr = org.ovirt.engine.core.bll.ValidationResult.VALID; vr = (skipValidation(vr)) ? vr : new org.ovirt.engine.core.bll.network.host.NicLabelValidator(params, existingInterfacesMap, bondsMap, hostSetupNetworksValidatorHelper).validate(); vr = (skipValidation(vr)) ? vr : validNewOrModifiedNetworkAttachments(); vr = (skipValidation(vr)) ? vr : validRemovedNetworkAttachments(); vr = (skipValidation(vr)) ? vr : validNewOrModifiedBonds(); vr = (skipValidation(vr)) ? vr : validRemovedBonds(attachmentsToConfigure); vr = (skipValidation(vr)) ? vr : attachmentsDontReferenceSameNetworkDuplicately(attachmentsToConfigure); vr = (skipValidation(vr)) ? vr : networksUniquelyConfiguredOnHost(attachmentsToConfigure); vr = (skipValidation(vr)) ? vr : validateNetworkExclusiveOnNics(attachmentsToConfigure); vr = (skipValidation(vr)) ? vr : new org.ovirt.engine.core.bll.network.host.NetworkMtuValidator(networkBusinessEntityMap).validateMtu(attachmentsToConfigure); vr = (skipValidation(vr)) ? vr : validateCustomProperties(); vr = (skipValidation(vr)) ? vr : validateQos(attachmentsToConfigure); vr = (skipValidation(vr)) ? vr : validateBondModeVsNetworksAttachedToIt(attachmentsToConfigure); vr = (skipValidation(vr)) ? vr : unmanagedNetworkValidator.validate(params, existingInterfaces, networkBusinessEntityMap); return vr; }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("power on") java.lang.String powerOn();
@org.ovirt.engine.ui.webadmin.DefaultStringValue("KSM control") java.lang.String ksmLabelTitle();
@org.ovirt.engine.ui.webadmin.DefaultStringValue("Password") java.lang.String geoRepSlaveNodePassword();
public void setGuestOsArch(org.ovirt.engine.core.common.businessentities.ArchitectureType guestOsArch) { if (!(org.ovirt.engine.core.common.utils.ObjectUtils.objectsEqual(this.guestOsArch, guestOsArch))) { this.guestOsArch = guestOsArch; onPropertyChanged(new org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs("GuestOsArch")); } }
@org.junit.Before public void setUp() { validation = new org.ovirt.engine.ui.uicommonweb.validation.BrickMountPointValidationTest(); }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.Tags> getAllForParent(org.ovirt.engine.core.compat.Guid id) { org.springframework.jdbc.core.namedparam.MapSqlParameterSource parameterSource = getCustomMapSqlParameterSource().addValue("parent_id", id); return getCallsHandler().executeReadList("GettagsByparent_id", org.ovirt.engine.core.dao.TagDaoImpl.TagRowMapper.instance, parameterSource); }
public java.util.concurrent.Future<org.ovirt.engine.core.common.action.VdcReturnValueBase> executeAsyncCommand(final org.ovirt.engine.core.common.action.VdcActionType actionType, final org.ovirt.engine.core.common.action.VdcActionParametersBase parameters, final org.ovirt.engine.core.bll.context.CommandContext cmdContext) { final org.ovirt.engine.core.bll.CommandBase<?> command = org.ovirt.engine.core.bll.CommandsFactory.createCommand(actionType, parameters, cmdContext); org.ovirt.engine.core.bll.tasks.interfaces.CommandCallBack callBack = command.getCallBack(); command.persistCommand(command.getParameters().getParentCommand(), cmdContext, (callBack != null)); if (callBack != null) { cmdCallBackMap.put(command.getCommandId(), callBack); } java.util.concurrent.Future<org.ovirt.engine.core.common.action.VdcReturnValueBase> retVal; try { retVal = org.ovirt.engine.core.bll.tasks.CommandExecutor.executor.submit(new java.util.concurrent.Callable<org.ovirt.engine.core.common.action.VdcReturnValueBase>() { @java.lang.Override public org.ovirt.engine.core.common.action.VdcReturnValueBase call() throws java.lang.Exception { return executeCommand(command, cmdContext); } }); } catch (java.util.concurrent.RejectedExecutionException ex) { command.setCommandStatus(CommandStatus.FAILED); org.ovirt.engine.core.bll.tasks.CommandExecutor.log.errorFormat("Failed to submit command to executor service, command {0} status has been set to FAILED", command.getCommandId().toString()); retVal = new org.ovirt.engine.core.bll.tasks.CommandExecutor.RejectedExecutionFuture(); } return retVal; }
@java.lang.Override public void setEnabled(boolean enabled, java.util.List<java.lang.String> disabilityHints) { setEnabled(enabled); updateWidgetTitle((enabled ? null : getDisabilityTitle(disabilityHints))); }
public static org.ovirt.engine.core.aaa.DirectoryUser mapPrincipalRecordToDirectoryUser(final java.lang.String authzName, final org.ovirt.engine.api.extensions.ExtMap principalRecord) { org.ovirt.engine.core.aaa.DirectoryUser directoryUser = null; if (principalRecord != null) { directoryUser = new org.ovirt.engine.core.aaa.DirectoryUser(authzName, principalRecord.<java.lang.String>get(Authz.PrincipalRecord.NAMESPACE), principalRecord.<java.lang.String>get(Authz.PrincipalRecord.ID), principalRecord.<java.lang.String>get(Authz.PrincipalRecord.NAME)); directoryUser.setDepartment(principalRecord.<java.lang.String>get(Authz.PrincipalRecord.DEPARTMENT)); directoryUser.setFirstName(principalRecord.<java.lang.String>get(Authz.PrincipalRecord.FIRST_NAME)); directoryUser.setLastName(principalRecord.<java.lang.String>get(Authz.PrincipalRecord.LAST_NAME)); directoryUser.setEmail(principalRecord.<java.lang.String>get(Authz.PrincipalRecord.EMAIL)); directoryUser.setTitle(principalRecord.<java.lang.String>get(Authz.PrincipalRecord.TITLE)); java.util.List<org.ovirt.engine.core.aaa.DirectoryGroup> directoryGroups = new java.util.ArrayList<org.ovirt.engine.core.aaa.DirectoryGroup>(); java.util.List<org.ovirt.engine.api.extensions.ExtMap> groups = principalRecord.<java.util.List<org.ovirt.engine.api.extensions.ExtMap>>get(Authz.PrincipalRecord.GROUPS); if (groups != null) { for (org.ovirt.engine.api.extensions.ExtMap group : groups) { directoryGroups.add(org.ovirt.engine.core.aaa.DirectoryUtils.mapGroupRecordToDirectoryGroup(authzName, group)); } } directoryUser.setGroups(directoryGroups); } return directoryUser; }
private void onRemove() { org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel model = ((org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel) (getWindow())); java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase> params = new java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase>(); for (java.lang.Object item : getSelectedItems()) { params.add(new org.ovirt.engine.core.common.action.RemoveIscsiBondParameters(((org.ovirt.engine.core.common.businessentities.IscsiBond) (item)).getId())); } model.startProgress(null); org.ovirt.engine.ui.frontend.Frontend.getInstance().runMultipleAction(VdcActionType.RemoveIscsiBond, params, new org.ovirt.engine.ui.uicompat.IFrontendMultipleActionAsyncCallback() { @java.lang.Override public void executed(org.ovirt.engine.ui.uicompat.FrontendMultipleActionAsyncResult result) { org.ovirt.engine.ui.uicommonweb.models.datacenters.DataCenterIscsiBondListModel localModel = ((org.ovirt.engine.ui.uicommonweb.models.datacenters.DataCenterIscsiBondListModel) (result.getState())); localModel.stopProgress(); cancel(); } }, this); }
@java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs args) { java.lang.String propName = args.propertyName; if ("AllowClusterWithVirtGlusterEnabled".equals(propName)) { getView().allowClusterWithVirtGlusterEnabled(model.getAllowClusterWithVirtGlusterEnabled()); } }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Time Zone is not changeable for Linux VMs") java.lang.String timeZoneNotChangeableForLinuxVms();
public static boolean checkImageConfiguration(org.ovirt.engine.core.common.businessentities.StorageDomainStatic storageDomain, org.ovirt.engine.core.common.businessentities.storage.DiskImageBase diskInfo, java.util.List<java.lang.String> messages) { if (!(org.ovirt.engine.core.bll.ImagesHandler.checkImageConfiguration(storageDomain, diskInfo.getVolumeType(), diskInfo.getVolumeFormat()))) { messages.add(EngineMessage.ACTION_TYPE_FAILED_DISK_CONFIGURATION_NOT_SUPPORTED.toString()); messages.add(java.lang.String.format("$%1$s %2$s", "volumeFormat", diskInfo.getVolumeFormat())); messages.add(java.lang.String.format("$%1$s %2$s", "volumeType", diskInfo.getVolumeType())); return false; } return true; }
protected org.ovirt.engine.core.utils.lock.EngineLock lockVmDiskHotPlugWithWait() { org.ovirt.engine.core.utils.lock.EngineLock vmDiskHotPlugEngineLock = new org.ovirt.engine.core.utils.lock.EngineLock(); vmDiskHotPlugEngineLock.setExclusiveLocks(java.util.Collections.singletonMap(org.ovirt.engine.core.bll.AbstractDiskVmCommand.getVmId().toString(), org.ovirt.engine.core.bll.LockMessagesMatchUtil.makeLockingPair(LockingGroup.VM_DISK_HOT_PLUG, EngineMessage.ACTION_TYPE_FAILED_OBJECT_LOCKED))); org.ovirt.engine.core.bll.AbstractDiskVmCommand.getLockManager().acquireLockWait(vmDiskHotPlugEngineLock); return vmDiskHotPlugEngineLock; }
@java.lang.Override protected void doGet(javax.servlet.http.HttpServletRequest request, javax.servlet.http.HttpServletResponse response) throws java.io.IOException, javax.servlet.ServletException { java.lang.Integer applicationMode = getApplicationMode(request.getSession().getId()); request.setAttribute(org.ovirt.engine.ui.frontend.server.gwt.WebAdminHostPageServlet.ATTR_APPLICATION_MODE, getApplicationModeObject(applicationMode)); java.util.List<org.ovirt.engine.ui.frontend.server.gwt.plugin.PluginData> pluginData = getPluginData(); request.setAttribute(org.ovirt.engine.ui.frontend.server.gwt.WebAdminHostPageServlet.ATTR_PLUGIN_DEFS, getPluginDefinitionsArray(pluginData)); java.lang.Integer engineSessionTimeout = getEngineSessionTimeout(request.getSession().getId()); request.setAttribute(org.ovirt.engine.ui.frontend.server.gwt.WebAdminHostPageServlet.ATTR_ENGINE_SESSION_TIMEOUT, getEngineSessionTimeoutObject(engineSessionTimeout)); super.doGet(request, response); }
protected boolean validateUsbPolicy() { org.ovirt.engine.core.common.businessentities.VM vm = getParameters().getVm(); org.ovirt.engine.core.bll.VmHandler.updateImportedVmUsbPolicy(vm.getStaticData()); return org.ovirt.engine.core.bll.VmHandler.isUsbPolicyLegal(vm.getUsbPolicy(), vm.getOs(), getVdsGroup(), getReturnValue().getCanDoActionMessages()); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Edit Host") java.lang.String editHostTitle();
private java.util.List<org.ovirt.engine.core.common.businessentities.network.Network> getNetworks(java.lang.String clusterId) { org.ovirt.engine.core.compat.Guid dataCenterId = getEntity(org.ovirt.engine.core.common.businessentities.VDSGroup.class, VdcQueryType.GetVdsGroupById, new org.ovirt.engine.core.common.queries.IdQueryParameters(asGuid(clusterId)), null).getStoragePoolId(); org.ovirt.engine.core.common.queries.IdQueryParameters params = new org.ovirt.engine.core.common.queries.IdQueryParameters(dataCenterId); return getBackendCollection(VdcQueryType.GetAllNetworks, params); }
public static void main(java.lang.String... args) { org.ovirt.engine.core.config.EngineConfigCLIParser parser = null; try { parser = new org.ovirt.engine.core.config.EngineConfigCLIParser(); parser.parse(args); org.ovirt.engine.core.config.EngineConfigMap argsMap = parser.getEngineConfigMap(); if ((argsMap.getLogFile()) != null) { org.ovirt.engine.core.utils.log.JavaLoggingUtils.addFileHandler(argsMap.getLogFile()); } if ((argsMap.getLogLevel()) != null) { org.ovirt.engine.core.utils.log.JavaLoggingUtils.setLogLevel(argsMap.getLogLevel()); } } catch (java.lang.Throwable t) { java.lang.System.out.println(t.getMessage()); java.lang.System.exit(1); } try { org.ovirt.engine.core.config.EngineConfig.getInstance().setUpAndExecute(parser); } catch (java.lang.Throwable t) { org.slf4j.LoggerFactory.getLogger(org.ovirt.engine.core.config.EngineConfigExecutor.class).debug("Exiting with error: ", t); java.lang.System.out.println(t.getMessage()); java.lang.System.exit(1); } }
private void updateDiscoveredHostList(java.lang.String searchFilter) { org.ovirt.engine.core.common.businessentities.Provider provider = getProviders().getSelectedItem(); if (provider != null) { org.ovirt.engine.ui.frontend.AsyncQuery getHostsQuery = new org.ovirt.engine.ui.frontend.AsyncQuery(); getHostsQuery.asyncCallback = new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object result) { java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VDS> hosts = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VDS>) (result)); org.ovirt.engine.ui.uicommonweb.models.ListModel<org.ovirt.engine.core.common.businessentities.VDS> hostNameListModel = getExternalHostName(); hostNameListModel.setItems(hosts); hostNameListModel.setIsChangable(true); setEnableSearchHost(true); } }; org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getExternalProviderHostList(getHostsQuery, provider.getId(), true, searchFilter); } else { getExternalHostName().setItems(null); getExternalHostName().setIsChangable(false); setEnableSearchHost(false); } }
protected boolean canAddVm(java.util.ArrayList<java.lang.String> reasons, java.util.Collection<org.ovirt.engine.core.common.businessentities.storage_domains> destStorages) { org.ovirt.engine.core.common.businessentities.VmStatic vmStaticFromParams = org.ovirt.engine.core.bll.AddVmCommand.getParameters().getVmStaticData(); boolean returnValue = canAddVm(reasons, vmStaticFromParams.getVmName(), org.ovirt.engine.core.bll.AddVmCommand.getStoragePoolId().getValue(), vmStaticFromParams.getPriority()); if (returnValue) { java.util.List<org.ovirt.engine.core.utils.vmproperties.VmPropertiesUtils.ValidationError> validationErrors = validateCustomProperties(vmStaticFromParams); if (!(validationErrors.isEmpty())) { org.ovirt.engine.core.bll.VmHandler.handleCustomPropertiesError(validationErrors, reasons); returnValue = false; } } if (returnValue && (shouldCheckSpaceInStorageDomains())) { if (!(org.ovirt.engine.core.bll.AddVmCommand.getStoragePoolId().equals(getStoragePoolIdFromSourceImageContainer()))) { reasons.add(VdcBllMessages.ACTION_TYPE_FAILED_STORAGE_POOL_NOT_MATCH.toString()); returnValue = false; } else { for (org.ovirt.engine.core.common.businessentities.storage_domains domain : destStorages) { org.ovirt.engine.core.bll.validator.StorageDomainValidator storageDomainValidator = new org.ovirt.engine.core.bll.validator.StorageDomainValidator(domain); if ((!(validate(storageDomainValidator.isDomainWithinThresholds()))) || (!(validate(storageDomainValidator.isDomainHasSpaceForRequest(getNeededDiskSize(domain.getId())))))) { return false; } } } } if (returnValue) { returnValue = isDedicatedVdsOnSameCluster(vmStaticFromParams); } return returnValue; }
private boolean validateStorage() { java.util.List<org.ovirt.engine.core.common.businessentities.storage.DiskImage> vmDisksList = getDisksListForChecks(); vmDisksList = org.ovirt.engine.core.bll.storage.disk.image.ImagesHandler.getDisksDummiesForStorageAllocations(vmDisksList); java.util.List<org.ovirt.engine.core.common.businessentities.storage.DiskImage> allDisks = new java.util.ArrayList(vmDisksList); java.util.List<org.ovirt.engine.core.common.businessentities.storage.DiskImage> memoryDisksList = null; if (org.ovirt.engine.core.bll.snapshots.CreateAllSnapshotsFromVmCommand.getParameters().isSaveMemory()) { memoryDisksList = org.ovirt.engine.core.bll.memory.MemoryUtils.createDiskDummies(org.ovirt.engine.core.bll.utils.VmUtils.getSnapshotMemorySizeInBytes(org.ovirt.engine.core.bll.snapshots.CreateAllSnapshotsFromVmCommand.getVm()), MemoryUtils.METADATA_SIZE_IN_BYTES); if (Guid.Empty.equals(getStorageDomainIdForVmMemory(memoryDisksList))) { return failValidation(EngineMessage.ACTION_TYPE_FAILED_NO_SUITABLE_DOMAIN_FOUND); } allDisks.addAll(memoryDisksList); } org.ovirt.engine.core.bll.validator.storage.MultipleStorageDomainsValidator sdValidator = createMultipleStorageDomainsValidator(allDisks); if (((!(validate(sdValidator.allDomainsExistAndActive()))) || (!(validate(sdValidator.allDomainsWithinThresholds())))) || (!(validateCinder()))) { return false; } if (memoryDisksList == null) { return validate(sdValidator.allDomainsHaveSpaceForNewDisks(vmDisksList)); } return validate(sdValidator.allDomainsHaveSpaceForAllDisks(vmDisksList, memoryDisksList)); }
public java.lang.String getReason() { if (((mReason) == null) && ((getVm()) != null)) { mReason = getVm().getStopReason(); } return mReason; }
private void addQuotaToVcpuQuotaList(org.ovirt.engine.core.common.businessentities.QuotaUsagePerUser quotaPerUserUsageEntity) { org.ovirt.engine.ui.userportal.widget.QuotaProgressBar vcpuQuotaProgressBar = new org.ovirt.engine.ui.userportal.widget.QuotaProgressBar(); if (quotaPerUserUsageEntity.isUnlimitedVcpu()) { vcpuQuotaProgressBar.setUnlimited(true); } else { vcpuQuotaProgressBar.setValueA(((int) (quotaPerUserUsageEntity.getOthersVcpuUsagePercentage()))); vcpuQuotaProgressBar.setValueB(((int) (quotaPerUserUsageEntity.getUserVcpuUsagePercentage()))); vcpuQuotaProgressBar.setTitle(org.ovirt.engine.ui.userportal.section.main.view.tab.extended.SideTabExtendedResourceView.messages.quotaFreeCpus(quotaPerUserUsageEntity.getFreeVcpu())); if ((quotaPerUserUsageEntity.getVcpuTotalUsage()) == 0) { vcpuQuotaProgressBar.setZeroValue(); } } addQuotaRow(cpusQuotasList, quotaPerUserUsageEntity.getQuotaName(), vcpuQuotaProgressBar); }
@java.lang.Override public java.lang.String toString() { java.lang.StringBuilder sb = new java.lang.StringBuilder(); sb.append("{ id: "); sb.append(this.getid()); sb.append(", connection: "); sb.append(this.getconnection()); sb.append(", iqn: "); sb.append(this.getiqn()); sb.append(", vfsType: "); sb.append(this.getVfsType()); sb.append(", mountOptions: "); sb.append(this.getMountOptions()); sb.append(", nfsVersion: "); sb.append(this.getNfsVersion()); sb.append(", nfsRetrans: "); sb.append(this.getNfsRetrans()); sb.append(", nfsTimeo: "); sb.append(this.getNfsTimeo()); if ((this.getIface()) != null) { sb.append(", iface: "); sb.append(this.getIface()); } if ((getNetIfaceName()) != null) { sb.append(", netIfaceName: "); sb.append(this.getNetIfaceName()); } sb.append(" };"); return sb.toString(); }
private org.ovirt.engine.core.utils.lock.EngineLock createEngineLockForRunVm(org.ovirt.engine.core.compat.Guid vmId, java.lang.String lockMessage) { return new org.ovirt.engine.core.utils.lock.EngineLock(org.ovirt.engine.core.bll.RunVmCommandBase.getExclusiveLocksForRunVm(vmId, lockMessage), org.ovirt.engine.core.bll.RunVmCommandBase.getSharedLocksForRunVm()); }
@java.lang.Override public java.util.Map<java.lang.String, java.lang.String> getJobMessageProperties() { if ((jobProperties) == null) { jobProperties = super.getJobMessageProperties(); if ((getSnapshotName()) != null) { jobProperties.put(VdcObjectType.Snapshot.name().toLowerCase(), getSnapshotName()); } } return jobProperties; }
public org.ovirt.engine.core.bll.ValidationResult notLabeled() { return org.ovirt.engine.core.bll.ValidationResult.failWith(EngineMessage.ACTION_TYPE_FAILED_NETWORK_ALREADY_LABELED).when(org.ovirt.engine.core.utils.NetworkUtils.isLabeled(network)); }
@java.lang.Override public int hashCode() { return java.util.Objects.hash(snapshotId, clusterId, volumeId, snapshotName, description, status); }
public java.lang.String getMemoryVolume() { return memoryVolume; }
@java.lang.Override public java.lang.String toString() { return java.lang.String.format("hostId = %s, deviceName = %s", getHostId(), getDeviceName()); }
protected boolean isPopulate() { java.util.List<java.lang.String> populates = httpHeaders.getRequestHeader(org.ovirt.engine.api.restapi.resource.BackendResource.POPULATE); if ((populates != null) && ((populates.size()) > 0)) { return java.lang.Boolean.valueOf(populates.get(0)).booleanValue(); } else { return false; } }
private void formatAndSetErrorMessage(java.lang.String message) { com.google.gwt.safehtml.shared.SafeHtml safeMessage = null; if (message != null) { com.google.gwt.safehtml.shared.SafeHtmlBuilder builder = new com.google.gwt.safehtml.shared.SafeHtmlBuilder(); int urlIndex = message.indexOf("http"); if (urlIndex != (-1)) { java.lang.String beforeURL = message.substring(0, urlIndex); int afterUrlMessageIndex = message.indexOf(" ", urlIndex); int endIndex = (afterUrlMessageIndex > (-1)) ? afterUrlMessageIndex : message.length(); java.lang.String url = com.google.gwt.safehtml.shared.UriUtils.sanitizeUri(message.substring(urlIndex, endIndex)); java.lang.String motdAnchor = org.ovirt.engine.ui.common.presenter.AbstractLoginPopupPresenterWidget.getView().getMotdAnchorHtml(url); builder.appendEscaped(beforeURL).append(com.google.gwt.safehtml.shared.SafeHtmlUtils.fromTrustedString(motdAnchor)); if (endIndex < (message.length())) { builder.appendEscaped(message.substring(endIndex)); } } else { builder.appendEscaped(message); } safeMessage = builder.toSafeHtml(); } org.ovirt.engine.ui.common.presenter.AbstractLoginPopupPresenterWidget.getView().setErrorMessageHtml(safeMessage); }
@org.junit.Test public void testNetworksOnNicMatchMtuWhenNoNetworksAreProvided() throws java.lang.Exception { java.util.Map<java.lang.String, java.util.List<org.ovirt.engine.core.common.businessentities.network.Network>> networksOnNics = java.util.Collections.singletonMap("nicName", java.util.Collections.<org.ovirt.engine.core.common.businessentities.network.Network>emptyList()); org.ovirt.engine.core.bll.network.host.NetworkMtuValidator networkMtuValidator = new org.ovirt.engine.core.bll.network.host.NetworkMtuValidator(new org.ovirt.engine.core.common.businessentities.BusinessEntityMap(java.util.Collections.<org.ovirt.engine.core.common.businessentities.network.Network>emptyList())); assertThat(networkMtuValidator.validateMtu(networksOnNics), isValid()); }
public java.lang.String allocateNewMac() { java.lang.String mac = null; org.ovirt.engine.core.bll.network.MacPoolManager.log.info("MacPoolManager::allocateNewMac entered"); lockObj.writeLock().lock(); try { if (!(initialized)) { logInitializationError("Failed to allocate new Mac address."); throw new org.ovirt.engine.core.common.errors.VdcBLLException(org.ovirt.engine.core.common.errors.VdcBllErrors.MAC_POOL_NOT_INITIALIZED); } if (availableMacs.isEmpty()) { throw new org.ovirt.engine.core.common.errors.VdcBLLException(org.ovirt.engine.core.common.errors.VdcBllErrors.MAC_POOL_NO_MACS_LEFT); } java.util.Iterator<java.lang.String> my = availableMacs.iterator(); mac = my.next(); commitNewMac(mac); } finally { lockObj.writeLock().unlock(); } org.ovirt.engine.core.bll.network.MacPoolManager.log.infoFormat("MacPoolManager::allocateNewMac allocated mac = '{0}", mac); return mac; }
@java.lang.Override public javax.ws.rs.core.Response start(org.ovirt.engine.api.model.Action action) { org.ovirt.engine.core.common.action.RunVmParams params; org.ovirt.engine.core.common.action.VdcActionType actionType; if (action.isSetVm()) { org.ovirt.engine.api.model.VM vm = action.getVm(); validateEnums(org.ovirt.engine.api.model.VM.class, vm); actionType = org.ovirt.engine.core.common.action.VdcActionType.RunVmOnce; params = createRunVmOnceParams(vm); } else { actionType = org.ovirt.engine.core.common.action.VdcActionType.RunVm; params = new org.ovirt.engine.core.common.action.RunVmParams(guid); } if ((action.isSetPause()) && (action.isPause())) { params.setRunAndPause(true); } boolean useSysprep = (action.isSetUseSysprep()) && (action.isUseSysprep()); boolean useCloudInit = (action.isSetUseCloudInit()) && (action.isUseCloudInit()); if (useSysprep && useCloudInit) { org.ovirt.engine.api.model.Fault fault = new org.ovirt.engine.api.model.Fault(); fault.setReason(localize(Messages.CANT_USE_SYSPREP_AND_CLOUD_INIT_SIMULTANEOUSLY)); return javax.ws.rs.core.Response.status(Response.Status.CONFLICT).entity(fault).build(); } if (useSysprep) { params.setInitializationType(InitializationType.Sysprep); } else if (useCloudInit) { params.setInitializationType(InitializationType.CloudInit); } else { params.setInitializationType(InitializationType.None); } return doAction(actionType, params, action); }
protected boolean validateUniqueVmName() { return org.ovirt.engine.core.bll.VmHandler.isVmWithSameNameExistStatic(org.ovirt.engine.core.bll.ImportVmCommandBase.getVm().getName(), org.ovirt.engine.core.bll.ImportVmCommandBase.getStoragePoolId()) ? failCanDoAction(EngineMessage.VM_CANNOT_IMPORT_VM_NAME_EXISTS) : true; }
@javax.enterprise.inject.Produces private org.ovirt.engine.core.dao.network.NetworkClusterDao produceNetworkClusterDao(org.ovirt.engine.core.dal.dbbroker.DbFacade dbFacade) { return dbFacade.getNetworkClusterDao(); }
void initListBoxEditors() { isoEditor = new org.ovirt.engine.ui.common.widget.editor.ListModelListBoxEditor<java.lang.Object>(new org.ovirt.engine.ui.common.widget.renderer.NullSafeRenderer<java.lang.Object>() { @java.lang.Override public java.lang.String renderNullSafe(java.lang.Object object) { org.ovirt.engine.core.compat.RpmVersion version = ((org.ovirt.engine.core.compat.RpmVersion) (object)); return version.getRpmName(); } }); rbPassword = new com.google.gwt.user.client.ui.RadioButton("1"); rbPublicKey = new com.google.gwt.user.client.ui.RadioButton("1"); publicKeyEditor = new org.ovirt.engine.ui.common.widget.editor.EntityModelTextAreaLabelEditor(true, true); }
@java.lang.Override protected void endWithFailure() { endCommand(); org.ovirt.engine.core.bll.storage.domain.DeactivateStorageDomainWithOvfUpdateCommand.setSucceeded(true); }
public org.ovirt.engine.ui.uicommonweb.models.ListModel<org.ovirt.engine.core.common.businessentities.network.NetworkQoS> getQos() { return qos; }
private void createImageForVmMetaData() { org.ovirt.engine.core.common.vdscommands.VDSReturnValue retVal = org.ovirt.engine.core.bll.Backend.getInstance().getResourceManager().RunVdsCommand(VDSCommandType.CreateImage, new org.ovirt.engine.core.common.vdscommands.CreateImageVDSCommandParameters(storagePool.getId(), storageDomainId, vmConfImageGroupId, MemoryUtils.META_DATA_SIZE_IN_BYTES, org.ovirt.engine.core.common.businessentities.storage.VolumeType.Sparse, org.ovirt.engine.core.common.businessentities.storage.VolumeFormat.COW, vmConfVolumeId, "")); if (!(retVal.getSucceeded())) { throw new org.ovirt.engine.core.common.errors.EngineException(org.ovirt.engine.core.common.errors.EngineError.VolumeCreationError, "Failed to create image for vm configuration!"); } org.ovirt.engine.core.compat.Guid taskId = enclosingCommand.persistAsyncTaskPlaceHolder(org.ovirt.engine.core.bll.memory.LiveSnapshotMemoryImageBuilder.CREATE_IMAGE_FOR_VM_TASK_KEY); org.ovirt.engine.core.compat.Guid guid = enclosingCommand.createTask(taskId, retVal.getCreationInfo(), enclosingCommand.getActionType()); enclosingCommand.getTaskIdList().add(guid); }
@java.lang.Override protected void initDetailModels() { super.initDetailModels(); setBrickListModel(new org.ovirt.engine.ui.uicommonweb.models.gluster.VolumeBrickListModel()); setGeoRepListModel(new org.ovirt.engine.ui.uicommonweb.models.gluster.VolumeGeoRepListModel()); setSnapshotListModel(new org.ovirt.engine.ui.uicommonweb.models.gluster.GlusterVolumeSnapshotListModel()); org.ovirt.engine.ui.uicompat.ObservableCollection<org.ovirt.engine.ui.uicommonweb.models.EntityModel> list = new org.ovirt.engine.ui.uicompat.ObservableCollection<org.ovirt.engine.ui.uicommonweb.models.EntityModel>(); list.add(new org.ovirt.engine.ui.uicommonweb.models.gluster.VolumeGeneralModel()); list.add(new org.ovirt.engine.ui.uicommonweb.models.gluster.VolumeParameterListModel()); list.add(getBrickListModel()); list.add(getGeoRepListModel()); list.add(new org.ovirt.engine.ui.uicommonweb.models.configure.PermissionListModel()); list.add(new org.ovirt.engine.ui.uicommonweb.models.gluster.VolumeEventListModel()); list.add(getSnapshotListModel()); setDetailModels(list); }
private java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.businessentities.gluster.GlusterServerService> getExistingServicesMap(org.ovirt.engine.core.common.businessentities.VDS server) { java.util.List<org.ovirt.engine.core.common.businessentities.gluster.GlusterServerService> existingServices = getGlusterServerServiceDao().getByServerId(server.getId()); java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.businessentities.gluster.GlusterServerService> existingServicesMap = new java.util.HashMap<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.businessentities.gluster.GlusterServerService>(); if (existingServices != null) { for (org.ovirt.engine.core.common.businessentities.gluster.GlusterServerService service : existingServices) { existingServicesMap.put(service.getServiceId(), service); } } return existingServicesMap; }
public org.ovirt.engine.core.bll.ValidationResult allPassthroughVnicsMigratable() { java.util.List<org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface> vnics = getDbFacade().getVmNetworkInterfaceDao().getAllForVm(vm.getId()); java.util.List<java.lang.String> nonMigratablePassthroughVnicNames = vnics.stream().filter(isVnicMigratable(vm).negate()).map(VmNic::getName).collect(java.util.stream.Collectors.toList()); if (!(nonMigratablePassthroughVnicNames.isEmpty())) { java.util.Collection<java.lang.String> replacements = org.ovirt.engine.core.utils.ReplacementUtils.replaceWith("interfaces", nonMigratablePassthroughVnicNames); replacements.add(java.lang.String.format("$vmName %s", vm.getName())); return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_MIGRATION_OF_NON_MIGRATABLE_PASSTHROUGH_VNICS_IS_NOT_SUPPORTED, replacements); } return org.ovirt.engine.core.bll.ValidationResult.VALID; }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("Network Filter") java.lang.String networkFilterNameVnicProfile();
public org.ovirt.engine.api.restapi.resource.BackendDataCenterClustersResource getParent() { return parent; }
public void registerTransport(org.ovirt.engine.core.notifier.transport.Transport transport) { if (transport.isActive()) { firstMatchSimpleFilter.registerTransport(transport); transport.registerObserver(this.eventsManager); transports.add(transport); } }
public java.util.List<org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface> getModifiedInterfaces() { return modifiedInterfaces; }
@org.ovirt.engine.api.restapi.types.Mapping(from = org.ovirt.engine.core.common.businessentities.VDS.class, to = org.ovirt.engine.api.model.HostedEngine.class) public static org.ovirt.engine.api.model.HostedEngine map(org.ovirt.engine.core.common.businessentities.VDS entity, org.ovirt.engine.api.model.HostedEngine template) { org.ovirt.engine.api.model.HostedEngine hostedEngine = (template != null) ? template : new org.ovirt.engine.api.model.HostedEngine(); hostedEngine.setConfigured(entity.getHighlyAvailableIsConfigured()); hostedEngine.setActive(entity.getHighlyAvailableIsActive()); hostedEngine.setScore(entity.getHighlyAvailableScore()); hostedEngine.setGlobalMaintenance(entity.getHighlyAvailableGlobalMaintenance()); hostedEngine.setLocalMaintenance(entity.getHighlyAvailableLocalMaintenance()); return hostedEngine; }
public static java.lang.String decryptPassword(java.lang.String password) { if (org.apache.commons.lang.StringUtils.isEmpty(password)) { return password; } java.lang.String keyFile = org.ovirt.engine.core.common.config.Config.resolveKeyStorePath(); java.lang.String passwd = org.ovirt.engine.core.common.config.Config.<java.lang.String>GetValue(ConfigValues.keystorePass, Config.DefaultConfigurationVersion); java.lang.String alias = org.ovirt.engine.core.common.config.Config.<java.lang.String>GetValue(ConfigValues.CertAlias, Config.DefaultConfigurationVersion); try { return org.ovirt.engine.core.engineencryptutils.EncryptionUtils.decrypt(password, keyFile, passwd, alias); } catch (java.lang.Exception e) { org.ovirt.engine.core.dao.VdsStaticDAODbFacadeImpl.log.debugFormat("Failed to decrypt password, error message: {0}", e.getMessage()); return password; } }
@java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { final boolean isVirtGlusterAllowed = ((java.lang.Boolean) (returnValue)); org.ovirt.engine.ui.frontend.AsyncQuery asyncQuery = new org.ovirt.engine.ui.frontend.AsyncQuery(); asyncQuery.setModel(clusterModel); asyncQuery.asyncCallback = new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model1, java.lang.Object result) { java.util.List<org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity> volumes = ((java.util.List<org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity>) (result)); if ((volumes.size()) > 0) { clusterModel.getEnableGlusterService().setIsChangeable(false); if (!isVirtGlusterAllowed) { clusterModel.getEnableOvirtService().setIsChangeable(false); } } } }; org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getInstance().getVolumeList(asyncQuery, cluster.getName()); if ((cluster.getGroupHostsAndVms().getVms()) > 0) { clusterModel.getEnableOvirtService().setIsChangeable(false); if (!isVirtGlusterAllowed) { clusterModel.getEnableGlusterService().setIsChangeable(false); } } if ((cluster.getGroupHostsAndVms().getHosts()) > 0) { clusterModel.getEnableTrustedService().setIsChangeable(false); clusterModel.getEnableTrustedService().setChangeProhibitionReason(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().trustedServiceDisabled()); } }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.Permission> getTreeForEntity(org.ovirt.engine.core.compat.Guid id, org.ovirt.engine.core.common.VdcObjectType type, long engineSessionSeqId, boolean isFiltered, int appMode) { org.springframework.jdbc.core.namedparam.MapSqlParameterSource parameterSource = getCustomMapSqlParameterSource().addValue("id", id).addValue("object_type_id", type.getValue()).addValue("engine_session_seq_id", engineSessionSeqId).addValue("is_filtered", isFiltered).addValue("app_mode", appMode); return getCallsHandler().executeReadList("GetPermissionsTreeByEntityId", org.ovirt.engine.core.dao.PermissionDaoImpl.PermissionRowMapper.instance, parameterSource); }
@java.lang.Override public java.lang.String render(org.ovirt.engine.core.common.businessentities.ArchitectureType object) { if ((object == null) || (object == (org.ovirt.engine.core.common.businessentities.ArchitectureType.undefined))) { return super.render(object); } else { return object.toString(); } }
private void logUnsynchronizedNetworks(org.ovirt.engine.core.common.businessentities.VDS host, java.util.Map<java.lang.String, org.ovirt.engine.core.common.businessentities.network.Network> networks) { java.util.List<java.lang.String> networkNames = new java.util.ArrayList<>(); org.ovirt.engine.core.dao.network.NetworkQoSDao qosDao = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getNetworkQosDao(); for (org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface iface : host.getInterfaces()) { org.ovirt.engine.core.common.businessentities.network.Network network = networks.get(iface.getNetworkName()); org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface.NetworkImplementationDetails networkImplementationDetails = org.ovirt.engine.core.utils.NetworkUtils.calculateNetworkImplementationDetails(network, (network == null ? null : qosDao.get(network.getQosId())), iface); if (((networkImplementationDetails != null) && (!(networkImplementationDetails.isInSync()))) && (networkImplementationDetails.isManaged())) { networkNames.add(iface.getNetworkName()); } } if (!(networkNames.isEmpty())) { org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase logable = new org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase(host.getId()); logable.addCustomValue("Networks", org.apache.commons.lang.StringUtils.join(networkNames, ",")); org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogDirector.log(logable, AuditLogType.VDS_NETWORKS_OUT_OF_SYNC); } }
@java.lang.Override protected void endWithFailure() { if (isStatelessSnapshotExistsForVm()) { org.ovirt.engine.core.common.action.VdcReturnValueBase vdcReturnValue = org.ovirt.engine.core.bll.RunVmCommand.getBackend().endAction(VdcActionType.CreateAllSnapshotsFromVm, buildCreateSnapshotParametersForEndAction(), org.ovirt.engine.core.bll.RunVmCommand.cloneContext().withoutExecutionContext().withoutLock()); setSucceeded(vdcReturnValue.getSucceeded()); } else { super.endWithFailure(); } }
public static java.lang.String getOsName(int osId) { return org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.osNames.get(osId); }
public java.util.Map activateStorageDomain(java.lang.String sdUUID, java.lang.String spUUID) { try { log.info("Activating storage domain, spUUID: {} sdUUID: {}", new java.lang.Object[]{ spUUID, sdUUID }); final org.ovirt.vdsmfake.domain.StorageDomain storageDomain = getDataCenterById(spUUID).getStorageDomainMap().get(sdUUID); if (storageDomain != null) { activateClearance(storageDomain); log.info("storage were activated {} {}", storageDomain.getName(), sdUUID); } else { log.warn("No storage domains were activated for storage domain '{}' and storage pool '{}'", sdUUID, spUUID); } return getOKStatus(); } catch (java.lang.Exception e) { throw error(e); } }
private java.util.Collection<org.ovirt.engine.core.common.businessentities.network.NetworkAttachment> getAttachmentsToConfigure() { java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.businessentities.network.NetworkAttachment> attachmentsToConfigure = new java.util.HashMap(org.ovirt.engine.core.common.businessentities.Entities.businessEntitiesById(existingAttachments)); for (org.ovirt.engine.core.common.businessentities.network.NetworkAttachment removedAttachment : removedNetworkAttachments) { attachmentsToConfigure.remove(removedAttachment.getId()); } java.util.List<org.ovirt.engine.core.common.businessentities.network.NetworkAttachment> newAttachments = new java.util.ArrayList<>(); for (org.ovirt.engine.core.common.businessentities.network.NetworkAttachment attachment : params.getNetworkAttachments()) { if ((attachment.getId()) == null) { newAttachments.add(attachment); continue; } if (removedBondVdsNetworkInterfaceMap.containsKey(attachment.getNicName())) { attachmentsToConfigure.put(attachment.getId(), attachment); } else { attachmentsToConfigure.remove(attachment.getId()); } } java.util.Collection<org.ovirt.engine.core.common.businessentities.network.NetworkAttachment> candidateAttachments = new java.util.ArrayList(attachmentsToConfigure.values()); candidateAttachments.addAll(newAttachments); return candidateAttachments; }
private void clusterSelectedItemChanged() { setBricks(new org.ovirt.engine.ui.uicommonweb.models.ListModel()); setMessage(null); if ((getCluster().getSelectedItem()) != null) { org.ovirt.engine.core.common.businessentities.VDSGroup cluster = ((org.ovirt.engine.core.common.businessentities.VDSGroup) (getCluster().getSelectedItem())); org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.GetHostListByCluster(new org.ovirt.engine.ui.frontend.AsyncQuery(this, new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void OnSuccess(java.lang.Object model, java.lang.Object returnValue) { java.util.List<org.ovirt.engine.core.common.businessentities.VDS> hostList = ((java.util.List<org.ovirt.engine.core.common.businessentities.VDS>) (returnValue)); for (org.ovirt.engine.core.common.businessentities.VDS host : hostList) { if ((host.getstatus()) == (org.ovirt.engine.core.common.businessentities.VDSStatus.Up)) { getAddBricksCommand().setIsExecutionAllowed(true); return; } } getAddBricksCommand().setIsExecutionAllowed(false); setMessage(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().volumeEmptyClusterValidationMsg()); } }), cluster.getname()); } else { getAddBricksCommand().setIsExecutionAllowed(false); } }
@java.lang.Override public org.ovirt.engine.core.common.AuditLogType getAuditLogTypeValue() { return org.ovirt.engine.core.bll.storage.domain.DetachStorageDomainFromPoolCommand.getSucceeded() ? org.ovirt.engine.core.common.AuditLogType.USER_DETACH_STORAGE_DOMAIN_FROM_POOL : org.ovirt.engine.core.common.AuditLogType.USER_DETACH_STORAGE_DOMAIN_FROM_POOL_FAILED; }
public static boolean isOsSupportedForVirtIoScsi(int osId, org.ovirt.engine.core.compat.Version clusterVersion) { java.util.List<java.lang.String> diskInterfaces = org.ovirt.engine.core.common.utils.SimpleDependecyInjector.getInstance().get(org.ovirt.engine.core.common.osinfo.OsRepository.class).getDiskInterfaces(osId, clusterVersion); return diskInterfaces.contains(DiskInterface.VirtIO_SCSI.toString()); }
@java.lang.Override public java.lang.String toString() { java.lang.StringBuilder builder = new java.lang.StringBuilder(); builder.append("Subnet [id=").append(getId()).append(", name=").append(getName()).append(", cidr=").append(getCidr()).append(", ipVersion=").append(getIpVersion()).append(", externalNetwork=").append(getExternalNetwork()).append(", gateway=").append(getGateway()).append(", dnsServers=").append(getDnsServers()).append("]"); return builder.toString(); }
private org.ovirt.engine.core.common.utils.Pair<T, V> addGhostEntry() { T value = createGhostValue(); V widget = addEntry(value); return new org.ovirt.engine.core.common.utils.Pair<T, V>(value, widget); }
@java.lang.Override public void onSuccess(java.lang.Object target, java.lang.Object returnValue) { java.util.List<org.ovirt.engine.core.common.businessentities.VDS> hosts = ((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (returnValue)).getReturnValue(); boolean succeeded = true; for (org.ovirt.engine.core.common.businessentities.VDS host : hosts) { if ((host.getStatus()) != (org.ovirt.engine.core.common.businessentities.VDSStatus.Up)) { succeeded = false; } } guideModel.getWindow().stopProgress(); guideModel.cancel(); if (succeeded) { guideModel.postAction(); } else { errorPopupManager.show(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().hostActivationTimeOut()); } }
@java.lang.Override public void switchToSecondary() { expandAllButton.setText(secondaryText); expandAllButton.setIcon(secondaryIcon); }
@java.lang.Override protected void postConstruct() { super.postConstruct(); T parameters = getParameters(); setVmId(parameters.getContainerId()); setVm(parameters.getVm()); setVdsGroupId(parameters.getVdsGroupId()); if (((parameters.getVm()) != null) && ((getVm().getDiskMap()) != null)) { imageList = new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.storage.DiskImage>(); for (org.ovirt.engine.core.common.businessentities.storage.Disk disk : getVm().getDiskMap().values()) { if ((disk.getDiskStorageType()) == (org.ovirt.engine.core.common.businessentities.storage.DiskStorageType.IMAGE)) { imageList.add(((org.ovirt.engine.core.common.businessentities.storage.DiskImage) (disk))); } } } ensureDomainMap(imageList, parameters.getDestDomainId()); org.ovirt.engine.core.compat.Version clusterVersion = ((org.ovirt.engine.core.bll.ImportVmCommand.getVdsGroup()) == null) ? null : org.ovirt.engine.core.bll.ImportVmCommand.getVdsGroup().getCompatibilityVersion(); org.ovirt.engine.core.common.businessentities.VmStatic staticData = ((getVm()) == null) ? null : getVm().getStaticData(); org.ovirt.engine.core.bll.ImportUtils.updateGraphicsDevices(staticData, clusterVersion); }
@java.lang.Override protected boolean validate() { if (!(super.validate())) { return false; } org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity glusterVolume = getGlusterVolume(); if (!(glusterVolume.isOnline())) { return failValidation(EngineMessage.ACTION_TYPE_FAILED_GLUSTER_VOLUME_SHOULD_BE_STARTED); } return true; }
@org.junit.Test public void testReattachingPreexistingNetworkAfterItsBeingDetached() throws java.lang.Exception { when(logicalNetworkModelOfNetworkA.isAttached()).thenReturn(false); org.ovirt.engine.core.compat.Guid networkAttachmentId = org.ovirt.engine.core.compat.Guid.newGuid(); org.ovirt.engine.core.common.businessentities.network.NetworkAttachment networkAttachment = org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkOperation.newNetworkAttachment(networkA, nicA, networkAttachmentId); existingNetworkAttachments.add(networkAttachment); dataFromHostSetupNetworksModel.removedNetworkAttachments.add(networkAttachment); NetworkOperation.ATTACH_NETWORK.getTarget().executeNetworkCommand(logicalNetworkModelOfNetworkA, networkInterfaceModelOfNicA, dataFromHostSetupNetworksModel); assertThat(dataFromHostSetupNetworksModel.newOrModifiedNetworkAttachments.size(), is(1)); org.ovirt.engine.core.common.businessentities.network.NetworkAttachment updatedNetworkAttachment = dataFromHostSetupNetworksModel.newOrModifiedNetworkAttachments.iterator().next(); assertNetworkAttachment(updatedNetworkAttachment, networkAttachmentId, networkA.getId(), nicA.getId()); assertThat(dataFromHostSetupNetworksModel.removedNetworkAttachments.size(), is(0)); }
@org.junit.Test public void testGetByNameAndCluster() { org.ovirt.engine.core.common.businessentities.Network result = dao.getByNameAndCluster(org.ovirt.engine.core.dao.NetworkDAOTest.EXISTING_NETWORK_NAME, cluster); assertNotNull(result); assertEquals(org.ovirt.engine.core.dao.NetworkDAOTest.EXISTING_NETWORK_NAME, result.getname()); }
@java.lang.Override protected boolean canDoAction() { if (!(super.canDoAction())) { return false; } final org.ovirt.engine.core.bll.MacPoolValidator validator = new org.ovirt.engine.core.bll.MacPoolValidator(getMacPoolEntity()); return (validate(validator.defaultPoolFlagIsNotSet())) && (validate(validator.hasUniqueName())); }
@java.lang.Override protected org.ovirt.engine.core.bll.context.CommandContext createMigrateVmContext(org.ovirt.engine.core.bll.job.ExecutionContext parentContext, org.ovirt.engine.core.common.businessentities.VM vm) { return org.ovirt.engine.core.bll.job.ExecutionHandler.createInternalJobContext(); }
com.google.gwt.safehtml.shared.SafeHtml getResourceImage(org.ovirt.engine.core.common.businessentities.VM vm) { if (((vm.getVmPauseStatus()) != (org.ovirt.engine.core.common.businessentities.VmPauseStatus.NONE)) || ((vm.getVmPauseStatus()) != (org.ovirt.engine.core.common.businessentities.VmPauseStatus.NOERR))) { return null; } else { com.google.gwt.resources.client.ImageResource alertImageResource = resources.alertImage(); com.google.gwt.user.client.ui.AbstractImagePrototype imagePrototype = com.google.gwt.user.client.ui.AbstractImagePrototype.create(alertImageResource); java.lang.String html = imagePrototype.getHTML(); org.ovirt.engine.ui.uicompat.Translator translator = org.ovirt.engine.ui.uicompat.EnumTranslator.getInstance(); java.lang.String toolTip = translator.get(vm.getVmPauseStatus()); html = html.replaceFirst("img", ((("img " + "title='") + toolTip) + "' ")); return com.google.gwt.safehtml.shared.SafeHtmlUtils.fromTrustedString(html); } }
@org.junit.Test public void testValidateBondOptionsForNewAttachementWithVmNetwork() { validateValidBonds(false, true, true, false); }
@java.lang.Override protected void init() { setVdsId(org.ovirt.engine.core.bll.storage.domain.ImportHostedEngineStorageDomainCommand.getParameters().getVdsId()); fetchStorageDomainInfo(); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Add Hosts") java.lang.String addMultipleHostsTitle();
public static long greatestCommonDivisor(long a, long b) { while (b != 0) { long c = b; b = a % b; a = c; } return a; }
public java.lang.Integer getGuestOsTimezoneOffset() { return guestOsTimezoneOffset; }
public static java.util.List<org.ovirt.engine.core.common.businessentities.DiskImage> filterImageDisks(java.util.Collection<? extends org.ovirt.engine.core.common.businessentities.Disk> listOfDisks, boolean allowOnlyNotShareableDisks, boolean allowOnlySnapableDisks) { java.util.List<org.ovirt.engine.core.common.businessentities.DiskImage> diskImages = new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.DiskImage>(); for (org.ovirt.engine.core.common.businessentities.Disk disk : listOfDisks) { if ((((disk.getDiskStorageType()) == (org.ovirt.engine.core.common.businessentities.Disk.DiskStorageType.IMAGE)) && ((!allowOnlyNotShareableDisks) || (!(disk.isShareable())))) && ((!allowOnlySnapableDisks) || (disk.isAllowSnapshot()))) { diskImages.add(((org.ovirt.engine.core.common.businessentities.DiskImage) (disk))); } } return diskImages; }
@java.lang.Override public void addToSlot(java.lang.Object slot, com.google.gwt.user.client.ui.Widget content) { if (slot == (org.ovirt.engine.ui.userportal.section.main.presenter.tab.basic.MainTabBasicListPresenterWidget.TYPE_VmListContent)) { vmPanel.add(content); } else { super.addToSlot(slot, content); } }
@org.junit.Test public void testQueryFailsIfPeerExists() { mockQueryParameters(org.ovirt.engine.core.bll.gluster.GetGlusterServersForImportQueryTest.NEW_SERVER, org.ovirt.engine.core.bll.gluster.GetGlusterServersForImportQueryTest.PASSWORD); doReturn(getVdsStatic()).when(vdsStaticDao).getByHostName(org.ovirt.engine.core.bll.gluster.GetGlusterServersForImportQueryTest.SERVER_NAME1); try { getQuery().executeQueryCommand(); fail("Query didn't fail when one or more peers already exist(s)!"); } catch (java.lang.RuntimeException e) { assertEquals(EngineMessage.SERVER_ALREADY_EXISTS_IN_ANOTHER_CLUSTER.toString(), e.getMessage()); } }
@org.junit.Test public void testQueryDefaultGeneralTimeZone() { mcr.mockConfigValue(ConfigValues.DefaultGeneralTimeZone, org.ovirt.engine.core.bll.GetDefualtTimeZoneQueryTest.DEFAULT_GENERAL_TIME_ZONE); when(getQueryParameters().getTimeZoneType()).thenReturn(TimeZoneType.GENERAL_TIMEZONE); getQuery().executeQueryCommand(); @java.lang.SuppressWarnings("unchecked") java.lang.String result = ((java.lang.String) (getQuery().getQueryReturnValue().getReturnValue())); assertTrue(("Wrong default time zone: " + result), result.equals(org.ovirt.engine.core.bll.GetDefualtTimeZoneQueryTest.DEFAULT_GENERAL_TIME_ZONE)); }
@java.lang.Override public org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc snapshot(java.lang.String vmId, java.util.Map<java.lang.String, java.lang.String>[] disks, java.lang.String memory, boolean frozen) { org.ovirt.vdsm.jsonrpc.client.JsonRpcRequest request = new org.ovirt.vdsm.jsonrpc.client.RequestBuilder("VM.snapshot").withParameter("vmID", vmId).withParameter("snapDrives", new java.util.ArrayList<java.util.Map<java.lang.String, java.lang.String>>(java.util.Arrays.asList(disks))).withOptionalParameter("snapMemory", memory).withParameter("frozen", frozen).build(); java.util.Map<java.lang.String, java.lang.Object> response = new org.ovirt.engine.core.vdsbroker.jsonrpc.FutureMap(this.client, request); return new org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc(response); }
protected boolean validateSpaceRequirements() { int numOfVms = org.ovirt.engine.core.bll.AddVmPoolWithVmsCommand.getParameters().getVmsCount(); java.util.List<org.ovirt.engine.core.common.businessentities.DiskImage> diskDummies = getDiskList(); java.util.List<org.ovirt.engine.core.common.businessentities.DiskImage> disksList = new java.util.ArrayList<>(); for (int i = 0; i < numOfVms; ++i) { disksList.addAll(diskDummies); } org.ovirt.engine.core.compat.Guid spId = org.ovirt.engine.core.bll.AddVmPoolWithVmsCommand.getVmTemplate().getStoragePoolId(); java.util.Set<org.ovirt.engine.core.compat.Guid> sdIds = destStorages.keySet(); org.ovirt.engine.core.bll.validator.MultipleStorageDomainsValidator storageDomainsValidator = getStorageDomainsValidator(spId, sdIds); return (validate(storageDomainsValidator.allDomainsWithinThresholds())) && (validate(storageDomainsValidator.allDomainsHaveSpaceForNewDisks(disksList))); }
public void setHostDevicePassthroughEnabled(boolean value) { vdsDynamic.setHostDevicePassthroughEnabled(value); }
@java.lang.Override protected boolean canDoAction() { if (!(validate(new org.ovirt.engine.core.bll.validator.storage.StoragePoolValidator(org.ovirt.engine.core.bll.storage.RefreshLunsSizeCommand.getStoragePool()).isUp()))) { return false; } if (!(org.ovirt.engine.core.common.FeatureSupported.refreshLunSupported(org.ovirt.engine.core.bll.storage.RefreshLunsSizeCommand.getStoragePool().getCompatibilityVersion()))) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_REFRESH_LUNS_UNSUPPORTED_ACTION); } if (!((org.ovirt.engine.core.bll.storage.RefreshLunsSizeCommand.checkStorageDomain()) && (checkStorageDomainStatus(StorageDomainStatus.Active)))) { return false; } if (!(org.ovirt.engine.core.bll.storage.RefreshLunsSizeCommand.getStorageDomain().getStorageType().isBlockDomain())) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_STORAGE_DOMAIN_TYPE_ILLEGAL); } if (!(checkLunsInStorageDomain(org.ovirt.engine.core.bll.storage.RefreshLunsSizeCommand.getParameters().getLunIds(), org.ovirt.engine.core.bll.storage.RefreshLunsSizeCommand.getStorageDomain()))) { return failCanDoAction(EngineMessage.ACTION_TYPE_FAILED_LUNS_NOT_PART_OF_STORAGE_DOMAIN); } return true; }
private void Preview() { org.ovirt.engine.core.common.businessentities.VM vm = ((org.ovirt.engine.core.common.businessentities.VM) (getEntity())); if (vm != null) { org.ovirt.engine.core.common.businessentities.Snapshot snapshot = ((org.ovirt.engine.core.common.businessentities.Snapshot) (getSelectedItem())); org.ovirt.engine.ui.frontend.Frontend.RunAction(VdcActionType.TryBackToAllSnapshotsOfVm, new org.ovirt.engine.core.common.action.TryBackToAllSnapshotsOfVmParameters(vm.getId(), snapshot.getId()), null, null); } }
@java.lang.Override protected void syncSearch() { if ((getEntity()) != null) { org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity glusterVolumeEntity = ((org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity) (getEntity())); if ((getItems()) == (glusterVolumeEntity.getBricks())) { getItemsChangedEvent().raise(this, EventArgs.EMPTY); } else { setItems(glusterVolumeEntity.getBricks()); } } else { setItems(null); } }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("The VM is suspended, it might not operate normally after resume on different cluster. It's suggested to power it off before cluster change.") java.lang.String suspendedVMsWhenClusterChange();
private void validateClusterMappings(org.ovirt.engine.api.model.Action action) { if ((action.getRegistrationConfiguration().isSetClusterMappings()) && (action.getRegistrationConfiguration().getClusterMappings().isSetRegistrationClusterMappings())) { action.getRegistrationConfiguration().getClusterMappings().getRegistrationClusterMappings().forEach(this::validateClusterMapping); } }
protected boolean isHotPlugSupported() { if (org.ovirt.engine.core.common.FeatureSupported.hotPlug(org.ovirt.engine.core.bll.VmCommand.getVm().getCompatibilityVersion())) { return true; } return failValidation(EngineMessage.HOT_PLUG_IS_NOT_SUPPORTED); }
public org.ovirt.engine.core.utils.branding.CascadingResource getCascadingResource(java.lang.String resourceName) { if (resourceName == null) { return null; } java.util.List<org.ovirt.engine.core.utils.branding.BrandingTheme> brandingThemes = getBrandingThemes(); for (int i = (brandingThemes.size()) - 1; i >= 0; i--) { org.ovirt.engine.core.utils.branding.CascadingResource cascadingResource = brandingThemes.get(i).getCascadingResource(resourceName); if (cascadingResource != null) { return cascadingResource; } } return null; }
private void tagListModel_SelectedItemsChanged(java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs e) { boolean hadSelectedTags = getHasSelectedTags(); updateHasSelectedTags(); if (getHasSelectedTags()) { setAllListModelsUnavailable(); getHostList().setIsAvailable(true); getVmList().setIsAvailable(true); getUserList().setIsAvailable(true); } else { updateAvailability(SystemTreeItemType.System, null); } org.ovirt.engine.ui.uicommonweb.models.ListModel oldSelectedItem = getSelectedItem(); if (((((getHasSelectedTags()) && (oldSelectedItem != (getHostList()))) && (oldSelectedItem != (getVolumeList()))) && (oldSelectedItem != (getVmList()))) && (oldSelectedItem != (getUserList()))) { setSelectedItem(getVmList()); } else if ((getHasSelectedTags()) || hadSelectedTags) { java.lang.String prefix = ""; java.lang.String search = ""; org.ovirt.engine.core.compat.RefObject<java.lang.String> tempRef_prefix = new org.ovirt.engine.core.compat.RefObject<java.lang.String>(prefix); org.ovirt.engine.core.compat.RefObject<java.lang.String> tempRef_search = new org.ovirt.engine.core.compat.RefObject<java.lang.String>(search); splitSearchString(getSelectedItem().getDefaultSearchString(), tempRef_prefix, tempRef_search); prefix = tempRef_prefix.argvalue; search = tempRef_search.argvalue; setSearchStringPrefix(prefix); setSearchString(search); getSearchCommand().execute(); searchStringChanged(); } }
@org.junit.Test public void movePluggedDiskAndUnpluggedDiskVmUp() { org.ovirt.engine.core.compat.Guid diskImageId1 = org.ovirt.engine.core.compat.Guid.newGuid(); org.ovirt.engine.core.compat.Guid diskImageId2 = org.ovirt.engine.core.compat.Guid.newGuid(); org.ovirt.engine.core.common.action.MoveDiskParameters moveDiskParameters1 = new org.ovirt.engine.core.common.action.MoveDiskParameters(diskImageId1, srcStorageId, dstStorageId); org.ovirt.engine.core.common.action.MoveDiskParameters moveDiskParameters2 = new org.ovirt.engine.core.common.action.MoveDiskParameters(diskImageId2, srcStorageId, dstStorageId); command.getParameters().setParametersList(java.util.Arrays.asList(moveDiskParameters1, moveDiskParameters2)); initDiskImage(diskImageId1); initDiskImage(diskImageId2); initVm(VMStatus.Up, org.ovirt.engine.core.compat.Guid.newGuid(), diskImageId1, true, diskImageId2, false); command.updateParameters(); assertTrue(command.getReturnValue().getCanDoActionMessages().contains(EngineMessage.ACTION_TYPE_FAILED_MOVE_DISKS_MIXED_PLUGGED_STATUS.toString())); }
protected java.util.List<org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface> getInterfaces(org.ovirt.engine.ui.uicommonweb.models.vms.register.RegisterVmData importEntityData) { return importEntityData.getEntity().getInterfaces(); }
public static void getLocalStorageHost(org.ovirt.engine.ui.frontend.AsyncQuery aQuery, java.lang.String dataCenterName) { aQuery.converterCallback = new org.ovirt.engine.ui.frontend.IAsyncConverter() { @java.lang.Override public java.lang.Object Convert(java.lang.Object source, org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery) { if (source != null) { for (org.ovirt.engine.core.common.businessentities.IVdcQueryable item : ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.IVdcQueryable>) (source))) { return item; } } return null; } }; org.ovirt.engine.core.common.queries.SearchParameters sp = new org.ovirt.engine.core.common.queries.SearchParameters(("hosts: datacenter=" + dataCenterName), org.ovirt.engine.core.common.interfaces.SearchType.VDS); org.ovirt.engine.ui.frontend.Frontend.RunQuery(VdcQueryType.Search, sp, aQuery); }
private static org.ovirt.engine.core.common.businessentities.VmPool cloneVmPool(org.ovirt.engine.core.common.businessentities.VmPool instance) { org.ovirt.engine.core.common.businessentities.VmPool obj = new org.ovirt.engine.core.common.businessentities.VmPool(); obj.setVmPoolId(instance.getVmPoolId()); obj.setName(instance.getName()); obj.setVmPoolType(instance.getVmPoolType()); obj.setVdsGroupId(instance.getVdsGroupId()); obj.setVmPoolType(instance.getVmPoolType()); obj.setParameters(instance.getParameters()); obj.setDefaultEndTime(instance.getDefaultEndTime()); obj.setDefaultStartTime(instance.getDefaultStartTime()); obj.setDefaultTimeInDays(instance.getDefaultTimeInDays()); obj.setVdsGroupName(instance.getVdsGroupName()); obj.setAssignedVmsCount(instance.getAssignedVmsCount()); obj.setVmPoolDescription(instance.getVmPoolDescription()); obj.setComment(instance.getComment()); obj.setRunningVmsCount(instance.getRunningVmsCount()); obj.setPrestartedVms(instance.getPrestartedVms()); return obj; }
@java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { super.eventRaised(ev, sender, args); if (getEnabled().equals(sender)) { updateChangeability(); } }
public void setSwapFree(java.lang.Long value) { vdsStatistics.setSwapFree(value); }
@java.lang.Override protected void preSave() { if (!(org.ovirt.engine.core.compat.StringHelper.stringsEqualIgnoreCase(((java.lang.String) (getUrl().getEntity())), oldUrl))) { java.util.ArrayList<org.ovirt.engine.core.common.queries.VdcQueryType> queryTypes = new java.util.ArrayList<org.ovirt.engine.core.common.queries.VdcQueryType>(); java.util.ArrayList<org.ovirt.engine.core.common.queries.VdcQueryParametersBase> queryParams = new java.util.ArrayList<org.ovirt.engine.core.common.queries.VdcQueryParametersBase>(); final java.util.Set<org.ovirt.engine.core.common.VdcObjectType> providedTypes = provider.getType().getProvidedTypes(); if (providedTypes.contains(VdcObjectType.Network)) { queryTypes.add(VdcQueryType.GetAllNetworksForProvider); queryParams.add(new org.ovirt.engine.core.common.queries.IdQueryParameters(provider.getId())); } if (!(queryTypes.isEmpty())) { startProgress(null); org.ovirt.engine.ui.frontend.Frontend.RunMultipleQueries(queryTypes, queryParams, new org.ovirt.engine.ui.uicompat.IFrontendMultipleQueryAsyncCallback() { @java.lang.SuppressWarnings("unchecked") @java.lang.Override public void executed(org.ovirt.engine.ui.uicompat.FrontendMultipleQueryAsyncResult result) { stopProgress(); java.util.Iterator<org.ovirt.engine.core.common.queries.VdcQueryReturnValue> i = result.getReturnValues().iterator(); if (providedTypes.contains(VdcObjectType.Network)) { providedNetworks = ((java.util.Collection<org.ovirt.engine.core.common.businessentities.network.Network>) (i.next().getReturnValue())); } showConfirmation(); } }); return; } } actualSave(); }
protected boolean areUpdatedFieldsLegal() { return org.ovirt.engine.core.bll.VmHandler.isUpdateValid(org.ovirt.engine.core.bll.UpdateVmCommand.getVm().getStaticData(), org.ovirt.engine.core.bll.UpdateVmCommand.getParameters().getVmStaticData(), org.ovirt.engine.core.bll.UpdateVmCommand.getVm().getStatus()); }
protected void doRegister(java.lang.String hostAddress, int hostSSHPort, java.lang.String hostSSHKeyFingerprint, java.lang.String hostSSHUser, int hostVdsPort, java.lang.String hostName, java.lang.String hostUniqueId) { if (hostSSHUser == null) { hostSSHUser = "root"; } if (hostName == null) { hostName = hostAddress; } if (hostUniqueId == null) { throw new java.lang.RuntimeException("Unique id was not provided"); } org.ovirt.engine.core.common.queries.VdcQueryReturnValue queryReturnValue = ((org.ovirt.engine.core.bll.interfaces.BackendInternal) (org.ovirt.engine.core.utils.ejb.EjbUtils.findBean(BeanType.BACKEND, BeanProxyType.LOCAL))).runInternalQuery(VdcQueryType.RegisterVds, new org.ovirt.engine.core.common.queries.hostdeploy.RegisterVdsParameters(org.ovirt.engine.core.compat.Guid.Empty, hostAddress, hostSSHPort, hostSSHKeyFingerprint, hostSSHUser, hostName, hostUniqueId, hostVdsPort, org.ovirt.engine.core.compat.Guid.Empty)); if (queryReturnValue == null) { throw new java.lang.RuntimeException("runInternalQuery failed (null)"); } if (!(queryReturnValue.getSucceeded())) { java.lang.String r = queryReturnValue.getExceptionString(); if (r == null) { throw new java.lang.RuntimeException("runInternalQuery failed (null)"); } if (!(r.equals(EngineMessage.VDS_STATUS_NOT_VALID_FOR_UPDATE.name()))) { throw new java.lang.RuntimeException(java.lang.String.format("runInternalQuery failed '%s'", r)); } } }
@java.lang.Override protected boolean canDoAction() { boolean returnValue = true; org.ovirt.engine.core.common.businessentities.Role oldRole = org.ovirt.engine.core.bll.UpdateRoleCommand.getRoleDao().get(org.ovirt.engine.core.bll.UpdateRoleCommand.getRole().getId()); if (oldRole == null) { addCanDoActionMessage(VdcBllMessages.ERROR_CANNOT_UPDATE_ROLE_ID); returnValue = false; } else { if (checkIfRoleIsReadOnly(org.ovirt.engine.core.bll.UpdateRoleCommand.getReturnValue().getCanDoActionMessages())) { returnValue = false; addCanDoActionMessage(VdcBllMessages.VAR__ACTION__UPDATE); } else if ((!(org.ovirt.engine.core.compat.StringHelper.EqOp(org.ovirt.engine.core.bll.UpdateRoleCommand.getRole().getname(), oldRole.getname()))) && ((org.ovirt.engine.core.bll.UpdateRoleCommand.getRoleDao().getByName(org.ovirt.engine.core.bll.UpdateRoleCommand.getRole().getname())) != null)) { addCanDoActionMessage(VdcBllMessages.ERROR_CANNOT_UPDATE_ROLE_NAME); returnValue = false; } else if ((org.ovirt.engine.core.bll.UpdateRoleCommand.getRole().getType()) != (oldRole.getType())) { addCanDoActionMessage(VdcBllMessages.ERROR_CANNOT_UPDATE_ROLE_TYPE); returnValue = false; } } if (!returnValue) { addCanDoActionMessage(VdcBllMessages.VAR__TYPE__ROLE); addCanDoActionMessage(VdcBllMessages.VAR__ACTION__UPDATE); } return returnValue; }
private java.lang.Object getVmsFromExternalProvider() { try { return runVdsCommand(VDSCommandType.GetVmsFromExternalProvider, buildGetRemoteVmsInfoParameters()).getReturnValue(); } catch (java.lang.RuntimeException e) { if (!(e instanceof java.lang.IllegalArgumentException)) { logFailureToGetVms(); } throw e; } }
private void revealDiskPanel(final org.ovirt.engine.ui.uicommonweb.models.vms.AttachDiskModel disk) { diskTypePanel.setVisible(isNewLunDiskEnabled); imageDiskTable.setVisible(false); lunDiskTable.setVisible(false); org.ovirt.engine.ui.common.widget.editor.EntityModelCellTable<org.ovirt.engine.ui.uicommonweb.models.ListModel> diskTable; switch (disk.getDiskStorageType().getEntity()) { case LUN : diskTable = lunDiskTable; break; default : diskTable = imageDiskTable; break; } diskTable.setVisible(true); diskTable.asEditor().edit(disk.getAttachableDisksMap().get(disk.getDiskStorageType().getEntity())); }
private java.util.Set<org.ovirt.engine.ui.uicommonweb.models.vms.register.VnicProfileMappingEntity> getNewVnicProfileMappings(org.ovirt.engine.ui.uicommonweb.models.vms.register.RegisterVmData registerVmData, java.util.Set<org.ovirt.engine.ui.uicommonweb.models.vms.register.VnicProfileMappingEntity> previousClusterVnicProfileMappings) { final java.util.Set<org.ovirt.engine.ui.uicommonweb.models.vms.register.VnicProfileMappingEntity> result = new java.util.HashSet<>(); for (org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface vnic : registerVmData.getEntity().getInterfaces()) { final org.ovirt.engine.ui.uicommonweb.models.vms.register.VnicProfileMappingEntity newMapping = new org.ovirt.engine.ui.uicommonweb.models.vms.register.VnicProfileMappingEntity(vnic.getNetworkName(), vnic.getVnicProfileName(), null); final org.ovirt.engine.ui.uicommonweb.models.vms.register.VnicProfileMappingEntity mapping; if (previousClusterVnicProfileMappings.contains(newMapping)) { mapping = org.ovirt.engine.ui.uicommonweb.Linq.retrieveFromSet(previousClusterVnicProfileMappings, newMapping); } else { mapping = newMapping; } result.add(mapping); } return result; }
@java.lang.Override public java.lang.Void runInTransaction() { getCompensationContext().snapshotEntityStatus(getVm().getDynamicData(), getVm().getstatus()); updateVmData(getVm().getDynamicData()); getCompensationContext().stateChanged(); return null; }
private void addTypeToStorageModels(org.ovirt.engine.core.common.businessentities.StorageDomainType storageDomainType, java.util.List<org.ovirt.engine.ui.uicommonweb.models.storage.IStorageModel> models) { for (org.ovirt.engine.ui.uicommonweb.models.storage.IStorageModel model : models) { model.setRole(storageDomainType); } }
private static java.util.Map<java.lang.String, java.lang.String> getMessageMap(org.ovirt.engine.core.common.businessentities.VDSGroup cluster, org.ovirt.engine.core.common.asynctasks.gluster.GlusterAsyncTask task) { java.util.Map<java.lang.String, java.lang.String> values = new java.util.HashMap<java.lang.String, java.lang.String>(); values.put(GlusterConstants.CLUSTER, cluster.getName()); values.put(GlusterConstants.VOLUME, task.getTaskParameters().getVolumeName()); java.lang.String jobStatus = org.ovirt.engine.core.bll.gluster.GlusterTasksSyncJob.getJobStatusInfo(task); values.put(GlusterConstants.JOB_STATUS, jobStatus); values.put(GlusterConstants.JOB_INFO, task.getMessage()); return values; }
@org.junit.Test(expected = java.lang.IllegalArgumentException.class) public void testEmptyKeySubscription() { java.lang.String id = "|*|*|*"; org.ovirt.vdsm.jsonrpc.client.events.SubscriptionHolder holder = mock(org.ovirt.vdsm.jsonrpc.client.events.SubscriptionHolder.class); when(holder.getId()).thenReturn(id); when(holder.getParsedId()).thenReturn(parse(id)); org.ovirt.vdsm.jsonrpc.client.events.SubscriptionMatcher matcher = new org.ovirt.vdsm.jsonrpc.client.events.SubscriptionMatcher(); matcher.add(holder); }
@java.lang.Override public void onSuccess(org.ovirt.engine.core.common.queries.VdcQueryReturnValue returnValue) { java.util.List<org.ovirt.engine.core.common.businessentities.VDS> hosts = returnValue.getReturnValue(); boolean succeeded = true; for (org.ovirt.engine.core.common.businessentities.VDS host : hosts) { if (!(host.getClusterId().equals(hostClusterIdMap.get(host.getId())))) { succeeded = false; } } if (!succeeded) { getWindow().stopProgress(); cancel(); errorPopupManager.show(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().hostChangeClusterTimeOut()); } else { activateHostsAfterClusterChange(searchStr, activateVdsParameterList); } }
public void setStatus(org.ovirt.engine.core.common.businessentities.VDSStatus status, org.ovirt.engine.core.common.businessentities.VDS vds) { synchronized(getLockObj()) { if (vds == null) { vds = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVdsDao().get(getVdsId()); } if ((vds.getStatus()) != status) { if (status == (org.ovirt.engine.core.common.businessentities.VDSStatus.PreparingForMaintenance)) { calculateNextMaintenanceAttemptTime(); } vds.setPreviousStatus(vds.getStatus()); if ((_vds) != null) { _vds.setPreviousStatus(vds.getStatus()); } } vds.setStatus(status); if ((_vds) != null) { _vds.setStatus(status); } switch (status) { case NonOperational : if ((_vds) != null) { _vds.setNonOperationalReason(vds.getNonOperationalReason()); } if ((vds.getVmCount()) > 0) { break; } case NonResponsive : case Down : case Maintenance : vds.setCpuSys(java.lang.Double.valueOf(0)); vds.setCpuUser(java.lang.Double.valueOf(0)); vds.setCpuIdle(java.lang.Double.valueOf(0)); vds.setCpuLoad(java.lang.Double.valueOf(0)); vds.setUsageCpuPercent(0); vds.setUsageMemPercent(0); vds.setUsageNetworkPercent(0); if ((_vds) != null) { _vds.setCpuSys(java.lang.Double.valueOf(0)); _vds.setCpuUser(java.lang.Double.valueOf(0)); _vds.setCpuIdle(java.lang.Double.valueOf(0)); _vds.setCpuLoad(java.lang.Double.valueOf(0)); _vds.setUsageCpuPercent(0); _vds.setUsageMemPercent(0); _vds.setUsageNetworkPercent(0); } default : break; } } }
@org.junit.Test public void testVolume() { testValidSql("volume: ", "SELECT * FROM ((SELECT gluster_volumes_view.* FROM gluster_volumes_view ) ORDER BY vol_name ASC ) as T1 OFFSET (1 -1) LIMIT 0"); testValidSql("volume: name=volume1", "SELECT * FROM ((SELECT gluster_volumes_view.* FROM gluster_volumes_view WHERE gluster_volumes_view.vol_name LIKE volume1 ) ORDER BY vol_name ASC ) as T1 OFFSET (1 -1) LIMIT 0"); }
@org.ovirt.engine.core.utils.timer.OnTimerMethodAnnotation("poll") public void poll() { if (vdsManager.isMonitoringNeeded()) { org.ovirt.engine.core.vdsbroker.VmsListFetcher fetcher = getVmsFetcher(); long fetchTime = java.lang.System.nanoTime(); if (fetcher.fetch()) { getVmsMonitoring(fetcher, fetchTime).perform(); processDevices(fetcher.getVdsmVms().stream().map(VmInternalData::getVmDynamic), fetchTime); } else { org.ovirt.engine.core.vdsbroker.PollVmStatsRefresher.log.info("Failed to fetch vms info for host '{}' - skipping VMs monitoring.", vdsManager.getVdsName()); } } }
@java.lang.SuppressWarnings("unchecked") protected void initializeCommand(org.ovirt.engine.core.common.businessentities.ImageOperation operation) { command = spy(new org.ovirt.engine.core.bll.MoveOrCopyDiskCommandTest.MoveOrCopyDiskCommandDummy(new org.ovirt.engine.core.common.action.MoveOrCopyImageGroupParameters(diskImageGuid, srcStorageId, destStorageId, operation))); doReturn(true).when(command).isStorageDomainSpaceWithinThresholds(); doReturn(true).when(command).doesStorageDomainHaveSpaceForRequest(anyLong()); doReturn(true).when(command).checkImageConfiguration(any(java.util.List.class)); doReturn(java.util.Collections.emptyList()).when(command).getAllImageSnapshots(); doReturn(false).when(command).acquireLock(); }
public static java.lang.Number convert(long size, org.ovirt.engine.core.common.utils.SizeConverter.SizeUnit fromUnit, org.ovirt.engine.core.common.utils.SizeConverter.SizeUnit toUnit) { long fromType = fromUnit.getUnitWeight(); long toType = toUnit.getUnitWeight(); return size * ((java.lang.Math.pow(org.ovirt.engine.core.common.utils.SizeConverter.CONVERT_FACTOR, fromType)) / (java.lang.Math.pow(org.ovirt.engine.core.common.utils.SizeConverter.CONVERT_FACTOR, toType))); }
private static java.util.List<java.lang.reflect.Method> getRelevantMethods(java.lang.Class<?> clz) { java.util.List<java.lang.reflect.Method> methods = org.ovirt.engine.api.utils.LinkHelper.methodCache.get(clz); if (methods == null) { methods = new java.util.ArrayList<java.lang.reflect.Method>(); for (java.lang.reflect.Method method : clz.getMethods()) { if (method.getName().startsWith("get")) { if ((method.getReturnType().getPackage()) == (org.ovirt.engine.api.model.BaseResource.class.getPackage())) { methods.add(method); } } } org.ovirt.engine.api.utils.LinkHelper.methodCache.put(clz, methods); } return methods; }
@org.junit.Test public void submitFullFailure() { boolean gotException = false; prepareMocks(0); try { latchedRunnableExecuter.execute(); } catch (java.util.concurrent.RejectedExecutionException e) { gotException = true; } assertTrue("expected RejectedExecutionException wasn't thrown", gotException); assertEquals("the counter was incremented more times then expected", 0, counter.intValue()); assertEquals("latch counter wasn't in the expected value", org.ovirt.engine.core.utils.thread.LatchedRunnableWrapperTest.THREADS_NUMBER, latch.getCount()); verifyCommonFailureChecks(); }
@java.lang.Override protected void teardown() { org.ovirt.engine.core.bll.pm.StartVdsCommand.runSleepOnReboot(); }
@java.lang.Override public javax.ws.rs.core.Response add(org.ovirt.engine.api.model.GlusterBricks bricks) { for (org.ovirt.engine.api.model.GlusterBrick brick : bricks.getGlusterBricks()) { validateParameters(brick, "serverId", "brickDir"); } java.util.List<org.ovirt.engine.core.common.businessentities.gluster.GlusterBrickEntity> brickEntities = mapBricks(asGuid(getVolumeId()), bricks); int replicaCount = (bricks.isSetReplicaCount()) ? bricks.getReplicaCount() : 0; int stripeCount = (bricks.isSetStripeCount()) ? bricks.getStripeCount() : 0; return performCreationMultiple(VdcActionType.AddBricksToGlusterVolume, new org.ovirt.engine.core.common.action.gluster.GlusterVolumeBricksActionParameters(asGuid(getVolumeId()), brickEntities, replicaCount, stripeCount), new org.ovirt.engine.api.restapi.resource.gluster.QueryIdResolver(org.ovirt.engine.core.common.queries.VdcQueryType.GetGlusterBrickById, org.ovirt.engine.core.common.queries.gluster.IdQueryParameters.class)); }
@java.lang.Override protected org.springframework.jdbc.core.namedparam.MapSqlParameterSource createFullParametersMapper(org.ovirt.engine.core.common.businessentities.network.NetworkAttachment networkAttachment) { org.springframework.jdbc.core.namedparam.MapSqlParameterSource mapper = createIdParameterMapper(networkAttachment.getId()).addValue("network_id", networkAttachment.getNetworkId()).addValue("nic_id", networkAttachment.getNicId()).addValue("custom_properties", org.ovirt.engine.core.utils.SerializationFactory.getSerializer().serialize(networkAttachment.getProperties())); org.ovirt.engine.core.common.businessentities.network.IpConfiguration ipConfiguration = networkAttachment.getIpConfiguration(); mapIpConfiguration(mapper, (ipConfiguration == null ? new org.ovirt.engine.core.common.businessentities.network.IpConfiguration() : ipConfiguration)); return mapper; }
@java.lang.Override protected void executeVdsBrokerCommand() { try { org.ovirt.engine.core.vdsbroker.vdsbroker.GetCapabilitiesAsyncVDSCommand.getBroker().getCapabilities(new GetCapabilitiesVDSCommandCallback()); } catch (java.lang.Throwable t) { org.ovirt.engine.core.vdsbroker.vdsbroker.GetCapabilitiesAsyncVDSCommand.getParameters().getCallback().onFailure(t); throw t; } }
public org.ovirt.engine.core.vdsbroker.vdsbroker.VmInfoBuilder createVmInfoBuilder(org.ovirt.engine.core.common.businessentities.VM vm, org.ovirt.engine.core.compat.Guid vdsId, java.util.Map createInfo) { return new org.ovirt.engine.core.vdsbroker.vdsbroker.VmInfoBuilder(vm, vdsId, createInfo, vdsNumaNodeDao, vmDeviceDao, vmNumaNodeDao, vmInfoBuildUtils); }
@java.lang.Override public void onSelectionChange(com.google.gwt.view.client.SelectionChangeEvent event) { final java.util.List<org.ovirt.engine.core.common.businessentities.MacPool> selectedItems = macPoolTable.getSelectedItems(); sharedMacPoolModelProvider.setSelectedItems(selectedItems); final org.ovirt.engine.ui.uicommonweb.models.configure.PermissionListModel model = permissionModelProvider.getModel(); if ((selectedItems.size()) == 1) { model.setEntity(selectedItems.get(0)); setupAuthorizationTableVisibility(true); } else { model.setEntity(null); setupAuthorizationTableVisibility(false); } }
public org.ovirt.engine.core.bll.ValidationResult imagesAreSnapshots() { java.util.List<java.lang.String> activeSnapshots = new java.util.ArrayList<>(); for (org.ovirt.engine.core.common.businessentities.storage.DiskImage diskImage : images) { if (diskImage.getActive()) { activeSnapshots.add(java.lang.String.format("%s (%s)", diskImage.getImageId().toString(), diskImage.getDiskAlias())); } } if (!(activeSnapshots.isEmpty())) { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_DISK_SNAPSHOTS_ACTIVE, java.lang.String.format("$diskSnapshotIds %s", org.apache.commons.lang.StringUtils.join(activeSnapshots, ", "))); } return org.ovirt.engine.core.bll.ValidationResult.VALID; }
private void processUnremovedDisks(java.util.Collection<? extends org.ovirt.engine.core.common.businessentities.storage.DiskImage> diskImages) { java.util.List<java.lang.String> disksLeftInVm = new java.util.ArrayList<>(); for (org.ovirt.engine.core.common.businessentities.storage.DiskImage diskImage : diskImages) { disksLeftInVm.add(diskImage.getDiskAlias()); } addCustomValue("DisksNames", org.apache.commons.lang.StringUtils.join(disksLeftInVm, ",")); }
public static org.ovirt.engine.core.common.businessentities.VmDynamic buildVMDynamicData(java.util.Map<java.lang.String, java.lang.Object> xmlRpcStruct) { org.ovirt.engine.core.common.businessentities.VmDynamic vmdynamic = new org.ovirt.engine.core.common.businessentities.VmDynamic(); org.ovirt.engine.core.vdsbroker.vdsbroker.VdsBrokerObjectsBuilder.updateVMDynamicData(vmdynamic, xmlRpcStruct); return vmdynamic; }
@java.lang.Override public void onSuccess(java.util.List<org.ovirt.engine.core.common.businessentities.VM> vmList) { java.util.List<org.ovirt.engine.core.compat.Guid> vmIds = getAffinityGroup().getEntityIds(); getVmsSelectionModel().init(vmList, (vmIds != null ? vmIds : new java.util.ArrayList<org.ovirt.engine.core.compat.Guid>())); stopProgress(); }
public static <E extends java.lang.Enum<E>> E valueOf(java.lang.Class<E> c, java.lang.String name, boolean ignorecase) { if (!ignorecase) { { return java.lang.Enum.<E>valueOf(c, name); } } E[] universe = c.getEnumConstants(); if (universe == null) { throw new java.lang.IllegalArgumentException((name + " is not an enum type")); } java.util.Map<java.lang.String, E> map = org.ovirt.engine.core.common.utils.EnumUtils.cacheEnumValuesInCapitalLetters.get(c); if (map == null) { map = new java.util.HashMap<>((2 * (universe.length))); for (E e : universe) { map.put(e.name().toUpperCase(), e); } org.ovirt.engine.core.common.utils.EnumUtils.cacheEnumValuesInCapitalLetters.put(c, map); } E result = map.get(name.toUpperCase()); if (result == null) { throw new java.lang.IllegalArgumentException(((("No enum const " + (c.getName())) + ".") + name)); } return result; }
private boolean checkDerivedVmFromTemplateExists(org.ovirt.engine.core.common.businessentities.storage.DiskImage diskImage) { java.util.List<java.lang.String> vmNames = getNamesOfDerivedVmsFromTemplate(diskImage); if (!(vmNames.isEmpty())) { addCanDoActionMessage(EngineMessage.VMT_CANNOT_REMOVE_DETECTED_DERIVED_VM); addCanDoActionMessageVariable("vmsList", org.apache.commons.lang.StringUtils.join(vmNames, ",")); return false; } return true; }
@org.ovirt.engine.ui.frontend.DefaultStringValue("Cannot remove Data Center while there are more than one Storage Domains attached.") java.lang.String ERROR_CANNOT_REMOVE_STORAGE_POOL_WITH_NONMASTER_DOMAINS();
@java.lang.Override protected void setActionMessageParameters() { addValidationMessage(EngineMessage.VAR__TYPE__STORAGE__DOMAIN); addValidationMessage(EngineMessage.VAR__ACTION__DEACTIVATE); }
public static java.util.List<java.lang.String> mapRngSources(java.util.Collection<org.ovirt.engine.core.common.businessentities.VmRngDevice.Source> entity) { java.util.List<java.lang.String> result = new java.util.ArrayList((entity != null ? entity.size() : 0)); if (entity != null) { for (org.ovirt.engine.core.common.businessentities.VmRngDevice.Source source : entity) { org.ovirt.engine.api.model.RngSource restSource = org.ovirt.engine.api.restapi.types.RngDeviceMapper.map(source, null); result.add(restSource.name()); } } return result; }
public void init() { java.util.ArrayList<org.ovirt.engine.core.common.action.VdcActionParametersBase> parameters = new java.util.ArrayList<>(); for (org.ovirt.engine.core.compat.Guid hostId : hostDynamicDao.getIdsOfHostsWithStatus(VDSStatus.Up)) { parameters.add(new org.ovirt.engine.core.common.action.VdsActionParameters(hostId)); } backend.runInternalMultipleActions(VdcActionType.RefreshHostDevices, parameters); hostDeviceDao.cleanDownVms(); }
public void remove() { if ((getWindow()) != null) { return; } boolean shouldAddressWarnning = false; org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel model = new org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel(); setWindow(model); model.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().removeDataCenterTitle()); model.setHelpTag(HelpTag.remove_data_center); model.setHashName("remove_data_center"); java.util.ArrayList<java.lang.String> list = new java.util.ArrayList<>(); for (org.ovirt.engine.core.common.businessentities.StoragePool a : org.ovirt.engine.ui.uicommonweb.Linq.<org.ovirt.engine.core.common.businessentities.StoragePool>cast(getSelectedItems())) { list.add(a.getName()); if ((a.getStatus()) != (org.ovirt.engine.core.common.businessentities.StoragePoolStatus.Uninitialized)) { shouldAddressWarnning = true; } } model.setItems(list); org.ovirt.engine.ui.uicommonweb.UICommand tempVar = org.ovirt.engine.ui.uicommonweb.UICommand.createDefaultOkUiCommand("OnRemove", this); model.getCommands().add(tempVar); org.ovirt.engine.ui.uicommonweb.UICommand tempVar2 = org.ovirt.engine.ui.uicommonweb.UICommand.createCancelUiCommand("Cancel", this); model.getCommands().add(tempVar2); if (shouldAddressWarnning) { model.setNote(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().removeDataCenterWarnningNote()); } }
private boolean noChangesDetected() { return (((getNetworksToConfigure().isEmpty()) && (getRemovedNetworks().isEmpty())) && (org.ovirt.engine.core.bll.network.host.HostSetupNetworksCommand.getParameters().getBonds().isEmpty())) && (getRemovedBondNames().isEmpty()); }
private void endDefaultOperations() { endTemplateRelatedOperations(); endUnlockOps(); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Import Virtual Machine(s)") java.lang.String importVirtualMachinesTitle();
public java.lang.String getNumberOfVms() { return (numberOfVms) == null ? "0" : java.lang.Integer.toString(numberOfVms); }
@java.lang.Override public void doFilter(javax.servlet.ServletRequest request, javax.servlet.ServletResponse response, javax.servlet.FilterChain chain) throws java.io.IOException, javax.servlet.ServletException { log.debug("Entered SsoPostLoginFilter"); javax.servlet.http.HttpServletRequest req = ((javax.servlet.http.HttpServletRequest) (request)); try { java.lang.String engineSessionId = ((java.lang.String) (req.getAttribute(SessionConstants.HTTP_SESSION_ENGINE_SESSION_ID_KEY))); if ((org.apache.commons.lang.StringUtils.isEmpty(engineSessionId)) && ((req.getSession(false)) != null)) { engineSessionId = ((java.lang.String) (req.getSession(false).getAttribute(SessionConstants.HTTP_SESSION_ENGINE_SESSION_ID_KEY))); } if (org.apache.commons.lang.StringUtils.isNotEmpty(engineSessionId)) { javax.naming.InitialContext ctx = new javax.naming.InitialContext(); try { java.lang.String ssoToken = ((java.lang.String) (runQuery(VdcQueryType.GetEngineSessionIdToken, engineSessionId, ctx))); java.lang.Object loggedInUser = runQuery(VdcQueryType.GetUserBySessionId, engineSessionId, ctx); if (loggedInUser != null) { log.debug("Adding userInfo to session"); req.getSession(true).setAttribute(org.ovirt.engine.core.aaa.filters.SsoPostLoginFilter.ATTR_USER_INFO, getUserInfoObject(((org.ovirt.engine.core.common.businessentities.aaa.DbUser) (loggedInUser)), ssoToken)); } else { log.info("Failed to find logged user by sessionId"); } chain.doFilter(request, response); } finally { ctx.close(); } } else { log.warn(("Missing sessionId in either request or session scope. " + "Please configure SSO properly with SsoPostLoginServlet.")); } } catch (java.lang.Exception ex) { log.error("Unable to get token for engine session {}", ex.getMessage()); log.debug("Exception", ex); } log.debug("Exiting SsoPostLoginFilter"); }
@org.junit.Test public void nameInUse() { createSimpleCommand(); createCommandWithDifferentName(); canDoActionFailedWithReason(EngineMessage.VDS_GROUP_CANNOT_DO_ACTION_NAME_IN_USE); }
@org.junit.Test public void shouldCheckIfMixedHostOsIsAllowed() { createCommandWithDefaultVdsGroup(); cpuExists(); architectureIsUpdatable(); cmd.getVdsGroup().setClusterPolicyId(ClusterPolicy.UPGRADE_POLICY_GUID); doReturn(new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.CLUSTER_UPGRADE_CAN_NOT_BE_STARTED)).when(inClusterUpgradeValidator).checkClusterUpgradeIsEnabled(any(org.ovirt.engine.core.common.businessentities.VDSGroup.class)); assertFalse(cmd.canDoAction()); verify(inClusterUpgradeValidator, times(0)).isUpgradePossible(anyList(), anyList()); verify(inClusterUpgradeValidator, times(0)).isUpgradeDone(anyList()); verify(inClusterUpgradeValidator, times(1)).checkClusterUpgradeIsEnabled(any(org.ovirt.engine.core.common.businessentities.VDSGroup.class)); }
@org.junit.Test public void calculateNetworkImplementationDetailsNetworkQosOutOfSync() throws java.lang.Exception { org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface iface = createNetworkDevice(); org.ovirt.engine.core.common.businessentities.network.HostNetworkQos qos = new org.ovirt.engine.core.common.businessentities.network.HostNetworkQos(); qos.setOutAverageLinkshare(60); qos.setOutAverageUpperlimit(60); qos.setOutAverageRealtime(60); calculateNetworkImplementationDetailsAndAssertSync(iface, false, iface.isBridged(), iface.getMtu(), iface.getVlanId(), qos); }
java.lang.String VdsSpmStatus___Contending();
@java.lang.Override protected void initializeModelHandlers() { super.initializeModelHandlers(); getModel().getPropertyChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener<org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs>() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs args) { java.lang.String propName = args.propertyName; if ((("CpuUsage".equals(propName)) || ("MemoryUsage".equals(propName))) || ("NetworkUsage".equals(propName))) { org.ovirt.engine.ui.userportal.uicommon.model.vm.VmMonitorValueChangeEvent.fire(getEventBus()); } } }); }
@java.lang.Override protected org.ovirt.engine.core.dao.network.VmNicDao prepareDao() { return dbFacade.getVmNicDao(); }
public boolean isSmtpEncryptionOptionValid() { return ((org.ovirt.engine.core.notifier.utils.NotificationProperties.MAIL_SMTP_ENCRYPTION_NONE.equals(getProperty(org.ovirt.engine.core.notifier.utils.NotificationProperties.MAIL_SMTP_ENCRYPTION, true))) || (org.ovirt.engine.core.notifier.utils.NotificationProperties.MAIL_SMTP_ENCRYPTION_SSL.equals(getProperty(org.ovirt.engine.core.notifier.utils.NotificationProperties.MAIL_SMTP_ENCRYPTION, true)))) || (org.ovirt.engine.core.notifier.utils.NotificationProperties.MAIL_SMTP_ENCRYPTION_TLS.equals(getProperty(org.ovirt.engine.core.notifier.utils.NotificationProperties.MAIL_SMTP_ENCRYPTION, true))); }
private void saveDefaultedStorageProperties(org.ovirt.engine.ui.uicommonweb.models.storage.StorageModel model, org.ovirt.engine.core.common.businessentities.StorageDomainStatic storageDomainStatic) { storageDomainStatic.setWipeAfterDelete(model.getWipeAfterDelete().getEntity()); storageDomainStatic.setDiscardAfterDelete(model.getDiscardAfterDelete().getEntity()); storageDomainStatic.setWarningLowSpaceIndicator(model.getWarningLowSpaceIndicator().getEntity()); storageDomainStatic.setCriticalSpaceActionBlocker(model.getCriticalSpaceActionBlocker().getEntity()); storageDomainStatic.setBackup(model.getBackup().getEntity()); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Toggle Full Screen") java.lang.String toggleFullScreen();
public int getHighlyAvailableScore() { return vdsStatistics.getHighlyAvailableScore(); }
@java.lang.Override public java.lang.String getValue(org.ovirt.engine.ui.uicommonweb.models.vms.VmDeviceFeEntity deviceEntity) { return deviceEntity.getVmDevice().getAddress(); }
@java.lang.Override protected org.ovirt.engine.core.common.businessentities.VDSGroup getVdsGroup() { if ((org.ovirt.engine.core.bll.gluster.GlusterVolumeCommandBase.getGlusterVolume()) != null) { setVdsGroupId(org.ovirt.engine.core.bll.gluster.GlusterVolumeCommandBase.getGlusterVolume().getClusterId()); } return super.getVdsGroup(); }
public java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.businessentities.VM> loadVMs(java.lang.String fixtureName, java.util.Map<org.ovirt.engine.core.compat.Guid, org.ovirt.engine.core.common.businessentities.BusinessEntity<org.ovirt.engine.core.compat.Guid>> cache) throws java.io.IOException, java.lang.IllegalAccessException, java.lang.InstantiationException, java.lang.NoSuchFieldException, java.lang.NoSuchMethodException, java.lang.reflect.InvocationTargetException, java.text.ParseException { return loadEntities(org.ovirt.engine.core.common.businessentities.VM.class, fixtureName, cache); }
@org.junit.Test public void testGuestFQDN() { org.ovirt.engine.core.common.businessentities.VM vm = new org.ovirt.engine.core.common.businessentities.VM(); org.ovirt.engine.core.common.businessentities.VmDynamic vmDynamic = new org.ovirt.engine.core.common.businessentities.VmDynamic(); vmDynamic.setStatus(VMStatus.Up); vmDynamic.setVmFQDN("localhost.localdomain"); vm.setDynamicData(vmDynamic); org.ovirt.engine.api.model.Vm map = org.ovirt.engine.api.restapi.types.VmMapper.map(vm, ((org.ovirt.engine.api.model.Vm) (null))); assertNotNull(map.getFqdn()); assertEquals(map.getFqdn(), "localhost.localdomain"); }
private boolean updateIsoListFromVDSM(org.ovirt.engine.core.compat.Guid repoStoragePoolId, org.ovirt.engine.core.compat.Guid repoStorageDomainId) { boolean refreshIsoSucceeded = false; if (repoStorageDomainId != null) { try { org.ovirt.engine.core.common.vdscommands.VDSReturnValue returnValue = org.ovirt.engine.core.bll.Backend.getInstance().getResourceManager().RunVdsCommand(VDSCommandType.GetIsoList, new org.ovirt.engine.core.common.vdscommands.IrsBaseVDSCommandParameters(repoStoragePoolId)); @java.lang.SuppressWarnings("unchecked") java.util.Map<java.lang.String, java.util.Map<java.lang.String, java.lang.Object>> fileStats = ((java.util.Map<java.lang.String, java.util.Map<java.lang.String, java.lang.Object>>) (returnValue.getReturnValue())); if ((returnValue.getSucceeded()) && (fileStats != null)) { org.ovirt.engine.core.bll.IsoDomainListSyncronizer.log.debugFormat("The refresh process from VDSM, for Iso files succeeded."); refreshIsoSucceeded = org.ovirt.engine.core.bll.IsoDomainListSyncronizer.refreshIsoFileListMetaData(repoStorageDomainId, repoStorageDom, fileStats, ImageFileType.ISO); } } catch (java.lang.Exception e) { refreshIsoSucceeded = false; org.ovirt.engine.core.bll.IsoDomainListSyncronizer.log.warnFormat("The refresh process from VDSM, for Iso files failed."); org.ovirt.engine.core.bll.IsoDomainListSyncronizer.log.error(e); } } return refreshIsoSucceeded; }
@java.lang.Override public void testConnection() { org.apache.commons.httpclient.HttpMethod httpMethod = new org.apache.commons.httpclient.methods.GetMethod(org.ovirt.engine.core.bll.host.provider.foreman.ForemanHostProviderProxy.API_ENTRY_POINT); runHttpMethod(httpClient, httpMethod); }
@java.lang.SuppressWarnings("unchecked") public <E> org.ovirt.engine.api.restapi.resource.validation.Validator<E> getValidator(java.lang.Class<E> entityType) { return ((org.ovirt.engine.api.restapi.resource.validation.Validator<E>) (validators.get(entityType))); }
protected org.ovirt.engine.core.bll.CommandBase<? extends org.ovirt.engine.core.common.action.HostJobCommandParameters> getCommand(org.ovirt.engine.core.compat.Guid cmdId) { return org.ovirt.engine.core.bll.tasks.CommandCoordinatorUtil.retrieveCommand(cmdId); }
private org.ovirt.engine.core.bll.ValidationResult validRemovedNetworkAttachments() { java.util.List<org.ovirt.engine.core.compat.Guid> invalidIds = org.ovirt.engine.core.common.businessentities.Entities.idsNotReferencingExistingRecords(params.getRemovedNetworkAttachments(), existingAttachments); if (!(invalidIds.isEmpty())) { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.VdcBllMessages.NETWORK_ATTACHMENT_NOT_EXISTS, commaSeparated(invalidIds)); } org.ovirt.engine.core.bll.ValidationResult vr = org.ovirt.engine.core.bll.ValidationResult.VALID; java.util.Iterator<org.ovirt.engine.core.common.businessentities.network.NetworkAttachment> iterator = removedNetworkAttachments.iterator(); while ((iterator.hasNext()) && (vr.isValid())) { org.ovirt.engine.core.common.businessentities.network.NetworkAttachment attachment = iterator.next(); org.ovirt.engine.core.common.businessentities.network.NetworkAttachment attachmentToValidate = attachmentsById.get(attachment.getId()); org.ovirt.engine.core.bll.validator.NetworkAttachmentValidator validator = new org.ovirt.engine.core.bll.validator.NetworkAttachmentValidator(attachmentToValidate, host, managementNetworkUtil); vr = (skipValidation(vr)) ? vr : validator.notExternalNetwork(); vr = (skipValidation(vr)) ? vr : validator.notManagementNetwork(); vr = (skipValidation(vr)) ? vr : notRemovingLabeledNetworks(attachment, getExistingIfaces()); vr = (skipValidation(vr)) ? vr : validateNotRemovingUsedNetworkByVms(); } return vr; }
@java.lang.Override protected void executeCommand() { org.ovirt.engine.core.common.action.VdsActionParameters parameters = new org.ovirt.engine.core.common.action.VdsActionParameters(getVdsId()); org.ovirt.engine.core.common.action.VdcReturnValueBase returnValue = runInternalAction(VdcActionType.RefreshHostCapabilities, parameters); if (!(returnValue.getSucceeded())) { return; } returnValue = runInternalAction(VdcActionType.RefreshHostDevices, parameters); if (!(returnValue.getSucceeded())) { return; } setSucceeded(true); }
@java.lang.Override protected void beforeExecute(java.lang.Thread t, java.lang.Runnable r) { super.beforeExecute(t, r); java.lang.String threadName = t.getName(); if (!(threadName.startsWith("org.ovirt.thread."))) { t.setName(("org.ovirt.thread." + threadName)); } if (org.ovirt.engine.core.utils.threadpool.ThreadPoolUtil.log.isDebugEnabled()) { org.ovirt.engine.core.utils.threadpool.ThreadPoolUtil.log.debug(java.lang.String.format("About to run task '%s' from", r.getClass().getName()), new java.lang.Exception()); } if ((getQueue().size()) > 5) { org.ovirt.engine.core.utils.threadpool.ThreadPoolUtil.log.warn("Executing a command '{}', but note that there are {} tasks in the queue.", r.getClass().getName(), getQueue().size()); } }
private void processHeartbeat() { if (((!(this.isInInit())) && (this.policy.isIncomingHeartbeat())) && (this.isIncomingHeartbeatExeeded())) { org.ovirt.vdsm.jsonrpc.client.reactors.ReactorClient.log.debug("Heartbeat exeeded. Closing channel"); this.disconnect("Heartbeat exeeded"); } }
protected boolean validateStorageDomains() { java.util.List<org.ovirt.engine.core.common.businessentities.DiskImage> disksList = getSnapshotsDummiesForStorageAllocations(); org.ovirt.engine.core.bll.validator.storage.MultipleStorageDomainsValidator storageDomainsValidator = getStorageDomainsValidator(org.ovirt.engine.core.bll.RemoveSnapshotCommand.getStoragePoolId(), getStorageDomainsIds()); return ((validate(storageDomainsValidator.allDomainsExistAndActive())) && (validate(storageDomainsValidator.allDomainsWithinThresholds()))) && (validate(storageDomainsValidator.allDomainsHaveSpaceForClonedDisks(disksList))); }
public void setServiceList(java.util.List<java.lang.String> serviceList) { this.serviceList = serviceList; }
@java.lang.Override protected void endWithFailure() { org.ovirt.engine.core.bll.storage.disk.image.ImagesHandler.updateImageStatus(org.ovirt.engine.core.bll.storage.disk.cinder.CloneSingleCinderDiskCommand.getParameters().getDestinationImageId(), ImageStatus.ILLEGAL); removeCinderDisk(); org.ovirt.engine.core.bll.storage.disk.image.ImagesHandler.updateImageStatus(org.ovirt.engine.core.bll.storage.disk.cinder.CloneSingleCinderDiskCommand.getParameters().getImageId(), ImageStatus.OK); org.ovirt.engine.core.bll.storage.disk.cinder.CloneSingleCinderDiskCommand.setSucceeded(true); }
@java.lang.Override protected boolean validate() { org.ovirt.engine.core.bll.validator.NetworkValidator validator = new org.ovirt.engine.core.bll.validator.NetworkValidator(vmDao, org.ovirt.engine.core.bll.network.dc.RemoveNetworkCommand.getNetworkDao().get(getNetwork().getId())); return (((((validate(validator.networkIsSet(org.ovirt.engine.core.bll.network.dc.RemoveNetworkCommand.getParameters().getId()))) && (validate(validator.notRemovingManagementNetwork()))) && (validate(validator.notIscsiBondNetwork()))) && (validate(validator.networkNotUsedByVms()))) && (validate(validator.networkNotUsedByTemplates()))) && (validate(getRemoveExternalNetworkValidationResult())); }
private void updateExistingAndNewVolumes(org.ovirt.engine.core.compat.Guid clusterId, java.util.Map<java.lang.String, org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity> volumesMap) { for (java.util.Map.Entry<java.lang.String, org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity> entry : volumesMap.entrySet()) { org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity volume = entry.getValue(); org.ovirt.engine.core.bll.gluster.GlusterManager.log.debugFormat("Analyzing volume {0}", volume.getName()); org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity existingVolume = getVolumeDao().getByName(clusterId, volume.getName()); if (existingVolume == null) { try { createVolume(volume); } catch (java.lang.Exception e) { org.ovirt.engine.core.bll.gluster.GlusterManager.log.errorFormat("Could not save volume {0} in database!", volume.getName(), e); continue; } } else { try { org.ovirt.engine.core.bll.gluster.GlusterManager.log.debugFormat("Volume {0} exists in engine. Checking if it needs to be updated.", existingVolume.getName()); updateVolume(existingVolume, volume); } catch (java.lang.Exception e) { org.ovirt.engine.core.bll.gluster.GlusterManager.log.errorFormat("Error while updating Volume {0}!", volume.getName(), e); continue; } } } }
@java.lang.Override protected void init() { super.init(); initEffectiveCompatibilityVersion(); }
@java.lang.Override protected void executeCommand() { org.ovirt.engine.core.common.businessentities.AuditLog auditLog = getAuditLog(); auditLogDao.remove(org.ovirt.engine.core.bll.RemoveAuditLogByIdCommand.getParameters().getAuditLogId()); setAuditLogDetails(auditLog); auditLog.setUserId(Guid.Empty); org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogable logableToClear = createAuditLogableImpl(auditLog); org.ovirt.engine.core.dal.dbbroker.auditloghandling.EventFloodRegulator eventFloodRegulator = new org.ovirt.engine.core.dal.dbbroker.auditloghandling.EventFloodRegulator(logableToClear, auditLog.getLogType()); eventFloodRegulator.evict(); org.ovirt.engine.core.bll.RemoveAuditLogByIdCommand.setSucceeded(true); }
@java.lang.Override public boolean isBootProtocolDhcp() { return "dhcp".equalsIgnoreCase(((java.lang.String) (nicProperties.get(VdsProperties.BOOT_PROTOCOL)))); }
private java.lang.Integer calcMaxVCpu() { java.lang.Integer maxSockets = org.ovirt.engine.core.common.config.Config.<java.lang.Integer>getValue(ConfigValues.MaxNumOfVmSockets, vm.getCompatibilityVersion().getValue()); java.lang.Integer maxVCpus = org.ovirt.engine.core.common.config.Config.<java.lang.Integer>getValue(ConfigValues.MaxNumOfVmCpus, vm.getCompatibilityVersion().getValue()); int threadsPerCore = vm.getThreadsPerCpu(); int cpuPerSocket = vm.getCpuPerSocket(); maxVCpus = (cpuPerSocket * threadsPerCore) * (java.lang.Math.min(maxSockets, (maxVCpus / (cpuPerSocket * threadsPerCore)))); return maxVCpus; }
protected static org.ovirt.engine.core.common.businessentities.storage.QemuImageInfo getQemuImageInfoFromVdsm(org.ovirt.engine.core.compat.Guid storagePoolId, org.ovirt.engine.core.compat.Guid newStorageDomainID, org.ovirt.engine.core.compat.Guid newImageGroupId, org.ovirt.engine.core.compat.Guid newImageId, boolean shouldPrepareAndTeardown) { org.ovirt.engine.core.compat.Guid vdsId = org.ovirt.engine.core.bll.storage.utils.VdsCommandsHelper.getHostForExecution(storagePoolId, java.util.Collections.emptyList()); org.ovirt.engine.core.common.businessentities.storage.QemuImageInfo qemuImageInfo = null; if (shouldPrepareAndTeardown) { org.ovirt.engine.core.bll.storage.disk.image.ImagesHandler.prepareImage(storagePoolId, newStorageDomainID, newImageGroupId, newImageId, vdsId); } try { qemuImageInfo = ((org.ovirt.engine.core.common.businessentities.storage.QemuImageInfo) (org.ovirt.engine.core.bll.Backend.getInstance().getResourceManager().runVdsCommand(VDSCommandType.GetQemuImageInfo, new org.ovirt.engine.core.common.vdscommands.GetVolumeInfoVDSCommandParameters(vdsId, storagePoolId, newStorageDomainID, newImageGroupId, newImageId)).getReturnValue())); } catch (java.lang.Exception e) { org.ovirt.engine.core.bll.storage.disk.image.ImagesHandler.log.error("Unable to get qemu image info from storage", e); } finally { if (shouldPrepareAndTeardown) { org.ovirt.engine.core.bll.storage.disk.image.ImagesHandler.teardownImage(storagePoolId, newStorageDomainID, newImageGroupId, newImageId, vdsId); } } return qemuImageInfo; }
private void setTestResultValue(org.ovirt.engine.core.common.action.VdcReturnValueBase result) { java.lang.String errorMessage = org.ovirt.engine.ui.uicommonweb.models.providers.ProviderModel.EMPTY_ERROR_MESSAGE; if (result == null) { errorMessage = org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().testFailedUnknownErrorMsg(); } else if (!(result.getSucceeded())) { if ((result.getFault()) != null) { errorMessage = org.ovirt.engine.ui.frontend.Frontend.getInstance().translateVdcFault(result.getFault()); } else { errorMessage = org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().testFailedUnknownErrorMsg(); } } getTestResult().setEntity(errorMessage); }
private void massLabelsUpdate(org.ovirt.engine.core.compat.Guid vfsConfigId, java.util.Set<java.lang.String> labels) { java.util.List<org.springframework.jdbc.core.namedparam.MapSqlParameterSource> executions = new java.util.ArrayList<>(labels.size()); for (java.lang.String label : labels) { executions.add(createLabelParametersMapper(vfsConfigId, label)); } getCallsHandler().executeStoredProcAsBatch("InsertVfsConfigLabel", executions); }
@org.ovirt.engine.ui.webadmin.DefaultStringValue("Hosted Engine HA") java.lang.String hostedEngineHaHostGeneral();
@com.google.gwt.i18n.client.Constants.DefaultStringValue("Use DHCP") java.lang.String cloudInitNetworkDhcpLabel();
@java.lang.Override public void onSuccess(java.lang.Object target, java.lang.Object returnValue) { java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VmTemplate> templatesChain = new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.VmTemplate>(((java.util.List<org.ovirt.engine.core.common.businessentities.VmTemplate>) (returnValue))); initTemplateWithVersion(templatesChain, templateId, useLatest); }
@java.lang.Override protected void executeCommand() { org.ovirt.engine.core.bll.storage.SetStoragePoolStatusCommand.getStoragePool().setStatus(org.ovirt.engine.core.bll.storage.SetStoragePoolStatusCommand.getParameters().getStatus()); setVdsIdRef(org.ovirt.engine.core.bll.storage.SetStoragePoolStatusCommand.getStoragePool().getspm_vds_id()); org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getStoragePoolDao().updateStatus(org.ovirt.engine.core.bll.storage.SetStoragePoolStatusCommand.getStoragePool().getId(), org.ovirt.engine.core.bll.storage.SetStoragePoolStatusCommand.getStoragePool().getStatus()); if (((org.ovirt.engine.core.bll.storage.SetStoragePoolStatusCommand.getParameters().getStatus()) == (org.ovirt.engine.core.common.businessentities.StoragePoolStatus.NonResponsive)) || ((org.ovirt.engine.core.bll.storage.SetStoragePoolStatusCommand.getParameters().getStatus()) == (org.ovirt.engine.core.common.businessentities.StoragePoolStatus.NotOperational))) { org.ovirt.engine.core.vdsbroker.storage.StoragePoolDomainHelper.updateApplicablePoolDomainsStatuses(org.ovirt.engine.core.bll.storage.SetStoragePoolStatusCommand.getStoragePool().getId(), java.util.EnumSet.of(StorageDomainStatus.Active), StorageDomainStatus.Unknown, null); } org.ovirt.engine.core.bll.storage.StoragePoolStatusHandler.poolStatusChanged(org.ovirt.engine.core.bll.storage.SetStoragePoolStatusCommand.getStoragePool().getId(), org.ovirt.engine.core.bll.storage.SetStoragePoolStatusCommand.getStoragePool().getStatus()); org.ovirt.engine.core.bll.storage.SetStoragePoolStatusCommand.setSucceeded(true); }
@java.lang.Override public org.ovirt.engine.core.common.eventqueue.EventResult call() { org.ovirt.engine.core.common.businessentities.StoragePoolIsoMap domainPoolMap = new org.ovirt.engine.core.common.businessentities.StoragePoolIsoMap(getParameters().getNewMasterDomainId(), getParameters().getStoragePoolId(), org.ovirt.engine.core.common.businessentities.StorageDomainStatus.Active); org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getStoragePoolIsoMapDao().save(domainPoolMap); getParameters().setVdsId(getVds().getId()); org.ovirt.engine.core.common.action.VdcReturnValueBase returnVal = getBackend().runInternalAction(VdcActionType.ReconstructMasterDomain, getParameters()); boolean succeeded = ((returnVal.getActionReturnValue()) != null) ? ((java.lang.Boolean) (returnVal.getActionReturnValue())) : false; getStoragePoolDAO().updateStatus(getStoragePool().getId(), StoragePoolStatus.Problematic); if (!succeeded) { getStoragePoolIsoMapDAO().remove(domainPoolMap.getId()); } setSucceeded(returnVal.getSucceeded()); return new org.ovirt.engine.core.common.eventqueue.EventResult(succeeded, org.ovirt.engine.core.common.eventqueue.EventType.RECONSTRUCT); }
private boolean mouseOnSourceElement(int clientX, int clientY, com.google.gwt.dom.client.Element tooltipSource) { return (((clientX >= (tooltipSource.getAbsoluteLeft())) && (clientX < (tooltipSource.getAbsoluteRight()))) && (clientY <= (tooltipSource.getAbsoluteBottom()))) && (clientY > (tooltipSource.getAbsoluteTop())); }
@java.lang.Override protected void setActionMessageParameters() { addValidationMessage(EngineMessage.VAR__ACTION__CREATE); addCustomValue(GlusterConstants.VOLUME_SNAPSHOT_NAME, getParameters().getSnapshot().getSnapshotName()); super.setActionMessageParameters(); }
@org.ovirt.engine.ui.uicompat.DefaultMessage("{0} in Data Center {1}") java.lang.String networkDc(java.lang.String networkName, java.lang.String dcName);
protected void mockOsRepository() { injectorRule.bind(org.ovirt.engine.core.bll.CpuFlagsManagerHandler.class, cpuFlagsManagerHandler); org.ovirt.engine.core.common.utils.SimpleDependencyInjector.getInstance().bind(org.ovirt.engine.core.common.osinfo.OsRepository.class, osRepository); vmDeviceUtils.init(); injectorRule.bind(org.ovirt.engine.core.bll.utils.VmDeviceUtils.class, vmDeviceUtils); org.ovirt.engine.core.bll.VmHandler.init(); when(osRepository.isWindows(0)).thenReturn(true); when(osRepository.getMinimumRam(vm.getVmOsId(), org.ovirt.engine.core.compat.Version.getLast())).thenReturn(0); when(osRepository.getMaximumRam(vm.getVmOsId(), org.ovirt.engine.core.compat.Version.getLast())).thenReturn(100); when(osRepository.getArchitectureFromOS(14)).thenReturn(ArchitectureType.x86_64); }
@java.lang.SuppressWarnings("resource") private void checkConnection() throws java.sql.SQLException { java.sql.Statement statement = null; java.sql.ResultSet rs = null; try { statement = connection.createStatement(); rs = statement.executeQuery("select null"); rs.next(); } finally { if (statement != null) { statement.close(); } if (rs != null) { rs.close(); } } }
@java.lang.Override public void setItems(java.lang.Iterable value) { if ((items) != value) { if ((items) != null) { for (org.ovirt.engine.ui.uicommonweb.models.userportal.UserPortalItemModel itemModel : ((java.lang.Iterable<org.ovirt.engine.ui.uicommonweb.models.userportal.UserPortalItemModel>) (items))) { itemModel.clearReferences(); } } ItemsChanging(value, items); items = value; ItemsChanged(); getItemsChangedEvent().raise(this, EventArgs.Empty); OnPropertyChanged(new org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs("Items")); } }
private static void exportResource(java.lang.String apiVersion, java.lang.String resourceName, java.io.File outputDirectory) throws java.io.IOException { java.lang.String resourcePath = java.lang.String.format("/v%s/%s", apiVersion, resourceName); java.io.InputStream inputResource = org.ovirt.engine.api.rsdl.RsdlIOManager.class.getResourceAsStream(resourcePath); java.io.File outputFile = new java.io.File(outputDirectory, resourceName); java.lang.System.out.printf("Copying resource \"%s\" to file \"%s\"\n", resourcePath, outputFile.getAbsolutePath()); org.apache.commons.io.FileUtils.copyInputStreamToFile(inputResource, outputFile); }
@org.ovirt.engine.ui.frontend.DefaultStringValue("Cannot ${action} ${type}. Memory size exceeds supported limit for given cluster version.") java.lang.String ACTION_TYPE_FAILED_MEMORY_EXCEEDS_SUPPORTED_LIMIT();
@java.lang.Override public java.lang.String getText(java.lang.Object image) { if (image instanceof org.ovirt.engine.core.common.businessentities.RepoImage) { return ((org.ovirt.engine.core.common.businessentities.RepoImage) (image)).getFileType().toString(); } else if (image instanceof org.ovirt.engine.core.common.businessentities.DiskImage) { return ImageFileType.Disk.toString(); } return constants.unknown(); }
private java.util.Map<java.lang.String, org.ovirt.engine.core.common.businessentities.gluster.GlusterServiceStatus> mergeServiceStatusMaps(java.util.List<java.util.Map<java.lang.String, org.ovirt.engine.core.common.businessentities.gluster.GlusterServiceStatus>> serviceStatusMaps) { java.util.Map<java.lang.String, org.ovirt.engine.core.common.businessentities.gluster.GlusterServiceStatus> mergedServiceStatusMap = new java.util.HashMap<java.lang.String, org.ovirt.engine.core.common.businessentities.gluster.GlusterServiceStatus>(); for (java.util.Map<java.lang.String, org.ovirt.engine.core.common.businessentities.gluster.GlusterServiceStatus> serviceStatusMap : serviceStatusMaps) { for (java.util.Map.Entry<java.lang.String, org.ovirt.engine.core.common.businessentities.gluster.GlusterServiceStatus> entry : serviceStatusMap.entrySet()) { java.lang.String serviceName = entry.getKey(); org.ovirt.engine.core.common.businessentities.gluster.GlusterServiceStatus status = entry.getValue(); org.ovirt.engine.core.common.businessentities.gluster.GlusterServiceStatus alreadyFoundStatus = mergedServiceStatusMap.get(serviceName); if (alreadyFoundStatus == null) { mergedServiceStatusMap.put(serviceName, status); } else if ((alreadyFoundStatus != status) && (alreadyFoundStatus != (org.ovirt.engine.core.common.businessentities.gluster.GlusterServiceStatus.MIXED))) { mergedServiceStatusMap.put(serviceName, GlusterServiceStatus.MIXED); } } } return mergedServiceStatusMap; }
protected void loadVmData(org.ovirt.engine.core.common.businessentities.VM vm) { setManagedVideoDevices(vm.getStaticData()); if (vm.getInterfaces().isEmpty()) { vm.setInterfaces(getVmNetworkInterfaceDao().getAllForVm(vm.getId())); } if (org.apache.commons.lang.StringUtils.isEmpty(vm.getVmtName())) { if (!(Guid.Empty.equals(vm.getVmtGuid()))) { org.ovirt.engine.core.common.businessentities.VmTemplate t = getVmTemplateDao().get(vm.getVmtGuid()); vm.setVmtName(t.getName()); } else { vm.setVmtName(VmTemplateHandler.BLANK_VM_TEMPLATE_NAME); } } }
private long findUnusedMac() { int index = usedMacs.nextClearBit(startingLocationWhenSearchingForUnusedMac); boolean notFound = index == (numberOfMacsInRange); if (notFound) { index = usedMacs.nextClearBit(0); } startingLocationWhenSearchingForUnusedMac = (index + 1) % (numberOfMacsInRange); return (rangeStart) + index; }
protected java.lang.String scheduleJob() { if ((schedule.getExecutionTime()) != null) { java.sql.Time convertedTime = org.ovirt.engine.core.bll.utils.GlusterUtil.getInstance().convertTime(schedule.getExecutionTime(), schedule.getTimeZone()); schedule.setExecutionTime(convertedTime); } java.util.Date convertedStartDate = getGlusterUtil().convertDate(schedule.getStartDate(), schedule.getTimeZone()); java.util.Date convertedEndByDate = getGlusterUtil().convertDate(schedule.getEndByDate(), schedule.getTimeZone()); java.lang.String cronExpression = org.ovirt.engine.core.bll.utils.GlusterUtil.getInstance().getCronExpression(schedule); if (cronExpression == null) throw new java.lang.RuntimeException("Unable to form cron expression for schedule. Invalid scheduling details."); return getDbSchedulUtil().scheduleACronJob(new org.ovirt.engine.core.bll.gluster.GlusterSnapshotScheduleJob(), "onTimer", new java.lang.Class[]{ java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.Boolean.class }, new java.lang.Object[]{ upServer.getId().toString(), org.ovirt.engine.core.bll.gluster.ScheduleGlusterVolumeSnapshotCommandBase.getGlusterVolumeId().toString(), schedule.getSnapshotNamePrefix(), schedule.getSnapshotDescription(), force }, cronExpression, convertedStartDate, convertedEndByDate); }
@java.lang.Override public void edit(final org.ovirt.engine.ui.uicommonweb.models.ConfirmationModel object) { storageDomainItems.setRowData(new java.util.ArrayList<org.ovirt.engine.ui.uicommonweb.models.EntityModel>()); storageDomainItems.asEditor().edit(object); driver.edit(object); object.getLatch().getPropertyChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener<org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs>() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs args) { if ("IsAvailable".equals(args.propertyName)) { org.ovirt.engine.ui.uicommonweb.models.EntityModel entity = ((org.ovirt.engine.ui.uicommonweb.models.EntityModel) (sender)); if (entity.getIsAvailable()) { latch.setVisible(true); } } } }); object.getItemsChangedEvent().addListener(new org.ovirt.engine.ui.uicompat.IEventListener<org.ovirt.engine.ui.uicompat.EventArgs>() { @java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.EventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { messageLabel.setHTML(applicationConstants.dataCenterRecoveryStoragePopupMessageLabel()); selectNewDSDLabel.setText(applicationConstants.dataCenterRecoveryStoragePopupSelectNewDSDLabel()); } }); }
@org.junit.Test public void testBadGuid() throws java.lang.Exception { control.replay(); try { new org.ovirt.engine.api.restapi.resource.BackendTemplateResource("foo"); org.ovirt.engine.api.restapi.resource.BackendTemplateBasedResourceTest.fail("expected WebApplicationException"); } catch (javax.ws.rs.WebApplicationException wae) { verifyNotFoundException(wae); } }
@org.junit.Test public void testLimit() throws java.io.IOException { int limit = 1000; java.io.ByteArrayOutputStream os = new org.ovirt.engine.core.utils.ssh.ConstraintByteArrayOutputStream(limit); byte[] buffer = new byte[100]; for (int i = 0; i < ((limit * 5) / (buffer.length)); i++) { os.write(buffer); } assertTrue(((os.size()) >= limit)); assertTrue(((os.size()) < ((limit * 3) / 2))); }
@java.lang.Override public void executeCommand() { if ((georepSessions) != null) { for (org.ovirt.engine.core.common.businessentities.gluster.GlusterGeoRepSession session : georepSessions) { org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeEntity slaveVolume = getDbFacade().getGlusterVolumeDao().getById(session.getSlaveVolumeId()); if (slaveVolume == null) { continue; } org.ovirt.engine.core.common.businessentities.VDS slaveUpServer = org.ovirt.engine.core.bll.utils.ClusterUtils.getInstance().getRandomUpServer(slaveVolume.getClusterId()); if (slaveUpServer == null) { handleVdsError(AuditLogType.GLUSTER_VOLUME_ALL_SNAPSHOTS_DELETE_FAILED, EngineError.NoUpServerFoundInRemoteCluster.name()); setSucceeded(false); return; } java.util.List<org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeSnapshotEntity> slaveVolumeSnapshots = getGlusterVolumeSnapshotDao().getAllByVolumeId(slaveVolume.getId()); try (org.ovirt.engine.core.utils.lock.EngineLock lock = acquireEngineLock(session.getSlaveVolumeId(), LockingGroup.GLUSTER_SNAPSHOT)) { if (!(deleteAllGlusterVolumeSnapshots(slaveUpServer.getId(), slaveVolume.getName(), slaveVolumeSnapshots))) { return; } getGlusterUtil().checkAndRemoveVolumeSnapshotLimitsAlert(slaveVolume); } } } deleteAllGlusterVolumeSnapshots(getUpServer().getId(), getGlusterVolumeName(), snapshots); getGlusterUtil().checkAndRemoveVolumeSnapshotLimitsAlert(getGlusterVolume()); }
@java.lang.Override protected java.util.List<org.ovirt.engine.core.common.businessentities.VDS> getAllRunningVdssInPool() { java.util.Set<org.ovirt.engine.core.common.businessentities.VDSStatus> vdsStatus = java.util.EnumSet.copyOf(StoragePoolDomainHelper.vdsDomainsActiveMonitoringStatus); vdsStatus.addAll(StoragePoolDomainHelper.vdsDomainsMaintenanceMonitoringStatus); return org.ovirt.engine.core.bll.storage.domain.DeactivateStorageDomainCommand.getVdsDao().getAllForStoragePoolAndStatuses(org.ovirt.engine.core.bll.storage.domain.DeactivateStorageDomainCommand.getStoragePool().getId(), vdsStatus); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Error in fetching volume option list, please try again.") java.lang.String errorInFetchingVolumeOptionList();
@org.junit.Test public void testFindMappingEntryEmptyExternal() { final java.util.Optional<org.ovirt.engine.core.common.businessentities.network.ExternalVnicProfileMapping> actual = underTest.findMappingEntry(org.ovirt.engine.core.bll.exportimport.ExternalVnicProfileMappingFinderTest.NETWORK_NAME, org.ovirt.engine.core.bll.exportimport.ExternalVnicProfileMappingFinderTest.VNIC_PROFILE1_NAME, java.util.Collections.singletonList(emptySourceMapping)); assertFalse(actual.isPresent()); }
@java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event<? extends org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs> ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.PropertyChangedEventArgs args) { if (org.ovirt.engine.ui.webadmin.section.main.presenter.popup.provider.ProviderPopupPresenterWidget.IS_AVAILABLE.equals(args.propertyName)) { getView().setCurrentActiveProviderWidget(); } }
private void logException(java.lang.RuntimeException ex) { if (((ex.getMessage()) == null) || (!(ex.getMessage().contains("Policy reset")))) { log.error("Command '{}' execution failed: {}", this, ex.getMessage()); log.debug("Exception", ex); } }
private void initTables() { disksTable = new org.ovirt.engine.ui.common.widget.editor.ListModelObjectCellTable<org.ovirt.engine.core.common.businessentities.storage.DiskImage, org.ovirt.engine.ui.uicommonweb.models.ListModel>(true, true); disksTable.enableColumnResizing(); disksTable.addColumn(new org.ovirt.engine.ui.common.widget.table.column.AbstractTextColumn<org.ovirt.engine.core.common.businessentities.storage.DiskImage>() { @java.lang.Override public java.lang.String getValue(org.ovirt.engine.core.common.businessentities.storage.DiskImage diskImage) { return diskImage.getDiskAlias(); } }, org.ovirt.engine.ui.common.widget.uicommon.popup.vm.VmSnapshotCreatePopupWidget.constants.aliasDisk(), "150px"); disksTable.addColumn(new org.ovirt.engine.ui.common.widget.table.column.AbstractTextColumn<org.ovirt.engine.core.common.businessentities.storage.DiskImage>() { @java.lang.Override public java.lang.String getValue(org.ovirt.engine.core.common.businessentities.storage.DiskImage diskImage) { return diskImage.getDiskDescription(); } }, org.ovirt.engine.ui.common.widget.uicommon.popup.vm.VmSnapshotCreatePopupWidget.constants.descriptionDisk(), "150px"); }
@java.lang.Override public void onSuccess(org.ovirt.engine.core.common.queries.VdcQueryReturnValue returnValue) { java.util.ArrayList<org.ovirt.engine.core.common.scheduling.PolicyUnit> policyUnits = returnValue.getReturnValue(); policyUnitMap = new java.util.LinkedHashMap(); for (org.ovirt.engine.core.common.scheduling.PolicyUnit policyUnit : policyUnits) { policyUnitMap.put(policyUnit.getId(), policyUnit); } org.ovirt.engine.ui.frontend.Frontend.getInstance().runQuery(VdcQueryType.GetClusterPolicies, new org.ovirt.engine.core.common.queries.VdcQueryParametersBase(), new org.ovirt.engine.ui.uicommonweb.models.clusters.AsyncQuery(new org.ovirt.engine.ui.frontend.AsyncCallback<org.ovirt.engine.core.common.queries.VdcQueryReturnValue>() { @java.lang.Override public void onSuccess(org.ovirt.engine.core.common.queries.VdcQueryReturnValue returnValue) { java.util.ArrayList<org.ovirt.engine.core.common.scheduling.ClusterPolicy> list = returnValue.getReturnValue(); getClusterPolicy().setItems(list); org.ovirt.engine.core.common.scheduling.ClusterPolicy defaultClusterPolicy = null; org.ovirt.engine.core.common.scheduling.ClusterPolicy selectedClusterPolicy = null; for (org.ovirt.engine.core.common.scheduling.ClusterPolicy clusterPolicy : list) { if (((getIsEdit()) && ((getEntity()) != null)) && (clusterPolicy.getId().equals(getEntity().getClusterPolicyId()))) { selectedClusterPolicy = clusterPolicy; } if (clusterPolicy.isDefaultPolicy()) { defaultClusterPolicy = clusterPolicy; } } if (selectedClusterPolicy != null) { getClusterPolicy().setSelectedItem(selectedClusterPolicy); } else { getClusterPolicy().setSelectedItem(defaultClusterPolicy); } clusterPolicyChanged(); } })); }
static boolean validatePinningAndMigration(java.util.List<java.lang.String> reasons, org.ovirt.engine.core.common.businessentities.VmStatic vmStaticData, java.lang.String cpuPinning) { final boolean cpuPinMigrationEnabled = java.lang.Boolean.TRUE.equals(org.ovirt.engine.core.common.config.Config.<java.lang.Boolean>getValue(ConfigValues.CpuPinMigrationEnabled)); if (((!cpuPinMigrationEnabled) && (((vmStaticData.getMigrationSupport()) == (org.ovirt.engine.core.common.businessentities.MigrationSupport.MIGRATABLE)) || ((vmStaticData.getMigrationSupport()) == (org.ovirt.engine.core.common.businessentities.MigrationSupport.IMPLICITLY_NON_MIGRATABLE)))) && (org.apache.commons.lang.StringUtils.isNotEmpty(cpuPinning))) { reasons.add(EngineMessage.ACTION_TYPE_FAILED_VM_CANNOT_BE_PINNED_TO_CPU_AND_MIGRATABLE.toString()); return false; } if ((vmStaticData.isAutoStartup()) && (((vmStaticData.getMigrationSupport()) != (org.ovirt.engine.core.common.businessentities.MigrationSupport.MIGRATABLE)) && ((vmStaticData.getDedicatedVmForVdsList().size()) == 1))) { reasons.add(EngineMessage.ACTION_TYPE_FAILED_VM_CANNOT_BE_HIGHLY_AVAILABLE_AND_PINNED_TO_HOST.toString()); return false; } return true; }
@org.ovirt.engine.ui.frontend.DefaultStringValue("Cannot ${action} ${type}. Selected operation system does not support VirtIO-SCSI. Please disable VirtIO-SCSI for the VM.") java.lang.String ACTION_TYPE_FAILED_ILLEGAL_OS_TYPE_DOES_NOT_SUPPORT_VIRTIO_SCSI();
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.VDS> getAll() { org.apache.commons.httpclient.HttpMethod method = new org.apache.commons.httpclient.methods.GetMethod(((hostProvider.getUrl()) + (org.ovirt.engine.core.bll.host.provider.foreman.ForemanHostProviderProxy.ALL_HOSTS_QUERY))); return runHostListMethod(method); }
@java.lang.Override protected void setActionMessageParameters() { addValidationMessage(EngineMessage.VAR__ACTION__ADD); addValidationMessage(EngineMessage.VAR__TYPE__CLUSTER_POLICY); }
@java.lang.Override protected void setActionMessageParameters() { addCanDoActionMessage(EngineMessage.VAR__ACTION__REVERT_TO); addCanDoActionMessage(EngineMessage.VAR__TYPE__SNAPSHOT); }
protected void verifyQuery(org.ovirt.engine.api.restapi.resource.AbstractStatisticalQuery<org.ovirt.engine.api.model.NIC, org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface> query, org.ovirt.engine.core.common.businessentities.network.VmNetworkInterface entity) throws java.lang.Exception { assertEquals(org.ovirt.engine.api.model.NIC.class, query.getParentType()); assertSame(entity, query.resolve(org.ovirt.engine.api.restapi.resource.BackendVmNicResourceTest.NIC_ID)); java.util.List<org.ovirt.engine.api.model.Statistic> statistics = query.getStatistics(entity); verifyStatistics(statistics, new java.lang.String[]{ "data.current.rx", "data.current.tx", "errors.total.rx", "errors.total.tx" }, new java.math.BigDecimal[]{ asDec(org.ovirt.engine.api.restapi.util.RxTxCalculator.percent2bytes(50, 10.0)), asDec(org.ovirt.engine.api.restapi.util.RxTxCalculator.percent2bytes(50, 20.0)), asDec(30), asDec(40) }); org.ovirt.engine.api.model.Statistic adopted = query.adopt(new org.ovirt.engine.api.model.Statistic()); assertTrue(adopted.isSetNic()); assertEquals(org.ovirt.engine.api.restapi.resource.BackendVmNicResourceTest.NIC_ID.toString(), adopted.getNic().getId()); assertTrue(adopted.getNic().isSetVm()); assertEquals(org.ovirt.engine.api.restapi.resource.AbstractBackendNicsResourceTest.PARENT_ID.toString(), adopted.getNic().getVm().getId()); }
protected void prepareMethod() { org.apache.commons.httpclient.methods.InputStreamRequestEntity inputStreamRequestEntity; if ((org.ovirt.engine.core.vdsbroker.irsbroker.UploadStreamVDSCommand.getParameters().getSize()) != null) { inputStreamRequestEntity = new org.apache.commons.httpclient.methods.InputStreamRequestEntity(org.ovirt.engine.core.vdsbroker.irsbroker.UploadStreamVDSCommand.getParameters().getInputStream(), org.ovirt.engine.core.vdsbroker.irsbroker.UploadStreamVDSCommand.getParameters().getSize()); } else { inputStreamRequestEntity = new org.apache.commons.httpclient.methods.InputStreamRequestEntity(org.ovirt.engine.core.vdsbroker.irsbroker.UploadStreamVDSCommand.getParameters().getInputStream()); } org.ovirt.engine.core.vdsbroker.irsbroker.UploadStreamVDSCommand.getMethod().setRequestEntity(inputStreamRequestEntity); org.ovirt.engine.core.vdsbroker.irsbroker.UploadStreamVDSCommand.getMethod().setRequestHeader("Content-Type", "application/octet-stream"); if ((org.ovirt.engine.core.vdsbroker.irsbroker.UploadStreamVDSCommand.getParameters().getSize()) != null) { org.ovirt.engine.core.vdsbroker.irsbroker.UploadStreamVDSCommand.getMethod().setRequestHeader("Content-Length", org.ovirt.engine.core.vdsbroker.irsbroker.UploadStreamVDSCommand.getParameters().getSize().toString()); } }
private com.google.gwt.user.client.ui.PushButton createButton(final org.ovirt.engine.core.common.utils.Pair<T, V> item) { final T value = item.getFirst(); final V widget = item.getSecond(); boolean ghostItem = isGhost(value); final com.google.gwt.user.client.ui.PushButton button = new com.google.gwt.user.client.ui.PushButton(new com.google.gwt.user.client.ui.Image((ghostItem ? resources.increaseIcon() : resources.decreaseIcon()))); button.addStyleName(style.buttonStyle()); button.setEnabled((!ghostItem)); button.addClickHandler((ghostItem ? new com.google.gwt.event.dom.client.ClickHandler() { @java.lang.Override public void onClick(com.google.gwt.event.dom.client.ClickEvent event) { getEntry(widget).swapButton(createButton(item)); org.ovirt.engine.core.common.utils.Pair<T, V> item = addGhostEntry(); onAdd(item.getFirst(), item.getSecond()); } } : new com.google.gwt.event.dom.client.ClickHandler() { @java.lang.Override public void onClick(com.google.gwt.event.dom.client.ClickEvent event) { removeEntry(item); onRemove(value, widget); } })); return button; }
public org.ovirt.engine.ui.uicommonweb.models.ListModel<org.ovirt.engine.core.common.businessentities.network.Network> getDatacenterPhysicalNetwork() { return datacenterPhysicalNetwork; }
@java.lang.Override protected void buildVmVirtioSerial() { java.util.List<org.ovirt.engine.core.common.businessentities.VmDevice> vmDevices = org.ovirt.engine.core.dal.dbbroker.DbFacade.getInstance().getVmDeviceDao().getVmDeviceByVmIdTypeAndDevice(vm.getId(), VmDeviceGeneralType.CONTROLLER, VmDeviceType.VIRTIOSERIAL.getName()); for (org.ovirt.engine.core.common.businessentities.VmDevice vmDevice : vmDevices) { java.util.Map<java.lang.String, java.lang.Object> struct = new java.util.HashMap<>(); struct.put(VdsProperties.Type, VmDeviceGeneralType.CONTROLLER.getValue()); struct.put(VdsProperties.Device, VdsProperties.VirtioSerial); org.ovirt.engine.core.vdsbroker.vdsbroker.VmInfoBuilder.addAddress(vmDevice, struct); addDevice(struct, vmDevice, null); } }
@java.lang.Override public void edit(final org.ovirt.engine.ui.uicommonweb.models.vms.MigrateModel object) { driver.edit(object); updateMessages(object); enableSelectionElements(object.getEnableSelectionElements()); object.getPropertyChangedEvent().addListener(( ev, sender, args) -> updateSelectionElements(object)); }
@com.google.gwt.i18n.client.Constants.DefaultStringValue("Cannot ${action} ${type}. Quota is still in use by a VM or a disk.") java.lang.String ACTION_TYPE_FAILED_QUOTA_IN_USE_BY_VM_OR_DISK();
@org.junit.Test public void testVmIllegal() { setUpGeneralValidations(); doReturn(new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_VM_IMAGE_IS_ILLEGAL)).when(vmValidator).vmNotIlegal(); doReturn(org.ovirt.engine.core.bll.CreateAllSnapshotsFromVmCommandTest.getEmptyDiskList()).when(cmd).getDisksList(); assertFalse(cmd.canDoAction()); assertTrue(cmd.getReturnValue().getCanDoActionMessages().contains(EngineMessage.ACTION_TYPE_FAILED_VM_IMAGE_IS_ILLEGAL.name())); }
@org.ovirt.engine.ui.frontend.DefaultStringValue("$type CPU Profile") java.lang.String VAR__TYPE__CPU_PROFILE();
@java.lang.Override protected void executeVmCommand() { org.ovirt.engine.core.bll.VmHandler.warnMemorySizeLegal(org.ovirt.engine.core.bll.AddVmCommand.getParameters().getVm().getStaticData(), org.ovirt.engine.core.bll.AddVmCommand.getEffectiveCompatibilityVersion()); java.util.List<java.lang.String> errorMessages = new java.util.ArrayList<>(); if (!(canAddVm(errorMessages, destStorages.values()))) { log.error("Failed to add VM. The reasons are: {}", java.lang.String.join(",", errorMessages)); return; } org.ovirt.engine.core.utils.transaction.TransactionSupport.executeInNewTransaction(() -> { addVmStatic(); addVmDynamic(); addVmNetwork(); addVmNumaNodes(); addVmStatistics(); addActiveSnapshot(); addVmPermission(); addVmInit(); addVmRngDevice(); getCompensationContext().stateChanged(); return null; }); if (addVmImages()) { org.ovirt.engine.core.utils.transaction.TransactionSupport.executeInNewTransaction(() -> { copyVmDevices(); addDiskPermissions(); addVmPayload(); updateSmartCardDevices(); addVmWatchdog(); addGraphicsDevice(); setActionReturnValue(getVm().getId()); setSucceeded(true); return null; }); } if ((org.ovirt.engine.core.bll.AddVmCommand.getParameters().getPoolId()) != null) { addVmToPool(); } }
@org.ovirt.engine.ui.common.DefaultStringValue("Edit") java.lang.String editInstanceImages();
@org.junit.Test public void insufficientDiskSpaceWithSnapshots() { org.ovirt.engine.core.common.action.ImportVmParameters parameters = createParameters(); org.ovirt.engine.core.bll.validator.ImportValidator validator = setupDiskSpaceTest(parameters); parameters.setCopyCollapse(false); doReturn(new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_DISK_SPACE_LOW_ON_STORAGE_DOMAIN)).when(multipleSdValidator).allDomainsHaveSpaceForDisksWithSnapshots(anyList()); assertEquals(EngineMessage.ACTION_TYPE_FAILED_DISK_SPACE_LOW_ON_STORAGE_DOMAIN, validator.validateSpaceRequirements(java.util.Collections.<org.ovirt.engine.core.common.businessentities.storage.DiskImage>emptyList()).getMessage()); verify(multipleSdValidator, never()).allDomainsHaveSpaceForClonedDisks(anyList()); verify(multipleSdValidator).allDomainsHaveSpaceForDisksWithSnapshots(anyList()); verify(multipleSdValidator, never()).allDomainsHaveSpaceForNewDisks(anyList()); }
@org.junit.Test public void testGetByOriginAndCustomEventId() { org.ovirt.engine.core.common.businessentities.AuditLog result = dao.getByOriginAndCustomEventId("EMC", 1); assertNotNull(result); assertEquals(externalAuditLog, result); }
private void handleTitlePanel(java.lang.String eventType, com.google.gwt.dom.client.Element parent) { if (title.isEmpty()) { return; } titlePanel.setWidget(new com.google.gwt.user.client.ui.Label(title)); if (BrowserEvents.MOUSEOVER.equals(eventType)) { titlePanel.showRelativeTo(parent); } else if (BrowserEvents.MOUSEOUT.equals(eventType)) { titlePanel.hide(); } }
private void calculateNetworkImplementationDetailsAndAssertSync(org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface iface, boolean expectSync, java.lang.String networkName, boolean vmNet, int mtu, int vlanId, org.ovirt.engine.core.common.businessentities.network.NetworkQoS qos) { org.ovirt.engine.core.common.businessentities.network.Network network = createNetwork(networkName, vmNet, mtu, vlanId); org.ovirt.engine.core.common.businessentities.network.VdsNetworkInterface.NetworkImplementationDetails networkImplementationDetails = org.ovirt.engine.core.utils.NetworkUtils.calculateNetworkImplementationDetails(network, qos, iface); assertNotNull("Network implementation details should be filled.", networkImplementationDetails); assertEquals((("Network implementation details should be " + (expectSync ? "in" : "out of")) + " sync."), expectSync, networkImplementationDetails.isInSync()); }
public java.util.concurrent.Future<org.ovirt.engine.core.common.action.VdcReturnValueBase> executeAsyncCommand(final org.ovirt.engine.core.common.action.VdcActionType actionType, final org.ovirt.engine.core.common.action.VdcActionParametersBase parameters, final org.ovirt.engine.core.bll.context.CommandContext cmdContext) { final org.ovirt.engine.core.bll.CommandBase<?> command = org.ovirt.engine.core.bll.CommandsFactory.createCommand(actionType, parameters, cmdContext); coco.saveCommandContext(command.getCommandId(), cmdContext); return org.ovirt.engine.core.bll.tasks.CommandExecutor.executor.submit(new java.util.concurrent.Callable<org.ovirt.engine.core.common.action.VdcReturnValueBase>() { @java.lang.Override public org.ovirt.engine.core.common.action.VdcReturnValueBase call() throws java.lang.Exception { return executeCommand(command, cmdContext); } }); }
@java.lang.Override public javax.ws.rs.core.Response add(org.ovirt.engine.api.model.Event event) { validateParameters(event, "origin", "severity", "customId", "description"); return performCreation(VdcActionType.AddExternalEvent, new org.ovirt.engine.core.common.action.AddExternalEventParameters(map(event)), new org.ovirt.engine.api.restapi.resource.QueryIdResolver<java.lang.Long>(org.ovirt.engine.core.common.queries.VdcQueryType.GetAuditLogById, org.ovirt.engine.core.common.queries.GetAuditLogByIdParameters.class)); }
void onIsValidPropertyChange(org.ovirt.engine.ui.common.widget.HasValidation editor, org.ovirt.engine.ui.uicommonweb.models.Model model) { if (model.getIsValid()) { editor.markAsValid(); } else { if (editor.isValid()) { editor.markAsInvalid(model.getInvalidityReasons()); } } }
public java.util.List<org.ovirt.engine.core.bll.OVirtNodeInfo.Entry> get() { return info; }
@java.lang.Override public com.google.gwt.safehtml.shared.SafeHtml getTooltip(org.ovirt.engine.ui.uicommonweb.models.clusters.ClusterNetworkModel model) { return org.ovirt.engine.ui.webadmin.widget.table.column.NetworkRoleColumnHelper.getTooltip((model.isVmNetwork() ? java.util.Collections.singletonMap(vmImage, constants.vmItemInfo()) : java.util.Collections.<com.google.gwt.safehtml.shared.SafeHtml, java.lang.String>emptyMap())); }
public java.lang.String getCpuNameByCpuId(java.lang.String name, org.ovirt.engine.core.compat.Version ver) { final org.ovirt.engine.core.bll.CpuFlagsManagerHandler.CpuFlagsManager cpuFlagsManager = org.ovirt.engine.core.bll.CpuFlagsManagerHandler.managersDictionary.get(ver); java.lang.String cpuName = (cpuFlagsManager != null) ? cpuFlagsManager.getCpuNameByCpuId(name) : null; if (org.apache.commons.lang.StringUtils.isNotEmpty(cpuName)) { return cpuName; } if (name.endsWith("-IBRS")) { return cpuFlagsManager != null ? cpuFlagsManager.getCpuNameByCpuId(name.replace("-IBRS", ",+spec-ctrl")) : null; } return null; }
@org.junit.Test public void testQueryExecution() { org.ovirt.engine.core.compat.Guid adElementGuid = org.ovirt.engine.core.compat.Guid.newGuid(); when(getQueryParameters().getId()).thenReturn(adElementGuid); org.ovirt.engine.core.common.businessentities.Permissions expected = new org.ovirt.engine.core.common.businessentities.Permissions(); expected.setad_element_id(adElementGuid); org.ovirt.engine.core.dao.PermissionDAO permissionDAOMock = mock(org.ovirt.engine.core.dao.PermissionDAO.class); when(permissionDAOMock.getAllForAdElement(adElementGuid, getQuery().getEngineSessionSeqId(), getQueryParameters().isFiltered())).thenReturn(java.util.Collections.singletonList(expected)); when(getDbFacadeMockInstance().getPermissionDao()).thenReturn(permissionDAOMock); getQuery().executeQueryCommand(); @java.lang.SuppressWarnings("unchecked") java.util.List<org.ovirt.engine.core.common.businessentities.Permissions> actual = ((java.util.List<org.ovirt.engine.core.common.businessentities.Permissions>) (getQuery().getQueryReturnValue().getReturnValue())); assertEquals("Wrong number of returned permissions", 1, actual.size()); assertEquals("Wrong returned permissions", expected, actual.get(0)); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Changes done to the Networking configuration are temporary until explicitly saved.\n\nAre you sure you want to make the changes persistent?") java.lang.String areYouSureYouWantToMakeTheChangesPersistentMsg();
public java.lang.Object call() throws java.lang.Exception { _parser.cliEnvironmentSet(NetEnv.SSH_KEY, org.ovirt.engine.core.bll.VdsDeploy._getEngineSSHPublicKey().replace("\n", "")); return null; }
public java.util.List<org.ovirt.engine.ui.frontend.server.dashboard.models.ClusterResourceAverage> getClusterCpuAndMemoryAverage() throws org.ovirt.engine.ui.frontend.server.dashboard.DashboardDataException { final java.util.List<org.ovirt.engine.ui.frontend.server.dashboard.models.ClusterResourceAverage> result = new java.util.ArrayList<>(); runQuery(org.ovirt.engine.ui.frontend.server.dashboard.dao.ClusterDwhDao.CLUSTER_LAST_24_AVERAGE, new org.ovirt.engine.ui.frontend.server.dashboard.dao.QueryResultCallback() { @java.lang.Override public void onResult(java.sql.ResultSet rs) throws java.sql.SQLException { result.add(new org.ovirt.engine.ui.frontend.server.dashboard.models.ClusterResourceAverage(rs.getString(org.ovirt.engine.ui.frontend.server.dashboard.dao.ClusterDwhDao.NAME), rs.getDouble(org.ovirt.engine.ui.frontend.server.dashboard.dao.ClusterDwhDao.CPU_AVERAGE), rs.getDouble(org.ovirt.engine.ui.frontend.server.dashboard.dao.ClusterDwhDao.MEM_AVERAGE))); } }); return result; }
@org.junit.Test public void testPreparingForMaintenanceDomainInList() { testBusyDomainInList(StorageDomainStatus.PreparingForMaintenance); }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Import Pre-Configured Domain") java.lang.String importPreConfiguredDomainTitle();
@org.junit.Before public void setUp() { disksList = new java.util.LinkedList(); doNothing().when(memoryStorageHandler).updateDisksStorage(any(org.ovirt.engine.core.common.businessentities.StorageDomain.class), anyListOf(org.ovirt.engine.core.common.businessentities.storage.DiskImage.class)); validStorageDomain = initStorageDomain(); initStorageDomainValidator(validStorageDomainValidator, ValidationResult.VALID); doReturn(validStorageDomainValidator).when(memoryStorageHandler).getStorageDomainValidator(validStorageDomain); invalidStorageDomain1 = initStorageDomain(); initInvalidValidator(invalidStorageDomainValidator1); doReturn(invalidStorageDomainValidator1).when(memoryStorageHandler).getStorageDomainValidator(invalidStorageDomain1); invalidStorageDomain2 = initStorageDomain(); initInvalidValidator(invalidStorageDomainValidator2); doReturn(invalidStorageDomainValidator2).when(memoryStorageHandler).getStorageDomainValidator(invalidStorageDomain2); }
protected org.ovirt.engine.core.bll.ValidationResult validateModelCompatibleWithOs() { org.ovirt.engine.core.bll.validator.VmWatchdogValidator validator = getVmWatchdogValidator(); if (validator != null) { return validator.isModelCompatibleWithOs(); } else { return new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.ACTION_TYPE_FAILED_CLUSTER_CAN_NOT_BE_EMPTY); } }
@java.lang.Override public org.ovirt.engine.core.common.businessentities.VM getHostedEngineVm() { return getCallsHandler().executeRead("GetHostedEngineVm", org.ovirt.engine.core.dao.VmDaoImpl.VMRowMapper.instance, getCustomMapSqlParameterSource()); }
public static void main(java.lang.String[] args) throws java.io.IOException, java.lang.ClassNotFoundException { java.lang.System.out.println("Generating RSDL files..."); java.lang.String baseUri = args[0]; java.lang.String outputFileName = args[1]; java.lang.String outputFileNameGluster = args[2]; org.ovirt.engine.api.rsdl.MetaData metadata = org.ovirt.engine.api.rsdl.RsdlManager.loadMetaData(); org.ovirt.engine.api.rsdl.RsdlManager.generateRsdlFile(metadata, baseUri, outputFileName, org.ovirt.engine.api.utils.ApiRootLinksCreator.getAllRels(baseUri)); org.ovirt.engine.api.rsdl.RsdlManager.generateRsdlFile(metadata, baseUri, outputFileNameGluster, org.ovirt.engine.api.utils.ApiRootLinksCreator.getGlusterRels(baseUri)); java.lang.System.out.println(((("The following files have been generated: \n" + outputFileName) + "\n") + outputFileNameGluster)); }
@java.lang.Override public org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc disconnectStoragePool(java.lang.String spUUID, int hostSpmId, java.lang.String SCSIKey) { org.ovirt.vdsm.jsonrpc.client.JsonRpcRequest request = new org.ovirt.vdsm.jsonrpc.client.RequestBuilder("StoragePool.disconnect").withParameter("storagepoolID", spUUID).withParameter("hostID", hostSpmId).withParameter("scsiKey", SCSIKey).build(); java.util.Map<java.lang.String, java.lang.Object> response = new org.ovirt.engine.core.vdsbroker.jsonrpc.FutureMap(this.client, request); return new org.ovirt.engine.core.vdsbroker.vdsbroker.StatusOnlyReturnForXmlRpc(response); }
@java.lang.Override public org.ovirt.engine.core.common.businessentities.VdsNetworkInterface getManagedInterfaceForVds(org.ovirt.engine.core.compat.Guid id, org.ovirt.engine.core.compat.Guid userID, boolean isFiltered) { org.springframework.jdbc.core.namedparam.MapSqlParameterSource parameterSource = getCustomMapSqlParameterSource().addValue("vds_id", id).addValue("user_id", userID).addValue("is_filtered", isFiltered); return getCallsHandler().executeRead("GetVdsManagedInterfaceByVdsId", org.ovirt.engine.core.dao.InterfaceDAODbFacadeImpl.vdsNetworkInterfaceRowMapper, parameterSource); }
public org.ovirt.engine.core.common.businessentities.Snapshot addActiveSnapshot(org.ovirt.engine.core.compat.Guid snapshotId, org.ovirt.engine.core.common.businessentities.VM vm, org.ovirt.engine.core.common.businessentities.Snapshot.SnapshotStatus snapshotStatus, final org.ovirt.engine.core.bll.context.CompensationContext compensationContext) { return addActiveSnapshot(snapshotId, vm, snapshotStatus, "", null, compensationContext); }
private static java.lang.String merge(java.lang.String key, java.lang.String value, java.lang.String customValue) { org.ovirt.engine.core.utils.pm.FenceConfigHelper.init(); java.lang.StringBuilder sb = new java.lang.StringBuilder(); sb.append(value); if ((org.apache.commons.lang.StringUtils.isNotEmpty(value)) && (org.apache.commons.lang.StringUtils.isNotEmpty(customValue))) { if (org.ovirt.engine.core.utils.pm.FenceConfigHelper.isValid(key, customValue)) { sb.append(org.ovirt.engine.core.utils.pm.FenceConfigHelper.keySeparatorMap.get(key)); sb.append(customValue); } else { org.ovirt.engine.core.utils.pm.FenceConfigHelper.log.errorFormat("Configuration key {0} has illegal value {1}. Expression should match {2}", key, customValue, org.ovirt.engine.core.utils.pm.FenceConfigHelper.keyValidatorMap.get(key)); } } return sb.toString(); }
public void testOvfDataUpdaterAllVmsAndTemplatesAreLocked(boolean ovfOnAnyDomainSupported) { int size = (org.ovirt.engine.core.bll.ProcessOvfUpdateForStoragePoolCommandTest.ITEMS_COUNT_PER_UPDATE) - 1; java.util.List<org.ovirt.engine.core.compat.Guid> vmGuids = generateGuidList(size); addVms(vmGuids, 2, VMStatus.ImageLocked, ImageStatus.OK, pool1.getId()); java.util.List<org.ovirt.engine.core.compat.Guid> removedGuids = generateGuidList(size); java.util.List<org.ovirt.engine.core.compat.Guid> templatesGuids = generateGuidList(size); addTemplates(templatesGuids, 2, VmTemplateStatus.Locked, ImageStatus.OK, pool1.getId()); initTestForPool(pool1, vmGuids, templatesGuids, removedGuids); command.executeCommand(); verify(command, never()).performOvfUpdate(any(org.ovirt.engine.core.common.businessentities.StoragePool.class), anyMap()); if (!ovfOnAnyDomainSupported) { verify(ovfUpdateProcessHelper, times(size)).executeRemoveVmInSpm(any(org.ovirt.engine.core.compat.Guid.class), any(org.ovirt.engine.core.compat.Guid.class), any(org.ovirt.engine.core.compat.Guid.class)); } verifyCorrectOvfDataUpdaterRun(pool1, java.util.Collections.<org.ovirt.engine.core.compat.Guid>emptyList(), removedGuids); }
@java.lang.Override public org.ovirt.engine.core.common.businessentities.VM getVm() { org.ovirt.engine.core.common.businessentities.VM vm = super.getVm(); if (vm == null) { vm = org.ovirt.engine.core.bll.lsm.LiveMigrateDiskCommand.getVmDAO().getForDisk(org.ovirt.engine.core.bll.lsm.LiveMigrateDiskCommand.getImageGroupId()).get(java.lang.Boolean.TRUE).get(0); setVm(vm); setVmId(vm.getId()); } return vm; }
private java.util.Set<java.lang.String> getMemoryVolumesToBeImported() { java.util.Set<java.lang.String> memories = new java.util.HashSet<java.lang.String>(); for (org.ovirt.engine.core.common.businessentities.Snapshot snapshot : getVm().getSnapshots()) { memories.add(snapshot.getMemoryVolume()); } memories.remove(StringUtils.EMPTY); return memories; }
private org.ovirt.engine.ui.uicommonweb.validation.ValidationResult validate(java.lang.String icon) { org.ovirt.engine.ui.uicommonweb.validation.ValidationResult typeValidation = validateType(icon); if (!(typeValidation.getSuccess())) { return typeValidation; } org.ovirt.engine.ui.uicommonweb.validation.ValidationResult dimensionsValidation = validateBrowserParsabilityAndDimensions(icon); org.ovirt.engine.ui.uicommonweb.validation.ValidationResult sizeValidation = validateSize(icon); if ((dimensionsValidation.getSuccess()) && (sizeValidation.getSuccess())) { return org.ovirt.engine.ui.uicommonweb.validation.ValidationResult.ok(); } final java.util.List<java.lang.String> reasons = org.ovirt.engine.ui.uicommonweb.Linq.concat(dimensionsValidation.getReasons(), sizeValidation.getReasons()); return new org.ovirt.engine.ui.uicommonweb.validation.ValidationResult(false, reasons); }
private void assertHostNicVfsConfigEquals(org.ovirt.engine.core.common.businessentities.network.HostNicVfsConfig config1, org.ovirt.engine.core.common.businessentities.network.HostNicVfsConfig config2) { assertEquals("id", config1.getId(), config2.getId()); assertEquals("nic_id", config1.getNicId(), config2.getNicId()); assertEquals("all_networks_allowed", config1.isAllNetworksAllowed(), config2.isAllNetworksAllowed()); assertEquals("networks", config1.getNetworks(), config2.getNetworks()); assertEquals("labels", config1.getNetworkLabels(), config2.getNetworkLabels()); }
@org.junit.Test public void clusterAlreadyInLocalFs() { prepareManagementNetworkMocks(); createCommandWithDefaultVdsGroup(); oldGroupIsDetachedDefault(); storagePoolIsLocalFS(); setupCpu(); allQueriesForVms(); storagePoolAlreadyHasCluster(); architectureIsUpdatable(); canDoActionFailedWithReason(EngineMessage.VDS_GROUP_CANNOT_ADD_MORE_THEN_ONE_HOST_TO_LOCAL_STORAGE); }
private void setupGlusterMock(boolean clusterHasServers, org.ovirt.engine.core.common.businessentities.VDS upServer, boolean hasPeers) throws java.lang.Exception { setupCommonMock(true); when(commandMock.createReturnValue()).thenCallRealMethod(); when(commandMock.getReturnValue()).thenCallRealMethod(); doCallRealMethod().when(commandMock).addValidationMessage(any(org.ovirt.engine.core.common.errors.EngineMessage.class)); when(commandMock.getGlusterUtil()).thenReturn(glusterUtil); when(glusterUtil.getPeers(any(org.ovirt.engine.core.bll.utils.EngineSSHClient.class))).thenReturn((hasPeers ? java.util.Collections.singleton(org.ovirt.engine.core.bll.hostdeploy.AddVdsCommandTest.PEER_1) : java.util.Collections.<java.lang.String>emptySet())); when(commandMock.getGlusterDBUtils()).thenReturn(glusterDBUtils); when(clusterUtils.hasServers(any(org.ovirt.engine.core.compat.Guid.class))).thenReturn(clusterHasServers); when(vdsDaoMock.getAllForVdsGroup(any(org.ovirt.engine.core.compat.Guid.class))).thenReturn(mockVdsInDb((clusterHasServers ? org.ovirt.engine.core.common.businessentities.VDSStatus.Maintenance : org.ovirt.engine.core.common.businessentities.VDSStatus.Initializing))); when(clusterUtils.getUpServer(any(org.ovirt.engine.core.compat.Guid.class))).thenReturn(upServer); }
@java.lang.Override protected void setActionMessageParameters() { addValidationMessage(EngineMessage.VAR__ACTION__REFRESH); addValidationMessage(EngineMessage.VAR__TYPE__HOST_CAPABILITIES); }
@java.lang.Override public javax.ws.rs.core.Response performRemove(java.lang.String id) { org.ovirt.engine.core.common.action.AttachDetachStorageConnectionParameters params = new org.ovirt.engine.core.common.action.AttachDetachStorageConnectionParameters(storageDomainId, id); return performAction(VdcActionType.DetachStorageConnectionFromStorageDomain, params); }
@org.junit.Test public void testCanAttachMultipleISOOrExport() { for (org.ovirt.engine.core.common.businessentities.StorageDomainType type : java.util.Arrays.<org.ovirt.engine.core.common.businessentities.StorageDomainType>asList(StorageDomainType.ISO, StorageDomainType.ImportExport)) { storageDomain.setStorageDomainType(type); spyValidator(); java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StorageDomain> domainList = new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.StorageDomain>(); org.ovirt.engine.core.common.businessentities.StorageDomain domainWithSameType = new org.ovirt.engine.core.common.businessentities.StorageDomain(); domainWithSameType.setStorageDomainType(type); domainList.add(domainWithSameType); when(storageDomainDao.getAllForStoragePool(any(org.ovirt.engine.core.compat.Guid.class))).thenReturn(domainList); org.ovirt.engine.core.bll.ValidationResult attachMultipleISOOrExportResult = validator.validateDomainCanBeAttachedToPool(); assertFalse((("Attaching domain of type " + type) + " succeeded while it should have failed"), attachMultipleISOOrExportResult.isValid()); assertFailingMessage((("Attaching domain of type " + type) + " succeeded though another domain of the same type already exists in the pool"), attachMultipleISOOrExportResult, (type == (org.ovirt.engine.core.common.businessentities.StorageDomainType.ISO) ? org.ovirt.engine.core.common.errors.EngineMessage.ERROR_CANNOT_ATTACH_MORE_THAN_ONE_ISO_DOMAIN : org.ovirt.engine.core.common.errors.EngineMessage.ERROR_CANNOT_ATTACH_MORE_THAN_ONE_EXPORT_DOMAIN)); } }
@java.lang.Override public java.lang.Void runInTransaction() { for (org.ovirt.engine.core.common.businessentities.storage.DiskImage image : filteredImages) { if ((image.getDiskStorageType()) == (org.ovirt.engine.core.common.businessentities.storage.DiskStorageType.CINDER)) { cinderDisks.add(((org.ovirt.engine.core.common.businessentities.storage.CinderDisk) (image))); continue; } org.ovirt.engine.core.common.action.VdcReturnValueBase vdcReturnValue = runInternalActionWithTasksContext(VdcActionType.TryBackToSnapshot, buildTryBackToSnapshotParameters(newActiveSnapshotId, image)); if (vdcReturnValue.getSucceeded()) { getTaskIdList().addAll(vdcReturnValue.getInternalVdsmTaskIdList()); } else if ((vdcReturnValue.getFault()) != null) { throw new org.ovirt.engine.core.common.errors.EngineException(vdcReturnValue.getFault().getError(), vdcReturnValue.getFault().getMessage()); } else { log.error("Cannot create snapshot"); throw new org.ovirt.engine.core.common.errors.EngineException(org.ovirt.engine.core.common.errors.EngineError.IRS_IMAGE_STATUS_ILLEGAL); } } if ((!(cinderDisks.isEmpty())) && (!(tryBackAllCinderDisks(cinderDisks, newActiveSnapshotId)))) { throw new org.ovirt.engine.core.common.errors.EngineException(org.ovirt.engine.core.common.errors.EngineError.CINDER_ERROR, "Failed to preview a snapshot!"); } return null; }
@java.lang.Override protected java.util.List<org.ovirt.engine.core.common.businessentities.VDS> getUnderUtilizedHosts(org.ovirt.engine.core.common.businessentities.VDSGroup cluster, java.util.List<org.ovirt.engine.core.common.businessentities.VDS> relevantHosts, final java.util.Map<java.lang.String, java.lang.String> parameters) { final int migrationThreshold = org.apache.commons.lang.math.NumberUtils.toInt(parameters.get("MigrationThreshold"), migrationThresholdDefault); final org.ovirt.engine.core.common.businessentities.VDS worstVDS = getWorstVDS(relevantHosts, parameters); final int worstVdsOccupiedVmSlots = getOccupiedVmSlots(worstVDS, parameters); java.util.List<org.ovirt.engine.core.common.businessentities.VDS> underUtilizedHosts = org.ovirt.engine.core.utils.linq.LinqUtils.filter(relevantHosts, new org.ovirt.engine.core.utils.linq.Predicate<org.ovirt.engine.core.common.businessentities.VDS>() { @java.lang.Override public boolean eval(org.ovirt.engine.core.common.businessentities.VDS p) { int distance = worstVdsOccupiedVmSlots - (getOccupiedVmSlots(p, parameters)); return distance >= migrationThreshold; } }); if ((underUtilizedHosts.size()) == 0) { org.ovirt.engine.core.bll.scheduling.policyunits.EvenGuestDistributionBalancePolicyUnit.log.warnFormat("There is no host with less than {0} running guests", (worstVdsOccupiedVmSlots - migrationThreshold)); } return underUtilizedHosts; }
private void checkReportsWebAppStatus() { try { org.ovirt.engine.ui.uicommonweb.ReportInit.constructServiceRequestBuilder(org.ovirt.engine.ui.uicommonweb.ReportInit.STATUS_SERVICE).sendRequest(null, new com.google.gwt.http.client.RequestCallback() { @java.lang.Override public void onError(com.google.gwt.http.client.Request request, java.lang.Throwable exception) { } @java.lang.Override public void onResponseReceived(com.google.gwt.http.client.Request request, com.google.gwt.http.client.Response response) { if ((response.getStatusCode()) == (com.google.gwt.http.client.Response.SC_OK)) { reportsWebappDeployed = true; parseReportsXML(); } } }); } catch (com.google.gwt.http.client.RequestException e) { } }
void prepareConnectHostToStoragePoolServers(org.ovirt.engine.core.common.action.ConnectHostToStoragePoolServersParameters parameters, java.util.List<org.ovirt.engine.core.common.businessentities.StorageServerConnections> connections);
@org.junit.Test public void testWarnOnActiveVmPositive() { testWarnOnActiveVmInner(true); org.mockito.Mockito.verify(mockAuditLogger).log(auditLogableBaseCaptor.capture(), org.mockito.Mockito.same(AuditLogType.NETWORK_UPDATE_DISPLAY_FOR_CLUSTER_WITH_ACTIVE_VM)); final org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase actualLoggable = auditLogableBaseCaptor.getValue(); org.junit.Assert.assertEquals(org.ovirt.engine.core.bll.network.cluster.helper.DisplayNetworkClusterHelperTest.TEST_CLUSTER_ID, actualLoggable.getVdsGroupId()); org.junit.Assert.assertEquals(org.ovirt.engine.core.bll.network.cluster.helper.DisplayNetworkClusterHelperTest.TEST_NETWORK_NAME, actualLoggable.getCustomValue("networkname")); }
protected java.util.Map<java.lang.String, java.lang.Object> build() { java.util.Map<java.lang.String, java.lang.Object> struct = new java.util.HashMap<>(); struct.put(VdsProperties.vm_guid, org.ovirt.engine.core.vdsbroker.UpdateVmPolicyVDSCommand.getParameters().getVmId().toString()); if ((org.ovirt.engine.core.vdsbroker.UpdateVmPolicyVDSCommand.getParameters().getCpuLimit()) != null) { struct.put(VdsProperties.vCpuLimit, java.lang.String.valueOf(org.ovirt.engine.core.vdsbroker.UpdateVmPolicyVDSCommand.getParameters().getCpuLimit())); } java.util.List<java.lang.Object> ioTunesList = new java.util.ArrayList<>(); for (org.ovirt.engine.core.common.vdscommands.UpdateVmPolicyVDSParams.IoTuneParams param : org.ovirt.engine.core.vdsbroker.UpdateVmPolicyVDSCommand.getParameters().getIoTuneList()) { java.util.Map<java.lang.String, java.lang.Object> ioStruct = new java.util.HashMap<>(); ioStruct.put(VdsProperties.DomainId, param.getDomainId()); ioStruct.put(VdsProperties.PoolId, param.getPoolId()); ioStruct.put(VdsProperties.ImageId, param.getImageId()); ioStruct.put(VdsProperties.VolumeId, param.getVolumeId()); ioStruct.put(VdsProperties.IoPolicyMaximum, param.getIoTune()); ioStruct.put(VdsProperties.IoPolicyGuarenteed, param.getIoTune()); ioTunesList.add(ioStruct); } if (!(ioTunesList.isEmpty())) { struct.put(VdsProperties.Iotune, ioTunesList); } return struct; }
private org.ovirt.engine.core.vdsbroker.vdsbroker.CreateVDSCommand<?> initCreateVDSCommand(org.ovirt.engine.core.common.businessentities.VM vm) throws java.lang.Exception { if (vm.isSysprepUsed()) { org.ovirt.engine.core.vdsbroker.vdsbroker.CreateVmFromSysPrepVDSCommandParameters createVmFromSysPrepParam = new org.ovirt.engine.core.vdsbroker.vdsbroker.CreateVmFromSysPrepVDSCommandParameters(org.ovirt.engine.core.vdsbroker.CreateVmVDSCommand.getVdsId(), vm, vm.getName(), vm.getVmDomain()); createVmFromSysPrepParam.setSysPrepParams(org.ovirt.engine.core.vdsbroker.CreateVmVDSCommand.getParameters().getSysPrepParams()); return new org.ovirt.engine.core.vdsbroker.vdsbroker.CreateVmFromSysPrepVDSCommand<org.ovirt.engine.core.vdsbroker.vdsbroker.CreateVmFromSysPrepVDSCommandParameters>(createVmFromSysPrepParam); } else if (vm.isCloudInitUsed()) { return new org.ovirt.engine.core.vdsbroker.vdsbroker.CreateVmFromCloudInitVDSCommand<org.ovirt.engine.core.common.vdscommands.CreateVmVDSCommandParameters>(org.ovirt.engine.core.vdsbroker.CreateVmVDSCommand.getParameters()); } else { return new org.ovirt.engine.core.vdsbroker.vdsbroker.CreateVDSCommand<org.ovirt.engine.core.common.vdscommands.CreateVmVDSCommandParameters>(org.ovirt.engine.core.vdsbroker.CreateVmVDSCommand.getParameters()); } }
@java.lang.Override public void eventRaised(org.ovirt.engine.ui.uicompat.Event ev, java.lang.Object sender, org.ovirt.engine.ui.uicompat.EventArgs args) { java.lang.String slaveUser = getSlaveUserName().getEntity(); getSlaveUserGroupName().setIsChangable(((slaveUser != null) && (!(slaveUser.equalsIgnoreCase(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().rootUser()))))); }
@org.junit.Test public void untarEmptyTarArchiveReturnsEntries() throws java.io.IOException { byte[] emptyFile = load("tar-with-empty-file.tar"); try (org.ovirt.engine.core.utils.archivers.tar.TarInMemoryExport tar = new org.ovirt.engine.core.utils.archivers.tar.TarInMemoryExport(new java.io.ByteArrayInputStream(emptyFile))) { java.util.Map<java.lang.String, java.nio.ByteBuffer> entries = tar.unTar(); assertThat(entries.size(), is(1)); assertThat(entries, hasKey("empty.file")); } }
public boolean shouldRepeatEndMethodsOnFail(org.ovirt.engine.core.compat.Guid cmdId) { return false; }
@java.lang.Override protected boolean canDoAction() { if ((!(org.ovirt.engine.core.bll.UpdateVmDiskCommand.isVmExist())) || (!(isDiskExist(getOldDisk())))) { return false; } if (!(org.ovirt.engine.core.bll.UpdateVmDiskCommand.canRunActionOnNonManagedVm())) { return false; } if (!(vmsDiskOrSnapshotPluggedTo.isEmpty())) { if ((isAtLeastOneVmIsNotDown(vmsDiskOrSnapshotPluggedTo)) && (shouldUpdatePropertiesOtherThanSizeAndAlias())) { return failCanDoAction(VdcBllMessages.ACTION_TYPE_FAILED_VM_IS_NOT_DOWN); } boolean isUpdatedAsBootable = (!(getOldDisk().isBoot())) && (getNewDisk().isBoot()); if (isUpdatedAsBootable && (!(validate(noVmsContainBootableDisks(vmsDiskPluggedTo))))) { return false; } boolean isDiskInterfaceUpdated = (getOldDisk().getDiskInterface()) != (getNewDisk().getDiskInterface()); if (isDiskInterfaceUpdated && (!(validatePciAndIdeLimit(vmsDiskOrSnapshotPluggedTo)))) { return false; } } if ((DiskStorageType.IMAGE.equals(getOldDisk().getDiskStorageType())) && (!(validateCanResizeDisk()))) { return false; } org.ovirt.engine.core.bll.validator.DiskValidator diskValidator = getDiskValidator(getNewDisk()); return ((((validateCanUpdateShareable()) && (validateCanUpdateReadOnly())) && (validate(diskValidator.isVirtIoScsiValid(org.ovirt.engine.core.bll.UpdateVmDiskCommand.getVm())))) && (validate(diskValidator.isReadOnlyPropertyCompatibleWithInterface()))) && (((getOldDisk().getDiskInterface()) == (getNewDisk().getDiskInterface())) || (validate(diskValidator.isDiskInterfaceSupported(org.ovirt.engine.core.bll.UpdateVmDiskCommand.getVm())))); }
@org.junit.Test public void testValidateNameSizeImportAsCloned() { checkVmName(true, org.ovirt.engine.core.utils.RandomUtils.instance().nextPropertyString(300)); }
private void setDetailList() { java.util.List<org.ovirt.engine.ui.uicommonweb.models.HasEntity<java.lang.Object>> list = new java.util.ArrayList<>(); list.add(getVmBasicDiskListModel()); setDetailModels(list); setActiveDetailModel(getVmBasicDiskListModel()); }
private boolean candidateOperation(org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkItemModel<?> op1, org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkItemModel<?> op2, boolean drop) { if (op1 == null) { throw new java.lang.IllegalArgumentException("null Operands"); } org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkOperation candidate = org.ovirt.engine.ui.uicommonweb.models.hosts.network.NetworkOperationFactory.operationFor(op1, op2, true); if (drop) { onOperation(candidate, candidate.getCommand(op1, op2, allNics)); } if (((!(candidate.equals(currentCandidate))) || (!(equals(op1, currentOp1)))) || (!(equals(op2, currentOp2)))) { currentCandidate = candidate; currentOp1 = op1; currentOp2 = op2; getOperationCandidateEvent().raise(this, new org.ovirt.engine.ui.uicommonweb.models.hosts.network.OperationCandidateEventArgs(candidate, op1, op2)); } return !(candidate.isNullOperation()); }
public void setPmOptionsMap(java.util.Map<java.lang.String, java.lang.String> value) { setPmOptionsMapInternal(value, getPmPort(), getPmSlot(), getPmSecure(), getPmOptions()); }
public java.util.List<org.ovirt.engine.ui.uicommonweb.models.hosts.numa.VNodeModel> getUnassignedVNodeModelList() { return unassignedVNodeModelList; }
public void syncWithBackend() { final org.ovirt.engine.core.common.businessentities.StoragePool dc = getSelectedDc(); if (dc == null) { return; } boolean isSupportBridgesReportByVDSM = ((java.lang.Boolean) (org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getConfigValuePreConverted(ConfigurationValues.SupportBridgesReportByVDSM, dc.getcompatibility_version().toString()))); setSupportBridgesReportByVDSM(isSupportBridgesReportByVDSM); boolean isMTUOverrideSupported = ((java.lang.Boolean) (org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getConfigValuePreConverted(ConfigurationValues.MTUOverrideSupported, dc.getcompatibility_version().toString()))); setMTUOverrideSupported(isMTUOverrideSupported); org.ovirt.engine.ui.frontend.AsyncQuery query = new org.ovirt.engine.ui.frontend.AsyncQuery(); query.asyncCallback = new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object returnValue) { java.lang.Iterable<org.ovirt.engine.core.common.businessentities.network.NetworkQoS> qos = ((java.lang.Iterable<org.ovirt.engine.core.common.businessentities.network.NetworkQoS>) (returnValue)); getQos().setItems(qos); getQos().setSelectedItem(org.ovirt.engine.ui.uicommonweb.Linq.findNetworkQosById(qos, getNetwork().getQosId())); } }; org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getAllNetworkQos(dc.getId(), query); onExportChanged(); getProfiles().updateDcId(dc.getId()); }
@java.lang.Override protected org.ovirt.engine.api.model.HostNic postPopulate(org.ovirt.engine.api.model.HostNic model) { org.ovirt.engine.api.model.HostNic hostNIC = super.postPopulate(model); org.ovirt.engine.api.model.Qos qos = hostNIC.getQos(); qos.setType(QosType.HOSTNETWORK); qos.setName(null); qos.setDataCenter(null); model.setBootProtocol(org.ovirt.engine.api.restapi.types.MappingTestHelper.shuffle(org.ovirt.engine.api.model.BootProtocol.class, BootProtocol.AUTOCONF)); return hostNIC; }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.Network> getAllForDataCenter(org.ovirt.engine.core.compat.Guid id) { return getCallsHandler().executeReadList("GetAllNetworkByStoragePoolId", org.ovirt.engine.core.dao.NetworkDAODbFacadeImpl.NetworkRowMapper.instance, getCustomMapSqlParameterSource().addValue("id", id)); }
protected org.ovirt.engine.core.bll.network.macpool.MacPool getMacPool() { return org.ovirt.engine.core.di.Injector.get(org.ovirt.engine.core.bll.network.macpool.MacPoolPerDc.class).poolForDataCenter(params.getStoragePoolId()); }
@org.junit.Test public void checkRemoveIscsiConnectionDisksExist() { parameters.setStorageServerConnection(iSCSIConnection); when(storageServerConnectionDao.get(iSCSIConnection.getid())).thenReturn(iSCSIConnection); java.util.List<org.ovirt.engine.core.common.businessentities.storage.LUNs> luns = new java.util.ArrayList<org.ovirt.engine.core.common.businessentities.storage.LUNs>(); org.ovirt.engine.core.common.businessentities.storage.LUNs lun1 = new org.ovirt.engine.core.common.businessentities.storage.LUNs(); lun1.setLUN_id("3600144f09dbd05000000517e730b1212"); lun1.setStorageDomainName("storagedomain1"); lun1.setvolume_group_id(""); lun1.setDiskAlias("disk1"); luns.add(lun1); org.ovirt.engine.core.common.businessentities.storage.LUNs lun2 = new org.ovirt.engine.core.common.businessentities.storage.LUNs(); lun2.setLUN_id("3600144f09dbd05000000517e730b1212"); lun2.setStorageDomainName("storagedomain4"); lun2.setvolume_group_id(""); lun2.setDiskAlias("disk2"); luns.add(lun2); when(lunDao.getAllForStorageServerConnection(iSCSIConnection.getid())).thenReturn(luns); org.ovirt.engine.core.bll.CanDoActionTestUtils.runAndAssertCanDoActionFailure(command, EngineMessage.ACTION_TYPE_FAILED_STORAGE_CONNECTION_BELONGS_TO_SEVERAL_DISKS); }
@java.lang.Override protected org.ovirt.engine.ui.common.widget.uicommon.popup.vm.PopupWidgetConfigMap createWidgetConfiguration() { return super.createWidgetConfiguration().update(foremanTab, hiddenField()).putAll(poolSpecificFields(), hiddenField()).putOne(isDeleteProtectedEditor, hiddenField()).putOne(isStatelessEditor, hiddenField()).putOne(isRunAndPauseEditor, hiddenField()).putOne(commentEditor, hiddenField()).putOne(vmTypeEditor, hiddenField()).putOne(oSTypeEditor, hiddenField()).putOne(initialRunTab, hiddenField()).putOne(expander, hiddenField()).putOne(allowConsoleReconnectEditor, hiddenField()).putOne(cdAttachedEditor, hiddenField()).putOne(cdImageEditor, hiddenField()).putOne(refreshButton, hiddenField()).putOne(timeZoneEditor, hiddenField()).putOne(generalLabel, hiddenField()).putOne(quotaEditor, hiddenField()).putOne(cpuAllocationPanel, hiddenField()).putOne(vncKeyboardLayoutEditor, hiddenField()).putOne(storageAllocationPanel, hiddenField()).putOne(customPropertiesTab, hiddenField()).putOne(ssoMethodLabel, hiddenField()).putOne(ssoMethodNone, hiddenField()).putOne(ssoMethodGuestAgent, hiddenField()).putOne(hostCpuEditor, hiddenField()).putOne(templateVersionNameEditor, hiddenField()).putOne(bootMenuEnabledEditor, hiddenField()).putOne(serialNumberPolicyEditor, hiddenField()).putOne(timeZoneEditorWithInfo, hiddenField()).putOne(startRunningOnPanel, hiddenField()).putOne(spiceCopyPasteEnabledEditor, hiddenField()).putOne(spiceFileTransferEnabledEditor, hiddenField()).putOne(iconTab, hiddenField()).putOne(consoleDisconnectActionEditor, hiddenField()).putOne(customCompatibilityVersionEditor, hiddenField()); }
@org.junit.Test public void equalSpaceThreshold() { org.ovirt.engine.core.bll.command.utils.StorageDomainSpaceCheckerTest.SpaceTestSettings settings = new org.ovirt.engine.core.bll.command.utils.StorageDomainSpaceCheckerTest.SpaceTestSettings(); settings.diskSpaceFree = 5; settings.diskSpaceUsed = 5; settings.spaceThresholdGB = 5; settings.spaceThresholdPct = 10; org.ovirt.engine.core.common.businessentities.storage_domains domain = setupForSpaceTest(settings); assertFalse(org.ovirt.engine.core.bll.command.utils.StorageDomainSpaceChecker.isWithinThresholds(domain)); }
@java.lang.Override public java.lang.String getValue(org.ovirt.engine.core.common.businessentities.VmTemplate object) { return org.ovirt.engine.ui.webadmin.section.main.view.tab.storage.SubTabStorageTemplateBackupView.messages.megabytes(java.lang.String.valueOf(object.getMemSizeMb())); }
protected org.ovirt.engine.core.bll.SPMAsyncTask ConcreteCreateTask(@java.lang.SuppressWarnings("unused") org.ovirt.engine.core.common.asynctasks.AsyncTaskCreationInfo asyncTaskCreationInfo, @java.lang.SuppressWarnings("unused") org.ovirt.engine.core.common.action.VdcActionType parentCommand) { throw new org.ovirt.engine.core.compat.NotImplementedException(); }
protected java.util.List<? extends org.ovirt.engine.core.bll.memory.sdfilters.StorageDomainFilter> getStorageDomainFilters() { return java.util.Arrays.asList(new org.ovirt.engine.core.bll.memory.sdfilters.StorageDomainStatusFilter(), new org.ovirt.engine.core.bll.memory.sdfilters.StorageDomainTypeFilter(), new org.ovirt.engine.core.bll.memory.sdfilters.StorageDomainSpaceRequirementsFilter()); }
public void setTabVisible(com.gwtplatform.mvp.client.TabData tabData, boolean visible) { }
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.VDSGroup> getByName(java.lang.String name, boolean isCaseSensitive) { org.springframework.jdbc.core.namedparam.MapSqlParameterSource parameterSource = getCustomMapSqlParameterSource().addValue("vds_group_name", name).addValue("is_case_sensitive", isCaseSensitive); return getCallsHandler().executeReadList("GetVdsGroupByVdsGroupName", org.ovirt.engine.core.dao.VdsGroupDaoImpl.VdsGroupRowMapper.instance, parameterSource); }
@com.google.gwt.i18n.client.Constants.DefaultStringValue("Specific User/Group") java.lang.String specificUserGroupPermission();
@java.lang.Override public java.util.List<org.ovirt.engine.core.common.businessentities.VDS> filter(java.util.List<org.ovirt.engine.core.common.businessentities.VDS> hosts, org.ovirt.engine.core.common.businessentities.VM vm, java.util.Map<java.lang.String, java.lang.String> parameters, java.util.List<java.lang.String> messages) { return org.ovirt.engine.core.bll.scheduling.policyunits.VmAffinityFilterPolicyUnit.getAcceptableHosts(true, hosts, vm, messages); }
@java.lang.Override protected org.ovirt.engine.ui.common.widget.uicommon.popup.vm.PopupWidgetConfigMap createWidgetConfiguration() { return super.createWidgetConfiguration().putAll(allTabs(), simpleField().visibleInAdvancedModeOnly()).putAll(adancedFieldsFromGeneralTab(), simpleField().visibleInAdvancedModeOnly()).putAll(consoleTabWidgets(), simpleField().visibleInAdvancedModeOnly()).update(consoleTab, simpleField()).update(numOfMonitorsEditor, simpleField()).update(isSingleQxlEnabledEditor, simpleField()).putOne(isSoundcardEnabledEditor, simpleField().visibleInAdvancedModeOnly()).putOne(isConsoleDeviceEnabledEditor, simpleField().visibleInAdvancedModeOnly()); }
private org.ovirt.engine.core.compat.Guid getPoolSpmId() { if ((cachedSpmId) == null) { cachedSpmId = org.ovirt.engine.core.bll.ImageSpmCommand.getStoragePool().getspm_vds_id(); } return cachedSpmId; }
@org.junit.Test public void testIscsiLunCannotBeAddedIfAddingFloatingDisk() { org.ovirt.engine.core.common.businessentities.storage.LunDisk disk = createISCSILunDisk(ScsiGenericIO.UNFILTERED, true, DiskInterface.IDE); org.ovirt.engine.core.common.action.AddDiskParameters parameters = org.ovirt.engine.core.bll.AddDiskCommandTest.createParameters(); parameters.setDiskInfo(disk); initializeCommand(org.ovirt.engine.core.compat.Guid.newGuid(), parameters); assertFalse("Floating disk with SCSI reservation set successfully added", command.checkIfLunDiskCanBeAdded(spyDiskValidator(disk))); verifyCanDoActionMessagesContainMessage(EngineMessage.ACTION_TYPE_FAILED_SCSI_RESERVATION_NOT_VALID_FOR_FLOATING_DISK); }
@java.lang.Override protected void executeQueryCommand() { org.ovirt.engine.core.common.businessentities.StorageDomain storageDomain = storageDomainDao.get(org.ovirt.engine.core.bll.storage.disk.image.GetAllDisksByStorageDomainIdQuery.getParameters().getId()); if (storageDomain.getStorageType().isCinderDomain()) { java.util.List<org.ovirt.engine.core.common.businessentities.storage.DiskImage> diskImages = diskImageDao.getAllForStorageDomain(org.ovirt.engine.core.bll.storage.disk.image.GetAllDisksByStorageDomainIdQuery.getParameters().getId()); org.ovirt.engine.core.bll.storage.disk.image.GetAllDisksByStorageDomainIdQuery.getQueryReturnValue().setReturnValue(diskImages); } else { java.util.List<org.ovirt.engine.core.common.businessentities.storage.DiskImage> diskImages = diskImageDao.getAllSnapshotsForStorageDomain(org.ovirt.engine.core.bll.storage.disk.image.GetAllDisksByStorageDomainIdQuery.getParameters().getId()); org.ovirt.engine.core.bll.storage.disk.image.GetAllDisksByStorageDomainIdQuery.getQueryReturnValue().setReturnValue(new java.util.ArrayList(imagesHandler.aggregateDiskImagesSnapshots(diskImages))); } }
public abstract void sendMessage(byte[] message);
private void validateDimensions() { boolean dimensionsValid = ((((image.getWidth()) >= (dimensionsType.getMinWidth())) && ((image.getWidth()) <= (dimensionsType.getMaxWidth()))) && ((image.getHeight()) >= (dimensionsType.getMinHeight()))) && ((image.getHeight()) <= (dimensionsType.getMaxHeight())); if (!dimensionsValid) { validationResult = new org.ovirt.engine.core.bll.ValidationResult(org.ovirt.engine.core.common.errors.EngineMessage.PROVIDED_VM_ICON_HAS_INVALID_DIMENSIONS, (((((((("$allowedDimensions " + "from ") + (dimensionsType.getMinWidth())) + "x") + (dimensionsType.getMinHeight())) + " to ") + (dimensionsType.getMaxWidth())) + "x") + (dimensionsType.getMaxHeight())), ((("$currentDimensions " + (image.getWidth())) + "x") + (image.getHeight()))); } }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("Edit and Approve Host") java.lang.String editAndApproveHostTitle();
@org.junit.Test public void testSave() { dao.save(new_bookmark); org.ovirt.engine.core.common.businessentities.Bookmark result = dao.getByName(new_bookmark.getbookmark_name()); assertNotNull(result); }
java.lang.String uploadImageCannotBeOpened();
@java.lang.Override public void onSuccess(java.lang.Object target, java.lang.Object returnValue) { org.ovirt.engine.core.common.queries.VdcQueryReturnValue queryReturnValue = ((org.ovirt.engine.core.common.queries.VdcQueryReturnValue) (returnValue)); if (queryReturnValue.getSucceeded()) { org.ovirt.engine.core.common.businessentities.VM vm = queryReturnValue.getReturnValue(); updateVms(java.util.Collections.singletonList(vm)); } else { setError(messages.failedToLoadOva(getOvaPath().getEntity())); } stopProgress(); }
public org.ovirt.engine.core.common.job.Step addStep(org.ovirt.engine.core.bll.job.ExecutionContext context, org.ovirt.engine.core.common.job.StepEnum stepName, java.lang.String description, boolean isExternal) { if (context == null) { return null; } org.ovirt.engine.core.common.job.Step step = null; if (context.isMonitored()) { if (description == null) { description = org.ovirt.engine.core.dal.job.ExecutionMessageDirector.getInstance().getStepMessage(stepName); } try { org.ovirt.engine.core.common.job.Job job = context.getJob(); if (((context.getExecutionMethod()) == (org.ovirt.engine.core.bll.job.ExecutionContext.ExecutionMethod.AsJob)) && (job != null)) { step = job.addStep(stepName, description); try { step.setExternal(isExternal); jobRepository.saveStep(step); } catch (java.lang.Exception e) { log.error("Failed to save new step '{}' for job '{}', '{}': {}", stepName.name(), job.getId(), job.getActionType().name(), e.getMessage()); log.debug("Exception", e); job.getSteps().remove(step); step = null; } } else { org.ovirt.engine.core.common.job.Step contextStep = context.getStep(); if (((context.getExecutionMethod()) == (org.ovirt.engine.core.bll.job.ExecutionContext.ExecutionMethod.AsStep)) && (contextStep != null)) { step = addSubStep(contextStep, stepName, description, java.util.Collections.emptyList()); step.setExternal(isExternal); } } } catch (java.lang.Exception e) { log.error("Exception", e); } } return step; }
@org.ovirt.engine.ui.uicompat.DefaultStringValue("External Providers") java.lang.String externalProvidersTitle();
private void handlePartiallyExecutedTaskOfCommand(final org.ovirt.engine.core.common.businessentities.AsyncTask task) { if (org.ovirt.engine.core.bll.tasks.AsyncTaskManager.hasEmptyVdsmId(task)) { org.ovirt.engine.core.bll.tasks.AsyncTaskManager.removeTaskFromDbByTaskId(task.getTaskId()); return; } partiallyCompletedCommandTasks.put(task.getVdsmTaskId(), task); }
private static java.lang.String getMessageToLog(java.lang.String loggerString, org.ovirt.engine.core.common.businessentities.AuditLog auditLog) { if (loggerString.isEmpty()) { return auditLog.toStringForLogging(); } else { return java.text.MessageFormat.format(loggerString, auditLog.getMessage()); } }
@java.lang.Override protected boolean canDoAction() { boolean returnValue = super.canDoAction(); oldPool = org.ovirt.engine.core.bll.UpdateVmPoolWithVmsCommand.getVmPoolDAO().get(org.ovirt.engine.core.bll.UpdateVmPoolWithVmsCommand.getVmPool().getVmPoolId()); if (returnValue && ((oldPool) == null)) { addCanDoActionMessage(VdcBllMessages.VM_POOL_CANNOT_UPDATE_POOL_NOT_FOUND); returnValue = false; } else if (returnValue && ((org.ovirt.engine.core.bll.UpdateVmPoolWithVmsCommand.getParameters().getVmsCount()) < 0)) { addCanDoActionMessage(VdcBllMessages.VM_POOL_CANNOT_DECREASE_VMS_FROM_POOL); returnValue = false; } return returnValue; }
public void setConfigParams(java.util.List<org.ovirt.engine.core.common.businessentities.gluster.GlusterVolumeSnapshotConfig> params) { this.configParams = params; }
@java.lang.Override protected org.springframework.jdbc.core.namedparam.MapSqlParameterSource createFullParametersMapper(org.ovirt.engine.core.common.businessentities.HostDevice entity) { return createIdParameterMapper(entity.getId()).addValue("parent_device_name", entity.getParentDeviceName()).addValue("capability", entity.getCapability()).addValue("iommu_group", entity.getIommuGroup()).addValue("mdev_types", java.lang.String.join(",", entity.getMdevTypes())).addValue("product_name", entity.getProductName()).addValue("product_id", entity.getProductId()).addValue("vendor_name", entity.getVendorName()).addValue("vendor_id", entity.getVendorId()).addValue("physfn", entity.getParentPhysicalFunction()).addValue("total_vfs", entity.getTotalVirtualFunctions()).addValue("net_iface_name", entity.getNetworkInterfaceName()).addValue("driver", entity.getDriver()).addValue("is_assignable", entity.isAssignable()).addValue("address", org.ovirt.engine.core.utils.SerializationFactory.getSerializer().serialize(entity.getAddress())); }
@java.lang.Override @org.junit.Before public void setUp() throws java.lang.Exception { super.setUp(); dao = dbFacade.getAsyncTaskDao(); params = new org.ovirt.engine.core.common.action.VdcActionParametersBase(); params.setSessionId("ASESSIONID"); params.setTransactionScopeOption(TransactionScopeOption.RequiresNew); taskParams = new org.ovirt.engine.core.common.action.VdcActionParametersBase(); taskParams.setSessionId("ASESSIONID"); taskParams.setTransactionScopeOption(TransactionScopeOption.RequiresNew); taskParams.setParentParameters(params); newAsyncTask = new org.ovirt.engine.core.common.businessentities.AsyncTasks(); newAsyncTask.setTaskId(org.ovirt.engine.core.compat.Guid.newGuid()); newAsyncTask.setVdsmTaskId(org.ovirt.engine.core.compat.Guid.newGuid()); newAsyncTask.setStartTime(new java.util.Date()); newAsyncTask.setaction_type(VdcActionType.AddDisk); newAsyncTask.setstatus(AsyncTaskStatusEnum.running); newAsyncTask.setresult(AsyncTaskResultEnum.success); newAsyncTask.setActionParameters(params); newAsyncTask.setTaskParameters(taskParams); newAsyncTask.setCommandId(org.ovirt.engine.core.compat.Guid.newGuid()); newAsyncTask.setRootCommandId(org.ovirt.engine.core.compat.Guid.newGuid()); newAsyncTask.setTaskType(AsyncTaskType.copyImage); newAsyncTask.setStoragePoolId(org.ovirt.engine.core.compat.Guid.newGuid()); existingAsyncTask = dao.get(FixturesTool.EXISTING_TASK_ID); }
public java.util.Map<java.lang.String, java.lang.Object> glusterVolumeGeoRepSessionResume(java.lang.String volumeName, java.lang.String slaveHostName, java.lang.String slaveVolumeName, java.lang.String userName, boolean force);
private void initVisibilities() { errorMsg.setVisible(false); geoRepForceHelpIcon.setVisible(false); }
public void manage() { if ((getWindow()) != null) { return; } org.ovirt.engine.core.compat.Guid storagePoolId = ((getEntity().getStoragePoolId()) != null) ? getEntity().getStoragePoolId() : org.ovirt.engine.core.compat.Guid.Empty; org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery = new org.ovirt.engine.ui.frontend.AsyncQuery(); _asyncQuery.setModel(this); _asyncQuery.asyncCallback = new org.ovirt.engine.ui.frontend.INewAsyncCallback() { @java.lang.Override public void onSuccess(java.lang.Object model, java.lang.Object result) { org.ovirt.engine.ui.uicommonweb.models.clusters.ClusterNetworkListModel clusterNetworkListModel = ((org.ovirt.engine.ui.uicommonweb.models.clusters.ClusterNetworkListModel) (model)); java.util.ArrayList<org.ovirt.engine.core.common.businessentities.network.Network> dcNetworks = ((java.util.ArrayList<org.ovirt.engine.core.common.businessentities.network.Network>) (result)); org.ovirt.engine.ui.uicommonweb.models.clusters.ClusterNetworkManageModel networkToManage = createNetworkList(dcNetworks); clusterNetworkListModel.setWindow(networkToManage); networkToManage.setTitle(org.ovirt.engine.ui.uicompat.ConstantsManager.getInstance().getConstants().assignDetachNetworksTitle()); networkToManage.setHelpTag(HelpTag.assign_networks); networkToManage.setHashName("assign_networks"); } }; org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.getNetworkList(_asyncQuery, storagePoolId); }
public void setGuestContainers(java.util.List<org.ovirt.engine.core.common.businessentities.GuestContainer> guestContainers) { this.guestContainers = guestContainers; }
@java.lang.Override public java.lang.Object Convert(java.lang.Object source, org.ovirt.engine.ui.frontend.AsyncQuery _asyncQuery) { org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.cachedCommandsCompatibilityVersions = ((java.util.HashMap<org.ovirt.engine.core.common.action.VdcActionType, org.ovirt.engine.core.common.queries.CommandVersionsInfo>) (source)); return org.ovirt.engine.ui.uicommonweb.dataprovider.AsyncDataProvider.isCommandCompatible(vdcActionType, cluster, dc); }